(()=>{"use strict";var e,t,s,r,i,n,o,a,h,c,l,u,d={d:(e,t)=>{for(var s in t)d.o(t,s)&&!d.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},m={};d.r(m),d.d(m,{SdkBuilder:()=>builder_SdkBuilder});class DictArray_DictArray{constructor(){this.values={}}add(e,t){this.getValuesAtKey(e).push(t)}remove(e,t){const s=this.values[e];if(s){const e=s.indexOf(t);e>-1&&s.splice(e,1)}}getValuesAtKey(e){const t=this.values[e]||[];return this.values[e]=t,t}valuesPerKey(e){return this.getValuesAtKey(e).length}get keys(){return Object.keys(this.values)}}!function(e){let t,s,r;!function(e){e.PHASE_CHANGE="application.phasechange"}(t=e.Event||(e.Event={})),function(e){e.UNINITIALIZED="appphase.uninitialized",e.WAITING="appphase.waiting",e.LOADING="appphase.loading",e.STARTING="appphase.starting",e.PLAYING="appphase.playing",e.ERROR="appphase.error"}(s=e.Phase||(e.Phase={})),function(e){e.SHOWCASE="application.showcase"}(r=e.Application||(e.Application={}))}(e||(e={})),function(e){let t,s;!function(e){e.MOVE="camera.move"}(t=e.Event||(e.Event={})),function(e){e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.BACK="BACK",e.UP="UP",e.DOWN="DOWN"}(s=e.Direction||(e.Direction={}))}(t||(t={})),function(e){let t;!function(e){e.CHANGE_START="floors.changestart",e.CHANGE_END="floors.changeend"}(t=e.Event||(e.Event={}))}(s||(s={})),function(e){let t;!function(e){e.POSITION_UPDATED="label.positionupdated"}(t=e.Event||(e.Event={}))}(r||(r={})),function(e){let t,s,r,i,n;!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(t=e.Transition||(e.Transition={})),function(e){e.NAVIGATION="tag.link.nav",e.MODEL="tag.link.model",e.EXT_LINK="tag.link.ext"}(s=e.LinkType||(e.LinkType={})),function(e){e.NONE="tag.chunk.none",e.TEXT="tag.chunk.text",e.LINK="tag.chunk.link"}(r=e.DescriptionChunkType||(e.DescriptionChunkType={})),function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(i=e.Event||(e.Event={})),function(e){e.NONE="mattertag.media.none",e.PHOTO="mattertag.media.photo",e.VIDEO="mattertag.media.video",e.RICH="mattertag.media.rich"}(n=e.MediaType||(e.MediaType={}))}(i||(i={})),function(e){let t,s,r;!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(t=e.Mode||(e.Mode={})),function(e){e.CHANGE_START="viewmode.changestart",e.CHANGE_END="viewmode.changeend"}(s=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(r=e.TransitionType||(e.TransitionType={}))}(n||(n={})),function(e){let t;!function(e){e.MODEL_LOADED="model.loaded"}(t=e.Event||(e.Event={}))}(o||(o={})),function(e){let t;!function(e){e.NONE="intersectedobject.none",e.MODEL="intersectedobject.model",e.TAG="intersectedobject.tag",e.SWEEP="intersectedobject.sweep",e.UNKNOWN="intersectedobject.unknown"}(t=e.Colliders||(e.Colliders={}))}(a||(a={})),function(e){let t,s;!function(e){e.CLICK="INTERACTION.CLICK",e.HOVER="INTERACTION.HOVER",e.DRAG="INTERACTION.DRAG",e.DRAG_BEGIN="INTERACTION.DRAG_BEGIN",e.DRAG_END="INTERACTION.DRAG_END",e.POINTER_MOVE="INTERACTION.POINTER_MOVE",e.POINTER_BUTTON="INTERACTION.POINTER_BUTTON",e.SCROLL="INTERACTION.SCROLL",e.KEY="INTERACTION.KEY",e.LONG_PRESS_START="INTERACTION.LONG_PRESS_START",e.LONG_PRESS_END="INTERACTION.LONG_PRESS_END",e.MULTI_SWIPE="INTERACTION.MULTI_SWIPE",e.MULTI_SWIPE_END="INTERACTION.MULTI_SWIPE_END",e.PINCH="INTERACTION.PINCH",e.PINCH_END="INTERACTION.PINCH_END",e.ROTATE="INTERACTION.ROTATE",e.ROTATE_END="INTERACTION.ROTATE_END"}(t=e.InteractionType||(e.InteractionType={})),function(e){e.INPUT="input",e.OUTPUT="output",e.EVENT="event",e.EMIT="emit"}(s=e.PathType||(e.PathType={}))}(h||(h={})),function(e){let t,s;!function(e){e.CAMERA="sensor.sensortype.camera"}(t=e.SensorType||(e.SensorType={})),function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(s=e.SourceType||(e.SourceType={}))}(c||(c={})),function(e){let t,s,r,i;!function(e){e.ENTER="sweep.enter",e.EXIT="sweep.exit"}(t=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(s=e.Transition||(e.Transition={})),function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(r=e.Alignment||(e.Alignment={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(i=e.Placement||(e.Placement={}))}(l||(l={})),function(e){let t;!function(e){e.STARTED="tour.started",e.STOPPED="tour.stopped",e.ENDED="tour.ended",e.STEPPED="tour.stepped"}(t=e.Event||(e.Event={}))}(u||(u={}));Math.PI;n.Mode.DOLLHOUSE,new Float32Array(16);var p,b,y;!function(e){e.EVENT="postmessage.event",e.RESPONSE="postmessage.response",e.OBSERVATION="postmessage.observation",e.COLLECTION_UPDATE="collection.updated"}(p||(p={})),function(e){e.ITEM_ADDED="collection.item.added",e.ITEM_REMOVED="collection.item.removed",e.ITEM_UPDATED="collection.item.updated",e.COLL_UPDATED="collection.coll.updated"}(b||(b={}));!function(e){e.DISCONNECT="sdk.client.disconnect",e.ACTION="postmessage.action",e.EVENT_SUB="postmessage.subscribe",e.EVENT_UNSUB="postmessage.unsubscribe",e.OBSERVABLE_SUB="postmessage.observe",e.OBSERVABLE_UNSUB="postmessage.unobserve",e.COLLECTION_SUB="collection.sub",e.COLLECTION_UNSUB="collection.unsub"}(y||(y={}));var g,_,v;!function(e){e.LOADED="inject.loaded",e.SETUP="inject.setup",e.RESOLVE="inject.resolve"}(g||(g={})),function(e){e[e.POSTMESSAGE=1]="POSTMESSAGE"}(_||(_={}));!function(e){e.CAMERA="sensor.sensortype.camera"}(v||(v={}));const f={namespace:"Sensor",name:"addSource",varArg:!0,args:["sensorId","sourceIds"]},x={namespace:"Sensor",name:"dispose",args:["sensorId"]},M={namespace:"Sensor",name:"showDebug",args:["sensorId","show"]};var E;!function(e){e.map=new Map}(E||(E={}));const C={namespace:"Sensor",name:"updateSource",args:["sourceId","type","options"]};var w;!function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(w||(w={}));class observers_EventObserverAdaptor_EventObserverAdaptor{constructor(e){this.observer=e,this.messageType=p.EVENT}notify(e){this.observer.receiveEvent(e)}}class messages_EventSubscribeMessage_EventSubscribeMessage{constructor(e){this.type=y.EVENT_SUB,this.payload={subscription:e}}}class messages_EventUnsubscribeMessage_EventUnsubscribeMessage{constructor(e){this.type=y.EVENT_UNSUB,this.payload={subscription:e}}}class InterfaceBuilder_Events_EventInterfaceBuilder{constructor(e){this.messenger=e,this.eventHandlers=new DictArray_DictArray;const t=new class EventFacade{constructor(e){this.eventHandler=e}receiveEvent(e){this.eventHandler.receiveEvent(e)}}(this);this.eventObserver=new observers_EventObserverAdaptor_EventObserverAdaptor(t),this.messenger.addObserver(this.eventObserver)}build(){return{on:(e,t)=>this.subscribe(e,t),off:(e,t)=>this.unsubscribe(e,t)}}dispose(){for(const e of this.eventHandlers.keys)this.messenger.send(new messages_EventUnsubscribeMessage_EventUnsubscribeMessage(e));this.messenger.removeObserver(this.eventObserver)}receiveEvent(e){const t=this.eventHandlers.getValuesAtKey(e.eventType);if(t)for(const s of t)e.eventData?s(...e.eventData):s()}subscribe(e,t){0===this.eventHandlers.valuesPerKey(e)&&this.messenger.send(new messages_EventSubscribeMessage_EventSubscribeMessage(e)),this.eventHandlers.add(e,t)}unsubscribe(e,t){this.eventHandlers.remove(e,t),0===this.eventHandlers.valuesPerKey(e)&&this.messenger.send(new messages_EventUnsubscribeMessage_EventUnsubscribeMessage(e))}}class Enums_EnumInterfaceBuilder{constructor(){}build(e){const t={};for(const s of Object.keys(e)){const r=e[s];if(r){const e=t[r.namespace]||{};t[r.namespace]=e,e[r.name]=r.values}}return t}dispose(){}}class ClientHelperRegistration_ClientHelperRegistration{constructor(){}dispose(){}register(e,t){return t.value()}}class ClientHelperInterfaceBuilder_ClientHelperInterfaceBuilder{constructor(e){this.registration=e}build(e){const t={};for(const s of Object.keys(e)){const r=e[s];if(r){const e=t[r.namespace]||{};t[r.namespace]=e,e[r.name]=this.registration.register(s,r)}}return t}}function O(e,t){return(t=t||{x:0,y:0,z:0}).x=e.anchorPosition.x,t.y=e.anchorPosition.y,t.z=e.anchorPosition.z,t.x+=e.stemVector.x,t.y+=e.stemVector.y,t.z+=e.stemVector.z,t}const S=[];for(let e=0;e<256;e++)S[e]=(e<16?"0":"")+e.toString(16);Math.PI,Math.PI;function R(e,t,s){return Math.max(t,Math.min(s,e))}class Quaternion{constructor(e=0,t=0,s=0,r=1){this._x=e,this._y=t,this._z=s,this._w=r}static slerp(e,t,s,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),s.slerpQuaternions(e,t,r)}static slerpFlat(e,t,s,r,i,n,o){let a=s[r+0],h=s[r+1],c=s[r+2],l=s[r+3];const u=i[n+0],d=i[n+1],m=i[n+2],p=i[n+3];if(0===o)return e[t+0]=a,e[t+1]=h,e[t+2]=c,void(e[t+3]=l);if(1===o)return e[t+0]=u,e[t+1]=d,e[t+2]=m,void(e[t+3]=p);if(l!==p||a!==u||h!==d||c!==m){let e=1-o;const t=a*u+h*d+c*m+l*p,s=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),n=Math.atan2(i,t*s);e=Math.sin(e*n)/i,o=Math.sin(o*n)/i}const i=o*s;if(a=a*e+u*i,h=h*e+d*i,c=c*e+m*i,l=l*e+p*i,e===1-o){const e=1/Math.sqrt(a*a+h*h+c*c+l*l);a*=e,h*=e,c*=e,l*=e}}e[t]=a,e[t+1]=h,e[t+2]=c,e[t+3]=l}static multiplyQuaternionsFlat(e,t,s,r,i,n){const o=s[r],a=s[r+1],h=s[r+2],c=s[r+3],l=i[n],u=i[n+1],d=i[n+2],m=i[n+3];return e[t]=o*m+c*l+a*d-h*u,e[t+1]=a*m+c*u+h*l-o*d,e[t+2]=h*m+c*d+o*u-a*l,e[t+3]=c*m-o*l-a*u-h*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,s,r){return this._x=e,this._y=t,this._z=s,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const s=e._x,r=e._y,i=e._z,n=e._order,o=Math.cos,a=Math.sin,h=o(s/2),c=o(r/2),l=o(i/2),u=a(s/2),d=a(r/2),m=a(i/2);switch(n){case"XYZ":this._x=u*c*l+h*d*m,this._y=h*d*l-u*c*m,this._z=h*c*m+u*d*l,this._w=h*c*l-u*d*m;break;case"YXZ":this._x=u*c*l+h*d*m,this._y=h*d*l-u*c*m,this._z=h*c*m-u*d*l,this._w=h*c*l+u*d*m;break;case"ZXY":this._x=u*c*l-h*d*m,this._y=h*d*l+u*c*m,this._z=h*c*m+u*d*l,this._w=h*c*l-u*d*m;break;case"ZYX":this._x=u*c*l-h*d*m,this._y=h*d*l+u*c*m,this._z=h*c*m-u*d*l,this._w=h*c*l+u*d*m;break;case"YZX":this._x=u*c*l+h*d*m,this._y=h*d*l+u*c*m,this._z=h*c*m-u*d*l,this._w=h*c*l-u*d*m;break;case"XZY":this._x=u*c*l-h*d*m,this._y=h*d*l-u*c*m,this._z=h*c*m+u*d*l,this._w=h*c*l+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const s=t/2,r=Math.sin(s);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,s=t[0],r=t[4],i=t[8],n=t[1],o=t[5],a=t[9],h=t[2],c=t[6],l=t[10],u=s+o+l;if(u>0){const e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(c-a)*e,this._y=(i-h)*e,this._z=(n-r)*e}else if(s>o&&s>l){const e=2*Math.sqrt(1+s-o-l);this._w=(c-a)/e,this._x=.25*e,this._y=(r+n)/e,this._z=(i+h)/e}else if(o>l){const e=2*Math.sqrt(1+o-s-l);this._w=(i-h)/e,this._x=(r+n)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+l-s-o);this._w=(n-r)/e,this._x=(i+h)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let s=e.dot(t)+1;return s<Number.EPSILON?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(R(this.dot(e),-1,1)))}rotateTowards(e,t){const s=this.angleTo(e);if(0===s)return this;const r=Math.min(1,t/s);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const s=e._x,r=e._y,i=e._z,n=e._w,o=t._x,a=t._y,h=t._z,c=t._w;return this._x=s*c+n*o+r*h-i*a,this._y=r*c+n*a+i*o-s*h,this._z=i*c+n*h+s*a-r*o,this._w=n*c-s*o-r*a-i*h,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const s=this._x,r=this._y,i=this._z,n=this._w;let o=n*e._w+s*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=n,this._x=s,this._y=r,this._z=i,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*n+t*this._w,this._x=e*s+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(a),c=Math.atan2(h,o),l=Math.sin((1-t)*c)/h,u=Math.sin(t*c)/h;return this._w=n*l+this._w*u,this._x=s*l+this._x*u,this._y=r*l+this._y*u,this._z=i*l+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,s){this.copy(e).slerp(t,s)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Quaternion.prototype.isQuaternion=!0;class Vector3_Vector3{constructor(e=0,t=0,s=0){this.x=e,this.y=t,this.z=s}set(e,t,s){return void 0===s&&(s=this.z),this.x=e,this.y=t,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(A.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(A.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,s=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*s+i[6]*r,this.y=i[1]*t+i[4]*s+i[7]*r,this.z=i[2]*t+i[5]*s+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,s=this.y,r=this.z,i=e.elements,n=1/(i[3]*t+i[7]*s+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*s+i[8]*r+i[12])*n,this.y=(i[1]*t+i[5]*s+i[9]*r+i[13])*n,this.z=(i[2]*t+i[6]*s+i[10]*r+i[14])*n,this}applyQuaternion(e){const t=this.x,s=this.y,r=this.z,i=e.x,n=e.y,o=e.z,a=e.w,h=a*t+n*r-o*s,c=a*s+o*t-i*r,l=a*r+i*s-n*t,u=-i*t-n*s-o*r;return this.x=h*a+u*-i+c*-o-l*-n,this.y=c*a+u*-n+l*-i-h*-o,this.z=l*a+u*-o+h*-n-c*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,s=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*s+i[8]*r,this.y=i[1]*t+i[5]*s+i[9]*r,this.z=i[2]*t+i[6]*s+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(t,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const s=e.x,r=e.y,i=e.z,n=t.x,o=t.y,a=t.z;return this.x=r*a-i*o,this.y=i*n-s*a,this.z=s*o-r*n,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const s=e.dot(this)/t;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return z.copy(this).projectOnVector(e),this.sub(z)}reflect(e){return this.sub(z.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const s=this.dot(e)/t;return Math.acos(R(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,s=this.y-e.y,r=this.z-e.z;return t*t+s*s+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,s){const r=Math.sin(t)*e;return this.x=r*Math.sin(s),this.y=Math.cos(t)*e,this.z=r*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,s){return this.x=e*Math.sin(t),this.y=s,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=s,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,s){return void 0!==s&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}Vector3_Vector3.prototype.isVector3=!0;const z=new Vector3_Vector3,A=new Quaternion;class Matrix4{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,s,r,i,n,o,a,h,c,l,u,d,m,p,b){const y=this.elements;return y[0]=e,y[4]=t,y[8]=s,y[12]=r,y[1]=i,y[5]=n,y[9]=o,y[13]=a,y[2]=h,y[6]=c,y[10]=l,y[14]=u,y[3]=d,y[7]=m,y[11]=p,y[15]=b,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],this}copyPosition(e){const t=this.elements,s=e.elements;return t[12]=s[12],t[13]=s[13],t[14]=s[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,s){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,t,s){return this.set(e.x,t.x,s.x,0,e.y,t.y,s.y,0,e.z,t.z,s.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,s=e.elements,r=1/T.setFromMatrixColumn(e,0).length(),i=1/T.setFromMatrixColumn(e,1).length(),n=1/T.setFromMatrixColumn(e,2).length();return t[0]=s[0]*r,t[1]=s[1]*r,t[2]=s[2]*r,t[3]=0,t[4]=s[4]*i,t[5]=s[5]*i,t[6]=s[6]*i,t[7]=0,t[8]=s[8]*n,t[9]=s[9]*n,t[10]=s[10]*n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,s=e.x,r=e.y,i=e.z,n=Math.cos(s),o=Math.sin(s),a=Math.cos(r),h=Math.sin(r),c=Math.cos(i),l=Math.sin(i);if("XYZ"===e.order){const e=n*c,s=n*l,r=o*c,i=o*l;t[0]=a*c,t[4]=-a*l,t[8]=h,t[1]=s+r*h,t[5]=e-i*h,t[9]=-o*a,t[2]=i-e*h,t[6]=r+s*h,t[10]=n*a}else if("YXZ"===e.order){const e=a*c,s=a*l,r=h*c,i=h*l;t[0]=e+i*o,t[4]=r*o-s,t[8]=n*h,t[1]=n*l,t[5]=n*c,t[9]=-o,t[2]=s*o-r,t[6]=i+e*o,t[10]=n*a}else if("ZXY"===e.order){const e=a*c,s=a*l,r=h*c,i=h*l;t[0]=e-i*o,t[4]=-n*l,t[8]=r+s*o,t[1]=s+r*o,t[5]=n*c,t[9]=i-e*o,t[2]=-n*h,t[6]=o,t[10]=n*a}else if("ZYX"===e.order){const e=n*c,s=n*l,r=o*c,i=o*l;t[0]=a*c,t[4]=r*h-s,t[8]=e*h+i,t[1]=a*l,t[5]=i*h+e,t[9]=s*h-r,t[2]=-h,t[6]=o*a,t[10]=n*a}else if("YZX"===e.order){const e=n*a,s=n*h,r=o*a,i=o*h;t[0]=a*c,t[4]=i-e*l,t[8]=r*l+s,t[1]=l,t[5]=n*c,t[9]=-o*c,t[2]=-h*c,t[6]=s*l+r,t[10]=e-i*l}else if("XZY"===e.order){const e=n*a,s=n*h,r=o*a,i=o*h;t[0]=a*c,t[4]=-l,t[8]=h*c,t[1]=e*l+i,t[5]=n*c,t[9]=s*l-r,t[2]=r*l-s,t[6]=o*c,t[10]=i*l+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(D,e,N)}lookAt(e,t,s){const r=this.elements;return P.subVectors(e,t),0===P.lengthSq()&&(P.z=1),P.normalize(),k.crossVectors(s,P),0===k.lengthSq()&&(1===Math.abs(s.z)?P.x+=1e-4:P.z+=1e-4,P.normalize(),k.crossVectors(s,P)),k.normalize(),U.crossVectors(P,k),r[0]=k.x,r[4]=U.x,r[8]=P.x,r[1]=k.y,r[5]=U.y,r[9]=P.y,r[2]=k.z,r[6]=U.z,r[10]=P.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,r=t.elements,i=this.elements,n=s[0],o=s[4],a=s[8],h=s[12],c=s[1],l=s[5],u=s[9],d=s[13],m=s[2],p=s[6],b=s[10],y=s[14],g=s[3],_=s[7],v=s[11],f=s[15],x=r[0],M=r[4],E=r[8],C=r[12],w=r[1],O=r[5],S=r[9],R=r[13],z=r[2],A=r[6],T=r[10],I=r[14],D=r[3],N=r[7],k=r[11],U=r[15];return i[0]=n*x+o*w+a*z+h*D,i[4]=n*M+o*O+a*A+h*N,i[8]=n*E+o*S+a*T+h*k,i[12]=n*C+o*R+a*I+h*U,i[1]=c*x+l*w+u*z+d*D,i[5]=c*M+l*O+u*A+d*N,i[9]=c*E+l*S+u*T+d*k,i[13]=c*C+l*R+u*I+d*U,i[2]=m*x+p*w+b*z+y*D,i[6]=m*M+p*O+b*A+y*N,i[10]=m*E+p*S+b*T+y*k,i[14]=m*C+p*R+b*I+y*U,i[3]=g*x+_*w+v*z+f*D,i[7]=g*M+_*O+v*A+f*N,i[11]=g*E+_*S+v*T+f*k,i[15]=g*C+_*R+v*I+f*U,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[4],r=e[8],i=e[12],n=e[1],o=e[5],a=e[9],h=e[13],c=e[2],l=e[6],u=e[10],d=e[14];return e[3]*(+i*a*l-r*h*l-i*o*u+s*h*u+r*o*d-s*a*d)+e[7]*(+t*a*d-t*h*u+i*n*u-r*n*d+r*h*c-i*a*c)+e[11]*(+t*h*l-t*o*d-i*n*l+s*n*d+i*o*c-s*h*c)+e[15]*(-r*o*c-t*a*l+t*o*u+r*n*l-s*n*u+s*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,s){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=s),this}invert(){const e=this.elements,t=e[0],s=e[1],r=e[2],i=e[3],n=e[4],o=e[5],a=e[6],h=e[7],c=e[8],l=e[9],u=e[10],d=e[11],m=e[12],p=e[13],b=e[14],y=e[15],g=l*b*h-p*u*h+p*a*d-o*b*d-l*a*y+o*u*y,_=m*u*h-c*b*h-m*a*d+n*b*d+c*a*y-n*u*y,v=c*p*h-m*l*h+m*o*d-n*p*d-c*o*y+n*l*y,f=m*l*a-c*p*a-m*o*u+n*p*u+c*o*b-n*l*b,x=t*g+s*_+r*v+i*f;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/x;return e[0]=g*M,e[1]=(p*u*i-l*b*i-p*r*d+s*b*d+l*r*y-s*u*y)*M,e[2]=(o*b*i-p*a*i+p*r*h-s*b*h-o*r*y+s*a*y)*M,e[3]=(l*a*i-o*u*i-l*r*h+s*u*h+o*r*d-s*a*d)*M,e[4]=_*M,e[5]=(c*b*i-m*u*i+m*r*d-t*b*d-c*r*y+t*u*y)*M,e[6]=(m*a*i-n*b*i-m*r*h+t*b*h+n*r*y-t*a*y)*M,e[7]=(n*u*i-c*a*i+c*r*h-t*u*h-n*r*d+t*a*d)*M,e[8]=v*M,e[9]=(m*l*i-c*p*i-m*s*d+t*p*d+c*s*y-t*l*y)*M,e[10]=(n*p*i-m*o*i+m*s*h-t*p*h-n*s*y+t*o*y)*M,e[11]=(c*o*i-n*l*i-c*s*h+t*l*h+n*s*d-t*o*d)*M,e[12]=f*M,e[13]=(c*p*r-m*l*r+m*s*u-t*p*u-c*s*b+t*l*b)*M,e[14]=(m*o*r-n*p*r-m*s*a+t*p*a+n*s*b-t*o*b)*M,e[15]=(n*l*r-c*o*r+c*s*a-t*l*a-n*s*u+t*o*u)*M,this}scale(e){const t=this.elements,s=e.x,r=e.y,i=e.z;return t[0]*=s,t[4]*=r,t[8]*=i,t[1]*=s,t[5]*=r,t[9]*=i,t[2]*=s,t[6]*=r,t[10]*=i,t[3]*=s,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,s,r))}makeTranslation(e,t,s){return this.set(1,0,0,e,0,1,0,t,0,0,1,s,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,t,-s,0,0,s,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,0,s,0,0,1,0,0,-s,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,0,s,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const s=Math.cos(t),r=Math.sin(t),i=1-s,n=e.x,o=e.y,a=e.z,h=i*n,c=i*o;return this.set(h*n+s,h*o-r*a,h*a+r*o,0,h*o+r*a,c*o+s,c*a-r*n,0,h*a-r*o,c*a+r*n,i*a*a+s,0,0,0,0,1),this}makeScale(e,t,s){return this.set(e,0,0,0,0,t,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,t,s){return this.set(1,t,s,0,e,1,s,0,e,t,1,0,0,0,0,1),this}compose(e,t,s){const r=this.elements,i=t._x,n=t._y,o=t._z,a=t._w,h=i+i,c=n+n,l=o+o,u=i*h,d=i*c,m=i*l,p=n*c,b=n*l,y=o*l,g=a*h,_=a*c,v=a*l,f=s.x,x=s.y,M=s.z;return r[0]=(1-(p+y))*f,r[1]=(d+v)*f,r[2]=(m-_)*f,r[3]=0,r[4]=(d-v)*x,r[5]=(1-(u+y))*x,r[6]=(b+g)*x,r[7]=0,r[8]=(m+_)*M,r[9]=(b-g)*M,r[10]=(1-(u+p))*M,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,s){const r=this.elements;let i=T.set(r[0],r[1],r[2]).length();const n=T.set(r[4],r[5],r[6]).length(),o=T.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],I.copy(this);const a=1/i,h=1/n,c=1/o;return I.elements[0]*=a,I.elements[1]*=a,I.elements[2]*=a,I.elements[4]*=h,I.elements[5]*=h,I.elements[6]*=h,I.elements[8]*=c,I.elements[9]*=c,I.elements[10]*=c,t.setFromRotationMatrix(I),s.x=i,s.y=n,s.z=o,this}makePerspective(e,t,s,r,i,n){void 0===n&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*i/(t-e),h=2*i/(s-r),c=(t+e)/(t-e),l=(s+r)/(s-r),u=-(n+i)/(n-i),d=-2*n*i/(n-i);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=h,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,s,r,i,n){const o=this.elements,a=1/(t-e),h=1/(s-r),c=1/(n-i),l=(t+e)*a,u=(s+r)*h,d=(n+i)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,s=e.elements;for(let e=0;e<16;e++)if(t[e]!==s[e])return!1;return!0}fromArray(e,t=0){for(let s=0;s<16;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e[t+9]=s[9],e[t+10]=s[10],e[t+11]=s[11],e[t+12]=s[12],e[t+13]=s[13],e[t+14]=s[14],e[t+15]=s[15],e}}Matrix4.prototype.isMatrix4=!0;const T=new Vector3_Vector3,I=new Matrix4,D=new Vector3_Vector3(0,0,0),N=new Vector3_Vector3(1,1,1),k=new Vector3_Vector3,U=new Vector3_Vector3,P=new Vector3_Vector3,V=new Matrix4,F=new Quaternion;class Euler_Euler{constructor(e=0,t=0,s=0,r=Euler_Euler.DefaultOrder){this._x=e,this._y=t,this._z=s,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,s,r){return this._x=e,this._y=t,this._z=s,this._order=r||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,s){const r=e.elements,i=r[0],n=r[4],o=r[8],a=r[1],h=r[5],c=r[9],l=r[2],u=r[6],d=r[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(R(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-n,i)):(this._x=Math.atan2(u,h),this._z=0);break;case"YXZ":this._x=Math.asin(-R(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,h)):(this._y=Math.atan2(-l,i),this._z=0);break;case"ZXY":this._x=Math.asin(R(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-l,d),this._z=Math.atan2(-n,h)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-R(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-n,h));break;case"YZX":this._z=Math.asin(R(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-l,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-R(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(u,h),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==s&&this._onChangeCallback(),this}setFromQuaternion(e,t,s){return V.makeRotationFromQuaternion(e),this.setFromRotationMatrix(V,t,s)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return F.setFromEuler(this),this.setFromQuaternion(F,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new Vector3_Vector3(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Euler_Euler.prototype.isEuler=!0,Euler_Euler.DefaultOrder="XYZ",Euler_Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Layers{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}class Matrix3{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,s,r,i,n,o,a,h){const c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=i,c[5]=a,c[6]=s,c[7]=n,c[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],this}extractBasis(e,t,s){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,r=t.elements,i=this.elements,n=s[0],o=s[3],a=s[6],h=s[1],c=s[4],l=s[7],u=s[2],d=s[5],m=s[8],p=r[0],b=r[3],y=r[6],g=r[1],_=r[4],v=r[7],f=r[2],x=r[5],M=r[8];return i[0]=n*p+o*g+a*f,i[3]=n*b+o*_+a*x,i[6]=n*y+o*v+a*M,i[1]=h*p+c*g+l*f,i[4]=h*b+c*_+l*x,i[7]=h*y+c*v+l*M,i[2]=u*p+d*g+m*f,i[5]=u*b+d*_+m*x,i[8]=u*y+d*v+m*M,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[1],r=e[2],i=e[3],n=e[4],o=e[5],a=e[6],h=e[7],c=e[8];return t*n*c-t*o*h-s*i*c+s*o*a+r*i*h-r*n*a}invert(){const e=this.elements,t=e[0],s=e[1],r=e[2],i=e[3],n=e[4],o=e[5],a=e[6],h=e[7],c=e[8],l=c*n-o*h,u=o*a-c*i,d=h*i-n*a,m=t*l+s*u+r*d;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return e[0]=l*p,e[1]=(r*h-c*s)*p,e[2]=(o*s-r*n)*p,e[3]=u*p,e[4]=(c*t-r*a)*p,e[5]=(r*i-o*t)*p,e[6]=d*p,e[7]=(s*a-h*t)*p,e[8]=(n*t-s*i)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,s,r,i,n,o){const a=Math.cos(i),h=Math.sin(i);return this.set(s*a,s*h,-s*(a*n+h*o)+n+e,-r*h,r*a,-r*(-h*n+a*o)+o+t,0,0,1),this}scale(e,t){const s=this.elements;return s[0]*=e,s[3]*=e,s[6]*=e,s[1]*=t,s[4]*=t,s[7]*=t,this}rotate(e){const t=Math.cos(e),s=Math.sin(e),r=this.elements,i=r[0],n=r[3],o=r[6],a=r[1],h=r[4],c=r[7];return r[0]=t*i+s*a,r[3]=t*n+s*h,r[6]=t*o+s*c,r[1]=-s*i+t*a,r[4]=-s*n+t*h,r[7]=-s*o+t*c,this}translate(e,t){const s=this.elements;return s[0]+=e*s[2],s[3]+=e*s[5],s[6]+=e*s[8],s[1]+=t*s[2],s[4]+=t*s[5],s[7]+=t*s[8],this}equals(e){const t=this.elements,s=e.elements;for(let e=0;e<9;e++)if(t[e]!==s[e])return!1;return!0}fromArray(e,t=0){for(let s=0;s<9;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}Matrix3.prototype.isMatrix3=!0;let L=0;const j=new Vector3_Vector3,B=new Quaternion,W=new Matrix4,H=new Vector3_Vector3,q=new Vector3_Vector3,K=new Vector3_Vector3,Y=new Quaternion,X=new Vector3_Vector3(1,0,0),Q=new Vector3_Vector3(0,1,0),Z=new Vector3_Vector3(0,0,1),G={type:"added"},J={type:"removed"};class Object3D extends class EventDispatcher{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const s=this._listeners;void 0===s[e]&&(s[e]=[]),-1===s[e].indexOf(t)&&s[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const s=this._listeners;return void 0!==s[e]&&-1!==s[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const s=this._listeners[e];if(void 0!==s){const e=s.indexOf(t);-1!==e&&s.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const s=t.slice(0);for(let t=0,r=s.length;t<r;t++)s[t].call(this,e);e.target=null}}}{constructor(){super(),Object.defineProperty(this,"id",{value:L++}),this.uuid=function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,s=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(S[255&e]+S[e>>8&255]+S[e>>16&255]+S[e>>24&255]+"-"+S[255&t]+S[t>>8&255]+"-"+S[t>>16&15|64]+S[t>>24&255]+"-"+S[63&s|128]+S[s>>8&255]+"-"+S[s>>16&255]+S[s>>24&255]+S[255&r]+S[r>>8&255]+S[r>>16&255]+S[r>>24&255]).toUpperCase()}(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();const e=new Vector3_Vector3,t=new Euler_Euler,s=new Quaternion,r=new Vector3_Vector3(1,1,1);t._onChange((function(){s.setFromEuler(t,!1)})),s._onChange((function(){t.setFromQuaternion(s,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return B.setFromAxisAngle(e,t),this.quaternion.multiply(B),this}rotateOnWorldAxis(e,t){return B.setFromAxisAngle(e,t),this.quaternion.premultiply(B),this}rotateX(e){return this.rotateOnAxis(X,e)}rotateY(e){return this.rotateOnAxis(Q,e)}rotateZ(e){return this.rotateOnAxis(Z,e)}translateOnAxis(e,t){return j.copy(e).applyQuaternion(this.quaternion),this.position.add(j.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(X,e)}translateY(e){return this.translateOnAxis(Q,e)}translateZ(e){return this.translateOnAxis(Z,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(W.copy(this.matrixWorld).invert())}lookAt(e,t,s){e.isVector3?H.copy(e):H.set(e,t,s);const r=this.parent;this.updateWorldMatrix(!0,!1),q.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?W.lookAt(q,H,this.up):W.lookAt(H,q,this.up),this.quaternion.setFromRotationMatrix(W),r&&(W.extractRotation(r.matrixWorld),B.setFromRotationMatrix(W),this.quaternion.premultiply(B.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(G)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(J)),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(J)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),W.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),W.multiply(e.parent.matrixWorld)),e.applyMatrix4(W),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let s=0,r=this.children.length;s<r;s++){const r=this.children[s].getObjectByProperty(e,t);if(void 0!==r)return r}}getWorldPosition(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Vector3_Vector3),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Quaternion),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(q,e,K),e}getWorldScale(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Vector3_Vector3),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(q,Y,e),e}getWorldDirection(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Vector3_Vector3),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let s=0,r=t.length;s<r;s++)t[s].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let s=0,r=t.length;s<r;s++)t[s].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let s=0,r=t.length;s<r;s++)t[s].updateMatrixWorld(e)}updateWorldMatrix(e,t){const s=this.parent;if(!0===e&&null!==s&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,s=e.length;t<s;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,s={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},s.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,s){return void 0===t[s.uuid]&&(t[s.uuid]=s.toJSON(e)),s.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const s=t.shapes;if(Array.isArray(s))for(let t=0,r=s.length;t<r;t++){const r=s[t];i(e.shapes,r)}else i(e.shapes,s)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let s=0,r=this.material.length;s<r;s++)t.push(i(e.materials,this.material[s]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const s=this.animations[t];r.animations.push(i(e.animations,s))}}if(t){const t=n(e.geometries),r=n(e.materials),i=n(e.textures),o=n(e.images),a=n(e.shapes),h=n(e.skeletons),c=n(e.animations);t.length>0&&(s.geometries=t),r.length>0&&(s.materials=r),i.length>0&&(s.textures=i),o.length>0&&(s.images=o),a.length>0&&(s.shapes=a),h.length>0&&(s.skeletons=h),c.length>0&&(s.animations=c)}return s.object=r,s;function n(e){const t=[];for(const s in e){const r=e[s];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const s=e.children[t];this.add(s.clone())}return this}}Object3D.DefaultUp=new Vector3_Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype.isObject3D=!0;class Camera_Camera extends Object3D{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Vector3_Vector3),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Camera_Camera.prototype.isCamera=!0;const $=(e,t,s=1e-5)=>Math.abs(e-t)<=s,ee=(e,t,s=1e-5)=>$(e.x,t.x,s)&&$(e.y,t.y,s),te=(e,t,s=1e-5)=>ee(e,t,s)&&$(e.z,t.z,s);function se(e,t){e.x=t.x,e.y=t.y}function re(e,t){se(e,t),e.z=t.z}class BaseException extends Error{constructor(e,t){var s;super(e instanceof Error?e.message:e),this.name="BaseException",t&&(this.code=t),e instanceof Error&&(this.originalError=e,(s=e)&&s instanceof Error&&s.isMock&&(this.isMock=!0))}}class ArraySizeMismatchException extends BaseException{constructor(){super("Cannot copy into an array of a different size"),this.name="ArraySizeMismatch"}}function ie(e,t){const s=1e-5;return e.mode===t.mode&&e.sweep===t.sweep&&te(e.position,t.position,s)&&ee(e.rotation,t.rotation,s)&&((e,t,s=1e-5)=>e.length===t.length&&!Array.prototype.some.call(e,((e,r)=>!$(e,t[r],s))))(e.projection,t.projection,s)}function ne(e,t){e.sweep=t.sweep,e.mode=t.mode,re(e.position,t.position),se(e.rotation,t.rotation),function(e,t){if(e.byteLength!==t.byteLength)throw new ArraySizeMismatchException;const s=t.length;for(let r=0;r<s;++r)e[r]=t[r]}(e.projection,t.projection)}const oe=Math.PI/180;class Conversion_CoordinateConverter_CoordinateConverter{constructor(){this.tempEuler=new Euler_Euler,this.tempPosition=new Vector3_Vector3,this.camera=new Camera_Camera,this.cameraPose=null}setCameraFromPose(e){if(this.cameraPose&&ie(this.cameraPose,e))return;this.cameraPose=this.cameraPose||ae,ne(this.cameraPose,e);const t=e.position;this.camera.position.set(t.x,t.y,t.z);const s=e.rotation;this.tempEuler.set(s.x*oe,s.y*oe,0,"YXZ"),this.camera.quaternion.setFromEuler(this.tempEuler),this.camera.updateMatrixWorld(),this.camera.projectionMatrix.fromArray(e.projection).transpose()}worldToNDC(e,t){return this.tempPosition.set(e.x,e.y,e.z),this.tempPosition.project(this.camera),(t=t||{x:0,y:0,z:0}).x=this.tempPosition.x,t.y=this.tempPosition.y,t.z=this.tempPosition.z,t}worldToScreen(e,t,s){return(s=this.worldToNDC(e,s)).x=.5*(this.tempPosition.x+1)*t.w,s.y=-.5*(this.tempPosition.y-1)*t.h,e.z<-1&&(s.x*=-1,s.y*=-1),s}}const ae={sweep:"",mode:n.Mode.DOLLHOUSE,position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16)};class TokenRefresherFactory{constructor(e){this.observers=new Set,this.refreshListeners=new Set,this.errorListeners=new Set,this.updateTokenCall=e.functionRegister.register("OAuth.updateToken",{namespace:"OAuth",name:"updateToken",args:["token"]});const t=this;this.TokenRefresher=class{constructor(e,s){t.scheduleRefresh(e,s)}dispose(){clearTimeout(t.refreshTimeout)}on(e,s){if("string"==typeof e){if(!s||"function"!=typeof s)throw Error("The callback provided was not a valid function");if("refresh"===e)return t.addRefreshListener(s);if("error"===e)return t.addErrorListener(s)}else if(!("onRefresh"in e)&&!("onError"in e))throw Error("The observer provided was not a valid IRefreshObserver");return t.addObserver(e)}}}create(e,t){return new this.TokenRefresher(e,t)}addRefreshListener(e){return this.refreshListeners.add(e),{cancel(){this.refreshListeners.delete(e)}}}addErrorListener(e){return this.errorListeners.add(e),{cancel(){this.errorListeners.delete(e)}}}addObserver(e){return this.observers.add(e),{cancel(){this.observers.delete(e)}}}scheduleRefresh(e,t){this.refreshTimeout=setTimeout((async()=>{let s;try{if(s=await t.fetch(e.access_token),!s)throw Error('The "tokenFetcher" did not fetch anything');if("string"!=typeof s.access_token)throw Error('The "tokenFetcher" fetched an object that did not have a valid "access_token" property.');if("number"!=typeof s.expires_in)throw Error('The "tokenFetcher" fetched an object that did not have a valid "expires_in" property')}catch(e){return void this.notifyError(e)}this.updateTokenCall(s.access_token),this.notifyRefresh(),this.scheduleRefresh(s,t)}),1e3*(e.expires_in-60))}notifyRefresh(){for(const e of this.refreshListeners)e();for(const e of this.observers)e.onRefresh&&e.onRefresh()}notifyError(e){for(const t of this.errorListeners)t(e);for(const t of this.observers)t.onError&&t.onError(e)}}function he(e){return{"Conversion.worldToScreen":{namespace:"Conversion",name:"worldToScreen",value:()=>{return e=new Conversion_CoordinateConverter_CoordinateConverter,function(t,s,r,i){return e.setCameraFromPose(s),e.worldToScreen(t,r,i)};var e}},"Mattertag.getDiscPosition":{namespace:"Mattertag",name:"getDiscPosition",value:()=>O},"OAuth.TokenRefresher":{namespace:"OAuth",name:"createTokenRefresher",value:()=>function(e){const t=new TokenRefresherFactory(e);return(e,s)=>t.create(e,s)}(e)}}}class observers_ResponseObserverAdaptor_ResponseObserverAdaptor{constructor(e){this.receiver=e,this.messageType=p.RESPONSE}notify(e){this.receiver.receiveResponse(e)}}class messages_ActionMessage_ActionMessage{constructor(e,t,s){this.type=y.ACTION,this.payload={uid:e,targetFunction:t,params:s}}}function ce(e,t,s){const r={},i=void 0===s?e.length:s;for(let s=0;s<i;++s)r[e[s]]=t[s];return r}class Functions_FunctionRegistration_FunctionRegistration{constructor(e){this.messenger=e,this.responseResolvers={},this.currentMsgId=0,this.routines={};const t=new class FunctionFacade{constructor(e){this.functions=e}receiveResponse(e){this.functions.receiveResponse(e)}}(this);this.responseObserver=new observers_ResponseObserverAdaptor_ResponseObserverAdaptor(t),this.messenger.addObserver(this.responseObserver)}dispose(){this.messenger.removeObserver(this.responseObserver);for(const e in this.responseResolvers){const t=this.responseResolvers[e];t&&t.reject(`SDK client was disconnected before ${t.funcKey} was fulfilled`)}}register(e,t){return(...s)=>this.dispatchAction(e,t,...s)}applyMiddleware(e,...t){for(const s of t){const t=new s(e);this.routines[t.key]=t}}async dispatchAction(e,t,...s){return new Promise(((r,i)=>{this.responseResolvers[this.currentMsgId]={funcKey:e,funcDef:t,resolve:r,reject:i};const n=this.getSubRoutineFromDef(t),o=function(e,t,s=!1){if(s){const s=ce(e,t,e.length-1),r=e.length-1;return s[e[r]]=t.slice(r),s}return ce(e,t)}(n?n.argsDef.argNames:t.args,s,n?n.argsDef.varArg:t.varArg),a=n?n.buildMessageData(this.currentMsgId,o):o;this.messenger.send(new messages_ActionMessage_ActionMessage(this.currentMsgId,e,a)),++this.currentMsgId}))}async receiveResponse(e){const t=this.responseResolvers[e.uid];if(t)if(e.success){const s=this.getSubRoutineFromDef(t.funcDef);s?t.resolve(await s.onResponse(e.uid,e.message)):t.resolve(e.message)}else t.reject(e.error);delete this.responseResolvers[e.uid]}getSubRoutineFromDef(e){if(e.subRoutine){const t=this.routines[e.subRoutine];if(!t)throw new Error(`${e.subRoutine} sub-routine was not provided for ${e}`);return t}return null}}class FunctionInterfaceBuilder_FunctionInterfaceBuilder{constructor(e){this.registration=e}build(e){const t={};for(const s of Object.keys(e)){const r=e[s];if(r){const e=t[r.namespace]||{};t[r.namespace]=e,e[r.name]=this.registration.register(s,r)}}return t}}class observers_ObservationObserverAdaptor_ObservationObserverAdaptor{constructor(e){this.observer=e,this.messageType=p.OBSERVATION}notify(e){this.observer.observe(e)}}class messages_ObservableSubscribeMessage_ObservableSubscribeMessage{constructor(e){this.type=y.OBSERVABLE_SUB,this.payload={observableKey:e}}}class messages_ObservableUnsubscribeMessage_ObservableUnsubscribeMessage{constructor(e){this.type=y.OBSERVABLE_UNSUB,this.payload={observableKey:e}}}class Observables_ObservableRegistration_ObservableRegistration{constructor(e){this.messenger=e,this.dataCache={},this.subscribedObservers=new DictArray_DictArray,this.observersToRemove=new DictArray_DictArray,this.objectFactories={},this.observableToFactoryMap={};const t=new class ObservableFacade{constructor(e){this.observables=e}observe(e){this.observables.observe(e)}}(this);this.observableObserver=new observers_ObservationObserverAdaptor_ObservationObserverAdaptor(t),this.messenger.addObserver(this.observableObserver)}dispose(){for(const e of this.subscribedObservers.keys)this.messenger.send(new messages_ObservableUnsubscribeMessage_ObservableUnsubscribeMessage(e));this.messenger.removeObserver(this.observableObserver)}register(e,t){const s=this;if(t){const s=this.objectFactories[t];if(!s)throw new Error(`${t} factory was not provided for ${e}`);this.observableToFactoryMap[e]=s}return new class Observable{subscribe(t){return s.subscribe(e,t)}waitUntil(t){return s.waitUntil(e,t)}}}applyMiddleware(e,...t){for(const s of t){const t=new s(e);this.objectFactories[t.observableKey]=t}}subscribe(e,t){if("function"==typeof t)return this.subscribeWithCallback(e,t);if(t.onChanged&&"function"==typeof t.onChanged)return this.subscribeWithObserver(e,t);throw Error("The argument provided to subscribe was not a valid observer\nExpected a function or an object with an `onChanged` function")}subscribeWithCallback(e,t){return this.addObserver(e,new class CallbackAdaptor{onChanged(e){t(e)}})}subscribeWithObserver(e,t){return this.addObserver(e,new class ObserverAdaptor{onChanged(e){t.onChanged(e)}})}waitUntil(e,t){if("function"==typeof t)return this.waitWithCallback(e,t);if(t.hasOwnProperty("waitUntil")&&"function"==typeof t.waitUntil)return this.waitWithWaiter(e,t);throw Error("The argument provided to waitUntil was not a valid waiter\nExpected a function or an object with an `waitUntil` function")}waitWithCallback(e,t){class WaiterCallbackAdaptor{constructor(e,t){this.obsIntfBuilder=e,this.res=t}onChanged(s){t(s)&&(this.res(),this.obsIntfBuilder.observersToRemove.add(e,this))}}return new Promise((t=>{this.addObserver(e,new WaiterCallbackAdaptor(this,t))}))}waitWithWaiter(e,t){class WaiterAdaptor{constructor(e,t){this.obsIntfBuilder=e,this.res=t}onChanged(s){t.waitUntil(s)&&(this.res(),this.obsIntfBuilder.observersToRemove.add(e,this))}}return new Promise((t=>{this.addObserver(e,new WaiterAdaptor(this,t))}))}observe(e){const{observableKey:t,observableData:s}=e,r=this.observableToFactoryMap[t];this.dataCache[e.observableKey]=r?r.create(s,this.dataCache[e.observableKey]):s;const i=this.subscribedObservers.getValuesAtKey(t);if(i)for(const t of i)t.onChanged(this.dataCache[e.observableKey]);this.removeDeadObservers(t)}addObserver(e,t){0===this.subscribedObservers.valuesPerKey(e)&&this.messenger.send(new messages_ObservableSubscribeMessage_ObservableSubscribeMessage(e)),this.subscribedObservers.add(e,t);const s=this.dataCache[e];s&&(t.onChanged(s),this.removeDeadObservers(e));const r=this;return new class Cancellable{cancel(){r.removeObserver(e,t)}}}removeObserver(e,t){this.subscribedObservers.remove(e,t),0===this.subscribedObservers.valuesPerKey(e)&&this.messenger.send(new messages_ObservableUnsubscribeMessage_ObservableUnsubscribeMessage(e))}removeDeadObservers(e){const t=this.observersToRemove.getValuesAtKey(e);for(const s of t)this.removeObserver(e,s),this.observersToRemove.remove(e,s)}}class ObservableInterfaceBuilder_ObservableInterfaceBuilder{constructor(e){this.registration=e}build(e){const t={};for(const s of Object.keys(e)){const r=e[s];if(r){const e=t[r.namespace]||{};t[r.namespace]=e,e[r.name]=this.registration.register(s,r.objectFactory)}}return t}}class observers_CollectionUpdateObserverAdaptor_CollectionUpdateObserverAdaptor{constructor(e){this.observer=e,this.messageType=p.COLLECTION_UPDATE}notify(e){this.observer.observe(e)}}class messages_CollectionSubscribeMessage_CollectionSubcribeMessage{constructor(e){this.type=y.COLLECTION_SUB,this.payload={collectionKey:e}}}class messages_CollectionUnsubscribeMessage_CollectionUnsubscribeMessage{constructor(e){this.type=y.COLLECTION_UNSUB,this.payload={collectionKey:e}}}class Collections_CollectionRegistration_CollectionRegistration{constructor(e){this.messenger=e,this.collectionCache={},this.observers=new DictArray_DictArray,this.elementFactories={},this.collectionToElementFactoryMap={};this.collectionUpdateObserver=new observers_CollectionUpdateObserverAdaptor_CollectionUpdateObserverAdaptor(new class CollectionUpdateFacade{constructor(e){this.collectionBuilder=e}observe(e){this.collectionBuilder.observe(e)}}(this)),this.messenger.addObserver(this.collectionUpdateObserver)}dispose(){for(const e of this.observers.keys)this.messenger.send(new messages_CollectionUnsubscribeMessage_CollectionUnsubscribeMessage(e));this.messenger.removeObserver(this.collectionUpdateObserver)}register(e,t){const s=this;if(t){const s=this.elementFactories[t];if(!s)throw new Error(`${t} element factory was not provided for ${e}`);this.collectionToElementFactoryMap[e]=s}return new class Collection{subscribe(t){return s.subscribe(e,t)}}}applyMiddleware(e,...t){for(const s of t){const t=new s(e);this.elementFactories[t.collectionKey]=t}}observe(e){switch(e.operation){case b.ITEM_ADDED:{const{collectionKey:t,collectionIndex:s,item:r}=e;this.onItemAdded(t,s,r);break}case b.ITEM_REMOVED:{const{collectionKey:t,collectionIndex:s}=e;this.onItemRemoved(t,s);break}case b.ITEM_UPDATED:{const{collectionKey:t,collectionIndex:s,item:r}=e;this.onItemUpdated(t,s,r);break}case b.COLL_UPDATED:{const{collectionKey:t}=e;this.onCollectionUpdated(t);break}}}onItemAdded(e,t,s){const r=this.collectionCache[e]||{};this.collectionCache[e]=r;const i=this.collectionToElementFactoryMap[e];r[t]=i?i.create(s):s;const n=this.observers.getValuesAtKey(e);for(const e of n)e.onAdded&&e.onAdded(t,r[t],r)}onItemRemoved(e,t){const s=this.collectionCache[e];if(!s)return;const r=s[t];if(delete s[t],r){const i=this.observers.getValuesAtKey(e);for(const e of i)e.onRemoved&&e.onRemoved(t,r,s)}}onItemUpdated(e,t,s){const r=this.collectionCache[e];if(!r)return;const i=this.collectionToElementFactoryMap[e];i?i.create(s,r[t]):r[t]=s;const n=this.observers.getValuesAtKey(e);for(const e of n)e.onUpdated&&e.onUpdated(t,s,r)}onCollectionUpdated(e){const t=this.collectionCache[e];if(!t)return;const s=this.observers.getValuesAtKey(e);for(const e of s)e.onCollectionUpdated&&e.onCollectionUpdated(t)}subscribe(e,t){0===this.observers.valuesPerKey(e)&&this.messenger.send(new messages_CollectionSubscribeMessage_CollectionSubcribeMessage(e)),this.observers.add(e,t);const s=this.collectionCache[e];if(s){for(const e of Object.keys(s))t.onAdded&&t.onAdded(e,s[e],s);t.onCollectionUpdated&&t.onCollectionUpdated(s)}return{cancel:()=>this.unsubscribe(e,t)}}unsubscribe(e,t){this.observers.remove(e,t),0===this.observers.valuesPerKey(e)&&(this.messenger.send(new messages_CollectionUnsubscribeMessage_CollectionUnsubscribeMessage(e)),delete this.collectionCache[e])}}class CollectionInterfaceBuilder_CollectionInterfaceBuilder{constructor(e){this.registration=e}build(e){const t={};for(const s of Object.keys(e)){const r=e[s];if(r){const e=t[r.namespace]||{};t[r.namespace]=e,e[r.name]=this.registration.register(s,r.elementFactory)}}return t}}var le,ue,de;!function(e){e.DISCONNECT="sdk.client.disconnect",e.ACTION="postmessage.action",e.EVENT_SUB="postmessage.subscribe",e.EVENT_UNSUB="postmessage.unsubscribe",e.OBSERVABLE_SUB="postmessage.observe",e.OBSERVABLE_UNSUB="postmessage.unobserve",e.COLLECTION_SUB="collection.sub",e.COLLECTION_UNSUB="collection.unsub"}(le||(le={}));class messages_DisconnectMessage_DisconnectMessage{constructor(){this.type=le.DISCONNECT,this.payload={}}}class SimplePostMessage_SimplePostMessage{constructor(e,t,s){this.sourceId=e,this.targetId=t,this.target=s,this.messageHandlers=new DictArray_DictArray,this.onMessage=e=>{const{type:t,fromId:s,toId:r}=e.data;if(s!==this.targetId||r!==this.sourceId)return;const i=this.messageHandlers.getValuesAtKey(t);for(const t of i)t(...e.data.payload)},window.addEventListener("message",this.onMessage)}updateTarget(e){this.target=e}facade(){const e=this;return new class PostMessageFacade{dispose(){e.dispose()}on(t,s){e.on(t,s)}off(t,s){e.off(t,s)}send(t,...s){e.send(t,...s)}}}dispose(){window.removeEventListener("message",this.onMessage),this.messageHandlers=new DictArray_DictArray}on(e,t){this.messageHandlers.add(e,t)}off(e,t){this.messageHandlers.remove(e,t)}send(e,...t){this.target.postMessage({toId:this.targetId,fromId:this.sourceId,type:e,payload:t},"*")}}!function(e){e[e.POSTMESSAGE=1]="POSTMESSAGE"}(ue||(ue={}));class Routines_mattertag_inject_InjectRoutine{constructor(){this.clientId=Math.floor(1e6*Math.random()),this.key="mattertag.inject",this.argsDef={argNames:["tagId","html","options"],varArg:!1}}buildMessageData(e,t){return Object.assign(Object.assign({},t),{clientId:this.clientId})}onResponse(e,t){return new Promise((e=>{let s;if(t.messengerType===ue.POSTMESSAGE){const t=t=>{const{toId:r,fromId:i}=t.data;r===this.clientId&&t.data.type===g.RESOLVE&&(s?s.updateTarget(t.source):(s=new SimplePostMessage_SimplePostMessage(this.clientId,i,t.source),e(s.facade())))};window.addEventListener("message",t)}}))}}!function(e){e.map=new Map}(de||(de={}));class Sensor_Sensor_Sensor{constructor(e,t,s,r){this.id=e,this.sensorCalls=t,this.sensorState=s,this.readingCollection=r,this.origin={x:0,y:0,z:0},this.forward={x:0,y:0,z:-1},this.sources=[];this.stateObservingCancellable=s.subscribe(new class SensorObserver{constructor(e){this.sensor=e}onChanged(e){me(this.sensor.origin,e.origin),me(this.sensor.forward,e.forward)}}(this))}dispose(){this.sensorCalls.dispose(this.id),this.stateObservingCancellable.cancel()}get facade(){const e=this;class ObserverAdaptor{constructor(e){this.observer=e}onChanged(){try{this.observerIsCallback(this.observer)?this.observer(t):this.observer.onChanged(t)}catch(e){throw Error("The argument provided to subscribe was not a valid observer\nExpected a function or an object with an `onChanged` function")}}observerIsCallback(e){return!e.onChanged}}class ConditionAdaptor{constructor(e){this.condition=e}waitUntil(){try{return this.conditionIsCallback(this.condition)?this.condition(t):this.condition.waitUntil(t)}catch(e){throw Error("The argument provided to subscribe was not a valid waiter\nExpected a function or an object with an `waitUntil` function")}}conditionIsCallback(e){return!e.waitUntil}}const t={get origin(){return e.origin},get forward(){return e.forward},addSource(...t){e.addSource(...t)},showDebug(t){e.sensorCalls.showDebug(e.id,t)},readings:{subscribe:t=>e.readingCollection.subscribe(new Sensor_CollectionObserverAdaptor(t,e.sources))},dispose(){e.dispose()},subscribe:t=>e.sensorState.subscribe(new ObserverAdaptor(t)),waitUntil:t=>e.sensorState.waitUntil(new ConditionAdaptor(t))};return t}async addSource(...e){this.sources.push(...e);const t=[];for(const s of e){const e=de.map.get(s);if(!e)throw Error(s+" was not a valid source. Sources must be created using createSource");e.id&&t.push(e.id)}this.sensorCalls.addSource(this.id,...t)}}class Sensor_CollectionObserverAdaptor{constructor(e,t){this.observer=e,this.sources=t,this.sourceMap=new Map,this.internalReadingMap=new Map,this.readingMap=new Map}onAdded(e,t){const s=this.sources[this.sourceMap.size];if(s){this.sourceMap.set(e,s);const r=new Sensor_DerivedSensorReading(t);this.internalReadingMap.set(s,r),this.readingMap.set(s,r.facade),this.observer.onAdded&&this.observer.onAdded(s,r.facade,this.readingMap)}}onRemoved(e,t){const s=this.sourceMap.get(e);if(s){const e=this.readingMap.get(s);this.internalReadingMap.delete(s),this.readingMap.delete(s),this.observer.onRemoved&&this.observer.onRemoved(s,e,this.readingMap)}}onUpdated(e,t){const s=this.sourceMap.get(e);if(s){if(this.internalReadingMap.get(s).update(t),this.observer.onUpdated){const e=this.readingMap.get(s);this.observer.onUpdated(s,e,this.readingMap)}}}onCollectionUpdated(){this.observer.onCollectionUpdated&&this.observer.onCollectionUpdated(this.readingMap)}}class Sensor_DerivedSensorReading{constructor(e){this.baseReading=e,this.distanceCache=1/0,this.distanceNeedsUpdate=!0}get facade(){const e=this;return{get inRange(){return e.baseReading.inRange},get inView(){return e.baseReading.inView},get distanceSquared(){return e.baseReading.distanceSquared},get direction(){return e.baseReading.direction},get distance(){return e.distance}}}update(e){this.baseReading.inRange=e.inRange,this.baseReading.inView=e.inView,this.updateDistance(e.distanceSquared),this.updateDirection(e.direction)}updateDirection(e){me(this.baseReading.direction,e)}updateDistance(e){e&&(this.distanceNeedsUpdate=!0,this.baseReading.distanceSquared=e)}get distance(){return this.distanceNeedsUpdate&&(this.distanceNeedsUpdate=!1,this.distanceCache=Math.sqrt(this.baseReading.distanceSquared)),this.distanceCache}}function me(e,t){e.x=t.x,e.y=t.y,e.z=t.z}class Sensor_sensor_create_CreateSensorRoutine{constructor(e){this.key="sensor.create",this.argsDef={argNames:["type"],varArg:!1},this.observableRegistry=e.observableRegister,this.collectionRegistry=e.collectionRegister,this.sensorCalls={addSource:e.functionRegister.register("Sensor.addSource",f),dispose:e.functionRegister.register("sensor.dispose",x),showDebug:e.functionRegister.register("sensor.showDebug",M)}}buildMessageData(e,t){return t}async onResponse(e,t){const s=this.observableRegistry.register(t.sensorId),r=this.collectionRegistry.register(t.sensorId);return new Sensor_Sensor_Sensor(t.sensorId,this.sensorCalls,s,r).facade}}class Sensor_SphereSource_SphereSource{constructor(e,t,s,r){this.id=e,this.updateSourceCall=t,this.userData=s,this.volumeCache={origin:{x:0,y:0,z:0},radius:1/0},this.updateCache(r.origin,r.radius)}get facade(){const e={radius:this.volumeCache.radius,origin:Object.assign({},this.volumeCache.origin)};const t=this,s=new class SphereFacade{get type(){return w.SPHERE}get volume(){return e}get userData(){return t.userData}commit(){t.commit(this)}};return de.map.set(s,this),s}commit(e){this.hasSourceChanged(e)&&(this.updateCache(e.volume.origin,e.volume.radius),this.updateSourceCall(this.id,w.SPHERE,this.volumeCache))}hasSourceChanged(e){return!(this.volumeCache.origin.x===e.volume.origin.x&&this.volumeCache.origin.y===e.volume.origin.y&&this.volumeCache.origin.z===e.volume.origin.z&&this.volumeCache.radius===e.volume.radius)}updateCache(e,t){this.volumeCache.origin.x=e.x,this.volumeCache.origin.y=e.y,this.volumeCache.origin.z=e.z,this.volumeCache.radius=t}}class Sensor_BoxSource_BoxSource{constructor(e,t,s,r){this.id=e,this.updateSourceCall=t,this.userData=s,this.volumeCache={center:{x:0,y:0,z:0},size:{x:1/0,y:1/0,z:1/0},orientation:{yaw:0,pitch:0,roll:0}},this.updateCache(r.center,r.size,r.orientation)}get facade(){const e={center:Object.assign({},this.volumeCache.center),size:Object.assign({},this.volumeCache.size),orientation:Object.assign({},this.volumeCache.orientation)};const t=this,s=new class BoxFacade{get type(){return w.BOX}get volume(){return e}get userData(){return t.userData}commit(){t.commit(this)}};return de.map.set(s,this),s}commit(e){this.hasSourceChanged(e)&&(this.updateCache(e.volume.center,e.volume.size,e.volume.orientation),this.updateSourceCall(this.id,w.BOX,this.volumeCache))}hasSourceChanged(e){return!(this.volumeCache.center.x===e.volume.center.x&&this.volumeCache.center.y===e.volume.center.y&&this.volumeCache.center.z===e.volume.center.z&&this.volumeCache.size.x===e.volume.size.x&&this.volumeCache.size.y===e.volume.size.y&&this.volumeCache.size.z===e.volume.size.z&&this.volumeCache.orientation.yaw===e.volume.orientation.yaw&&this.volumeCache.orientation.pitch===e.volume.orientation.pitch&&this.volumeCache.orientation.roll===e.volume.orientation.roll)}updateCache(e,t,s){re(this.volumeCache.center,e),re(this.volumeCache.size,t),function(e,t,...s){for(const r of s)e[r]=t[r]}(this.volumeCache.orientation,s,"yaw","pitch","roll")}}class Sensor_CylinderSource_CylinderSource{constructor(e,t,s,r){this.id=e,this.updateSourceCall=t,this.userData=s,this.volumeCache={basePoint:{x:0,y:0,z:0},height:1/0,radius:1/0},this.updateCache(r.basePoint,r.height,r.radius)}get facade(){const e={basePoint:Object.assign({},this.volumeCache.basePoint),height:this.volumeCache.height,radius:this.volumeCache.radius};const t=this,s=new class CylinderFacade{get type(){return w.CYLINDER}get volume(){return e}get userData(){return t.userData}commit(){t.commit(this)}};return de.map.set(s,this),s}commit(e){this.hasSourceChanged(e)&&(this.updateCache(e.volume.basePoint,e.volume.height,e.volume.radius),this.updateSourceCall(this.id,w.CYLINDER,this.volumeCache))}hasSourceChanged(e){return!(this.volumeCache.basePoint.x===e.volume.basePoint.x&&this.volumeCache.basePoint.y===e.volume.basePoint.y&&this.volumeCache.basePoint.z===e.volume.basePoint.z&&this.volumeCache.height===e.volume.height&&this.volumeCache.radius===e.volume.radius)}updateCache(e,t,s){re(this.volumeCache.basePoint,e),this.volumeCache.height=t,this.volumeCache.radius=s}}class Sensor_source_create_CreateSourceRoutine{constructor(e){this.userDataMap=new Map,this.key="source.create",this.argsDef={argNames:["type","options"],varArg:!1},this.updateSourceCall=e.functionRegister.register("Sensor.updateSource",C)}buildMessageData(e,t){const s=t.options.hasOwnProperty("userData")?t.options.userData:{};if(!(r=s)||"object"!=typeof r)throw new Error("Error creating Source, userData was provided but not an object");var r;this.userDataMap.set(e,Object.assign({},s));const i=Object.assign({},t.options);return delete i.userData,{type:t.type,options:i}}async onResponse(e,t){const s=this.userDataMap.get(e)||{};return this.userDataMap.delete(e),function(e,t,s){const{sourceId:r,type:i,volume:n}=e;switch(i){case w.SPHERE:return new Sensor_SphereSource_SphereSource(r,t,s,n);case w.BOX:return new Sensor_BoxSource_BoxSource(r,t,s,n);case w.CYLINDER:return new Sensor_CylinderSource_CylinderSource(r,t,s,n)}}(t,this.updateSourceCall,s).facade}}class Room_RoomFactory{create(e,t){const s={x:0,y:0,z:0},r={x:0,y:0,z:0};let i=!0,n=!0;return(t=t||new class RoomElement{constructor(){this.id=e.id,this.floorInfo=Object.assign({},e.floorInfo),this.bounds={max:Object.assign({},e.bounds.max),min:Object.assign({},e.bounds.min)}}get size(){return i&&(i=!1,s.x=this.bounds.max.x-this.bounds.min.x,s.y=this.bounds.max.y-this.bounds.min.y,s.z=this.bounds.max.z-this.bounds.min.z),s}get center(){return n&&(n=!1,r.x=.5*(this.bounds.max.x+this.bounds.min.x),r.y=.5*(this.bounds.max.y+this.bounds.min.y),r.z=.5*(this.bounds.max.z+this.bounds.min.z)),r}}).id=e.id,t.floorInfo=Object.assign({},e.floorInfo),t.bounds.min=Object.assign({},e.bounds.min),t.bounds.max=Object.assign({},e.bounds.max),i=!0,n=!0,t}}class RoomArray_RoomArrayFactory{constructor(){this.roomFactory=new Room_RoomFactory}create(e,t){t=t||{rooms:[]};for(let s=0;s<e.rooms.length;++s)t.rooms[s]=this.roomFactory.create(e.rooms[s],t.rooms[s]);return t.rooms.length=e.rooms.length,t}}function pe(e,t){const s=new t;return class{constructor(){this.observableKey=e}create(e,t){return s.create(e,t)}}}function be(e,t){const s=new t;return class{constructor(){this.collectionKey=e}create(e,t){return s.create(e,t)}}}function ye(e,t){for(const s in e){const r=e[s];if(r){const i=t[s]||{};t[s]=i;for(const i in e[s])ge(s,i,r[i],t)}}}function ge(e,t,s,r){const i=r[e]||{};r[e]=i,i[t]&&console.warn(`clobbering ${t} in the ${e} namespace`),i[t]=s}class builder_SdkBuilder{constructor(e){this.messenger=e.createMessenger(),this.clientRegistration=new ClientHelperRegistration_ClientHelperRegistration,this.functionRegistration=new Functions_FunctionRegistration_FunctionRegistration(this.messenger),this.observableRegistration=new Observables_ObservableRegistration_ObservableRegistration(this.messenger),this.collectionRegistration=new Collections_CollectionRegistration_CollectionRegistration(this.messenger),this.registryMap={functionRegister:this.functionRegistration,observableRegister:this.observableRegistration,collectionRegister:this.collectionRegistration},this.applyMiddleware(),this.clientHelpers=new ClientHelperInterfaceBuilder_ClientHelperInterfaceBuilder(this.clientRegistration),this.enums=new Enums_EnumInterfaceBuilder,this.eventHandler=new InterfaceBuilder_Events_EventInterfaceBuilder(this.messenger),this.functions=new FunctionInterfaceBuilder_FunctionInterfaceBuilder(this.functionRegistration),this.observable=new ObservableInterfaceBuilder_ObservableInterfaceBuilder(this.observableRegistration),this.collections=new CollectionInterfaceBuilder_CollectionInterfaceBuilder(this.collectionRegistration),this.messenger.init()}build(e){const t={},s=this.eventHandler.build();t.on=(e,r)=>(s.on(e,r),t),t.off=(e,r)=>(s.off(e,r),t);const r=[[this.clientHelpers,he(this.registryMap)],[this.enums,e.enums],[this.functions,e.functions],[this.observable,e.observables],[this.collections,e.collections]];for(const[e,s]of r)if(s){ye(e.build(s),t)}return t.disconnect=()=>{t.disconnect=()=>{},this.dispose()},t}dispose(){this.enums.dispose(),this.eventHandler.dispose(),this.collectionRegistration.dispose(),this.functionRegistration.dispose(),this.observableRegistration.dispose(),this.collectionRegistration.dispose(),this.messenger.send(new messages_DisconnectMessage_DisconnectMessage),this.messenger.dispose()}applyMiddleware(){const e=[Routines_mattertag_inject_InjectRoutine,Sensor_sensor_create_CreateSensorRoutine,Sensor_source_create_CreateSourceRoutine],t=[pe("current.room",RoomArray_RoomArrayFactory)],s=[be("collection.room",Room_RoomFactory)];this.functionRegistration.applyMiddleware(this.registryMap,...e),this.observableRegistration.applyMiddleware(this.registryMap,...t),this.collectionRegistration.applyMiddleware(this.registryMap,...s)}}window["sdk-client"]=m})();