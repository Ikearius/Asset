/*! For license information please see showcase.js.LICENSE.txt */
(()=>{var e,t,i,n,s={87207:(e,t,i)=>{"use strict";e.exports=i.p+"images/chrome.png"},75673:(e,t,i)=>{"use strict";e.exports=i.p+"images/edge.png"},68472:(e,t,i)=>{"use strict";e.exports=i.p+"images/firefox.png"},81826:(e,t,i)=>{"use strict";e.exports=i.p+"images/safari.png"},24877:(e,t,i)=>{"use strict";e.exports=i.p+"images/showcase-password-background.jpg"},90831:(e,t,i)=>{"use strict";e.exports=i.p+"images/matterport-logo-light.svg"},8243:(e,t,i)=>{"use strict";function n(){var e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"],e.factory=function(t){return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(t),e.push(i),e}};for(var t=0;t<e.methods.length;t++){var i=e.methods[t];e[i]=e.factory(i)}e.load=function(t,i){var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s),e._loadOptions=i},e.SNIPPET_VERSION="4.1.0"}}i.r(t),i.d(t,{SegmentBootstrap:()=>n})},99612:(e,t,i)=>{"use strict";e.exports=i.p+"images/puck_256_red.png"},408:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAhFBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8g2+bRAAAAK3RSTlMAswpHBJ4d+GmsJHYX2zYTkGDwT4Prp4kPWjvMP6Ms5uFvMJZVfsPSe7i+UNMvaAAAD+NJREFUeNrs2Yd2okAUBuB/CsPM0AXFXrDL+7/fuutKMclmKSLJyfcAOvdyy3DAjx8/umW7u020VZejsx4OzKvBcO0cD8qIrYBpju9r7Er/7JjpP5nrg3FiAt/MmO3JOq1gcNgGGt+DCIxjWsuQWFOKL40y30kbMYn8spUg5MVM2+D47OvNRmEd0k9cx//KuVpdl8Gn3bCd4wsZy8PHocyUv9mxRFAUcHs5D+XeuHy8JVa+i6+BLcz3Izj7gUvxCS6YtZi9/wtHOUbfedb6vWq/RKGHMu55QugrITyPo4wvA8N574eMKfpsaZhvz3y2Eo47KlwWWJFvKFKiDD+yAuYWO8Nj8TsLdLbr7URkl7dFGzOKG6qZjBbkU4tIMp2lwQ4Ww/TBetPL20E4e/OsLI0bwaRPKvFldh/mbLtKywZR74bB7vgY/UbgD5udRqSW0YnZuJn7w4cU7HtVBewh/KG/xG/clQZpxJAux298d374D6s3KXAfev8cclxR11KkBcr6uzzFySnv1QB9oEfl2vQ1rngWfUs54LcyOJT77PVLkUalxedsxn/fAEnLjEDcym1U+sORwEsxpxR+wAHweUyeIp5zXInSZcO0OF5GkNLO3+GK7gzyNMaO4kqXUjBL8CJB8RjrCa5sqchTKWnfUlAsgpjiBTxVPMOe/gmfdOCWguRS7D0XnWOrNLcQnYWfpyB00oy5QbeoX2xCF8BYKtIZJccAuDVIM8RDh5bHNLOaAODhiHRqFPKHKbx20ZmNmddeRAG4Bumc4eJqtyosRHRDnAurLwFgR+QlIhuAZ3TdBklh+vkU4KEiL6JCDiAc5m0wxdOFZt79DID2yQv5GoB97nAbbNKM8gA+IS824QCkmRclnon7ea4lAOGTl/MFgMTJ7yQcT0NJvvs1AKZIDygGwMuPdqZ4EjHLC40D1CI9YVEA+/zheHiKZFUuf4P0hiEAsOxe6Ai0rfT7AwZg3ovyv1NzAMt1tp+WaB0zs2WbAFySnpEcsLMeHUzRsrmZdZgA6J70zp4Wp7TJ0Co3q39CARqTHoopgG2WgSlalAyK9wxvS3pp6wGIsy5YojXL7Lbdt/FfZojiOlwJtERn+y8AoEekt0a6eFt3PLRCr4vxu71af4+UC0Bm85qiBcIpxs9aKdVIhmyaaGGPOR/bQidTFsqoldZixRo4czQ2LsUfNg3dmsw1xQeonk+spmkIi3NggcZIcf4x0sDCYgL/QTBr0bQG4rbejvNcRgBcUpc6hQIViPCkSF1u8T5goRGW/rUFoOueKWYUlVEW1822BkBauRDp+wVIARCjem0/sVGTPTHqbUMB0Fl6s/ZQGz2mNwcKeLUOs9FoRG9qJd0D7Pv2JqhtdE+iDdBtvS+ZjdT+3rqlwHLQbAzk69RMar3/qMBDK7xA1XozYvfzuw3fgHcA31fuwwlFa+ik8vzZc2DfaAyIYWEBSlKRpGgVrX4CAKTJGDinNxcA8+rfK9pV5wvMHPCc+mNApjdDGxCqWvUzPAWr1gdKAIlZdwzo+wBgADWqbb4xnmRcbScaNH+ODkU1h/QmBmCRChYJnij5Rd25LScLBEG4WVjkpKIQxROJ0eTX+P7v91+IswHRnbUquvvdJVWpCM70dA+IRikh/dXJ88cm4CowTEDlGH/KuDTMRdkbzXIDwkvrJIYCsMCfszCUgUK9l3xiJZ5BblD+NZ5AbdAGeQBI80ng00kzOuFlhadQlUYlOX5vyjkEEzFs/qIGEhPn8RzMfFkC7E9nZqZLkC8gyG1qf8XCpAnIEC7ZCkijszAQ3Kfim+wIw2nT0uBAolEAWcyV2yWezJL90jIgpb2ugQc8Aii5/6TG06ljrjYDQaNq7wJ6PGUBRvwl3AtIYv6StOCPwqWyjoG09/03qQEZAD9NtBPcEDCt+Aq4xItY8nXwkyabhvXpzAGoZlbq/wOzYFYBkt7Y+xxVqUQWzv8H/UCktL3EPahStkAW2+b/HveEcaZKQHAW4R/sAijxYkrTEtjiDsmvAuAJ7Ms/xFzxRpUqgY8At9lRmTALoMbLqZklQBZ/j5uIKQlFZr8AmglhRv290m6CBxkQOSEABjIQASNtKGyuhUpAcEbAZgwrGG84g0CQyZM6F5wAe4/BJyzh02Owp83IoLo/A7+ZKWALa9iyEgGFwgi9VI1KLniXwmYvn4AEz7WvgUPzWTf0MlEzcG53BHgsFMyB8HRmhGsoMeZA6OnJYRW5pyekqJOjh+x0pgYmnh7LHnKXeHomJIPvvUJC/RFI6zPQNRFPBpsLZWtcs6JFwIihgNY8wuaCmLF2Yznd9dclVCYgdcQDGzvilBY+b8EtG7xiucDYugJgv+zmOpl/axmcsjrAjicYdZiwemB3Yw6IgUEHxJaEgDbj2KAHhujg0++D2L0RwB0EsZoDCdqoyhhxsrWVZKwe2PTngSFpQ+RSCjLNRBE5fq/XBg4EIF0zgSZ2ULYOlSCLeOTUkYS1SE73/uvbC+U0BH0XTRDfDPnAnI6V+H1WDq5KIE8GD4DfIwKV6ouZPlZbzFwbYoBx44Z7XMA3ELq1CDFfjIQ08RIoUronwHcxBpgEAp8uEU2u16EFwwUcYDUHvhPYXWtgCOw8DQWspvA07ICaGr6ThKaA8HRY/v0neg0TCC6HS4zolGi91AaWs2H42BUVfINqCl8fKC0nZajgprsUmVNAipwegqxBGNHQU3oekw8sHZcAhgiUZHtkdyGcARt3g9AFqVexsDsG3s5GGBDOSwBDBARwHgMfnSQwBEKHk+CFBd8MB+17446MdZgD3/azZqzFftppoCBN8J1dBikSfhrw2zYgZazWrU5CZwTjosZXOw6l9GPq/hAApF7Io/ZSaE5ZsHTjtrB7sA6iaH+aVJIPyt28IvKfvTNoTRgIovCAm4gxEhOwFMHqQYL9/3+wl5mJUyis1EOSb/fW3lyym5l57315TR85ujxURVmwEamW3QvndcSVN8S7mJFoRXZL7wRyuoGdawNjHIckSbPNhrw1R5IkRbfYwSrhbjHWyH/ZJjuRbZCIbzYgaVdQB2VUQq3IEJqBk83J68U3wyJ5v+IUpIHBrGP1gkWhabUZG3ANU0E9EBkPz4zcsX+vz4yDrNfeyxsw2289Pq9UNiB7A8oRKJdgeQ2GQqhjFEKdF0KlFC7NUGmHn5SxL+xApNIUBXYkhh+K7lUdx47Fe+WLYIWRDV0aaxQfixVHE1Qe33p3f9O/KQaJ5AaJWArWWIuM3QlYk9RDX4swm9z+t1v+gjVK1hqbxVplZdDXANUsLaM3xMe12+WP0S4fc6M9NjCh/6qwkZlGi2FsaEo0Ut1RY3Pmk9pQg5Oem8NGZ886KMeGp42g0VLj83YJ9FSAgs1JL1iERmOAISpExSEia8foOC4nrgmyRQUp2c5csSgtB81RYWr+bFBxetPeUIGKdjruVKSmPR3fVKiqo7drKlbX2qQHFaxs/cAhQdHazta+U+HqNi4dqXh9OdsdQf3AgolmH9RPbPyQd2+7jcJAGID/MbY54zSkkIQcSbpq1+//fqvdBJterFRzCEh8l71oizszNrHU3zSJXGjICvjFdElCP3GcfC/cHoeM2cG1ydpbaNCSCdoRS43awqYpgYWGrWHblMBS4/ZM5m690MBFsHf9z++lRm6aiNp8oaGrYOfmpXChsbt4a1ZrocHL5o1gLRcavW1eCmmh4etAoR/uC43fN+9NZ+Wy1rTZ4iW2G3KpS3U277g/ZIeGcGoCEie8wEmQUwMIhy2wwSt7GJAh0ZwGwY5+LpT2CFBxOKifTfCeAB452CiMSm3IgQck788GqOGk1OaeCDE5ONYYUX0kB7HNEtcl3LBUPwQAE+TiusVItldyIRgQ6IeUwVHm29KRIbkoPIzCK8hFKG0r+xmcxc3aKeBAblYRBhetyM0BUKnNEndH9kCIgBwFDINi7r/Bt0foQl3shwj8gxwVO4bBsF1Bjj64/XDnomB0GQPaA1hJrsI3hUGot5BclQzw9PcB0H0MrE8Au5GzMEjQWxKE5OzGgNPaHAE7o6aGEkAJ6uAaoZfoSh0IBSSX7wOg3xioGCAL6kLsEnSU7AR1UUiAVXYA9LD3W8sYhdRN6TE4Y15J3YRRq3j9PXq56qcbgIy6Cj9zCQcy/wypqwzATT9d0dNKtw7THvVwjD2JH5BefKQePAClflqht6Nu3Snk1I+Id4eI4T9YdNjFgvrJW7c7+oj++Fe7mjwagNgEubevI5lsOd8mMqr3Xh5sBA3Aa/ftF0d/dp7qAEAW0oyFGYBA271rECpt10BU0GwVUfvvnyoMRJ710ycAKWimhATwqZ/OEoM5rdt7gbrRLN1Ue/6vTxjQ3m+fB1hJM1Sy9v7v7zEoz6wAMYB90Ox8MICReX4PA9ubLqgSgAc0MwEHksrU/x6DO5lJeDkBOMxqOwwPAE4XM/9OGIFMzfp6M9sMhATgmRpNJUahKt0+FrOYZiJm7eOvrhRGwr50gxQAbxZtEHoAFOnGF8No+FE30hqAXNHkVhJAnerGkWNMK93wAwB8RxPbcQCBrxsrjCz2ba0l5r5iAvYGJrGd6ccY3f6iG+85AJ6HNJEw5wDyd9247PECirQhFIBkQ5PYJACU0AYpOOrfBuc7AGSCXk5kAHA/v7D8reyiDZIAeF7QSxU5ByBJG5cMDoZsg3XMAWyDkF4mDLYAeLyeoPxbbWCk+eMOi17kceOWp3qC8reyVFu/69csgX38+re20gwTYKWvLRF1uMnsfN8aCW35JcM06kpb/mMJ2F3QaMSdPR7f11ZVYzI89r8tgQQAfihpFOWBA4AU335ozDElWegWv8geX30TNDDxJvFXVvi6pZj+n7zuK932684BgGdxSIMJ4+zxXe+/dFs1j9ibP+3d626CMBQAYKGUVkqRdlSNomCQi573f7+xsBFuytAtlsTvbxOS9hzaENpTEUETL6qomPUYPN17s8qrgkNTpE09J5MpaLmUaVDlAcVPZj71vh91vkCLYjqV8jFTCS3KDxcVFxVr4yHrArmLSugraJGpTt3/sg0ktEVJaNW//GliTJLQejOBFSYRtMng5Ye2B5inGDrUQbh1s4NocDBGHQKKnDq8rjgo6IhPukX/h3XeQ0++QavGKNkeEizw8bIz02E/YAJ5dqNvK7TJoWd/1vreyx0m0MexOFrd0Vq5tu2UbNtd9RqPAnPoI1iPhe+eLc1hCNljhuxfbRHCewJDcqrjqz/A8yO4gfArTulHeHStVsTdY/hBU3zlBG6IfG8xI2GiYASRKuKlSEkCI1QygxuOOizkc/gT3Edaz3t3ONQg8BRiUM0K901l7pih4CHKYDtdV/yJHJFkEiaQWSJmHvk+GxU4i2FEnOECvf4j//9YDhJsg5dZzmMlSUmqmOfZEm+YQM5cZ7u3t7n6BCyj3BOxzBQ1AAAAAElFTkSuQmCC"},89992:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAyMzAuMDUgNDkuNzUiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6I2Y1ZjRmM30uc3Qye2ZpbGw6I2ZmZn0uc3Qze2ZpbGw6Izk5OX08L3N0eWxlPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik02MS4yOCAzNi4xNHYtOC44MmwtLjI0LTUuMDkuMTktLjA0IDIuMDUgNC41NCA0LjgyIDguODYgNC44Mi04Ljg2IDIuMDYtNC41NC4xOC4wNC0uMjQgNS4wOXY4LjgyaDUuMTRWMTQuNGgtNS44MWwtNi4xMSAxMS43N2gtLjA3TDYxLjk1IDE0LjRoLTUuODF2MjEuNzR6TTIxMi42OSAzMC42M2MwIDMuNiAxLjk0IDUuNSA1LjYxIDUuNWgzLjE3di00LjQ1aC0zLjQ1di05LjQ5aDMuNzR2LTQuMzZoLTQuMTV2LTQuMjFoLTQuOTF2MTcuMDF6TTIxMS4yNiAxNy44M2gtLjg3Yy0zLjAxIDAtNC40NCAyLjAzLTQuODkgMy40M2gtLjE4di0zLjQzSDIwMHYxOC4zMWg1LjMyVjI1LjcyYzAtMS4wOC40MS0xLjg0LjkzLTIuMzMuODktLjg2IDIuNzktMS4xMSA1LjAxLTEuMTF2LTQuNDV6TTE1OC42MyAxNy44M2gtLjg3Yy0zLjAxIDAtNC40NCAyLjAzLTQuODkgMy40M2gtLjE4di0zLjQzaC01LjMydjE4LjMxaDUuMzJWMjUuNzJjMC0xLjA4LjQxLTEuODQuOTMtMi4zMy44OS0uODYgMi43OS0xLjExIDUuMDEtMS4xMXYtNC40NXpNMTI3LjQ4IDI3LjI1YzAtNS45NyAzLjE3LTkuODYgOC44NS05Ljg2IDYuMjYgMCA4Ljc4IDQuNTMgOC43OCA5LjY0djEuNThoLTEyLjEydi4xOGMwIDIuMTIgMS4xNCAzLjYgNC4xNyAzLjYgMi4yMyAwIDMuNDUtMS4wNCA0LjY0LTIuMjdsMi42NiAzLjMxYy0xLjY5IDEuOTQtNC40NiAzLjEzLTcuOTEgMy4xMy01LjguMDEtOS4wNy0zLjI3LTkuMDctOS4zMXptNS41LTIuMDV2LjI5aDYuNjJ2LS4zMmMwLTIuMy0xLjA0LTMuODUtMy4xNy0zLjg1cy0zLjQ1IDEuNTQtMy40NSAzLjg4ek0xODAuMDQgMjcuMjVjMC02LjA4IDMuMzEtOS44NiA4Ljg1LTkuODYgNS41NCAwIDguODUgMy43OCA4Ljg1IDkuODZzLTMuMzEgOS4zMi04Ljg1IDkuMzJjLTUuNTUgMC04Ljg1LTMuMjQtOC44NS05LjMyem0xMi4xNSAxLjM3di0zLjI3YzAtMi4zNy0xLjIyLTMuNzQtMy4zMS0zLjc0cy0zLjMxIDEuMzctMy4zMSAzLjc0djMuMjdjMCAyLjM3IDEuMjIgMy43NCAzLjMxIDMuNzRzMy4zMS0xLjM3IDMuMzEtMy43NHpNMTIyLjQyIDEzLjYyaC00Ljc4djIuMTljMCAxLjMtLjQzIDIuMDEtMS44NyAyLjAxaC0xLjMzdjQuMzZoMi42NnY4LjQ0YzAgMy42IDEuOTQgNS41IDUuNjEgNS41aDMuMTd2LTQuNDVoLTMuNDV2LTkuNDloMy43NHYtNC4zNmgtMy43NHYtNC4yek0xMDkuMTcgMTMuNjJoLTQuNzh2Mi4xOWMwIDEuMy0uNDMgMi4wMS0xLjg3IDIuMDFoLTEuMzN2NC4zNmgyLjY2djguNDRjMCAzLjYgMS45NCA1LjUgNS42MSA1LjVoMy4xN3YtNC40NWgtMy40NXYtOS40OWgzLjc0di00LjM2aC0zLjc0di00LjJ6TTE3MC45IDE3LjM5Yy0yLjQ1IDAtNC41MyAxLjUxLTUuMDcgMy42aC0uMTh2LTMuMTdoLTUuMzJ2MjMuODJoNS4zMnYtOC42N2guMThjLjU0IDIuMDUgMi42MyAzLjYgNS4wNyAzLjYgNC43OCAwIDcuMjctMi45MSA3LjI3LTkuMzItLjAxLTYuNC0yLjQ5LTkuODYtNy4yNy05Ljg2em0xLjcyIDExLjUyYzAgMi4zNy0xLjQ4IDMuMzUtMy40OSAzLjM1LTIuMDEgMC0zLjQ5LTEuMDQtMy40OS0yLjc3di01YzAtMS43MyAxLjQ4LTIuNzcgMy40OS0yLjc3IDIuMDEgMCAzLjQ5IDEuNTUgMy40OSAzLjkydjMuMjd6TTk3LjgzIDM2LjE0Yy0xLjkxIDAtMy4yNy0xLjMtMy42LTMuMzFoLS4yMmMtLjU4IDIuNDUtMi42NiAzLjc0LTUuNTQgMy43NC0zLjc4IDAtNS44Ni0yLjIzLTUuODYtNS41IDAtMy45OSAzLjA5LTUuOSA4LjA5LTUuOWgyLjk5di0uNjFjMC0xLjgzLS45LTIuOTktMy4xMy0yLjk5LTIuMTIgMC0zLjI0IDEuMDgtNC4wNiAyLjIzbC0zLjE3LTIuODFjMS41MS0yLjIzIDMuNjctMy42IDcuNjMtMy42IDUuMzIgMCA4LjA2IDIuNDUgOC4wNiA2LjkxdjcuMzhoMS43NnY0LjQ1aC0yLjk1em0tNC4xMy01Ljcydi0yLjIzaC0yLjU5Yy0yLjA1IDAtMy4xMy43Ni0zLjEzIDIuMTJ2LjU0YzAgMS4zNy45IDIuMDEgMi40OCAyLjAxIDEuNzYgMCAzLjI0LS43MiAzLjI0LTIuNDR6Ii8+PGc+PHBhdGggZD0iTTM5LjA1IDYuOTFMMjYuMjQgMTAuNSAxMy40MiA2LjkxIDguMyA4LjM1djMzLjA2bDUuMTMgMS40NCAxMi44Mi0zLjU5IDEyLjgyIDMuNTkgNS4xMy0xLjQ0VjguMzVsLTUuMTUtMS40NHptLTUuMTIgMjQuNjdsLTcuNjktMi4xNS03LjY5IDIuMTV2LTEzLjRsNy42OSAyLjE1IDcuNjktMi4xNXYxMy40eiIgZmlsbD0iI2I3YmFiYiIvPjxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik0yNi4yNCAxMy4zN3Y2Ljk2bC0xMi44Mi0zLjU5djI2LjFMOC4zIDQxLjQxVjguMzV6TTMzLjkzIDM0LjQ1bC03LjY5LTIuMTZ2Ni45NmwxMi44MSAzLjU5di0yNi4xbC01LjEyIDEuNDR6Ii8+PGc+PHBhdGggY2xhc3M9InN0MyIgZD0iTTM5LjA1IDYuOTFsNS4xMyAxLjQ0LTE3Ljk0IDUuMDJMOC4zIDguMzVsNS4xMi0xLjQ0IDEyLjgyIDMuNTl6TTI2LjI0IDI5LjQybDcuNjkgMi4xNnYyLjg3bC03LjY5LTIuMTYtNy42OSAyLjE2di0yLjg3eiIvPjwvZz48L2c+PC9zdmc+"},31896:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODQiIGhlaWdodD0iODQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNNDIgMEMxOC43OSAwIDAgMTguNzkgMCA0MnMxOC43OSA0MiA0MiA0MiA0Mi0xOC43OSA0Mi00MlM2NS4yMSAwIDQyIDB6IiBmaWxsLW9wYWNpdHk9Ii4yNSIgZmlsbD0iIzAwMCIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTUxLjUgNTdoLTJhLjUuNSAwIDAxLS41LS41di0yOGEuNS41IDAgMDEuNS0uNWgyYS41LjUgMCAwMS41LjV2MjhhLjUuNSAwIDAxLS41LjV6TTM0LjUgNTdoLTJhLjUuNSAwIDAxLS41LS41di0yOGEuNS41IDAgMDEuNS0uNWgyYS41LjUgMCAwMS41LjV2MjhhLjUuNSAwIDAxLS41LjV6IiBmaWxsPSIjRkZGIi8+PC9nPjwvc3ZnPg=="},78899:(e,t,i)=>{"use strict";e.exports=i.p+"images/escape.png"},7560:(e,t,i)=>{"use strict";e.exports=i.p+"images/headset-cardboard.png"},49529:(e,t,i)=>{"use strict";e.exports=i.p+"images/headset-quest-2.png"},74394:(e,t,i)=>{"use strict";e.exports=i.p+"images/disappointed-1f627-1.svg"},51922:(e,t,i)=>{"use strict";e.exports=i.p+"images/frown-1f641-1.svg"},26684:(e,t,i)=>{"use strict";e.exports=i.p+"images/neutral-1f610-1.svg"},48670:(e,t,i)=>{"use strict";e.exports=i.p+"images/smile-simple-1f642-1.svg"},78347:(e,t,i)=>{"use strict";e.exports=i.p+"images/smile-wide-1f604-1.svg"},31891:(e,t,i)=>{"use strict";e.exports=i.p+"images/Desktop-help-play-button.svg"},71002:(e,t,i)=>{"use strict";e.exports=i.p+"images/Desktop-help-spacebar.png"},14653:(e,t,i)=>{"use strict";e.exports=i.p+"images/mattertag-disc-128-free.v1.png"},94874:(e,t,i)=>{"use strict";e.exports=i.p+"images/mobile-help-play-button.svg"},86533:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_360.png"},70626:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_click_inside.png"},72145:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_drag.png"},12742:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_drag_two_finger.png"},5435:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_pinch.png"},67649:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_position.png"},2433:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_position_two_finger.png"},24367:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_tap.png"},64549:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_inside_key.png"},76064:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_keyboard_all.png"},81202:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_keyboard_left_right.png"},42135:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_keyboard_up_down.png"},41891:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_click.png"},73993:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_drag_left.png"},26668:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_drag_right.png"},82906:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_position_left.png"},64991:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_position_right.png"},12136:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_zoom.png"},90619:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_tap_inside.png"},26407:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_zoom_keys.png"},85034:e=>{"use strict";e.exports=JSON.parse('{"v":"4.8.0","meta":{"g":"LottieFiles AE 1.0.0","a":"","k":"","d":"","tc":""},"fr":60,"ip":0,"op":93,"w":500,"h":500,"nm":"Frame 1","ddd":0,"assets":[{"id":"comp_0","layers":[{"ddd":0,"ind":1,"ty":4,"nm":"Rectangle 803","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[312,426.911,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,-5.799],[-5.799,0],[0,0],[0,5.799]],"o":[[-5.799,0],[0,5.799],[0,0],[5.799,0],[0,0]],"v":[[-12.5,-10.5],[-23,0],[-12.5,10.5],[12.5,10.5],[23,0]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0.933333337307,0.584313750267,0.278431385756,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":6,"ix":5},"lc":2,"lj":1,"ml":4,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[300,300],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Rectangle 803","np":2,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":300,"st":0,"bm":0},{"ddd":0,"ind":2,"ty":4,"nm":"Rectangle 800","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[313.5,363.911,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,-5.799],[-5.799,0],[0,0],[0,5.799]],"o":[[-5.799,0],[0,5.799],[0,0],[5.799,0],[0,0]],"v":[[-16,-10.5],[-26.5,0],[-16,10.5],[16,10.5],[26.5,0]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0.933333337307,0.584313750267,0.278431385756,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":6,"ix":5},"lc":2,"lj":1,"ml":4,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[300,300],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Rectangle 800","np":2,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":300,"st":0,"bm":0},{"ddd":0,"ind":3,"ty":4,"nm":"Rectangle 802","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[319.5,300.911,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,-5.799],[-5.799,0],[0,0],[0,5.799]],"o":[[-5.799,0],[0,5.799],[0,0],[5.799,0],[0,0]],"v":[[-19,-10.5],[-29.5,0],[-19,10.5],[19,10.5],[29.5,0]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0.933333337307,0.584313750267,0.278431385756,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":6,"ix":5},"lc":2,"lj":1,"ml":4,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[300,300],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Rectangle 802","np":2,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":300,"st":0,"bm":0},{"ddd":0,"ind":4,"ty":4,"nm":"Rectangle 798","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[316.5,234.911,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[0,-6.351],[-6.904,0],[0,0],[0,6.351]],"o":[[0,0],[-6.904,0],[0,6.351],[0,0],[6.904,0],[0,0]],"v":[[5,-11.5],[-19,-11.5],[-31.5,0],[-19,11.5],[19,11.5],[31.5,0]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0.933333337307,0.584313750267,0.278431385756,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":6,"ix":5},"lc":2,"lj":1,"ml":4,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[300,300],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Rectangle 798","np":2,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":300,"st":0,"bm":0},{"ddd":0,"ind":5,"ty":4,"nm":"Vector 4","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[210,314.049,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0.167,2.667],[0,0],[-5.167,1],[-21.951,2.89],[-10.277,-0.4],[0,-6.5],[3.5,-1.333],[0,-9.6],[4.333,0.333],[0.4,-10],[5,0.5],[0,-9.2],[3.667,-0.5],[9.6,0],[8,0]],"o":[[0,0],[0,-8],[10.55,-3.332],[10.992,-1.447],[38.5,1.5],[0,5.2],[3,-0.167],[0,9.6],[3,-0.667],[-0.4,10],[3.667,-0.667],[0,9.2],[-25.667,0],[-12,0],[-8,0]],"v":[[-70,34.621],[-70,-23.879],[-54.5,-36.879],[-6,-50.38],[31.5,-50.379],[70,-25.879],[59.5,-15.379],[68.5,-3.879],[55.5,7.121],[64,17.621],[48.5,28.621],[59.5,38.121],[48.5,51.121],[-40.5,51.121],[-59.5,42.621]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"fl","c":{"a":0,"k":[1,0.858823537827,0.368627458811,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[300,300],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Vector 4","np":2,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":300,"st":0,"bm":0}]}],"layers":[{"ddd":0,"ind":1,"ty":4,"nm":"Thumb","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":0,"s":[0]},{"t":8,"s":[100]}],"ix":11},"r":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":0,"s":[21.02]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":20,"s":[2.07]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":25,"s":[-7.441]},{"t":38,"s":[0]}],"ix":10},"p":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":0,"s":[72.288,256.574,0],"to":[42.483,-20.605,0],"ti":[-34.63,-24.078,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":20,"s":[201.942,269.429,0],"to":[0.997,0.693,0],"ti":[0.616,4.175,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":25,"s":[210.787,258.416,0],"to":[-0.4,-2.71,0],"ti":[-0.624,-0.507,0]},{"t":38,"s":[201.288,256.074,0]}],"ix":2},"a":{"a":0,"k":[0,81.318,0],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"t":0,"s":[27.195,27.195,100]},{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"t":20,"s":[37.336,37.336,100]},{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"t":25,"s":[54.207,54.207,100]},{"t":38,"s":[43.041,43.041,100]}],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[5,-24.5],[5.001,-15],[-19.5,3.5],[6,3],[-0.5,6],[3.5,19.5],[5.833,-1.167],[1.6,-4]],"o":[[-4,19.6],[-5.001,15],[19.5,-3.5],[-6,-3],[0.5,-6],[-2.8,-15.6],[-1.333,0.167],[-2,5]],"v":[[-3.263,-9.554],[-30.763,21.446],[6.237,52.446],[29.737,1.946],[23.237,-9.554],[27.237,-36.554],[6.237,-52.554],[0.237,-47.054]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"fl","c":{"a":0,"k":[1,0.858823537827,0.368627458811,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[-12,70],"ix":2},"a":{"a":0,"k":[-4,23.333],"ix":1},"s":{"a":0,"k":[300,300],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Vector 5","np":2,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":300,"st":0,"bm":0},{"ddd":0,"ind":2,"ty":0,"nm":"hand","refId":"comp_0","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":0,"s":[0]},{"t":8,"s":[100]}],"ix":11},"r":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":0,"s":[-24.14]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":20,"s":[11.815]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":25,"s":[-4.193]},{"t":38,"s":[0]}],"ix":10},"p":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":0,"s":[99.5,244,0],"to":[70.127,-43.953,0],"ti":[-16.952,-23.296,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":20,"s":[253.934,268.034,0],"to":[0.943,1.296,0],"ti":[1.495,5.775,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":25,"s":[252.455,241.42,0],"to":[-0.98,-3.785,0],"ti":[-0.32,-0.851,0]},{"t":38,"s":[250,250,0]}],"ix":2},"a":{"a":0,"k":[210,233.5,0],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"t":0,"s":[27.195,27.195,100]},{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"t":20,"s":[37.336,37.336,100]},{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"t":25,"s":[42.744,42.744,100]},{"t":38,"s":[43.041,43.041,100]}],"ix":6}},"ao":0,"w":420,"h":467,"ip":0,"op":300,"st":0,"bm":0},{"ddd":0,"ind":3,"ty":4,"nm":"Circle","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":21,"s":[0]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":22,"s":[100]},{"t":41,"s":[0]}],"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[259,259,0],"ix":2},"a":{"a":0,"k":[-18.087,21.101,0],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"t":22,"s":[14.814,14.814,100]},{"t":41,"s":[103.398,103.398,100]}],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":0,"k":[165,165],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse","hd":false},{"ty":"st","c":{"a":0,"k":[0.933333396912,0.584313750267,0.278431385756,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":22,"s":[10]},{"t":41,"s":[40]}],"ix":5},"lc":1,"lj":1,"ml":4,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[-27.498,35.069],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[175.383,175.383],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":300,"st":0,"bm":0}],"markers":[]}')},64824:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDMwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik04MCAyMTEuMzA0VjE1Mi44MDRDODAgMTQ0LjgwNCA5MC4zMzMzIDE0MC44MDQgOTUuNSAxMzkuODA0QzEwNi4wNSAxMzYuNDczIDEyMi4wNDkgMTI5LjE5NCAxNDQgMTI2LjMwNEMxNTQuOTkyIDEyNC44NTYgMTcxLjIyMyAxMjUuOTA0IDE4MS41IDEyNi4zMDRDMjIwIDEyNy44MDQgMjIwIDE0NC4zMDQgMjIwIDE1MC44MDRDMjIwIDE1Ni4wMDQgMjEzIDE1OS45NzEgMjA5LjUgMTYxLjMwNEMyMTIuNSAxNjEuMTM4IDIxOC41IDE2My4yMDQgMjE4LjUgMTcyLjgwNEMyMTguNSAxODAuNzA1IDIxMi42MyAxODMuMjc4IDIwOC4xMzYgMTgzLjc1NUMyMTEuMDQ2IDE4NC4yNjUgMjE0LjMgMTg2Ljc5MiAyMTQgMTk0LjMwNEMyMTMuNjg2IDIwMi4xNTggMjA3LjM4OCAyMDQuNzY5IDIwMi4yNzcgMjA1LjI4NkMyMDUuNzUzIDIwNS44NTkgMjA5LjUgMjA4LjIyOCAyMDkuNSAyMTQuODA0QzIwOS41IDIyNC4wMDQgMjAyLjE2NyAyMjcuMzA0IDE5OC41IDIyNy44MDRIMTA5LjVDOTcuNSAyMjcuODA0IDk4LjUgMjE5LjMwNCA5MC41IDIxOS4zMDRDODIuNSAyMTkuMzA0IDgwLjE2NjcgMjEzLjk3MSA4MCAyMTEuMzA0WiIgZmlsbD0iI0ZGREI1RSIvPgo8cGF0aCBkPSJNMTE0LjQ5OSAxMTUuMzA0QzExMC40OTkgMTM0LjkwNCA5Mi4wMDEzIDEzMS4zMDQgODcgMTQ2LjMwNEM4MS45OTg2IDE2MS4zMDQgMTA0LjQ5OSAxODAuODA0IDEyMy45OTkgMTc3LjMwNEMxNDMuNDk5IDE3My44MDQgMTUzLjQ5OSAxMjkuODA0IDE0Ny40OTkgMTI2LjgwNEMxNDEuNDk5IDEyMy44MDQgMTQwLjQ5OSAxMjEuMzA0IDE0MC45OTkgMTE1LjMwNEMxNDEuNDk5IDEwOS4zMDQgMTQ4LjQ5OSAxMDcuODA0IDE0NC45OTkgODguMzAzOEMxNDIuMTk5IDcyLjcwMzggMTI5LjgzMyA3MS4xMzcxIDEyMy45OTkgNzIuMzAzOEMxMjIuNjY2IDcyLjQ3MDUgMTE5LjU5OSA3My44MDM4IDExNy45OTkgNzcuODAzOEMxMTUuOTk5IDgyLjgwMzggMTE5LjQ5OSA5MC44MDM4IDExNC40OTkgMTE1LjMwNFoiIGZpbGw9IiNGRkRCNUUiLz4KPHBhdGggZD0iTTIxNyAxNTAuMzA0QzIxNyAxNTYuNjU1IDIxMS40MDQgMTYxLjgwNCAyMDQuNSAxNjEuODA0SDE2Ni41QzE1OS41OTYgMTYxLjgwNCAxNTQgMTU2LjY1NSAxNTQgMTUwLjMwNEMxNTQgMTQzLjk1MiAxNTkuNTk2IDEzOC44MDQgMTY2LjUgMTM4LjgwNEgxOTAuNSIgc3Ryb2tlPSIjRUU5NTQ3IiBzdHJva2Utd2lkdGg9IjYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8cGF0aCBkPSJNMjE2IDE3Mi4zMDRDMjE2IDE3OC4xMDMgMjExLjI5OSAxODIuODA0IDIwNS41IDE4Mi44MDRIMTY3LjVDMTYxLjcwMSAxODIuODA0IDE1NyAxNzguMTAzIDE1NyAxNzIuMzA0QzE1NyAxNjYuNTA1IDE2MS43MDEgMTYxLjgwNCAxNjcuNSAxNjEuODA0IiBzdHJva2U9IiNFRTk1NDciIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CjxwYXRoIGQ9Ik0yMTEgMTkzLjMwNEMyMTEgMTk5LjEwMyAyMDYuMjk5IDIwMy44MDQgMjAwLjUgMjAzLjgwNEgxNjguNUMxNjIuNzAxIDIwMy44MDQgMTU4IDE5OS4xMDMgMTU4IDE5My4zMDRDMTU4IDE4Ny41MDUgMTYyLjcwMSAxODIuODA0IDE2OC41IDE4Mi44MDQiIHN0cm9rZT0iI0VFOTU0NyIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPHBhdGggZD0iTTIwNyAyMTQuMzA0QzIwNyAyMjAuMTAzIDIwMi4yOTkgMjI0LjgwNCAxOTYuNSAyMjQuODA0SDE3MS41QzE2NS43MDEgMjI0LjgwNCAxNjEgMjIwLjEwMyAxNjEgMjE0LjMwNEMxNjEgMjA4LjUwNSAxNjUuNzAxIDIwMy44MDQgMTcxLjUgMjAzLjgwNCIgc3Ryb2tlPSIjRUU5NTQ3IiBzdHJva2Utd2lkdGg9IjYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8L3N2Zz4K"},2116:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r,A:()=>o});var n=i(26605),s=i(85861);function r(e){if(!e.prototype||!e.prototype.render)return e.__scuWrap||(e.__scuWrap=a(e,h));e.prototype.shouldComponentUpdate=l}function o(e){if(!e.prototype||!e.prototype.render)return e.__scuWrap||(e.__scuWrap=a(e,s.NK));e.prototype.shouldComponentUpdate=c}function a(e,t){class Wrap extends Wrapper{}return Wrap.prototype.renderChild=e,Wrap.prototype.diffFunc=t,Wrap}class Wrapper extends n.Component{shouldComponentUpdate(e){return this.diffFunc(e,this.props)}render(e,t,i){return this.renderChild(e,i)}}function l(e,t){return h(e,this.props)||h(t,this.state)}function c(e,t){return h(e,this.props)||(0,s.NK)(t,this.state)}function h(e,t){for(let i in e)if(e[i]!==t[i])return!0;for(let i in t)if(!(i in e))return!0;return!1}},91975:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAJ1BMVEUAAAD///////////////////////////////////////////////+uPUo5AAAADHRSTlMA4ZNBI+fLwLSGYE5aqgIgAAAAlUlEQVQoz2MAAy91mYNFSxjgwEjmDBAcVIbxPWPOgMHRKRA+c88ZKDhhABbYdgYOssEKchACx0BKPM4ggRagwBxkgZNAHTHIAkcNGJjOoAAFBkdUARGGNagCpxh0UAUOMdSgChxnkEEVOMhwBg1gCGBowTAUw1oMh2E4HcNzGN5HDyCMIMQIZPRowIgozKjEjGyM5AAACSg5ooJJElsAAAAASUVORK5CYII="},40886:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAPFBMVEUAAAD/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/////+fr/5er/0tv/ytX/iaH/dJL/cpA84uD/AAAAC3RSTlMA45NBI8vAtIZgTrS8MGcAAAC5SURBVDjLhVPtDoQgDBuICPKpvP+7Xs4t6LlL2j9GWtYCG91w0XqTkvE2OtJYrEkTxi4v2gWhpyS4n+1bUtgeRfY1/cG6z/3Ma8Ui/rP+6LWU2sd04RxBfs+WBe2UpXAZSP4jP3DIWb4m9ua1whI5w/XzC+xiHEWWtreg8XoUh5EVhnj469u1oF+EJ45QtaByCGKrogWFGSiAFjAkPCa8KHjV6LHgc6OGgS2Hmha2PR4cPHp4eOH4fwAGdiPh+RS0GAAAAABJRU5ErkJggg=="},71370:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAIBAMAAABqq+CcAAAAD1BMVEUAAAD///////////////+PQt5oAAAABHRSTlMAy4AzqjrmZgAAABRJREFUCNdjAAMjERcXR2Uwc4AEAIn2CZHn9cAcAAAAAElFTkSuQmCC"},88296:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAIBAMAAABqq+CcAAAAGFBMVEUAAAD/AVL/AVL/AVL/////AVL/r7//OWiicYg+AAAABHRSTlMAy4AzqjrmZgAAABlJREFUCNdjYGBgVgwtcwGC9FAhAyB3YAQAVg4X6a0jaXAAAAAASUVORK5CYII="},92759:(e,t,i)=>{"use strict";e.exports=i.p+"images/login-screen-background.jpg"},64366:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagbg.png"},78947:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagmask.png"},28636:(e,t,i)=>{"use strict";e.exports=i.p+"images/NoteColor.png"},27314:(e,t,i)=>{"use strict";e.exports=i.p+"images/NoteIcon.png"},30749:(e,t,i)=>{"use strict";e.exports=i.p+"images/pinAnchor.png"},48072:(e,t,i)=>{"use strict";e.exports=i.p+"images/360_placement_pin_mask.png"},68444:(e,t,i)=>{"use strict";e.exports=i.p+"images/exterior.png"},85089:(e,t,i)=>{"use strict";e.exports=i.p+"images/exterior_hover.png"},45545:(e,t,i)=>{"use strict";e.exports=i.p+"images/interior.png"},64293:(e,t,i)=>{"use strict";e.exports=i.p+"images/interior_hover.png"},29480:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAP1BMVEUAAAD///////////////////////////////////////////////////////////////////////////////9Du/pqAAAAFXRSTlMAmYWNk1l7bCJCEQpjKHQ0GE9HHToMZFdDAAAHfklEQVR42uzcC3LcIAwAUAnxMT//73/WTmcnnWw7za6xMMLJO0HsCEkI1vDjx49rhbz7xaTRKkWkETWRUnZMZvF7DnBjIa9pVPiCGtN6v/cw72YkPIBGs89wD8PqCIuQWwfoW/BO4yna+W7XQzYKWSiToTvZEDKivt7BZgjZkdmgC9FbrMT6CNINSWNFOsmuC5PF6uwEUnmFl1AeBIoL4WVoEZcMFsJL0QKSrISXoxWk2AmboB0kGCw2Y9sXxZCwqRSgqVVjY3qFdjaLAtgNGllQiAVaGBSKoRokQ9989X+mPVwrOhTGRfjSfcP/rWVw6/B/vQxuH/6vlsH9w//LZfAtwv+6ZWBQOANVJRQvQUVi099nDmqJIvY+r9kIVQTB6f+ZClDB3M3zI6oZ2A2EHaEBmGXR5f9fOgOrobPnR9QDMJq7iv8Hmr9j/q9TC2KXz4+oIvCwWIUmZUfnRqtIYxVWZv+rnPE5RHgSQ/bGKUQU1xUn5GPNtMGXtslYWTsjg0yUmSK8JU5Gidkde+Sg3RTgkDA5jRy8gAbI+lh43ax5Q8RQANUyQ7F5UW2LocOTxgwn5bFhKVjxHDcAg8HhOWujBJA2YLIl9jRQPwGkGRjNqUEacKIu7wz26jTgsRh5qMDTpd3AoMVdXArpyjSgsJDKUE0u/6vgoEXo0ZS56B7RhmVogsomwjLbFTMQO0N1s71gOrKKDP8PpnpDGDQW0BNcZCr7+wK8K8k4jOE+pkrwpkHKcRz3QeUA77FiDmT/L6h6eXDH48YIF4sjHrfDO0jSpQzezRrBG9ZOnr/oDaxVAmCERsYaIbCUjBsaiYp/SxBJev4/VwsocgcAzdDQTNwhQNcMHNtdXSHmOVjzn3JPvNMxJXP/x7k3VJyv04IAljFobU8J8MNMbP+1obcE8DCxbQpTdwngwTDNBaI+mE3EUHiEjjw1UNCnjTJPJbRyfplR9yaX5TgLIFHfOAuER2wMqUTYp2w8Q/qm7lqg4vVL5xNJ+493/GU4ncBNtxmwIA+asytARA/8bD65BnLnAXAwBPK5FSDy04bbuTWg5I/BX3Fn+vjQdQkoKAQBnvkezgFeGU80cq7PXdCzfGIZ6y63wScSmYYng/jvNr1lKU5ka99N0Ie5+JzUdbwN+syWJgHqdh9cXMyoMHS0uO+5fhZ12VLeu+8CP7iy+zKmu7MAhjMCU9ZCiRoF/iuUNbR0hy7oQZVkwdDhadD/mJJgzrdJAYeSQC7pA0UXwd9iSS+Y7tEGPtiCwd54nxQAYArKgLpPCgCYCipa59PQ4tloQRWEDiAerYMZb9MGHVvQGR52vMlO6MEd3g55vFEROFIGPDwseIthyPGhyPLnlXU/EP/F3pkjAQzCMBDGDBXh/8/NpMmQUunslZ/gHPiQljMu+YVevUgvrB5q6y0Ey3QCWjewz3OjTBkgFAJTTcBoKWIIZY2WgGgpItQERKlC8McDjULTgCemmoCRXhjwja3+03qpVkBpBpwAfwL+CfoYdCHkUrjNDm+G8O0wfiCCH4nhh6L4sTh+MYJfjeGXo/j1uAUSeIkMXiSFl8nhhZJ4qSxeLG25PN4wgbfM4E1TeNucjZN46yzePI23zxuggEdo4CEqeIyOQUp4lBYepmacHh6oiEdqGqqKx+riwcpGa+Ph6ni8vi9YwF+xcbN3pzkOwjAUgJ9DFrLQQLn/XUfzZzSbWjBOa5bvBBEimx3pXSErp4/ZuYKWTh+1dYWtnT5u7/SBi1fk5hW6evrY3St4+fTR21f4+unj95EsMdiKF6m88SV8WboV6rwbOmK5YwVPLH5EcyN3bCtbzTxdRWO1I5559XsrldPAEdPEqDTzmAHNDPxRcSoNXCWhiVSIgV23icTWRTQQO2KLYAjE53sI6z3xBXa5ga+MEDQW2sBkdsFxizJDyFyIQaBwG2mb0ENAH2ibCLZAG90GbDTcaKMgUXXkM9MItnESGEAW6jvw+ZjBkKMnBuHOTSQJNtSEVVINliRE4cM3n3E1Y5FcnSEhDpsVkuNdnfHQXJ0nOQUCAskywcUhZfyQ0xBdMCQrQISnJmxn/C2EmzedpSa8XAtul+SalmmXX0CyVTF2tDt/Hy68/UC0nIID0G/Dzr6AHfDp7c0YCVraVOOOVsKfjcrz7QWtWtXZ0y74jP9oPBV/UXj+/V8h9Qr+UNGaekbR/fexqPpAYCOa6xVvBqbHC2S1S2HIeI27ymlg73jg+NPgye9/+Gmw4Pc/8m6wbPU/7jQwPd5hIiUmvMms4nbkZ6xxtA2Ru/kpeLj0nboHWYzHO2yqniJ9tHN3OwiDMBSA1x7KxgQU5P2f1QtvTIxubox1Zt8btOEnJOUsUkC7QOm0yKDmkDtNEqgpqIt1vLRsAZLKbFvH1AQri/B5cbW0Obv7h/WvBm9oQ8bruPimhrs2Yp3Krf/uLqDqICpjHD8JgrrVK4ptmisIUxV8xOqfRtebtSOWbv/nzjpD7kGLoM/6z/x5bkUi6AeIUlSkNNU0huwj0wSOPoejr/qJPhSXxEfLDBgiAzDb6CW58t+Vn04aPQDVw5SJCNPsmgAAAABJRU5ErkJggg=="},80517:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagbg.png"},89411:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagmask.png"},94085:(e,t,i)=>{"use strict";e.exports=i.p+"images/roboto-700-42_0.png"},35367:()=>{},53204:(e,t,i)=>{"use strict";i.d(t,{fe:()=>dt,cA:()=>A,h4:()=>tt,createHttpLink:()=>p,Ps:()=>li});var n=i(70655),s=i(92924),r=i(81707),o=i(80496),a=i(84913),l=Object.prototype.hasOwnProperty;var c=function(e,t){var i;try{i=JSON.stringify(e)}catch(e){var n=new s.ej(23);throw n.parseError=e,n}return i},h=i(90778),d={http:{includeQuery:!0,includeExtensions:!1},headers:{accept:"*/*","content-type":"application/json"},options:{method:"POST"}},u=i(80285);var p=function(e){void 0===e&&(e={});var t=e.uri,i=void 0===t?"/graphql":t,p=e.fetch,m=e.includeExtensions,g=e.useGETForQueries,f=e.includeUnusedVariables,v=void 0!==f&&f,y=(0,n._T)(e,["uri","fetch","includeExtensions","useGETForQueries","includeUnusedVariables"]);!function(e){if(!e&&"undefined"==typeof fetch)throw new s.ej(22)}(p),p||(p=fetch);var b={http:{includeExtensions:m},options:y.fetchOptions,credentials:y.credentials,headers:y.headers};return new r.i0((function(e){var t=function(e,t){return e.getContext().uri||("function"==typeof t?t(e):t||"/graphql")}(e,i),s=e.getContext(),r={};if(s.clientAwareness){var m=s.clientAwareness,f=m.name,y=m.version;f&&(r["apollographql-client-name"]=f),y&&(r["apollographql-client-version"]=y)}var S,E=(0,n.pi)((0,n.pi)({},r),s.headers),w={http:s.http,options:s.fetchOptions,credentials:s.credentials,headers:E},T=function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var r=(0,n.pi)((0,n.pi)({},t.options),{headers:t.headers,credentials:t.credentials}),o=t.http||{};i.forEach((function(e){r=(0,n.pi)((0,n.pi)((0,n.pi)({},r),e.options),{headers:(0,n.pi)((0,n.pi)({},r.headers),e.headers)}),e.credentials&&(r.credentials=e.credentials),o=(0,n.pi)((0,n.pi)({},o),e.http)}));var a=e.operationName,l=e.extensions,c=e.variables,d=e.query,u={operationName:a,variables:c};return o.includeExtensions&&(u.extensions=l),o.includeQuery&&(u.query=(0,h.S)(d)),{options:r,body:u}}(e,d,b,w),_=T.options,M=T.body;if(M.variables&&!v){var x=new Set(Object.keys(M.variables));(0,u.Vn)(e.query,{Variable:function(e,t,i){i&&"VariableDefinition"!==i.kind&&x.delete(e.name.value)}}),x.size&&(M.variables=(0,n.pi)({},M.variables),x.forEach((function(e){delete M.variables[e]})))}if(!_.signal){var A=function(){if("undefined"==typeof AbortController)return{controller:!1,signal:!1};var e=new AbortController;return{controller:e,signal:e.signal}}(),O=A.controller,P=A.signal;(S=O)&&(_.signal=P)}if(g&&!e.query.definitions.some((function(e){return"OperationDefinition"===e.kind&&"mutation"===e.operation}))&&(_.method="GET"),"GET"===_.method){var D=function(e,t){var i=[],n=function(e,t){i.push(e+"="+encodeURIComponent(t))};if("query"in t&&n("query",t.query),t.operationName&&n("operationName",t.operationName),t.variables){var s=void 0;try{s=c(t.variables)}catch(e){return{parseError:e}}n("variables",s)}if(t.extensions){var r=void 0;try{r=c(t.extensions)}catch(e){return{parseError:e}}n("extensions",r)}var o="",a=e,l=e.indexOf("#");-1!==l&&(o=e.substr(l),a=e.substr(0,l));var h=-1===a.indexOf("?")?"?":"&";return{newURI:a+h+i.join("&")+o}}(t,M),C=D.newURI,I=D.parseError;if(I)return(0,a.Qc)(I);t=C}else try{_.body=c(M)}catch(I){return(0,a.Qc)(I)}return new o.y$((function(i){var n;return p(t,_).then((function(t){return e.setContext({response:t}),t})).then((n=e,function(e){return e.text().then((function(t){try{return JSON.parse(t)}catch(n){var i=n;throw i.name="ServerParseError",i.response=e,i.statusCode=e.status,i.bodyText=t,i}})).then((function(t){return e.status>=300&&(0,a.PW)(e,t,"Response not successful: Received status code "+e.status),Array.isArray(t)||l.call(t,"data")||l.call(t,"errors")||(0,a.PW)(e,t,"Server response was missing for query '"+(Array.isArray(n)?n.map((function(e){return e.operationName})):n.operationName)+"'."),t}))})).then((function(e){return i.next(e),i.complete(),e})).catch((function(e){"AbortError"!==e.name&&(e.result&&e.result.errors&&e.result.data&&i.next(e.result),i.error(e))})),function(){S&&S.abort()}}))}))},m=function(e){function t(t){void 0===t&&(t={});var i=e.call(this,p(t).request)||this;return i.options=t,i}return(0,n.ZT)(t,e),t}(r.i0),g=Object.prototype,f=g.toString,v=g.hasOwnProperty,y=Function.prototype.toString,b=new Map;function S(e,t){try{return E(e,t)}finally{b.clear()}}function E(e,t){if(e===t)return!0;var i,n,s,r=f.call(e);if(r!==f.call(t))return!1;switch(r){case"[object Array]":if(e.length!==t.length)return!1;case"[object Object]":if(M(e,t))return!0;var o=w(e),a=w(t),l=o.length;if(l!==a.length)return!1;for(var c=0;c<l;++c)if(!v.call(t,o[c]))return!1;for(c=0;c<l;++c){var h=o[c];if(!E(e[h],t[h]))return!1}return!0;case"[object Error]":return e.name===t.name&&e.message===t.message;case"[object Number]":if(e!=e)return t!=t;case"[object Boolean]":case"[object Date]":return+e==+t;case"[object RegExp]":case"[object String]":return e==""+t;case"[object Map]":case"[object Set]":if(e.size!==t.size)return!1;if(M(e,t))return!0;for(var d=e.entries(),u="[object Map]"===r;;){var p=d.next();if(p.done)break;var m=p.value,g=m[0],b=m[1];if(!t.has(g))return!1;if(u&&!E(b,t.get(g)))return!1}return!0;case"[object Function]":var S=y.call(e);return S===y.call(t)&&(n=_,!((s=(i=S).length-n.length)>=0&&i.indexOf(n,s)===s))}return!1}function w(e){return Object.keys(e).filter(T,e)}function T(e){return void 0!==this[e]}var _="{ [native code] }";function M(e,t){var i=b.get(e);if(i){if(i.has(t))return!0}else b.set(e,i=new Set);return i.add(t),!1}var x,A=function(e){function t(i){var n,s,r=i.graphQLErrors,a=i.networkError,l=i.errorMessage,c=i.extraInfo,h=e.call(this,l)||this;return h.graphQLErrors=r||[],h.networkError=a||null,h.message=l||(n=h,s="",(0,o.Of)(n.graphQLErrors)&&n.graphQLErrors.forEach((function(e){var t=e?e.message:"Error message not found.";s+=t+"\n"})),n.networkError&&(s+=n.networkError.message+"\n"),s=s.replace(/\n$/,"")),h.extraInfo=c,h.__proto__=t.prototype,h}return(0,n.ZT)(t,e),t}(Error);function O(e){return!!e&&e<7}!function(e){e[e.loading=1]="loading",e[e.setVariables=2]="setVariables",e[e.fetchMore=3]="fetchMore",e[e.refetch=4]="refetch",e[e.poll=6]="poll",e[e.ready=7]="ready",e[e.error=8]="error"}(x||(x={}));var P=function(){function e(e,t,i,n){this.observer=e,this.options=t,this.fetch=i,this.shouldFetch=n}return e.prototype.reobserve=function(e,t){e?this.updateOptions(e):this.updatePolling();var i=this.fetch(this.options,t);return this.concast&&this.concast.removeObserver(this.observer,!0),i.addObserver(this.observer),(this.concast=i).promise},e.prototype.updateOptions=function(e){return Object.assign(this.options,(0,o.oA)(e)),this.updatePolling(),this},e.prototype.stop=function(){this.concast&&(this.concast.removeObserver(this.observer),delete this.concast),this.pollingInfo&&(clearTimeout(this.pollingInfo.timeout),this.options.pollInterval=0,this.updatePolling())},e.prototype.updatePolling=function(){var e=this,t=this.pollingInfo,i=this.options.pollInterval;if(i){if((!t||t.interval!==i)&&((0,s.kG)(i,20),!1!==this.shouldFetch)){(t||(this.pollingInfo={})).interval=i;var n=function(){e.pollingInfo&&(e.shouldFetch&&e.shouldFetch()?e.reobserve({fetchPolicy:"network-only",nextFetchPolicy:e.options.fetchPolicy||"cache-first"},x.poll).then(r,r):r())},r=function(){var t=e.pollingInfo;t&&(clearTimeout(t.timeout),t.timeout=setTimeout(n,t.interval))};r()}}else t&&(clearTimeout(t.timeout),delete this.pollingInfo)},e}(),D=function(e){function t(t){var i=t.queryManager,s=t.queryInfo,r=t.options,a=e.call(this,(function(e){return a.onSubscribe(e)}))||this;a.observers=new Set,a.subscriptions=new Set,a.observer={next:function(e){(a.lastError||a.isDifferentFromLastResult(e))&&(a.updateLastResult(e),(0,o.pM)(a.observers,"next",e))},error:function(e){a.updateLastResult((0,n.pi)((0,n.pi)({},a.lastResult),{error:e,errors:e.graphQLErrors,networkStatus:x.error,loading:!1})),(0,o.pM)(a.observers,"error",a.lastError=e)}},a.isTornDown=!1,a.options=r,a.queryId=i.generateQueryId();var l=(0,o.$H)(r.query);return a.queryName=l&&l.name&&l.name.value,a.queryManager=i,a.queryInfo=s,a}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"variables",{get:function(){return this.options.variables},enumerable:!1,configurable:!0}),t.prototype.result=function(){var e=this;return new Promise((function(t,i){var n={next:function(i){t(i),e.observers.delete(n),e.observers.size||e.queryManager.removeQuery(e.queryId),setTimeout((function(){s.unsubscribe()}),0)},error:i},s=e.subscribe(n)}))},t.prototype.getCurrentResult=function(e){void 0===e&&(e=!0);var t=this.lastResult,i=this.queryInfo.networkStatus||t&&t.networkStatus||x.ready,s=(0,n.pi)((0,n.pi)({},t),{loading:O(i),networkStatus:i});if(this.isTornDown)return s;var r=this.options.fetchPolicy,o=void 0===r?"cache-first":r;if("no-cache"===o||"network-only"===o)delete s.partial;else if(!s.data||!this.queryManager.transform(this.options.query).hasForcedResolvers){var a=this.queryInfo.getDiff();s.data=a.complete||this.options.returnPartialData?a.result:void 0,a.complete?(s.networkStatus!==x.loading||"cache-first"!==o&&"cache-only"!==o||(s.networkStatus=x.ready,s.loading=!1),delete s.partial):s.partial=!0}return e&&this.updateLastResult(s),s},t.prototype.isDifferentFromLastResult=function(e){return!S(this.lastResultSnapshot,e)},t.prototype.getLastResult=function(){return this.lastResult},t.prototype.getLastError=function(){return this.lastError},t.prototype.resetLastResults=function(){delete this.lastResult,delete this.lastResultSnapshot,delete this.lastError,this.isTornDown=!1},t.prototype.resetQueryStoreErrors=function(){this.queryManager.resetErrors(this.queryId)},t.prototype.refetch=function(e){var t={pollInterval:0},i=this.options.fetchPolicy;return"no-cache"!==i&&"cache-and-network"!==i&&(t.fetchPolicy="network-only",t.nextFetchPolicy=i||"cache-first"),e&&!S(this.options.variables,e)&&(t.variables=this.options.variables=(0,n.pi)((0,n.pi)({},this.options.variables),e)),this.newReobserver(!1).reobserve(t,x.refetch)},t.prototype.fetchMore=function(e){var t=this,i=(0,n.pi)((0,n.pi)({},e.query?e:(0,n.pi)((0,n.pi)((0,n.pi)({},this.options),e),{variables:(0,n.pi)((0,n.pi)({},this.options.variables),e.variables)})),{fetchPolicy:"no-cache"}),s=this.queryManager.generateQueryId();return i.notifyOnNetworkStatusChange&&(this.queryInfo.networkStatus=x.fetchMore,this.observe()),this.queryManager.fetchQuery(s,i,x.fetchMore).then((function(n){var s=n.data,r=e.updateQuery;return r?t.updateQuery((function(e){return r(e,{fetchMoreResult:s,variables:i.variables})})):t.queryManager.cache.writeQuery({query:i.query,variables:i.variables,data:s}),n})).finally((function(){t.queryManager.stopQuery(s),t.reobserve()}))},t.prototype.subscribeToMore=function(e){var t=this,i=this.queryManager.startGraphQLSubscription({query:e.document,variables:e.variables,context:e.context}).subscribe({next:function(i){var n=e.updateQuery;n&&t.updateQuery((function(e,t){var s=t.variables;return n(e,{subscriptionData:i,variables:s})}))},error:function(t){e.onError&&e.onError(t)}});return this.subscriptions.add(i),function(){t.subscriptions.delete(i)&&i.unsubscribe()}},t.prototype.setOptions=function(e){return this.reobserve(e)},t.prototype.setVariables=function(e){if(S(this.variables,e))return this.observers.size?this.result():Promise.resolve();if(this.options.variables=e,!this.observers.size)return Promise.resolve();var t=this.options.fetchPolicy,i=void 0===t?"cache-first":t,n={fetchPolicy:i,variables:e};return"cache-first"!==i&&"no-cache"!==i&&"network-only"!==i&&(n.fetchPolicy="cache-and-network",n.nextFetchPolicy=i),this.reobserve(n,x.setVariables)},t.prototype.updateQuery=function(e){var t,i=this.queryManager,n=e(i.cache.diff({query:this.options.query,variables:this.variables,previousResult:null===(t=this.lastResult)||void 0===t?void 0:t.data,returnPartialData:!0,optimistic:!1}).result,{variables:this.variables});n&&(i.cache.writeQuery({query:this.options.query,data:n,variables:this.variables}),i.broadcastQueries())},t.prototype.startPolling=function(e){this.getReobserver().updateOptions({pollInterval:e})},t.prototype.stopPolling=function(){this.reobserver&&this.reobserver.updateOptions({pollInterval:0})},t.prototype.updateLastResult=function(e){var t=this.lastResult;return this.lastResult=e,this.lastResultSnapshot=this.queryManager.assumeImmutableResults?e:(0,o.Xh)(e),(0,o.Of)(e.errors)||delete this.lastError,t},t.prototype.onSubscribe=function(e){var t=this;if(e===this.observer)return function(){};try{var i=e._subscription._observer;i&&!i.error&&(i.error=C)}catch(e){}var n=!this.observers.size;return this.observers.add(e),this.lastError?e.error&&e.error(this.lastError):this.lastResult&&e.next&&e.next(this.lastResult),n&&this.reobserve().catch((function(e){})),function(){t.observers.delete(e)&&!t.observers.size&&t.tearDownQuery()}},t.prototype.getReobserver=function(){return this.reobserver||(this.reobserver=this.newReobserver(!0))},t.prototype.newReobserver=function(e){var t=this,i=this.queryManager,s=this.queryId;return i.setObservableQuery(this),new P(this.observer,e?this.options:(0,n.pi)({},this.options),(function(e,n){return i.setObservableQuery(t),i.fetchQueryObservable(s,e,n)}),!i.ssrMode&&function(){return!O(t.queryInfo.networkStatus)})},t.prototype.reobserve=function(e,t){return this.isTornDown=!1,this.getReobserver().reobserve(e,t)},t.prototype.observe=function(){this.observer.next(this.getCurrentResult(!1))},t.prototype.hasObservers=function(){return this.observers.size>0},t.prototype.tearDownQuery=function(){this.isTornDown||(this.reobserver&&(this.reobserver.stop(),delete this.reobserver),this.subscriptions.forEach((function(e){return e.unsubscribe()})),this.subscriptions.clear(),this.queryManager.stopQuery(this.queryId),this.observers.clear(),this.isTornDown=!0)},t}(o.y$);function C(e){}(0,o.Dy)(D);var I=i(27636),L=function(){return Object.create(null)},R=Array.prototype,N=R.forEach,k=R.slice,B=function(){function e(e,t){void 0===e&&(e=!0),void 0===t&&(t=L),this.weakness=e,this.makeData=t}return e.prototype.lookup=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.lookupArray(e)},e.prototype.lookupArray=function(e){var t=this;return N.call(e,(function(e){return t=t.getChildTrie(e)})),t.data||(t.data=this.makeData(k.call(e)))},e.prototype.getChildTrie=function(t){var i=this.weakness&&function(e){switch(typeof e){case"object":if(null===e)break;case"function":return!0}return!1}(t)?this.weak||(this.weak=new WeakMap):this.strong||(this.strong=new Map),n=i.get(t);return n||i.set(t,n=new e(this.weakness,this.makeData)),n},e}();var F=null,U={},V=1,H="@wry/context:Slot",G=Array,z=G[H]||function(){var e=function(){function e(){this.id=["slot",V++,Date.now(),Math.random().toString(36).slice(2)].join(":")}return e.prototype.hasValue=function(){for(var e=F;e;e=e.parent)if(this.id in e.slots){var t=e.slots[this.id];if(t===U)break;return e!==F&&(F.slots[this.id]=t),!0}return F&&(F.slots[this.id]=U),!1},e.prototype.getValue=function(){if(this.hasValue())return F.slots[this.id]},e.prototype.withValue=function(e,t,i,n){var s,r=((s={__proto__:null})[this.id]=e,s),o=F;F={parent:o,slots:r};try{return t.apply(n,i)}finally{F=o}},e.bind=function(e){var t=F;return function(){var i=F;try{return F=t,e.apply(this,arguments)}finally{F=i}}},e.noContext=function(e,t,i){if(!F)return e.apply(i,t);var n=F;try{return F=null,e.apply(i,t)}finally{F=n}},e}();try{Object.defineProperty(G,H,{value:G[H]=e,enumerable:!1,writable:!1,configurable:!1})}finally{return e}}();z.bind,z.noContext;function W(){}var j=function(){function e(e,t){void 0===e&&(e=1/0),void 0===t&&(t=W),this.max=e,this.dispose=t,this.map=new Map,this.newest=null,this.oldest=null}return e.prototype.has=function(e){return this.map.has(e)},e.prototype.get=function(e){var t=this.getEntry(e);return t&&t.value},e.prototype.getEntry=function(e){var t=this.map.get(e);if(t&&t!==this.newest){var i=t.older,n=t.newer;n&&(n.older=i),i&&(i.newer=n),t.older=this.newest,t.older.newer=t,t.newer=null,this.newest=t,t===this.oldest&&(this.oldest=n)}return t},e.prototype.set=function(e,t){var i=this.getEntry(e);return i?i.value=t:(i={key:e,value:t,newer:null,older:this.newest},this.newest&&(this.newest.newer=i),this.newest=i,this.oldest=this.oldest||i,this.map.set(e,i),i.value)},e.prototype.clean=function(){for(;this.oldest&&this.map.size>this.max;)this.delete(this.oldest.key)},e.prototype.delete=function(e){var t=this.map.get(e);return!!t&&(t===this.newest&&(this.newest=t.older),t===this.oldest&&(this.oldest=t.newer),t.newer&&(t.newer.older=t.older),t.older&&(t.older.newer=t.newer),this.map.delete(e),this.dispose(t.value,e),!0)},e}(),K=new z;function q(e){var t=e.unsubscribe;"function"==typeof t&&(e.unsubscribe=void 0,t())}var Z=[];function Y(e,t){if(!e)throw new Error(t||"assertion failure")}function $(e){switch(e.length){case 0:throw new Error("unknown value");case 1:return e[0];case 2:throw e[1]}}var Q=function(){function e(t){this.fn=t,this.parents=new Set,this.childValues=new Map,this.dirtyChildren=null,this.dirty=!0,this.recomputing=!1,this.value=[],this.deps=null,++e.count}return e.prototype.peek=function(){if(1===this.value.length&&!J(this))return this.value[0]},e.prototype.recompute=function(e){return Y(!this.recomputing,"already recomputing"),function(e){var t=K.getValue();if(t)e.parents.add(t),t.childValues.has(e)||t.childValues.set(e,[]),J(e)?ie(t,e):ne(t,e)}(this),J(this)?function(e,t){re(e),K.withValue(e,X,[e,t]),function(e,t){if("function"==typeof e.subscribe)try{q(e),e.unsubscribe=e.subscribe.apply(null,t)}catch(t){return e.setDirty(),!1}return!0}(e,t)&&function(e){if(e.dirty=!1,J(e))return;te(e)}(e);return $(e.value)}(this,e):$(this.value)},e.prototype.setDirty=function(){this.dirty||(this.dirty=!0,this.value.length=0,ee(this),re(this),q(this))},e.prototype.dispose=function(){var e=this;re(this),q(this),this.parents.forEach((function(t){t.setDirty(),oe(t,e)}))},e.prototype.dependOn=function(e){e.add(this),this.deps||(this.deps=Z.pop()||new Set),this.deps.add(e)},e.prototype.forgetDeps=function(){var e=this;this.deps&&(this.deps.forEach((function(t){return t.delete(e)})),this.deps.clear(),Z.push(this.deps),this.deps=null)},e.count=0,e}();function X(e,t){e.recomputing=!0,e.value.length=0;try{e.value[0]=e.fn.apply(null,t)}catch(t){e.value[1]=t}e.recomputing=!1}function J(e){return e.dirty||!(!e.dirtyChildren||!e.dirtyChildren.size)}function ee(e){e.parents.forEach((function(t){return ie(t,e)}))}function te(e){e.parents.forEach((function(t){return ne(t,e)}))}function ie(e,t){if(Y(e.childValues.has(t)),Y(J(t)),e.dirtyChildren){if(e.dirtyChildren.has(t))return}else e.dirtyChildren=Z.pop()||new Set;e.dirtyChildren.add(t),ee(e)}function ne(e,t){Y(e.childValues.has(t)),Y(!J(t));var i,n,s,r=e.childValues.get(t);0===r.length?e.childValues.set(t,t.value.slice(0)):(i=r,n=t.value,(s=i.length)>0&&s===n.length&&i[s-1]===n[s-1]||e.setDirty()),se(e,t),J(e)||te(e)}function se(e,t){var i=e.dirtyChildren;i&&(i.delete(t),0===i.size&&(Z.length<100&&Z.push(i),e.dirtyChildren=null))}function re(e){e.childValues.size>0&&e.childValues.forEach((function(t,i){oe(e,i)})),e.forgetDeps(),Y(null===e.dirtyChildren)}function oe(e,t){t.parents.delete(e),e.childValues.delete(t),se(e,t)}function ae(e){var t=new Map,i=e&&e.subscribe;function n(e){var n=K.getValue();if(n){var s=t.get(e);s||t.set(e,s=new Set),n.dependOn(s),"function"==typeof i&&(q(s),s.unsubscribe=i(e))}}return n.dirty=function(e){var i=t.get(e);i&&(i.forEach((function(e){return e.setDirty()})),t.delete(e),q(i))},n}var le=new B("function"==typeof WeakMap);function ce(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return le.lookupArray(e)}var he=new Set;function de(e,t){void 0===t&&(t=Object.create(null));var i=new j(t.max||Math.pow(2,16),(function(e){return e.dispose()})),n=t.keyArgs||function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e},s=t.makeCacheKey||ce;function r(){var r=s.apply(null,n.apply(null,arguments));if(void 0===r)return e.apply(null,arguments);var o=i.get(r);o||(i.set(r,o=new Q(e)),o.subscribe=t.subscribe);var a=o.recompute(Array.prototype.slice.call(arguments));return i.set(r,o),he.add(i),K.hasValue()||(he.forEach((function(e){return e.clean()})),he.clear()),a}function o(){var e=s.apply(null,arguments);if(void 0!==e)return i.get(e)}return r.dirty=function(){var e=o.apply(null,arguments);e&&e.setDirty()},r.peek=function(){var e=o.apply(null,arguments);if(e)return e.peek()},r.forget=function(){var e=s.apply(null,arguments);return void 0!==e&&i.delete(e)},r}var ue,pe=function(){function e(){this.getFragmentDoc=de(o.Yk)}return e.prototype.recordOptimisticTransaction=function(e,t){this.performTransaction(e,t)},e.prototype.transformDocument=function(e){return e},e.prototype.identify=function(e){},e.prototype.gc=function(){return[]},e.prototype.modify=function(e){return!1},e.prototype.transformForLink=function(e){return e},e.prototype.readQuery=function(e,t){return void 0===t&&(t=!!e.optimistic),this.read({rootId:e.id||"ROOT_QUERY",query:e.query,variables:e.variables,returnPartialData:e.returnPartialData,optimistic:t})},e.prototype.readFragment=function(e,t){return void 0===t&&(t=!!e.optimistic),this.read({query:this.getFragmentDoc(e.fragment,e.fragmentName),variables:e.variables,rootId:e.id,returnPartialData:e.returnPartialData,optimistic:t})},e.prototype.writeQuery=function(e){return this.write({dataId:e.id||"ROOT_QUERY",result:e.data,query:e.query,variables:e.variables,broadcast:e.broadcast})},e.prototype.writeFragment=function(e){return this.write({dataId:e.id,result:e.data,variables:e.variables,query:this.getFragmentDoc(e.fragment,e.fragmentName),broadcast:e.broadcast})},e}();ue||(ue={});var me=function(e,t,i,n,s){this.message=e,this.path=t,this.query=i,this.clientOnly=n,this.variables=s},ge=Object.prototype.hasOwnProperty;var fe=/^[_a-z][_0-9a-z]*/i;function ve(e){var t=e.match(fe);return t?t[0]:e}function ye(e,t,i){return!(!t||"object"!=typeof t)&&(Array.isArray(t)?t.every((function(t){return ye(e,t,i)})):e.selections.every((function(e){if((0,o.My)(e)&&(0,o.LZ)(e,i)){var n=(0,o.u2)(e);return ge.call(t,n)&&(!e.selectionSet||ye(e.selectionSet,t[n],i))}return!0})))}function be(e){return null!==e&&"object"==typeof e&&!(0,o.hh)(e)&&!Array.isArray(e)}var Se=Object.create(null),Ee=function(){return Se},we=Object.create(null),Te=function(){function e(e,t){var i=this;this.policies=e,this.group=t,this.data=Object.create(null),this.rootIds=Object.create(null),this.refs=Object.create(null),this.getFieldValue=function(e,t){return(0,o.Jv)((0,o.hh)(e)?i.get(e.__ref,t):e&&e[t])},this.canRead=function(e){return(0,o.hh)(e)?i.has(e.__ref):"object"==typeof e},this.toReference=function(e,t){if("string"==typeof e)return(0,o.kQ)(e);if((0,o.hh)(e))return e;var n=i.policies.identify(e)[0];if(n){var s=(0,o.kQ)(n);return t&&i.merge(n,e),s}}}return e.prototype.toObject=function(){return(0,n.pi)({},this.data)},e.prototype.has=function(e){return void 0!==this.lookup(e,!0)},e.prototype.get=function(e,t){if(this.group.depend(e,t),ge.call(this.data,e)){var i=this.data[e];if(i&&ge.call(i,t))return i[t]}return"__typename"===t&&ge.call(this.policies.rootTypenamesById,e)?this.policies.rootTypenamesById[e]:this instanceof xe?this.parent.get(e,t):void 0},e.prototype.lookup=function(e,t){return t&&this.group.depend(e,"__exists"),ge.call(this.data,e)?this.data[e]:this instanceof xe?this.parent.lookup(e,t):this.policies.rootTypenamesById[e]?Object.create(null):void 0},e.prototype.merge=function(e,t){var i=this,n=this.lookup(e),s=new o.w0(Ae).merge(n,t);if(this.data[e]=s,s!==n&&(delete this.refs[e],this.group.caching)){var r=Object.create(null);n||(r.__exists=1),Object.keys(t).forEach((function(e){if(!n||n[e]!==s[e]){r[e]=1;var t=ve(e);t===e||i.policies.hasKeyArgs(s.__typename,t)||(r[t]=1),void 0!==s[e]||i instanceof xe||delete s[e]}})),Object.keys(r).forEach((function(t){return i.group.dirty(e,t)}))}},e.prototype.modify=function(e,t){var i=this,s=this.lookup(e);if(s){var r=Object.create(null),a=!1,l=!0,c={DELETE:Se,INVALIDATE:we,isReference:o.hh,toReference:this.toReference,canRead:this.canRead,readField:function(t,n){return i.policies.readField("string"==typeof t?{fieldName:t,from:n||(0,o.kQ)(e)}:t,{store:i})}};if(Object.keys(s).forEach((function(h){var d=ve(h),u=s[h];if(void 0!==u){var p="function"==typeof t?t:t[h]||t[d];if(p){var m=p===Ee?Se:p((0,o.Jv)(u),(0,n.pi)((0,n.pi)({},c),{fieldName:d,storeFieldName:h,storage:i.getStorage(e,h)}));m===we?i.group.dirty(e,h):(m===Se&&(m=void 0),m!==u&&(r[h]=m,a=!0,u=m))}void 0!==u&&(l=!1)}})),a)return this.merge(e,r),l&&(this instanceof xe?this.data[e]=void 0:delete this.data[e],this.group.dirty(e,"__exists")),!0}return!1},e.prototype.delete=function(e,t,i){var n,s=this.lookup(e);if(s){var r=this.getFieldValue(s,"__typename"),o=t&&i?this.policies.getStoreFieldName({typename:r,fieldName:t,args:i}):t;return this.modify(e,o?((n={})[o]=Ee,n):Ee)}return!1},e.prototype.evict=function(e){var t=!1;return e.id&&(ge.call(this.data,e.id)&&(t=this.delete(e.id,e.fieldName,e.args)),this instanceof xe&&(t=this.parent.evict(e)||t),(e.fieldName||t)&&this.group.dirty(e.id,e.fieldName||"__exists")),t},e.prototype.clear=function(){this.replace(null)},e.prototype.extract=function(){var e=this,t=this.toObject(),i=[];return this.getRootIdSet().forEach((function(t){ge.call(e.policies.rootTypenamesById,t)||i.push(t)})),i.length&&(t.__META={extraRootIds:i.sort()}),t},e.prototype.replace=function(e){var t=this;if(Object.keys(this.data).forEach((function(i){e&&ge.call(e,i)||t.delete(i)})),e){var i=e.__META,s=(0,n._T)(e,["__META"]);Object.keys(s).forEach((function(e){t.merge(e,s[e])})),i&&i.extraRootIds.forEach(this.retain,this)}},e.prototype.retain=function(e){return this.rootIds[e]=(this.rootIds[e]||0)+1},e.prototype.release=function(e){if(this.rootIds[e]>0){var t=--this.rootIds[e];return t||delete this.rootIds[e],t}return 0},e.prototype.getRootIdSet=function(e){return void 0===e&&(e=new Set),Object.keys(this.rootIds).forEach(e.add,e),this instanceof xe?this.parent.getRootIdSet(e):Object.keys(this.policies.rootTypenamesById).forEach(e.add,e),e},e.prototype.gc=function(){var e=this,t=this.getRootIdSet(),i=this.toObject();t.forEach((function(n){ge.call(i,n)&&(Object.keys(e.findChildRefIds(n)).forEach(t.add,t),delete i[n])}));var n=Object.keys(i);if(n.length){for(var s=this;s instanceof xe;)s=s.parent;n.forEach((function(e){return s.delete(e)}))}return n},e.prototype.findChildRefIds=function(e){if(!ge.call(this.refs,e)){var t=this.refs[e]=Object.create(null),i=new Set([this.data[e]]),n=function(e){return null!==e&&"object"==typeof e};i.forEach((function(e){(0,o.hh)(e)?t[e.__ref]=!0:n(e)&&Object.values(e).filter(n).forEach(i.add,i)}))}return this.refs[e]},e.prototype.makeCacheKey=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.group.keyMaker.lookupArray(e)},e}(),_e=function(){function e(e){this.caching=e,this.d=null,this.keyMaker=new B(o.mr),this.d=e?ae():null}return e.prototype.depend=function(e,t){if(this.d){this.d(Me(e,t));var i=ve(t);i!==t&&this.d(Me(e,i))}},e.prototype.dirty=function(e,t){this.d&&this.d.dirty(Me(e,t))},e}();function Me(e,t){return t+"#"+e}!function(e){var t=function(e){function t(t){var i=t.policies,n=t.resultCaching,s=void 0===n||n,r=t.seed,a=e.call(this,i,new _e(s))||this;return a.storageTrie=new B(o.mr),a.sharedLayerGroup=new _e(s),r&&a.replace(r),a}return(0,n.ZT)(t,e),t.prototype.addLayer=function(e,t){return new xe(e,this,t,this.sharedLayerGroup)},t.prototype.removeLayer=function(){return this},t.prototype.getStorage=function(){return this.storageTrie.lookupArray(arguments)},t}(e);e.Root=t}(Te||(Te={}));var xe=function(e){function t(t,i,n,s){var r=e.call(this,i.policies,s)||this;return r.id=t,r.parent=i,r.replay=n,r.group=s,n(r),r}return(0,n.ZT)(t,e),t.prototype.addLayer=function(e,i){return new t(e,this,i,this.group)},t.prototype.removeLayer=function(e){var t=this,i=this.parent.removeLayer(e);return e===this.id?(this.group.caching&&Object.keys(this.data).forEach((function(e){t.data[e]!==i.lookup(e)&&t.delete(e)})),i):i===this.parent?this:i.addLayer(this.id,this.replay)},t.prototype.toObject=function(){return(0,n.pi)((0,n.pi)({},this.parent.toObject()),this.data)},t.prototype.findChildRefIds=function(t){var i=this.parent.findChildRefIds(t);return ge.call(this.data,t)?(0,n.pi)((0,n.pi)({},i),e.prototype.findChildRefIds.call(this,t)):i},t.prototype.getStorage=function(){for(var e=this.parent;e.parent;)e=e.parent;return e.getStorage.apply(e,arguments)},t}(Te);function Ae(e,t,i){var n=e[i],s=t[i];return S(n,s)?n:s}function Oe(e){return!!(e instanceof Te&&e.group.caching)}function Pe(e,t){return new me(e.message,t.path.slice(),t.query,t.clientOnly,t.variables)}var De=function(){function e(e){var t=this;this.config=e,this.executeSelectionSet=de((function(e){return t.execSelectionSetImpl(e)}),{keyArgs:function(e){return[e.selectionSet,e.objectOrReference,e.context]},makeCacheKey:function(e,t,i){if(Oe(i.store))return i.store.makeCacheKey(e,(0,o.hh)(t)?t.__ref:t,i.varString)}}),this.knownResults=new WeakMap,this.executeSubSelectedArray=de((function(e){return t.execSubSelectedArrayImpl(e)}),{makeCacheKey:function(e){var t=e.field,i=e.array,n=e.context;if(Oe(n.store))return n.store.makeCacheKey(t,i,n.varString)}}),this.config=(0,n.pi)({addTypename:!0},e)}return e.prototype.diffQueryAgainstStore=function(e){var t=e.store,i=e.query,s=e.rootId,r=void 0===s?"ROOT_QUERY":s,a=e.variables,l=e.returnPartialData,c=void 0===l||l,h=this.config.cache.policies;a=(0,n.pi)((0,n.pi)({},(0,o.O4)((0,o.iW)(i))),a);var d=this.executeSelectionSet({selectionSet:(0,o.p$)(i).selectionSet,objectOrReference:(0,o.kQ)(r),context:{store:t,query:i,policies:h,variables:a,varString:JSON.stringify(a),fragmentMap:(0,o.F)((0,o.kU)(i)),path:[],clientOnly:!1}}),u=d.missing&&d.missing.length>0;if(u&&!c)throw d.missing[0];return{result:d.result,missing:d.missing,complete:!u}},e.prototype.isFresh=function(e,t,i,n){if(Oe(n.store)&&this.knownResults.get(e)===i){var s=this.executeSelectionSet.peek(i,t,n);if(s&&e===s.result)return!0}return!1},e.prototype.execSelectionSetImpl=function(e){var t=this,i=e.selectionSet,n=e.objectOrReference,r=e.context;if((0,o.hh)(n)&&!r.policies.rootTypenamesById[n.__ref]&&!r.store.has(n.__ref))return{result:{},missing:[Pe(new s.ej(4),r)]};var a=r.variables,l=r.policies,c=r.store,h=[],d={result:null},u=c.getFieldValue(n,"__typename");function p(){return d.missing||(d.missing=[])}function m(e){var t;return e.missing&&(t=p()).push.apply(t,e.missing),e.result}this.config.addTypename&&"string"==typeof u&&!l.rootIdsByTypename[u]&&h.push({__typename:u});var g=new Set(i.selections);return g.forEach((function(e){var i;if((0,o.LZ)(e,a))if((0,o.My)(e)){var c=l.readField({fieldName:e.name.value,field:e,variables:r.variables,from:n},r),d=(0,o.u2)(e);r.path.push(d);var f=r.clientOnly;r.clientOnly=f||!(!e.directives||!e.directives.some((function(e){return"client"===e.name.value}))),void 0===c?o.Gw.added(e)||p().push(Pe(new s.ej(5),r)):Array.isArray(c)?c=m(t.executeSubSelectedArray({field:e,array:c,context:r})):e.selectionSet&&null!=c&&(c=m(t.executeSelectionSet({selectionSet:e.selectionSet,objectOrReference:c,context:r}))),void 0!==c&&h.push(((i={})[d]=c,i)),r.clientOnly=f,(0,s.kG)(r.path.pop()===d)}else{var v=(0,o.hi)(e,r.fragmentMap);v&&l.fragmentMatches(v,u)&&v.selectionSet.selections.forEach(g.add,g)}})),d.result=(0,o.bw)(h),this.knownResults.set(d.result,i),d},e.prototype.execSubSelectedArrayImpl=function(e){var t,i=this,n=e.field,r=e.array,o=e.context;function a(e,i){return e.missing&&(t=t||[]).push.apply(t,e.missing),(0,s.kG)(o.path.pop()===i),e.result}return n.selectionSet&&(r=r.filter(o.store.canRead)),{result:r=r.map((function(e,t){return null===e?null:(o.path.push(t),Array.isArray(e)?a(i.executeSubSelectedArray({field:n,array:e,context:o}),t):n.selectionSet?a(i.executeSelectionSet({selectionSet:n.selectionSet,objectOrReference:e,context:o}),t):((0,s.kG)(o.path.pop()===t),e))})),missing:t}},e}();var Ce=function(){function e(e,t){this.cache=e,this.reader=t}return e.prototype.writeToStore=function(e){var t=e.query,i=e.result,r=e.dataId,a=e.store,l=e.variables,c=(0,o.$H)(t),h=new o.w0;l=(0,n.pi)((0,n.pi)({},(0,o.O4)(c)),l);var d=this.processSelectionSet({result:i||Object.create(null),dataId:r,selectionSet:c.selectionSet,mergeTree:{map:new Map},context:{store:a,written:Object.create(null),merge:function(e,t){return h.merge(e,t)},variables:l,varString:JSON.stringify(l),fragmentMap:(0,o.F)((0,o.kU)(t))}});if(!(0,o.hh)(d))throw new s.ej(7);return a.retain(d.__ref),d},e.prototype.processSelectionSet=function(e){var t=this,i=e.dataId,n=e.result,r=e.selectionSet,a=e.context,l=e.mergeTree,c=this.cache.policies,h=c.identify(n,r,a.fragmentMap),d=h[0],u=h[1];if("string"==typeof(i=i||d)){var p=a.written[i]||(a.written[i]=[]),m=(0,o.kQ)(i);if(p.indexOf(r)>=0)return m;if(p.push(r),this.reader&&this.reader.isFresh(n,m,r,a))return m}var g=Object.create(null);u&&(g=a.merge(g,u));var f=i&&c.rootTypenamesById[i]||(0,o.qw)(n,r,a.fragmentMap)||i&&a.store.get(i,"__typename");"string"==typeof f&&(g.__typename=f);var v=new Set(r.selections);if(v.forEach((function(e){var i;if((0,o.LZ)(e,a.variables))if((0,o.My)(e)){var r=(0,o.u2)(e),h=n[r];if(void 0!==h){var d=c.getStoreFieldName({typename:f,fieldName:e.name.value,field:e,variables:a.variables}),u=Le(l,d),p=t.processFieldValue(h,e,a,u),m=e.selectionSet&&a.store.getFieldValue(p,"__typename")||void 0,y=c.getMergeFunction(f,e.name.value,m);y?u.info={field:e,typename:f,merge:y}:Re(l,d),g=a.merge(g,((i={})[d]=p,i))}else if(c.usingPossibleTypes&&!(0,o.FS)(["defer","client"],e))throw new s.ej(8)}else{var b=(0,o.hi)(e,a.fragmentMap);b&&c.fragmentMatches(b,f,n,a.variables)&&b.selectionSet.selections.forEach(v.add,v)}})),"string"==typeof i){var y=(0,o.kQ)(i);return l.map.size&&(g=this.applyMerges(l,y,g,a)),a.store.merge(i,g),y}return g},e.prototype.processFieldValue=function(e,t,i,n){var s=this;return t.selectionSet&&null!==e?Array.isArray(e)?e.map((function(e,r){var o=s.processFieldValue(e,t,i,Le(n,r));return Re(n,r),o})):this.processSelectionSet({result:e,selectionSet:t.selectionSet,context:i,mergeTree:n}):e},e.prototype.applyMerges=function(e,t,i,r,a){var l,c=this;if(e.map.size&&!(0,o.hh)(i)){var h,d=Array.isArray(i)||!(0,o.hh)(t)&&!be(t)?void 0:t,u=i;d&&!a&&(a=[(0,o.hh)(d)?d.__ref:d]);var p=function(e,t){return Array.isArray(e)?"number"==typeof t?e[t]:void 0:r.store.getFieldValue(e,String(t))};e.map.forEach((function(e,t){a&&a.push(t);var i=p(d,t),n=p(u,t),o=c.applyMerges(e,i,n,r,a);o!==n&&(h=h||new Map).set(t,o),a&&(0,s.kG)(a.pop()===t)})),h&&(i=Array.isArray(u)?u.slice(0):(0,n.pi)({},u),h.forEach((function(e,t){i[t]=e})))}return e.info?this.cache.policies.runMergeFunction(t,i,e.info,r,a&&(l=r.store).getStorage.apply(l,a)):i},e}(),Ie=[];function Le(e,t){var i=e.map;return i.has(t)||i.set(t,Ie.pop()||{map:new Map}),i.get(t)}function Re(e,t){var i=e.map,n=i.get(t);!n||n.info||n.map.size||(Ie.push(n),i.delete(t))}new Set;var Ne=new z;function ke(e,t){if(e.size){var i=[];e.forEach((function(e){return i.push(e)})),e.clear(),i.forEach(t)}}var Be=new WeakMap;function Fe(e){var t=Be.get(e);return t||Be.set(e,t={vars:new Set,dep:ae()}),t}function Ue(e){var t=new Set,i=new Set,n=function(r){if(arguments.length>0)e!==r&&(e=r,t.forEach((function(e){Fe(e).dep.dirty(n),Ve(e)})),ke(i,(function(t){return t(e)})));else{var o=Ne.getValue();o&&(s(o),Fe(o).dep(n))}return e};n.onNextChange=function(e){return i.add(e),function(){i.delete(e)}};var s=n.attachCache=function(e){return t.add(e),Fe(e).vars.add(n),n};return n.forgetCache=function(e){return t.delete(e)},n}function Ve(e){e.broadcastWatches&&e.broadcastWatches()}function He(e){return void 0!==e.args?e.args:e.field?(0,o.NC)(e.field,e.variables):null}var Ge=function(e,t){var i=e.__typename,n=e.id,s=e._id;if("string"==typeof i&&(t&&(t.keyObject=void 0!==n?{id:n}:void 0!==s?{_id:s}:void 0),void 0===n&&(n=s),void 0!==n))return i+":"+("number"==typeof n||"string"==typeof n?n:JSON.stringify(n))},ze=function(){},We=function(e,t){return t.fieldName},je=function(e,t,i){return(0,i.mergeObjects)(e,t)},Ke=function(e,t){return t},qe=function(){function e(e){this.config=e,this.typePolicies=Object.create(null),this.toBeAdded=Object.create(null),this.supertypeMap=new Map,this.fuzzySubtypes=new Map,this.rootIdsByTypename=Object.create(null),this.rootTypenamesById=Object.create(null),this.usingPossibleTypes=!1,this.config=(0,n.pi)({dataIdFromObject:Ge},e),this.cache=this.config.cache,this.setRootTypename("Query"),this.setRootTypename("Mutation"),this.setRootTypename("Subscription"),e.possibleTypes&&this.addPossibleTypes(e.possibleTypes),e.typePolicies&&this.addTypePolicies(e.typePolicies)}return e.prototype.identify=function(e,t,i){var n=t&&i?(0,o.qw)(e,t,i):e.__typename;if(n===this.rootTypenamesById.ROOT_QUERY)return["ROOT_QUERY"];for(var s,r={typename:n,selectionSet:t,fragmentMap:i},a=n&&this.getTypePolicy(n),l=a&&a.keyFn||this.config.dataIdFromObject;l;){var c=l(e,r);if(!Array.isArray(c)){s=c;break}l=Qe(c)}return s=s&&String(s),r.keyObject?[s,r.keyObject]:[s]},e.prototype.addTypePolicies=function(e){var t=this;Object.keys(e).forEach((function(i){var s=e[i],r=s.queryType,o=s.mutationType,a=s.subscriptionType,l=(0,n._T)(s,["queryType","mutationType","subscriptionType"]);r&&t.setRootTypename("Query",i),o&&t.setRootTypename("Mutation",i),a&&t.setRootTypename("Subscription",i),ge.call(t.toBeAdded,i)?t.toBeAdded[i].push(l):t.toBeAdded[i]=[l]}))},e.prototype.updateTypePolicy=function(e,t){var i=this,n=this.getTypePolicy(e),s=t.keyFields,r=t.fields;function o(e,t){e.merge="function"==typeof t?t:!0===t?je:!1===t?Ke:e.merge}o(n,t.merge),n.keyFn=!1===s?ze:Array.isArray(s)?Qe(s):"function"==typeof s?s:n.keyFn,r&&Object.keys(r).forEach((function(t){var n=i.getFieldPolicy(e,t,!0),s=r[t];if("function"==typeof s)n.read=s;else{var a=s.keyArgs,l=s.read,c=s.merge;n.keyFn=!1===a?We:Array.isArray(a)?$e(a):"function"==typeof a?a:n.keyFn,"function"==typeof l&&(n.read=l),o(n,c)}n.read&&n.merge&&(n.keyFn=n.keyFn||We)}))},e.prototype.setRootTypename=function(e,t){void 0===t&&(t=e);var i="ROOT_"+e.toUpperCase(),n=this.rootTypenamesById[i];t!==n&&((0,s.kG)(!n||n===e,1),n&&delete this.rootIdsByTypename[n],this.rootIdsByTypename[t]=i,this.rootTypenamesById[i]=t)},e.prototype.addPossibleTypes=function(e){var t=this;this.usingPossibleTypes=!0,Object.keys(e).forEach((function(i){t.getSupertypeSet(i,!0),e[i].forEach((function(e){t.getSupertypeSet(e,!0).add(i);var n=e.match(fe);n&&n[0]===e||t.fuzzySubtypes.set(e,new RegExp(e))}))}))},e.prototype.getTypePolicy=function(e){var t=this;if(!ge.call(this.typePolicies,e)){var i=this.typePolicies[e]=Object.create(null);i.fields=Object.create(null);var s=this.supertypeMap.get(e);s&&s.size&&s.forEach((function(e){var s=t.getTypePolicy(e),r=s.fields,o=(0,n._T)(s,["fields"]);Object.assign(i,o),Object.assign(i.fields,r)}))}var r=this.toBeAdded[e];return r&&r.length&&this.updateTypePolicy(e,o.oA.apply(void 0,r.splice(0))),this.typePolicies[e]},e.prototype.getFieldPolicy=function(e,t,i){if(e){var n=this.getTypePolicy(e).fields;return n[t]||i&&(n[t]=Object.create(null))}},e.prototype.getSupertypeSet=function(e,t){var i=this.supertypeMap.get(e);return!i&&t&&this.supertypeMap.set(e,i=new Set),i},e.prototype.fragmentMatches=function(e,t,i,n){var s=this;if(!e.typeCondition)return!0;if(!t)return!1;var r=e.typeCondition.name.value;if(t===r)return!0;if(this.usingPossibleTypes&&this.supertypeMap.has(r))for(var o=this.getSupertypeSet(t,!0),a=[o],l=function(e){var t=s.getSupertypeSet(e,!1);t&&t.size&&a.indexOf(t)<0&&a.push(t)},c=!(!i||!this.fuzzySubtypes.size),h=0;h<a.length;++h){var d=a[h];if(d.has(r))return o.has(r)||o.add(r),!0;d.forEach(l),c&&h===a.length-1&&ye(e.selectionSet,i,n)&&(c=!1,!0,this.fuzzySubtypes.forEach((function(e,i){var n=t.match(e);n&&n[0]===t&&l(i)})))}return!1},e.prototype.hasKeyArgs=function(e,t){var i=this.getFieldPolicy(e,t,!1);return!(!i||!i.keyFn)},e.prototype.getStoreFieldName=function(e){var t,i=e.typename,n=e.fieldName,s=this.getFieldPolicy(i,n,!1),r=s&&s.keyFn;if(r&&i)for(var a={typename:i,fieldName:n,field:e.field||null,variables:e.variables},l=He(e);r;){var c=r(l,a);if(!Array.isArray(c)){t=c||n;break}r=$e(c)}return void 0===t&&(t=e.field?(0,o.vf)(e.field,e.variables):(0,o.PT)(n,He(e))),n===ve(t)?t:n+":"+t},e.prototype.readField=function(e,t){var i=e.from;if(i&&(e.field||e.fieldName)){if(void 0===e.typename){var n=t.store.getFieldValue(i,"__typename");n&&(e.typename=n)}var s=this.getStoreFieldName(e),r=ve(s),a=t.store.getFieldValue(i,s),l=this.getFieldPolicy(e.typename,r,!1),c=l&&l.read;if(c){var h=Ze(this,i,e,t,t.store.getStorage((0,o.hh)(i)?i.__ref:i,s));return Ne.withValue(this.cache,c,[a,h])}return a}},e.prototype.getMergeFunction=function(e,t,i){var n=this.getFieldPolicy(e,t,!1),s=n&&n.merge;return!s&&i&&(s=(n=this.getTypePolicy(i))&&n.merge),s},e.prototype.runMergeFunction=function(e,t,i,n,s){var r=i.field,o=i.typename,a=i.merge;return a===je?Ye(n.store.getFieldValue)(e,t):a===Ke?t:a(e,t,Ze(this,void 0,{typename:o,fieldName:r.name.value,field:r,variables:n.variables},n,s||Object.create(null)))},e}();function Ze(e,t,i,s,r){var a=e.getStoreFieldName(i),l=ve(a),c=i.variables||s.variables,h=s.store,d=h.getFieldValue,u=h.toReference,p=h.canRead;return{args:He(i),field:i.field||null,fieldName:l,storeFieldName:a,variables:c,isReference:o.hh,toReference:u,storage:r,cache:e.cache,canRead:p,readField:function(i,r){var o="string"==typeof i?{fieldName:i,from:r}:(0,n.pi)({},i);return void 0===o.from&&(o.from=t),void 0===o.variables&&(o.variables=c),e.readField(o,s)},mergeObjects:Ye(d)}}function Ye(e){return function(t,i){if(Array.isArray(t)||Array.isArray(i))throw new s.ej(2);if(t&&"object"==typeof t&&i&&"object"==typeof i){var r=e(t,"__typename"),o=e(i,"__typename");return!(r&&o&&r!==o)&&be(t)&&be(i)?(0,n.pi)((0,n.pi)({},t),i):i}return i}}function $e(e){return function(t,i){return t?i.fieldName+":"+JSON.stringify(Je(t,e,!1)):i.fieldName}}function Qe(e){var t=new B(o.mr);return function(i,n){var s;if(n.selectionSet&&n.fragmentMap){var r=t.lookupArray([n.selectionSet,n.fragmentMap]);s=r.aliasMap||(r.aliasMap=Xe(n.selectionSet,n.fragmentMap))}var o=n.keyObject=Je(i,e,!0,s);return n.typename+":"+JSON.stringify(o)}}function Xe(e,t){var i=Object.create(null),n=new Set([e]);return n.forEach((function(e){e.selections.forEach((function(e){if((0,o.My)(e)){if(e.alias){var s=e.alias.value,r=e.name.value;if(r!==s)(i.aliases||(i.aliases=Object.create(null)))[r]=s}if(e.selectionSet)(i.subsets||(i.subsets=Object.create(null)))[e.name.value]=Xe(e.selectionSet,t)}else{var a=(0,o.hi)(e,t);a&&n.add(a.selectionSet)}}))})),i}function Je(e,t,i,n){var r,o=Object.create(null);return t.forEach((function(t){if(Array.isArray(t)){if("string"==typeof r){var a=n&&n.subsets,l=a&&a[r];o[r]=Je(e[r],t,i,l)}}else{var c=n&&n.aliases,h=c&&c[t]||t;ge.call(e,h)?o[r=t]=e[h]:((0,s.kG)(!i,3),r=void 0)}})),o}var et={dataIdFromObject:Ge,addTypename:!0,resultCaching:!0,typePolicies:{}},tt=function(e){function t(t){void 0===t&&(t={});var i=e.call(this)||this;return i.watches=new Set,i.typenameDocumentCache=new Map,i.makeVar=Ue,i.txCount=0,i.maybeBroadcastWatch=de((function(e,t){return i.broadcastWatch.call(i,e,!!t)}),{makeCacheKey:function(e){var t=e.optimistic?i.optimisticData:i.data;if(Oe(t)){var n=e.optimistic,s=e.rootId,r=e.variables;return t.makeCacheKey(e.query,e.callback,JSON.stringify({optimistic:n,rootId:s,variables:r}))}}}),i.watchDep=ae(),i.config=(0,n.pi)((0,n.pi)({},et),t),i.addTypename=!!i.config.addTypename,i.policies=new qe({cache:i,dataIdFromObject:i.config.dataIdFromObject,possibleTypes:i.config.possibleTypes,typePolicies:i.config.typePolicies}),i.data=new Te.Root({policies:i.policies,resultCaching:i.config.resultCaching}),i.optimisticData=i.data,i.storeWriter=new Ce(i,i.storeReader=new De({cache:i,addTypename:i.addTypename})),i}return(0,n.ZT)(t,e),t.prototype.restore=function(e){return e&&this.data.replace(e),this},t.prototype.extract=function(e){return void 0===e&&(e=!1),(e?this.optimisticData:this.data).extract()},t.prototype.read=function(e){var t=e.returnPartialData,i=void 0!==t&&t;try{return this.storeReader.diffQueryAgainstStore({store:e.optimistic?this.optimisticData:this.data,query:e.query,variables:e.variables,rootId:e.rootId,config:this.config,returnPartialData:i}).result||null}catch(e){if(e instanceof me)return null;throw e}},t.prototype.write=function(e){try{return++this.txCount,this.storeWriter.writeToStore({store:this.data,query:e.query,result:e.result,dataId:e.dataId,variables:e.variables})}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.modify=function(e){if(ge.call(e,"id")&&!e.id)return!1;var t=e.optimistic?this.optimisticData:this.data;try{return++this.txCount,t.modify(e.id||"ROOT_QUERY",e.fields)}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.diff=function(e){return this.storeReader.diffQueryAgainstStore({store:e.optimistic?this.optimisticData:this.data,rootId:e.id||"ROOT_QUERY",query:e.query,variables:e.variables,returnPartialData:e.returnPartialData,config:this.config})},t.prototype.watch=function(e){var t,i=this;return this.watches.size||Fe(t=this).vars.forEach((function(e){return e.attachCache(t)})),this.watches.add(e),e.immediate&&this.maybeBroadcastWatch(e),function(){i.watches.delete(e)&&!i.watches.size&&function(e){Fe(e).vars.forEach((function(t){return t.forgetCache(e)}))}(i),i.watchDep.dirty(e),i.maybeBroadcastWatch.forget(e)}},t.prototype.gc=function(){return this.optimisticData.gc()},t.prototype.retain=function(e,t){return(t?this.optimisticData:this.data).retain(e)},t.prototype.release=function(e,t){return(t?this.optimisticData:this.data).release(e)},t.prototype.identify=function(e){return(0,o.hh)(e)?e.__ref:this.policies.identify(e)[0]},t.prototype.evict=function(e){if(!e.id){if(ge.call(e,"id"))return!1;e=(0,n.pi)((0,n.pi)({},e),{id:"ROOT_QUERY"})}try{return++this.txCount,this.optimisticData.evict(e)}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.reset=function(){return this.data.clear(),this.optimisticData=this.data,this.broadcastWatches(),Promise.resolve()},t.prototype.removeOptimistic=function(e){var t=this.optimisticData.removeLayer(e);t!==this.optimisticData&&(this.optimisticData=t,this.broadcastWatches())},t.prototype.performTransaction=function(e,t){var i=this,n=function(t){var n=i,s=n.data,r=n.optimisticData;++i.txCount,t&&(i.data=i.optimisticData=t);try{e(i)}finally{--i.txCount,i.data=s,i.optimisticData=r}},s=!1;"string"==typeof t?(this.optimisticData=this.optimisticData.addLayer(t,n),s=!0):null===t?n(this.data):n(),this.broadcastWatches(s)},t.prototype.transformDocument=function(e){if(this.addTypename){var t=this.typenameDocumentCache.get(e);return t||(t=(0,o.Gw)(e),this.typenameDocumentCache.set(e,t),this.typenameDocumentCache.set(t,t)),t}return e},t.prototype.broadcastWatches=function(e){var t=this;this.txCount||this.watches.forEach((function(i){return t.maybeBroadcastWatch(i,e)}))},t.prototype.broadcastWatch=function(e,t){this.watchDep.dirty(e),this.watchDep(e);var i=this.diff({query:e.query,variables:e.variables,optimistic:e.optimistic});e.optimistic&&t&&(i.fromOptimisticTransaction=!0),e.callback(i)},t}(pe),it=function(){function e(e){var t=e.cache,i=e.client,n=e.resolvers,s=e.fragmentMatcher;this.cache=t,i&&(this.client=i),n&&this.addResolvers(n),s&&this.setFragmentMatcher(s)}return e.prototype.addResolvers=function(e){var t=this;this.resolvers=this.resolvers||{},Array.isArray(e)?e.forEach((function(e){t.resolvers=(0,o.Ee)(t.resolvers,e)})):this.resolvers=(0,o.Ee)(this.resolvers,e)},e.prototype.setResolvers=function(e){this.resolvers={},this.addResolvers(e)},e.prototype.getResolvers=function(){return this.resolvers||{}},e.prototype.runResolvers=function(e){var t=e.document,i=e.remoteResult,s=e.context,r=e.variables,o=e.onlyRunForcedResolvers,a=void 0!==o&&o;return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(e){return t?[2,this.resolveDocument(t,i.data,s,r,this.fragmentMatcher,a).then((function(e){return(0,n.pi)((0,n.pi)({},i),{data:e.result})}))]:[2,i]}))}))},e.prototype.setFragmentMatcher=function(e){this.fragmentMatcher=e},e.prototype.getFragmentMatcher=function(){return this.fragmentMatcher},e.prototype.clientQuery=function(e){return(0,o.FS)(["client"],e)&&this.resolvers?e:null},e.prototype.serverQuery=function(e){return(0,o.ob)(e)},e.prototype.prepareContext=function(e){var t=this.cache;return(0,n.pi)((0,n.pi)({},e),{cache:t,getCacheKey:function(e){return t.identify(e)}})},e.prototype.addExportedVariables=function(e,t,i){return void 0===t&&(t={}),void 0===i&&(i={}),(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(s){return e?[2,this.resolveDocument(e,this.buildRootValueFromCache(e,t)||{},this.prepareContext(i),t).then((function(e){return(0,n.pi)((0,n.pi)({},t),e.exportedVariables)}))]:[2,(0,n.pi)({},t)]}))}))},e.prototype.shouldForceResolvers=function(e){var t=!1;return(0,I.Vn)(e,{Directive:{enter:function(e){if("client"===e.name.value&&e.arguments&&(t=e.arguments.some((function(e){return"always"===e.name.value&&"BooleanValue"===e.value.kind&&!0===e.value.value}))))return I.$_}}}),t},e.prototype.buildRootValueFromCache=function(e,t){return this.cache.diff({query:(0,o.aL)(e),variables:t,returnPartialData:!0,optimistic:!1}).result},e.prototype.resolveDocument=function(e,t,i,s,r,a){return void 0===i&&(i={}),void 0===s&&(s={}),void 0===r&&(r=function(){return!0}),void 0===a&&(a=!1),(0,n.mG)(this,void 0,void 0,(function(){var l,c,h,d,u,p,m,g,f;return(0,n.Jh)(this,(function(v){return l=(0,o.p$)(e),c=(0,o.kU)(e),h=(0,o.F)(c),d=l.operation,u=d?d.charAt(0).toUpperCase()+d.slice(1):"Query",m=(p=this).cache,g=p.client,f={fragmentMap:h,context:(0,n.pi)((0,n.pi)({},i),{cache:m,client:g}),variables:s,fragmentMatcher:r,defaultOperationType:u,exportedVariables:{},onlyRunForcedResolvers:a},[2,this.resolveSelectionSet(l.selectionSet,t,f).then((function(e){return{result:e,exportedVariables:f.exportedVariables}}))]}))}))},e.prototype.resolveSelectionSet=function(e,t,i){return(0,n.mG)(this,void 0,void 0,(function(){var r,a,l,c,h,d=this;return(0,n.Jh)(this,(function(u){return r=i.fragmentMap,a=i.context,l=i.variables,c=[t],h=function(e){return(0,n.mG)(d,void 0,void 0,(function(){var h,d;return(0,n.Jh)(this,(function(n){return(0,o.LZ)(e,l)?(0,o.My)(e)?[2,this.resolveField(e,t,i).then((function(t){var i;void 0!==t&&c.push(((i={})[(0,o.u2)(e)]=t,i))}))]:((0,o.Ao)(e)?h=e:(h=r[e.name.value],(0,s.kG)(h,11)),h&&h.typeCondition&&(d=h.typeCondition.name.value,i.fragmentMatcher(t,d,a))?[2,this.resolveSelectionSet(h.selectionSet,t,i).then((function(e){c.push(e)}))]:[2]):[2]}))}))},[2,Promise.all(e.selections.map(h)).then((function(){return(0,o.bw)(c)}))]}))}))},e.prototype.resolveField=function(e,t,i){return(0,n.mG)(this,void 0,void 0,(function(){var s,r,a,l,c,h,d,u,p,m=this;return(0,n.Jh)(this,(function(n){return s=i.variables,r=e.name.value,a=(0,o.u2)(e),l=r!==a,c=t[a]||t[r],h=Promise.resolve(c),i.onlyRunForcedResolvers&&!this.shouldForceResolvers(e)||(d=t.__typename||i.defaultOperationType,(u=this.resolvers&&this.resolvers[d])&&(p=u[l?r:a])&&(h=Promise.resolve(Ne.withValue(this.cache,p,[t,(0,o.NC)(e,s),i.context,{field:e,fragmentMap:i.fragmentMap}])))),[2,h.then((function(t){return void 0===t&&(t=c),e.directives&&e.directives.forEach((function(e){"export"===e.name.value&&e.arguments&&e.arguments.forEach((function(e){"as"===e.name.value&&"StringValue"===e.value.kind&&(i.exportedVariables[e.value.value]=t)}))})),e.selectionSet?null==t?t:Array.isArray(t)?m.resolveSubSelectedArray(e,t,i):e.selectionSet?m.resolveSelectionSet(e.selectionSet,t,i):void 0:t}))]}))}))},e.prototype.resolveSubSelectedArray=function(e,t,i){var n=this;return Promise.all(t.map((function(t){return null===t?null:Array.isArray(t)?n.resolveSubSelectedArray(e,t,i):e.selectionSet?n.resolveSelectionSet(e.selectionSet,t,i):void 0})))},e}(),nt=new(o.mr?WeakMap:Map);function st(e,t){var i=e[t];"function"==typeof i&&(e[t]=function(){return nt.set(e,(nt.get(e)+1)%1e15),i.apply(this,arguments)})}function rt(e){e.notifyTimeout&&(clearTimeout(e.notifyTimeout),e.notifyTimeout=void 0)}var ot=function(){function e(e){this.cache=e,this.listeners=new Set,this.document=null,this.lastRequestId=1,this.subscriptions=new Set,this.stopped=!1,this.dirty=!1,this.diff=null,this.observableQuery=null,nt.has(e)||(nt.set(e,0),st(e,"evict"),st(e,"modify"),st(e,"reset"))}return e.prototype.init=function(e){var t=e.networkStatus||x.loading;return this.variables&&this.networkStatus!==x.loading&&!S(this.variables,e.variables)&&(t=x.setVariables),S(e.variables,this.variables)||(this.diff=null),Object.assign(this,{document:e.document,variables:e.variables,networkError:null,graphQLErrors:this.graphQLErrors||[],networkStatus:t}),e.observableQuery&&this.setObservableQuery(e.observableQuery),e.lastRequestId&&(this.lastRequestId=e.lastRequestId),this},e.prototype.reset=function(){rt(this),this.diff=null,this.dirty=!1},e.prototype.getDiff=function(e){return void 0===e&&(e=this.variables),this.diff&&S(e,this.variables)?this.diff:(this.updateWatch(this.variables=e),this.diff=this.cache.diff({query:this.document,variables:e,returnPartialData:!0,optimistic:!0}))},e.prototype.setDiff=function(e){var t=this,i=this.diff;this.diff=e,this.dirty||(e&&e.result)===(i&&i.result)||(this.dirty=!0,this.notifyTimeout||(this.notifyTimeout=setTimeout((function(){return t.notify()}),0)))},e.prototype.setObservableQuery=function(e){var t=this;e!==this.observableQuery&&(this.oqListener&&this.listeners.delete(this.oqListener),this.observableQuery=e,e?(e.queryInfo=this,this.listeners.add(this.oqListener=function(){t.getDiff().fromOptimisticTransaction?e.observe():e.reobserve()})):delete this.oqListener)},e.prototype.notify=function(){var e=this;rt(this),this.shouldNotify()&&this.listeners.forEach((function(t){return t(e)})),this.dirty=!1},e.prototype.shouldNotify=function(){if(!this.dirty||!this.listeners.size)return!1;if(O(this.networkStatus)&&this.observableQuery){var e=this.observableQuery.options.fetchPolicy;if("cache-only"!==e&&"cache-and-network"!==e)return!1}return!0},e.prototype.stop=function(){if(!this.stopped){this.stopped=!0,this.cancel(),delete this.cancel,this.subscriptions.forEach((function(e){return e.unsubscribe()}));var e=this.observableQuery;e&&e.stopPolling()}},e.prototype.cancel=function(){},e.prototype.updateWatch=function(e){var t=this;void 0===e&&(e=this.variables);var i=this.observableQuery;i&&"no-cache"===i.options.fetchPolicy||this.lastWatch&&this.lastWatch.query===this.document&&S(e,this.lastWatch.variables)||(this.cancel(),this.cancel=this.cache.watch(this.lastWatch={query:this.document,variables:e,optimistic:!0,callback:function(e){return t.setDiff(e)}}))},e.prototype.shouldWrite=function(e,t){var i=this.lastWrite;return!(i&&i.dmCount===nt.get(this.cache)&&S(t,i.variables)&&S(e.data,i.result.data))},e.prototype.markResult=function(e,t,i){var n=this;this.graphQLErrors=(0,o.Of)(e.errors)?e.errors:[],this.reset(),"no-cache"===t.fetchPolicy?this.diff={result:e.data,complete:!0}:!this.stopped&&i&&(at(e,t.errorPolicy)?this.cache.performTransaction((function(i){if(n.shouldWrite(e,t.variables))i.writeQuery({query:n.document,data:e.data,variables:t.variables}),n.lastWrite={result:e,variables:t.variables,dmCount:nt.get(n.cache)};else if(n.diff&&n.diff.complete)return void(e.data=n.diff.result);var s=i.diff({query:n.document,variables:t.variables,returnPartialData:!0,optimistic:!0});n.stopped||n.updateWatch(t.variables),n.diff=s,s.complete&&(e.data=s.result)})):this.lastWrite=void 0)},e.prototype.markReady=function(){return this.networkError=null,this.networkStatus=x.ready},e.prototype.markError=function(e){return this.networkStatus=x.error,this.lastWrite=void 0,this.reset(),e.graphQLErrors&&(this.graphQLErrors=e.graphQLErrors),e.networkError&&(this.networkError=e.networkError),e},e}();function at(e,t){void 0===t&&(t="none");var i="ignore"===t||"all"===t,n=!(0,o.d2)(e);return!n&&i&&e.data&&(n=!0),n}var lt=Object.prototype.hasOwnProperty,ct=function(){function e(e){var t=e.cache,i=e.link,n=e.queryDeduplication,s=void 0!==n&&n,r=e.onBroadcast,a=e.ssrMode,l=void 0!==a&&a,c=e.clientAwareness,h=void 0===c?{}:c,d=e.localState,u=e.assumeImmutableResults;this.clientAwareness={},this.queries=new Map,this.fetchCancelFns=new Map,this.transformCache=new(o.mr?WeakMap:Map),this.queryIdCounter=1,this.requestIdCounter=1,this.mutationIdCounter=1,this.inFlightLinkObservables=new Map,this.cache=t,this.link=i,this.queryDeduplication=s,this.clientAwareness=h,this.localState=d||new it({cache:t}),this.ssrMode=l,this.assumeImmutableResults=!!u,(this.onBroadcast=r)&&(this.mutationStore=Object.create(null))}return e.prototype.stop=function(){var e=this;this.queries.forEach((function(t,i){e.stopQueryNoBroadcast(i)})),this.cancelPendingFetches(new s.ej(12))},e.prototype.cancelPendingFetches=function(e){this.fetchCancelFns.forEach((function(t){return t(e)})),this.fetchCancelFns.clear()},e.prototype.mutate=function(e){var t=e.mutation,i=e.variables,r=e.optimisticResponse,a=e.updateQueries,l=e.refetchQueries,c=void 0===l?[]:l,h=e.awaitRefetchQueries,d=void 0!==h&&h,u=e.update,p=e.errorPolicy,m=void 0===p?"none":p,g=e.fetchPolicy,f=e.context,v=void 0===f?{}:f;return(0,n.mG)(this,void 0,void 0,(function(){var e,l,h;return(0,n.Jh)(this,(function(p){switch(p.label){case 0:return(0,s.kG)(t,13),(0,s.kG)(!g||"no-cache"===g,14),e=this.generateMutationId(),t=this.transform(t).document,i=this.getVariables(t,i),this.transform(t).hasClientExports?[4,this.localState.addExportedVariables(t,i,v)]:[3,2];case 1:i=p.sent(),p.label=2;case 2:return l=this.mutationStore&&(this.mutationStore[e]={mutation:t,variables:i,loading:!0,error:null}),r&&this.markMutationOptimistic(r,{mutationId:e,document:t,variables:i,errorPolicy:m,updateQueries:a,update:u}),this.broadcastQueries(),h=this,[2,new Promise((function(s,p){var f,y;h.getObservableFromLink(t,(0,n.pi)((0,n.pi)({},v),{optimisticResponse:r}),i,!1).subscribe({next:function(n){if((0,o.d2)(n)&&"none"===m)y=new A({graphQLErrors:n.errors});else{if(l&&(l.loading=!1,l.error=null),"no-cache"!==g)try{h.markMutationResult({mutationId:e,result:n,document:t,variables:i,errorPolicy:m,updateQueries:a,update:u})}catch(e){return void(y=new A({networkError:e}))}f=n}},error:function(t){l&&(l.loading=!1,l.error=t),r&&h.cache.removeOptimistic(e),h.broadcastQueries(),p(new A({networkError:t}))},complete:function(){if(y&&l&&(l.loading=!1,l.error=y),r&&h.cache.removeOptimistic(e),h.broadcastQueries(),y)p(y);else{"function"==typeof c&&(c=c(f));var t=[];(0,o.Of)(c)&&c.forEach((function(e){if("string"==typeof e)h.queries.forEach((function(i){var n=i.observableQuery;n&&n.queryName===e&&t.push(n.refetch())}));else{var i={query:e.query,variables:e.variables,fetchPolicy:"network-only"};e.context&&(i.context=e.context),t.push(h.query(i))}})),Promise.all(d?t:[]).then((function(){"ignore"===m&&f&&(0,o.d2)(f)&&delete f.errors,s(f)}),p)}}})}))]}}))}))},e.prototype.markMutationResult=function(e,t){var i=this;if(void 0===t&&(t=this.cache),at(e.result,e.errorPolicy)){var n=[{result:e.result.data,dataId:"ROOT_MUTATION",query:e.document,variables:e.variables}],s=e.updateQueries;s&&this.queries.forEach((function(r,a){var l=r.observableQuery,c=l&&l.queryName;if(c&&lt.call(s,c)){var h=s[c],d=i.queries.get(a),u=d.document,p=d.variables,m=t.diff({query:u,variables:p,returnPartialData:!0,optimistic:!1}),g=m.result;if(m.complete&&g){var f=h(g,{mutationResult:e.result,queryName:u&&(0,o.rY)(u)||void 0,queryVariables:p});f&&n.push({result:f,dataId:"ROOT_QUERY",query:u,variables:p})}}})),t.performTransaction((function(t){n.forEach((function(e){return t.write(e)}));var i=e.update;i&&i(t,e.result)}),null)}},e.prototype.markMutationOptimistic=function(e,t){var i=this,s="function"==typeof e?e(t.variables):e;return this.cache.recordOptimisticTransaction((function(e){try{i.markMutationResult((0,n.pi)((0,n.pi)({},t),{result:{data:s}}),e)}catch(e){}}),t.mutationId)},e.prototype.fetchQuery=function(e,t,i){return this.fetchQueryObservable(e,t,i).promise},e.prototype.getQueryStore=function(){var e=Object.create(null);return this.queries.forEach((function(t,i){e[i]={variables:t.variables,networkStatus:t.networkStatus,networkError:t.networkError,graphQLErrors:t.graphQLErrors}})),e},e.prototype.resetErrors=function(e){var t=this.queries.get(e);t&&(t.networkError=void 0,t.graphQLErrors=[])},e.prototype.transform=function(e){var t=this.transformCache;if(!t.has(e)){var i=this.cache.transformDocument(e),n=(0,o.Fo)(this.cache.transformForLink(i)),s=this.localState.clientQuery(i),r=n&&this.localState.serverQuery(n),a={document:i,hasClientExports:(0,o.mj)(i),hasForcedResolvers:this.localState.shouldForceResolvers(i),clientQuery:s,serverQuery:r,defaultVars:(0,o.O4)((0,o.$H)(i))},l=function(e){e&&!t.has(e)&&t.set(e,a)};l(e),l(i),l(s),l(r)}return t.get(e)},e.prototype.getVariables=function(e,t){return(0,n.pi)((0,n.pi)({},this.transform(e).defaultVars),t)},e.prototype.watchQuery=function(e){void 0===(e=(0,n.pi)((0,n.pi)({},e),{variables:this.getVariables(e.query,e.variables)})).notifyOnNetworkStatusChange&&(e.notifyOnNetworkStatusChange=!1);var t=new ot(this.cache),i=new D({queryManager:this,queryInfo:t,options:e});return this.queries.set(i.queryId,t),t.init({document:e.query,observableQuery:i,variables:e.variables}),i},e.prototype.query=function(e){var t=this;(0,s.kG)(e.query,15),(0,s.kG)("Document"===e.query.kind,16),(0,s.kG)(!e.returnPartialData,17),(0,s.kG)(!e.pollInterval,18);var i=this.generateQueryId();return this.fetchQuery(i,e).finally((function(){return t.stopQuery(i)}))},e.prototype.generateQueryId=function(){return String(this.queryIdCounter++)},e.prototype.generateRequestId=function(){return this.requestIdCounter++},e.prototype.generateMutationId=function(){return String(this.mutationIdCounter++)},e.prototype.stopQueryInStore=function(e){this.stopQueryInStoreNoBroadcast(e),this.broadcastQueries()},e.prototype.stopQueryInStoreNoBroadcast=function(e){var t=this.queries.get(e);t&&t.stop()},e.prototype.clearStore=function(){return this.cancelPendingFetches(new s.ej(19)),this.queries.forEach((function(e){e.observableQuery?e.networkStatus=x.loading:e.stop()})),this.mutationStore&&(this.mutationStore=Object.create(null)),this.cache.reset()},e.prototype.resetStore=function(){var e=this;return this.clearStore().then((function(){return e.reFetchObservableQueries()}))},e.prototype.reFetchObservableQueries=function(e){var t=this;void 0===e&&(e=!1);var i=[];return this.queries.forEach((function(n,s){var r=n.observableQuery;if(r&&r.hasObservers()){var o=r.options.fetchPolicy;r.resetLastResults(),"cache-only"===o||!e&&"standby"===o||i.push(r.refetch()),t.getQuery(s).setDiff(null)}})),this.broadcastQueries(),Promise.all(i)},e.prototype.setObservableQuery=function(e){this.getQuery(e.queryId).setObservableQuery(e)},e.prototype.startGraphQLSubscription=function(e){var t=this,i=e.query,n=e.fetchPolicy,s=e.errorPolicy,r=e.variables,a=e.context,l=void 0===a?{}:a;i=this.transform(i).document,r=this.getVariables(i,r);var c=function(e){return t.getObservableFromLink(i,l,e,!1).map((function(r){if("no-cache"!==n&&(at(r,s)&&t.cache.write({query:i,result:r.data,dataId:"ROOT_SUBSCRIPTION",variables:e}),t.broadcastQueries()),(0,o.d2)(r))throw new A({graphQLErrors:r.errors});return r}))};if(this.transform(i).hasClientExports){var h=this.localState.addExportedVariables(i,r,l).then(c);return new o.y$((function(e){var t=null;return h.then((function(i){return t=i.subscribe(e)}),e.error),function(){return t&&t.unsubscribe()}}))}return c(r)},e.prototype.stopQuery=function(e){this.stopQueryNoBroadcast(e),this.broadcastQueries()},e.prototype.stopQueryNoBroadcast=function(e){this.stopQueryInStoreNoBroadcast(e),this.removeQuery(e)},e.prototype.removeQuery=function(e){this.fetchCancelFns.delete(e),this.getQuery(e).stop(),this.queries.delete(e)},e.prototype.broadcastQueries=function(){this.onBroadcast&&this.onBroadcast(),this.queries.forEach((function(e){return e.notify()}))},e.prototype.getLocalState=function(){return this.localState},e.prototype.getObservableFromLink=function(e,t,i,s){var a,l,c=this;void 0===s&&(s=null!==(a=null==t?void 0:t.queryDeduplication)&&void 0!==a?a:this.queryDeduplication);var h=this.transform(e).serverQuery;if(h){var d=this.inFlightLinkObservables,u=this.link,p={query:h,variables:i,operationName:(0,o.rY)(h)||void 0,context:this.prepareContext((0,n.pi)((0,n.pi)({},t),{forceFetch:!s}))};if(t=p.context,s){var m=d.get(h)||new Map;d.set(h,m);var g=JSON.stringify(i);if(!(l=m.get(g))){var f=new o.X_([(0,r.ht)(u,p)]);m.set(g,l=f),f.cleanup((function(){m.delete(g)&&m.size<1&&d.delete(h)}))}}else l=new o.X_([(0,r.ht)(u,p)])}else l=new o.X_([o.y$.of({data:{}})]),t=this.prepareContext(t);var v=this.transform(e).clientQuery;return v&&(l=(0,o.sz)(l,(function(e){return c.localState.runResolvers({document:v,remoteResult:e,context:t,variables:i})}))),l},e.prototype.getResultsFromLink=function(e,t,i){var n=e.lastRequestId;return(0,o.sz)(this.getObservableFromLink(e.document,i.context,i.variables),(function(s){var r=(0,o.Of)(s.errors);if(n>=e.lastRequestId){if(r&&"none"===i.errorPolicy)throw e.markError(new A({graphQLErrors:s.errors}));e.markResult(s,i,t),e.markReady()}var a={data:s.data,loading:!1,networkStatus:e.networkStatus||x.ready};return r&&"ignore"!==i.errorPolicy&&(a.errors=s.errors),a}),(function(t){var i=t.hasOwnProperty("graphQLErrors")?t:new A({networkError:t});throw n>=e.lastRequestId&&e.markError(i),i}))},e.prototype.fetchQueryObservable=function(e,t,i){var n=this;void 0===i&&(i=x.loading);var s=this.transform(t.query).document,r=this.getVariables(s,t.variables),a=this.getQuery(e),l=a.networkStatus,c=t.fetchPolicy,h=void 0===c?"cache-first":c,d=t.errorPolicy,u=void 0===d?"none":d,p=t.returnPartialData,m=void 0!==p&&p,g=t.notifyOnNetworkStatusChange,f=void 0!==g&&g,v=t.context,y=void 0===v?{}:v;("cache-first"===h||"cache-and-network"===h||"network-only"===h||"no-cache"===h)&&f&&"number"==typeof l&&l!==i&&O(i)&&("cache-first"!==h&&(h="cache-and-network"),m=!0);var b=Object.assign({},t,{query:s,variables:r,fetchPolicy:h,errorPolicy:u,returnPartialData:m,notifyOnNetworkStatusChange:f,context:y}),S=function(e){return b.variables=e,n.fetchQueryByPolicy(a,b,i)};this.fetchCancelFns.set(e,(function(e){Promise.resolve().then((function(){return E.cancel(e)}))}));var E=new o.X_(this.transform(b.query).hasClientExports?this.localState.addExportedVariables(b.query,b.variables,b.context).then(S):S(b.variables));return E.cleanup((function(){n.fetchCancelFns.delete(e);var i=t.nextFetchPolicy;i&&(t.nextFetchPolicy=void 0,t.fetchPolicy="function"==typeof i?i.call(t,t.fetchPolicy||"cache-first"):i)})),E},e.prototype.fetchQueryByPolicy=function(e,t,i){var s=this,r=t.query,a=t.variables,l=t.fetchPolicy,c=t.errorPolicy,h=t.returnPartialData,d=t.context;e.init({document:r,variables:a,lastRequestId:this.generateRequestId(),networkStatus:i});var u=function(){return e.getDiff(a)},p=function(t,i){void 0===i&&(i=e.networkStatus||x.loading);var l=t.result;var c=function(e){return o.y$.of((0,n.pi)({data:e,loading:O(i),networkStatus:i},t.complete?null:{partial:!0}))};return s.transform(r).hasForcedResolvers?s.localState.runResolvers({document:r,remoteResult:{data:l},context:d,variables:a,onlyRunForcedResolvers:!0}).then((function(e){return c(e.data)})):c(l)},m=function(t){return s.getResultsFromLink(e,t,{variables:a,context:d,fetchPolicy:l,errorPolicy:c})};switch(l){default:case"cache-first":return(g=u()).complete?[p(g,e.markReady())]:h?[p(g),m(!0)]:[m(!0)];case"cache-and-network":var g;return(g=u()).complete||h?[p(g),m(!0)]:[m(!0)];case"cache-only":return[p(u(),e.markReady())];case"network-only":return[m(!0)];case"no-cache":return[m(!1)];case"standby":return[]}},e.prototype.getQuery=function(e){return e&&!this.queries.has(e)&&this.queries.set(e,new ot(this.cache)),this.queries.get(e)},e.prototype.prepareContext=function(e){void 0===e&&(e={});var t=this.localState.prepareContext(e);return(0,n.pi)((0,n.pi)({},t),{clientAwareness:this.clientAwareness})},e}();function ht(e,t){return(0,o.oA)(e,t,t.variables&&{variables:(0,n.pi)((0,n.pi)({},e.variables),t.variables)})}var dt=function(){function e(e){var t=this;this.defaultOptions={},this.resetStoreCallbacks=[],this.clearStoreCallbacks=[];var i=e.uri,n=e.credentials,o=e.headers,a=e.cache,l=e.ssrMode,c=void 0!==l&&l,h=e.ssrForceFetchDelay,d=void 0===h?0:h,u=e.connectToDevTools,p=void 0===u?"object"==typeof window&&!window.__APOLLO_CLIENT__&&!1:u,g=e.queryDeduplication,f=void 0===g||g,v=e.defaultOptions,y=e.assumeImmutableResults,b=void 0!==y&&y,S=e.resolvers,E=e.typeDefs,w=e.fragmentMatcher,T=e.name,_=e.version,M=e.link;if(M||(M=i?new m({uri:i,credentials:n,headers:o}):r.i0.empty()),!a)throw new s.ej(9);this.link=M,this.cache=a,this.disableNetworkFetches=c||d>0,this.queryDeduplication=f,this.defaultOptions=v||{},this.typeDefs=E,d&&setTimeout((function(){return t.disableNetworkFetches=!1}),d),this.watchQuery=this.watchQuery.bind(this),this.query=this.query.bind(this),this.mutate=this.mutate.bind(this),this.resetStore=this.resetStore.bind(this),this.reFetchObservableQueries=this.reFetchObservableQueries.bind(this),p&&"object"==typeof window&&(window.__APOLLO_CLIENT__=this),this.version="3.3.11",this.localState=new it({cache:a,client:this,resolvers:S,fragmentMatcher:w}),this.queryManager=new ct({cache:this.cache,link:this.link,queryDeduplication:f,ssrMode:c,clientAwareness:{name:T,version:_},localState:this.localState,assumeImmutableResults:b,onBroadcast:p?function(){t.devToolsHookCb&&t.devToolsHookCb({action:{},state:{queries:t.queryManager.getQueryStore(),mutations:t.queryManager.mutationStore||{}},dataWithOptimisticResults:t.cache.extract(!0)})}:void 0})}return e.prototype.stop=function(){this.queryManager.stop()},e.prototype.watchQuery=function(e){return this.defaultOptions.watchQuery&&(e=ht(this.defaultOptions.watchQuery,e)),!this.disableNetworkFetches||"network-only"!==e.fetchPolicy&&"cache-and-network"!==e.fetchPolicy||(e=(0,n.pi)((0,n.pi)({},e),{fetchPolicy:"cache-first"})),this.queryManager.watchQuery(e)},e.prototype.query=function(e){return this.defaultOptions.query&&(e=ht(this.defaultOptions.query,e)),(0,s.kG)("cache-and-network"!==e.fetchPolicy,10),this.disableNetworkFetches&&"network-only"===e.fetchPolicy&&(e=(0,n.pi)((0,n.pi)({},e),{fetchPolicy:"cache-first"})),this.queryManager.query(e)},e.prototype.mutate=function(e){return this.defaultOptions.mutate&&(e=ht(this.defaultOptions.mutate,e)),this.queryManager.mutate(e)},e.prototype.subscribe=function(e){return this.queryManager.startGraphQLSubscription(e)},e.prototype.readQuery=function(e,t){return void 0===t&&(t=!1),this.cache.readQuery(e,t)},e.prototype.readFragment=function(e,t){return void 0===t&&(t=!1),this.cache.readFragment(e,t)},e.prototype.writeQuery=function(e){this.cache.writeQuery(e),this.queryManager.broadcastQueries()},e.prototype.writeFragment=function(e){this.cache.writeFragment(e),this.queryManager.broadcastQueries()},e.prototype.__actionHookForDevTools=function(e){this.devToolsHookCb=e},e.prototype.__requestRaw=function(e){return(0,r.ht)(this.link,e)},e.prototype.resetStore=function(){var e=this;return Promise.resolve().then((function(){return e.queryManager.clearStore()})).then((function(){return Promise.all(e.resetStoreCallbacks.map((function(e){return e()})))})).then((function(){return e.reFetchObservableQueries()}))},e.prototype.clearStore=function(){var e=this;return Promise.resolve().then((function(){return e.queryManager.clearStore()})).then((function(){return Promise.all(e.clearStoreCallbacks.map((function(e){return e()})))}))},e.prototype.onResetStore=function(e){var t=this;return this.resetStoreCallbacks.push(e),function(){t.resetStoreCallbacks=t.resetStoreCallbacks.filter((function(t){return t!==e}))}},e.prototype.onClearStore=function(e){var t=this;return this.clearStoreCallbacks.push(e),function(){t.clearStoreCallbacks=t.clearStoreCallbacks.filter((function(t){return t!==e}))}},e.prototype.reFetchObservableQueries=function(e){return this.queryManager.reFetchObservableQueries(e)},e.prototype.extract=function(e){return this.cache.extract(e)},e.prototype.restore=function(e){return this.cache.restore(e)},e.prototype.addResolvers=function(e){this.localState.addResolvers(e)},e.prototype.setResolvers=function(e){this.localState.setResolvers(e)},e.prototype.getResolvers=function(){return this.localState.getResolvers()},e.prototype.setLocalStateFragmentMatcher=function(e){this.localState.setFragmentMatcher(e)},e.prototype.setLink=function(e){this.link=this.queryManager.link=e},e}();i(72191),i(35367);function ut(e){return(ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}"function"==typeof Symbol&&null!=Symbol.iterator&&Symbol.iterator,"function"==typeof Symbol&&null!=Symbol.asyncIterator&&Symbol.asyncIterator;var pt="function"==typeof Symbol&&null!=Symbol.toStringTag?Symbol.toStringTag:"@@toStringTag";function mt(e,t){for(var i,n=/\r\n|[\n\r]/g,s=1,r=t+1;(i=n.exec(e.body))&&i.index<t;)s+=1,r=t+1-(i.index+i[0].length);return{line:s,column:r}}function gt(e){return ft(e.source,mt(e.source,e.start))}function ft(e,t){var i=e.locationOffset.column-1,n=yt(i)+e.body,s=t.line-1,r=e.locationOffset.line-1,o=t.line+r,a=1===t.line?i:0,l=t.column+a,c="".concat(e.name,":").concat(o,":").concat(l,"\n"),h=n.split(/\r\n|[\n\r]/g),d=h[s];if(d.length>120){for(var u=Math.floor(l/80),p=l%80,m=[],g=0;g<d.length;g+=80)m.push(d.slice(g,g+80));return c+vt([["".concat(o),m[0]]].concat(m.slice(1,u+1).map((function(e){return["",e]})),[[" ",yt(p-1)+"^"],["",m[u+1]]]))}return c+vt([["".concat(o-1),h[s-1]],["".concat(o),d],["",yt(l-1)+"^"],["".concat(o+1),h[s+1]]])}function vt(e){var t=e.filter((function(e){e[0];return void 0!==e[1]})),i=Math.max.apply(Math,t.map((function(e){return e[0].length})));return t.map((function(e){var t,n=e[0],s=e[1];return yt(i-(t=n).length)+t+(s?" | "+s:" |")})).join("\n")}function yt(e){return Array(e+1).join(" ")}function bt(e){return(bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function St(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Et(e,t){return!t||"object"!==bt(t)&&"function"!=typeof t?wt(e):t}function wt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Tt(e){var t="function"==typeof Map?new Map:void 0;return(Tt=function(e){if(null===e||(i=e,-1===Function.toString.call(i).indexOf("[native code]")))return e;var i;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _t(e,arguments,At(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),xt(n,e)})(e)}function _t(e,t,i){return(_t=Mt()?Reflect.construct:function(e,t,i){var n=[null];n.push.apply(n,t);var s=new(Function.bind.apply(e,n));return i&&xt(s,i.prototype),s}).apply(null,arguments)}function Mt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function xt(e,t){return(xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function At(e){return(At=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ot=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xt(e,t)}(a,e);var t,i,n,s,r,o=(t=a,i=Mt(),function(){var e,n=At(t);if(i){var s=At(this).constructor;e=Reflect.construct(n,arguments,s)}else e=n.apply(this,arguments);return Et(this,e)});function a(e,t,i,n,s,r,l){var c,h,d,u,p;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),p=o.call(this,e);var m,g=Array.isArray(t)?0!==t.length?t:void 0:t?[t]:void 0,f=i;!f&&g&&(f=null===(m=g[0].loc)||void 0===m?void 0:m.source);var v,y=n;!y&&g&&(y=g.reduce((function(e,t){return t.loc&&e.push(t.loc.start),e}),[])),y&&0===y.length&&(y=void 0),n&&i?v=n.map((function(e){return mt(i,e)})):g&&(v=g.reduce((function(e,t){return t.loc&&e.push(mt(t.loc.source,t.loc.start)),e}),[]));var b,S=l;if(null==S&&null!=r){var E=r.extensions;"object"==ut(b=E)&&null!==b&&(S=E)}return Object.defineProperties(wt(p),{name:{value:"GraphQLError"},message:{value:e,enumerable:!0,writable:!0},locations:{value:null!==(c=v)&&void 0!==c?c:void 0,enumerable:null!=v},path:{value:null!=s?s:void 0,enumerable:null!=s},nodes:{value:null!=g?g:void 0},source:{value:null!==(h=f)&&void 0!==h?h:void 0},positions:{value:null!==(d=y)&&void 0!==d?d:void 0},originalError:{value:r},extensions:{value:null!==(u=S)&&void 0!==u?u:void 0,enumerable:null!=S}}),null!=r&&r.stack?(Object.defineProperty(wt(p),"stack",{value:r.stack,writable:!0,configurable:!0}),Et(p)):(Error.captureStackTrace?Error.captureStackTrace(wt(p),a):Object.defineProperty(wt(p),"stack",{value:Error().stack,writable:!0,configurable:!0}),p)}return n=a,(s=[{key:"toString",value:function(){return function(e){var t=e.message;if(e.nodes)for(var i=0,n=e.nodes;i<n.length;i++){var s=n[i];s.loc&&(t+="\n\n"+gt(s.loc))}else if(e.source&&e.locations)for(var r=0,o=e.locations;r<o.length;r++){var a=o[r];t+="\n\n"+ft(e.source,a)}return t}(this)}},{key:pt,get:function(){return"Object"}}])&&St(n.prototype,s),r&&St(n,r),a}(Tt(Error));function Pt(e,t,i){return new Ot("Syntax Error: ".concat(i),void 0,e,[t])}var Dt=Object.freeze({NAME:"Name",DOCUMENT:"Document",OPERATION_DEFINITION:"OperationDefinition",VARIABLE_DEFINITION:"VariableDefinition",SELECTION_SET:"SelectionSet",FIELD:"Field",ARGUMENT:"Argument",FRAGMENT_SPREAD:"FragmentSpread",INLINE_FRAGMENT:"InlineFragment",FRAGMENT_DEFINITION:"FragmentDefinition",VARIABLE:"Variable",INT:"IntValue",FLOAT:"FloatValue",STRING:"StringValue",BOOLEAN:"BooleanValue",NULL:"NullValue",ENUM:"EnumValue",LIST:"ListValue",OBJECT:"ObjectValue",OBJECT_FIELD:"ObjectField",DIRECTIVE:"Directive",NAMED_TYPE:"NamedType",LIST_TYPE:"ListType",NON_NULL_TYPE:"NonNullType",SCHEMA_DEFINITION:"SchemaDefinition",OPERATION_TYPE_DEFINITION:"OperationTypeDefinition",SCALAR_TYPE_DEFINITION:"ScalarTypeDefinition",OBJECT_TYPE_DEFINITION:"ObjectTypeDefinition",FIELD_DEFINITION:"FieldDefinition",INPUT_VALUE_DEFINITION:"InputValueDefinition",INTERFACE_TYPE_DEFINITION:"InterfaceTypeDefinition",UNION_TYPE_DEFINITION:"UnionTypeDefinition",ENUM_TYPE_DEFINITION:"EnumTypeDefinition",ENUM_VALUE_DEFINITION:"EnumValueDefinition",INPUT_OBJECT_TYPE_DEFINITION:"InputObjectTypeDefinition",DIRECTIVE_DEFINITION:"DirectiveDefinition",SCHEMA_EXTENSION:"SchemaExtension",SCALAR_TYPE_EXTENSION:"ScalarTypeExtension",OBJECT_TYPE_EXTENSION:"ObjectTypeExtension",INTERFACE_TYPE_EXTENSION:"InterfaceTypeExtension",UNION_TYPE_EXTENSION:"UnionTypeExtension",ENUM_TYPE_EXTENSION:"EnumTypeExtension",INPUT_OBJECT_TYPE_EXTENSION:"InputObjectTypeExtension"}),Ct=i(83059),It=Object.freeze({SOF:"<SOF>",EOF:"<EOF>",BANG:"!",DOLLAR:"$",AMP:"&",PAREN_L:"(",PAREN_R:")",SPREAD:"...",COLON:":",EQUALS:"=",AT:"@",BRACKET_L:"[",BRACKET_R:"]",BRACE_L:"{",PIPE:"|",BRACE_R:"}",NAME:"Name",INT:"Int",FLOAT:"Float",STRING:"String",BLOCK_STRING:"BlockString",COMMENT:"Comment"}),Lt=i(6589);function Rt(e,t){if(!Boolean(e))throw new Error(t)}const Nt=function(e,t){return e instanceof t};function kt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Bt=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GraphQL request",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{line:1,column:1};"string"==typeof e||Rt(0,"Body must be a string. Received: ".concat((0,Lt.Z)(e),".")),this.body=e,this.name=t,this.locationOffset=i,this.locationOffset.line>0||Rt(0,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||Rt(0,"column in locationOffset is 1-indexed and must be positive.")}var t,i,n;return t=e,(i=[{key:pt,get:function(){return"Source"}}])&&kt(t.prototype,i),n&&kt(t,n),e}();var Ft=Object.freeze({QUERY:"QUERY",MUTATION:"MUTATION",SUBSCRIPTION:"SUBSCRIPTION",FIELD:"FIELD",FRAGMENT_DEFINITION:"FRAGMENT_DEFINITION",FRAGMENT_SPREAD:"FRAGMENT_SPREAD",INLINE_FRAGMENT:"INLINE_FRAGMENT",VARIABLE_DEFINITION:"VARIABLE_DEFINITION",SCHEMA:"SCHEMA",SCALAR:"SCALAR",OBJECT:"OBJECT",FIELD_DEFINITION:"FIELD_DEFINITION",ARGUMENT_DEFINITION:"ARGUMENT_DEFINITION",INTERFACE:"INTERFACE",UNION:"UNION",ENUM:"ENUM",ENUM_VALUE:"ENUM_VALUE",INPUT_OBJECT:"INPUT_OBJECT",INPUT_FIELD_DEFINITION:"INPUT_FIELD_DEFINITION"}),Ut=i(7420),Vt=function(){function e(e){var t=new Ct.WU(It.SOF,0,0,0,0,null);this.source=e,this.lastToken=t,this.token=t,this.line=1,this.lineStart=0}var t=e.prototype;return t.advance=function(){return this.lastToken=this.token,this.token=this.lookahead()},t.lookahead=function(){var e=this.token;if(e.kind!==It.EOF)do{var t;e=null!==(t=e.next)&&void 0!==t?t:e.next=Gt(this,e)}while(e.kind===It.COMMENT);return e},e}();function Ht(e){return isNaN(e)?It.EOF:e<127?JSON.stringify(String.fromCharCode(e)):'"\\u'.concat(("00"+e.toString(16).toUpperCase()).slice(-4),'"')}function Gt(e,t){for(var i=e.source,n=i.body,s=n.length,r=t.end;r<s;){var o=n.charCodeAt(r),a=e.line,l=1+r-e.lineStart;switch(o){case 65279:case 9:case 32:case 44:++r;continue;case 10:++r,++e.line,e.lineStart=r;continue;case 13:10===n.charCodeAt(r+1)?r+=2:++r,++e.line,e.lineStart=r;continue;case 33:return new Ct.WU(It.BANG,r,r+1,a,l,t);case 35:return Wt(i,r,a,l,t);case 36:return new Ct.WU(It.DOLLAR,r,r+1,a,l,t);case 38:return new Ct.WU(It.AMP,r,r+1,a,l,t);case 40:return new Ct.WU(It.PAREN_L,r,r+1,a,l,t);case 41:return new Ct.WU(It.PAREN_R,r,r+1,a,l,t);case 46:if(46===n.charCodeAt(r+1)&&46===n.charCodeAt(r+2))return new Ct.WU(It.SPREAD,r,r+3,a,l,t);break;case 58:return new Ct.WU(It.COLON,r,r+1,a,l,t);case 61:return new Ct.WU(It.EQUALS,r,r+1,a,l,t);case 64:return new Ct.WU(It.AT,r,r+1,a,l,t);case 91:return new Ct.WU(It.BRACKET_L,r,r+1,a,l,t);case 93:return new Ct.WU(It.BRACKET_R,r,r+1,a,l,t);case 123:return new Ct.WU(It.BRACE_L,r,r+1,a,l,t);case 124:return new Ct.WU(It.PIPE,r,r+1,a,l,t);case 125:return new Ct.WU(It.BRACE_R,r,r+1,a,l,t);case 34:return 34===n.charCodeAt(r+1)&&34===n.charCodeAt(r+2)?Zt(i,r,a,l,t,e):qt(i,r,a,l,t);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return jt(i,r,o,a,l,t);case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 95:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:return $t(i,r,a,l,t)}throw Pt(i,r,zt(o))}var c=e.line,h=1+r-e.lineStart;return new Ct.WU(It.EOF,s,s,c,h,t)}function zt(e){return e<32&&9!==e&&10!==e&&13!==e?"Cannot contain the invalid character ".concat(Ht(e),"."):39===e?"Unexpected single quote character ('), did you mean to use a double quote (\")?":"Cannot parse the unexpected character ".concat(Ht(e),".")}function Wt(e,t,i,n,s){var r,o=e.body,a=t;do{r=o.charCodeAt(++a)}while(!isNaN(r)&&(r>31||9===r));return new Ct.WU(It.COMMENT,t,a,i,n,s,o.slice(t+1,a))}function jt(e,t,i,n,s,r){var o=e.body,a=i,l=t,c=!1;if(45===a&&(a=o.charCodeAt(++l)),48===a){if((a=o.charCodeAt(++l))>=48&&a<=57)throw Pt(e,l,"Invalid number, unexpected digit after 0: ".concat(Ht(a),"."))}else l=Kt(e,l,a),a=o.charCodeAt(l);if(46===a&&(c=!0,a=o.charCodeAt(++l),l=Kt(e,l,a),a=o.charCodeAt(l)),69!==a&&101!==a||(c=!0,43!==(a=o.charCodeAt(++l))&&45!==a||(a=o.charCodeAt(++l)),l=Kt(e,l,a),a=o.charCodeAt(l)),46===a||function(e){return 95===e||e>=65&&e<=90||e>=97&&e<=122}(a))throw Pt(e,l,"Invalid number, expected digit but got: ".concat(Ht(a),"."));return new Ct.WU(c?It.FLOAT:It.INT,t,l,n,s,r,o.slice(t,l))}function Kt(e,t,i){var n=e.body,s=t,r=i;if(r>=48&&r<=57){do{r=n.charCodeAt(++s)}while(r>=48&&r<=57);return s}throw Pt(e,s,"Invalid number, expected digit but got: ".concat(Ht(r),"."))}function qt(e,t,i,n,s){for(var r,o,a,l,c=e.body,h=t+1,d=h,u=0,p="";h<c.length&&!isNaN(u=c.charCodeAt(h))&&10!==u&&13!==u;){if(34===u)return p+=c.slice(d,h),new Ct.WU(It.STRING,t,h+1,i,n,s,p);if(u<32&&9!==u)throw Pt(e,h,"Invalid character within String: ".concat(Ht(u),"."));if(++h,92===u){switch(p+=c.slice(d,h-1),u=c.charCodeAt(h)){case 34:p+='"';break;case 47:p+="/";break;case 92:p+="\\";break;case 98:p+="\b";break;case 102:p+="\f";break;case 110:p+="\n";break;case 114:p+="\r";break;case 116:p+="\t";break;case 117:var m=(r=c.charCodeAt(h+1),o=c.charCodeAt(h+2),a=c.charCodeAt(h+3),l=c.charCodeAt(h+4),Yt(r)<<12|Yt(o)<<8|Yt(a)<<4|Yt(l));if(m<0){var g=c.slice(h+1,h+5);throw Pt(e,h,"Invalid character escape sequence: \\u".concat(g,"."))}p+=String.fromCharCode(m),h+=4;break;default:throw Pt(e,h,"Invalid character escape sequence: \\".concat(String.fromCharCode(u),"."))}d=++h}}throw Pt(e,h,"Unterminated string.")}function Zt(e,t,i,n,s,r){for(var o=e.body,a=t+3,l=a,c=0,h="";a<o.length&&!isNaN(c=o.charCodeAt(a));){if(34===c&&34===o.charCodeAt(a+1)&&34===o.charCodeAt(a+2))return h+=o.slice(l,a),new Ct.WU(It.BLOCK_STRING,t,a+3,i,n,s,(0,Ut.W7)(h));if(c<32&&9!==c&&10!==c&&13!==c)throw Pt(e,a,"Invalid character within String: ".concat(Ht(c),"."));10===c?(++a,++r.line,r.lineStart=a):13===c?(10===o.charCodeAt(a+1)?a+=2:++a,++r.line,r.lineStart=a):92===c&&34===o.charCodeAt(a+1)&&34===o.charCodeAt(a+2)&&34===o.charCodeAt(a+3)?(h+=o.slice(l,a)+'"""',l=a+=4):++a}throw Pt(e,a,"Unterminated string.")}function Yt(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:-1}function $t(e,t,i,n,s){for(var r=e.body,o=r.length,a=t+1,l=0;a!==o&&!isNaN(l=r.charCodeAt(a))&&(95===l||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122);)++a;return new Ct.WU(It.NAME,t,a,i,n,s,r.slice(t,a))}var Qt=function(){function e(e,t){var i=function(e){return Nt(e,Bt)}(e)?e:new Bt(e);this._lexer=new Vt(i),this._options=t}var t=e.prototype;return t.parseName=function(){var e=this.expectToken(It.NAME);return{kind:Dt.NAME,value:e.value,loc:this.loc(e)}},t.parseDocument=function(){var e=this._lexer.token;return{kind:Dt.DOCUMENT,definitions:this.many(It.SOF,this.parseDefinition,It.EOF),loc:this.loc(e)}},t.parseDefinition=function(){if(this.peek(It.NAME))switch(this._lexer.token.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"schema":case"scalar":case"type":case"interface":case"union":case"enum":case"input":case"directive":return this.parseTypeSystemDefinition();case"extend":return this.parseTypeSystemExtension()}else{if(this.peek(It.BRACE_L))return this.parseOperationDefinition();if(this.peekDescription())return this.parseTypeSystemDefinition()}throw this.unexpected()},t.parseOperationDefinition=function(){var e=this._lexer.token;if(this.peek(It.BRACE_L))return{kind:Dt.OPERATION_DEFINITION,operation:"query",name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet(),loc:this.loc(e)};var t,i=this.parseOperationType();return this.peek(It.NAME)&&(t=this.parseName()),{kind:Dt.OPERATION_DEFINITION,operation:i,name:t,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(e)}},t.parseOperationType=function(){var e=this.expectToken(It.NAME);switch(e.value){case"query":return"query";case"mutation":return"mutation";case"subscription":return"subscription"}throw this.unexpected(e)},t.parseVariableDefinitions=function(){return this.optionalMany(It.PAREN_L,this.parseVariableDefinition,It.PAREN_R)},t.parseVariableDefinition=function(){var e=this._lexer.token;return{kind:Dt.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(It.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(It.EQUALS)?this.parseValueLiteral(!0):void 0,directives:this.parseDirectives(!0),loc:this.loc(e)}},t.parseVariable=function(){var e=this._lexer.token;return this.expectToken(It.DOLLAR),{kind:Dt.VARIABLE,name:this.parseName(),loc:this.loc(e)}},t.parseSelectionSet=function(){var e=this._lexer.token;return{kind:Dt.SELECTION_SET,selections:this.many(It.BRACE_L,this.parseSelection,It.BRACE_R),loc:this.loc(e)}},t.parseSelection=function(){return this.peek(It.SPREAD)?this.parseFragment():this.parseField()},t.parseField=function(){var e,t,i=this._lexer.token,n=this.parseName();return this.expectOptionalToken(It.COLON)?(e=n,t=this.parseName()):t=n,{kind:Dt.FIELD,alias:e,name:t,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(It.BRACE_L)?this.parseSelectionSet():void 0,loc:this.loc(i)}},t.parseArguments=function(e){var t=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(It.PAREN_L,t,It.PAREN_R)},t.parseArgument=function(){var e=this._lexer.token,t=this.parseName();return this.expectToken(It.COLON),{kind:Dt.ARGUMENT,name:t,value:this.parseValueLiteral(!1),loc:this.loc(e)}},t.parseConstArgument=function(){var e=this._lexer.token;return{kind:Dt.ARGUMENT,name:this.parseName(),value:(this.expectToken(It.COLON),this.parseValueLiteral(!0)),loc:this.loc(e)}},t.parseFragment=function(){var e=this._lexer.token;this.expectToken(It.SPREAD);var t=this.expectOptionalKeyword("on");return!t&&this.peek(It.NAME)?{kind:Dt.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1),loc:this.loc(e)}:{kind:Dt.INLINE_FRAGMENT,typeCondition:t?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(e)}},t.parseFragmentDefinition=function(){var e,t=this._lexer.token;return this.expectKeyword("fragment"),!0===(null===(e=this._options)||void 0===e?void 0:e.experimentalFragmentVariables)?{kind:Dt.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}:{kind:Dt.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}},t.parseFragmentName=function(){if("on"===this._lexer.token.value)throw this.unexpected();return this.parseName()},t.parseValueLiteral=function(e){var t=this._lexer.token;switch(t.kind){case It.BRACKET_L:return this.parseList(e);case It.BRACE_L:return this.parseObject(e);case It.INT:return this._lexer.advance(),{kind:Dt.INT,value:t.value,loc:this.loc(t)};case It.FLOAT:return this._lexer.advance(),{kind:Dt.FLOAT,value:t.value,loc:this.loc(t)};case It.STRING:case It.BLOCK_STRING:return this.parseStringLiteral();case It.NAME:switch(this._lexer.advance(),t.value){case"true":return{kind:Dt.BOOLEAN,value:!0,loc:this.loc(t)};case"false":return{kind:Dt.BOOLEAN,value:!1,loc:this.loc(t)};case"null":return{kind:Dt.NULL,loc:this.loc(t)};default:return{kind:Dt.ENUM,value:t.value,loc:this.loc(t)}}case It.DOLLAR:if(!e)return this.parseVariable()}throw this.unexpected()},t.parseStringLiteral=function(){var e=this._lexer.token;return this._lexer.advance(),{kind:Dt.STRING,value:e.value,block:e.kind===It.BLOCK_STRING,loc:this.loc(e)}},t.parseList=function(e){var t=this,i=this._lexer.token;return{kind:Dt.LIST,values:this.any(It.BRACKET_L,(function(){return t.parseValueLiteral(e)}),It.BRACKET_R),loc:this.loc(i)}},t.parseObject=function(e){var t=this,i=this._lexer.token;return{kind:Dt.OBJECT,fields:this.any(It.BRACE_L,(function(){return t.parseObjectField(e)}),It.BRACE_R),loc:this.loc(i)}},t.parseObjectField=function(e){var t=this._lexer.token,i=this.parseName();return this.expectToken(It.COLON),{kind:Dt.OBJECT_FIELD,name:i,value:this.parseValueLiteral(e),loc:this.loc(t)}},t.parseDirectives=function(e){for(var t=[];this.peek(It.AT);)t.push(this.parseDirective(e));return t},t.parseDirective=function(e){var t=this._lexer.token;return this.expectToken(It.AT),{kind:Dt.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e),loc:this.loc(t)}},t.parseTypeReference=function(){var e,t=this._lexer.token;return this.expectOptionalToken(It.BRACKET_L)?(e=this.parseTypeReference(),this.expectToken(It.BRACKET_R),e={kind:Dt.LIST_TYPE,type:e,loc:this.loc(t)}):e=this.parseNamedType(),this.expectOptionalToken(It.BANG)?{kind:Dt.NON_NULL_TYPE,type:e,loc:this.loc(t)}:e},t.parseNamedType=function(){var e=this._lexer.token;return{kind:Dt.NAMED_TYPE,name:this.parseName(),loc:this.loc(e)}},t.parseTypeSystemDefinition=function(){var e=this.peekDescription()?this._lexer.lookahead():this._lexer.token;if(e.kind===It.NAME)switch(e.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}throw this.unexpected(e)},t.peekDescription=function(){return this.peek(It.STRING)||this.peek(It.BLOCK_STRING)},t.parseDescription=function(){if(this.peekDescription())return this.parseStringLiteral()},t.parseSchemaDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("schema");var i=this.parseDirectives(!0),n=this.many(It.BRACE_L,this.parseOperationTypeDefinition,It.BRACE_R);return{kind:Dt.SCHEMA_DEFINITION,description:t,directives:i,operationTypes:n,loc:this.loc(e)}},t.parseOperationTypeDefinition=function(){var e=this._lexer.token,t=this.parseOperationType();this.expectToken(It.COLON);var i=this.parseNamedType();return{kind:Dt.OPERATION_TYPE_DEFINITION,operation:t,type:i,loc:this.loc(e)}},t.parseScalarTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("scalar");var i=this.parseName(),n=this.parseDirectives(!0);return{kind:Dt.SCALAR_TYPE_DEFINITION,description:t,name:i,directives:n,loc:this.loc(e)}},t.parseObjectTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("type");var i=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseDirectives(!0),r=this.parseFieldsDefinition();return{kind:Dt.OBJECT_TYPE_DEFINITION,description:t,name:i,interfaces:n,directives:s,fields:r,loc:this.loc(e)}},t.parseImplementsInterfaces=function(){var e;if(!this.expectOptionalKeyword("implements"))return[];if(!0===(null===(e=this._options)||void 0===e?void 0:e.allowLegacySDLImplementsInterfaces)){var t=[];this.expectOptionalToken(It.AMP);do{t.push(this.parseNamedType())}while(this.expectOptionalToken(It.AMP)||this.peek(It.NAME));return t}return this.delimitedMany(It.AMP,this.parseNamedType)},t.parseFieldsDefinition=function(){var e;return!0===(null===(e=this._options)||void 0===e?void 0:e.allowLegacySDLEmptyFields)&&this.peek(It.BRACE_L)&&this._lexer.lookahead().kind===It.BRACE_R?(this._lexer.advance(),this._lexer.advance(),[]):this.optionalMany(It.BRACE_L,this.parseFieldDefinition,It.BRACE_R)},t.parseFieldDefinition=function(){var e=this._lexer.token,t=this.parseDescription(),i=this.parseName(),n=this.parseArgumentDefs();this.expectToken(It.COLON);var s=this.parseTypeReference(),r=this.parseDirectives(!0);return{kind:Dt.FIELD_DEFINITION,description:t,name:i,arguments:n,type:s,directives:r,loc:this.loc(e)}},t.parseArgumentDefs=function(){return this.optionalMany(It.PAREN_L,this.parseInputValueDef,It.PAREN_R)},t.parseInputValueDef=function(){var e=this._lexer.token,t=this.parseDescription(),i=this.parseName();this.expectToken(It.COLON);var n,s=this.parseTypeReference();this.expectOptionalToken(It.EQUALS)&&(n=this.parseValueLiteral(!0));var r=this.parseDirectives(!0);return{kind:Dt.INPUT_VALUE_DEFINITION,description:t,name:i,type:s,defaultValue:n,directives:r,loc:this.loc(e)}},t.parseInterfaceTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("interface");var i=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseDirectives(!0),r=this.parseFieldsDefinition();return{kind:Dt.INTERFACE_TYPE_DEFINITION,description:t,name:i,interfaces:n,directives:s,fields:r,loc:this.loc(e)}},t.parseUnionTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("union");var i=this.parseName(),n=this.parseDirectives(!0),s=this.parseUnionMemberTypes();return{kind:Dt.UNION_TYPE_DEFINITION,description:t,name:i,directives:n,types:s,loc:this.loc(e)}},t.parseUnionMemberTypes=function(){return this.expectOptionalToken(It.EQUALS)?this.delimitedMany(It.PIPE,this.parseNamedType):[]},t.parseEnumTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("enum");var i=this.parseName(),n=this.parseDirectives(!0),s=this.parseEnumValuesDefinition();return{kind:Dt.ENUM_TYPE_DEFINITION,description:t,name:i,directives:n,values:s,loc:this.loc(e)}},t.parseEnumValuesDefinition=function(){return this.optionalMany(It.BRACE_L,this.parseEnumValueDefinition,It.BRACE_R)},t.parseEnumValueDefinition=function(){var e=this._lexer.token,t=this.parseDescription(),i=this.parseName(),n=this.parseDirectives(!0);return{kind:Dt.ENUM_VALUE_DEFINITION,description:t,name:i,directives:n,loc:this.loc(e)}},t.parseInputObjectTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("input");var i=this.parseName(),n=this.parseDirectives(!0),s=this.parseInputFieldsDefinition();return{kind:Dt.INPUT_OBJECT_TYPE_DEFINITION,description:t,name:i,directives:n,fields:s,loc:this.loc(e)}},t.parseInputFieldsDefinition=function(){return this.optionalMany(It.BRACE_L,this.parseInputValueDef,It.BRACE_R)},t.parseTypeSystemExtension=function(){var e=this._lexer.lookahead();if(e.kind===It.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)},t.parseSchemaExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");var t=this.parseDirectives(!0),i=this.optionalMany(It.BRACE_L,this.parseOperationTypeDefinition,It.BRACE_R);if(0===t.length&&0===i.length)throw this.unexpected();return{kind:Dt.SCHEMA_EXTENSION,directives:t,operationTypes:i,loc:this.loc(e)}},t.parseScalarTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");var t=this.parseName(),i=this.parseDirectives(!0);if(0===i.length)throw this.unexpected();return{kind:Dt.SCALAR_TYPE_EXTENSION,name:t,directives:i,loc:this.loc(e)}},t.parseObjectTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");var t=this.parseName(),i=this.parseImplementsInterfaces(),n=this.parseDirectives(!0),s=this.parseFieldsDefinition();if(0===i.length&&0===n.length&&0===s.length)throw this.unexpected();return{kind:Dt.OBJECT_TYPE_EXTENSION,name:t,interfaces:i,directives:n,fields:s,loc:this.loc(e)}},t.parseInterfaceTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");var t=this.parseName(),i=this.parseImplementsInterfaces(),n=this.parseDirectives(!0),s=this.parseFieldsDefinition();if(0===i.length&&0===n.length&&0===s.length)throw this.unexpected();return{kind:Dt.INTERFACE_TYPE_EXTENSION,name:t,interfaces:i,directives:n,fields:s,loc:this.loc(e)}},t.parseUnionTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");var t=this.parseName(),i=this.parseDirectives(!0),n=this.parseUnionMemberTypes();if(0===i.length&&0===n.length)throw this.unexpected();return{kind:Dt.UNION_TYPE_EXTENSION,name:t,directives:i,types:n,loc:this.loc(e)}},t.parseEnumTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");var t=this.parseName(),i=this.parseDirectives(!0),n=this.parseEnumValuesDefinition();if(0===i.length&&0===n.length)throw this.unexpected();return{kind:Dt.ENUM_TYPE_EXTENSION,name:t,directives:i,values:n,loc:this.loc(e)}},t.parseInputObjectTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");var t=this.parseName(),i=this.parseDirectives(!0),n=this.parseInputFieldsDefinition();if(0===i.length&&0===n.length)throw this.unexpected();return{kind:Dt.INPUT_OBJECT_TYPE_EXTENSION,name:t,directives:i,fields:n,loc:this.loc(e)}},t.parseDirectiveDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("directive"),this.expectToken(It.AT);var i=this.parseName(),n=this.parseArgumentDefs(),s=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");var r=this.parseDirectiveLocations();return{kind:Dt.DIRECTIVE_DEFINITION,description:t,name:i,arguments:n,repeatable:s,locations:r,loc:this.loc(e)}},t.parseDirectiveLocations=function(){return this.delimitedMany(It.PIPE,this.parseDirectiveLocation)},t.parseDirectiveLocation=function(){var e=this._lexer.token,t=this.parseName();if(void 0!==Ft[t.value])return t;throw this.unexpected(e)},t.loc=function(e){var t;if(!0!==(null===(t=this._options)||void 0===t?void 0:t.noLocation))return new Ct.Ye(e,this._lexer.lastToken,this._lexer.source)},t.peek=function(e){return this._lexer.token.kind===e},t.expectToken=function(e){var t=this._lexer.token;if(t.kind===e)return this._lexer.advance(),t;throw Pt(this._lexer.source,t.start,"Expected ".concat(Jt(e),", found ").concat(Xt(t),"."))},t.expectOptionalToken=function(e){var t=this._lexer.token;if(t.kind===e)return this._lexer.advance(),t},t.expectKeyword=function(e){var t=this._lexer.token;if(t.kind!==It.NAME||t.value!==e)throw Pt(this._lexer.source,t.start,'Expected "'.concat(e,'", found ').concat(Xt(t),"."));this._lexer.advance()},t.expectOptionalKeyword=function(e){var t=this._lexer.token;return t.kind===It.NAME&&t.value===e&&(this._lexer.advance(),!0)},t.unexpected=function(e){var t=null!=e?e:this._lexer.token;return Pt(this._lexer.source,t.start,"Unexpected ".concat(Xt(t),"."))},t.any=function(e,t,i){this.expectToken(e);for(var n=[];!this.expectOptionalToken(i);)n.push(t.call(this));return n},t.optionalMany=function(e,t,i){if(this.expectOptionalToken(e)){var n=[];do{n.push(t.call(this))}while(!this.expectOptionalToken(i));return n}return[]},t.many=function(e,t,i){this.expectToken(e);var n=[];do{n.push(t.call(this))}while(!this.expectOptionalToken(i));return n},t.delimitedMany=function(e,t){this.expectOptionalToken(e);var i=[];do{i.push(t.call(this))}while(this.expectOptionalToken(e));return i},e}();function Xt(e){var t=e.value;return Jt(e.kind)+(null!=t?' "'.concat(t,'"'):"")}function Jt(e){return function(e){return e===It.BANG||e===It.DOLLAR||e===It.AMP||e===It.PAREN_L||e===It.PAREN_R||e===It.SPREAD||e===It.COLON||e===It.EQUALS||e===It.AT||e===It.BRACKET_L||e===It.BRACKET_R||e===It.BRACE_L||e===It.PIPE||e===It.BRACE_R}(e)?'"'.concat(e,'"'):e}var ei=new Map,ti=new Map,ii=!0,ni=!1;function si(e){return e.replace(/[\s,]+/g," ").trim()}function ri(e){var t=new Set,i=[];return e.definitions.forEach((function(e){if("FragmentDefinition"===e.kind){var n=e.name.value,s=si((o=e.loc).source.body.substring(o.start,o.end)),r=ti.get(n);r&&!r.has(s)?ii&&console.warn("Warning: fragment with name "+n+" already exists.\ngraphql-tag enforces all fragment names across your application to be unique; read more about\nthis in the docs: http://dev.apollodata.com/core/fragments.html#unique-names"):r||ti.set(n,r=new Set),r.add(s),t.has(s)||(t.add(s),i.push(e))}else i.push(e);var o})),(0,n.pi)((0,n.pi)({},e),{definitions:i})}function oi(e){var t=si(e);if(!ei.has(t)){var i=function(e,t){return new Qt(e,t).parseDocument()}(e,{experimentalFragmentVariables:ni});if(!i||"Document"!==i.kind)throw new Error("Not a valid GraphQL document.");ei.set(t,function(e){var t=new Set(e.definitions);t.forEach((function(e){e.loc&&delete e.loc,Object.keys(e).forEach((function(i){var n=e[i];n&&"object"==typeof n&&t.add(n)}))}));var i=e.loc;return i&&(delete i.startToken,delete i.endToken),e}(ri(i)))}return ei.get(t)}function ai(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];"string"==typeof e&&(e=[e]);var n=e[0];return t.forEach((function(t,i){t&&"Document"===t.kind?n+=t.loc.source.body:n+=t,n+=e[i+1]})),oi(n)}const li=Object.assign(ai,{gql:ai,default:ai,resetCaches:function(){ei.clear(),ti.clear()},disableFragmentWarnings:function(){ii=!1},enableExperimentalFragmentVariables:function(){ni=!0},disableExperimentalFragmentVariables:function(){ni=!1}});(0,s.U6)("log");li.resetCaches,li.disableFragmentWarnings,li.enableExperimentalFragmentVariables,li.disableExperimentalFragmentVariables},72191:()=>{},97222:(e,t,i)=>{"use strict";i.d(t,{i:()=>h});var n=i(70655),s=i(92924),r=i(80496),o=i(84913);function a(e,t){return t?t(e):r.y$.of()}function l(e){return"function"==typeof e?new h(e):e}function c(e){return e.request.length<=1}!function(e){function t(t,i){var n=e.call(this,t)||this;return n.link=i,n}(0,n.ZT)(t,e)}(Error);var h=function(){function e(e){e&&(this.request=e)}return e.empty=function(){return new e((function(){return r.y$.of()}))},e.from=function(t){return 0===t.length?e.empty():t.map(l).reduce((function(e,t){return e.concat(t)}))},e.split=function(t,i,n){var s=l(i),o=l(n||new e(a));return c(s)&&c(o)?new e((function(e){return t(e)?s.request(e)||r.y$.of():o.request(e)||r.y$.of()})):new e((function(e,i){return t(e)?s.request(e,i)||r.y$.of():o.request(e,i)||r.y$.of()}))},e.execute=function(e,t){return e.request((0,o.zi)(t.context,(0,o.DQ)((0,o.Ak)(t))))||r.y$.of()},e.concat=function(t,i){var n=l(t);if(c(n))return n;var s=l(i);return c(s)?new e((function(e){return n.request(e,(function(e){return s.request(e)||r.y$.of()}))||r.y$.of()})):new e((function(e,t){return n.request(e,(function(e){return s.request(e,t)||r.y$.of()}))||r.y$.of()}))},e.prototype.split=function(t,i,n){return this.concat(e.split(t,i,n||new e(a)))},e.prototype.concat=function(t){return e.concat(this,t)},e.prototype.request=function(e,t){throw new s.ej(21)},e.prototype.onError=function(e,t){if(t&&t.error)return t.error(e),!1;throw e},e.prototype.setOnError=function(e){return this.onError=e,this},e}()},24957:(e,t,i)=>{"use strict";i(97222).i.concat},67325:(e,t,i)=>{"use strict";i(97222).i.empty},2550:(e,t,i)=>{"use strict";i.d(t,{h:()=>n});var n=i(97222).i.execute},34674:(e,t,i)=>{"use strict";i(97222).i.from},81707:(e,t,i)=>{"use strict";i.d(t,{ht:()=>n.h,i0:()=>s.i});i(67325),i(34674),i(64738),i(24957);var n=i(2550),s=i(97222),r=i(79875);i.o(r,"createHttpLink")&&i.d(t,{createHttpLink:function(){return r.createHttpLink}})},64738:(e,t,i)=>{"use strict";i(97222).i.split},79875:()=>{},84913:(e,t,i)=>{"use strict";i.d(t,{zi:()=>c,Qc:()=>s,PW:()=>o,DQ:()=>h,Ak:()=>a});var n=i(80496);function s(e){return new n.y$((function(t){t.error(e)}))}var r=i(92924);var o=function(e,t,i){var n=new Error(i);throw n.name="ServerError",n.response=e,n.statusCode=e.status,n.result=t,n};function a(e){for(var t=["query","operationName","variables","extensions","context"],i=0,n=Object.keys(e);i<n.length;i++){var s=n[i];if(t.indexOf(s)<0)throw new r.ej(26)}return e}var l=i(70655);function c(e,t){var i=(0,l.pi)({},e);return Object.defineProperty(t,"setContext",{enumerable:!1,value:function(e){i="function"==typeof e?(0,l.pi)((0,l.pi)({},i),e(i)):(0,l.pi)((0,l.pi)({},i),e)}}),Object.defineProperty(t,"getContext",{enumerable:!1,value:function(){return(0,l.pi)({},i)}}),t}function h(e){var t={variables:e.variables||{},extensions:e.extensions||{},operationName:e.operationName,query:e.query};return t.operationName||(t.operationName="string"!=typeof t.query?(0,n.rY)(t.query)||void 0:""),t}},80496:(e,t,i)=>{"use strict";i.d(t,{X_:()=>oe,w0:()=>Y,y$:()=>Q(),Gw:()=>F,NC:()=>S,sz:()=>ne,aL:()=>G,mr:()=>ce,Xh:()=>J,oA:()=>he,F:()=>h,Dy:()=>se,O4:()=>C,kU:()=>O,hi:()=>d,Yk:()=>c,p$:()=>D,$H:()=>x,rY:()=>A,iW:()=>P,PT:()=>b,qw:()=>w,d2:()=>le,mj:()=>a,FS:()=>o,My:()=>T,Ao:()=>_,Of:()=>ae,hh:()=>g,pM:()=>ie,kQ:()=>m,Jv:()=>te,Ee:()=>j,bw:()=>K,ob:()=>z,Fo:()=>V,u2:()=>E,LZ:()=>r,vf:()=>v});var n=i(27636),s=i(92924);function r(e,t){var i=e.directives;return!i||!i.length||function(e){var t=[];e&&e.length&&e.forEach((function(e){if(function(e){var t=e.name.value;return"skip"===t||"include"===t}(e)){var i=e.arguments;e.name.value;(0,s.kG)(i&&1===i.length,39);var n=i[0];(0,s.kG)(n.name&&"if"===n.name.value,40);var r=n.value;(0,s.kG)(r&&("Variable"===r.kind||"BooleanValue"===r.kind),41),t.push({directive:e,ifArgument:n})}}));return t}(i).every((function(e){var i=e.directive,n=e.ifArgument,r=!1;return"Variable"===n.value.kind?(r=t&&t[n.value.name.value],(0,s.kG)(void 0!==r,38)):r=n.value.value,"skip"===i.name.value?!r:r}))}function o(e,t){return function(e){var t=[];return(0,n.Vn)(e,{Directive:function(e){t.push(e.name.value)}}),t}(t).some((function(t){return e.indexOf(t)>-1}))}function a(e){return e&&o(["client"],e)&&o(["export"],e)}var l=i(70655);function c(e,t){var i=t,n=[];return e.definitions.forEach((function(e){if("OperationDefinition"===e.kind)throw new s.ej(42);"FragmentDefinition"===e.kind&&n.push(e)})),void 0===i&&((0,s.kG)(1===n.length,43),i=n[0].name.value),(0,l.pi)((0,l.pi)({},e),{definitions:(0,l.pr)([{kind:"OperationDefinition",operation:"query",selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:i}}]}}],e.definitions)})}function h(e){void 0===e&&(e=[]);var t={};return e.forEach((function(e){t[e.name.value]=e})),t}function d(e,t){switch(e.kind){case"InlineFragment":return e;case"FragmentSpread":var i=t&&t[e.name.value];return(0,s.kG)(i,44),i;default:return null}}var u=i(35035),p=i.n(u);function m(e){return{__ref:String(e)}}function g(e){return Boolean(e&&"object"==typeof e&&"string"==typeof e.__ref)}function f(e,t,i,n){if(function(e){return"IntValue"===e.kind}(i)||function(e){return"FloatValue"===e.kind}(i))e[t.value]=Number(i.value);else if(function(e){return"BooleanValue"===e.kind}(i)||function(e){return"StringValue"===e.kind}(i))e[t.value]=i.value;else if(function(e){return"ObjectValue"===e.kind}(i)){var r={};i.fields.map((function(e){return f(r,e.name,e.value,n)})),e[t.value]=r}else if(function(e){return"Variable"===e.kind}(i)){var o=(n||{})[i.name.value];e[t.value]=o}else if(function(e){return"ListValue"===e.kind}(i))e[t.value]=i.values.map((function(e){var i={};return f(i,t,e,n),i[t.value]}));else if(function(e){return"EnumValue"===e.kind}(i))e[t.value]=i.value;else{if(!function(e){return"NullValue"===e.kind}(i))throw new s.ej(53);e[t.value]=null}}function v(e,t){var i=null;e.directives&&(i={},e.directives.forEach((function(e){i[e.name.value]={},e.arguments&&e.arguments.forEach((function(n){var s=n.name,r=n.value;return f(i[e.name.value],s,r,t)}))})));var n=null;return e.arguments&&e.arguments.length&&(n={},e.arguments.forEach((function(e){var i=e.name,s=e.value;return f(n,i,s,t)}))),b(e.name.value,n,i)}var y=["connection","include","skip","client","rest","export"];function b(e,t,i){if(t&&i&&i.connection&&i.connection.key){if(i.connection.filter&&i.connection.filter.length>0){var n=i.connection.filter?i.connection.filter:[];n.sort();var s={};return n.forEach((function(e){s[e]=t[e]})),i.connection.key+"("+JSON.stringify(s)+")"}return i.connection.key}var r=e;if(t){var o=p()(t);r+="("+o+")"}return i&&Object.keys(i).forEach((function(e){-1===y.indexOf(e)&&(i[e]&&Object.keys(i[e]).length?r+="@"+e+"("+JSON.stringify(i[e])+")":r+="@"+e)})),r}function S(e,t){if(e.arguments&&e.arguments.length){var i={};return e.arguments.forEach((function(e){var n=e.name,s=e.value;return f(i,n,s,t)})),i}return null}function E(e){return e.alias?e.alias.value:e.name.value}function w(e,t,i){if("string"==typeof e.__typename)return e.__typename;for(var n=0,s=t.selections;n<s.length;n++){var r=s[n];if(T(r)){if("__typename"===r.name.value)return e[E(r)]}else{var o=w(e,d(r,i).selectionSet,i);if("string"==typeof o)return o}}}function T(e){return"Field"===e.kind}function _(e){return"InlineFragment"===e.kind}function M(e){(0,s.kG)(e&&"Document"===e.kind,45);var t=e.definitions.filter((function(e){return"FragmentDefinition"!==e.kind})).map((function(e){if("OperationDefinition"!==e.kind)throw new s.ej(46);return e}));return(0,s.kG)(t.length<=1,47),e}function x(e){return M(e),e.definitions.filter((function(e){return"OperationDefinition"===e.kind}))[0]}function A(e){return e.definitions.filter((function(e){return"OperationDefinition"===e.kind&&e.name})).map((function(e){return e.name.value}))[0]||null}function O(e){return e.definitions.filter((function(e){return"FragmentDefinition"===e.kind}))}function P(e){var t=x(e);return(0,s.kG)(t&&"query"===t.operation,48),t}function D(e){var t;M(e);for(var i=0,n=e.definitions;i<n.length;i++){var r=n[i];if("OperationDefinition"===r.kind){var o=r.operation;if("query"===o||"mutation"===o||"subscription"===o)return r}"FragmentDefinition"!==r.kind||t||(t=r)}if(t)return t;throw new s.ej(52)}function C(e){var t=Object.create(null),i=e&&e.variableDefinitions;return i&&i.length&&i.forEach((function(e){e.defaultValue&&f(t,e.variable.name,e.defaultValue)})),t}function I(e,t,i){var n=0;return e.forEach((function(i,s){t.call(this,i,s,e)&&(e[n++]=i)}),i),e.length=n,e}var L={kind:"Field",name:{kind:"Name",value:"__typename"}};function R(e,t){return e.selectionSet.selections.every((function(e){return"FragmentSpread"===e.kind&&R(t[e.name.value],t)}))}function N(e){return R(x(e)||function(e){(0,s.kG)("Document"===e.kind,49),(0,s.kG)(e.definitions.length<=1,50);var t=e.definitions[0];return(0,s.kG)("FragmentDefinition"===t.kind,51),t}(e),h(O(e)))?null:e}function k(e){return function(t){return e.some((function(e){return e.name&&e.name===t.name.value||e.test&&e.test(t)}))}}function B(e,t){var i=Object.create(null),s=[],r=Object.create(null),o=[],a=N((0,n.Vn)(t,{Variable:{enter:function(e,t,n){"VariableDefinition"!==n.kind&&(i[e.name.value]=!0)}},Field:{enter:function(t){if(e&&t.directives&&(e.some((function(e){return e.remove}))&&t.directives&&t.directives.some(k(e))))return t.arguments&&t.arguments.forEach((function(e){"Variable"===e.value.kind&&s.push({name:e.value.name.value})})),t.selectionSet&&H(t.selectionSet).forEach((function(e){o.push({name:e.name.value})})),null}},FragmentSpread:{enter:function(e){r[e.name.value]=!0}},Directive:{enter:function(t){if(k(e)(t))return null}}}));return a&&I(s,(function(e){return!!e.name&&!i[e.name]})).length&&(a=function(e,t){var i=function(e){return function(t){return e.some((function(e){return t.value&&"Variable"===t.value.kind&&t.value.name&&(e.name===t.value.name.value||e.test&&e.test(t))}))}}(e);return N((0,n.Vn)(t,{OperationDefinition:{enter:function(t){return(0,l.pi)((0,l.pi)({},t),{variableDefinitions:t.variableDefinitions?t.variableDefinitions.filter((function(t){return!e.some((function(e){return e.name===t.variable.name.value}))})):[]})}},Field:{enter:function(t){if(e.some((function(e){return e.remove}))){var n=0;if(t.arguments&&t.arguments.forEach((function(e){i(e)&&(n+=1)})),1===n)return null}}},Argument:{enter:function(e){if(i(e))return null}}}))}(s,a)),a&&I(o,(function(e){return!!e.name&&!r[e.name]})).length&&(a=function(e,t){function i(t){if(e.some((function(e){return e.name===t.name.value})))return null}return N((0,n.Vn)(t,{FragmentSpread:{enter:i},FragmentDefinition:{enter:i}}))}(o,a)),a}function F(e){return(0,n.Vn)(M(e),{SelectionSet:{enter:function(e,t,i){if(!i||"OperationDefinition"!==i.kind){var n=e.selections;if(n)if(!n.some((function(e){return T(e)&&("__typename"===e.name.value||0===e.name.value.lastIndexOf("__",0))}))){var s=i;if(!(T(s)&&s.directives&&s.directives.some((function(e){return"export"===e.name.value}))))return(0,l.pi)((0,l.pi)({},e),{selections:(0,l.pr)(n,[L])})}}}}})}F.added=function(e){return e===L};var U={test:function(e){var t="connection"===e.name.value;return t&&(!e.arguments||e.arguments.some((function(e){return"key"===e.name.value}))),t}};function V(e){return B([U],M(e))}function H(e){var t=[];return e.selections.forEach((function(e){(T(e)||_(e))&&e.selectionSet?H(e.selectionSet).forEach((function(e){return t.push(e)})):"FragmentSpread"===e.kind&&t.push(e)})),t}function G(e){return"query"===D(e).operation?e:(0,n.Vn)(e,{OperationDefinition:{enter:function(e){return(0,l.pi)((0,l.pi)({},e),{operation:"query"})}}})}function z(e){M(e);var t=B([{test:function(e){return"client"===e.name.value},remove:!0}],e);return t&&(t=(0,n.Vn)(t,{FragmentDefinition:{enter:function(e){if(e.selectionSet&&e.selectionSet.selections.every((function(e){return T(e)&&"__typename"===e.name.value})))return null}}})),t}var W=Object.prototype.hasOwnProperty;function j(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return K(e)}function K(e){var t=e[0]||{},i=e.length;if(i>1)for(var n=new Y,s=1;s<i;++s)t=n.merge(t,e[s]);return t}function q(e){return null!==e&&"object"==typeof e}var Z=function(e,t,i){return this.merge(e[i],t[i])},Y=function(){function e(e){void 0===e&&(e=Z),this.reconciler=e,this.isObject=q,this.pastCopies=new Set}return e.prototype.merge=function(e,t){for(var i=this,n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];return q(t)&&q(e)?(Object.keys(t).forEach((function(s){if(W.call(e,s)){var r=e[s];if(t[s]!==r){var o=i.reconciler.apply(i,(0,l.pr)([e,t,s],n));o!==r&&((e=i.shallowCopyForMerge(e))[s]=o)}}else(e=i.shallowCopyForMerge(e))[s]=t[s]})),e):t},e.prototype.shallowCopyForMerge=function(e){return q(e)&&!this.pastCopies.has(e)&&(e=Array.isArray(e)?e.slice(0):(0,l.pi)({__proto__:Object.getPrototypeOf(e)},e),this.pastCopies.add(e)),e},e}();var $=i(49329),Q=i.n($);i(67121);Q().prototype["@@observable"]=function(){return this};var X=Object.prototype.toString;function J(e){return ee(e)}function ee(e,t){switch(X.call(e)){case"[object Array]":if((t=t||new Map).has(e))return t.get(e);var i=e.slice(0);return t.set(e,i),i.forEach((function(e,n){i[n]=ee(e,t)})),i;case"[object Object]":if((t=t||new Map).has(e))return t.get(e);var n=Object.create(Object.getPrototypeOf(e));return t.set(e,n),Object.keys(e).forEach((function(i){n[i]=ee(e[i],t)})),n;default:return e}}function te(e){return e}function ie(e,t,i){var n=[];e.forEach((function(e){return e[t]&&n.push(e)})),n.forEach((function(e){return e[t](i)}))}function ne(e,t,i){return new(Q())((function(n){var s=n.next,r=n.error,o=n.complete,a=0,l=!1;function c(e,t){return e?function(t){++a,new Promise((function(i){return i(e(t))})).then((function(e){--a,s&&s.call(n,e),l&&h.complete()}),(function(e){--a,r&&r.call(n,e)}))}:function(e){return t&&t.call(n,e)}}var h={next:c(t,s),error:c(i,r),complete:function(){l=!0,a||o&&o.call(n)}},d=e.subscribe(h);return function(){return d.unsubscribe()}}))}function se(e){function t(t){Object.defineProperty(e,t,{value:Q()})}return"function"==typeof Symbol&&Symbol.species&&t(Symbol.species),t("@@species"),e}function re(e){return e&&"function"==typeof e.then}var oe=function(e){function t(t){var i=e.call(this,(function(e){return i.addObserver(e),function(){return i.removeObserver(e)}}))||this;return i.observers=new Set,i.addCount=0,i.promise=new Promise((function(e,t){i.resolve=e,i.reject=t})),i.handlers={next:function(e){null!==i.sub&&(i.latest=["next",e],ie(i.observers,"next",e))},error:function(e){var t=i.sub;null!==t&&(t&&Promise.resolve().then((function(){return t.unsubscribe()})),i.sub=null,i.latest=["error",e],i.reject(e),ie(i.observers,"error",e))},complete:function(){if(null!==i.sub){var e=i.sources.shift();e?re(e)?e.then((function(e){return i.sub=e.subscribe(i.handlers)})):i.sub=e.subscribe(i.handlers):(i.sub=null,i.latest&&"next"===i.latest[0]?i.resolve(i.latest[1]):i.resolve(),ie(i.observers,"complete"))}}},i.cancel=function(e){i.reject(e),i.sources=[],i.handlers.complete()},i.promise.catch((function(e){})),"function"==typeof t&&(t=[new(Q())(t)]),re(t)?t.then((function(e){return i.start(e)}),i.handlers.error):i.start(t),i}return(0,l.ZT)(t,e),t.prototype.start=function(e){void 0===this.sub&&(this.sources=Array.from(e),this.handlers.complete())},t.prototype.deliverLastMessage=function(e){if(this.latest){var t=this.latest[0],i=e[t];i&&i.call(e,this.latest[1]),null===this.sub&&"next"===t&&e.complete&&e.complete()}},t.prototype.addObserver=function(e){this.observers.has(e)||(this.deliverLastMessage(e),this.observers.add(e),++this.addCount)},t.prototype.removeObserver=function(e,t){this.observers.delete(e)&&--this.addCount<1&&!t&&this.handlers.error(new Error("Observable cancelled prematurely"))},t.prototype.cleanup=function(e){var t=this,i=!1,n=function(){i||(i=!0,t.observers.delete(s),e())},s={next:n,error:n,complete:n},r=this.addCount;this.addObserver(s),this.addCount=r},t}(Q());function ae(e){return Array.isArray(e)&&e.length>0}function le(e){return e.errors&&e.errors.length>0||!1}se(oe);var ce="function"==typeof WeakMap&&!("object"==typeof navigator&&"ReactNative"===navigator.product);function he(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=Object.create(null);return e.forEach((function(e){e&&Object.keys(e).forEach((function(t){var n=e[t];void 0!==n&&(i[t]=n)}))})),i}},81506:e=>{e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},34575:e=>{e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},93913:e=>{function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}},16525:(e,t,i)=>{var n=i(58331);function s(t,i,r){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=s=Reflect.get:e.exports=s=function(e,t,i){var s=n(e,t);if(s){var r=Object.getOwnPropertyDescriptor(s,t);return r.get?r.get.call(i):r.value}},s(t,i,r||t)}e.exports=s},29754:e=>{function t(i){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(i)}e.exports=t},2205:(e,t,i)=>{var n=i(99489);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}},95318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}}},78585:(e,t,i)=>{var n=i(50008),s=i(81506);e.exports=function(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?s(e):t}},99489:e=>{function t(i,n){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(i,n)}e.exports=t},58331:(e,t,i)=>{var n=i(29754);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e}},50008:e=>{function t(i){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(i)}e.exports=t},25179:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(6308);class MDCComponent{static attachTo(e){return new MDCComponent(e,new n.Z)}constructor(e,t,...i){this.root_=e,this.initialize(...i),this.foundation_=void 0===t?this.getDefaultFoundation():t,this.foundation_.init(),this.initialSyncWithDOM()}initialize(){}getDefaultFoundation(){throw new Error("Subclasses must override getDefaultFoundation to return a properly configured foundation class")}initialSyncWithDOM(){}destroy(){this.foundation_.destroy()}listen(e,t){this.root_.addEventListener(e,t)}unlisten(e,t){this.root_.removeEventListener(e,t)}emit(e,t,i=!1){let n;"function"==typeof CustomEvent?n=new CustomEvent(e,{detail:t,bubbles:i}):(n=document.createEvent("CustomEvent"),n.initCustomEvent(e,i,!1,t)),this.root_.dispatchEvent(n)}}const s=MDCComponent},6308:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n=class MDCFoundation{static get cssClasses(){return{}}static get strings(){return{}}static get numbers(){return{}}static get defaultAdapter(){return{}}constructor(e={}){this.adapter_=e}init(){}destroy(){}}},30888:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MDCRipple:()=>MDCRipple,MDCRippleFoundation:()=>y,RippleCapableSurface:()=>RippleCapableSurface,util:()=>n});var n={};i.r(n),i.d(n,{applyPassive:()=>u,getMatchesProperty:()=>p,getNormalizedEventCoords:()=>m,supportsCssVariables:()=>d});var s=i(25179),r=i(6308);const o={ROOT:"mdc-ripple-upgraded",UNBOUNDED:"mdc-ripple-upgraded--unbounded",BG_FOCUSED:"mdc-ripple-upgraded--background-focused",FG_ACTIVATION:"mdc-ripple-upgraded--foreground-activation",FG_DEACTIVATION:"mdc-ripple-upgraded--foreground-deactivation"},a={VAR_LEFT:"--mdc-ripple-left",VAR_TOP:"--mdc-ripple-top",VAR_FG_SIZE:"--mdc-ripple-fg-size",VAR_FG_SCALE:"--mdc-ripple-fg-scale",VAR_FG_TRANSLATE_START:"--mdc-ripple-fg-translate-start",VAR_FG_TRANSLATE_END:"--mdc-ripple-fg-translate-end"},l={PADDING:10,INITIAL_ORIGIN_SCALE:.6,DEACTIVATION_TIMEOUT_MS:225,FG_DEACTIVATION_MS:150,TAP_DELAY_MS:300};let c,h;function d(e,t=!1){let i=c;if("boolean"==typeof c&&!t)return i;if(!(e.CSS&&"function"==typeof e.CSS.supports))return;const n=e.CSS.supports("--css-vars","yes"),s=e.CSS.supports("(--css-vars: yes)")&&e.CSS.supports("color","#00000000");return i=!(!n&&!s)&&!function(e){const t=e.document,i=t.createElement("div");i.className="mdc-ripple-surface--test-edge-var-bug",t.body.appendChild(i);const n=e.getComputedStyle(i),s=null!==n&&"solid"===n.borderTopStyle;return i.remove(),s}(e),t||(c=i),i}function u(e=window,t=!1){if(void 0===h||t){let t=!1;try{e.document.addEventListener("test",null,{get passive(){t=!0}})}catch(e){}h=t}return!!h&&{passive:!0}}function p(e){return["webkitMatchesSelector","msMatchesSelector","matches"].filter((t=>t in e)).pop()}function m(e,t,i){const{x:n,y:s}=t,r=n+i.left,o=s+i.top;let a,l;return"touchstart"===e.type?(a=e.changedTouches[0].pageX-r,l=e.changedTouches[0].pageY-o):(a=e.pageX-r,l=e.pageY-o),{x:a,y:l}}const g=["touchstart","pointerdown","mousedown","keydown"],f=["touchend","pointerup","mouseup"];let v=[];class MDCRippleFoundation extends r.Z{static get cssClasses(){return o}static get strings(){return a}static get numbers(){return l}static get defaultAdapter(){return{browserSupportsCssVars:()=>{},isUnbounded:()=>{},isSurfaceActive:()=>{},isSurfaceDisabled:()=>{},addClass:()=>{},removeClass:()=>{},containsEventTarget:()=>{},registerInteractionHandler:()=>{},deregisterInteractionHandler:()=>{},registerDocumentInteractionHandler:()=>{},deregisterDocumentInteractionHandler:()=>{},registerResizeHandler:()=>{},deregisterResizeHandler:()=>{},updateCssVariable:()=>{},computeBoundingRect:()=>{},getWindowPageOffset:()=>{}}}constructor(e){super(Object.assign(MDCRippleFoundation.defaultAdapter,e)),this.layoutFrame_=0,this.frame_={width:0,height:0},this.activationState_=this.defaultActivationState_(),this.initialSize_=0,this.maxRadius_=0,this.activateHandler_=e=>this.activate_(e),this.deactivateHandler_=e=>this.deactivate_(e),this.focusHandler_=()=>this.handleFocus(),this.blurHandler_=()=>this.handleBlur(),this.resizeHandler_=()=>this.layout(),this.unboundedCoords_={left:0,top:0},this.fgScale_=0,this.activationTimer_=0,this.fgDeactivationRemovalTimer_=0,this.activationAnimationHasEnded_=!1,this.activationTimerCallback_=()=>{this.activationAnimationHasEnded_=!0,this.runDeactivationUXLogicIfReady_()},this.previousActivationEvent_=null}supportsPressRipple_(){return this.adapter_.browserSupportsCssVars()}defaultActivationState_(){return{isActivated:!1,hasDeactivationUXRun:!1,wasActivatedByPointer:!1,wasElementMadeActive:!1,activationEvent:null,isProgrammatic:!1}}init(){const e=this.supportsPressRipple_();if(this.registerRootHandlers_(e),e){const{ROOT:e,UNBOUNDED:t}=MDCRippleFoundation.cssClasses;requestAnimationFrame((()=>{this.adapter_.addClass(e),this.adapter_.isUnbounded()&&(this.adapter_.addClass(t),this.layoutInternal_())}))}}destroy(){if(this.supportsPressRipple_()){this.activationTimer_&&(clearTimeout(this.activationTimer_),this.activationTimer_=0,this.adapter_.removeClass(MDCRippleFoundation.cssClasses.FG_ACTIVATION)),this.fgDeactivationRemovalTimer_&&(clearTimeout(this.fgDeactivationRemovalTimer_),this.fgDeactivationRemovalTimer_=0,this.adapter_.removeClass(MDCRippleFoundation.cssClasses.FG_DEACTIVATION));const{ROOT:e,UNBOUNDED:t}=MDCRippleFoundation.cssClasses;requestAnimationFrame((()=>{this.adapter_.removeClass(e),this.adapter_.removeClass(t),this.removeCssVars_()}))}this.deregisterRootHandlers_(),this.deregisterDeactivationHandlers_()}registerRootHandlers_(e){e&&(g.forEach((e=>{this.adapter_.registerInteractionHandler(e,this.activateHandler_)})),this.adapter_.isUnbounded()&&this.adapter_.registerResizeHandler(this.resizeHandler_)),this.adapter_.registerInteractionHandler("focus",this.focusHandler_),this.adapter_.registerInteractionHandler("blur",this.blurHandler_)}registerDeactivationHandlers_(e){"keydown"===e.type?this.adapter_.registerInteractionHandler("keyup",this.deactivateHandler_):f.forEach((e=>{this.adapter_.registerDocumentInteractionHandler(e,this.deactivateHandler_)}))}deregisterRootHandlers_(){g.forEach((e=>{this.adapter_.deregisterInteractionHandler(e,this.activateHandler_)})),this.adapter_.deregisterInteractionHandler("focus",this.focusHandler_),this.adapter_.deregisterInteractionHandler("blur",this.blurHandler_),this.adapter_.isUnbounded()&&this.adapter_.deregisterResizeHandler(this.resizeHandler_)}deregisterDeactivationHandlers_(){this.adapter_.deregisterInteractionHandler("keyup",this.deactivateHandler_),f.forEach((e=>{this.adapter_.deregisterDocumentInteractionHandler(e,this.deactivateHandler_)}))}removeCssVars_(){const{strings:e}=MDCRippleFoundation;Object.keys(e).forEach((t=>{0===t.indexOf("VAR_")&&this.adapter_.updateCssVariable(e[t],null)}))}activate_(e){if(this.adapter_.isSurfaceDisabled())return;const t=this.activationState_;if(t.isActivated)return;const i=this.previousActivationEvent_;if(i&&e&&i.type!==e.type)return;t.isActivated=!0,t.isProgrammatic=null===e,t.activationEvent=e,t.wasActivatedByPointer=!t.isProgrammatic&&("mousedown"===e.type||"touchstart"===e.type||"pointerdown"===e.type);e&&v.length>0&&v.some((e=>this.adapter_.containsEventTarget(e)))?this.resetActivationState_():(e&&(v.push(e.target),this.registerDeactivationHandlers_(e)),t.wasElementMadeActive=this.checkElementMadeActive_(e),t.wasElementMadeActive&&this.animateActivation_(),requestAnimationFrame((()=>{v=[],t.wasElementMadeActive||" "!==e.key&&32!==e.keyCode||(t.wasElementMadeActive=this.checkElementMadeActive_(e),t.wasElementMadeActive&&this.animateActivation_()),t.wasElementMadeActive||(this.activationState_=this.defaultActivationState_())})))}checkElementMadeActive_(e){return!e||"keydown"!==e.type||this.adapter_.isSurfaceActive()}activate(e=null){this.activate_(e)}animateActivation_(){const{VAR_FG_TRANSLATE_START:e,VAR_FG_TRANSLATE_END:t}=MDCRippleFoundation.strings,{FG_DEACTIVATION:i,FG_ACTIVATION:n}=MDCRippleFoundation.cssClasses,{DEACTIVATION_TIMEOUT_MS:s}=MDCRippleFoundation.numbers;this.layoutInternal_();let r="",o="";if(!this.adapter_.isUnbounded()){const{startPoint:e,endPoint:t}=this.getFgTranslationCoordinates_();r=`${e.x}px, ${e.y}px`,o=`${t.x}px, ${t.y}px`}this.adapter_.updateCssVariable(e,r),this.adapter_.updateCssVariable(t,o),clearTimeout(this.activationTimer_),clearTimeout(this.fgDeactivationRemovalTimer_),this.rmBoundedActivationClasses_(),this.adapter_.removeClass(i),this.adapter_.computeBoundingRect(),this.adapter_.addClass(n),this.activationTimer_=setTimeout((()=>this.activationTimerCallback_()),s)}getFgTranslationCoordinates_(){const{activationEvent:e,wasActivatedByPointer:t}=this.activationState_;let i;i=t?m(e,this.adapter_.getWindowPageOffset(),this.adapter_.computeBoundingRect()):{x:this.frame_.width/2,y:this.frame_.height/2},i={x:i.x-this.initialSize_/2,y:i.y-this.initialSize_/2};return{startPoint:i,endPoint:{x:this.frame_.width/2-this.initialSize_/2,y:this.frame_.height/2-this.initialSize_/2}}}runDeactivationUXLogicIfReady_(){const{FG_DEACTIVATION:e}=MDCRippleFoundation.cssClasses,{hasDeactivationUXRun:t,isActivated:i}=this.activationState_;(t||!i)&&this.activationAnimationHasEnded_&&(this.rmBoundedActivationClasses_(),this.adapter_.addClass(e),this.fgDeactivationRemovalTimer_=setTimeout((()=>{this.adapter_.removeClass(e)}),l.FG_DEACTIVATION_MS))}rmBoundedActivationClasses_(){const{FG_ACTIVATION:e}=MDCRippleFoundation.cssClasses;this.adapter_.removeClass(e),this.activationAnimationHasEnded_=!1,this.adapter_.computeBoundingRect()}resetActivationState_(){this.previousActivationEvent_=this.activationState_.activationEvent,this.activationState_=this.defaultActivationState_(),setTimeout((()=>this.previousActivationEvent_=null),MDCRippleFoundation.numbers.TAP_DELAY_MS)}deactivate_(e){const t=this.activationState_;if(!t.isActivated)return;const i=Object.assign({},t);if(t.isProgrammatic){const e=null;requestAnimationFrame((()=>this.animateDeactivation_(e,i))),this.resetActivationState_()}else this.deregisterDeactivationHandlers_(),requestAnimationFrame((()=>{this.activationState_.hasDeactivationUXRun=!0,this.animateDeactivation_(e,i),this.resetActivationState_()}))}deactivate(e=null){this.deactivate_(e)}animateDeactivation_(e,{wasActivatedByPointer:t,wasElementMadeActive:i}){(t||i)&&this.runDeactivationUXLogicIfReady_()}layout(){this.layoutFrame_&&cancelAnimationFrame(this.layoutFrame_),this.layoutFrame_=requestAnimationFrame((()=>{this.layoutInternal_(),this.layoutFrame_=0}))}layoutInternal_(){this.frame_=this.adapter_.computeBoundingRect();const e=Math.max(this.frame_.height,this.frame_.width);this.maxRadius_=this.adapter_.isUnbounded()?e:(()=>Math.sqrt(Math.pow(this.frame_.width,2)+Math.pow(this.frame_.height,2))+MDCRippleFoundation.numbers.PADDING)(),this.initialSize_=e*MDCRippleFoundation.numbers.INITIAL_ORIGIN_SCALE,this.fgScale_=this.maxRadius_/this.initialSize_,this.updateLayoutCssVars_()}updateLayoutCssVars_(){const{VAR_FG_SIZE:e,VAR_LEFT:t,VAR_TOP:i,VAR_FG_SCALE:n}=MDCRippleFoundation.strings;this.adapter_.updateCssVariable(e,`${this.initialSize_}px`),this.adapter_.updateCssVariable(n,this.fgScale_),this.adapter_.isUnbounded()&&(this.unboundedCoords_={left:Math.round(this.frame_.width/2-this.initialSize_/2),top:Math.round(this.frame_.height/2-this.initialSize_/2)},this.adapter_.updateCssVariable(t,`${this.unboundedCoords_.left}px`),this.adapter_.updateCssVariable(i,`${this.unboundedCoords_.top}px`))}setUnbounded(e){const{UNBOUNDED:t}=MDCRippleFoundation.cssClasses;e?this.adapter_.addClass(t):this.adapter_.removeClass(t)}handleFocus(){requestAnimationFrame((()=>this.adapter_.addClass(MDCRippleFoundation.cssClasses.BG_FOCUSED)))}handleBlur(){requestAnimationFrame((()=>this.adapter_.removeClass(MDCRippleFoundation.cssClasses.BG_FOCUSED)))}}const y=MDCRippleFoundation;class MDCRipple extends s.Z{constructor(...e){super(...e),this.disabled=!1,this.unbounded_}static attachTo(e,{isUnbounded:t}={}){const i=new MDCRipple(e);return void 0!==t&&(i.unbounded=t),i}static createAdapter(e){const t=p(HTMLElement.prototype);return{browserSupportsCssVars:()=>d(window),isUnbounded:()=>e.unbounded,isSurfaceActive:()=>e.root_[t](":active"),isSurfaceDisabled:()=>e.disabled,addClass:t=>e.root_.classList.add(t),removeClass:t=>e.root_.classList.remove(t),containsEventTarget:t=>e.root_.contains(t),registerInteractionHandler:(t,i)=>e.root_.addEventListener(t,i,u()),deregisterInteractionHandler:(t,i)=>e.root_.removeEventListener(t,i,u()),registerDocumentInteractionHandler:(e,t)=>document.documentElement.addEventListener(e,t,u()),deregisterDocumentInteractionHandler:(e,t)=>document.documentElement.removeEventListener(e,t,u()),registerResizeHandler:e=>window.addEventListener("resize",e),deregisterResizeHandler:e=>window.removeEventListener("resize",e),updateCssVariable:(t,i)=>e.root_.style.setProperty(t,i),computeBoundingRect:()=>e.root_.getBoundingClientRect(),getWindowPageOffset:()=>({x:window.pageXOffset,y:window.pageYOffset})}}get unbounded(){return this.unbounded_}set unbounded(e){this.unbounded_=Boolean(e),this.setUnbounded_()}setUnbounded_(){this.foundation_.setUnbounded(this.unbounded_)}activate(){this.foundation_.activate()}deactivate(){this.foundation_.deactivate()}layout(){this.foundation_.layout()}getDefaultFoundation(){return new y(MDCRipple.createAdapter(this))}initialSyncWithDOM(){this.unbounded="mdcRippleIsUnbounded"in this.root_.dataset}}class RippleCapableSurface{}RippleCapableSurface.prototype.root_,RippleCapableSurface.prototype.unbounded,RippleCapableSurface.prototype.disabled},69826:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MDCSlider:()=>MDCSlider,MDCSliderFoundation:()=>T});var n=i(25179);const s={ACTIVE:"mdc-slider--active",DISABLED:"mdc-slider--disabled",DISCRETE:"mdc-slider--discrete",FOCUS:"mdc-slider--focus",IN_TRANSIT:"mdc-slider--in-transit",IS_DISCRETE:"mdc-slider--discrete",HAS_TRACK_MARKER:"mdc-slider--display-markers"},r={TRACK_SELECTOR:".mdc-slider__track",TRACK_MARKER_CONTAINER_SELECTOR:".mdc-slider__track-marker-container",LAST_TRACK_MARKER_SELECTOR:".mdc-slider__track-marker:last-child",THUMB_CONTAINER_SELECTOR:".mdc-slider__thumb-container",PIN_VALUE_MARKER_SELECTOR:".mdc-slider__pin-value-marker",ARIA_VALUEMIN:"aria-valuemin",ARIA_VALUEMAX:"aria-valuemax",ARIA_VALUENOW:"aria-valuenow",ARIA_DISABLED:"aria-disabled",STEP_DATA_ATTR:"data-step",CHANGE_EVENT:"MDCSlider:change",INPUT_EVENT:"MDCSlider:input"},o={PAGE_FACTOR:4};const a={animationstart:{noPrefix:"animationstart",webkitPrefix:"webkitAnimationStart",styleProperty:"animation"},animationend:{noPrefix:"animationend",webkitPrefix:"webkitAnimationEnd",styleProperty:"animation"},animationiteration:{noPrefix:"animationiteration",webkitPrefix:"webkitAnimationIteration",styleProperty:"animation"},transitionend:{noPrefix:"transitionend",webkitPrefix:"webkitTransitionEnd",styleProperty:"transition"}},l={animation:{noPrefix:"animation",webkitPrefix:"-webkit-animation"},transform:{noPrefix:"transform",webkitPrefix:"-webkit-transform"},transition:{noPrefix:"transition",webkitPrefix:"-webkit-transition"}};function c(e,t){if(!function(e){return void 0!==e.document&&"function"==typeof e.document.createElement}(e)||!function(e){return e in a||e in l}(t))return t;const i=t in a?a:l,n=e.document.createElement("div");let s="";return s=i===a?function(e,t,i){return t[e].styleProperty in i.style?t[e].noPrefix:t[e].webkitPrefix}(t,i,n):i[t].noPrefix in n.style?i[t].noPrefix:i[t].webkitPrefix,s}function h(e,t){return c(e,t)}var d=i(6308);const u="ArrowLeft",p="ArrowRight",m="ArrowUp",g="ArrowDown",f="Home",v="End",y="PageUp",b="PageDown",S={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"pointermove"},E=["mousedown","pointerdown","touchstart"],w=["mouseup","pointerup","touchend"];class MDCSliderFoundation extends d.Z{static get cssClasses(){return s}static get strings(){return r}static get numbers(){return o}static get defaultAdapter(){return{hasClass:()=>!1,addClass:()=>{},removeClass:()=>{},getAttribute:()=>null,setAttribute:()=>{},removeAttribute:()=>{},computeBoundingRect:()=>({top:0,right:0,bottom:0,left:0,width:0,height:0}),getTabIndex:()=>0,registerInteractionHandler:()=>{},deregisterInteractionHandler:()=>{},registerThumbContainerInteractionHandler:()=>{},deregisterThumbContainerInteractionHandler:()=>{},registerBodyInteractionHandler:()=>{},deregisterBodyInteractionHandler:()=>{},registerResizeHandler:()=>{},deregisterResizeHandler:()=>{},notifyInput:()=>{},notifyChange:()=>{},setThumbContainerStyleProperty:()=>{},setTrackStyleProperty:()=>{},setMarkerValue:()=>{},appendTrackMarkers:()=>{},removeTrackMarkers:()=>{},setLastTrackMarkersStyleProperty:()=>{},isRTL:()=>!1}}constructor(e){super(Object.assign(MDCSliderFoundation.defaultAdapter,e)),this.rect_=null,this.savedTabIndex_=NaN,this.active_=!1,this.inTransit_=!1,this.isDiscrete_=!1,this.hasTrackMarker_=!1,this.handlingThumbTargetEvt_=!1,this.min_=0,this.max_=100,this.step_=0,this.value_=0,this.disabled_=!1,this.preventFocusState_=!1,this.updateUIFrame_=0,this.thumbContainerPointerHandler_=()=>{this.handlingThumbTargetEvt_=!0},this.interactionStartHandler_=e=>this.handleDown_(e),this.keydownHandler_=e=>this.handleKeydown_(e),this.focusHandler_=()=>this.handleFocus_(),this.blurHandler_=()=>this.handleBlur_(),this.resizeHandler_=()=>this.layout()}init(){this.isDiscrete_=this.adapter_.hasClass(s.IS_DISCRETE),this.hasTrackMarker_=this.adapter_.hasClass(s.HAS_TRACK_MARKER),E.forEach((e=>this.adapter_.registerInteractionHandler(e,this.interactionStartHandler_))),this.adapter_.registerInteractionHandler("keydown",this.keydownHandler_),this.adapter_.registerInteractionHandler("focus",this.focusHandler_),this.adapter_.registerInteractionHandler("blur",this.blurHandler_),E.forEach((e=>{this.adapter_.registerThumbContainerInteractionHandler(e,this.thumbContainerPointerHandler_)})),this.adapter_.registerResizeHandler(this.resizeHandler_),this.layout(),this.isDiscrete_&&0==this.getStep()&&(this.step_=1)}destroy(){E.forEach((e=>{this.adapter_.deregisterInteractionHandler(e,this.interactionStartHandler_)})),this.adapter_.deregisterInteractionHandler("keydown",this.keydownHandler_),this.adapter_.deregisterInteractionHandler("focus",this.focusHandler_),this.adapter_.deregisterInteractionHandler("blur",this.blurHandler_),E.forEach((e=>{this.adapter_.deregisterThumbContainerInteractionHandler(e,this.thumbContainerPointerHandler_)})),this.adapter_.deregisterResizeHandler(this.resizeHandler_)}setupTrackMarker(){if(this.isDiscrete_&&this.hasTrackMarker_&&0!=this.getStep()){const e=this.getMin(),t=this.getMax(),i=this.getStep();let n=(t-e)/i;const s=Math.ceil(n)!==n;if(s&&(n=Math.ceil(n)),this.adapter_.removeTrackMarkers(),this.adapter_.appendTrackMarkers(n),s){const e=(t-n*i)/i+1,s=h(window,"flex");this.adapter_.setLastTrackMarkersStyleProperty(s,String(e))}}}layout(){this.rect_=this.adapter_.computeBoundingRect(),this.updateUIForCurrentValue_()}getValue(){return this.value_}setValue(e){this.setValue_(e,!1)}getMax(){return this.max_}setMax(e){if(e<this.min_)throw new Error("Cannot set max to be less than the slider's minimum value");this.max_=e,this.setValue_(this.value_,!1,!0),this.adapter_.setAttribute(r.ARIA_VALUEMAX,String(this.max_)),this.setupTrackMarker()}getMin(){return this.min_}setMin(e){if(e>this.max_)throw new Error("Cannot set min to be greater than the slider's maximum value");this.min_=e,this.setValue_(this.value_,!1,!0),this.adapter_.setAttribute(r.ARIA_VALUEMIN,String(this.min_)),this.setupTrackMarker()}getStep(){return this.step_}setStep(e){if(e<0)throw new Error("Step cannot be set to a negative number");this.isDiscrete_&&("number"!=typeof e||e<1)&&(e=1),this.step_=e,this.setValue_(this.value_,!1,!0),this.setupTrackMarker()}isDisabled(){return this.disabled_}setDisabled(e){this.disabled_=e,this.toggleClass_(s.DISABLED,this.disabled_),this.disabled_?(this.savedTabIndex_=this.adapter_.getTabIndex(),this.adapter_.setAttribute(r.ARIA_DISABLED,"true"),this.adapter_.removeAttribute("tabindex")):(this.adapter_.removeAttribute(r.ARIA_DISABLED),isNaN(this.savedTabIndex_)||this.adapter_.setAttribute("tabindex",String(this.savedTabIndex_)))}handleDown_(e){if(this.disabled_)return;this.preventFocusState_=!0,this.setInTransit_(!this.handlingThumbTargetEvt_),this.handlingThumbTargetEvt_=!1,this.setActive_(!0);const t=e=>{this.handleMove_(e)},i=()=>{this.handleUp_(),this.adapter_.deregisterBodyInteractionHandler(S[e.type],t),w.forEach((e=>this.adapter_.deregisterBodyInteractionHandler(e,i)))};this.adapter_.registerBodyInteractionHandler(S[e.type],t),w.forEach((e=>this.adapter_.registerBodyInteractionHandler(e,i))),this.setValueFromEvt_(e)}handleMove_(e){e.preventDefault(),this.setValueFromEvt_(e)}handleUp_(){this.setActive_(!1),this.adapter_.notifyChange()}getPageX_(e){return e.targetTouches&&e.targetTouches.length>0?e.targetTouches[0].pageX:e.pageX}setValueFromEvt_(e){const t=this.getPageX_(e),i=this.computeValueFromPageX_(t);this.setValue_(i,!0)}computeValueFromPageX_(e){const{max_:t,min_:i}=this;let n=(e-this.rect_.left)/this.rect_.width;return this.adapter_.isRTL()&&(n=1-n),i+n*(t-i)}handleKeydown_(e){const t=this.getKeyId_(e),i=this.getValueForKeyId_(t);isNaN(i)||(e.preventDefault(),this.adapter_.addClass(s.FOCUS),this.setValue_(i,!0),this.adapter_.notifyChange())}getKeyId_(e){return e.key===u||37===e.keyCode?u:e.key===p||39===e.keyCode?p:e.key===m||38===e.keyCode?m:e.key===g||40===e.keyCode?g:e.key===f||36===e.keyCode?f:e.key===v||35===e.keyCode?v:e.key===y||33===e.keyCode?y:e.key===b||34===e.keyCode?b:""}getValueForKeyId_(e){const{max_:t,min_:i,step_:n}=this;let s=n||(t-i)/100;switch(this.adapter_.isRTL()&&(e===u||e===p)&&(s=-s),e){case u:case g:return this.value_-s;case p:case m:return this.value_+s;case f:return this.min_;case v:return this.max_;case y:return this.value_+s*o.PAGE_FACTOR;case b:return this.value_-s*o.PAGE_FACTOR;default:return NaN}}handleFocus_(){this.preventFocusState_||this.adapter_.addClass(s.FOCUS)}handleBlur_(){this.preventFocusState_=!1,this.adapter_.removeClass(s.FOCUS)}setValue_(e,t,i=!1){if(e===this.value_&&!i)return;const{min_:n,max_:s}=this,o=e===n||e===s;this.step_&&!o&&(e=this.quantize_(e)),e<n?e=n:e>s&&(e=s),this.value_=e,this.adapter_.setAttribute(r.ARIA_VALUENOW,String(this.value_)),this.updateUIForCurrentValue_(),t&&(this.adapter_.notifyInput(),this.isDiscrete_&&this.adapter_.setMarkerValue(e))}quantize_(e){return Math.round(e/this.step_)*this.step_}updateUIForCurrentValue_(){const{max_:e,min_:t,value_:i}=this,n=(i-t)/(e-t);let s=n*this.rect_.width;this.adapter_.isRTL()&&(s=this.rect_.width-s);const r=h(window,"transform"),o=c(window,"transitionend");if(this.inTransit_){const e=()=>{this.setInTransit_(!1),this.adapter_.deregisterThumbContainerInteractionHandler(o,e)};this.adapter_.registerThumbContainerInteractionHandler(o,e)}this.updateUIFrame_=requestAnimationFrame((()=>{this.adapter_.setThumbContainerStyleProperty(r,`translateX(${s}px) translateX(-50%)`),this.adapter_.setTrackStyleProperty(r,`scaleX(${n})`)}))}setActive_(e){this.active_=e,this.toggleClass_(s.ACTIVE,this.active_)}setInTransit_(e){this.inTransit_=e,this.toggleClass_(s.IN_TRANSIT,this.inTransit_)}toggleClass_(e,t){t?this.adapter_.addClass(e):this.adapter_.removeClass(e)}}const T=MDCSliderFoundation;class MDCSlider extends n.Z{static attachTo(e){return new MDCSlider(e)}constructor(...e){super(...e),this.thumbContainer_,this.track_,this.pinValueMarker_,this.trackMarkerContainer_}get value(){return this.foundation_.getValue()}set value(e){this.foundation_.setValue(e)}get min(){return this.foundation_.getMin()}set min(e){this.foundation_.setMin(e)}get max(){return this.foundation_.getMax()}set max(e){this.foundation_.setMax(e)}get step(){return this.foundation_.getStep()}set step(e){this.foundation_.setStep(e)}get disabled(){return this.foundation_.isDisabled()}set disabled(e){this.foundation_.setDisabled(e)}initialize(){this.thumbContainer_=this.root_.querySelector(r.THUMB_CONTAINER_SELECTOR),this.track_=this.root_.querySelector(r.TRACK_SELECTOR),this.pinValueMarker_=this.root_.querySelector(r.PIN_VALUE_MARKER_SELECTOR),this.trackMarkerContainer_=this.root_.querySelector(r.TRACK_MARKER_CONTAINER_SELECTOR)}getDefaultFoundation(){return new T({hasClass:e=>this.root_.classList.contains(e),addClass:e=>this.root_.classList.add(e),removeClass:e=>this.root_.classList.remove(e),getAttribute:e=>this.root_.getAttribute(e),setAttribute:(e,t)=>this.root_.setAttribute(e,t),removeAttribute:e=>this.root_.removeAttribute(e),computeBoundingRect:()=>this.root_.getBoundingClientRect(),getTabIndex:()=>this.root_.tabIndex,registerInteractionHandler:(e,t)=>{this.root_.addEventListener(e,t)},deregisterInteractionHandler:(e,t)=>{this.root_.removeEventListener(e,t)},registerThumbContainerInteractionHandler:(e,t)=>{this.thumbContainer_.addEventListener(e,t)},deregisterThumbContainerInteractionHandler:(e,t)=>{this.thumbContainer_.removeEventListener(e,t)},registerBodyInteractionHandler:(e,t)=>{document.body.addEventListener(e,t)},deregisterBodyInteractionHandler:(e,t)=>{document.body.removeEventListener(e,t)},registerResizeHandler:e=>{window.addEventListener("resize",e)},deregisterResizeHandler:e=>{window.removeEventListener("resize",e)},notifyInput:()=>{this.emit(r.INPUT_EVENT,this)},notifyChange:()=>{this.emit(r.CHANGE_EVENT,this)},setThumbContainerStyleProperty:(e,t)=>{this.thumbContainer_.style.setProperty(e,t)},setTrackStyleProperty:(e,t)=>{this.track_.style.setProperty(e,t)},setMarkerValue:e=>{this.pinValueMarker_.innerText=e},appendTrackMarkers:e=>{const t=document.createDocumentFragment();for(let i=0;i<e;i++){const e=document.createElement("div");e.classList.add("mdc-slider__track-marker"),t.appendChild(e)}this.trackMarkerContainer_.appendChild(t)},removeTrackMarkers:()=>{for(;this.trackMarkerContainer_.firstChild;)this.trackMarkerContainer_.removeChild(this.trackMarkerContainer_.firstChild)},setLastTrackMarkersStyleProperty:(e,t)=>{this.root_.querySelector(r.LAST_TRACK_MARKER_SELECTOR).style.setProperty(e,t)},isRTL:()=>"rtl"===getComputedStyle(this.root_).direction})}initialSyncWithDOM(){const e=parseFloat(this.root_.getAttribute(r.ARIA_VALUENOW));this.min=parseFloat(this.root_.getAttribute(r.ARIA_VALUEMIN))||this.min,this.max=parseFloat(this.root_.getAttribute(r.ARIA_VALUEMAX))||this.max,this.step=parseFloat(this.root_.getAttribute(r.STEP_DATA_ATTR))||this.step,this.value=e||this.value,this.disabled=this.root_.hasAttribute(r.ARIA_DISABLED)&&"false"!==this.root_.getAttribute(r.ARIA_DISABLED),this.foundation_.setupTrackMarker()}layout(){this.foundation_.layout()}stepUp(e=this.step||1){this.value+=e}stepDown(e=this.step||1){this.value-=e}}},34515:e=>{var t=Object.prototype.toString;e.exports=function(e){return e.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===t.call(e.buffer)||Array.isArray(e)}},14176:e=>{e.exports=function(e,t){return"number"==typeof e?e:"number"==typeof t?t:0}},47056:(e,t)=>{"use strict";var i;function n(e,t,n){if(!n||typeof n.value!==i.typeOfFunction)throw new TypeError("Only methods can be decorated with @bind. <"+t+"> is not a method!");return{configurable:i.boolTrue,get:function(){var e=n.value.bind(this);return Object.defineProperty(this,t,{value:e,configurable:i.boolTrue,writable:i.boolTrue}),e}}}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.typeOfFunction="function",e.boolTrue=!0}(i||(i={})),t.bind=n,t.default=n},21924:(e,t,i)=>{"use strict";var n=i(40210),s=i(55559),r=s(n("String.prototype.indexOf"));e.exports=function(e,t){var i=n(e,!!t);return"function"==typeof i&&r(e,".prototype.")>-1?s(i):i}},55559:(e,t,i)=>{"use strict";var n=i(58612),s=i(40210),r=s("%Function.prototype.apply%"),o=s("%Function.prototype.call%"),a=s("%Reflect.apply%",!0)||n.call(o,r),l=s("%Object.getOwnPropertyDescriptor%",!0),c=s("%Object.defineProperty%",!0),h=s("%Math.max%");if(c)try{c({},"a",{value:1})}catch(e){c=null}e.exports=function(e){var t=a(n,o,arguments);if(l&&c){var i=l(t,"length");i.configurable&&c(t,"length",{value:1+h(0,e.length-(arguments.length-1))})}return t};var d=function(){return a(n,r,arguments)};c?c(e.exports,"apply",{value:d}):e.exports.apply=d},94184:(e,t)=>{var i;!function(){"use strict";var n={}.hasOwnProperty;function s(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var r=typeof i;if("string"===r||"number"===r)e.push(i);else if(Array.isArray(i)&&i.length){var o=s.apply(null,i);o&&e.push(o)}else if("object"===r)for(var a in i)n.call(i,a)&&i[a]&&e.push(a)}}return e.join(" ")}e.exports?(s.default=s,e.exports=s):void 0===(i=function(){return s}.apply(t,[]))||(e.exports=i)}()},4289:(e,t,i)=>{"use strict";var n=i(82215),s="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),r=Object.prototype.toString,o=Array.prototype.concat,a=Object.defineProperty,l=a&&function(){var e={};try{for(var t in a(e,"x",{enumerable:!1,value:e}),e)return!1;return e.x===e}catch(e){return!1}}(),c=function(e,t,i,n){var s;(!(t in e)||"function"==typeof(s=n)&&"[object Function]"===r.call(s)&&n())&&(l?a(e,t,{configurable:!0,enumerable:!1,value:i,writable:!0}):e[t]=i)},h=function(e,t){var i=arguments.length>2?arguments[2]:{},r=n(t);s&&(r=o.call(r,Object.getOwnPropertySymbols(t)));for(var a=0;a<r.length;a+=1)c(e,r[a],t[r[a]],i[r[a]])};h.supportsDescriptors=!!l,e.exports=h},2823:e=>{e.exports=function(e){switch(e){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},13733:(e,t,i)=>{"use strict";e.exports=i(28631)},27308:(e,t,i)=>{"use strict";var n=i(40210),s=n("%String%"),r=n("%TypeError%");e.exports=function(e){if("symbol"==typeof e)throw new r("Cannot convert a Symbol value to a string");return s(e)}},28631:(e,t,i)=>{"use strict";var n=i(40210)("%TypeError%");e.exports=function(e,t){if(null==e)throw new n(t||"Cannot call method on "+e);return e}},17187:e=>{function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function n(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}e.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},t.prototype.emit=function(e){var t,r,o,a,l,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(s(r=this._events[e]))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(n(r))for(a=Array.prototype.slice.call(arguments,1),o=(c=r.slice()).length,l=0;l<o;l++)c[l].apply(this,a);return!0},t.prototype.addListener=function(e,r){var o;if(!i(r))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(r.listener)?r.listener:r),this._events[e]?n(this._events[e])?this._events[e].push(r):this._events[e]=[this._events[e],r]:this._events[e]=r,n(this._events[e])&&!this._events[e].warned&&(o=s(this._maxListeners)?t.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var n=!1;function s(){this.removeListener(e,s),n||(n=!0,t.apply(this,arguments))}return s.listener=t,this.on(e,s),this},t.prototype.removeListener=function(e,t){var s,r,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(s=this._events[e]).length,r=-1,s===t||i(s.listener)&&s.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(n(s)){for(a=o;a-- >0;)if(s[a]===t||s[a].listener&&s[a].listener===t){r=a;break}if(r<0)return this;1===s.length?(s.length=0,delete this._events[e]):s.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},t.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},t.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},t.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},t.listenerCount=function(e,t){return e.listenerCount(t)}},35035:e=>{"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var i,n="boolean"==typeof t.cycles&&t.cycles,s=t.cmp&&(i=t.cmp,function(e){return function(t,n){var s={key:t,value:e[t]},r={key:n,value:e[n]};return i(s,r)}}),r=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var i,o;if(Array.isArray(t)){for(o="[",i=0;i<t.length;i++)i&&(o+=","),o+=e(t[i])||"null";return o+"]"}if(null===t)return"null";if(-1!==r.indexOf(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=r.push(t)-1,l=Object.keys(t).sort(s&&s(t));for(o="",i=0;i<l.length;i++){var c=l[i],h=e(t[c]);h&&(o&&(o+=","),o+=JSON.stringify(c)+":"+h)}return r.splice(a,1),"{"+o+"}"}}(e)}},94029:(e,t,i)=>{"use strict";var n=i(95320),s=Object.prototype.toString,r=Object.prototype.hasOwnProperty,o=function(e,t,i){for(var n=0,s=e.length;n<s;n++)r.call(e,n)&&(null==i?t(e[n],n,e):t.call(i,e[n],n,e))},a=function(e,t,i){for(var n=0,s=e.length;n<s;n++)null==i?t(e.charAt(n),n,e):t.call(i,e.charAt(n),n,e)},l=function(e,t,i){for(var n in e)r.call(e,n)&&(null==i?t(e[n],n,e):t.call(i,e[n],n,e))};e.exports=function(e,t,i){if(!n(t))throw new TypeError("iterator must be a function");var r;arguments.length>=3&&(r=i),"[object Array]"===s.call(e)?o(e,t,r):"string"==typeof e?a(e,t,r):l(e,t,r)}},17648:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",i=Array.prototype.slice,n=Object.prototype.toString,s="[object Function]";e.exports=function(e){var r=this;if("function"!=typeof r||n.call(r)!==s)throw new TypeError(t+r);for(var o,a=i.call(arguments,1),l=function(){if(this instanceof o){var t=r.apply(this,a.concat(i.call(arguments)));return Object(t)===t?t:this}return r.apply(e,a.concat(i.call(arguments)))},c=Math.max(0,r.length-a.length),h=[],d=0;d<c;d++)h.push("$"+d);if(o=Function("binder","return function ("+h.join(",")+"){ return binder.apply(this,arguments); }")(l),r.prototype){var u=function(){};u.prototype=r.prototype,o.prototype=new u,u.prototype=null}return o}},58612:(e,t,i)=>{"use strict";var n=i(17648);e.exports=Function.prototype.bind||n},40210:(e,t,i)=>{"use strict";var n,s=SyntaxError,r=Function,o=TypeError,a=function(e){try{return Function('"use strict"; return ('+e+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(e){l=null}var c=function(){throw new o},h=l?function(){try{return c}catch(e){try{return l(arguments,"callee").get}catch(e){return c}}}():c,d=i(41405)(),u=Object.getPrototypeOf||function(e){return e.__proto__},p=a("async function* () {}"),m=p?p.prototype:n,g=m?m.prototype:n,f="undefined"==typeof Uint8Array?n:u(Uint8Array),v={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":d?u([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":a("async function () {}"),"%AsyncGenerator%":m,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":g?u(g):n,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":r,"%GeneratorFunction%":a("function* () {}"),"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d?u(u([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&d?u((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&d?u((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d?u(""[Symbol.iterator]()):n,"%Symbol%":d?Symbol:n,"%SyntaxError%":s,"%ThrowTypeError%":h,"%TypedArray%":f,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=i(58612),S=i(17642),E=b.call(Function.call,Array.prototype.concat),w=b.call(Function.apply,Array.prototype.splice),T=b.call(Function.call,String.prototype.replace),_=b.call(Function.call,String.prototype.slice),M=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,x=/\\(\\)?/g,A=function(e){var t=_(e,0,1),i=_(e,-1);if("%"===t&&"%"!==i)throw new s("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==t)throw new s("invalid intrinsic syntax, expected opening `%`");var n=[];return T(e,M,(function(e,t,i,s){n[n.length]=i?T(s,x,"$1"):t||e})),n},O=function(e,t){var i,n=e;if(S(y,n)&&(n="%"+(i=y[n])[0]+"%"),S(v,n)){var r=v[n];if(void 0===r&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:r}}throw new s("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');var i=A(e),n=i.length>0?i[0]:"",r=O("%"+n+"%",t),a=r.name,c=r.value,h=!1,d=r.alias;d&&(n=d[0],w(i,E([0,1],d)));for(var u=1,p=!0;u<i.length;u+=1){var m=i[u],g=_(m,0,1),f=_(m,-1);if(('"'===g||"'"===g||"`"===g||'"'===f||"'"===f||"`"===f)&&g!==f)throw new s("property names with quotes must have matching quotes");if("constructor"!==m&&p||(h=!0),S(v,a="%"+(n+="."+m)+"%"))c=v[a];else if(null!=c){if(!(m in c)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(l&&u+1>=i.length){var y=l(c,m);c=(p=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:c[m]}else p=S(c,m),c=c[m];p&&!h&&(v[a]=c)}}return c}},50972:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.prototype.toJSON;"function"==typeof t||(0,n.default)(0),e.prototype.inspect=t,s.default&&(e.prototype[s.default]=t)};var n=r(i(7706)),s=r(i(18554));function r(e){return e&&e.__esModule?e:{default:e}}},8002:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return o(e,[])};var n,s=(n=i(18554))&&n.__esModule?n:{default:n};function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){switch(r(e)){case"string":return JSON.stringify(e);case"function":return e.name?"[function ".concat(e.name,"]"):"[function]";case"object":return null===e?"null":function(e,t){if(-1!==t.indexOf(e))return"[Circular]";var i=[].concat(t,[e]),n=function(e){var t=e[String(s.default)];if("function"==typeof t)return t;if("function"==typeof e.inspect)return e.inspect}(e);if(void 0!==n){var r=n.call(e);if(r!==e)return"string"==typeof r?r:o(r,i)}else if(Array.isArray(e))return function(e,t){if(0===e.length)return"[]";if(t.length>2)return"[Array]";for(var i=Math.min(10,e.length),n=e.length-i,s=[],r=0;r<i;++r)s.push(o(e[r],t));1===n?s.push("... 1 more item"):n>1&&s.push("... ".concat(n," more items"));return"["+s.join(", ")+"]"}(e,i);return function(e,t){var i=Object.keys(e);if(0===i.length)return"{}";if(t.length>2)return"["+function(e){var t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if("Object"===t&&"function"==typeof e.constructor){var i=e.constructor.name;if("string"==typeof i&&""!==i)return i}return t}(e)+"]";return"{ "+i.map((function(i){return i+": "+o(e[i],t)})).join(", ")+" }"}(e,i)}(e,t);default:return String(e)}}},6589:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i(97986);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){return o(e,[])}function o(e,t){switch(s(e)){case"string":return JSON.stringify(e);case"function":return e.name?"[function ".concat(e.name,"]"):"[function]";case"object":return null===e?"null":function(e,t){if(-1!==t.indexOf(e))return"[Circular]";var i=[].concat(t,[e]),s=function(e){var t=e[String(n.Z)];if("function"==typeof t)return t;if("function"==typeof e.inspect)return e.inspect}(e);if(void 0!==s){var r=s.call(e);if(r!==e)return"string"==typeof r?r:o(r,i)}else if(Array.isArray(e))return function(e,t){if(0===e.length)return"[]";if(t.length>2)return"[Array]";for(var i=Math.min(10,e.length),n=e.length-i,s=[],r=0;r<i;++r)s.push(o(e[r],t));1===n?s.push("... 1 more item"):n>1&&s.push("... ".concat(n," more items"));return"["+s.join(", ")+"]"}(e,i);return function(e,t){var i=Object.keys(e);if(0===i.length)return"{}";if(t.length>2)return"["+function(e){var t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if("Object"===t&&"function"==typeof e.constructor){var i=e.constructor.name;if("string"==typeof i&&""!==i)return i}return t}(e)+"]";return"{ "+i.map((function(i){return i+": "+o(e[i],t)})).join(", ")+" }"}(e,i)}(e,t);default:return String(e)}}},7706:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!Boolean(e))throw new Error(null!=t?t:"Unexpected invariant triggered.")}},18554:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):void 0;t.default=i},97986:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):void 0},91807:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNode=function(e){return null!=e&&"string"==typeof e.kind},t.Token=t.Location=void 0;var n,s=(n=i(50972))&&n.__esModule?n:{default:n};var r=function(){function e(e,t,i){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=i}return e.prototype.toJSON=function(){return{start:this.start,end:this.end}},e}();t.Location=r,(0,s.default)(r);var o=function(){function e(e,t,i,n,s,r,o){this.kind=e,this.start=t,this.end=i,this.line=n,this.column=s,this.value=o,this.prev=r,this.next=null}return e.prototype.toJSON=function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}},e}();t.Token=o,(0,s.default)(o)},83059:(e,t,i)=>{"use strict";i.d(t,{Ye:()=>r,WU:()=>o,UG:()=>a});var n=i(97986);function s(e){var t=e.prototype.toJSON;"function"==typeof t||function(e,t){if(!Boolean(e))throw new Error(null!=t?t:"Unexpected invariant triggered.")}(0),e.prototype.inspect=t,n.Z&&(e.prototype[n.Z]=t)}var r=function(){function e(e,t,i){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=i}return e.prototype.toJSON=function(){return{start:this.start,end:this.end}},e}();s(r);var o=function(){function e(e,t,i,n,s,r,o){this.kind=e,this.start=t,this.end=i,this.line=n,this.column=s,this.value=o,this.prev=r,this.next=null}return e.prototype.toJSON=function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}},e}();function a(e){return null!=e&&"string"==typeof e.kind}s(o)},7420:(e,t,i)=>{"use strict";function n(e){var t=e.split(/\r\n|[\n\r]/g),i=function(e){for(var t,i=!0,n=!0,s=0,r=null,o=0;o<e.length;++o)switch(e.charCodeAt(o)){case 13:10===e.charCodeAt(o+1)&&++o;case 10:i=!1,n=!0,s=0;break;case 9:case 32:++s;break;default:n&&!i&&(null===r||s<r)&&(r=s),n=!1}return null!==(t=r)&&void 0!==t?t:0}(e);if(0!==i)for(var n=1;n<t.length;n++)t[n]=t[n].slice(i);for(var r=0;r<t.length&&s(t[r]);)++r;for(var o=t.length;o>r&&s(t[o-1]);)--o;return t.slice(r,o).join("\n")}function s(e){for(var t=0;t<e.length;++t)if(" "!==e[t]&&"\t"!==e[t])return!1;return!0}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=-1===e.indexOf("\n"),s=" "===e[0]||"\t"===e[0],r='"'===e[e.length-1],o="\\"===e[e.length-1],a=!n||r||o||i,l="";return!a||n&&s||(l+="\n"+t),l+=t?e.replace(/\n/g,"\n"+t):e,a&&(l+="\n"),'"""'+l.replace(/"""/g,'\\"""')+'"""'}i.d(t,{W7:()=>n,LZ:()=>r})},90778:(e,t,i)=>{"use strict";i.d(t,{S:()=>r});var n=i(27636),s=i(7420);function r(e){return(0,n.Vn)(e,{leave:o})}var o={Name:function(e){return e.value},Variable:function(e){return"$"+e.name},Document:function(e){return l(e.definitions,"\n\n")+"\n"},OperationDefinition:function(e){var t=e.operation,i=e.name,n=h("(",l(e.variableDefinitions,", "),")"),s=l(e.directives," "),r=e.selectionSet;return i||s||n||"query"!==t?l([t,l([i,n]),s,r]," "):r},VariableDefinition:function(e){var t=e.variable,i=e.type,n=e.defaultValue,s=e.directives;return t+": "+i+h(" = ",n)+h(" ",l(s," "))},SelectionSet:function(e){return c(e.selections)},Field:function(e){var t=e.alias,i=e.name,n=e.arguments,s=e.directives,r=e.selectionSet,o=h("",t,": ")+i,a=o+h("(",l(n,", "),")");return a.length>80&&(a=o+h("(\n",d(l(n,"\n")),"\n)")),l([a,l(s," "),r]," ")},Argument:function(e){return e.name+": "+e.value},FragmentSpread:function(e){return"..."+e.name+h(" ",l(e.directives," "))},InlineFragment:function(e){var t=e.typeCondition,i=e.directives,n=e.selectionSet;return l(["...",h("on ",t),l(i," "),n]," ")},FragmentDefinition:function(e){var t=e.name,i=e.typeCondition,n=e.variableDefinitions,s=e.directives,r=e.selectionSet;return"fragment ".concat(t).concat(h("(",l(n,", "),")")," ")+"on ".concat(i," ").concat(h("",l(s," ")," "))+r},IntValue:function(e){return e.value},FloatValue:function(e){return e.value},StringValue:function(e,t){var i=e.value;return e.block?(0,s.LZ)(i,"description"===t?"":"  "):JSON.stringify(i)},BooleanValue:function(e){return e.value?"true":"false"},NullValue:function(){return"null"},EnumValue:function(e){return e.value},ListValue:function(e){return"["+l(e.values,", ")+"]"},ObjectValue:function(e){return"{"+l(e.fields,", ")+"}"},ObjectField:function(e){return e.name+": "+e.value},Directive:function(e){return"@"+e.name+h("(",l(e.arguments,", "),")")},NamedType:function(e){return e.name},ListType:function(e){return"["+e.type+"]"},NonNullType:function(e){return e.type+"!"},SchemaDefinition:a((function(e){var t=e.directives,i=e.operationTypes;return l(["schema",l(t," "),c(i)]," ")})),OperationTypeDefinition:function(e){return e.operation+": "+e.type},ScalarTypeDefinition:a((function(e){return l(["scalar",e.name,l(e.directives," ")]," ")})),ObjectTypeDefinition:a((function(e){var t=e.name,i=e.interfaces,n=e.directives,s=e.fields;return l(["type",t,h("implements ",l(i," & ")),l(n," "),c(s)]," ")})),FieldDefinition:a((function(e){var t=e.name,i=e.arguments,n=e.type,s=e.directives;return t+(p(i)?h("(\n",d(l(i,"\n")),"\n)"):h("(",l(i,", "),")"))+": "+n+h(" ",l(s," "))})),InputValueDefinition:a((function(e){var t=e.name,i=e.type,n=e.defaultValue,s=e.directives;return l([t+": "+i,h("= ",n),l(s," ")]," ")})),InterfaceTypeDefinition:a((function(e){var t=e.name,i=e.interfaces,n=e.directives,s=e.fields;return l(["interface",t,h("implements ",l(i," & ")),l(n," "),c(s)]," ")})),UnionTypeDefinition:a((function(e){var t=e.name,i=e.directives,n=e.types;return l(["union",t,l(i," "),n&&0!==n.length?"= "+l(n," | "):""]," ")})),EnumTypeDefinition:a((function(e){var t=e.name,i=e.directives,n=e.values;return l(["enum",t,l(i," "),c(n)]," ")})),EnumValueDefinition:a((function(e){return l([e.name,l(e.directives," ")]," ")})),InputObjectTypeDefinition:a((function(e){var t=e.name,i=e.directives,n=e.fields;return l(["input",t,l(i," "),c(n)]," ")})),DirectiveDefinition:a((function(e){var t=e.name,i=e.arguments,n=e.repeatable,s=e.locations;return"directive @"+t+(p(i)?h("(\n",d(l(i,"\n")),"\n)"):h("(",l(i,", "),")"))+(n?" repeatable":"")+" on "+l(s," | ")})),SchemaExtension:function(e){var t=e.directives,i=e.operationTypes;return l(["extend schema",l(t," "),c(i)]," ")},ScalarTypeExtension:function(e){return l(["extend scalar",e.name,l(e.directives," ")]," ")},ObjectTypeExtension:function(e){var t=e.name,i=e.interfaces,n=e.directives,s=e.fields;return l(["extend type",t,h("implements ",l(i," & ")),l(n," "),c(s)]," ")},InterfaceTypeExtension:function(e){var t=e.name,i=e.interfaces,n=e.directives,s=e.fields;return l(["extend interface",t,h("implements ",l(i," & ")),l(n," "),c(s)]," ")},UnionTypeExtension:function(e){var t=e.name,i=e.directives,n=e.types;return l(["extend union",t,l(i," "),n&&0!==n.length?"= "+l(n," | "):""]," ")},EnumTypeExtension:function(e){var t=e.name,i=e.directives,n=e.values;return l(["extend enum",t,l(i," "),c(n)]," ")},InputObjectTypeExtension:function(e){var t=e.name,i=e.directives,n=e.fields;return l(["extend input",t,l(i," "),c(n)]," ")}};function a(e){return function(t){return l([t.description,e(t)],"\n")}}function l(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return null!==(t=null==e?void 0:e.filter((function(e){return e})).join(i))&&void 0!==t?t:""}function c(e){return h("{\n",d(l(e,"\n")),"\n}")}function h(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return null!=t&&""!==t?e+t+i:""}function d(e){return h("  ",e.replace(/\n/g,"\n  "))}function u(e){return-1!==e.indexOf("\n")}function p(e){return null!=e&&e.some(u)}},80285:(e,t,i)=>{"use strict";t.Vn=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o,n=void 0,c=Array.isArray(e),h=[e],d=-1,u=[],p=void 0,m=void 0,g=void 0,f=[],v=[],y=e;do{var b=++d===h.length,S=b&&0!==u.length;if(b){if(m=0===v.length?void 0:f[f.length-1],p=g,g=v.pop(),S){if(c)p=p.slice();else{for(var E={},w=0,T=Object.keys(p);w<T.length;w++){var _=T[w];E[_]=p[_]}p=E}for(var M=0,x=0;x<u.length;x++){var A=u[x][0],O=u[x][1];c&&(A-=M),c&&null===O?(p.splice(A,1),M++):p[A]=O}}d=n.index,h=n.keys,u=n.edits,c=n.inArray,n=n.prev}else{if(m=g?c?d:h[d]:void 0,null==(p=g?g[m]:y))continue;g&&f.push(m)}var P,D=void 0;if(!Array.isArray(p)){if(!(0,r.isNode)(p))throw new Error("Invalid AST Node: ".concat((0,s.default)(p),"."));var C=l(t,p.kind,b);if(C){if((D=C.call(t,p,m,g,f,v))===a)break;if(!1===D){if(!b){f.pop();continue}}else if(void 0!==D&&(u.push([m,D]),!b)){if(!(0,r.isNode)(D)){f.pop();continue}p=D}}}if(void 0===D&&S&&u.push([m,p]),b)f.pop();else n={inArray:c,index:d,keys:h,edits:u,prev:n},c=Array.isArray(p),h=c?p:null!==(P=i[p.kind])&&void 0!==P?P:[],d=-1,u=[],g&&v.push(g),g=p}while(void 0!==n);0!==u.length&&(y=u[u.length-1][1]);return y};var n,s=(n=i(8002))&&n.__esModule?n:{default:n},r=i(91807);var o={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]};var a=Object.freeze({});function l(e,t,i){var n=e[t];if(n){if(!i&&"function"==typeof n)return n;var s=i?n.leave:n.enter;if("function"==typeof s)return s}else{var r=i?e.leave:e.enter;if(r){if("function"==typeof r)return r;var o=r[t];if("function"==typeof o)return o}}}},27636:(e,t,i)=>{"use strict";i.d(t,{$_:()=>o,Vn:()=>a});var n=i(6589),s=i(83059),r={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},o=Object.freeze({});function a(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r,a=void 0,c=Array.isArray(e),h=[e],d=-1,u=[],p=void 0,m=void 0,g=void 0,f=[],v=[],y=e;do{var b=++d===h.length,S=b&&0!==u.length;if(b){if(m=0===v.length?void 0:f[f.length-1],p=g,g=v.pop(),S){if(c)p=p.slice();else{for(var E={},w=0,T=Object.keys(p);w<T.length;w++){var _=T[w];E[_]=p[_]}p=E}for(var M=0,x=0;x<u.length;x++){var A=u[x][0],O=u[x][1];c&&(A-=M),c&&null===O?(p.splice(A,1),M++):p[A]=O}}d=a.index,h=a.keys,u=a.edits,c=a.inArray,a=a.prev}else{if(m=g?c?d:h[d]:void 0,null==(p=g?g[m]:y))continue;g&&f.push(m)}var P,D=void 0;if(!Array.isArray(p)){if(!(0,s.UG)(p))throw new Error("Invalid AST Node: ".concat((0,n.Z)(p),"."));var C=l(t,p.kind,b);if(C){if((D=C.call(t,p,m,g,f,v))===o)break;if(!1===D){if(!b){f.pop();continue}}else if(void 0!==D&&(u.push([m,D]),!b)){if(!(0,s.UG)(D)){f.pop();continue}p=D}}}if(void 0===D&&S&&u.push([m,p]),b)f.pop();else a={inArray:c,index:d,keys:h,edits:u,prev:a},h=(c=Array.isArray(p))?p:null!==(P=i[p.kind])&&void 0!==P?P:[],d=-1,u=[],g&&v.push(g),g=p}while(void 0!==a);return 0!==u.length&&(y=u[u.length-1][1]),y}function l(e,t,i){var n=e[t];if(n){if(!i&&"function"==typeof n)return n;var s=i?n.leave:n.enter;if("function"==typeof s)return s}else{var r=i?e.leave:e.enter;if(r){if("function"==typeof r)return r;var o=r[t];if("function"==typeof o)return o}}}},41405:(e,t,i)=>{"use strict";var n=i.g.Symbol,s=i(55419);e.exports=function(){return"function"==typeof n&&("function"==typeof Symbol&&("symbol"==typeof n("foo")&&("symbol"==typeof Symbol("bar")&&s())))}},55419:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),i=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(e,t);if(42!==s.value||!0!==s.enumerable)return!1}return!0}},17642:(e,t,i)=>{"use strict";var n=i(58612);e.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},48738:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},95320:e=>{"use strict";var t,i,n=Function.prototype.toString,s="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof s&&"function"==typeof Object.defineProperty)try{t=Object.defineProperty({},"length",{get:function(){throw i}}),i={},s((function(){throw 42}),null,t)}catch(e){e!==i&&(s=null)}else s=null;var r=/^\s*class\b/,o=function(e){try{var t=n.call(e);return r.test(t)}catch(e){return!1}},a=Object.prototype.toString,l="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=s?function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;try{s(e,null,t)}catch(e){if(e!==i)return!1}return!o(e)}:function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;if(l)return function(e){try{return!o(e)&&(n.call(e),!0)}catch(e){return!1}}(e);if(o(e))return!1;var t=a.call(e);return"[object Function]"===t||"[object GeneratorFunction]"===t}},73134:(e,t,i)=>{var n=i(12739),s=i(47529),r=i(14176),o=["x","e","a","o","n","s","r","c","u","m","v","w","z"],a=["m","w"],l=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],c="\t".charCodeAt(0),h=" ".charCodeAt(0);function d(e){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(e)}function u(e){return new Function(["return function "+e+"() {","  return this._"+e,"}"].join("\n"))()}function p(e,t){if(!e.chars||0===e.chars.length)return null;var i=g(e.chars,t);return i>=0?e.chars[i]:null}function m(e,t,i){if(!e.kernings||0===e.kernings.length)return 0;for(var n=e.kernings,s=0;s<n.length;s++){var r=n[s];if(r.first===t&&r.second===i)return r.amount}return 0}function g(e,t,i){for(var n=i=i||0;n<e.length;n++)if(e[n].id===t)return n;return-1}e.exports=function(e){return new d(e)},d.prototype.update=function(e){if(e=s({measure:this._measure},e),this._opt=e,this._opt.tabSize=r(this._opt.tabSize,4),!e.font)throw new Error("must provide a valid bitmap font");var t=this.glyphs,i=e.text||"",a=e.font;this._setupSpaceGlyphs(a);var c=n.lines(i,e);t.length=0;var h=c.reduce((function(e,t){return Math.max(e,t.width,0)}),0),d=0,u=0,p=r(e.lineHeight,a.common.lineHeight),f=a.common.base,v=p-f,y=e.letterSpacing||0,b=p*c.length-v,S=function(e){if("center"===e)return 1;if("right"===e)return 2;return 0}(this._opt.align);u-=b,this._width=h,this._height=b,this._descender=p-f,this._baseline=f,this._xHeight=function(e){for(var t=0;t<o.length;t++){var i=o[t].charCodeAt(0),n=g(e.chars,i);if(n>=0)return e.chars[n].height}return 0}(a),this._capHeight=function(e){for(var t=0;t<l.length;t++){var i=l[t].charCodeAt(0),n=g(e.chars,i);if(n>=0)return e.chars[n].height}return 0}(a),this._lineHeight=p,this._ascender=p-v-this._xHeight;var E=this;c.forEach((function(e,n){for(var s,r=e.start,o=e.end,l=e.width,c=r;c<o;c++){var g=i.charCodeAt(c),f=E.getGlyph(a,g);if(f){s&&(d+=m(a,s.id,f.id));var v=d;1===S?v+=(h-l)/2:2===S&&(v+=h-l),t.push({position:[v,u],data:f,index:c,line:n}),d+=f.xadvance+y,s=f}}u+=p,d=0})),this._linesTotal=c.length},d.prototype._setupSpaceGlyphs=function(e){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,e.chars&&0!==e.chars.length){var t=p(e,h)||function(e){for(var t=0;t<a.length;t++){var i=a[t].charCodeAt(0),n=g(e.chars,i);if(n>=0)return e.chars[n]}return 0}(e)||e.chars[0],i=this._opt.tabSize*t.xadvance;this._fallbackSpaceGlyph=t,this._fallbackTabGlyph=s(t,{x:0,y:0,xadvance:i,id:c,xoffset:0,yoffset:0,width:0,height:0})}},d.prototype.getGlyph=function(e,t){var i=p(e,t);return i||(t===c?this._fallbackTabGlyph:t===h?this._fallbackSpaceGlyph:null)},d.prototype.computeMetrics=function(e,t,i,n){var s,r=this._opt.letterSpacing||0,o=this._opt.font,a=0,l=0,c=0;if(!o.chars||0===o.chars.length)return{start:t,end:t,width:0};i=Math.min(e.length,i);for(var h=t;h<i;h++){var d,u=e.charCodeAt(h);if(d=this.getGlyph(o,u)){d.xoffset;var p=(a+=s?m(o,s.id,d.id):0)+d.xadvance+r,g=a+d.width;if(g>=n||p>=n)break;a=p,l=g,s=d}c++}return s&&(l+=s.xoffset),{start:t,end:t+c,width:l}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach((function(e){Object.defineProperty(d.prototype,e,{get:u(e),configurable:!0})}))},54078:(e,t,i)=>{"use strict";var n=i(94029),s=i(42473),r=i(17642),o=i(46057),a=function(e){s(!1,e)},l=String.prototype.replace,c=String.prototype.split,h="||||",d=function(e){var t=e%100,i=t%10;return 11!==t&&1===i?0:2<=i&&i<=4&&!(t>=12&&t<=14)?1:2},u={pluralTypes:{arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:d,chinese:function(){return 0},croatian:d,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:d,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},pluralTypeToLanguages:{arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]}};function p(e,t){var i,s,r=(i=e.pluralTypeToLanguages,s={},n(i,(function(e,t){n(e,(function(e){s[e]=t}))})),s);return r[t]||r[c.call(t,/-/,1)[0]]||r.en}function m(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var g=/%\{(.*?)\}/g;function f(e,t,i,n,s){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var a=e,d=n||g,m=s||u,f="number"==typeof t?{smart_count:t}:t;if(null!=f.smart_count&&a){var v=c.call(a,h);a=o(v[function(e,t,i){return e.pluralTypes[p(e,t)](i)}(m,i||"en",f.smart_count)]||v[0])}return a=l.call(a,d,(function(e,t){return r(f,t)&&null!=f[t]?f[t]:e}))}function v(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var i=t.allowMissing?f:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:i,this.warn=t.warn||a,this.tokenRegex=function(e){var t=e&&e.prefix||"%{",i=e&&e.suffix||"}";if(t===h||i===h)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(m(t)+"(.*?)"+m(i),"g")}(t.interpolation),this.pluralRules=t.pluralRules||u}v.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},v.prototype.extend=function(e,t){n(e,(function(e,i){var n=t?t+"."+i:i;"object"==typeof e?this.extend(e,n):this.phrases[n]=e}),this)},v.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:n(e,(function(e,i){var n=t?t+"."+i:i;"object"==typeof e?this.unset(e,n):delete this.phrases[n]}),this)},v.prototype.clear=function(){this.phrases={}},v.prototype.replace=function(e){this.clear(),this.extend(e)},v.prototype.t=function(e,t){var i,n,s=null==t?{}:t;if("string"==typeof this.phrases[e])i=this.phrases[e];else if("string"==typeof s._)i=s._;else if(this.onMissingKey){n=(0,this.onMissingKey)(e,s,this.currentLocale,this.tokenRegex,this.pluralRules)}else this.warn('Missing translation for key: "'+e+'"'),n=e;return"string"==typeof i&&(n=f(i,s,this.currentLocale,this.tokenRegex,this.pluralRules)),n},v.prototype.has=function(e){return r(this.phrases,e)},v.transformPhrase=function(e,t,i){return f(e,t,i)},e.exports=v},18987:(e,t,i)=>{"use strict";var n;if(!Object.keys){var s=Object.prototype.hasOwnProperty,r=Object.prototype.toString,o=i(21414),a=Object.prototype.propertyIsEnumerable,l=!a.call({toString:null},"toString"),c=a.call((function(){}),"prototype"),h=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=function(e){var t=e.constructor;return t&&t.prototype===e},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!u["$"+e]&&s.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{d(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();n=function(e){var t=null!==e&&"object"==typeof e,i="[object Function]"===r.call(e),n=o(e),a=t&&"[object String]"===r.call(e),u=[];if(!t&&!i&&!n)throw new TypeError("Object.keys called on a non-object");var m=c&&i;if(a&&e.length>0&&!s.call(e,0))for(var g=0;g<e.length;++g)u.push(String(g));if(n&&e.length>0)for(var f=0;f<e.length;++f)u.push(String(f));else for(var v in e)m&&"prototype"===v||!s.call(e,v)||u.push(String(v));if(l)for(var y=function(e){if("undefined"==typeof window||!p)return d(e);try{return d(e)}catch(e){return!1}}(e),b=0;b<h.length;++b)y&&"constructor"===h[b]||!s.call(e,h[b])||u.push(h[b]);return u}}e.exports=n},82215:(e,t,i)=>{"use strict";var n=Array.prototype.slice,s=i(21414),r=Object.keys,o=r?function(e){return r(e)}:i(18987),a=Object.keys;o.shim=function(){Object.keys?function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2)||(Object.keys=function(e){return s(e)?a(n.call(e)):a(e)}):Object.keys=o;return Object.keys||o},e.exports=o},21414:e=>{"use strict";var t=Object.prototype.toString;e.exports=function(e){var i=t.call(e),n="[object Arguments]"===i;return n||(n="[object Array]"!==i&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===t.call(e.callee)),n}},17141:(e,t,i)=>{var n;!function(s,r){var o={};function a(e){return function(){var t={method:e},i=Array.prototype.slice.call(arguments);/^get/.test(e)?(o.assert(i.length>0,"Get methods require a callback."),i.unshift(t)):(/^set/.test(e)&&(o.assert(0!==i.length,"Set methods require a value."),t.value=i[0]),i=[t]),this.send.apply(this,i)}}o.DEBUG=!1,o.VERSION="0.0.11",o.CONTEXT="player.js",o.POST_MESSAGE=!!s.postMessage,o.origin=function(e){return"//"===e.substr(0,2)&&(e=s.location.protocol+e),e.split("/").slice(0,3).join("/")},o.addEvent=function(e,t,i){e&&(e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i)},o.log=function(){o.log.history=o.log.history||[],o.log.history.push(arguments),s.console&&o.DEBUG&&s.console.log(Array.prototype.slice.call(arguments))},o.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},o.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},o.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},o.isNone=function(e){return null==e},o.has=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.indexOf=function(e,t){if(null==e)return-1;var i=0,n=e.length;if(Array.prototype.IndexOf&&e.indexOf===Array.prototype.IndexOf)return e.indexOf(t);for(;i<n;i++)if(e[i]===t)return i;return-1},o.assert=function(e,t){if(!e)throw t||"Player.js Assert Failed"},o.Keeper=function(){this.init()},o.Keeper.prototype.init=function(){this.data={}},o.Keeper.prototype.getUUID=function(){return"listener-xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},o.Keeper.prototype.has=function(e,t){if(!this.data.hasOwnProperty(e))return!1;if(o.isNone(t))return!0;for(var i=this.data[e],n=0;n<i.length;n++)if(i[n].id===t)return!0;return!1},o.Keeper.prototype.add=function(e,t,i,n,s){var r={id:e,event:t,cb:i,ctx:n,one:s};this.has(t)?this.data[t].push(r):this.data[t]=[r]},o.Keeper.prototype.execute=function(e,t,i,n){if(!this.has(e,t))return!1;for(var s=[],r=[],a=0;a<this.data[e].length;a++){var l=this.data[e][a];o.isNone(t)||!o.isNone(t)&&l.id===t?(r.push({cb:l.cb,ctx:l.ctx?l.ctx:n,data:i}),!1===l.one&&s.push(l)):s.push(l)}0===s.length?delete this.data[e]:this.data[e]=s;for(var c=0;c<r.length;c++){var h=r[c];h.cb.call(h.ctx,h.data)}},o.Keeper.prototype.on=function(e,t,i,n){this.add(e,t,i,n,!1)},o.Keeper.prototype.one=function(e,t,i,n){this.add(e,t,i,n,!0)},o.Keeper.prototype.off=function(e,t){var i=[];if(!this.data.hasOwnProperty(e))return i;for(var n=[],s=0;s<this.data[e].length;s++){var r=this.data[e][s];o.isNone(t)||r.cb===t?o.isNone(r.id)||i.push(r.id):n.push(r)}return 0===n.length?delete this.data[e]:this.data[e]=n,i},o.Player=function(e,t){if(!(this instanceof o.Player))return new o.Player(e,t);this.init(e,t)},o.EVENTS={READY:"ready",PLAY:"play",PAUSE:"pause",ENDED:"ended",TIMEUPDATE:"timeupdate",PROGRESS:"progress",ERROR:"error"},o.EVENTS.all=function(){var e=[];for(var t in o.EVENTS)o.has(o.EVENTS,t)&&o.isString(o.EVENTS[t])&&e.push(o.EVENTS[t]);return e},o.METHODS={PLAY:"play",PAUSE:"pause",GETPAUSED:"getPaused",MUTE:"mute",UNMUTE:"unmute",GETMUTED:"getMuted",SETVOLUME:"setVolume",GETVOLUME:"getVolume",GETDURATION:"getDuration",SETCURRENTTIME:"setCurrentTime",GETCURRENTTIME:"getCurrentTime",SETLOOP:"setLoop",GETLOOP:"getLoop",REMOVEEVENTLISTENER:"removeEventListener",ADDEVENTLISTENER:"addEventListener"},o.METHODS.all=function(){var e=[];for(var t in o.METHODS)o.has(o.METHODS,t)&&o.isString(o.METHODS[t])&&e.push(o.METHODS[t]);return e},o.READIED=[],o.Player.prototype.init=function(e,t){var i=this;o.isString(e)&&(e=r.getElementById(e)),this.elem=e,o.assert("IFRAME"===e.nodeName,'playerjs.Player constructor requires an Iframe, got "'+e.nodeName+'"'),o.assert(e.src,"playerjs.Player constructor requires a Iframe with a 'src' attribute."),this.origin=o.origin(e.src),this.keeper=new o.Keeper,this.isReady=!1,this.queue=[],this.events=o.EVENTS.all(),this.methods=o.METHODS.all(),o.POST_MESSAGE?o.addEvent(s,"message",(function(e){i.receive(e)})):o.log("Post Message is not Available."),o.indexOf(o.READIED,e.src)>-1?i.loaded=!0:this.elem.onload=function(){i.loaded=!0}},o.Player.prototype.send=function(e,t,i){if(e.context=o.CONTEXT,e.version=o.VERSION,t){var n=this.keeper.getUUID();e.listener=n,this.keeper.one(n,e.method,t,i)}return this.isReady||"ready"===e.value?(o.log("Player.send",e,this.origin),!0===this.loaded&&this.elem.contentWindow.postMessage(JSON.stringify(e),this.origin),!0):(o.log("Player.queue",e),this.queue.push(e),!1)},o.Player.prototype.receive=function(e){if(o.log("Player.receive",e),e.origin!==this.origin)return!1;var t;try{t=JSON.parse(e.data)}catch(e){return!1}if(t.context!==o.CONTEXT)return!1;"ready"===t.event&&t.value&&t.value.src===this.elem.src&&this.ready(t),this.keeper.has(t.event,t.listener)&&this.keeper.execute(t.event,t.listener,t.value,this)},o.Player.prototype.ready=function(e){if(!0===this.isReady)return!1;e.value.events&&(this.events=e.value.events),e.value.methods&&(this.methods=e.value.methods),this.isReady=!0,this.loaded=!0;for(var t=0;t<this.queue.length;t++){var i=this.queue[t];o.log("Player.dequeue",i),"ready"===e.event&&this.keeper.execute(i.event,i.listener,!0,this),this.send(i)}this.queue=[]},o.Player.prototype.on=function(e,t,i){var n=this.keeper.getUUID();return"ready"===e?this.keeper.one(n,e,t,i):this.keeper.on(n,e,t,i),this.send({method:"addEventListener",value:e,listener:n}),!0},o.Player.prototype.off=function(e,t){var i=this.keeper.off(e,t);if(o.log("Player.off",i),i.length>0)for(var n in i)return this.send({method:"removeEventListener",value:e,listener:i[n]}),!0;return!1},o.Player.prototype.supports=function(e,t){o.assert(o.indexOf(["method","event"],e)>-1,'evtOrMethod needs to be either "event" or "method" got '+e),t=o.isArray(t)?t:[t];for(var i="event"===e?this.events:this.methods,n=0;n<t.length;n++)if(-1===o.indexOf(i,t[n]))return!1;return!0};for(var l=0,c=o.METHODS.all().length;l<c;l++){var h=o.METHODS.all()[l];o.Player.prototype.hasOwnProperty(h)||(o.Player.prototype[h]=a(h))}o.addEvent(s,"message",(function(e){var t;try{t=JSON.parse(e.data)}catch(e){return!1}if(t.context!==o.CONTEXT)return!1;"ready"===t.event&&t.value&&t.value.src&&o.READIED.push(t.value.src)})),o.Receiver=function(e,t){this.init(e,t)},o.Receiver.prototype.init=function(e,t){var i=this;this.isReady=!1,this.origin=o.origin(r.referrer),this.methods={},this.supported={events:e||o.EVENTS.all(),methods:t||o.METHODS.all()},this.eventListeners={},this.reject=!(s.self!==s.top&&o.POST_MESSAGE),this.reject||o.addEvent(s,"message",(function(e){i.receive(e)}))},o.Receiver.prototype.receive=function(e){if(e.origin!==this.origin)return!1;var t={};if(o.isObject(e.data))t=e.data;else try{t=s.JSON.parse(e.data)}catch(e){o.log("JSON Parse Error",e)}if(o.log("Receiver.receive",e,t),!t.method)return!1;if(t.context!==o.CONTEXT)return!1;if(-1===o.indexOf(o.METHODS.all(),t.method))return this.emit("error",{code:2,msg:'Invalid Method "'+t.method+'"'}),!1;var i=o.isNone(t.listener)?null:t.listener;if("addEventListener"===t.method)this.eventListeners.hasOwnProperty(t.value)?-1===o.indexOf(this.eventListeners[t.value],i)&&this.eventListeners[t.value].push(i):this.eventListeners[t.value]=[i],"ready"===t.value&&this.isReady&&this.ready();else if("removeEventListener"===t.method){if(this.eventListeners.hasOwnProperty(t.value)){var n=o.indexOf(this.eventListeners[t.value],i);n>-1&&this.eventListeners[t.value].splice(n,1),0===this.eventListeners[t.value].length&&delete this.eventListeners[t.value]}}else this.get(t.method,t.value,i)},o.Receiver.prototype.get=function(e,t,i){var n=this;if(!this.methods.hasOwnProperty(e))return this.emit("error",{code:3,msg:'Method Not Supported"'+e+'"'}),!1;var s=this.methods[e];if("get"===e.substr(0,3)){s.call(this,(function(t){n.send(e,t,i)}))}else s.call(this,t)},o.Receiver.prototype.on=function(e,t){this.methods[e]=t},o.Receiver.prototype.send=function(e,t,i){if(o.log("Receiver.send",e,t,i),this.reject)return o.log("Receiver.send.reject",e,t,i),!1;var n={context:o.CONTEXT,version:o.VERSION,event:e};o.isNone(t)||(n.value=t),o.isNone(i)||(n.listener=i);var r=JSON.stringify(n);s.parent.postMessage(r,""===this.origin?"*":this.origin)},o.Receiver.prototype.emit=function(e,t){if(!this.eventListeners.hasOwnProperty(e))return!1;o.log("Instance.emit",e,t,this.eventListeners[e]);for(var i=0;i<this.eventListeners[e].length;i++){var n=this.eventListeners[e][i];this.send(e,t,n)}return!0},o.Receiver.prototype.ready=function(){o.log("Receiver.ready"),this.isReady=!0;var e={src:s.location.toString(),events:this.supported.events,methods:this.supported.methods};this.emit("ready",e)||this.send("ready",e)},o.HTML5Adapter=function(e){if(!(this instanceof o.HTML5Adapter))return new o.HTML5Adapter(e);this.init(e)},o.HTML5Adapter.prototype.init=function(e){o.assert(e,"playerjs.HTML5Adapter requires a video element");var t=this.receiver=new o.Receiver;e.addEventListener("playing",(function(){t.emit("play")})),e.addEventListener("pause",(function(){t.emit("pause")})),e.addEventListener("ended",(function(){t.emit("ended")})),e.addEventListener("timeupdate",(function(){t.emit("timeupdate",{seconds:e.currentTime,duration:e.duration})})),e.addEventListener("progress",(function(){t.emit("buffered",{percent:e.buffered.length})})),t.on("play",(function(){e.play()})),t.on("pause",(function(){e.pause()})),t.on("getPaused",(function(t){t(e.paused)})),t.on("getCurrentTime",(function(t){t(e.currentTime)})),t.on("setCurrentTime",(function(t){e.currentTime=t})),t.on("getDuration",(function(t){t(e.duration)})),t.on("getVolume",(function(t){t(100*e.volume)})),t.on("setVolume",(function(t){e.volume=t/100})),t.on("mute",(function(){e.muted=!0})),t.on("unmute",(function(){e.muted=!1})),t.on("getMuted",(function(t){t(e.muted)})),t.on("getLoop",(function(t){t(e.loop)})),t.on("setLoop",(function(t){e.loop=t}))},o.HTML5Adapter.prototype.ready=function(){this.receiver.ready()},o.JWPlayerAdapter=function(e){if(!(this instanceof o.JWPlayerAdapter))return new o.JWPlayerAdapter(e);this.init(e)},o.JWPlayerAdapter.prototype.init=function(e){o.assert(e,"playerjs.JWPlayerAdapter requires a player object");var t=this.receiver=new o.Receiver;this.looped=!1,e.on("pause",(function(){t.emit("pause")})),e.on("play",(function(){t.emit("play")})),e.on("time",(function(e){var i=e.position,n=e.duration;if(!i||!n)return!1;var s={seconds:i,duration:n};t.emit("timeupdate",s)}));var i=this;e.on("complete",(function(){!0===i.looped?e.seek(0):t.emit("ended")})),e.on("error",(function(){t.emit("error")})),t.on("play",(function(){e.play(!0)})),t.on("pause",(function(){e.pause(!0)})),t.on("getPaused",(function(t){t(e.getState().toLowerCase()!=="PLAYING".toLowerCase())})),t.on("getCurrentTime",(function(t){t(e.getPosition())})),t.on("setCurrentTime",(function(t){e.seek(t)})),t.on("getDuration",(function(t){t(e.getDuration())})),t.on("getVolume",(function(t){t(e.getVolume())})),t.on("setVolume",(function(t){e.setVolume(t)})),t.on("mute",(function(){e.setMute(!0)})),t.on("unmute",(function(){e.setMute(!1)})),t.on("getMuted",(function(t){t(!0===e.getMute())})),t.on("getLoop",(function(e){e(this.looped)}),this),t.on("setLoop",(function(e){this.looped=e}),this)},o.JWPlayerAdapter.prototype.ready=function(){this.receiver.ready()},o.MockAdapter=function(){if(!(this instanceof o.MockAdapter))return new o.MockAdapter;this.init()},o.MockAdapter.prototype.init=function(){var e={duration:20,currentTime:0,interval:null,timeupdate:function(){},volume:100,mute:!1,playing:!1,loop:!1,play:function(){e.interval=setInterval((function(){e.currentTime+=.25,e.timeupdate({seconds:e.currentTime,duration:e.duration})}),250),e.playing=!0},pause:function(){clearInterval(e.interval),e.playing=!1}},t=this.receiver=new o.Receiver;t.on("play",(function(){var t=this;e.play(),this.emit("play"),e.timeupdate=function(e){t.emit("timeupdate",e)}})),t.on("pause",(function(){e.pause(),this.emit("pause")})),t.on("getPaused",(function(t){t(!e.playing)})),t.on("getCurrentTime",(function(t){t(e.currentTime)})),t.on("setCurrentTime",(function(t){e.currentTime=t})),t.on("getDuration",(function(t){t(e.duration)})),t.on("getVolume",(function(t){t(e.volume)})),t.on("setVolume",(function(t){e.volume=t})),t.on("mute",(function(){e.mute=!0})),t.on("unmute",(function(){e.mute=!1})),t.on("getMuted",(function(t){t(e.mute)})),t.on("getLoop",(function(t){t(e.loop)})),t.on("setLoop",(function(t){e.loop=t}))},o.MockAdapter.prototype.ready=function(){this.receiver.ready()},o.VideoJSAdapter=function(e){if(!(this instanceof o.VideoJSAdapter))return new o.VideoJSAdapter(e);this.init(e)},o.VideoJSAdapter.prototype.init=function(e){o.assert(e,"playerjs.VideoJSReceiver requires a player object");var t=this.receiver=new o.Receiver;e.on("pause",(function(){t.emit("pause")})),e.on("play",(function(){t.emit("play")})),e.on("timeupdate",(function(i){var n=e.currentTime(),s=e.duration();if(!n||!s)return!1;var r={seconds:n,duration:s};t.emit("timeupdate",r)})),e.on("ended",(function(){t.emit("ended")})),e.on("error",(function(){t.emit("error")})),t.on("play",(function(){e.play()})),t.on("pause",(function(){e.pause()})),t.on("getPaused",(function(t){t(e.paused())})),t.on("getCurrentTime",(function(t){t(e.currentTime())})),t.on("setCurrentTime",(function(t){e.currentTime(t)})),t.on("getDuration",(function(t){t(e.duration())})),t.on("getVolume",(function(t){t(100*e.volume())})),t.on("setVolume",(function(t){e.volume(t/100)})),t.on("mute",(function(){e.volume(0)})),t.on("unmute",(function(){e.volume(1)})),t.on("getMuted",(function(t){t(0===e.volume())})),t.on("getLoop",(function(t){t(e.loop())})),t.on("setLoop",(function(t){e.loop(t)}))},o.VideoJSAdapter.prototype.ready=function(){this.receiver.ready()},void 0===(n=function(){return o}.call(t,i,t,e))||(e.exports=n)}(window,document)},49613:(e,t,i)=>{"use strict";var n=i(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.MaterialComponent=void 0;var s=n(i(34575)),r=n(i(93913)),o=n(i(78585)),a=n(i(29754)),l=n(i(2205)),c=n(i(50008)),h=i(30888),d=i(47056),u=i(26605),p=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===("undefined"==typeof Reflect?"undefined":(0,c.default)(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},m=["disabled"],g=function(e){function t(){return(0,s.default)(this,t),(0,o.default)(this,(0,a.default)(t).apply(this,arguments))}return(0,l.default)(t,e),(0,r.default)(t,[{key:"render",value:function(e){this.classText||(this.classText=this.buildClassName(e));var t=e,i=t.className||t.class||"";t.class&&delete t.class,t.className&&delete t.className;var n=this.materialDom(t),s="attributes";return"props"in n?(s="props",n.props=n.props||{}):n.attributes=n.attributes||{},n[s].className="".concat(i," ").concat(this.getClassName(n)).split(" ").filter((function(e,t,i){return i.indexOf(e)===t&&""!==e})).join(" "),this.mdcProps.forEach((function(e){e in m||delete n[s][e]})),n}},{key:"componentDidMount",value:function(){this.props.ripple&&this.control&&(this.ripple=new h.MDCRipple(this.control))}},{key:"componentWillReceiveProps",value:function(e){if(this.MDComponent&&this.mdcNotifyProps){var t=!0,i=!1,n=void 0;try{for(var s,r=this.mdcNotifyProps[Symbol.iterator]();!(t=(s=r.next()).done);t=!0){var o=s.value;this.props[o]!==e[o]&&(this.MDComponent[o]=e[o])}}catch(e){i=!0,n=e}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}var a=!0,l=!1,c=void 0;try{for(var h,d=this.mdcProps[Symbol.iterator]();!(a=(h=d.next()).done);a=!0){var u=h.value;if(this.props[u]!==e[u]){this.classText=this.buildClassName(e);break}}}catch(e){l=!0,c=e}finally{try{a||null==d.return||d.return()}finally{if(l)throw c}}}},{key:"componentWillUnmount",value:function(){this.ripple&&this.ripple.destroy()}},{key:"afterComponentDidMount",value:function(){if(this.MDComponent&&this.mdcNotifyProps){var e=!0,t=!1,i=void 0;try{for(var n,s=this.mdcNotifyProps[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var r=n.value;this.MDComponent[r]=this.props[r]}}catch(e){t=!0,i=e}finally{try{e||null==s.return||s.return()}finally{if(t)throw i}}}}},{key:"setControlRef",value:function(e){this.control=e}},{key:"buildClassName",value:function(e){var t="mdc-"+this.componentName;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];"boolean"==typeof n&&n&&-1!==this.mdcProps.indexOf(i)&&(t+=" mdc-".concat(this.componentName,"--").concat(i))}return t}},{key:"getClassName",value:function(e){if(!e)return"";var t="attributes";"props"in e?(t="props",e.props=e.props||{}):e.attributes=e.attributes||{};var i=e[t]=e[t]||{},n=this.classText;return i.class&&(n+=" "+i.class),i.className&&i.className!==i.class&&(n+=" "+i.className),n}}]),t}(u.Component);t.MaterialComponent=g,p([d.bind],g.prototype,"setControlRef",null);var f=g;t.default=f},28276:(e,t,i)=>{"use strict";var n=i(95318);t.ZP=void 0;var s=n(i(34575)),r=n(i(93913)),o=n(i(78585)),a=n(i(29754)),l=n(i(16525)),c=n(i(2205)),h=n(i(50008)),d=i(69826),u=i(47056),p=i(26605),m=n(i(49613)),g=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===("undefined"==typeof Reflect?"undefined":(0,h.default)(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},f=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i},v=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,o.default)(this,(0,a.default)(t).apply(this,arguments))).componentName="slider",e.mdcProps=["discrete"],e}return(0,c.default)(t,e),(0,r.default)(t,[{key:"componentDidMount",value:function(){(0,l.default)((0,a.default)(t.prototype),"componentDidMount",this).call(this),this.control&&(this.MDComponent=new d.MDCSlider(this.control),this.MDComponent.listen("MDCSlider:change",this.onChange),this.MDComponent.listen("MDCSlider:input",this.onInput)),this.setValue(this.props.value)}},{key:"componentWillUnmount",value:function(){(0,l.default)((0,a.default)(t.prototype),"componentWillUnmount",this).call(this),this.MDComponent&&(this.MDComponent.unlisten("MDCSlider:change",this.onChange),this.MDComponent.unlisten("MDCSlider:input",this.onInput),this.MDComponent.destroy())}},{key:"getValue",value:function(){if(this.MDComponent)return this.MDComponent.value}},{key:"setValue",value:function(e){var t=this.props,i=t.disabled,n=void 0!==i&&i,s=t.min,r=void 0===s?0:s,o=t.max,a=void 0===o?100:o,l=t.step;this.MDComponent&&(r>this.MDComponent.max?(this.MDComponent.max=a,this.MDComponent.min=r):(this.MDComponent.min=r,this.MDComponent.max=a),e&&(this.MDComponent.value=e),this.MDComponent.disabled=n,l&&(this.MDComponent.step=l))}},{key:"onChange",value:function(e){this.props.onChange&&this.props.onChange(e)}},{key:"onInput",value:function(e){this.props.onInput&&this.props.onInput(e)}},{key:"materialDom",value:function(e){var t=e.tabindex,i=void 0===t?0:t,n=f(e,["tabindex"]);return this.setValue(e),(0,p.h)("div",Object.assign({tabIndex:i,role:"slider","aria-label":"Select Value",ref:this.setControlRef},n),(0,p.h)("div",{class:"mdc-slider__track-container"},(0,p.h)("div",{class:"mdc-slider__track"})),(0,p.h)("div",{class:"mdc-slider__thumb-container"},n.discrete&&(0,p.h)("div",{class:"mdc-slider__pin"},(0,p.h)("span",{class:"mdc-slider__pin-value-marker"})),(0,p.h)("svg",{class:"mdc-slider__thumb",width:"21",height:"21"},(0,p.h)("circle",{cx:"10.5",cy:"10.5",r:"7.875"})),(0,p.h)("div",{class:"mdc-slider__focus-ring"})))}}]),t}(m.default);g([u.bind],v.prototype,"onChange",null),g([u.bind],v.prototype,"onInput",null);var y=v;t.ZP=y},26605:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>V,h:()=>a,createElement:()=>a,cloneElement:()=>d,createRef:()=>U,Component:()=>B,render:()=>F,rerender:()=>g,options:()=>s});var n=function(){},s={},r=[],o=[];function a(e,t){var i,a,l,c,h=o;for(c=arguments.length;c-- >2;)r.push(arguments[c]);for(t&&null!=t.children&&(r.length||r.push(t.children),delete t.children);r.length;)if((a=r.pop())&&void 0!==a.pop)for(c=a.length;c--;)r.push(a[c]);else"boolean"==typeof a&&(a=null),(l="function"!=typeof e)&&(null==a?a="":"number"==typeof a?a=String(a):"string"!=typeof a&&(l=!1)),l&&i?h[h.length-1]+=a:h===o?h=[a]:h.push(a),i=l;var d=new n;return d.nodeName=e,d.children=h,d.attributes=null==t?void 0:t,d.key=null==t?void 0:t.key,void 0!==s.vnode&&s.vnode(d),d}function l(e,t){for(var i in t)e[i]=t[i];return e}function c(e,t){e&&("function"==typeof e?e(t):e.current=t)}var h="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function d(e,t){return a(e.nodeName,l(l({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}var u=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,p=[];function m(e){!e._dirty&&(e._dirty=!0)&&1==p.push(e)&&(s.debounceRendering||h)(g)}function g(){for(var e;e=p.pop();)e._dirty&&N(e)}function f(e,t,i){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&v(e,t.nodeName):i||e._componentConstructor===t.nodeName}function v(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function y(e){var t=l({},e.attributes);t.children=e.children;var i=e.nodeName.defaultProps;if(void 0!==i)for(var n in i)void 0===t[n]&&(t[n]=i[n]);return t}function b(e){var t=e.parentNode;t&&t.removeChild(e)}function S(e,t,i,n,s){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)c(i,null),c(n,e);else if("class"!==t||s)if("style"===t){if(n&&"string"!=typeof n&&"string"!=typeof i||(e.style.cssText=n||""),n&&"object"==typeof n){if("string"!=typeof i)for(var r in i)r in n||(e.style[r]="");for(var r in n)e.style[r]="number"==typeof n[r]&&!1===u.test(r)?n[r]+"px":n[r]}}else if("dangerouslySetInnerHTML"===t)n&&(e.innerHTML=n.__html||"");else if("o"==t[0]&&"n"==t[1]){var o=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),n?i||e.addEventListener(t,E,o):e.removeEventListener(t,E,o),(e._listeners||(e._listeners={}))[t]=n}else if("list"!==t&&"type"!==t&&!s&&t in e){try{e[t]=null==n?"":n}catch(e){}null!=n&&!1!==n||"spellcheck"==t||e.removeAttribute(t)}else{var a=s&&t!==(t=t.replace(/^xlink:?/,""));null==n||!1===n?a?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof n&&(a?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),n):e.setAttribute(t,n))}else e.className=n||""}function E(e){return this._listeners[e.type](s.event&&s.event(e)||e)}var w=[],T=0,_=!1,M=!1;function x(){for(var e;e=w.shift();)s.afterMount&&s.afterMount(e),e.componentDidMount&&e.componentDidMount()}function A(e,t,i,n,s,r){T++||(_=null!=s&&void 0!==s.ownerSVGElement,M=null!=e&&!("__preactattr_"in e));var o=O(e,t,i,n,r);return s&&o.parentNode!==s&&s.appendChild(o),--T||(M=!1,r||x()),o}function O(e,t,i,n,s){var r=e,o=_;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||s)?e.nodeValue!=t&&(e.nodeValue=t):(r=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(r,e),P(e,!0))),r.__preactattr_=!0,r;var a,l,c=t.nodeName;if("function"==typeof c)return function(e,t,i,n){var s=e&&e._component,r=s,o=e,a=s&&e._componentConstructor===t.nodeName,l=a,c=y(t);for(;s&&!l&&(s=s._parentComponent);)l=s.constructor===t.nodeName;s&&l&&(!n||s._component)?(R(s,c,3,i,n),e=s.base):(r&&!a&&(k(r),e=o=null),s=I(t.nodeName,c,i),e&&!s.nextBase&&(s.nextBase=e,o=null),R(s,c,1,i,n),e=s.base,o&&e!==o&&(o._component=null,P(o,!1)));return e}(e,t,i,n);if(_="svg"===c||"foreignObject"!==c&&_,c=String(c),(!e||!v(e,c))&&(a=c,(l=_?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a)).normalizedNodeName=a,r=l,e)){for(;e.firstChild;)r.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(r,e),P(e,!0)}var h=r.firstChild,d=r.__preactattr_,u=t.children;if(null==d){d=r.__preactattr_={};for(var p=r.attributes,m=p.length;m--;)d[p[m].name]=p[m].value}return!M&&u&&1===u.length&&"string"==typeof u[0]&&null!=h&&void 0!==h.splitText&&null==h.nextSibling?h.nodeValue!=u[0]&&(h.nodeValue=u[0]):(u&&u.length||null!=h)&&function(e,t,i,n,s){var r,o,a,l,c,h=e.childNodes,d=[],u={},p=0,m=0,g=h.length,v=0,y=t?t.length:0;if(0!==g)for(var S=0;S<g;S++){var E=h[S],w=E.__preactattr_;null!=(T=y&&w?E._component?E._component.__key:w.key:null)?(p++,u[T]=E):(w||(void 0!==E.splitText?!s||E.nodeValue.trim():s))&&(d[v++]=E)}if(0!==y)for(S=0;S<y;S++){var T;if(c=null,null!=(T=(l=t[S]).key))p&&void 0!==u[T]&&(c=u[T],u[T]=void 0,p--);else if(m<v)for(r=m;r<v;r++)if(void 0!==d[r]&&f(o=d[r],l,s)){c=o,d[r]=void 0,r===v-1&&v--,r===m&&m++;break}c=O(c,l,i,n),a=h[S],c&&c!==e&&c!==a&&(null==a?e.appendChild(c):c===a.nextSibling?b(a):e.insertBefore(c,a))}if(p)for(var S in u)void 0!==u[S]&&P(u[S],!1);for(;m<=v;)void 0!==(c=d[v--])&&P(c,!1)}(r,u,i,n,M||null!=d.dangerouslySetInnerHTML),function(e,t,i){var n;for(n in i)t&&null!=t[n]||null==i[n]||S(e,n,i[n],i[n]=void 0,_);for(n in t)"children"===n||"innerHTML"===n||n in i&&t[n]===("value"===n||"checked"===n?e[n]:i[n])||S(e,n,i[n],i[n]=t[n],_)}(r,t.attributes,d),_=o,r}function P(e,t){var i=e._component;i?k(i):(null!=e.__preactattr_&&c(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||b(e),D(e))}function D(e){for(e=e.lastChild;e;){var t=e.previousSibling;P(e,!0),e=t}}var C=[];function I(e,t,i){var n,s=C.length;for(e.prototype&&e.prototype.render?(n=new e(t,i),B.call(n,t,i)):((n=new B(t,i)).constructor=e,n.render=L);s--;)if(C[s].constructor===e)return n.nextBase=C[s].nextBase,C.splice(s,1),n;return n}function L(e,t,i){return this.constructor(e,i)}function R(e,t,i,n,r){e._disable||(e._disable=!0,e.__ref=t.ref,e.__key=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||r?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,n)),n&&n!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=n),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,0!==i&&(1!==i&&!1===s.syncComponentUpdates&&e.base?m(e):N(e,1,r)),c(e.__ref,e))}function N(e,t,i,n){if(!e._disable){var r,o,a,c=e.props,h=e.state,d=e.context,u=e.prevProps||c,p=e.prevState||h,m=e.prevContext||d,g=e.base,f=e.nextBase,v=g||f,b=e._component,S=!1,E=m;if(e.constructor.getDerivedStateFromProps&&(h=l(l({},h),e.constructor.getDerivedStateFromProps(c,h)),e.state=h),g&&(e.props=u,e.state=p,e.context=m,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(c,h,d)?S=!0:e.componentWillUpdate&&e.componentWillUpdate(c,h,d),e.props=c,e.state=h,e.context=d),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!S){r=e.render(c,h,d),e.getChildContext&&(d=l(l({},d),e.getChildContext())),g&&e.getSnapshotBeforeUpdate&&(E=e.getSnapshotBeforeUpdate(u,p));var _,M,O=r&&r.nodeName;if("function"==typeof O){var D=y(r);(o=b)&&o.constructor===O&&D.key==o.__key?R(o,D,1,d,!1):(_=o,e._component=o=I(O,D,d),o.nextBase=o.nextBase||f,o._parentComponent=e,R(o,D,0,d,!1),N(o,1,i,!0)),M=o.base}else a=v,(_=b)&&(a=e._component=null),(v||1===t)&&(a&&(a._component=null),M=A(a,r,d,i||!g,v&&v.parentNode,!0));if(v&&M!==v&&o!==b){var C=v.parentNode;C&&M!==C&&(C.replaceChild(M,v),_||(v._component=null,P(v,!1)))}if(_&&k(_),e.base=M,M&&!n){for(var L=e,B=e;B=B._parentComponent;)(L=B).base=M;M._component=L,M._componentConstructor=L.constructor}}for(!g||i?w.push(e):S||(e.componentDidUpdate&&e.componentDidUpdate(u,p,E),s.afterUpdate&&s.afterUpdate(e));e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);T||n||x()}}function k(e){s.beforeUnmount&&s.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var i=e._component;i?k(i):t&&(null!=t.__preactattr_&&c(t.__preactattr_.ref,null),e.nextBase=t,b(t),C.push(e),D(t)),c(e.__ref,null)}function B(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{},this._renderCallbacks=[]}function F(e,t,i){return A(i,e,{},!1,t,!1)}function U(){return{}}l(B.prototype,{setState:function(e,t){this.prevState||(this.prevState=this.state),this.state=l(l({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this._renderCallbacks.push(t),m(this)},forceUpdate:function(e){e&&this._renderCallbacks.push(e),N(this,2)},render:function(){}});const V={h:a,createElement:a,cloneElement:d,createRef:U,Component:B,render:F,rerender:g,options:s}},77824:(e,t,i)=>{var n=i(2823),s=i(34515),r=i(48738),o=[0,2,3],a=[2,1,3];e.exports=function(e,t){e&&(s(e)||r(e))||(t=e||{},e=null);for(var i="string"==typeof(t="number"==typeof t?{count:t}:t||{}).type?t.type:"uint16",l="number"==typeof t.count?t.count:1,c=t.start||0,h=!1!==t.clockwise?o:a,d=h[0],u=h[1],p=h[2],m=6*l,g=e||new(n(i))(m),f=0,v=0;f<m;f+=6,v+=4){var y=f+c;g[y+0]=v+0,g[y+1]=v+1,g[y+2]=v+2,g[y+3]=v+d,g[y+4]=v+u,g[y+5]=v+p}return g}},62587:e=>{"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,i,n,s){i=i||"&",n=n||"=";var r={};if("string"!=typeof e||0===e.length)return r;var o=/\+/g;e=e.split(i);var a=1e3;s&&"number"==typeof s.maxKeys&&(a=s.maxKeys);var l=e.length;a>0&&l>a&&(l=a);for(var c=0;c<l;++c){var h,d,u,p,m=e[c].replace(o,"%20"),g=m.indexOf(n);g>=0?(h=m.substr(0,g),d=m.substr(g+1)):(h=m,d=""),u=decodeURIComponent(h),p=decodeURIComponent(d),t(r,u)?Array.isArray(r[u])?r[u].push(p):r[u]=[r[u],p]:r[u]=p}return r}},12361:e=>{"use strict";var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,i,n,s){return i=i||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(s){var r=encodeURIComponent(t(s))+n;return Array.isArray(e[s])?e[s].map((function(e){return r+encodeURIComponent(t(e))})).join(i):r+encodeURIComponent(t(e[s]))})).join(i):s?encodeURIComponent(t(s))+n+encodeURIComponent(t(e)):""}},17673:(e,t,i)=>{"use strict";t.decode=t.parse=i(62587),t.encode=t.stringify=i(12361)},82582:function(e){e.exports=function(){"use strict";function e(e,n,s,r,o){!function e(i,n,s,r,o){for(;r>s;){if(r-s>600){var a=r-s+1,l=n-s+1,c=Math.log(a),h=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*h*(a-h)/a)*(l-a/2<0?-1:1);e(i,n,Math.max(s,Math.floor(n-l*h/a+d)),Math.min(r,Math.floor(n+(a-l)*h/a+d)),o)}var u=i[n],p=s,m=r;for(t(i,s,n),o(i[r],u)>0&&t(i,s,r);p<m;){for(t(i,p,m),p++,m--;o(i[p],u)<0;)p++;for(;o(i[m],u)>0;)m--}0===o(i[s],u)?t(i,s,m):t(i,++m,r),m<=n&&(s=m+1),n<=m&&(r=m-1)}}(e,n,s||0,r||e.length-1,o||i)}function t(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function i(e,t){return e<t?-1:e>t?1:0}var n=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(e,t,i){if(!i)return t.indexOf(e);for(var n=0;n<t.length;n++)if(i(e,t[n]))return n;return-1}function r(e,t){o(e,0,e.children.length,t,e)}function o(e,t,i,n,s){s||(s=m(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var r=t;r<i;r++){var o=e.children[r];a(s,e.leaf?n(o):o)}return s}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function u(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function m(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,i,n,s,r){for(var o=[i,n];o.length;)if(!((n=o.pop())-(i=o.pop())<=s)){var a=i+Math.ceil((n-i)/s/2)*s;e(t,a,i,n,r),o.push(i,a,a,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(e){var t=this.data,i=[];if(!p(e,t))return i;for(var n=this.toBBox,s=[];t;){for(var r=0;r<t.children.length;r++){var o=t.children[r],a=t.leaf?n(o):o;p(e,a)&&(t.leaf?i.push(o):u(e,a)?this._all(o,i):s.push(o))}t=s.pop()}return i},n.prototype.collides=function(e){var t=this.data;if(!p(e,t))return!1;for(var i=[];t;){for(var n=0;n<t.children.length;n++){var s=t.children[n],r=t.leaf?this.toBBox(s):s;if(p(e,r)){if(t.leaf||u(e,r))return!0;i.push(s)}}t=i.pop()}return!1},n.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},n.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},n.prototype.clear=function(){return this.data=m([]),this},n.prototype.remove=function(e,t){if(!e)return this;for(var i,n,r,o=this.data,a=this.toBBox(e),l=[],c=[];o||l.length;){if(o||(o=l.pop(),n=l[l.length-1],i=c.pop(),r=!0),o.leaf){var h=s(e,o.children,t);if(-1!==h)return o.children.splice(h,1),l.push(o),this._condense(l),this}r||o.leaf||!u(o,a)?n?(i++,o=n.children[i],r=!1):o=null:(l.push(o),c.push(i),i=0,n=o,o=o.children[0])}return this},n.prototype.toBBox=function(e){return e},n.prototype.compareMinX=function(e,t){return e.minX-t.minX},n.prototype.compareMinY=function(e,t){return e.minY-t.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(e){return this.data=e,this},n.prototype._all=function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},n.prototype._build=function(e,t,i,n){var s,o=i-t+1,a=this._maxEntries;if(o<=a)return r(s=m(e.slice(t,i+1)),this.toBBox),s;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),(s=m([])).leaf=!1,s.height=n;var l=Math.ceil(o/a),c=l*Math.ceil(Math.sqrt(a));g(e,t,i,c,this.compareMinX);for(var h=t;h<=i;h+=c){var d=Math.min(h+c-1,i);g(e,h,d,l,this.compareMinY);for(var u=h;u<=d;u+=l){var p=Math.min(u+l-1,d);s.children.push(this._build(e,u,p,n-1))}}return r(s,this.toBBox),s},n.prototype._chooseSubtree=function(e,t,i,n){for(;n.push(t),!t.leaf&&n.length-1!==i;){for(var s=1/0,r=1/0,o=void 0,a=0;a<t.children.length;a++){var l=t.children[a],c=h(l),d=(u=e,p=l,(Math.max(p.maxX,u.maxX)-Math.min(p.minX,u.minX))*(Math.max(p.maxY,u.maxY)-Math.min(p.minY,u.minY))-c);d<r?(r=d,s=c<s?c:s,o=l):d===r&&c<s&&(s=c,o=l)}t=o||t.children[0]}var u,p;return t},n.prototype._insert=function(e,t,i){var n=i?e:this.toBBox(e),s=[],r=this._chooseSubtree(n,this.data,t,s);for(r.children.push(e),a(r,n);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(n,s,t)},n.prototype._split=function(e,t){var i=e[t],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);var o=this._chooseSplitIndex(i,s,n),a=m(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,r(i,this.toBBox),r(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)},n.prototype._splitRoot=function(e,t){this.data=m([e,t]),this.data.height=e.height+1,this.data.leaf=!1,r(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(e,t,i){for(var n,s,r,a,l,c,d,u=1/0,p=1/0,m=t;m<=i-t;m++){var g=o(e,0,m,this.toBBox),f=o(e,m,i,this.toBBox),v=(s=g,r=f,a=void 0,l=void 0,c=void 0,d=void 0,a=Math.max(s.minX,r.minX),l=Math.max(s.minY,r.minY),c=Math.min(s.maxX,r.maxX),d=Math.min(s.maxY,r.maxY),Math.max(0,c-a)*Math.max(0,d-l)),y=h(g)+h(f);v<u?(u=v,n=m,p=y<p?y:p):v===u&&y<p&&(p=y,n=m)}return n||i-t},n.prototype._chooseSplitAxis=function(e,t,i){var n=e.leaf?this.compareMinX:l,s=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,s)&&e.children.sort(n)},n.prototype._allDistMargin=function(e,t,i,n){e.children.sort(n);for(var s=this.toBBox,r=o(e,0,t,s),l=o(e,i-t,i,s),c=d(r)+d(l),h=t;h<i-t;h++){var u=e.children[h];a(r,e.leaf?s(u):u),c+=d(r)}for(var p=i-t-1;p>=t;p--){var m=e.children[p];a(l,e.leaf?s(m):m),c+=d(l)}return c},n.prototype._adjustParentBBoxes=function(e,t,i){for(var n=i;n>=0;n--)a(t[n],e)},n.prototype._condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e[t].children.length?t>0?(i=e[t-1].children).splice(i.indexOf(e[t]),1):this.clear():r(e[t],this.toBBox)},n}()},28883:function(e,t){"use strict";var i,n,s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.Request=t.RequestQueue=t.RequestStatus=t.RequestPriority=void 0,function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.HIGHEST=3]="HIGHEST"}(i=t.RequestPriority||(t.RequestPriority={})),function(e){e[e.PENDING=0]="PENDING",e[e.SENDING=1]="SENDING",e[e.FAILED=2]="FAILED",e[e.DONE=3]="DONE"}(n=t.RequestStatus||(t.RequestStatus={}));var r=function(){function e(e){var t=void 0===e?{}:e,i=t.retries,n=void 0===i?0:i,s=t.concurrency,r=void 0===s?6:s;this.totalBytesDownloaded=0,this.queue=[],this.retries=n,this.concurrency=r}return e.prototype.get=function(e,t){return this.request("GET",e,t)},e.prototype.head=function(e,t){return this.request("HEAD",e,t)},e.prototype.options=function(e,t){return this.request("OPTIONS",e,t)},e.prototype.post=function(e,t){return this.request("POST",e,t)},e.prototype.put=function(e,t){return this.request("PUT",e,t)},e.prototype.patch=function(e,t){return this.request("PATCH",e,t)},e.prototype.delete=function(e,t){return this.request("DELETE",e,t)},e.prototype.request=function(e,t,i){var n=new o(e,t,i);return this.enqueue(n),n.promise},e.prototype.update=function(){for(var e;e=this.getNextPendingRequest();)this.sendRequest(e);for(;e=this.getNextOverflowingGet();)e.abort(),e.status=n.PENDING;this.updateTimeout=null},e.prototype.enqueue=function(e){var t=this,i=0;for(i=0;i<this.queue.length;i++){if(this.queue[i].priority<e.priority)break}this.queue.splice(i,0,e),this.updateTimeout||(this.updateTimeout=window.setTimeout((function(){t.update()}),1))},e.prototype.dequeue=function(e){var t=this.queue.indexOf(e);if(-1===t)throw new Error("Can't dequeue request not in queue");this.queue.splice(t,1),this.update()},e.prototype.getNextPendingRequest=function(){for(var e=0;e<this.queue.length&&e<this.concurrency;e++){var t=this.queue[e];if(t.status===n.PENDING)return t}return null},e.prototype.getNextOverflowingGet=function(){for(var e=this.concurrency;e<this.queue.length;e++){var t=this.queue[e];if(t.status===n.SENDING&&t.priority!==i.HIGHEST&&"GET"===t.method)return t}return null},e.prototype.shouldRetryStatusCode=function(t){return!e.doNotRetryStatusCodes[t]},e.prototype.sendRequest=function(e){var t=this;e.status=n.SENDING,e.send().then((function(i){e.status=n.DONE,t.dequeue(e),e.contentLength&&e.contentLength>0&&(t.totalBytesDownloaded+=Number(e.contentLength)),e.onDone(i)})).catch((function(i){var s=null!==e.maxRetries?e.maxRetries:t.retries,r=e.sendAttempts<s;if("object"==typeof i){var o=i.status_code||0;r=r&&t.shouldRetryStatusCode(o)}r?(e.status=n.PENDING,t.update(),console.warn("Retried "+e.url),console.warn(i)):(e.status=n.FAILED,t.dequeue(e),console.warn("Failed "+e.url),e.onFail(i))}))},e.doNotRetryStatusCodes={400:!0,401:!0,403:!0,404:!0,405:!0,406:!0,410:!0,411:!0,414:!0,415:!0,421:!0,431:!0,451:!0},e}();t.RequestQueue=r;var o=function(){function e(e,t,s){var r=this;void 0===s&&(s={}),this.sendAttempts=0,this.status=n.PENDING,this.contentLength=0,this.url=t,this.method=e,this.auth=s.auth||null,this.withCredentials=s.withCredentials||!1,this.priority=s.priority||i.MEDIUM,this.responseType=s.responseType||null,this.body=s.body||null,this.headers=s.headers||{},this.maxRetries=s.maxRetries||null,this.onProgress=s.onProgress,this.promise=new Promise((function(e,t){r.onDone=e,r.onFail=t}))}return e.prototype.send=function(){var e=this,t=this.xhr=function(e,t,i){var n;if("undefined"!=typeof XMLHttpRequest)(n=new XMLHttpRequest).withCredentials=i;else{if("undefined"==typeof XDomainRequest)throw new Error("No XMLHTTPRequest or XDomainRequest... are you trying to run me in node? :(");n=new XDomainRequest}return n.open(e,t,!0),n}(this.method,this.url,this.withCredentials);if(this.responseType)if("arraybuffer"===this.responseType||"text"===this.responseType||"json"===this.responseType||"blob"===this.responseType)t.responseType=this.responseType;else{if("image"!==this.responseType)throw new Error('reponseType can only be one of "arraybuffer", "text", "json", "blob", "image"');t.responseType="blob"}for(var i in"json"===this.responseType&&t.setRequestHeader("Accept","application/json"),this.auth&&"string"==typeof this.auth&&t.setRequestHeader("Authorization",this.auth),this.headers)t.setRequestHeader(i,this.headers[i]);return this.body&&"object"==typeof this.body&&(this.body instanceof FormData||(this.body=JSON.stringify(this.body),t.setRequestHeader("Content-Type","application/json"))),this.onProgress&&(t.onprogress=this.onProgress),new Promise((function(i,n){t.onreadystatechange=function(r){if(4===t.readyState){if(200===t.status||201===t.status||204===t.status)return e.parseResponse(e.xhr).then((function(e){i(e)}));if(0!==t.status)return e.parseResponse(e.xhr).then((function(e){n(s({status_code:t.status},e))})).catch((function(){n({status_code:t.status})}))}},t.onerror=function(e){n(e)},t.send(e.body),e.sendAttempts++}))},e.prototype.parseResponse=function(e){var t=this;return new Promise((function(i,n){try{var s=e.response;if(t.contentLength=e.getResponseHeader("Content-Length"),"json"===t.responseType&&"object"!=typeof s)i(JSON.parse(e.responseText));else if(200!==e.status&&201!==e.status&&204!==e.status||"image"!==t.responseType)i(s);else{var r=URL.createObjectURL(s);(s=new Image).src=r,s.crossOrigin="Anonymous",s.onload=function(){URL.revokeObjectURL(r),i(s)}}}catch(e){n({error:"Payload was not valid JSON"})}}))},e.prototype.abort=function(){if(null===this.xhr)throw new Error("Cannot abort unsent Request");this.xhr.abort()},e}();t.Request=o},61040:(e,t,i)=>{"use strict";var n=i(13733),s=i(27308),r=i(21924)("String.prototype.replace"),o=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,a=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/;e.exports=function(){var e=s(n(this));return r(r(e,o,""),a,"")}},46057:(e,t,i)=>{"use strict";var n=i(55559),s=i(4289),r=i(61040),o=i(30254),a=i(60029),l=n(o());s(l,{getPolyfill:o,implementation:r,shim:a}),e.exports=l},30254:(e,t,i)=>{"use strict";var n=i(61040);e.exports=function(){return String.prototype.trim&&""==="".trim()?String.prototype.trim:n}},60029:(e,t,i)=>{"use strict";var n=i(4289),s=i(30254);e.exports=function(){var e=s();return n(String.prototype,{trim:e},{trim:function(){return String.prototype.trim!==e}}),e}},67121:(e,t,i)=>{"use strict";e=i.hmd(e);!function(e){var t,i=e.Symbol;if("function"==typeof i)if(i.observable)t=i.observable;else{t=i.for("https://github.com/benlesh/symbol-observable");try{i.observable=t}catch(e){}}else t="@@observable"}("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i.g?i.g:e)},11385:(e,t,i)=>{var n=i(73134),s=i(77824),r=i(82910),o=i(70162);e.exports=function(e){return new TextGeometry(e)};class TextGeometry extends THREE.BufferGeometry{constructor(e){super(),this.type="TextGeometry","string"==typeof e&&(e={text:e}),this._opt=Object.assign({},e),e&&this.update(e)}update(e){if("string"==typeof e&&(e={text:e}),!(e=Object.assign({},this._opt,e)).font)throw new TypeError("must specify a { font } in options");this.layout=n(e);var t=!1!==e.flipY,i=e.font,o=i.common.scaleW,a=i.common.scaleH,l=this.layout.glyphs.filter((function(e){var t=e.data;return t.width*t.height>0}));this.visibleGlyphs=l;var c=r.positions(l),h=r.uvs(l,o,a,t),d=s([],{clockwise:!0,type:"uint16",count:l.length});if(this.setIndex(d),this.setAttribute("position",new THREE.BufferAttribute(c,2)),this.setAttribute("uv",new THREE.BufferAttribute(h,2)),!e.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(e.multipage){var u=r.pages(l);this.setAttribute("page",new THREE.BufferAttribute(u,1))}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var e=this.attributes.position.array,t=this.attributes.position.itemSize;if(!e||!t||e.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);o.computeSphere(e,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere():\nComputed radius is NaN. The\n"position" attribute is likely to have NaN values.')}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.boundingBox,t=this.attributes.position.array,i=this.attributes.position.itemSize;!t||!i||t.length<2?e.makeEmpty():o.computeBox(t,e)}}},70162:e=>{var t={min:[0,0],max:[0,0]};function i(e){var i=e.length/2;t.min[0]=e[0],t.min[1]=e[1],t.max[0]=e[0],t.max[1]=e[1];for(var n=0;n<i;n++){var s=e[2*n+0],r=e[2*n+1];t.min[0]=Math.min(s,t.min[0]),t.min[1]=Math.min(r,t.min[1]),t.max[0]=Math.max(s,t.max[0]),t.max[1]=Math.max(r,t.max[1])}}e.exports.computeBox=function(e,n){i(e),n.min.set(t.min[0],t.min[1],0),n.max.set(t.max[0],t.max[1],0)},e.exports.computeSphere=function(e,n){i(e);var s=t.min[0],r=t.min[1],o=t.max[0]-s,a=t.max[1]-r,l=Math.sqrt(o*o+a*a);n.center.set(s+o/2,r+a/2,0),n.radius=l/2}},82910:e=>{e.exports.pages=function(e){var t=new Float32Array(4*e.length*1),i=0;return e.forEach((function(e){var n=e.data.page||0;t[i++]=n,t[i++]=n,t[i++]=n,t[i++]=n})),t},e.exports.uvs=function(e,t,i,n){var s=new Float32Array(4*e.length*2),r=0;return e.forEach((function(e){var o=e.data,a=o.x+o.width,l=o.y+o.height,c=o.x/t,h=o.y/i,d=a/t,u=l/i;n&&(h=(i-o.y)/i,u=(i-l)/i),s[r++]=c,s[r++]=h,s[r++]=c,s[r++]=u,s[r++]=d,s[r++]=u,s[r++]=d,s[r++]=h})),s},e.exports.positions=function(e){var t=new Float32Array(4*e.length*2),i=0;return e.forEach((function(e){var n=e.data,s=e.position[0]+n.xoffset,r=e.position[1]+n.yoffset,o=n.width,a=n.height;t[i++]=s,t[i++]=r,t[i++]=s,t[i++]=r+a,t[i++]=s+o,t[i++]=r+a,t[i++]=s+o,t[i++]=r})),t}},2212:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ACESFilmicToneMapping:()=>ie,AddEquation:()=>M,AddOperation:()=>Q,AdditiveAnimationBlendMode:()=>Kt,AdditiveBlending:()=>E,AlphaFormat:()=>ke,AlwaysDepth:()=>G,AlwaysStencilFunc:()=>Ti,AmbientLight:()=>AmbientLight,AmbientLightProbe:()=>AmbientLightProbe,AnimationClip:()=>AnimationClip,AnimationLoader:()=>AnimationLoader,AnimationMixer:()=>AnimationMixer,AnimationObjectGroup:()=>AnimationObjectGroup,AnimationUtils:()=>wl,ArcCurve:()=>ArcCurve,ArrayCamera:()=>ArrayCamera,ArrowHelper:()=>ArrowHelper,Audio:()=>Audio,AudioAnalyser:()=>AudioAnalyser,AudioContext:()=>ql,AudioListener:()=>AudioListener,AudioLoader:()=>AudioLoader,AxesHelper:()=>AxesHelper,AxisHelper:()=>Nh,BackSide:()=>g,BasicDepthPacking:()=>si,BasicShadowMap:()=>h,BinaryTextureLoader:()=>Vh,Bone:()=>Bone,BooleanKeyframeTrack:()=>BooleanKeyframeTrack,BoundingBoxHelper:()=>kh,Box2:()=>Box2,Box3:()=>Box3,Box3Helper:()=>Box3Helper,BoxBufferGeometry:()=>BoxGeometry,BoxGeometry:()=>BoxGeometry,BoxHelper:()=>BoxHelper,BufferAttribute:()=>BufferAttribute,BufferGeometry:()=>BufferGeometry,BufferGeometryLoader:()=>BufferGeometryLoader,ByteType:()=>Me,Cache:()=>_l,Camera:()=>Camera,CameraHelper:()=>CameraHelper,CanvasRenderer:()=>Gh,CanvasTexture:()=>CanvasTexture,CatmullRomCurve3:()=>CatmullRomCurve3,CineonToneMapping:()=>te,CircleBufferGeometry:()=>CircleGeometry,CircleGeometry:()=>CircleGeometry,ClampToEdgeWrapping:()=>ue,Clock:()=>Clock,Color:()=>Color,ColorKeyframeTrack:()=>ColorKeyframeTrack,CompressedTexture:()=>CompressedTexture,CompressedTextureLoader:()=>CompressedTextureLoader,ConeBufferGeometry:()=>ConeGeometry,ConeGeometry:()=>ConeGeometry,CubeCamera:()=>CubeCamera,CubeReflectionMapping:()=>re,CubeRefractionMapping:()=>oe,CubeTexture:()=>CubeTexture,CubeTextureLoader:()=>CubeTextureLoader,CubeUVReflectionMapping:()=>ce,CubeUVRefractionMapping:()=>he,CubicBezierCurve:()=>CubicBezierCurve,CubicBezierCurve3:()=>CubicBezierCurve3,CubicInterpolant:()=>CubicInterpolant,CullFaceBack:()=>a,CullFaceFront:()=>l,CullFaceFrontBack:()=>c,CullFaceNone:()=>o,Curve:()=>Curve,CurvePath:()=>CurvePath,CustomBlending:()=>_,CustomToneMapping:()=>ne,CylinderBufferGeometry:()=>CylinderGeometry,CylinderGeometry:()=>CylinderGeometry,Cylindrical:()=>Cylindrical,DataTexture:()=>DataTexture,DataTexture2DArray:()=>DataTexture2DArray,DataTexture3D:()=>DataTexture3D,DataTextureLoader:()=>DataTextureLoader,DataUtils:()=>DataUtils,DecrementStencilOp:()=>ui,DecrementWrapStencilOp:()=>mi,DefaultLoadingManager:()=>Ml,DepthFormat:()=>Ge,DepthStencilFormat:()=>ze,DepthTexture:()=>DepthTexture,DirectionalLight:()=>DirectionalLight,DirectionalLightHelper:()=>DirectionalLightHelper,DiscreteInterpolant:()=>DiscreteInterpolant,DodecahedronBufferGeometry:()=>DodecahedronGeometry,DodecahedronGeometry:()=>DodecahedronGeometry,DoubleSide:()=>f,DstAlphaFactor:()=>k,DstColorFactor:()=>F,DynamicBufferAttribute:()=>Mh,DynamicCopyUsage:()=>Ci,DynamicDrawUsage:()=>Mi,DynamicReadUsage:()=>Oi,EdgesGeometry:()=>EdgesGeometry,EdgesHelper:()=>Bh,EllipseCurve:()=>EllipseCurve,EqualDepth:()=>j,EqualStencilFunc:()=>yi,EquirectangularReflectionMapping:()=>ae,EquirectangularRefractionMapping:()=>le,Euler:()=>Euler,EventDispatcher:()=>EventDispatcher,ExtrudeBufferGeometry:()=>ExtrudeGeometry,ExtrudeGeometry:()=>ExtrudeGeometry,FaceColors:()=>mh,FileLoader:()=>FileLoader,FlatShading:()=>v,Float16BufferAttribute:()=>Float16BufferAttribute,Float32Attribute:()=>Lh,Float32BufferAttribute:()=>Float32BufferAttribute,Float64Attribute:()=>Rh,Float64BufferAttribute:()=>Float64BufferAttribute,FloatType:()=>De,Fog:()=>Fog,FogExp2:()=>FogExp2,Font:()=>Font,FontLoader:()=>FontLoader,FrontSide:()=>m,Frustum:()=>Frustum,GLBufferAttribute:()=>GLBufferAttribute,GLSL1:()=>Li,GLSL3:()=>Ri,GammaEncoding:()=>Xt,GreaterDepth:()=>q,GreaterEqualDepth:()=>K,GreaterEqualStencilFunc:()=>wi,GreaterStencilFunc:()=>Si,GridHelper:()=>GridHelper,Group:()=>Group,HalfFloatType:()=>Ce,HemisphereLight:()=>HemisphereLight,HemisphereLightHelper:()=>HemisphereLightHelper,HemisphereLightProbe:()=>HemisphereLightProbe,IcosahedronBufferGeometry:()=>IcosahedronGeometry,IcosahedronGeometry:()=>IcosahedronGeometry,ImageBitmapLoader:()=>ImageBitmapLoader,ImageLoader:()=>ImageLoader,ImageUtils:()=>ImageUtils,ImmediateRenderObject:()=>ImmediateRenderObject,IncrementStencilOp:()=>di,IncrementWrapStencilOp:()=>pi,InstancedBufferAttribute:()=>InstancedBufferAttribute,InstancedBufferGeometry:()=>InstancedBufferGeometry,InstancedInterleavedBuffer:()=>InstancedInterleavedBuffer,InstancedMesh:()=>InstancedMesh,Int16Attribute:()=>Ph,Int16BufferAttribute:()=>Int16BufferAttribute,Int32Attribute:()=>Ch,Int32BufferAttribute:()=>Int32BufferAttribute,Int8Attribute:()=>xh,Int8BufferAttribute:()=>Int8BufferAttribute,IntType:()=>Oe,InterleavedBuffer:()=>InterleavedBuffer,InterleavedBufferAttribute:()=>InterleavedBufferAttribute,Interpolant:()=>Interpolant,InterpolateDiscrete:()=>Ut,InterpolateLinear:()=>Vt,InterpolateSmooth:()=>Ht,InvertStencilOp:()=>gi,JSONLoader:()=>zh,KeepStencilOp:()=>ci,KeyframeTrack:()=>KeyframeTrack,LOD:()=>LOD,LatheBufferGeometry:()=>LatheGeometry,LatheGeometry:()=>LatheGeometry,Layers:()=>Layers,LensFlare:()=>jh,LessDepth:()=>z,LessEqualDepth:()=>W,LessEqualStencilFunc:()=>bi,LessStencilFunc:()=>vi,Light:()=>Light,LightProbe:()=>LightProbe,Line:()=>Line,Line3:()=>Line3,LineBasicMaterial:()=>LineBasicMaterial,LineCurve:()=>LineCurve,LineCurve3:()=>LineCurve3,LineDashedMaterial:()=>LineDashedMaterial,LineLoop:()=>LineLoop,LinePieces:()=>uh,LineSegments:()=>LineSegments,LineStrip:()=>dh,LinearEncoding:()=>$t,LinearFilter:()=>be,LinearInterpolant:()=>LinearInterpolant,LinearMipMapLinearFilter:()=>Te,LinearMipMapNearestFilter:()=>Ee,LinearMipmapLinearFilter:()=>we,LinearMipmapNearestFilter:()=>Se,LinearToneMapping:()=>J,Loader:()=>Loader,LoaderUtils:()=>LoaderUtils,LoadingManager:()=>LoadingManager,LogLuvEncoding:()=>ei,LoopOnce:()=>kt,LoopPingPong:()=>Ft,LoopRepeat:()=>Bt,LuminanceAlphaFormat:()=>Ve,LuminanceFormat:()=>Ue,MOUSE:()=>s,Material:()=>os,MaterialLoader:()=>MaterialLoader,Math:()=>Ki,MathUtils:()=>Ki,Matrix3:()=>Matrix3,Matrix4:()=>Matrix4,MaxEquation:()=>P,Mesh:()=>Mesh,MeshBasicMaterial:()=>MeshBasicMaterial,MeshDepthMaterial:()=>MeshDepthMaterial,MeshDistanceMaterial:()=>MeshDistanceMaterial,MeshFaceMaterial:()=>fh,MeshLambertMaterial:()=>MeshLambertMaterial,MeshMatcapMaterial:()=>MeshMatcapMaterial,MeshNormalMaterial:()=>MeshNormalMaterial,MeshPhongMaterial:()=>MeshPhongMaterial,MeshPhysicalMaterial:()=>MeshPhysicalMaterial,MeshStandardMaterial:()=>MeshStandardMaterial,MeshToonMaterial:()=>MeshToonMaterial,MinEquation:()=>O,MirroredRepeatWrapping:()=>pe,MixOperation:()=>$,MultiMaterial:()=>vh,MultiplyBlending:()=>T,MultiplyOperation:()=>Y,NearestFilter:()=>me,NearestMipMapLinearFilter:()=>ye,NearestMipMapNearestFilter:()=>fe,NearestMipmapLinearFilter:()=>ve,NearestMipmapNearestFilter:()=>ge,NeverDepth:()=>H,NeverStencilFunc:()=>fi,NoBlending:()=>b,NoColors:()=>ph,NoToneMapping:()=>X,NormalAnimationBlendMode:()=>jt,NormalBlending:()=>S,NotEqualDepth:()=>Z,NotEqualStencilFunc:()=>Ei,NumberKeyframeTrack:()=>NumberKeyframeTrack,Object3D:()=>Object3D,ObjectLoader:()=>ObjectLoader,ObjectSpaceNormalMap:()=>ai,OctahedronBufferGeometry:()=>OctahedronGeometry,OctahedronGeometry:()=>OctahedronGeometry,OneFactor:()=>C,OneMinusDstAlphaFactor:()=>B,OneMinusDstColorFactor:()=>U,OneMinusSrcAlphaFactor:()=>N,OneMinusSrcColorFactor:()=>L,OrthographicCamera:()=>OrthographicCamera,PCFShadowMap:()=>d,PCFSoftShadowMap:()=>u,PMREMGenerator:()=>PMREMGenerator,ParametricBufferGeometry:()=>ParametricGeometry,ParametricGeometry:()=>ParametricGeometry,Particle:()=>bh,ParticleBasicMaterial:()=>wh,ParticleSystem:()=>Sh,ParticleSystemMaterial:()=>Th,Path:()=>Path,PerspectiveCamera:()=>PerspectiveCamera,Plane:()=>Plane,PlaneBufferGeometry:()=>PlaneGeometry,PlaneGeometry:()=>PlaneGeometry,PlaneHelper:()=>PlaneHelper,PointCloud:()=>yh,PointCloudMaterial:()=>Eh,PointLight:()=>PointLight,PointLightHelper:()=>PointLightHelper,Points:()=>Points,PointsMaterial:()=>PointsMaterial,PolarGridHelper:()=>PolarGridHelper,PolyhedronBufferGeometry:()=>PolyhedronGeometry,PolyhedronGeometry:()=>PolyhedronGeometry,PositionalAudio:()=>PositionalAudio,PropertyBinding:()=>PropertyBinding,PropertyMixer:()=>PropertyMixer,QuadraticBezierCurve:()=>QuadraticBezierCurve,QuadraticBezierCurve3:()=>QuadraticBezierCurve3,Quaternion:()=>Quaternion,QuaternionKeyframeTrack:()=>QuaternionKeyframeTrack,QuaternionLinearInterpolant:()=>QuaternionLinearInterpolant,REVISION:()=>n,RGBADepthPacking:()=>ri,RGBAFormat:()=>Fe,RGBAIntegerFormat:()=>Ye,RGBA_ASTC_10x10_Format:()=>yt,RGBA_ASTC_10x5_Format:()=>gt,RGBA_ASTC_10x6_Format:()=>ft,RGBA_ASTC_10x8_Format:()=>vt,RGBA_ASTC_12x10_Format:()=>bt,RGBA_ASTC_12x12_Format:()=>St,RGBA_ASTC_4x4_Format:()=>at,RGBA_ASTC_5x4_Format:()=>lt,RGBA_ASTC_5x5_Format:()=>ct,RGBA_ASTC_6x5_Format:()=>ht,RGBA_ASTC_6x6_Format:()=>dt,RGBA_ASTC_8x5_Format:()=>ut,RGBA_ASTC_8x6_Format:()=>pt,RGBA_ASTC_8x8_Format:()=>mt,RGBA_BPTC_Format:()=>Et,RGBA_ETC2_EAC_Format:()=>ot,RGBA_PVRTC_2BPPV1_Format:()=>nt,RGBA_PVRTC_4BPPV1_Format:()=>it,RGBA_S3TC_DXT1_Format:()=>Qe,RGBA_S3TC_DXT3_Format:()=>Xe,RGBA_S3TC_DXT5_Format:()=>Je,RGBDEncoding:()=>ni,RGBEEncoding:()=>Jt,RGBEFormat:()=>He,RGBFormat:()=>Be,RGBIntegerFormat:()=>Ze,RGBM16Encoding:()=>ii,RGBM7Encoding:()=>ti,RGB_ETC1_Format:()=>st,RGB_ETC2_Format:()=>rt,RGB_PVRTC_2BPPV1_Format:()=>tt,RGB_PVRTC_4BPPV1_Format:()=>et,RGB_S3TC_DXT1_Format:()=>$e,RGFormat:()=>Ke,RGIntegerFormat:()=>qe,RawShaderMaterial:()=>RawShaderMaterial,Ray:()=>Ray,Raycaster:()=>Raycaster,RectAreaLight:()=>RectAreaLight,RedFormat:()=>We,RedIntegerFormat:()=>je,ReinhardToneMapping:()=>ee,RepeatWrapping:()=>de,ReplaceStencilOp:()=>hi,ReverseSubtractEquation:()=>A,RingBufferGeometry:()=>RingGeometry,RingGeometry:()=>RingGeometry,SRGB8_ALPHA8_ASTC_10x10_Format:()=>Lt,SRGB8_ALPHA8_ASTC_10x5_Format:()=>Dt,SRGB8_ALPHA8_ASTC_10x6_Format:()=>Ct,SRGB8_ALPHA8_ASTC_10x8_Format:()=>It,SRGB8_ALPHA8_ASTC_12x10_Format:()=>Rt,SRGB8_ALPHA8_ASTC_12x12_Format:()=>Nt,SRGB8_ALPHA8_ASTC_4x4_Format:()=>wt,SRGB8_ALPHA8_ASTC_5x4_Format:()=>Tt,SRGB8_ALPHA8_ASTC_5x5_Format:()=>_t,SRGB8_ALPHA8_ASTC_6x5_Format:()=>Mt,SRGB8_ALPHA8_ASTC_6x6_Format:()=>xt,SRGB8_ALPHA8_ASTC_8x5_Format:()=>At,SRGB8_ALPHA8_ASTC_8x6_Format:()=>Ot,SRGB8_ALPHA8_ASTC_8x8_Format:()=>Pt,Scene:()=>Scene,SceneUtils:()=>Wh,ShaderChunk:()=>Qs,ShaderLib:()=>Js,ShaderMaterial:()=>ShaderMaterial,ShadowMaterial:()=>ShadowMaterial,Shape:()=>Shape,ShapeBufferGeometry:()=>ShapeGeometry,ShapeGeometry:()=>ShapeGeometry,ShapePath:()=>ShapePath,ShapeUtils:()=>ShapeUtils,ShortType:()=>xe,Skeleton:()=>Skeleton,SkeletonHelper:()=>SkeletonHelper,SkinnedMesh:()=>SkinnedMesh,SmoothShading:()=>y,Sphere:()=>Sphere,SphereBufferGeometry:()=>SphereGeometry,SphereGeometry:()=>SphereGeometry,Spherical:()=>Spherical,SphericalHarmonics3:()=>SphericalHarmonics3,SplineCurve:()=>SplineCurve,SpotLight:()=>SpotLight,SpotLightHelper:()=>SpotLightHelper,Sprite:()=>Sprite,SpriteMaterial:()=>SpriteMaterial,SrcAlphaFactor:()=>R,SrcAlphaSaturateFactor:()=>V,SrcColorFactor:()=>I,StaticCopyUsage:()=>Di,StaticDrawUsage:()=>_i,StaticReadUsage:()=>Ai,StereoCamera:()=>StereoCamera,StreamCopyUsage:()=>Ii,StreamDrawUsage:()=>xi,StreamReadUsage:()=>Pi,StringKeyframeTrack:()=>StringKeyframeTrack,SubtractEquation:()=>x,SubtractiveBlending:()=>w,TOUCH:()=>r,TangentSpaceNormalMap:()=>oi,TetrahedronBufferGeometry:()=>TetrahedronGeometry,TetrahedronGeometry:()=>TetrahedronGeometry,TextBufferGeometry:()=>TextGeometry,TextGeometry:()=>TextGeometry,Texture:()=>Texture,TextureLoader:()=>TextureLoader,TorusBufferGeometry:()=>TorusGeometry,TorusGeometry:()=>TorusGeometry,TorusKnotBufferGeometry:()=>TorusKnotGeometry,TorusKnotGeometry:()=>TorusKnotGeometry,Triangle:()=>Triangle,TriangleFanDrawMode:()=>Yt,TriangleStripDrawMode:()=>Zt,TrianglesDrawMode:()=>qt,TubeBufferGeometry:()=>TubeGeometry,TubeGeometry:()=>TubeGeometry,UVMapping:()=>se,Uint16Attribute:()=>Dh,Uint16BufferAttribute:()=>Uint16BufferAttribute,Uint32Attribute:()=>Ih,Uint32BufferAttribute:()=>Uint32BufferAttribute,Uint8Attribute:()=>Ah,Uint8BufferAttribute:()=>Uint8BufferAttribute,Uint8ClampedAttribute:()=>Oh,Uint8ClampedBufferAttribute:()=>Uint8ClampedBufferAttribute,Uniform:()=>Uniform,UniformsLib:()=>Xs,UniformsUtils:()=>js,UnsignedByteType:()=>_e,UnsignedInt248Type:()=>Ne,UnsignedIntType:()=>Pe,UnsignedShort4444Type:()=>Ie,UnsignedShort5551Type:()=>Le,UnsignedShort565Type:()=>Re,UnsignedShortType:()=>Ae,VSMShadowMap:()=>p,Vector2:()=>Vector2,Vector3:()=>Vector3,Vector4:()=>Vector4,VectorKeyframeTrack:()=>VectorKeyframeTrack,Vertex:()=>_h,VertexColors:()=>gh,VideoTexture:()=>VideoTexture,WebGL1Renderer:()=>WebGL1Renderer,WebGLCubeRenderTarget:()=>WebGLCubeRenderTarget,WebGLMultisampleRenderTarget:()=>WebGLMultisampleRenderTarget,WebGLRenderTarget:()=>WebGLRenderTarget,WebGLRenderTargetCube:()=>Hh,WebGLRenderer:()=>ta,WebGLUtils:()=>Xo,WireframeGeometry:()=>WireframeGeometry,WireframeHelper:()=>Fh,WrapAroundEnding:()=>Wt,XHRLoader:()=>Uh,ZeroCurvatureEnding:()=>Gt,ZeroFactor:()=>D,ZeroSlopeEnding:()=>zt,ZeroStencilOp:()=>li,sRGBEncoding:()=>Qt});const n="128",s={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},r={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,a=1,l=2,c=3,h=0,d=1,u=2,p=3,m=0,g=1,f=2,v=1,y=2,b=0,S=1,E=2,w=3,T=4,_=5,M=100,x=101,A=102,O=103,P=104,D=200,C=201,I=202,L=203,R=204,N=205,k=206,B=207,F=208,U=209,V=210,H=0,G=1,z=2,W=3,j=4,K=5,q=6,Z=7,Y=0,$=1,Q=2,X=0,J=1,ee=2,te=3,ie=4,ne=5,se=300,re=301,oe=302,ae=303,le=304,ce=306,he=307,de=1e3,ue=1001,pe=1002,me=1003,ge=1004,fe=1004,ve=1005,ye=1005,be=1006,Se=1007,Ee=1007,we=1008,Te=1008,_e=1009,Me=1010,xe=1011,Ae=1012,Oe=1013,Pe=1014,De=1015,Ce=1016,Ie=1017,Le=1018,Re=1019,Ne=1020,ke=1021,Be=1022,Fe=1023,Ue=1024,Ve=1025,He=Fe,Ge=1026,ze=1027,We=1028,je=1029,Ke=1030,qe=1031,Ze=1032,Ye=1033,$e=33776,Qe=33777,Xe=33778,Je=33779,et=35840,tt=35841,it=35842,nt=35843,st=36196,rt=37492,ot=37496,at=37808,lt=37809,ct=37810,ht=37811,dt=37812,ut=37813,pt=37814,mt=37815,gt=37816,ft=37817,vt=37818,yt=37819,bt=37820,St=37821,Et=36492,wt=37840,Tt=37841,_t=37842,Mt=37843,xt=37844,At=37845,Ot=37846,Pt=37847,Dt=37848,Ct=37849,It=37850,Lt=37851,Rt=37852,Nt=37853,kt=2200,Bt=2201,Ft=2202,Ut=2300,Vt=2301,Ht=2302,Gt=2400,zt=2401,Wt=2402,jt=2500,Kt=2501,qt=0,Zt=1,Yt=2,$t=3e3,Qt=3001,Xt=3007,Jt=3002,ei=3003,ti=3004,ii=3005,ni=3006,si=3200,ri=3201,oi=0,ai=1,li=0,ci=7680,hi=7681,di=7682,ui=7683,pi=34055,mi=34056,gi=5386,fi=512,vi=513,yi=514,bi=515,Si=516,Ei=517,wi=518,Ti=519,_i=35044,Mi=35048,xi=35040,Ai=35045,Oi=35049,Pi=35041,Di=35046,Ci=35050,Ii=35042,Li="100",Ri="300 es";class EventDispatcher{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e);e.target=null}}}const Ni=[];for(let e=0;e<256;e++)Ni[e]=(e<16?"0":"")+e.toString(16);let ki=1234567;const Bi=Math.PI/180,Fi=180/Math.PI;function Ui(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Ni[255&e]+Ni[e>>8&255]+Ni[e>>16&255]+Ni[e>>24&255]+"-"+Ni[255&t]+Ni[t>>8&255]+"-"+Ni[t>>16&15|64]+Ni[t>>24&255]+"-"+Ni[63&i|128]+Ni[i>>8&255]+"-"+Ni[i>>16&255]+Ni[i>>24&255]+Ni[255&n]+Ni[n>>8&255]+Ni[n>>16&255]+Ni[n>>24&255]).toUpperCase()}function Vi(e,t,i){return Math.max(t,Math.min(i,e))}function Hi(e,t){return(e%t+t)%t}function Gi(e,t,i){return(1-i)*e+i*t}function zi(e){return 0==(e&e-1)&&0!==e}function Wi(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function ji(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Ki=Object.freeze({__proto__:null,DEG2RAD:Bi,RAD2DEG:Fi,generateUUID:Ui,clamp:Vi,euclideanModulo:Hi,mapLinear:function(e,t,i,n,s){return n+(e-t)*(s-n)/(i-t)},inverseLerp:function(e,t,i){return e!==t?(i-e)/(t-e):0},lerp:Gi,damp:function(e,t,i,n){return Gi(e,t,1-Math.exp(-i*n))},pingpong:function(e,t=1){return t-Math.abs(Hi(e,2*t)-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(ki=e%2147483647),ki=16807*ki%2147483647,(ki-1)/2147483646},degToRad:function(e){return e*Bi},radToDeg:function(e){return e*Fi},isPowerOfTwo:zi,ceilPowerOfTwo:Wi,floorPowerOfTwo:ji,setQuaternionFromProperEuler:function(e,t,i,n,s){const r=Math.cos,o=Math.sin,a=r(i/2),l=o(i/2),c=r((t+n)/2),h=o((t+n)/2),d=r((t-n)/2),u=o((t-n)/2),p=r((n-t)/2),m=o((n-t)/2);switch(s){case"XYX":e.set(a*h,l*d,l*u,a*c);break;case"YZY":e.set(l*u,a*h,l*d,a*c);break;case"ZXZ":e.set(l*d,l*u,a*h,a*c);break;case"XZX":e.set(a*h,l*m,l*p,a*c);break;case"YXY":e.set(l*p,a*h,l*m,a*c);break;case"ZYZ":e.set(l*m,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}});class Vector2{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),s=this.x-e.x,r=this.y-e.y;return this.x=s*i-r*n+e.x,this.y=s*n+r*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Vector2.prototype.isVector2=!0;class Matrix3{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,n,s,r,o,a,l){const c=this.elements;return c[0]=e,c[1]=n,c[2]=o,c[3]=t,c[4]=s,c[5]=a,c[6]=i,c[7]=r,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,s=this.elements,r=i[0],o=i[3],a=i[6],l=i[1],c=i[4],h=i[7],d=i[2],u=i[5],p=i[8],m=n[0],g=n[3],f=n[6],v=n[1],y=n[4],b=n[7],S=n[2],E=n[5],w=n[8];return s[0]=r*m+o*v+a*S,s[3]=r*g+o*y+a*E,s[6]=r*f+o*b+a*w,s[1]=l*m+c*v+h*S,s[4]=l*g+c*y+h*E,s[7]=l*f+c*b+h*w,s[2]=d*m+u*v+p*S,s[5]=d*g+u*y+p*E,s[8]=d*f+u*b+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],r=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*r*c-t*o*l-i*s*c+i*o*a+n*s*l-n*r*a}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],r=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=c*r-o*l,d=o*a-c*s,u=l*s-r*a,p=t*h+i*d+n*u;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(n*l-c*i)*m,e[2]=(o*i-n*r)*m,e[3]=d*m,e[4]=(c*t-n*a)*m,e[5]=(n*s-o*t)*m,e[6]=u*m,e[7]=(i*a-l*t)*m,e[8]=(r*t-i*s)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,s,r,o){const a=Math.cos(s),l=Math.sin(s);return this.set(i*a,i*l,-i*(a*r+l*o)+r+e,-n*l,n*a,-n*(-l*r+a*o)+o+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),n=this.elements,s=n[0],r=n[3],o=n[6],a=n[1],l=n[4],c=n[7];return n[0]=t*s+i*a,n[3]=t*r+i*l,n[6]=t*o+i*c,n[1]=-i*s+t*a,n[4]=-i*r+t*l,n[7]=-i*o+t*c,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}let qi;Matrix3.prototype.isMatrix3=!0;class ImageUtils{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===qi&&(qi=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),qi.width=e.width,qi.height=e.height;const i=qi.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=qi}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let Zi=0;class Texture extends EventDispatcher{constructor(e=Texture.DEFAULT_IMAGE,t=Texture.DEFAULT_MAPPING,i=ue,n=ue,s=be,r=we,o=Fe,a=_e,l=1,c=$t){super(),Object.defineProperty(this,"id",{value:Zi++}),this.uuid=Ui(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=n,this.magFilter=s,this.minFilter=r,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=Ui()),!t&&void 0===e.images[n.uuid]){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(Yi(n[e].image)):t.push(Yi(n[e]))}else t=Yi(n);e.images[n.uuid]={uuid:n.uuid,url:t}}i.image=n.uuid}return t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==se)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case de:e.x=e.x-Math.floor(e.x);break;case ue:e.x=e.x<0?0:1;break;case pe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case de:e.y=e.y-Math.floor(e.y);break;case ue:e.y=e.y<0?0:1;break;case pe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function Yi(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?ImageUtils.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=se,Texture.prototype.isTexture=!0;class Vector4{constructor(e=0,t=0,i=0,n=1){this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,s=this.w,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n+r[12]*s,this.y=r[1]*t+r[5]*i+r[9]*n+r[13]*s,this.z=r[2]*t+r[6]*i+r[10]*n+r[14]*s,this.w=r[3]*t+r[7]*i+r[11]*n+r[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,s;const r=.01,o=.1,a=e.elements,l=a[0],c=a[4],h=a[8],d=a[1],u=a[5],p=a[9],m=a[2],g=a[6],f=a[10];if(Math.abs(c-d)<r&&Math.abs(h-m)<r&&Math.abs(p-g)<r){if(Math.abs(c+d)<o&&Math.abs(h+m)<o&&Math.abs(p+g)<o&&Math.abs(l+u+f-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(u+1)/2,v=(f+1)/2,y=(c+d)/4,b=(h+m)/4,S=(p+g)/4;return e>a&&e>v?e<r?(i=0,n=.707106781,s=.707106781):(i=Math.sqrt(e),n=y/i,s=b/i):a>v?a<r?(i=.707106781,n=0,s=.707106781):(n=Math.sqrt(a),i=y/n,s=S/n):v<r?(i=.707106781,n=.707106781,s=0):(s=Math.sqrt(v),i=b/s,n=S/s),this.set(i,n,s,t),this}let v=Math.sqrt((g-p)*(g-p)+(h-m)*(h-m)+(d-c)*(d-c));return Math.abs(v)<.001&&(v=1),this.x=(g-p)/v,this.y=(h-m)/v,this.z=(d-c)/v,this.w=Math.acos((l+u+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}Vector4.prototype.isVector4=!0;class WebGLRenderTarget extends EventDispatcher{constructor(e,t,i){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),i=i||{},this.texture=new Texture(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:be,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,i=1){this.width===e&&this.height===t&&this.depth===i||(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}WebGLRenderTarget.prototype.isWebGLRenderTarget=!0;class WebGLMultisampleRenderTarget extends WebGLRenderTarget{constructor(e,t,i){super(e,t,i),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}WebGLMultisampleRenderTarget.prototype.isWebGLMultisampleRenderTarget=!0;class Quaternion{constructor(e=0,t=0,i=0,n=1){this._x=e,this._y=t,this._z=i,this._w=n}static slerp(e,t,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,n)}static slerpFlat(e,t,i,n,s,r,o){let a=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3];const d=s[r+0],u=s[r+1],p=s[r+2],m=s[r+3];if(0===o)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===o)return e[t+0]=d,e[t+1]=u,e[t+2]=p,void(e[t+3]=m);if(h!==m||a!==d||l!==u||c!==p){let e=1-o;const t=a*d+l*u+c*p+h*m,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const s=Math.sqrt(n),r=Math.atan2(s,t*i);e=Math.sin(e*r)/s,o=Math.sin(o*r)/s}const s=o*i;if(a=a*e+d*s,l=l*e+u*s,c=c*e+p*s,h=h*e+m*s,e===1-o){const e=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=e,l*=e,c*=e,h*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,n,s,r){const o=i[n],a=i[n+1],l=i[n+2],c=i[n+3],h=s[r],d=s[r+1],u=s[r+2],p=s[r+3];return e[t]=o*p+c*h+a*u-l*d,e[t+1]=a*p+c*d+l*h-o*u,e[t+2]=l*p+c*u+o*d-a*h,e[t+3]=c*p-o*h-a*d-l*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,n=e._y,s=e._z,r=e._order,o=Math.cos,a=Math.sin,l=o(i/2),c=o(n/2),h=o(s/2),d=a(i/2),u=a(n/2),p=a(s/2);switch(r){case"XYZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"YXZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"ZXY":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"ZYX":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"YZX":this._x=d*c*h+l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h-d*u*p;break;case"XZY":this._x=d*c*h-l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h+d*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],s=t[8],r=t[1],o=t[5],a=t[9],l=t[2],c=t[6],h=t[10],d=i+o+h;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-a)*e,this._y=(s-l)*e,this._z=(r-n)*e}else if(i>o&&i>h){const e=2*Math.sqrt(1+i-o-h);this._w=(c-a)/e,this._x=.25*e,this._y=(n+r)/e,this._z=(s+l)/e}else if(o>h){const e=2*Math.sqrt(1+o-i-h);this._w=(s-l)/e,this._x=(n+r)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+h-i-o);this._w=(r-n)/e,this._x=(s+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Vi(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,s=e._z,r=e._w,o=t._x,a=t._y,l=t._z,c=t._w;return this._x=i*c+r*o+n*l-s*a,this._y=n*c+r*a+s*o-i*l,this._z=s*c+r*l+i*a-n*o,this._w=r*c-i*o-n*a-s*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,n=this._y,s=this._z,r=this._w;let o=r*e._w+i*e._x+n*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=r,this._x=i,this._y=n,this._z=s,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*r+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),h=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=r*h+this._w*d,this._x=i*h+this._x*d,this._y=n*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){this.copy(e).slerp(t,i)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Quaternion.prototype.isQuaternion=!0;class Vector3{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Qi.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Qi.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*n,this.y=s[1]*t+s[4]*i+s[7]*n,this.z=s[2]*t+s[5]*i+s[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,s=e.elements,r=1/(s[3]*t+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*n+s[12])*r,this.y=(s[1]*t+s[5]*i+s[9]*n+s[13])*r,this.z=(s[2]*t+s[6]*i+s[10]*n+s[14])*r,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,s=e.x,r=e.y,o=e.z,a=e.w,l=a*t+r*n-o*i,c=a*i+o*t-s*n,h=a*n+s*i-r*t,d=-s*t-r*i-o*n;return this.x=l*a+d*-s+c*-o-h*-r,this.y=c*a+d*-r+h*-s-l*-o,this.z=h*a+d*-o+l*-r-c*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n,this.y=s[1]*t+s[5]*i+s[9]*n,this.z=s[2]*t+s[6]*i+s[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,s=e.z,r=t.x,o=t.y,a=t.z;return this.x=n*a-s*o,this.y=s*r-i*a,this.z=i*o-n*r,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return $i.copy(this).projectOnVector(e),this.sub($i)}reflect(e){return this.sub($i.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Vi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}Vector3.prototype.isVector3=!0;const $i=new Vector3,Qi=new Quaternion;class Box3{constructor(e=new Vector3(1/0,1/0,1/0),t=new Vector3(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,n=1/0,s=-1/0,r=-1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],h=e[a+2];l<t&&(t=l),c<i&&(i=c),h<n&&(n=h),l>s&&(s=l),c>r&&(r=c),h>o&&(o=h)}return this.min.set(t,i,n),this.max.set(s,r,o),this}setFromBufferAttribute(e){let t=1/0,i=1/0,n=1/0,s=-1/0,r=-1/0,o=-1/0;for(let a=0,l=e.count;a<l;a++){const l=e.getX(a),c=e.getY(a),h=e.getZ(a);l<t&&(t=l),c<i&&(i=c),h<n&&(n=h),l>s&&(s=l),c>r&&(r=c),h>o&&(o=h)}return this.min.set(t,i,n),this.max.set(s,r,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Ji.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),en.copy(t.boundingBox),en.applyMatrix4(e.matrixWorld),this.union(en));const i=e.children;for(let e=0,t=i.length;e<t;e++)this.expandByObject(i[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Vector3),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ji),Ji.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(ln),cn.subVectors(this.max,ln),tn.subVectors(e.a,ln),nn.subVectors(e.b,ln),sn.subVectors(e.c,ln),rn.subVectors(nn,tn),on.subVectors(sn,nn),an.subVectors(tn,sn);let t=[0,-rn.z,rn.y,0,-on.z,on.y,0,-an.z,an.y,rn.z,0,-rn.x,on.z,0,-on.x,an.z,0,-an.x,-rn.y,rn.x,0,-on.y,on.x,0,-an.y,an.x,0];return!!un(t,tn,nn,sn,cn)&&(t=[1,0,0,0,1,0,0,0,1],!!un(t,tn,nn,sn,cn)&&(hn.crossVectors(rn,on),t=[hn.x,hn.y,hn.z],un(t,tn,nn,sn,cn)))}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Vector3),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ji.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(Ji).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Xi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Xi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Xi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Xi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Xi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Xi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Xi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Xi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Xi)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Box3.prototype.isBox3=!0;const Xi=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],Ji=new Vector3,en=new Box3,tn=new Vector3,nn=new Vector3,sn=new Vector3,rn=new Vector3,on=new Vector3,an=new Vector3,ln=new Vector3,cn=new Vector3,hn=new Vector3,dn=new Vector3;function un(e,t,i,n,s){for(let r=0,o=e.length-3;r<=o;r+=3){dn.fromArray(e,r);const o=s.x*Math.abs(dn.x)+s.y*Math.abs(dn.y)+s.z*Math.abs(dn.z),a=t.dot(dn),l=i.dot(dn),c=n.dot(dn);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const pn=new Box3,mn=new Vector3,gn=new Vector3,fn=new Vector3;class Sphere{constructor(e=new Vector3,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):pn.setFromPoints(e).getCenter(i);let n=0;for(let t=0,s=e.length;t<s;t++)n=Math.max(n,i.distanceToSquared(e[t]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Vector3),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Box3),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){fn.subVectors(e,this.center);const t=fn.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),i=.5*(e-this.radius);this.center.add(fn.multiplyScalar(i/e)),this.radius+=i}return this}union(e){return gn.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(mn.copy(e.center).add(gn)),this.expandByPoint(mn.copy(e.center).sub(gn)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const vn=new Vector3,yn=new Vector3,bn=new Vector3,Sn=new Vector3,En=new Vector3,wn=new Vector3,Tn=new Vector3;class Ray{constructor(e=new Vector3,t=new Vector3(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Vector3),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,vn)),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Vector3),t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=vn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(vn.copy(this.direction).multiplyScalar(t).add(this.origin),vn.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){yn.copy(e).add(t).multiplyScalar(.5),bn.copy(t).sub(e).normalize(),Sn.copy(this.origin).sub(yn);const s=.5*e.distanceTo(t),r=-this.direction.dot(bn),o=Sn.dot(this.direction),a=-Sn.dot(bn),l=Sn.lengthSq(),c=Math.abs(1-r*r);let h,d,u,p;if(c>0)if(h=r*a-o,d=r*o-a,p=s*c,h>=0)if(d>=-p)if(d<=p){const e=1/c;h*=e,d*=e,u=h*(h+r*d+2*o)+d*(r*h+d+2*a)+l}else d=s,h=Math.max(0,-(r*d+o)),u=-h*h+d*(d+2*a)+l;else d=-s,h=Math.max(0,-(r*d+o)),u=-h*h+d*(d+2*a)+l;else d<=-p?(h=Math.max(0,-(-r*s+o)),d=h>0?-s:Math.min(Math.max(-s,-a),s),u=-h*h+d*(d+2*a)+l):d<=p?(h=0,d=Math.min(Math.max(-s,-a),s),u=d*(d+2*a)+l):(h=Math.max(0,-(r*s+o)),d=h>0?s:Math.min(Math.max(-s,-a),s),u=-h*h+d*(d+2*a)+l);else d=r>0?-s:s,h=Math.max(0,-(r*d+o)),u=-h*h+d*(d+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),n&&n.copy(bn).multiplyScalar(d).add(yn),u}intersectSphere(e,t){vn.subVectors(e.center,this.origin);const i=vn.dot(this.direction),n=vn.dot(vn)-i*i,s=e.radius*e.radius;if(n>s)return null;const r=Math.sqrt(s-n),o=i-r,a=i+r;return o<0&&a<0?null:o<0?this.at(a,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,s,r,o,a;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,d=this.origin;return l>=0?(i=(e.min.x-d.x)*l,n=(e.max.x-d.x)*l):(i=(e.max.x-d.x)*l,n=(e.min.x-d.x)*l),c>=0?(s=(e.min.y-d.y)*c,r=(e.max.y-d.y)*c):(s=(e.max.y-d.y)*c,r=(e.min.y-d.y)*c),i>r||s>n?null:((s>i||i!=i)&&(i=s),(r<n||n!=n)&&(n=r),h>=0?(o=(e.min.z-d.z)*h,a=(e.max.z-d.z)*h):(o=(e.max.z-d.z)*h,a=(e.min.z-d.z)*h),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,t)))}intersectsBox(e){return null!==this.intersectBox(e,vn)}intersectTriangle(e,t,i,n,s){En.subVectors(t,e),wn.subVectors(i,e),Tn.crossVectors(En,wn);let r,o=this.direction.dot(Tn);if(o>0){if(n)return null;r=1}else{if(!(o<0))return null;r=-1,o=-o}Sn.subVectors(this.origin,e);const a=r*this.direction.dot(wn.crossVectors(Sn,wn));if(a<0)return null;const l=r*this.direction.dot(En.cross(Sn));if(l<0)return null;if(a+l>o)return null;const c=-r*Sn.dot(Tn);return c<0?null:this.at(c/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Matrix4{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,n,s,r,o,a,l,c,h,d,u,p,m,g){const f=this.elements;return f[0]=e,f[4]=t,f[8]=i,f[12]=n,f[1]=s,f[5]=r,f[9]=o,f[13]=a,f[2]=l,f[6]=c,f[10]=h,f[14]=d,f[3]=u,f[7]=p,f[11]=m,f[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/_n.setFromMatrixColumn(e,0).length(),s=1/_n.setFromMatrixColumn(e,1).length(),r=1/_n.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*r,t[9]=i[9]*r,t[10]=i[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,n=e.y,s=e.z,r=Math.cos(i),o=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(s),h=Math.sin(s);if("XYZ"===e.order){const e=r*c,i=r*h,n=o*c,s=o*h;t[0]=a*c,t[4]=-a*h,t[8]=l,t[1]=i+n*l,t[5]=e-s*l,t[9]=-o*a,t[2]=s-e*l,t[6]=n+i*l,t[10]=r*a}else if("YXZ"===e.order){const e=a*c,i=a*h,n=l*c,s=l*h;t[0]=e+s*o,t[4]=n*o-i,t[8]=r*l,t[1]=r*h,t[5]=r*c,t[9]=-o,t[2]=i*o-n,t[6]=s+e*o,t[10]=r*a}else if("ZXY"===e.order){const e=a*c,i=a*h,n=l*c,s=l*h;t[0]=e-s*o,t[4]=-r*h,t[8]=n+i*o,t[1]=i+n*o,t[5]=r*c,t[9]=s-e*o,t[2]=-r*l,t[6]=o,t[10]=r*a}else if("ZYX"===e.order){const e=r*c,i=r*h,n=o*c,s=o*h;t[0]=a*c,t[4]=n*l-i,t[8]=e*l+s,t[1]=a*h,t[5]=s*l+e,t[9]=i*l-n,t[2]=-l,t[6]=o*a,t[10]=r*a}else if("YZX"===e.order){const e=r*a,i=r*l,n=o*a,s=o*l;t[0]=a*c,t[4]=s-e*h,t[8]=n*h+i,t[1]=h,t[5]=r*c,t[9]=-o*c,t[2]=-l*c,t[6]=i*h+n,t[10]=e-s*h}else if("XZY"===e.order){const e=r*a,i=r*l,n=o*a,s=o*l;t[0]=a*c,t[4]=-h,t[8]=l*c,t[1]=e*h+s,t[5]=r*c,t[9]=i*h-n,t[2]=n*h-i,t[6]=o*c,t[10]=s*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(xn,e,An)}lookAt(e,t,i){const n=this.elements;return Dn.subVectors(e,t),0===Dn.lengthSq()&&(Dn.z=1),Dn.normalize(),On.crossVectors(i,Dn),0===On.lengthSq()&&(1===Math.abs(i.z)?Dn.x+=1e-4:Dn.z+=1e-4,Dn.normalize(),On.crossVectors(i,Dn)),On.normalize(),Pn.crossVectors(Dn,On),n[0]=On.x,n[4]=Pn.x,n[8]=Dn.x,n[1]=On.y,n[5]=Pn.y,n[9]=Dn.y,n[2]=On.z,n[6]=Pn.z,n[10]=Dn.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,s=this.elements,r=i[0],o=i[4],a=i[8],l=i[12],c=i[1],h=i[5],d=i[9],u=i[13],p=i[2],m=i[6],g=i[10],f=i[14],v=i[3],y=i[7],b=i[11],S=i[15],E=n[0],w=n[4],T=n[8],_=n[12],M=n[1],x=n[5],A=n[9],O=n[13],P=n[2],D=n[6],C=n[10],I=n[14],L=n[3],R=n[7],N=n[11],k=n[15];return s[0]=r*E+o*M+a*P+l*L,s[4]=r*w+o*x+a*D+l*R,s[8]=r*T+o*A+a*C+l*N,s[12]=r*_+o*O+a*I+l*k,s[1]=c*E+h*M+d*P+u*L,s[5]=c*w+h*x+d*D+u*R,s[9]=c*T+h*A+d*C+u*N,s[13]=c*_+h*O+d*I+u*k,s[2]=p*E+m*M+g*P+f*L,s[6]=p*w+m*x+g*D+f*R,s[10]=p*T+m*A+g*C+f*N,s[14]=p*_+m*O+g*I+f*k,s[3]=v*E+y*M+b*P+S*L,s[7]=v*w+y*x+b*D+S*R,s[11]=v*T+y*A+b*C+S*N,s[15]=v*_+y*O+b*I+S*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],s=e[12],r=e[1],o=e[5],a=e[9],l=e[13],c=e[2],h=e[6],d=e[10],u=e[14];return e[3]*(+s*a*h-n*l*h-s*o*d+i*l*d+n*o*u-i*a*u)+e[7]*(+t*a*u-t*l*d+s*r*d-n*r*u+n*l*c-s*a*c)+e[11]*(+t*l*h-t*o*u-s*r*h+i*r*u+s*o*c-i*l*c)+e[15]*(-n*o*c-t*a*h+t*o*d+n*r*h-i*r*d+i*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],r=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],d=e[10],u=e[11],p=e[12],m=e[13],g=e[14],f=e[15],v=h*g*l-m*d*l+m*a*u-o*g*u-h*a*f+o*d*f,y=p*d*l-c*g*l-p*a*u+r*g*u+c*a*f-r*d*f,b=c*m*l-p*h*l+p*o*u-r*m*u-c*o*f+r*h*f,S=p*h*a-c*m*a-p*o*d+r*m*d+c*o*g-r*h*g,E=t*v+i*y+n*b+s*S;if(0===E)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/E;return e[0]=v*w,e[1]=(m*d*s-h*g*s-m*n*u+i*g*u+h*n*f-i*d*f)*w,e[2]=(o*g*s-m*a*s+m*n*l-i*g*l-o*n*f+i*a*f)*w,e[3]=(h*a*s-o*d*s-h*n*l+i*d*l+o*n*u-i*a*u)*w,e[4]=y*w,e[5]=(c*g*s-p*d*s+p*n*u-t*g*u-c*n*f+t*d*f)*w,e[6]=(p*a*s-r*g*s-p*n*l+t*g*l+r*n*f-t*a*f)*w,e[7]=(r*d*s-c*a*s+c*n*l-t*d*l-r*n*u+t*a*u)*w,e[8]=b*w,e[9]=(p*h*s-c*m*s-p*i*u+t*m*u+c*i*f-t*h*f)*w,e[10]=(r*m*s-p*o*s+p*i*l-t*m*l-r*i*f+t*o*f)*w,e[11]=(c*o*s-r*h*s-c*i*l+t*h*l+r*i*u-t*o*u)*w,e[12]=S*w,e[13]=(c*m*n-p*h*n+p*i*d-t*m*d-c*i*g+t*h*g)*w,e[14]=(p*o*n-r*m*n-p*i*a+t*m*a+r*i*g-t*o*g)*w,e[15]=(r*h*n-c*o*n+c*i*a-t*h*a-r*i*d+t*o*d)*w,this}scale(e){const t=this.elements,i=e.x,n=e.y,s=e.z;return t[0]*=i,t[4]*=n,t[8]*=s,t[1]*=i,t[5]*=n,t[9]*=s,t[2]*=i,t[6]*=n,t[10]*=s,t[3]*=i,t[7]*=n,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),s=1-i,r=e.x,o=e.y,a=e.z,l=s*r,c=s*o;return this.set(l*r+i,l*o-n*a,l*a+n*o,0,l*o+n*a,c*o+i,c*a-n*r,0,l*a-n*o,c*a+n*r,s*a*a+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,s=t._x,r=t._y,o=t._z,a=t._w,l=s+s,c=r+r,h=o+o,d=s*l,u=s*c,p=s*h,m=r*c,g=r*h,f=o*h,v=a*l,y=a*c,b=a*h,S=i.x,E=i.y,w=i.z;return n[0]=(1-(m+f))*S,n[1]=(u+b)*S,n[2]=(p-y)*S,n[3]=0,n[4]=(u-b)*E,n[5]=(1-(d+f))*E,n[6]=(g+v)*E,n[7]=0,n[8]=(p+y)*w,n[9]=(g-v)*w,n[10]=(1-(d+m))*w,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let s=_n.set(n[0],n[1],n[2]).length();const r=_n.set(n[4],n[5],n[6]).length(),o=_n.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),e.x=n[12],e.y=n[13],e.z=n[14],Mn.copy(this);const a=1/s,l=1/r,c=1/o;return Mn.elements[0]*=a,Mn.elements[1]*=a,Mn.elements[2]*=a,Mn.elements[4]*=l,Mn.elements[5]*=l,Mn.elements[6]*=l,Mn.elements[8]*=c,Mn.elements[9]*=c,Mn.elements[10]*=c,t.setFromRotationMatrix(Mn),i.x=s,i.y=r,i.z=o,this}makePerspective(e,t,i,n,s,r){void 0===r&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*s/(t-e),l=2*s/(i-n),c=(t+e)/(t-e),h=(i+n)/(i-n),d=-(r+s)/(r-s),u=-2*r*s/(r-s);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=u,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,i,n,s,r){const o=this.elements,a=1/(t-e),l=1/(i-n),c=1/(r-s),h=(t+e)*a,d=(i+n)*l,u=(r+s)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-u,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<16;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}Matrix4.prototype.isMatrix4=!0;const _n=new Vector3,Mn=new Matrix4,xn=new Vector3(0,0,0),An=new Vector3(1,1,1),On=new Vector3,Pn=new Vector3,Dn=new Vector3,Cn=new Matrix4,In=new Quaternion;class Euler{constructor(e=0,t=0,i=0,n=Euler.DefaultOrder){this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,i){const n=e.elements,s=n[0],r=n[4],o=n[8],a=n[1],l=n[5],c=n[9],h=n[2],d=n[6],u=n[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(Vi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,u),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Vi(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,u),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Vi(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,u),this._z=Math.atan2(-r,l)):(this._y=0,this._z=Math.atan2(a,s));break;case"ZYX":this._y=Math.asin(-Vi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,u),this._z=Math.atan2(a,s)):(this._x=0,this._z=Math.atan2(-r,l));break;case"YZX":this._z=Math.asin(Vi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,u));break;case"XZY":this._z=Math.asin(-Vi(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-c,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return Cn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Cn,t,i)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return In.setFromEuler(this),this.setFromQuaternion(In,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Euler.prototype.isEuler=!0,Euler.DefaultOrder="XYZ",Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Layers{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let Ln=0;const Rn=new Vector3,Nn=new Quaternion,kn=new Matrix4,Bn=new Vector3,Fn=new Vector3,Un=new Vector3,Vn=new Quaternion,Hn=new Vector3(1,0,0),Gn=new Vector3(0,1,0),zn=new Vector3(0,0,1),Wn={type:"added"},jn={type:"removed"};class Object3D extends EventDispatcher{constructor(){super(),Object.defineProperty(this,"id",{value:Ln++}),this.uuid=Ui(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();const e=new Vector3,t=new Euler,i=new Quaternion,n=new Vector3(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Nn.setFromAxisAngle(e,t),this.quaternion.multiply(Nn),this}rotateOnWorldAxis(e,t){return Nn.setFromAxisAngle(e,t),this.quaternion.premultiply(Nn),this}rotateX(e){return this.rotateOnAxis(Hn,e)}rotateY(e){return this.rotateOnAxis(Gn,e)}rotateZ(e){return this.rotateOnAxis(zn,e)}translateOnAxis(e,t){return Rn.copy(e).applyQuaternion(this.quaternion),this.position.add(Rn.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Hn,e)}translateY(e){return this.translateOnAxis(Gn,e)}translateZ(e){return this.translateOnAxis(zn,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(kn.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Bn.copy(e):Bn.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Fn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?kn.lookAt(Fn,Bn,this.up):kn.lookAt(Bn,Fn,this.up),this.quaternion.setFromRotationMatrix(kn),n&&(kn.extractRotation(n.matrixWorld),Nn.setFromRotationMatrix(kn),this.quaternion.premultiply(Nn.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Wn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(jn)),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(jn)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),kn.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),kn.multiply(e.parent.matrixWorld)),e.applyMatrix4(kn),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}}getWorldPosition(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Quaternion),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fn,e,Un),e}getWorldScale(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fn,Vn,e),e}getWorldDirection(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function s(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){n.geometry=s(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const n=i[t];s(e.shapes,n)}else s(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(s(e.materials,this.material[i]));n.material=t}else n.material=s(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){const i=this.animations[t];n.animations.push(s(e.animations,i))}}if(t){const t=r(e.geometries),n=r(e.materials),s=r(e.textures),o=r(e.images),a=r(e.shapes),l=r(e.skeletons),c=r(e.animations);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),s.length>0&&(i.textures=s),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c)}return i.object=n,i;function r(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const i=e.children[t];this.add(i.clone())}return this}}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype.isObject3D=!0;const Kn=new Vector3,qn=new Vector3,Zn=new Matrix3;class Plane{constructor(e=new Vector3(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=Kn.subVectors(i,t).cross(qn.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Vector3);const i=e.delta(Kn),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:t.copy(i).multiplyScalar(s).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Vector3),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||Zn.getNormalMatrix(e),n=this.coplanarPoint(Kn).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Plane.prototype.isPlane=!0;const Yn=new Vector3,$n=new Vector3,Qn=new Vector3,Xn=new Vector3,Jn=new Vector3,es=new Vector3,ts=new Vector3,is=new Vector3,ns=new Vector3,ss=new Vector3;class Triangle{constructor(e=new Vector3,t=new Vector3,i=new Vector3){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new Vector3),n.subVectors(i,t),Yn.subVectors(e,t),n.cross(Yn);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(e,t,i,n,s){Yn.subVectors(n,t),$n.subVectors(i,t),Qn.subVectors(e,t);const r=Yn.dot(Yn),o=Yn.dot($n),a=Yn.dot(Qn),l=$n.dot($n),c=$n.dot(Qn),h=r*l-o*o;if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new Vector3),0===h)return s.set(-2,-1,-1);const d=1/h,u=(l*a-o*c)*d,p=(r*c-o*a)*d;return s.set(1-u-p,p,u)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,Xn),Xn.x>=0&&Xn.y>=0&&Xn.x+Xn.y<=1}static getUV(e,t,i,n,s,r,o,a){return this.getBarycoord(e,t,i,n,Xn),a.set(0,0),a.addScaledVector(s,Xn.x),a.addScaledVector(r,Xn.y),a.addScaledVector(o,Xn.z),a}static isFrontFacing(e,t,i,n){return Yn.subVectors(i,t),$n.subVectors(e,t),Yn.cross($n).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Yn.subVectors(this.c,this.b),$n.subVectors(this.a,this.b),.5*Yn.cross($n).length()}getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Vector3),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Triangle.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Plane),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,s){return Triangle.getUV(e,this.a,this.b,this.c,t,i,n,s)}containsPoint(e){return Triangle.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Triangle.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Vector3);const i=this.a,n=this.b,s=this.c;let r,o;Jn.subVectors(n,i),es.subVectors(s,i),is.subVectors(e,i);const a=Jn.dot(is),l=es.dot(is);if(a<=0&&l<=0)return t.copy(i);ns.subVectors(e,n);const c=Jn.dot(ns),h=es.dot(ns);if(c>=0&&h<=c)return t.copy(n);const d=a*h-c*l;if(d<=0&&a>=0&&c<=0)return r=a/(a-c),t.copy(i).addScaledVector(Jn,r);ss.subVectors(e,s);const u=Jn.dot(ss),p=es.dot(ss);if(p>=0&&u<=p)return t.copy(s);const m=u*l-a*p;if(m<=0&&l>=0&&p<=0)return o=l/(l-p),t.copy(i).addScaledVector(es,o);const g=c*p-u*h;if(g<=0&&h-c>=0&&u-p>=0)return ts.subVectors(s,n),o=(h-c)/(h-c+(u-p)),t.copy(n).addScaledVector(ts,o);const f=1/(g+m+d);return r=m*f,o=d*f,t.copy(i).addScaledVector(Jn,r).addScaledVector(es,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let rs=0;function os(){Object.defineProperty(this,"id",{value:rs++}),this.uuid=Ui(),this.name="",this.type="Material",this.fog=!0,this.blending=S,this.side=m,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=R,this.blendDst=N,this.blendEquation=M,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=W,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ti,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ci,this.stencilZFail=ci,this.stencilZPass=ci,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}os.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:os,isMaterial:!0,onBuild:function(){},onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===v;continue}const n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}},toJSON:function(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==S&&(i.blending=this.blending),this.side!==m&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.skinning&&(i.skinning=!0),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){const t=n(e.textures),s=n(e.images);t.length>0&&(i.textures=t),s.length>0&&(i.images=s)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const e=t.length;i=new Array(e);for(let n=0;n!==e;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(os.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});const as={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ls={h:0,s:0,l:0},cs={h:0,s:0,l:0};function hs(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function ds(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function us(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Color{constructor(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=Hi(e,1),t=Vi(t,0,1),i=Vi(i,0,1),0===t)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+t):i+t-i*t,s=2*i-n;this.r=hs(s,n,e+1/3),this.g=hs(s,n,e),this.b=hs(s,n,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const i=parseFloat(e[1])/360,n=parseInt(e[2],10)/100,s=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(i,n,s)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=as[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=ds(e.r),this.g=ds(e.g),this.b=ds(e.b),this}copyLinearToSRGB(e){return this.r=us(e.r),this.g=us(e.g),this.b=us(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,i=this.g,n=this.b,s=Math.max(t,i,n),r=Math.min(t,i,n);let o,a;const l=(r+s)/2;if(r===s)o=0,a=0;else{const e=s-r;switch(a=l<=.5?e/(s+r):e/(2-s-r),s){case t:o=(i-n)/e+(i<n?6:0);break;case i:o=(n-t)/e+2;break;case n:o=(t-i)/e+4}o/=6}return e.h=o,e.s=a,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,i){return this.getHSL(ls),ls.h+=e,ls.s+=t,ls.l+=i,this.setHSL(ls.h,ls.s,ls.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(ls),e.getHSL(cs);const i=Gi(ls.h,cs.h,t),n=Gi(ls.s,cs.s,t),s=Gi(ls.l,cs.l,t);return this.setHSL(i,n,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Color.NAMES=as,Color.prototype.isColor=!0,Color.prototype.r=1,Color.prototype.g=1,Color.prototype.b=1;class MeshBasicMaterial extends os{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this}}MeshBasicMaterial.prototype.isMeshBasicMaterial=!0;const ps=new Vector3,ms=new Vector2;class BufferAttribute{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=_i,this.updateRange={offset:0,count:-1},this.version=0,this.onUploadCallback=function(){}}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let i=0;for(let n=0,s=e.length;n<s;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),s=new Color),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this}copyVector2sArray(e){const t=this.array;let i=0;for(let n=0,s=e.length;n<s;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),s=new Vector2),t[i++]=s.x,t[i++]=s.y}return this}copyVector3sArray(e){const t=this.array;let i=0;for(let n=0,s=e.length;n<s;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),s=new Vector3),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this}copyVector4sArray(e){const t=this.array;let i=0;for(let n=0,s=e.length;n<s;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),s=new Vector4),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)ms.fromBufferAttribute(this,t),ms.applyMatrix3(e),this.setXY(t,ms.x,ms.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)ps.fromBufferAttribute(this,t),ps.applyMatrix3(e),this.setXYZ(t,ps.x,ps.y,ps.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)ps.x=this.getX(t),ps.y=this.getY(t),ps.z=this.getZ(t),ps.applyMatrix4(e),this.setXYZ(t,ps.x,ps.y,ps.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ps.x=this.getX(t),ps.y=this.getY(t),ps.z=this.getZ(t),ps.applyNormalMatrix(e),this.setXYZ(t,ps.x,ps.y,ps.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ps.x=this.getX(t),ps.y=this.getY(t),ps.z=this.getZ(t),ps.transformDirection(e),this.setXYZ(t,ps.x,ps.y,ps.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,s){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==_i&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}BufferAttribute.prototype.isBufferAttribute=!0;class Int8BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Int8Array(e),t,i)}}class Uint8BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class Int16BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Int16Array(e),t,i)}}class Uint16BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class Int32BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Int32Array(e),t,i)}}class Uint32BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Float16BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Uint16Array(e),t,i)}}Float16BufferAttribute.prototype.isFloat16BufferAttribute=!0;class Float32BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Float32Array(e),t,i)}}class Float64BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Float64Array(e),t,i)}}function gs(e){if(0===e.length)return-1/0;let t=e[0];for(let i=1,n=e.length;i<n;++i)e[i]>t&&(t=e[i]);return t}const fs={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function vs(e,t){return new fs[e](t)}let ys=0;const bs=new Matrix4,Ss=new Object3D,Es=new Vector3,ws=new Box3,Ts=new Box3,_s=new Vector3;class BufferGeometry extends EventDispatcher{constructor(){super(),Object.defineProperty(this,"id",{value:ys++}),this.uuid=Ui(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(gs(e)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const t=(new Matrix3).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}rotateX(e){return bs.makeRotationX(e),this.applyMatrix4(bs),this}rotateY(e){return bs.makeRotationY(e),this.applyMatrix4(bs),this}rotateZ(e){return bs.makeRotationZ(e),this.applyMatrix4(bs),this}translate(e,t,i){return bs.makeTranslation(e,t,i),this.applyMatrix4(bs),this}scale(e,t,i){return bs.makeScale(e,t,i),this.applyMatrix4(bs),this}lookAt(e){return Ss.lookAt(e),Ss.updateMatrix(),this.applyMatrix4(Ss.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Es).negate(),this.translate(Es.x,Es.y,Es.z),this}setFromPoints(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Float32BufferAttribute(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Box3);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];ws.setFromBufferAttribute(i),this.morphTargetsRelative?(_s.addVectors(this.boundingBox.min,ws.min),this.boundingBox.expandByPoint(_s),_s.addVectors(this.boundingBox.max,ws.max),this.boundingBox.expandByPoint(_s)):(this.boundingBox.expandByPoint(ws.min),this.boundingBox.expandByPoint(ws.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vector3,1/0);if(e){const i=this.boundingSphere.center;if(ws.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];Ts.setFromBufferAttribute(i),this.morphTargetsRelative?(_s.addVectors(ws.min,Ts.min),ws.expandByPoint(_s),_s.addVectors(ws.max,Ts.max),ws.expandByPoint(_s)):(ws.expandByPoint(Ts.min),ws.expandByPoint(Ts.max))}ws.getCenter(i);let n=0;for(let t=0,s=e.count;t<s;t++)_s.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(_s));if(t)for(let s=0,r=t.length;s<r;s++){const r=t[s],o=this.morphTargetsRelative;for(let t=0,s=r.count;t<s;t++)_s.fromBufferAttribute(r,t),o&&(Es.fromBufferAttribute(e,t),_s.add(Es)),n=Math.max(n,i.distanceToSquared(_s))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,n=t.position.array,s=t.normal.array,r=t.uv.array,o=n.length/3;void 0===t.tangent&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*o),4));const a=t.tangent.array,l=[],c=[];for(let e=0;e<o;e++)l[e]=new Vector3,c[e]=new Vector3;const h=new Vector3,d=new Vector3,u=new Vector3,p=new Vector2,m=new Vector2,g=new Vector2,f=new Vector3,v=new Vector3;function y(e,t,i){h.fromArray(n,3*e),d.fromArray(n,3*t),u.fromArray(n,3*i),p.fromArray(r,2*e),m.fromArray(r,2*t),g.fromArray(r,2*i),d.sub(h),u.sub(h),m.sub(p),g.sub(p);const s=1/(m.x*g.y-g.x*m.y);isFinite(s)&&(f.copy(d).multiplyScalar(g.y).addScaledVector(u,-m.y).multiplyScalar(s),v.copy(u).multiplyScalar(m.x).addScaledVector(d,-g.x).multiplyScalar(s),l[e].add(f),l[t].add(f),l[i].add(f),c[e].add(v),c[t].add(v),c[i].add(v))}let b=this.groups;0===b.length&&(b=[{start:0,count:i.length}]);for(let e=0,t=b.length;e<t;++e){const t=b[e],n=t.start;for(let e=n,s=n+t.count;e<s;e+=3)y(i[e+0],i[e+1],i[e+2])}const S=new Vector3,E=new Vector3,w=new Vector3,T=new Vector3;function _(e){w.fromArray(s,3*e),T.copy(w);const t=l[e];S.copy(t),S.sub(w.multiplyScalar(w.dot(t))).normalize(),E.crossVectors(T,t);const i=E.dot(c[e])<0?-1:1;a[4*e]=S.x,a[4*e+1]=S.y,a[4*e+2]=S.z,a[4*e+3]=i}for(let e=0,t=b.length;e<t;++e){const t=b[e],n=t.start;for(let e=n,s=n+t.count;e<s;e+=3)_(i[e+0]),_(i[e+1]),_(i[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new BufferAttribute(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);const n=new Vector3,s=new Vector3,r=new Vector3,o=new Vector3,a=new Vector3,l=new Vector3,c=new Vector3,h=new Vector3;if(e)for(let d=0,u=e.count;d<u;d+=3){const u=e.getX(d+0),p=e.getX(d+1),m=e.getX(d+2);n.fromBufferAttribute(t,u),s.fromBufferAttribute(t,p),r.fromBufferAttribute(t,m),c.subVectors(r,s),h.subVectors(n,s),c.cross(h),o.fromBufferAttribute(i,u),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,m),o.add(c),a.add(c),l.add(c),i.setXYZ(u,o.x,o.y,o.z),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let e=0,o=t.count;e<o;e+=3)n.fromBufferAttribute(t,e+0),s.fromBufferAttribute(t,e+1),r.fromBufferAttribute(t,e+2),c.subVectors(r,s),h.subVectors(n,s),c.cross(h),i.setXYZ(e+0,c.x,c.y,c.z),i.setXYZ(e+1,c.x,c.y,c.z),i.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===e.attributes[n])continue;const s=i[n].array,r=e.attributes[n],o=r.array,a=r.itemSize*t,l=Math.min(o.length,s.length-a);for(let e=0,t=a;e<l;e++,t++)s[t]=o[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)_s.fromBufferAttribute(e,t),_s.normalize(),e.setXYZ(t,_s.x,_s.y,_s.z)}toNonIndexed(){function e(e,t){const i=e.array,n=e.itemSize,s=e.normalized,r=new i.constructor(t.length*n);let o=0,a=0;for(let e=0,s=t.length;e<s;e++){o=t[e]*n;for(let e=0;e<n;e++)r[a++]=i[o++]}return new BufferAttribute(r,n,s)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new BufferGeometry,i=this.index.array,n=this.attributes;for(const s in n){const r=e(n[s],i);t.setAttribute(s,r)}const s=this.morphAttributes;for(const n in s){const r=[],o=s[n];for(let t=0,n=o.length;t<n;t++){const n=e(o[t],i);r.push(n)}t.morphAttributes[n]=r}t.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let e=0,i=r.length;e<i;e++){const i=r[e];t.addGroup(i.start,i.count,i.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const t in i){const n=i[t];e.data.attributes[t]=n.toJSON(e.data)}const n={};let s=!1;for(const t in this.morphAttributes){const i=this.morphAttributes[t],r=[];for(let t=0,n=i.length;t<n;t++){const n=i[t];r.push(n.toJSON(e.data))}r.length>0&&(n[t]=r,s=!0)}s&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(e.data.groups=JSON.parse(JSON.stringify(r)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new BufferGeometry).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const n=e.attributes;for(const e in n){const i=n[e];this.setAttribute(e,i.clone(t))}const s=e.morphAttributes;for(const e in s){const i=[],n=s[e];for(let e=0,s=n.length;e<s;e++)i.push(n[e].clone(t));this.morphAttributes[e]=i}this.morphTargetsRelative=e.morphTargetsRelative;const r=e.groups;for(let e=0,t=r.length;e<t;e++){const t=r[e];this.addGroup(t.start,t.count,t.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}BufferGeometry.prototype.isBufferGeometry=!0;const Ms=new Matrix4,xs=new Ray,As=new Sphere,Os=new Vector3,Ps=new Vector3,Ds=new Vector3,Cs=new Vector3,Is=new Vector3,Ls=new Vector3,Rs=new Vector3,Ns=new Vector3,ks=new Vector3,Bs=new Vector2,Fs=new Vector2,Us=new Vector2,Vs=new Vector3,Hs=new Vector3;class Mesh extends Object3D{constructor(e=new BufferGeometry,t=new MeshBasicMaterial){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const i=this.geometry,n=this.material,s=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),As.copy(i.boundingSphere),As.applyMatrix4(s),!1===e.ray.intersectsSphere(As))return;if(Ms.copy(s).invert(),xs.copy(e.ray).applyMatrix4(Ms),null!==i.boundingBox&&!1===xs.intersectsBox(i.boundingBox))return;let r;if(i.isBufferGeometry){const s=i.index,o=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,h=i.attributes.uv2,d=i.groups,u=i.drawRange;if(null!==s)if(Array.isArray(n))for(let i=0,p=d.length;i<p;i++){const p=d[i],m=n[p.materialIndex];for(let i=Math.max(p.start,u.start),n=Math.min(p.start+p.count,u.start+u.count);i<n;i+=3){const n=s.getX(i),d=s.getX(i+1),u=s.getX(i+2);r=Gs(this,m,e,xs,o,a,l,c,h,n,d,u),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=p.materialIndex,t.push(r))}}else{for(let i=Math.max(0,u.start),d=Math.min(s.count,u.start+u.count);i<d;i+=3){const d=s.getX(i),u=s.getX(i+1),p=s.getX(i+2);r=Gs(this,n,e,xs,o,a,l,c,h,d,u,p),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}else if(void 0!==o)if(Array.isArray(n))for(let i=0,s=d.length;i<s;i++){const s=d[i],p=n[s.materialIndex];for(let i=Math.max(s.start,u.start),n=Math.min(s.start+s.count,u.start+u.count);i<n;i+=3){r=Gs(this,p,e,xs,o,a,l,c,h,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=s.materialIndex,t.push(r))}}else{for(let i=Math.max(0,u.start),s=Math.min(o.count,u.start+u.count);i<s;i+=3){r=Gs(this,n,e,xs,o,a,l,c,h,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Gs(e,t,i,n,s,r,o,a,l,c,h,d){Os.fromBufferAttribute(s,c),Ps.fromBufferAttribute(s,h),Ds.fromBufferAttribute(s,d);const u=e.morphTargetInfluences;if(t.morphTargets&&r&&u){Rs.set(0,0,0),Ns.set(0,0,0),ks.set(0,0,0);for(let e=0,t=r.length;e<t;e++){const t=u[e],i=r[e];0!==t&&(Cs.fromBufferAttribute(i,c),Is.fromBufferAttribute(i,h),Ls.fromBufferAttribute(i,d),o?(Rs.addScaledVector(Cs,t),Ns.addScaledVector(Is,t),ks.addScaledVector(Ls,t)):(Rs.addScaledVector(Cs.sub(Os),t),Ns.addScaledVector(Is.sub(Ps),t),ks.addScaledVector(Ls.sub(Ds),t)))}Os.add(Rs),Ps.add(Ns),Ds.add(ks)}e.isSkinnedMesh&&t.skinning&&(e.boneTransform(c,Os),e.boneTransform(h,Ps),e.boneTransform(d,Ds));const p=function(e,t,i,n,s,r,o,a){let l;if(l=t.side===g?n.intersectTriangle(o,r,s,!0,a):n.intersectTriangle(s,r,o,t.side!==f,a),null===l)return null;Hs.copy(a),Hs.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(Hs);return c<i.near||c>i.far?null:{distance:c,point:Hs.clone(),object:e}}(e,t,i,n,Os,Ps,Ds,Vs);if(p){a&&(Bs.fromBufferAttribute(a,c),Fs.fromBufferAttribute(a,h),Us.fromBufferAttribute(a,d),p.uv=Triangle.getUV(Vs,Os,Ps,Ds,Bs,Fs,Us,new Vector2)),l&&(Bs.fromBufferAttribute(l,c),Fs.fromBufferAttribute(l,h),Us.fromBufferAttribute(l,d),p.uv2=Triangle.getUV(Vs,Os,Ps,Ds,Bs,Fs,Us,new Vector2));const e={a:c,b:h,c:d,normal:new Vector3,materialIndex:0};Triangle.getNormal(Os,Ps,Ds,e.normal),p.face=e}return p}Mesh.prototype.isMesh=!0;class BoxGeometry extends BufferGeometry{constructor(e=1,t=1,i=1,n=1,s=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:s,depthSegments:r};const o=this;n=Math.floor(n),s=Math.floor(s),r=Math.floor(r);const a=[],l=[],c=[],h=[];let d=0,u=0;function p(e,t,i,n,s,r,p,m,g,f,v){const y=r/g,b=p/f,S=r/2,E=p/2,w=m/2,T=g+1,_=f+1;let M=0,x=0;const A=new Vector3;for(let r=0;r<_;r++){const o=r*b-E;for(let a=0;a<T;a++){const d=a*y-S;A[e]=d*n,A[t]=o*s,A[i]=w,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[i]=m>0?1:-1,c.push(A.x,A.y,A.z),h.push(a/g),h.push(1-r/f),M+=1}}for(let e=0;e<f;e++)for(let t=0;t<g;t++){const i=d+t+T*e,n=d+t+T*(e+1),s=d+(t+1)+T*(e+1),r=d+(t+1)+T*e;a.push(i,n,r),a.push(n,s,r),x+=6}o.addGroup(u,x,v),u+=x,d+=M}p("z","y","x",-1,-1,i,t,e,r,s,0),p("z","y","x",1,-1,i,t,-e,r,s,1),p("x","z","y",1,1,e,i,t,n,r,2),p("x","z","y",1,-1,e,i,-t,n,r,3),p("x","y","z",1,-1,e,t,i,n,s,4),p("x","y","z",-1,-1,e,t,-i,n,s,5),this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}}function zs(e){const t={};for(const i in e){t[i]={};for(const n in e[i]){const s=e[i][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?t[i][n]=s.clone():Array.isArray(s)?t[i][n]=s.slice():t[i][n]=s}}return t}function Ws(e){const t={};for(let i=0;i<e.length;i++){const n=zs(e[i]);for(const e in n)t[e]=n[e]}return t}const js={clone:zs,merge:Ws};class ShaderMaterial extends os{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=zs(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const e in this.extensions)!0===this.extensions[e]&&(i[e]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}ShaderMaterial.prototype.isShaderMaterial=!0;class Camera extends Object3D{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Camera.prototype.isCamera=!0;class PerspectiveCamera extends Camera{constructor(e=50,t=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Fi*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Bi*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Fi*Math.atan(Math.tan(.5*Bi*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,s,r){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Bi*this.fov)/this.zoom,i=2*t,n=this.aspect*i,s=-.5*n;const r=this.view;if(null!==this.view&&this.view.enabled){const e=r.fullWidth,o=r.fullHeight;s+=r.offsetX*n/e,t-=r.offsetY*i/o,n*=r.width/e,i*=r.height/o}const o=this.filmOffset;0!==o&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}PerspectiveCamera.prototype.isPerspectiveCamera=!0;const Ks=90;class CubeCamera extends Object3D{constructor(e,t,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new PerspectiveCamera(Ks,1,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new Vector3(1,0,0)),this.add(n);const s=new PerspectiveCamera(Ks,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Vector3(-1,0,0)),this.add(s);const r=new PerspectiveCamera(Ks,1,e,t);r.layers=this.layers,r.up.set(0,0,1),r.lookAt(new Vector3(0,1,0)),this.add(r);const o=new PerspectiveCamera(Ks,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new Vector3(0,-1,0)),this.add(o);const a=new PerspectiveCamera(Ks,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Vector3(0,0,1)),this.add(a);const l=new PerspectiveCamera(Ks,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Vector3(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,s,r,o,a,l]=this.children,c=e.xr.enabled,h=e.getRenderTarget();e.xr.enabled=!1;const d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,n),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,r),e.setRenderTarget(i,3),e.render(t,o),e.setRenderTarget(i,4),e.render(t,a),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(h),e.xr.enabled=c}}class CubeTexture extends Texture{constructor(e,t,i,n,s,r,o,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:re,i,n,s,r,o=void 0!==o?o:Be,a,l,c),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}CubeTexture.prototype.isCubeTexture=!0;class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),super(e,e,t),t=t||{},this.texture=new CubeTexture(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:be,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Fe,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new BoxGeometry(5,5,5),s=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:zs(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:g,blending:b});s.uniforms.tEquirect.value=t;const r=new Mesh(n,s),o=t.minFilter;t.minFilter===we&&(t.minFilter=be);return new CubeCamera(1,10,this).update(e,r),t.minFilter=o,r.geometry.dispose(),r.material.dispose(),this}clear(e,t,i,n){const s=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,n);e.setRenderTarget(s)}}WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0;class DataTexture extends Texture{constructor(e,t,i,n,s,r,o,a,l,c,h,d){super(null,r,o,a,l,c,n,s,h,d),this.image={data:e||null,width:t||1,height:i||1},this.magFilter=void 0!==l?l:me,this.minFilter=void 0!==c?c:me,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture.prototype.isDataTexture=!0;const qs=new Sphere,Zs=new Vector3;class Frustum{constructor(e=new Plane,t=new Plane,i=new Plane,n=new Plane,s=new Plane,r=new Plane){this.planes=[e,t,i,n,s,r]}set(e,t,i,n,s,r){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(n),o[4].copy(s),o[5].copy(r),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,n=i[0],s=i[1],r=i[2],o=i[3],a=i[4],l=i[5],c=i[6],h=i[7],d=i[8],u=i[9],p=i[10],m=i[11],g=i[12],f=i[13],v=i[14],y=i[15];return t[0].setComponents(o-n,h-a,m-d,y-g).normalize(),t[1].setComponents(o+n,h+a,m+d,y+g).normalize(),t[2].setComponents(o+s,h+l,m+u,y+f).normalize(),t[3].setComponents(o-s,h-l,m-u,y-f).normalize(),t[4].setComponents(o-r,h-c,m-p,y-v).normalize(),t[5].setComponents(o+r,h+c,m+p,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),qs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(qs)}intersectsSprite(e){return qs.center.set(0,0,0),qs.radius=.7071067811865476,qs.applyMatrix4(e.matrixWorld),this.intersectsSphere(qs)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(i)<n)return!1}return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(Zs.x=n.normal.x>0?e.max.x:e.min.x,Zs.y=n.normal.y>0?e.max.y:e.min.y,Zs.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Zs)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Ys(){let e=null,t=!1,i=null,n=null;function s(t,r){i(t,r),n=e.requestAnimationFrame(s)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(s),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function $s(e,t){const i=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const i=n.get(t);i&&(e.deleteBuffer(i.buffer),n.delete(t))},update:function(t,s){if(t.isGLBufferAttribute){const e=n.get(t);return void((!e||e.version<t.version)&&n.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const r=n.get(t);void 0===r?n.set(t,function(t,n){const s=t.array,r=t.usage,o=e.createBuffer();e.bindBuffer(n,o),e.bufferData(n,s,r),t.onUploadCallback();let a=5126;return s instanceof Float32Array?a=5126:s instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):s instanceof Uint16Array?t.isFloat16BufferAttribute?i?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:s instanceof Int16Array?a=5122:s instanceof Uint32Array?a=5125:s instanceof Int32Array?a=5124:s instanceof Int8Array?a=5120:s instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:s.BYTES_PER_ELEMENT,version:t.version}}(t,s)):r.version<t.version&&(!function(t,n,s){const r=n.array,o=n.updateRange;e.bindBuffer(s,t),-1===o.count?e.bufferSubData(s,0,r):(i?e.bufferSubData(s,o.offset*r.BYTES_PER_ELEMENT,r,o.offset,o.count):e.bufferSubData(s,o.offset*r.BYTES_PER_ELEMENT,r.subarray(o.offset,o.offset+o.count)),o.count=-1)}(r.buffer,t,s),r.version=t.version)}}}class PlaneGeometry extends BufferGeometry{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const s=e/2,r=t/2,o=Math.floor(i),a=Math.floor(n),l=o+1,c=a+1,h=e/o,d=t/a,u=[],p=[],m=[],g=[];for(let e=0;e<c;e++){const t=e*d-r;for(let i=0;i<l;i++){const n=i*h-s;p.push(n,-t,0),m.push(0,0,1),g.push(i/o),g.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<o;t++){const i=t+l*e,n=t+l*(e+1),s=t+1+l*(e+1),r=t+1+l*e;u.push(i,n,r),u.push(n,s,r)}this.setIndex(u),this.setAttribute("position",new Float32BufferAttribute(p,3)),this.setAttribute("normal",new Float32BufferAttribute(m,3)),this.setAttribute("uv",new Float32BufferAttribute(g,2))}}const Qs={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Xs={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}},Js={basic:{uniforms:Ws([Xs.common,Xs.specularmap,Xs.envmap,Xs.aomap,Xs.lightmap,Xs.fog]),vertexShader:Qs.meshbasic_vert,fragmentShader:Qs.meshbasic_frag},lambert:{uniforms:Ws([Xs.common,Xs.specularmap,Xs.envmap,Xs.aomap,Xs.lightmap,Xs.emissivemap,Xs.fog,Xs.lights,{emissive:{value:new Color(0)}}]),vertexShader:Qs.meshlambert_vert,fragmentShader:Qs.meshlambert_frag},phong:{uniforms:Ws([Xs.common,Xs.specularmap,Xs.envmap,Xs.aomap,Xs.lightmap,Xs.emissivemap,Xs.bumpmap,Xs.normalmap,Xs.displacementmap,Xs.fog,Xs.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:Qs.meshphong_vert,fragmentShader:Qs.meshphong_frag},standard:{uniforms:Ws([Xs.common,Xs.envmap,Xs.aomap,Xs.lightmap,Xs.emissivemap,Xs.bumpmap,Xs.normalmap,Xs.displacementmap,Xs.roughnessmap,Xs.metalnessmap,Xs.fog,Xs.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Qs.meshphysical_vert,fragmentShader:Qs.meshphysical_frag},toon:{uniforms:Ws([Xs.common,Xs.aomap,Xs.lightmap,Xs.emissivemap,Xs.bumpmap,Xs.normalmap,Xs.displacementmap,Xs.gradientmap,Xs.fog,Xs.lights,{emissive:{value:new Color(0)}}]),vertexShader:Qs.meshtoon_vert,fragmentShader:Qs.meshtoon_frag},matcap:{uniforms:Ws([Xs.common,Xs.bumpmap,Xs.normalmap,Xs.displacementmap,Xs.fog,{matcap:{value:null}}]),vertexShader:Qs.meshmatcap_vert,fragmentShader:Qs.meshmatcap_frag},points:{uniforms:Ws([Xs.points,Xs.fog]),vertexShader:Qs.points_vert,fragmentShader:Qs.points_frag},dashed:{uniforms:Ws([Xs.common,Xs.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Qs.linedashed_vert,fragmentShader:Qs.linedashed_frag},depth:{uniforms:Ws([Xs.common,Xs.displacementmap]),vertexShader:Qs.depth_vert,fragmentShader:Qs.depth_frag},normal:{uniforms:Ws([Xs.common,Xs.bumpmap,Xs.normalmap,Xs.displacementmap,{opacity:{value:1}}]),vertexShader:Qs.normal_vert,fragmentShader:Qs.normal_frag},sprite:{uniforms:Ws([Xs.sprite,Xs.fog]),vertexShader:Qs.sprite_vert,fragmentShader:Qs.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:Qs.background_vert,fragmentShader:Qs.background_frag},cube:{uniforms:Ws([Xs.envmap,{opacity:{value:1}}]),vertexShader:Qs.cube_vert,fragmentShader:Qs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Qs.equirect_vert,fragmentShader:Qs.equirect_frag},distanceRGBA:{uniforms:Ws([Xs.common,Xs.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Qs.distanceRGBA_vert,fragmentShader:Qs.distanceRGBA_frag},shadow:{uniforms:Ws([Xs.lights,Xs.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:Qs.shadow_vert,fragmentShader:Qs.shadow_frag}};function er(e,t,i,n,s){const r=new Color(0);let o,a,l=0,c=null,h=0,d=null;function u(e,t){i.buffers.color.setClear(e.r,e.g,e.b,t,s)}return{getClearColor:function(){return r},setClearColor:function(e,t=1){r.set(e),l=t,u(r,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,u(r,l)},render:function(i,s,p,f){let v=!0===s.isScene?s.background:null;v&&v.isTexture&&(v=t.get(v));const y=e.xr,b=y.getSession&&y.getSession();b&&"additive"===b.environmentBlendMode&&(v=null),null===v?u(r,l):v&&v.isColor&&(u(v,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.mapping===ce)?(void 0===a&&(a=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:zs(Js.cube.uniforms),vertexShader:Js.cube.vertexShader,fragmentShader:Js.cube.fragmentShader,side:g,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(a)),a.material.uniforms.envMap.value=v,a.material.uniforms.flipEnvMap.value=v.isCubeTexture&&v._needsFlipEnvMap?-1:1,c===v&&h===v.version&&d===e.toneMapping||(a.material.needsUpdate=!0,c=v,h=v.version,d=e.toneMapping),i.unshift(a,a.geometry,a.material,0,0,null)):v&&v.isTexture&&(void 0===o&&(o=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:zs(Js.background.uniforms),vertexShader:Js.background.vertexShader,fragmentShader:Js.background.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=v,!0===v.matrixAutoUpdate&&v.updateMatrix(),o.material.uniforms.uvTransform.value.copy(v.matrix),c===v&&h===v.version&&d===e.toneMapping||(o.material.needsUpdate=!0,c=v,h=v.version,d=e.toneMapping),i.unshift(o,o.geometry,o.material,0,0,null))}}}function tr(e,t,i,n){const s=e.getParameter(34921),r=n.isWebGL2?null:t.get("OES_vertex_array_object"),o=n.isWebGL2||null!==r,a={},l=u(null);let c=l;function h(t){return n.isWebGL2?e.bindVertexArray(t):r.bindVertexArrayOES(t)}function d(t){return n.isWebGL2?e.deleteVertexArray(t):r.deleteVertexArrayOES(t)}function u(e){const t=[],i=[],n=[];for(let e=0;e<s;e++)t[e]=0,i[e]=0,n[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:n,object:e,attributes:{},index:null}}function p(){const e=c.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function m(e){g(e,0)}function g(i,s){const r=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;if(r[i]=1,0===o[i]&&(e.enableVertexAttribArray(i),o[i]=1),a[i]!==s){(n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,s),a[i]=s}}function f(){const t=c.newAttributes,i=c.enabledAttributes;for(let n=0,s=i.length;n<s;n++)i[n]!==t[n]&&(e.disableVertexAttribArray(n),i[n]=0)}function v(t,i,s,r,o,a){!0!==n.isWebGL2||5124!==s&&5125!==s?e.vertexAttribPointer(t,i,s,r,o,a):e.vertexAttribIPointer(t,i,s,o,a)}function y(){b(),c!==l&&(c=l,h(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(s,l,d,y,b){let S=!1;if(o){const t=function(t,i,s){const o=!0===s.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[o];void 0===h&&(h=u(n.isWebGL2?e.createVertexArray():r.createVertexArrayOES()),c[o]=h);return h}(y,d,l);c!==t&&(c=t,h(c.object)),S=function(e,t){const i=c.attributes,n=e.attributes;let s=0;for(const e in n){const t=i[e],r=n[e];if(void 0===t)return!0;if(t.attribute!==r)return!0;if(t.data!==r.data)return!0;s++}return c.attributesNum!==s||c.index!==t}(y,b),S&&function(e,t){const i={},n=e.attributes;let s=0;for(const e in n){const t=n[e],r={};r.attribute=t,t.data&&(r.data=t.data),i[e]=r,s++}c.attributes=i,c.attributesNum=s,c.index=t}(y,b)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===d.id&&c.wireframe===e||(c.geometry=y.id,c.program=d.id,c.wireframe=e,S=!0)}!0===s.isInstancedMesh&&(S=!0),null!==b&&i.update(b,34963),S&&(!function(s,r,o,a){if(!1===n.isWebGL2&&(s.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,c=o.getAttributes(),h=r.defaultAttributeValues;for(const t in c){const n=c[t];if(n>=0){const r=l[t];if(void 0!==r){const t=r.normalized,s=r.itemSize,o=i.get(r);if(void 0===o)continue;const l=o.buffer,c=o.type,h=o.bytesPerElement;if(r.isInterleavedBufferAttribute){const i=r.data,o=i.stride,d=r.offset;i&&i.isInstancedInterleavedBuffer?(g(n,i.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)):m(n),e.bindBuffer(34962,l),v(n,s,c,t,o*h,d*h)}else r.isInstancedBufferAttribute?(g(n,r.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=r.meshPerAttribute*r.count)):m(n),e.bindBuffer(34962,l),v(n,s,c,t,0,0)}else if("instanceMatrix"===t){const t=i.get(s.instanceMatrix);if(void 0===t)continue;const r=t.buffer,o=t.type;g(n+0,1),g(n+1,1),g(n+2,1),g(n+3,1),e.bindBuffer(34962,r),e.vertexAttribPointer(n+0,4,o,!1,64,0),e.vertexAttribPointer(n+1,4,o,!1,64,16),e.vertexAttribPointer(n+2,4,o,!1,64,32),e.vertexAttribPointer(n+3,4,o,!1,64,48)}else if("instanceColor"===t){const t=i.get(s.instanceColor);if(void 0===t)continue;const r=t.buffer,o=t.type;g(n,1),e.bindBuffer(34962,r),e.vertexAttribPointer(n,3,o,!1,12,0)}else if(void 0!==h){const i=h[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:e.vertexAttrib1fv(n,i)}}}}f()}(s,l,d,y),null!==b&&e.bindBuffer(34963,i.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const i=t[e];for(const e in i)d(i[e].object),delete i[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const i=t[e];for(const e in i)d(i[e].object),delete i[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const i=a[t];if(void 0===i[e.id])continue;const n=i[e.id];for(const e in n)d(n[e].object),delete n[e];delete i[e.id]}},initAttributes:p,enableAttribute:m,disableUnusedAttributes:f}}function ir(e,t,i,n){const s=n.isWebGL2;let r;this.setMode=function(e){r=e},this.render=function(t,n){e.drawArrays(r,t,n),i.update(n,r,1)},this.renderInstances=function(n,o,a){if(0===a)return;let l,c;if(s)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](r,n,o,a),i.update(o,r,a)}}function nr(e,t,i){let n;function s(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const r="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let o=void 0!==i.precision?i.precision:"highp";const a=s(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=!0===i.logarithmicDepthBuffer,c=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),u=e.getParameter(34076),p=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),f=e.getParameter(36349),v=h>0,y=r||t.has("OES_texture_float");return{isWebGL2:r,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){const i=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:s,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:u,maxAttributes:p,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:f,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:r?e.getParameter(36183):0}}function sr(e){const t=this;let i=null,n=0,s=!1,r=!1;const o=new Plane,a=new Matrix3,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function h(e,i,n,s){const r=null!==e?e.length:0;let c=null;if(0!==r){if(c=l.value,!0!==s||null===c){const t=n+4*r,s=i.matrixWorldInverse;a.getNormalMatrix(s),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,i=n;t!==r;++t,i+=4)o.copy(e[t]).applyMatrix4(s,a),o.normal.toArray(c,i),c[i+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=r,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,r){const o=0!==e.length||t||0!==n||s;return s=t,i=h(e,r,0),n=e.length,o},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1,c()},this.setState=function(t,o,a){const d=t.clippingPlanes,u=t.clipIntersection,p=t.clipShadows,m=e.get(t);if(!s||null===d||0===d.length||r&&!p)r?h(null):c();else{const e=r?0:n,t=4*e;let s=m.clippingState||null;l.value=s,s=h(d,o,t,a);for(let e=0;e!==t;++e)s[e]=i[e];m.clippingState=s,this.numIntersection=u?this.numPlanes:0,this.numPlanes+=e}}}function rr(e){let t=new WeakMap;function i(e,t){return t===ae?e.mapping=re:t===le&&(e.mapping=oe),e}function n(e){const i=e.target;i.removeEventListener("dispose",n);const s=t.get(i);void 0!==s&&(t.delete(i),s.dispose())}return{get:function(s){if(s&&s.isTexture){const r=s.mapping;if(r===ae||r===le){if(t.has(s)){return i(t.get(s).texture,s.mapping)}{const r=s.image;if(r&&r.height>0){const o=e.getRenderTarget(),a=new WebGLCubeRenderTarget(r.height/2);return a.fromEquirectangularTexture(e,s),t.set(s,a),e.setRenderTarget(o),s.addEventListener("dispose",n),i(a.texture,s.mapping)}return null}}}return s},dispose:function(){t=new WeakMap}}}function or(e){const t={};function i(i){if(void 0!==t[i])return t[i];let n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float")},get:function(e){const t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function ar(e,t,i,n){const s={},r=new WeakMap;function o(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);a.removeEventListener("dispose",o),delete s[a.id];const l=r.get(a);l&&(t.remove(l),r.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(e){const i=[],n=e.index,s=e.attributes.position;let o=0;if(null!==n){const e=n.array;o=n.version;for(let t=0,n=e.length;t<n;t+=3){const n=e[t+0],s=e[t+1],r=e[t+2];i.push(n,s,s,r,r,n)}}else{const e=s.array;o=s.version;for(let t=0,n=e.length/3-1;t<n;t+=3){const e=t+0,n=t+1,s=t+2;i.push(e,n,n,s,s,e)}}const a=new(gs(i)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(i,1);a.version=o;const l=r.get(e);l&&t.remove(l),r.set(e,a)}return{get:function(e,t){return!0===s[t.id]||(t.addEventListener("dispose",o),s[t.id]=!0,i.memory.geometries++),t},update:function(e){const i=e.attributes;for(const e in i)t.update(i[e],34962);const n=e.morphAttributes;for(const e in n){const i=n[e];for(let e=0,n=i.length;e<n;e++)t.update(i[e],34962)}},getWireframeAttribute:function(e){const t=r.get(e);if(t){const i=e.index;null!==i&&t.version<i.version&&a(e)}else a(e);return r.get(e)}}}function lr(e,t,i,n){const s=n.isWebGL2;let r,o,a;this.setMode=function(e){r=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,n){e.drawElements(r,n,o,t*a),i.update(n,r,1)},this.renderInstances=function(n,l,c){if(0===c)return;let h,d;if(s)h=e,d="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[d](r,l,o,n*a,c),i.update(l,r,c)}}function cr(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,n){switch(t.calls++,i){case 4:t.triangles+=n*(e/3);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function hr(e,t){return e[0]-t[0]}function dr(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ur(e){const t={},i=new Float32Array(8),n=[];for(let e=0;e<8;e++)n[e]=[e,0];return{update:function(s,r,o,a){const l=s.morphTargetInfluences,c=void 0===l?0:l.length;let h=t[r.id];if(void 0===h){h=[];for(let e=0;e<c;e++)h[e]=[e,0];t[r.id]=h}for(let e=0;e<c;e++){const t=h[e];t[0]=e,t[1]=l[e]}h.sort(dr);for(let e=0;e<8;e++)e<c&&h[e][1]?(n[e][0]=h[e][0],n[e][1]=h[e][1]):(n[e][0]=Number.MAX_SAFE_INTEGER,n[e][1]=0);n.sort(hr);const d=o.morphTargets&&r.morphAttributes.position,u=o.morphNormals&&r.morphAttributes.normal;let p=0;for(let e=0;e<8;e++){const t=n[e],s=t[0],o=t[1];s!==Number.MAX_SAFE_INTEGER&&o?(d&&r.getAttribute("morphTarget"+e)!==d[s]&&r.setAttribute("morphTarget"+e,d[s]),u&&r.getAttribute("morphNormal"+e)!==u[s]&&r.setAttribute("morphNormal"+e,u[s]),i[e]=o,p+=o):(d&&!0===r.hasAttribute("morphTarget"+e)&&r.deleteAttribute("morphTarget"+e),u&&!0===r.hasAttribute("morphNormal"+e)&&r.deleteAttribute("morphNormal"+e),i[e]=0)}const m=r.morphTargetsRelative?1:1-p;a.getUniforms().setValue(e,"morphTargetBaseInfluence",m),a.getUniforms().setValue(e,"morphTargetInfluences",i)}}}function pr(e,t,i,n){let s=new WeakMap;function r(e){const t=e.target;t.removeEventListener("dispose",r),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){const o=n.render.frame,a=e.geometry,l=t.get(e,a);return s.get(l)!==o&&(t.update(l),s.set(l,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",r)&&e.addEventListener("dispose",r),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l},dispose:function(){s=new WeakMap}}}Js.physical={uniforms:Ws([Js.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Color(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Qs.meshphysical_vert,fragmentShader:Qs.meshphysical_frag};class DataTexture2DArray extends Texture{constructor(e=null,t=1,i=1,n=1){super(null),this.image={data:e,width:t,height:i,depth:n},this.magFilter=me,this.minFilter=me,this.wrapR=ue,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture2DArray.prototype.isDataTexture2DArray=!0;class DataTexture3D extends Texture{constructor(e=null,t=1,i=1,n=1){super(null),this.image={data:e,width:t,height:i,depth:n},this.magFilter=me,this.minFilter=me,this.wrapR=ue,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture3D.prototype.isDataTexture3D=!0;const mr=new Texture,gr=new DataTexture2DArray,fr=new DataTexture3D,vr=new CubeTexture,yr=[],br=[],Sr=new Float32Array(16),Er=new Float32Array(9),wr=new Float32Array(4);function Tr(e,t,i){const n=e[0];if(n<=0||n>0)return e;const s=t*i;let r=yr[s];if(void 0===r&&(r=new Float32Array(s),yr[s]=r),0!==t){n.toArray(r,0);for(let n=1,s=0;n!==t;++n)s+=i,e[n].toArray(r,s)}return r}function _r(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function Mr(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function xr(e,t){let i=br[t];void 0===i&&(i=new Int32Array(t),br[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function Ar(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Or(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(_r(i,t))return;e.uniform2fv(this.addr,t),Mr(i,t)}}function Pr(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(_r(i,t))return;e.uniform3fv(this.addr,t),Mr(i,t)}}function Dr(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(_r(i,t))return;e.uniform4fv(this.addr,t),Mr(i,t)}}function Cr(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(_r(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Mr(i,t)}else{if(_r(i,n))return;wr.set(n),e.uniformMatrix2fv(this.addr,!1,wr),Mr(i,n)}}function Ir(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(_r(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Mr(i,t)}else{if(_r(i,n))return;Er.set(n),e.uniformMatrix3fv(this.addr,!1,Er),Mr(i,n)}}function Lr(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(_r(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Mr(i,t)}else{if(_r(i,n))return;Sr.set(n),e.uniformMatrix4fv(this.addr,!1,Sr),Mr(i,n)}}function Rr(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function Nr(e,t){const i=this.cache;_r(i,t)||(e.uniform2iv(this.addr,t),Mr(i,t))}function kr(e,t){const i=this.cache;_r(i,t)||(e.uniform3iv(this.addr,t),Mr(i,t))}function Br(e,t){const i=this.cache;_r(i,t)||(e.uniform4iv(this.addr,t),Mr(i,t))}function Fr(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function Ur(e,t){const i=this.cache;_r(i,t)||(e.uniform2uiv(this.addr,t),Mr(i,t))}function Vr(e,t){const i=this.cache;_r(i,t)||(e.uniform3uiv(this.addr,t),Mr(i,t))}function Hr(e,t){const i=this.cache;_r(i,t)||(e.uniform4uiv(this.addr,t),Mr(i,t))}function Gr(e,t,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(e.uniform1i(this.addr,s),n[0]=s),i.safeSetTexture2D(t||mr,s)}function zr(e,t,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(e.uniform1i(this.addr,s),n[0]=s),i.setTexture3D(t||fr,s)}function Wr(e,t,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(e.uniform1i(this.addr,s),n[0]=s),i.safeSetTextureCube(t||vr,s)}function jr(e,t,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(e.uniform1i(this.addr,s),n[0]=s),i.setTexture2DArray(t||gr,s)}function Kr(e,t){e.uniform1fv(this.addr,t)}function qr(e,t){const i=Tr(t,this.size,2);e.uniform2fv(this.addr,i)}function Zr(e,t){const i=Tr(t,this.size,3);e.uniform3fv(this.addr,i)}function Yr(e,t){const i=Tr(t,this.size,4);e.uniform4fv(this.addr,i)}function $r(e,t){const i=Tr(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function Qr(e,t){const i=Tr(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function Xr(e,t){const i=Tr(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Jr(e,t){e.uniform1iv(this.addr,t)}function eo(e,t){e.uniform2iv(this.addr,t)}function to(e,t){e.uniform3iv(this.addr,t)}function io(e,t){e.uniform4iv(this.addr,t)}function no(e,t){e.uniform1uiv(this.addr,t)}function so(e,t){e.uniform2uiv(this.addr,t)}function ro(e,t){e.uniform3uiv(this.addr,t)}function oo(e,t){e.uniform4uiv(this.addr,t)}function ao(e,t,i){const n=t.length,s=xr(i,n);e.uniform1iv(this.addr,s);for(let e=0;e!==n;++e)i.safeSetTexture2D(t[e]||mr,s[e])}function lo(e,t,i){const n=t.length,s=xr(i,n);e.uniform1iv(this.addr,s);for(let e=0;e!==n;++e)i.safeSetTextureCube(t[e]||vr,s[e])}function co(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Ar;case 35664:return Or;case 35665:return Pr;case 35666:return Dr;case 35674:return Cr;case 35675:return Ir;case 35676:return Lr;case 5124:case 35670:return Rr;case 35667:case 35671:return Nr;case 35668:case 35672:return kr;case 35669:case 35673:return Br;case 5125:return Fr;case 36294:return Ur;case 36295:return Vr;case 36296:return Hr;case 35678:case 36198:case 36298:case 36306:case 35682:return Gr;case 35679:case 36299:case 36307:return zr;case 35680:case 36300:case 36308:case 36293:return Wr;case 36289:case 36303:case 36311:case 36292:return jr}}(t.type)}function ho(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Kr;case 35664:return qr;case 35665:return Zr;case 35666:return Yr;case 35674:return $r;case 35675:return Qr;case 35676:return Xr;case 5124:case 35670:return Jr;case 35667:case 35671:return eo;case 35668:case 35672:return to;case 35669:case 35673:return io;case 5125:return no;case 36294:return so;case 36295:return ro;case 36296:return oo;case 35678:case 36198:case 36298:case 36306:case 35682:return ao;case 35680:case 36300:case 36308:case 36293:return lo}}(t.type)}function uo(e){this.id=e,this.seq=[],this.map={}}ho.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Mr(t,e)},uo.prototype.setValue=function(e,t,i){const n=this.seq;for(let s=0,r=n.length;s!==r;++s){const r=n[s];r.setValue(e,t[r.id],i)}};const po=/(\w+)(\])?(\[|\.)?/g;function mo(e,t){e.seq.push(t),e.map[t.id]=t}function go(e,t,i){const n=e.name,s=n.length;for(po.lastIndex=0;;){const r=po.exec(n),o=po.lastIndex;let a=r[1];const l="]"===r[2],c=r[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===s){mo(i,void 0===c?new co(a,e,t):new ho(a,e,t));break}{let e=i.map[a];void 0===e&&(e=new uo(a),mo(i,e)),i=e}}}function fo(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let n=0;n<i;++n){const i=e.getActiveUniform(t,n);go(i,e.getUniformLocation(t,i.name),this)}}function vo(e,t,i){const n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}fo.prototype.setValue=function(e,t,i,n){const s=this.map[t];void 0!==s&&s.setValue(e,i,n)},fo.prototype.setOptional=function(e,t,i){const n=t[i];void 0!==n&&this.setValue(e,i,n)},fo.upload=function(e,t,i,n){for(let s=0,r=t.length;s!==r;++s){const r=t[s],o=i[r.id];!1!==o.needsUpdate&&r.setValue(e,o.value,n)}},fo.seqWithValue=function(e,t){const i=[];for(let n=0,s=e.length;n!==s;++n){const s=e[n];s.id in t&&i.push(s)}return i};let yo=0;function bo(e){switch(e){case $t:return["Linear","( value )"];case Qt:return["sRGB","( value )"];case Jt:return["RGBE","( value )"];case ti:return["RGBM","( value, 7.0 )"];case ii:return["RGBM","( value, 16.0 )"];case ni:return["RGBD","( value, 256.0 )"];case Xt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case ei:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function So(e,t,i){const n=e.getShaderParameter(t,35713),s=e.getShaderInfoLog(t).trim();if(n&&""===s)return"";return"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+s+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function Eo(e,t){const i=bo(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function wo(e,t){const i=bo(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function To(e,t){let i;switch(t){case J:i="Linear";break;case ee:i="Reinhard";break;case te:i="OptimizedCineon";break;case ie:i="ACESFilmic";break;case ne:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function _o(e){return""!==e}function Mo(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function xo(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Ao=/^[ \t]*#include +<([\w\d./]+)>/gm;function Oo(e){return e.replace(Ao,Po)}function Po(e,t){const i=Qs[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return Oo(i)}const Do=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Co=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Io(e){return e.replace(Co,Ro).replace(Do,Lo)}function Lo(e,t,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Ro(e,t,i,n)}function Ro(e,t,i,n){let s="";for(let e=parseInt(t);e<parseInt(i);e++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return s}function No(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function ko(e,t,i,n){const s=e.getContext(),r=i.defines;let o=i.vertexShader,a=i.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===d?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===u?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===p&&(t="SHADOWMAP_TYPE_VSM"),t}(i),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case re:case oe:t="ENVMAP_TYPE_CUBE";break;case ce:case he:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),h=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case oe:case he:t="ENVMAP_MODE_REFRACTION"}return t}(i),m=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Y:t="ENVMAP_BLENDING_MULTIPLY";break;case $:t="ENVMAP_BLENDING_MIX";break;case Q:t="ENVMAP_BLENDING_ADD"}return t}(i),g=e.gammaFactor>0?e.gammaFactor:1,f=i.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(_o).join("\n")}(i),v=function(e){const t=[];for(const i in e){const n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(r),y=s.createProgram();let b,S,E=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(b=[v].filter(_o).join("\n"),b.length>0&&(b+="\n"),S=[f,v].filter(_o).join("\n"),S.length>0&&(S+="\n")):(b=[No(i),"#define SHADER_NAME "+i.shaderName,v,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(_o).join("\n"),S=[f,No(i),"#define SHADER_NAME "+i.shaderName,v,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+g,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+m:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==X?"#define TONE_MAPPING":"",i.toneMapping!==X?Qs.tonemapping_pars_fragment:"",i.toneMapping!==X?To("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",Qs.encodings_pars_fragment,i.map?Eo("mapTexelToLinear",i.mapEncoding):"",i.matcap?Eo("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?Eo("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?Eo("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?Eo("lightMapTexelToLinear",i.lightMapEncoding):"",wo("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(_o).join("\n")),o=Oo(o),o=Mo(o,i),o=xo(o,i),a=Oo(a),a=Mo(a,i),a=xo(a,i),o=Io(o),a=Io(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(E="#version 300 es\n",b=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+b,S=["#define varying in",i.glslVersion===Ri?"":"out highp vec4 pc_fragColor;",i.glslVersion===Ri?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+S);const w=E+S+a,T=vo(s,35633,E+b+o),_=vo(s,35632,w);if(s.attachShader(y,T),s.attachShader(y,_),void 0!==i.index0AttributeName?s.bindAttribLocation(y,0,i.index0AttributeName):!0===i.morphTargets&&s.bindAttribLocation(y,0,"position"),s.linkProgram(y),e.debug.checkShaderErrors){const e=s.getProgramInfoLog(y).trim(),t=s.getShaderInfoLog(T).trim(),i=s.getShaderInfoLog(_).trim();let n=!0,r=!0;if(!1===s.getProgramParameter(y,35714)){n=!1;const t=So(s,T,"vertex"),i=So(s,_,"fragment");console.error("THREE.WebGLProgram: shader error: ",s.getError(),"35715",s.getProgramParameter(y,35715),"gl.getProgramInfoLog",e,t,i)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==i||(r=!1);r&&(this.diagnostics={runnable:n,programLog:e,vertexShader:{log:t,prefix:b},fragmentShader:{log:i,prefix:S}})}let M,x;return s.deleteShader(T),s.deleteShader(_),this.getUniforms=function(){return void 0===M&&(M=new fo(s,y)),M},this.getAttributes=function(){return void 0===x&&(x=function(e,t){const i={},n=e.getProgramParameter(t,35721);for(let s=0;s<n;s++){const n=e.getActiveAttrib(t,s).name;i[n]=e.getAttribLocation(t,n)}return i}(s,y)),x},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(y),this.program=void 0},this.name=i.shaderName,this.id=yo++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=T,this.fragmentShader=_,this}function Bo(e,t,i,n,s,r){const o=[],a=n.isWebGL2,l=n.logarithmicDepthBuffer,c=n.floatVertexTextures,h=n.maxVertexUniforms,d=n.vertexTextures;let u=n.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},m=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function v(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=$t,t}return{getParameters:function(s,o,m,y,b){const S=y.fog,E=s.isMeshStandardMaterial?y.environment:null,w=t.get(s.envMap||E),T=p[s.type],_=b.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(c)return 1024;{const e=h,i=Math.floor((e-20)/4),n=Math.min(i,t.length);return n<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+n+"."),0):n}}(b):0;let M,x;if(null!==s.precision&&(u=n.getMaxPrecision(s.precision),u!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",u,"instead.")),T){const e=Js[T];M=e.vertexShader,x=e.fragmentShader}else M=s.vertexShader,x=s.fragmentShader;const A=e.getRenderTarget();return{isWebGL2:a,shaderID:T,shaderName:s.type,vertexShader:M,fragmentShader:x,defines:s.defines,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:u,instancing:!0===b.isInstancedMesh,instancingColor:!0===b.isInstancedMesh&&null!==b.instanceColor,supportsVertexTextures:d,outputEncoding:null!==A?v(A.texture):e.outputEncoding,map:!!s.map,mapEncoding:v(s.map),matcap:!!s.matcap,matcapEncoding:v(s.matcap),envMap:!!w,envMapMode:w&&w.mapping,envMapEncoding:v(w),envMapCubeUV:!!w&&(w.mapping===ce||w.mapping===he),lightMap:!!s.lightMap,lightMapEncoding:v(s.lightMap),aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,emissiveMapEncoding:v(s.emissiveMap),bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:s.normalMapType===ai,tangentSpaceNormalMap:s.normalMapType===oi,clearcoatMap:!!s.clearcoatMap,clearcoatRoughnessMap:!!s.clearcoatRoughnessMap,clearcoatNormalMap:!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,alphaMap:!!s.alphaMap,gradientMap:!!s.gradientMap,sheen:!!s.sheen,transmissionMap:!!s.transmissionMap,combine:s.combine,vertexTangents:s.normalMap&&s.vertexTangents,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&b.geometry&&b.geometry.attributes.color&&4===b.geometry.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.displacementMap||s.transmissionMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmissionMap||!s.displacementMap),fog:!!S,useFog:s.fog,fogExp2:S&&S.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:l,skinning:s.skinning&&_>0,maxBones:_,useVertexTexture:c,morphTargets:s.morphTargets,morphNormals:s.morphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:r.numPlanes,numClipIntersection:r.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&m.length>0,shadowMapType:e.shadowMap.type,toneMapping:s.toneMapped?e.toneMapping:X,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,alphaTest:s.alphaTest,doubleSided:s.side===f,flipSided:s.side===g,depthPacking:void 0!==s.depthPacking&&s.depthPacking,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||i.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){const i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)i.push(e),i.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<m.length;e++)i.push(t[m[e]]);i.push(e.outputEncoding),i.push(e.gammaFactor)}return i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){const t=p[e.type];let i;if(t){const e=Js[t];i=js.clone(e.uniforms)}else i=e.uniforms;return i},acquireProgram:function(t,i){let n;for(let e=0,t=o.length;e<t;e++){const t=o[e];if(t.cacheKey===i){n=t,++n.usedTimes;break}}return void 0===n&&(n=new ko(e,i,t,s),o.push(n)),n},releaseProgram:function(e){if(0==--e.usedTimes){const t=o.indexOf(e);o[t]=o[o.length-1],o.pop(),e.destroy()}},programs:o}}function Fo(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function Uo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Vo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ho(e){const t=[];let i=0;const n=[],s=[],r={id:-1};function o(n,s,o,a,l,c){let h=t[i];const d=e.get(o);return void 0===h?(h={id:n.id,object:n,geometry:s,material:o,program:d.program||r,groupOrder:a,renderOrder:n.renderOrder,z:l,group:c},t[i]=h):(h.id=n.id,h.object=n,h.geometry=s,h.material=o,h.program=d.program||r,h.groupOrder=a,h.renderOrder=n.renderOrder,h.z=l,h.group=c),i++,h}return{opaque:n,transparent:s,init:function(){i=0,n.length=0,s.length=0},push:function(e,t,i,r,a,l){const c=o(e,t,i,r,a,l);(!0===i.transparent?s:n).push(c)},unshift:function(e,t,i,r,a,l){const c=o(e,t,i,r,a,l);(!0===i.transparent?s:n).unshift(c)},finish:function(){for(let e=i,n=t.length;e<n;e++){const i=t[e];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Uo),s.length>1&&s.sort(t||Vo)}}}function Go(e){let t=new WeakMap;return{get:function(i,n){let s;return!1===t.has(i)?(s=new Ho(e),t.set(i,[s])):n>=t.get(i).length?(s=new Ho(e),t.get(i).push(s)):s=t.get(i)[n],s},dispose:function(){t=new WeakMap}}}function zo(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new Vector3,color:new Color};break;case"SpotLight":i={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":i={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return e[t.id]=i,i}}}let Wo=0;function jo(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Ko(e,t){const i=new zo,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)s.probe.push(new Vector3);const r=new Vector3,o=new Matrix4,a=new Matrix4;return{setup:function(r){let o=0,a=0,l=0;for(let e=0;e<9;e++)s.probe[e].set(0,0,0);let c=0,h=0,d=0,u=0,p=0,m=0,g=0,f=0;r.sort(jo);for(let e=0,t=r.length;e<t;e++){const t=r[e],v=t.color,y=t.intensity,b=t.distance,S=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=v.r*y,a+=v.g*y,l+=v.b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)s.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,s.directionalShadow[c]=i,s.directionalShadowMap[c]=S,s.directionalShadowMatrix[c]=t.shadow.matrix,m++}s.directional[c]=e,c++}else if(t.isSpotLight){const e=i.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(v).multiplyScalar(y),e.distance=b,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,s.spotShadow[d]=i,s.spotShadowMap[d]=S,s.spotShadowMatrix[d]=t.shadow.matrix,f++}s.spot[d]=e,d++}else if(t.isRectAreaLight){const e=i.get(t);e.color.copy(v).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),s.rectArea[u]=e,u++}else if(t.isPointLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,s.pointShadow[h]=i,s.pointShadowMap[h]=S,s.pointShadowMatrix[h]=t.shadow.matrix,g++}s.point[h]=e,h++}else if(t.isHemisphereLight){const e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(y),e.groundColor.copy(t.groundColor).multiplyScalar(y),s.hemi[p]=e,p++}}u>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(s.rectAreaLTC1=Xs.LTC_FLOAT_1,s.rectAreaLTC2=Xs.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(s.rectAreaLTC1=Xs.LTC_HALF_1,s.rectAreaLTC2=Xs.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=o,s.ambient[1]=a,s.ambient[2]=l;const v=s.hash;v.directionalLength===c&&v.pointLength===h&&v.spotLength===d&&v.rectAreaLength===u&&v.hemiLength===p&&v.numDirectionalShadows===m&&v.numPointShadows===g&&v.numSpotShadows===f||(s.directional.length=c,s.spot.length=d,s.rectArea.length=u,s.point.length=h,s.hemi.length=p,s.directionalShadow.length=m,s.directionalShadowMap.length=m,s.pointShadow.length=g,s.pointShadowMap.length=g,s.spotShadow.length=f,s.spotShadowMap.length=f,s.directionalShadowMatrix.length=m,s.pointShadowMatrix.length=g,s.spotShadowMatrix.length=f,v.directionalLength=c,v.pointLength=h,v.spotLength=d,v.rectAreaLength=u,v.hemiLength=p,v.numDirectionalShadows=m,v.numPointShadows=g,v.numSpotShadows=f,s.version=Wo++)},setupView:function(e,t){let i=0,n=0,l=0,c=0,h=0;const d=t.matrixWorldInverse;for(let t=0,u=e.length;t<u;t++){const u=e[t];if(u.isDirectionalLight){const e=s.directional[i];e.direction.setFromMatrixPosition(u.matrixWorld),r.setFromMatrixPosition(u.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(d),i++}else if(u.isSpotLight){const e=s.spot[l];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(u.matrixWorld),r.setFromMatrixPosition(u.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(d),l++}else if(u.isRectAreaLight){const e=s.rectArea[c];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),a.identity(),o.copy(u.matrixWorld),o.premultiply(d),a.extractRotation(o),e.halfWidth.set(.5*u.width,0,0),e.halfHeight.set(0,.5*u.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(u.isPointLight){const e=s.point[n];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),n++}else if(u.isHemisphereLight){const e=s.hemi[h];e.direction.setFromMatrixPosition(u.matrixWorld),e.direction.transformDirection(d),e.direction.normalize(),h++}}},state:s}}function qo(e,t){const i=new Ko(e,t),n=[],s=[];return{init:function(){n.length=0,s.length=0},state:{lightsArray:n,shadowsArray:s,lights:i},setupLights:function(){i.setup(n)},setupLightsView:function(e){i.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){s.push(e)}}}function Zo(e,t){let i=new WeakMap;return{get:function(n,s=0){let r;return!1===i.has(n)?(r=new qo(e,t),i.set(n,[r])):s>=i.get(n).length?(r=new qo(e,t),i.get(n).push(r)):r=i.get(n)[s],r},dispose:function(){i=new WeakMap}}}class MeshDepthMaterial extends os{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=si,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}MeshDepthMaterial.prototype.isMeshDepthMaterial=!0;class MeshDistanceMaterial extends os{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0;function Yo(e,t,i){let n=new Frustum;const s=new Vector2,r=new Vector2,o=new Vector4,a=[],l=[],c={},h=i.maxTextureSize,u={0:g,1:m,2:f},v=new ShaderMaterial({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),y=v.clone();y.defines.HORIZONTAL_PASS=1;const S=new BufferGeometry;S.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const E=new Mesh(S,v),w=this;function T(i,n){const s=t.update(E);v.uniforms.shadow_pass.value=i.map.texture,v.uniforms.resolution.value=i.mapSize,v.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,s,v,E,null),y.uniforms.shadow_pass.value=i.mapPass.texture,y.uniforms.resolution.value=i.mapSize,y.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,s,y,E,null)}function _(e,t,i){const n=e<<0|t<<1|i<<2;let s=a[n];return void 0===s&&(s=new MeshDepthMaterial({depthPacking:ri,morphTargets:e,skinning:t}),a[n]=s),s}function M(e,t,i){const n=e<<0|t<<1|i<<2;let s=l[n];return void 0===s&&(s=new MeshDistanceMaterial({morphTargets:e,skinning:t}),l[n]=s),s}function x(t,i,n,s,r,o,a){let l=null,h=_,d=t.customDepthMaterial;if(!0===s.isPointLight&&(h=M,d=t.customDistanceMaterial),void 0===d){let e=!1;!0===n.morphTargets&&(e=i.morphAttributes&&i.morphAttributes.position&&i.morphAttributes.position.length>0);let s=!1;!0===t.isSkinnedMesh&&(!0===n.skinning?s=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t));l=h(e,s,!0===t.isInstancedMesh)}else l=d;if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){const e=l.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let s=i[t];void 0===s&&(s=l.clone(),i[t]=s),l=s}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=a===p?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:u[n.side],l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,!0===s.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(s.matrixWorld),l.nearDistance=r,l.farDistance=o),l}function A(i,s,r,o,a){if(!1===i.visible)return;if(i.layers.test(s.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&a===p)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,i.matrixWorld);const n=t.update(i),s=i.material;if(Array.isArray(s)){const t=n.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=s[c.materialIndex];if(h&&h.visible){const t=x(i,n,h,o,r.near,r.far,a);e.renderBufferDirect(r,null,n,t,i,c)}}}else if(s.visible){const t=x(i,n,s,o,r.near,r.far,a);e.renderBufferDirect(r,null,n,t,i,null)}}const l=i.children;for(let e=0,t=l.length;e<t;e++)A(l[e],s,r,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=d,this.render=function(t,i,a){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),u=e.state;u.setBlending(b),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);for(let l=0,c=t.length;l<c;l++){const c=t[l],d=c.shadow;if(void 0===d){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===d.autoUpdate&&!1===d.needsUpdate)continue;s.copy(d.mapSize);const m=d.getFrameExtents();if(s.multiply(m),r.copy(d.mapSize),(s.x>h||s.y>h)&&(s.x>h&&(r.x=Math.floor(h/m.x),s.x=r.x*m.x,d.mapSize.x=r.x),s.y>h&&(r.y=Math.floor(h/m.y),s.y=r.y*m.y,d.mapSize.y=r.y)),null===d.map&&!d.isPointLightShadow&&this.type===p){const e={minFilter:be,magFilter:be,format:Fe};d.map=new WebGLRenderTarget(s.x,s.y,e),d.map.texture.name=c.name+".shadowMap",d.mapPass=new WebGLRenderTarget(s.x,s.y,e),d.camera.updateProjectionMatrix()}if(null===d.map){const e={minFilter:me,magFilter:me,format:Fe};d.map=new WebGLRenderTarget(s.x,s.y,e),d.map.texture.name=c.name+".shadowMap",d.camera.updateProjectionMatrix()}e.setRenderTarget(d.map),e.clear();const g=d.getViewportCount();for(let e=0;e<g;e++){const t=d.getViewport(e);o.set(r.x*t.x,r.y*t.y,r.x*t.z,r.y*t.w),u.viewport(o),d.updateMatrices(c,e),n=d.getFrustum(),A(i,a,d.camera,c,this.type)}d.isPointLightShadow||this.type!==p||T(d,a),d.needsUpdate=!1}w.needsUpdate=!1,e.setRenderTarget(l,c,d)}}function $o(e,t,i){const n=i.isWebGL2;const s=new function(){let t=!1;const i=new Vector4;let n=null;const s=new Vector4(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,r,o,a){!0===a&&(t*=o,n*=o,r*=o),i.set(t,n,r,o),!1===s.equals(i)&&(e.clearColor(t,n,r,o),s.copy(i))},reset:function(){t=!1,n=null,s.set(-1,0,0,0)}}},r=new function(){let t=!1,i=null,n=null,s=null;return{setTest:function(e){e?fe(2929):ve(2929)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case H:e.depthFunc(512);break;case G:e.depthFunc(519);break;case z:e.depthFunc(513);break;case W:e.depthFunc(515);break;case j:e.depthFunc(514);break;case K:e.depthFunc(518);break;case q:e.depthFunc(516);break;case Z:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){s!==t&&(e.clearDepth(t),s=t)},reset:function(){t=!1,i=null,n=null,s=null}}},c=new function(){let t=!1,i=null,n=null,s=null,r=null,o=null,a=null,l=null,c=null;return{setTest:function(e){t||(e?fe(2960):ve(2960))},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,o){n===t&&s===i&&r===o||(e.stencilFunc(t,i,o),n=t,s=i,r=o)},setOp:function(t,i,n){o===t&&a===i&&l===n||(e.stencilOp(t,i,n),o=t,a=i,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,n=null,s=null,r=null,o=null,a=null,l=null,c=null}}};let h={},d=null,u={},p=null,m=!1,v=null,y=null,Y=null,$=null,Q=null,X=null,J=null,ee=!1,te=null,ie=null,ne=null,se=null,re=null;const oe=e.getParameter(35661);let ae=!1,le=0;const ce=e.getParameter(7938);-1!==ce.indexOf("WebGL")?(le=parseFloat(/^WebGL (\d)/.exec(ce)[1]),ae=le>=1):-1!==ce.indexOf("OpenGL ES")&&(le=parseFloat(/^OpenGL ES (\d)/.exec(ce)[1]),ae=le>=2);let he=null,de={};const ue=new Vector4(0,0,e.canvas.width,e.canvas.height),pe=new Vector4(0,0,e.canvas.width,e.canvas.height);function me(t,i,n){const s=new Uint8Array(4),r=e.createTexture();e.bindTexture(t,r),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<n;t++)e.texImage2D(i+t,0,6408,1,1,0,6408,5121,s);return r}const ge={};function fe(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function ve(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}ge[3553]=me(3553,3553,1),ge[34067]=me(34067,34069,6),s.setClear(0,0,0,1),r.setClear(1),c.setClear(0),fe(2929),r.setFunc(W),Ee(!1),we(a),fe(2884),Se(b);const ye={[M]:32774,[x]:32778,[A]:32779};if(n)ye[O]=32775,ye[P]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(ye[O]=e.MIN_EXT,ye[P]=e.MAX_EXT)}const be={[D]:0,[C]:1,[I]:768,[R]:770,[V]:776,[F]:774,[k]:772,[L]:769,[N]:771,[U]:775,[B]:773};function Se(t,i,n,s,r,o,a,l){if(t!==b){if(!1===m&&(fe(3042),m=!0),t===_)r=r||i,o=o||n,a=a||s,i===y&&r===Q||(e.blendEquationSeparate(ye[i],ye[r]),y=i,Q=r),n===Y&&s===$&&o===X&&a===J||(e.blendFuncSeparate(be[n],be[s],be[o],be[a]),Y=n,$=s,X=o,J=a),v=t,ee=null;else if(t!==v||l!==ee){if(y===M&&Q===M||(e.blendEquation(32774),y=M,Q=M),l)switch(t){case S:e.blendFuncSeparate(1,771,1,771);break;case E:e.blendFunc(1,1);break;case w:e.blendFuncSeparate(0,0,769,771);break;case T:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case S:e.blendFuncSeparate(770,771,1,771);break;case E:e.blendFunc(770,1);break;case w:e.blendFunc(0,769);break;case T:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Y=null,$=null,X=null,J=null,v=t,ee=l}}else!0===m&&(ve(3042),m=!1)}function Ee(t){te!==t&&(t?e.frontFace(2304):e.frontFace(2305),te=t)}function we(t){t!==o?(fe(2884),t!==ie&&(t===a?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):ve(2884),ie=t}function Te(t,i,n){t?(fe(32823),se===i&&re===n||(e.polygonOffset(i,n),se=i,re=n)):ve(32823)}function _e(t){void 0===t&&(t=33984+oe-1),he!==t&&(e.activeTexture(t),he=t)}return{buffers:{color:s,depth:r,stencil:c},enable:fe,disable:ve,bindFramebuffer:function(t,i){null===i&&null!==d&&(i=d),u[t]!==i&&(e.bindFramebuffer(t,i),u[t]=i,n&&(36009===t&&(u[36160]=i),36160===t&&(u[36009]=i)))},bindXRFramebuffer:function(t){t!==d&&(e.bindFramebuffer(36160,t),d=t)},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:Se,setMaterial:function(e,t){e.side===f?ve(2884):fe(2884);let i=e.side===g;t&&(i=!i),Ee(i),e.blending===S&&!1===e.transparent?Se(b):Se(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),r.setFunc(e.depthFunc),r.setTest(e.depthTest),r.setMask(e.depthWrite),s.setMask(e.colorWrite);const n=e.stencilWrite;c.setTest(n),n&&(c.setMask(e.stencilWriteMask),c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Te(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?fe(32926):ve(32926)},setFlipSided:Ee,setCullFace:we,setLineWidth:function(t){t!==ne&&(ae&&e.lineWidth(t),ne=t)},setPolygonOffset:Te,setScissorTest:function(e){e?fe(3089):ve(3089)},activeTexture:_e,bindTexture:function(t,i){null===he&&_e();let n=de[he];void 0===n&&(n={type:void 0,texture:void 0},de[he]=n),n.type===t&&n.texture===i||(e.bindTexture(t,i||ge[t]),n.type=t,n.texture=i)},unbindTexture:function(){const t=de[he];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===ue.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),ue.copy(t))},viewport:function(t){!1===pe.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),pe.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===n&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),h={},he=null,de={},d=null,u={},p=null,m=!1,v=null,y=null,Y=null,$=null,Q=null,X=null,J=null,ee=!1,te=null,ie=null,ne=null,se=null,re=null,ue.set(0,0,e.canvas.width,e.canvas.height),pe.set(0,0,e.canvas.width,e.canvas.height),s.reset(),r.reset(),c.reset()}}}function Qo(e,t,i,n,s,r,o){const a=s.isWebGL2,l=s.maxTextures,c=s.maxCubemapSize,h=s.maxTextureSize,d=s.maxSamples,u=new WeakMap;let p,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function g(e,t){return m?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function f(e,t,i,n){let s=1;if((e.width>n||e.height>n)&&(s=n/Math.max(e.width,e.height)),s<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const n=t?ji:Math.floor,r=n(s*e.width),o=n(s*e.height);void 0===p&&(p=g(r,o));const a=i?g(r,o):p;a.width=r,a.height=o;return a.getContext("2d").drawImage(e,0,0,r,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+r+"x"+o+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return zi(e.width)&&zi(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==me&&e.minFilter!==be}function b(t,i,s,r){e.generateMipmap(t);n.get(i).__maxMipLevel=Math.log2(Math.max(s,r))}function S(i,n,s){if(!1===a)return n;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let r=n;return 6403===n&&(5126===s&&(r=33326),5131===s&&(r=33325),5121===s&&(r=33321)),6407===n&&(5126===s&&(r=34837),5131===s&&(r=34843),5121===s&&(r=32849)),6408===n&&(5126===s&&(r=34836),5131===s&&(r=34842),5121===s&&(r=32856)),33325!==r&&33326!==r&&34842!==r&&34836!==r||t.get("EXT_color_buffer_float"),r}function E(e){return e===me||e===ge||e===ve?9728:9729}function w(t){const i=t.target;i.removeEventListener("dispose",w),function(t){const i=n.get(t);if(void 0===i.__webglInit)return;e.deleteTexture(i.__webglTexture),n.remove(t)}(i),i.isVideoTexture&&u.delete(i),o.memory.textures--}function T(t){const i=t.target;i.removeEventListener("dispose",T),function(t){const i=t.texture,s=n.get(t),r=n.get(i);if(!t)return;void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(s.__webglFramebuffer[t]),s.__webglDepthbuffer&&e.deleteRenderbuffer(s.__webglDepthbuffer[t]);else e.deleteFramebuffer(s.__webglFramebuffer),s.__webglDepthbuffer&&e.deleteRenderbuffer(s.__webglDepthbuffer),s.__webglMultisampledFramebuffer&&e.deleteFramebuffer(s.__webglMultisampledFramebuffer),s.__webglColorRenderbuffer&&e.deleteRenderbuffer(s.__webglColorRenderbuffer),s.__webglDepthRenderbuffer&&e.deleteRenderbuffer(s.__webglDepthRenderbuffer);n.remove(i),n.remove(t)}(i),o.memory.textures--}let _=0;function M(e,t){const s=n.get(e);if(e.isVideoTexture&&function(e){const t=o.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(e),e.version>0&&s.__version!==e.version){const i=e.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void C(s,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+t),i.bindTexture(3553,s.__webglTexture)}function x(t,s){const o=n.get(t);t.version>0&&o.__version!==t.version?function(t,n,s){if(6!==n.image.length)return;D(t,n),i.activeTexture(33984+s),i.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment),e.pixelStorei(37443,0);const o=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),l=n.image[0]&&n.image[0].isDataTexture,h=[];for(let e=0;e<6;e++)h[e]=o||l?l?n.image[e].image:n.image[e]:f(n.image[e],!1,!0,c);const d=h[0],u=v(d)||a,p=r.convert(n.format),m=r.convert(n.type),g=S(n.internalFormat,p,m);let E;if(P(34067,n,u),o){for(let e=0;e<6;e++){E=h[e].mipmaps;for(let t=0;t<E.length;t++){const s=E[t];n.format!==Fe&&n.format!==Be?null!==p?i.compressedTexImage2D(34069+e,t,g,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+e,t,g,s.width,s.height,0,p,m,s.data)}}t.__maxMipLevel=E.length-1}else{E=n.mipmaps;for(let e=0;e<6;e++)if(l){i.texImage2D(34069+e,0,g,h[e].width,h[e].height,0,p,m,h[e].data);for(let t=0;t<E.length;t++){const n=E[t].image[e].image;i.texImage2D(34069+e,t+1,g,n.width,n.height,0,p,m,n.data)}}else{i.texImage2D(34069+e,0,g,p,m,h[e]);for(let t=0;t<E.length;t++){const n=E[t];i.texImage2D(34069+e,t+1,g,p,m,n.image[e])}}t.__maxMipLevel=E.length}y(n,u)&&b(34067,n,d.width,d.height);t.__version=n.version,n.onUpdate&&n.onUpdate(n)}(o,t,s):(i.activeTexture(33984+s),i.bindTexture(34067,o.__webglTexture))}const A={[de]:10497,[ue]:33071,[pe]:33648},O={[me]:9728,[ge]:9984,[ve]:9986,[be]:9729,[Se]:9985,[we]:9987};function P(i,r,o){if(o?(e.texParameteri(i,10242,A[r.wrapS]),e.texParameteri(i,10243,A[r.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,A[r.wrapR]),e.texParameteri(i,10240,O[r.magFilter]),e.texParameteri(i,10241,O[r.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),r.wrapS===ue&&r.wrapT===ue||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,E(r.magFilter)),e.texParameteri(i,10241,E(r.minFilter)),r.minFilter!==me&&r.minFilter!==be&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(r.type===De&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&r.type===Ce&&!1===t.has("OES_texture_half_float_linear"))return;(r.anisotropy>1||n.get(r).__currentAnisotropy)&&(e.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r.anisotropy,s.getMaxAnisotropy())),n.get(r).__currentAnisotropy=r.anisotropy)}}function D(t,i){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",w),t.__webglTexture=e.createTexture(),o.memory.textures++)}function C(t,n,s){let o=3553;n.isDataTexture2DArray&&(o=35866),n.isDataTexture3D&&(o=32879),D(t,n),i.activeTexture(33984+s),i.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment),e.pixelStorei(37443,0);const l=function(e){return!a&&(e.wrapS!==ue||e.wrapT!==ue||e.minFilter!==me&&e.minFilter!==be)}(n)&&!1===v(n.image),c=f(n.image,l,!1,h),d=v(c)||a,u=r.convert(n.format);let p,m=r.convert(n.type),g=S(n.internalFormat,u,m);P(o,n,d);const E=n.mipmaps;if(n.isDepthTexture)g=6402,a?g=n.type===De?36012:n.type===Pe?33190:n.type===Ne?35056:33189:n.type===De&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===Ge&&6402===g&&n.type!==Ae&&n.type!==Pe&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Ae,m=r.convert(n.type)),n.format===ze&&6402===g&&(g=34041,n.type!==Ne&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Ne,m=r.convert(n.type))),i.texImage2D(3553,0,g,c.width,c.height,0,u,m,null);else if(n.isDataTexture)if(E.length>0&&d){for(let e=0,t=E.length;e<t;e++)p=E[e],i.texImage2D(3553,e,g,p.width,p.height,0,u,m,p.data);n.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else i.texImage2D(3553,0,g,c.width,c.height,0,u,m,c.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(let e=0,t=E.length;e<t;e++)p=E[e],n.format!==Fe&&n.format!==Be?null!==u?i.compressedTexImage2D(3553,e,g,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,e,g,p.width,p.height,0,u,m,p.data);t.__maxMipLevel=E.length-1}else if(n.isDataTexture2DArray)i.texImage3D(35866,0,g,c.width,c.height,c.depth,0,u,m,c.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)i.texImage3D(32879,0,g,c.width,c.height,c.depth,0,u,m,c.data),t.__maxMipLevel=0;else if(E.length>0&&d){for(let e=0,t=E.length;e<t;e++)p=E[e],i.texImage2D(3553,e,g,u,m,p);n.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else i.texImage2D(3553,0,g,u,m,c),t.__maxMipLevel=0;y(n,d)&&b(o,n,c.width,c.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function I(t,s,o,a){const l=s.texture,c=r.convert(l.format),h=r.convert(l.type),d=S(l.internalFormat,c,h);32879===a||35866===a?i.texImage3D(a,0,d,s.width,s.height,s.depth,0,c,h,null):i.texImage2D(a,0,d,s.width,s.height,0,c,h,null),i.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,a,n.get(l).__webglTexture,0),i.bindFramebuffer(36160,null)}function L(t,i,n){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){let s=33189;if(n){const t=i.depthTexture;t&&t.isDepthTexture&&(t.type===De?s=36012:t.type===Pe&&(s=33190));const n=N(i);e.renderbufferStorageMultisample(36161,n,s,i.width,i.height)}else e.renderbufferStorage(36161,s,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){if(n){const t=N(i);e.renderbufferStorageMultisample(36161,t,35056,i.width,i.height)}else e.renderbufferStorage(36161,34041,i.width,i.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=i.texture,s=r.convert(t.format),o=r.convert(t.type),a=S(t.internalFormat,s,o);if(n){const t=N(i);e.renderbufferStorageMultisample(36161,t,a,i.width,i.height)}else e.renderbufferStorage(36161,a,i.width,i.height)}e.bindRenderbuffer(36161,null)}function R(t){const s=n.get(t),r=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,s){if(s&&s.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,t),!s.depthTexture||!s.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(s.depthTexture).__webglTexture&&s.depthTexture.image.width===s.width&&s.depthTexture.image.height===s.height||(s.depthTexture.image.width=s.width,s.depthTexture.image.height=s.height,s.depthTexture.needsUpdate=!0),M(s.depthTexture,0);const r=n.get(s.depthTexture).__webglTexture;if(s.depthTexture.format===Ge)e.framebufferTexture2D(36160,36096,3553,r,0);else{if(s.depthTexture.format!==ze)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,r,0)}}(s.__webglFramebuffer,t)}else if(r){s.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,s.__webglFramebuffer[n]),s.__webglDepthbuffer[n]=e.createRenderbuffer(),L(s.__webglDepthbuffer[n],t,!1)}else i.bindFramebuffer(36160,s.__webglFramebuffer),s.__webglDepthbuffer=e.createRenderbuffer(),L(s.__webglDepthbuffer,t,!1);i.bindFramebuffer(36160,null)}function N(e){return a&&e.isWebGLMultisampleRenderTarget?Math.min(d,e.samples):0}let k=!1,B=!1;this.allocateTextureUnit=function(){const e=_;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),_+=1,e},this.resetTextureUnits=function(){_=0},this.setTexture2D=M,this.setTexture2DArray=function(e,t){const s=n.get(e);e.version>0&&s.__version!==e.version?C(s,e,t):(i.activeTexture(33984+t),i.bindTexture(35866,s.__webglTexture))},this.setTexture3D=function(e,t){const s=n.get(e);e.version>0&&s.__version!==e.version?C(s,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,s.__webglTexture))},this.setTextureCube=x,this.setupRenderTarget=function(t){const s=t.texture,l=n.get(t),c=n.get(s);t.addEventListener("dispose",T),c.__webglTexture=e.createTexture(),c.__version=s.version,o.memory.textures++;const h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultisampleRenderTarget,u=s.isDataTexture3D||s.isDataTexture2DArray,p=v(t)||a;if(!a||s.format!==Be||s.type!==De&&s.type!==Ce||(s.format=Fe,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){l.__webglFramebuffer=[];for(let t=0;t<6;t++)l.__webglFramebuffer[t]=e.createFramebuffer()}else if(l.__webglFramebuffer=e.createFramebuffer(),d)if(a){l.__webglMultisampledFramebuffer=e.createFramebuffer(),l.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,l.__webglColorRenderbuffer);const n=r.convert(s.format),o=r.convert(s.type),a=S(s.internalFormat,n,o),c=N(t);e.renderbufferStorageMultisample(36161,c,a,t.width,t.height),i.bindFramebuffer(36160,l.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,l.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(l.__webglDepthRenderbuffer=e.createRenderbuffer(),L(l.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){i.bindTexture(34067,c.__webglTexture),P(34067,s,p);for(let e=0;e<6;e++)I(l.__webglFramebuffer[e],t,36064,34069+e);y(s,p)&&b(34067,s,t.width,t.height),i.bindTexture(34067,null)}else{let e=3553;if(u)if(a){e=s.isDataTexture3D?32879:35866}else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");i.bindTexture(e,c.__webglTexture),P(e,s,p),I(l.__webglFramebuffer,t,36064,e),y(s,p)&&b(3553,s,t.width,t.height),i.bindTexture(3553,null)}t.depthBuffer&&R(t)},this.updateRenderTargetMipmap=function(e){const t=e.texture;if(y(t,v(e)||a)){const s=e.isWebGLCubeRenderTarget?34067:3553,r=n.get(t).__webglTexture;i.bindTexture(s,r),b(s,t,e.width,e.height),i.bindTexture(s,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(a){const s=t.width,r=t.height;let o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024);const a=n.get(t);i.bindFramebuffer(36008,a.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,a.__webglFramebuffer),e.blitFramebuffer(0,0,s,r,0,0,s,r,o,9728),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,a.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),k=!0),e=e.texture),M(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),B=!0),e=e.texture),x(e,t)}}function Xo(e,t,i){const n=i.isWebGL2;return{convert:function(e){let i;if(e===_e)return 5121;if(e===Ie)return 32819;if(e===Le)return 32820;if(e===Re)return 33635;if(e===Me)return 5120;if(e===xe)return 5122;if(e===Ae)return 5123;if(e===Oe)return 5124;if(e===Pe)return 5125;if(e===De)return 5126;if(e===Ce)return n?5131:(i=t.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(e===ke)return 6406;if(e===Be)return 6407;if(e===Fe)return 6408;if(e===Ue)return 6409;if(e===Ve)return 6410;if(e===Ge)return 6402;if(e===ze)return 34041;if(e===We)return 6403;if(e===je)return 36244;if(e===Ke)return 33319;if(e===qe)return 33320;if(e===Ze)return 36248;if(e===Ye)return 36249;if(e===$e||e===Qe||e===Xe||e===Je){if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(e===$e)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Qe)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Xe)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Je)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===et||e===tt||e===it||e===nt){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(e===et)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===tt)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===it)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===nt)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===st)return i=t.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===rt||e===ot)&&(i=t.get("WEBGL_compressed_texture_etc"),null!==i)){if(e===rt)return i.COMPRESSED_RGB8_ETC2;if(e===ot)return i.COMPRESSED_RGBA8_ETC2_EAC}return e===at||e===lt||e===ct||e===ht||e===dt||e===ut||e===pt||e===mt||e===gt||e===ft||e===vt||e===yt||e===bt||e===St||e===wt||e===Tt||e===_t||e===Mt||e===xt||e===At||e===Ot||e===Pt||e===Dt||e===Ct||e===It||e===Lt||e===Rt||e===Nt?(i=t.get("WEBGL_compressed_texture_astc"),null!==i?e:null):e===Et?(i=t.get("EXT_texture_compression_bptc"),null!==i?e:null):e===Ne?n?34042:(i=t.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class ArrayCamera extends PerspectiveCamera{constructor(e=[]){super(),this.cameras=e}}ArrayCamera.prototype.isArrayCamera=!0;class Group extends Object3D{constructor(){super(),this.type="Group"}}Group.prototype.isGroup=!0;const Jo={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let n=null,s=null,r=null;const o=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==o&&(n=t.getPose(e.targetRaySpace,i),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Jo))),l&&e.hand){r=!0;for(const n of e.hand.values()){const e=t.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const e=new Group;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[n.jointName]=e,l.add(e)}const s=l.joints[n.jointName];null!==e&&(s.matrix.fromArray(e.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.jointRadius=e.radius),s.visible=null!==e}const n=l.joints["index-finger-tip"],s=l.joints["thumb-tip"],o=n.position.distanceTo(s.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),null!==s&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==s),null!==l&&(l.visible=null!==r),this}}class WebXRManager extends EventDispatcher{constructor(e,t){super();const i=this,n=e.state;let s=null,r=1,o=null,a="local-floor",l=null;const c=[],h=new Map,d=new PerspectiveCamera;d.layers.enable(1),d.viewport=new Vector4;const u=new PerspectiveCamera;u.layers.enable(2),u.viewport=new Vector4;const p=[d,u],m=new ArrayCamera;m.layers.enable(1),m.layers.enable(2);let g=null,f=null;function v(e){const t=h.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function y(){h.forEach((function(e,t){e.disconnect(t)})),h.clear(),g=null,f=null,n.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),_.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function b(e){const t=s.inputSources;for(let e=0;e<c.length;e++)h.set(t[e],c[e]);for(let t=0;t<e.removed.length;t++){const i=e.removed[t],n=h.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),h.delete(i))}for(let t=0;t<e.added.length;t++){const i=e.added[t],n=h.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=c[e];return void 0===t&&(t=new WebXRController,c[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=c[e];return void 0===t&&(t=new WebXRController,c[e]=t),t.getGripSpace()},this.getHand=function(e){let t=c[e];return void 0===t&&(t=new WebXRController,c[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return s},this.setSession=async function(e){if(s=e,null!==s){s.addEventListener("select",v),s.addEventListener("selectstart",v),s.addEventListener("selectend",v),s.addEventListener("squeeze",v),s.addEventListener("squeezestart",v),s.addEventListener("squeezeend",v),s.addEventListener("end",y),s.addEventListener("inputsourceschange",b);const e=t.getContextAttributes();!0!==e.xrCompatible&&await t.makeXRCompatible();const n={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:r},l=new XRWebGLLayer(s,t,n);s.updateRenderState({baseLayer:l}),o=await s.requestReferenceSpace(a),_.setContext(s),_.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const S=new Vector3,E=new Vector3;function w(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){m.near=u.near=d.near=e.near,m.far=u.far=d.far=e.far,g===m.near&&f===m.far||(s.updateRenderState({depthNear:m.near,depthFar:m.far}),g=m.near,f=m.far);const t=e.parent,i=m.cameras;w(m,t);for(let e=0;e<i.length;e++)w(i[e],t);e.matrixWorld.copy(m.matrixWorld),e.matrix.copy(m.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const n=e.children;for(let e=0,t=n.length;e<t;e++)n[e].updateMatrixWorld(!0);return 2===i.length?function(e,t,i){S.setFromMatrixPosition(t.matrixWorld),E.setFromMatrixPosition(i.matrixWorld);const n=S.distanceTo(E),s=t.projectionMatrix.elements,r=i.projectionMatrix.elements,o=s[14]/(s[10]-1),a=s[14]/(s[10]+1),l=(s[9]+1)/s[5],c=(s[9]-1)/s[5],h=(s[8]-1)/s[0],d=(r[8]+1)/r[0],u=o*h,p=o*d,m=n/(-h+d),g=m*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(g),e.translateZ(m),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const f=o+m,v=a+m,y=u-g,b=p+(n-g),w=l*a/v*f,T=c*a/v*f;e.projectionMatrix.makePerspective(y,b,w,T,f,v)}(m,d,u):m.projectionMatrix.copy(d.projectionMatrix),m};let T=null;const _=new Ys;_.setAnimationLoop((function(e,t){if(l=t.getViewerPose(o),null!==l){const e=l.views,t=s.renderState.baseLayer;n.bindXRFramebuffer(t.framebuffer);let i=!1;e.length!==m.cameras.length&&(m.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const s=e[n],r=t.getViewport(s),o=p[n];o.matrix.fromArray(s.transform.matrix),o.projectionMatrix.fromArray(s.projectionMatrix),o.viewport.set(r.x,r.y,r.width,r.height),0===n&&m.matrix.copy(o.matrix),!0===i&&m.cameras.push(o)}}const i=s.inputSources;for(let e=0;e<c.length;e++){const n=c[e],s=i[e];n.update(s,t,o)}T&&T(e,t)})),this.setAnimationLoop=function(e){T=e},this.dispose=function(){}}}function ea(e){function t(t,i){t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map),i.alphaMap&&(t.alphaMap.value=i.alphaMap),i.specularMap&&(t.specularMap.value=i.specularMap);const n=e.get(i).envMap;if(n){t.envMap.value=n,t.flipEnvMap.value=n.isCubeTexture&&n._needsFlipEnvMap?-1:1,t.reflectivity.value=i.reflectivity,t.refractionRatio.value=i.refractionRatio;const s=e.get(n).__maxMipLevel;void 0!==s&&(t.maxMipLevel.value=s)}let s,r;i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity),i.map?s=i.map:i.specularMap?s=i.specularMap:i.displacementMap?s=i.displacementMap:i.normalMap?s=i.normalMap:i.bumpMap?s=i.bumpMap:i.roughnessMap?s=i.roughnessMap:i.metalnessMap?s=i.metalnessMap:i.alphaMap?s=i.alphaMap:i.emissiveMap?s=i.emissiveMap:i.clearcoatMap?s=i.clearcoatMap:i.clearcoatNormalMap?s=i.clearcoatNormalMap:i.clearcoatRoughnessMap&&(s=i.clearcoatRoughnessMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),t.uvTransform.value.copy(s.matrix)),i.aoMap?r=i.aoMap:i.lightMap&&(r=i.lightMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uv2Transform.value.copy(r.matrix))}function i(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap),i.bumpMap&&(t.bumpMap.value=i.bumpMap,t.bumpScale.value=i.bumpScale,i.side===g&&(t.bumpScale.value*=-1)),i.normalMap&&(t.normalMap.value=i.normalMap,t.normalScale.value.copy(i.normalScale),i.side===g&&t.normalScale.value.negate()),i.displacementMap&&(t.displacementMap.value=i.displacementMap,t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias);e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,n,s,r){n.isMeshBasicMaterial?t(e,n):n.isMeshLambertMaterial?(t(e,n),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,n)):n.isMeshToonMaterial?(t(e,n),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshPhongMaterial?(t(e,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshStandardMaterial?(t(e,n),n.isMeshPhysicalMaterial?function(e,t){i(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===g&&e.clearcoatNormalScale.value.negate());e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(e,n):i(e,n)):n.isMeshMatcapMaterial?(t(e,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshDepthMaterial?(t(e,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshDistanceMaterial?(t(e,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,n)):n.isMeshNormalMaterial?(t(e,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,n)):n.isPointsMaterial?function(e,t,i,n){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*n,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let s;t.map?s=t.map:t.alphaMap&&(s=t.alphaMap);void 0!==s&&(!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uvTransform.value.copy(s.matrix))}(e,n,s,r):n.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,n):n.isShadowMaterial?(e.color.value.copy(n.color),e.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function ta(e){const t=void 0!==(e=e||{}).canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),i=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,s=void 0===e.depth||e.depth,r=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let d=null,u=null;const p=[],m=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=$t,this.physicallyCorrectLights=!1,this.toneMapping=X,this.toneMappingExposure=1;const g=this;let f=!1,v=0,y=0,b=null,S=-1,E=null;const w=new Vector4,T=new Vector4;let _=null,M=t.width,x=t.height,A=1,O=null,P=null;const D=new Vector4(0,0,M,x),C=new Vector4(0,0,M,x);let I=!1;const L=new Frustum;let R=!1,N=!1;const k=new Matrix4,B=new Vector3,F={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function U(){return null===b?A:1}let V,H,G,z,W,j,K,q,Z,Y,$,Q,J,ee,te,ie,ne,se,re,oe,ae,le,ce=i;function he(e,i){for(let n=0;n<e.length;n++){const s=e[n],r=t.getContext(s,i);if(null!==r)return r}return null}try{const e={alpha:n,depth:s,stencil:r,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if(t.addEventListener("webglcontextlost",pe,!1),t.addEventListener("webglcontextrestored",me,!1),null===ce){const t=["webgl2","webgl","experimental-webgl"];if(!0===g.isWebGL1Renderer&&t.shift(),ce=he(t,e),null===ce)throw he(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ce.getShaderPrecisionFormat&&(ce.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function de(){V=new or(ce),H=new nr(ce,V,e),V.init(H),ae=new Xo(ce,V,H),G=new $o(ce,V,H),z=new cr(ce),W=new Fo,j=new Qo(ce,V,G,W,H,ae,z),K=new rr(g),q=new $s(ce,H),le=new tr(ce,V,q,H),Z=new ar(ce,q,z,le),Y=new pr(ce,Z,q,z),se=new ur(ce),te=new sr(W),$=new Bo(g,K,V,H,le,te),Q=new ea(W),J=new Go(W),ee=new Zo(V,H),ne=new er(g,K,G,Y,a),ie=new Yo(g,Y,H),re=new ir(ce,V,z,H),oe=new lr(ce,V,z,H),z.programs=$.programs,g.capabilities=H,g.extensions=V,g.properties=W,g.renderLists=J,g.shadowMap=ie,g.state=G,g.info=z}de();const ue=new WebXRManager(g,ce);function pe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),f=!0}function me(){console.log("THREE.WebGLRenderer: Context Restored."),f=!1;const e=z.autoReset,t=ie.enabled,i=ie.autoUpdate,n=ie.needsUpdate,s=ie.type;de(),z.autoReset=e,ie.enabled=t,ie.autoUpdate=i,ie.needsUpdate=n,ie.type=s}function ge(e){const t=e.target;t.removeEventListener("dispose",ge),function(e){(function(e){const t=W.get(e).programs;void 0!==t&&t.forEach((function(e){$.releaseProgram(e)}))})(e),W.remove(e)}(t)}this.xr=ue,this.getContext=function(){return ce},this.getContextAttributes=function(){return ce.getContextAttributes()},this.forceContextLoss=function(){const e=V.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=V.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return A},this.setPixelRatio=function(e){void 0!==e&&(A=e,this.setSize(M,x,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Vector2),e.set(M,x)},this.setSize=function(e,i,n){ue.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(M=e,x=i,t.width=Math.floor(e*A),t.height=Math.floor(i*A),!1!==n&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Vector2),e.set(M*A,x*A).floor()},this.setDrawingBufferSize=function(e,i,n){M=e,x=i,A=n,t.width=Math.floor(e*n),t.height=Math.floor(i*n),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Vector4),e.copy(w)},this.getViewport=function(e){return e.copy(D)},this.setViewport=function(e,t,i,n){e.isVector4?D.set(e.x,e.y,e.z,e.w):D.set(e,t,i,n),G.viewport(w.copy(D).multiplyScalar(A).floor())},this.getScissor=function(e){return e.copy(C)},this.setScissor=function(e,t,i,n){e.isVector4?C.set(e.x,e.y,e.z,e.w):C.set(e,t,i,n),G.scissor(T.copy(C).multiplyScalar(A).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(e){G.setScissorTest(I=e)},this.setOpaqueSort=function(e){O=e},this.setTransparentSort=function(e){P=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new Color),e.copy(ne.getClearColor())},this.setClearColor=function(){ne.setClearColor.apply(ne,arguments)},this.getClearAlpha=function(){return ne.getClearAlpha()},this.setClearAlpha=function(){ne.setClearAlpha.apply(ne,arguments)},this.clear=function(e,t,i){let n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===i||i)&&(n|=1024),ce.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",pe,!1),t.removeEventListener("webglcontextrestored",me,!1),J.dispose(),ee.dispose(),W.dispose(),K.dispose(),Y.dispose(),le.dispose(),ue.dispose(),ue.removeEventListener("sessionstart",ve),ue.removeEventListener("sessionend",ye),be.stop()},this.renderBufferImmediate=function(e,t){le.initAttributes();const i=W.get(e);e.hasPositions&&!i.position&&(i.position=ce.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=ce.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=ce.createBuffer()),e.hasColors&&!i.color&&(i.color=ce.createBuffer());const n=t.getAttributes();e.hasPositions&&(ce.bindBuffer(34962,i.position),ce.bufferData(34962,e.positionArray,35048),le.enableAttribute(n.position),ce.vertexAttribPointer(n.position,3,5126,!1,0,0)),e.hasNormals&&(ce.bindBuffer(34962,i.normal),ce.bufferData(34962,e.normalArray,35048),le.enableAttribute(n.normal),ce.vertexAttribPointer(n.normal,3,5126,!1,0,0)),e.hasUvs&&(ce.bindBuffer(34962,i.uv),ce.bufferData(34962,e.uvArray,35048),le.enableAttribute(n.uv),ce.vertexAttribPointer(n.uv,2,5126,!1,0,0)),e.hasColors&&(ce.bindBuffer(34962,i.color),ce.bufferData(34962,e.colorArray,35048),le.enableAttribute(n.color),ce.vertexAttribPointer(n.color,3,5126,!1,0,0)),le.disableUnusedAttributes(),ce.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,n,s,r){null===t&&(t=F);const o=s.isMesh&&s.matrixWorld.determinant()<0,a=xe(e,t,n,s);G.setMaterial(n,o);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,d=1;!0===n.wireframe&&(l=Z.getWireframeAttribute(i),d=2),(n.morphTargets||n.morphNormals)&&se.update(s,i,n,a),le.setup(s,n,a,i,l);let u=re;null!==l&&(h=q.get(l),u=oe,u.setIndex(h));const p=null!==l?l.count:c.count,m=i.drawRange.start*d,g=i.drawRange.count*d,f=null!==r?r.start*d:0,v=null!==r?r.count*d:1/0,y=Math.max(m,f),b=Math.min(p,m+g,f+v)-1,S=Math.max(0,b-y+1);if(0!==S){if(s.isMesh)!0===n.wireframe?(G.setLineWidth(n.wireframeLinewidth*U()),u.setMode(1)):u.setMode(4);else if(s.isLine){let e=n.linewidth;void 0===e&&(e=1),G.setLineWidth(e*U()),s.isLineSegments?u.setMode(1):s.isLineLoop?u.setMode(2):u.setMode(3)}else s.isPoints?u.setMode(0):s.isSprite&&u.setMode(4);if(s.isInstancedMesh)u.renderInstances(y,S,s.count);else if(i.isInstancedBufferGeometry){const e=Math.min(i.instanceCount,i._maxInstanceCount);u.renderInstances(y,S,e)}else u.render(y,S)}},this.compile=function(e,t){u=ee.get(e),u.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(u.pushLight(e),e.castShadow&&u.pushShadow(e))})),u.setupLights(),e.traverse((function(t){const i=t.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++){Te(i[n],e,t)}else Te(i,e,t)}))};let fe=null;function ve(){be.stop()}function ye(){be.start()}const be=new Ys;function Se(e,t,i,n){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)u.pushLight(e),e.castShadow&&u.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||L.intersectsSprite(e)){n&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(k);const t=Y.update(e),s=e.material;s.visible&&d.push(e,t,s,i,B.z,null)}}else if(e.isImmediateRenderObject)n&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(k),d.push(e,null,e.material,i,B.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==z.render.frame&&(e.skeleton.update(),e.skeleton.frame=z.render.frame),!e.frustumCulled||L.intersectsObject(e))){n&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(k);const t=Y.update(e),s=e.material;if(Array.isArray(s)){const n=t.groups;for(let r=0,o=n.length;r<o;r++){const o=n[r],a=s[o.materialIndex];a&&a.visible&&d.push(e,t,a,i,B.z,o)}}else s.visible&&d.push(e,t,s,i,B.z,null)}const s=e.children;for(let e=0,r=s.length;e<r;e++)Se(s[e],t,i,n)}function Ee(e,t,i){const n=!0===t.isScene?t.overrideMaterial:null;for(let s=0,r=e.length;s<r;s++){const r=e[s],o=r.object,a=r.geometry,l=null===n?r.material:n,c=r.group;if(i.isArrayCamera){const e=i.cameras;for(let i=0,n=e.length;i<n;i++){const n=e[i];o.layers.test(n.layers)&&(G.viewport(w.copy(n.viewport)),u.setupLightsView(n),we(o,t,n,a,l,c))}}else we(o,t,i,a,l,c)}}function we(e,t,i,n,s,r){if(e.onBeforeRender(g,t,i,n,s,r),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const n=xe(i,t,s,e);G.setMaterial(s),le.reset(),function(e,t){e.render((function(e){g.renderBufferImmediate(e,t)}))}(e,n)}else g.renderBufferDirect(i,t,n,s,e,r);e.onAfterRender(g,t,i,n,s,r)}function Te(e,t,i){!0!==t.isScene&&(t=F);const n=W.get(e),s=u.state.lights,r=u.state.shadowsArray,o=s.state.version,a=$.getParameters(e,s.state,r,t,i),l=$.getProgramCacheKey(a);let c=n.programs;n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=K.get(e.envMap||n.environment),void 0===c&&(e.addEventListener("dispose",ge),c=new Map,n.programs=c);let h=c.get(l);if(void 0!==h){if(n.currentProgram===h&&n.lightsStateVersion===o)return Me(e,a),h}else a.uniforms=$.getUniforms(e),e.onBuild(a,g),e.onBeforeCompile(a,g),h=$.acquireProgram(a,l),c.set(l,h),n.uniforms=a.uniforms;const d=n.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=te.uniform),Me(e,a),n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=o,n.needsLights&&(d.ambientLightColor.value=s.state.ambient,d.lightProbe.value=s.state.probe,d.directionalLights.value=s.state.directional,d.directionalLightShadows.value=s.state.directionalShadow,d.spotLights.value=s.state.spot,d.spotLightShadows.value=s.state.spotShadow,d.rectAreaLights.value=s.state.rectArea,d.ltc_1.value=s.state.rectAreaLTC1,d.ltc_2.value=s.state.rectAreaLTC2,d.pointLights.value=s.state.point,d.pointLightShadows.value=s.state.pointShadow,d.hemisphereLights.value=s.state.hemi,d.directionalShadowMap.value=s.state.directionalShadowMap,d.directionalShadowMatrix.value=s.state.directionalShadowMatrix,d.spotShadowMap.value=s.state.spotShadowMap,d.spotShadowMatrix.value=s.state.spotShadowMatrix,d.pointShadowMap.value=s.state.pointShadowMap,d.pointShadowMatrix.value=s.state.pointShadowMatrix);const p=h.getUniforms(),m=fo.seqWithValue(p.seq,d);return n.currentProgram=h,n.uniformsList=m,h}function Me(e,t){const i=W.get(e);i.outputEncoding=t.outputEncoding,i.instancing=t.instancing,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas}function xe(e,t,i,n){!0!==t.isScene&&(t=F),j.resetTextureUnits();const s=t.fog,r=i.isMeshStandardMaterial?t.environment:null,o=null===b?g.outputEncoding:b.texture.encoding,a=K.get(i.envMap||r),l=!0===i.vertexColors&&n.geometry&&n.geometry.attributes.color&&4===n.geometry.attributes.color.itemSize,c=W.get(i),h=u.state.lights;if(!0===R&&(!0===N||e!==E)){const t=e===E&&i.id===S;te.setState(i,e,t)}let d=!1;i.version===c.__version?c.needsLights&&c.lightsStateVersion!==h.state.version||c.outputEncoding!==o||n.isInstancedMesh&&!1===c.instancing?d=!0:n.isInstancedMesh||!0!==c.instancing?c.envMap!==a||i.fog&&c.fog!==s?d=!0:void 0===c.numClippingPlanes||c.numClippingPlanes===te.numPlanes&&c.numIntersection===te.numIntersection?c.vertexAlphas!==l&&(d=!0):d=!0:d=!0:(d=!0,c.__version=i.version);let p=c.currentProgram;!0===d&&(p=Te(i,t,n));let m=!1,f=!1,v=!1;const y=p.getUniforms(),w=c.uniforms;if(G.useProgram(p.program)&&(m=!0,f=!0,v=!0),i.id!==S&&(S=i.id,f=!0),m||E!==e){if(y.setValue(ce,"projectionMatrix",e.projectionMatrix),H.logarithmicDepthBuffer&&y.setValue(ce,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),E!==e&&(E=e,f=!0,v=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=y.map.cameraPosition;void 0!==t&&t.setValue(ce,B.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&y.setValue(ce,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||i.skinning)&&y.setValue(ce,"viewMatrix",e.matrixWorldInverse)}if(i.skinning){y.setOptional(ce,n,"bindMatrix"),y.setOptional(ce,n,"bindMatrixInverse");const e=n.skeleton;if(e){const t=e.bones;if(H.floatVertexTextures){if(null===e.boneTexture){let i=Math.sqrt(4*t.length);i=Wi(i),i=Math.max(i,4);const n=new Float32Array(i*i*4);n.set(e.boneMatrices);const s=new DataTexture(n,i,i,Fe,De);e.boneMatrices=n,e.boneTexture=s,e.boneTextureSize=i}y.setValue(ce,"boneTexture",e.boneTexture,j),y.setValue(ce,"boneTextureSize",e.boneTextureSize)}else y.setOptional(ce,e,"boneMatrices")}}var T,_;return(f||c.receiveShadow!==n.receiveShadow)&&(c.receiveShadow=n.receiveShadow,y.setValue(ce,"receiveShadow",n.receiveShadow)),f&&(y.setValue(ce,"toneMappingExposure",g.toneMappingExposure),c.needsLights&&(_=v,(T=w).ambientLightColor.needsUpdate=_,T.lightProbe.needsUpdate=_,T.directionalLights.needsUpdate=_,T.directionalLightShadows.needsUpdate=_,T.pointLights.needsUpdate=_,T.pointLightShadows.needsUpdate=_,T.spotLights.needsUpdate=_,T.spotLightShadows.needsUpdate=_,T.rectAreaLights.needsUpdate=_,T.hemisphereLights.needsUpdate=_),s&&i.fog&&Q.refreshFogUniforms(w,s),Q.refreshMaterialUniforms(w,i,A,x),fo.upload(ce,c.uniformsList,w,j)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(fo.upload(ce,c.uniformsList,w,j),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&y.setValue(ce,"center",n.center),y.setValue(ce,"modelViewMatrix",n.modelViewMatrix),y.setValue(ce,"normalMatrix",n.normalMatrix),y.setValue(ce,"modelMatrix",n.matrixWorld),p}be.setAnimationLoop((function(e){fe&&fe(e)})),"undefined"!=typeof window&&be.setContext(window),this.setAnimationLoop=function(e){fe=e,ue.setAnimationLoop(e),null===e?be.stop():be.start()},ue.addEventListener("sessionstart",ve),ue.addEventListener("sessionend",ye),this.render=function(e,t){let i,n;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),i=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===f)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===ue.enabled&&!0===ue.isPresenting&&(t=ue.getCamera(t)),!0===e.isScene&&e.onBeforeRender(g,e,t,i||b),u=ee.get(e,m.length),u.init(),m.push(u),k.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),L.setFromProjectionMatrix(k),N=this.localClippingEnabled,R=te.init(this.clippingPlanes,N,t),d=J.get(e,p.length),d.init(),p.push(d),Se(e,t,0,g.sortObjects),d.finish(),!0===g.sortObjects&&d.sort(O,P),!0===R&&te.beginShadows();const s=u.state.shadowsArray;ie.render(s,e,t),u.setupLights(),u.setupLightsView(t),!0===R&&te.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),ne.render(d,e,t,n);const r=d.opaque,o=d.transparent;r.length>0&&Ee(r,e,t),o.length>0&&Ee(o,e,t),null!==b&&(j.updateRenderTargetMipmap(b),j.updateMultisampleRenderTarget(b)),!0===e.isScene&&e.onAfterRender(g,e,t),G.buffers.depth.setTest(!0),G.buffers.depth.setMask(!0),G.buffers.color.setMask(!0),G.setPolygonOffset(!1),le.resetDefaultState(),S=-1,E=null,m.pop(),u=m.length>0?m[m.length-1]:null,p.pop(),d=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return b},this.setRenderTarget=function(e,t=0,i=0){b=e,v=t,y=i,e&&void 0===W.get(e).__webglFramebuffer&&j.setupRenderTarget(e);let n=null,s=!1,r=!1;if(e){const i=e.texture;(i.isDataTexture3D||i.isDataTexture2DArray)&&(r=!0);const o=W.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=o[t],s=!0):n=e.isWebGLMultisampleRenderTarget?W.get(e).__webglMultisampledFramebuffer:o,w.copy(e.viewport),T.copy(e.scissor),_=e.scissorTest}else w.copy(D).multiplyScalar(A).floor(),T.copy(C).multiplyScalar(A).floor(),_=I;if(G.bindFramebuffer(36160,n),G.viewport(w),G.scissor(T),G.setScissorTest(_),s){const n=W.get(e.texture);ce.framebufferTexture2D(36160,36064,34069+t,n.__webglTexture,i)}else if(r){const n=W.get(e.texture),s=t||0;ce.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,s)}},this.readRenderTargetPixels=function(e,t,i,n,s,r,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=W.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){G.bindFramebuffer(36160,a);try{const o=e.texture,a=o.format,l=o.type;if(a!==Fe&&ae.convert(a)!==ce.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Ce&&(V.has("EXT_color_buffer_half_float")||H.isWebGL2&&V.has("EXT_color_buffer_float"));if(!(l===_e||ae.convert(l)===ce.getParameter(35738)||l===De&&(H.isWebGL2||V.has("OES_texture_float")||V.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ce.checkFramebufferStatus(36160)?t>=0&&t<=e.width-n&&i>=0&&i<=e.height-s&&ce.readPixels(t,i,n,s,ae.convert(a),ae.convert(l),r):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==b?W.get(b).__webglFramebuffer:null;G.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,i=0){const n=Math.pow(2,-i),s=Math.floor(t.image.width*n),r=Math.floor(t.image.height*n),o=ae.convert(t.format);j.setTexture2D(t,0),ce.copyTexImage2D(3553,i,o,e.x,e.y,s,r,0),G.unbindTexture()},this.copyTextureToTexture=function(e,t,i,n=0){const s=t.image.width,r=t.image.height,o=ae.convert(i.format),a=ae.convert(i.type);j.setTexture2D(i,0),ce.pixelStorei(37440,i.flipY),ce.pixelStorei(37441,i.premultiplyAlpha),ce.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?ce.texSubImage2D(3553,n,e.x,e.y,s,r,o,a,t.image.data):t.isCompressedTexture?ce.compressedTexSubImage2D(3553,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ce.texSubImage2D(3553,n,e.x,e.y,o,a,t.image),0===n&&i.generateMipmaps&&ce.generateMipmap(3553),G.unbindTexture()},this.copyTextureToTexture3D=function(e,t,i,n,s=0){if(g.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const{width:r,height:o,data:a}=i.image,l=ae.convert(n.format),c=ae.convert(n.type);let h;if(n.isDataTexture3D)j.setTexture3D(n,0),h=32879;else{if(!n.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");j.setTexture2DArray(n,0),h=35866}ce.pixelStorei(37440,n.flipY),ce.pixelStorei(37441,n.premultiplyAlpha),ce.pixelStorei(3317,n.unpackAlignment);const d=ce.getParameter(3314),u=ce.getParameter(32878),p=ce.getParameter(3316),m=ce.getParameter(3315),f=ce.getParameter(32877);ce.pixelStorei(3314,r),ce.pixelStorei(32878,o),ce.pixelStorei(3316,e.min.x),ce.pixelStorei(3315,e.min.y),ce.pixelStorei(32877,e.min.z),ce.texSubImage3D(h,s,t.x,t.y,t.z,e.max.x-e.min.x+1,e.max.y-e.min.y+1,e.max.z-e.min.z+1,l,c,a),ce.pixelStorei(3314,d),ce.pixelStorei(32878,u),ce.pixelStorei(3316,p),ce.pixelStorei(3315,m),ce.pixelStorei(32877,f),0===s&&n.generateMipmaps&&ce.generateMipmap(h),G.unbindTexture()},this.initTexture=function(e){j.setTexture2D(e,0),G.unbindTexture()},this.resetState=function(){v=0,y=0,b=null,G.reset(),le.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class WebGL1Renderer extends ta{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class FogExp2{constructor(e,t=25e-5){this.name="",this.color=new Color(e),this.density=t}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}FogExp2.prototype.isFogExp2=!0;class Fog{constructor(e,t=1,i=1e3){this.name="",this.color=new Color(e),this.near=t,this.far=i}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Fog.prototype.isFog=!0;class Scene extends Object3D{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}Scene.prototype.isScene=!0;class InterleavedBuffer{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=_i,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ui(),this.onUploadCallback=function(){}}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,s=this.stride;n<s;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ui()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new InterleavedBuffer(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ui()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}InterleavedBuffer.prototype.isInterleavedBuffer=!0;const ia=new Vector3;class InterleavedBufferAttribute{constructor(e,t,i,n){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)ia.x=this.getX(t),ia.y=this.getY(t),ia.z=this.getZ(t),ia.applyMatrix4(e),this.setXYZ(t,ia.x,ia.y,ia.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ia.x=this.getX(t),ia.y=this.getY(t),ia.z=this.getZ(t),ia.applyNormalMatrix(e),this.setXYZ(t,ia.x,ia.y,ia.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ia.x=this.getX(t),ia.y=this.getY(t),ia.z=this.getZ(t),ia.transformDirection(e),this.setXYZ(t,ia.x,ia.y,ia.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,s){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=s,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new BufferAttribute(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new InterleavedBufferAttribute(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}InterleavedBufferAttribute.prototype.isInterleavedBufferAttribute=!0;class SpriteMaterial extends os{constructor(e){super(),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let na;SpriteMaterial.prototype.isSpriteMaterial=!0;const sa=new Vector3,ra=new Vector3,oa=new Vector3,aa=new Vector2,la=new Vector2,ca=new Matrix4,ha=new Vector3,da=new Vector3,ua=new Vector3,pa=new Vector2,ma=new Vector2,ga=new Vector2;class Sprite extends Object3D{constructor(e){if(super(),this.type="Sprite",void 0===na){na=new BufferGeometry;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new InterleavedBuffer(e,5);na.setIndex([0,1,2,0,2,3]),na.setAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),na.setAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1))}this.geometry=na,this.material=void 0!==e?e:new SpriteMaterial,this.center=new Vector2(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ra.setFromMatrixScale(this.matrixWorld),ca.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),oa.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&ra.multiplyScalar(-oa.z);const i=this.material.rotation;let n,s;0!==i&&(s=Math.cos(i),n=Math.sin(i));const r=this.center;fa(ha.set(-.5,-.5,0),oa,r,ra,n,s),fa(da.set(.5,-.5,0),oa,r,ra,n,s),fa(ua.set(.5,.5,0),oa,r,ra,n,s),pa.set(0,0),ma.set(1,0),ga.set(1,1);let o=e.ray.intersectTriangle(ha,da,ua,!1,sa);if(null===o&&(fa(da.set(-.5,.5,0),oa,r,ra,n,s),ma.set(0,1),o=e.ray.intersectTriangle(ha,ua,da,!1,sa),null===o))return;const a=e.ray.origin.distanceTo(sa);a<e.near||a>e.far||t.push({distance:a,point:sa.clone(),uv:Triangle.getUV(sa,ha,da,ua,pa,ma,ga,new Vector2),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function fa(e,t,i,n,s,r){aa.subVectors(e,i).addScalar(.5).multiply(n),void 0!==s?(la.x=r*aa.x-s*aa.y,la.y=s*aa.x+r*aa.y):la.copy(aa),e.copy(t),e.x+=la.x,e.y+=la.y,e.applyMatrix4(ca)}Sprite.prototype.isSprite=!0;const va=new Vector3,ya=new Vector3;class LOD extends Object3D{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,i=t.length;e<i;e++){const i=t[e];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const i=this.levels;let n;for(n=0;n<i.length&&!(t<i[n].distance);n++);return i.splice(n,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,n;for(i=1,n=t.length;i<n&&!(e<t[i].distance);i++);return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){va.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(va);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){va.setFromMatrixPosition(e.matrixWorld),ya.setFromMatrixPosition(this.matrixWorld);const i=va.distanceTo(ya)/e.zoom;let n,s;for(t[0].object.visible=!0,n=1,s=t.length;n<s&&i>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<s;n++)t[n].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let e=0,n=i.length;e<n;e++){const n=i[e];t.object.levels.push({object:n.object.uuid,distance:n.distance})}return t}}const ba=new Vector3,Sa=new Vector4,Ea=new Vector4,wa=new Vector3,Ta=new Matrix4;class SkinnedMesh extends Mesh{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Vector4,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,n=this.geometry;Sa.fromBufferAttribute(n.attributes.skinIndex,e),Ea.fromBufferAttribute(n.attributes.skinWeight,e),ba.fromBufferAttribute(n.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const n=Ea.getComponent(e);if(0!==n){const s=Sa.getComponent(e);Ta.multiplyMatrices(i.bones[s].matrixWorld,i.boneInverses[s]),t.addScaledVector(wa.copy(ba).applyMatrix4(Ta),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}SkinnedMesh.prototype.isSkinnedMesh=!0;class Bone extends Object3D{constructor(){super(),this.type="Bone"}}Bone.prototype.isBone=!0;const _a=new Matrix4,Ma=new Matrix4;class Skeleton{constructor(e=[],t=[]){this.uuid=Ui(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Matrix4;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,s=e.length;n<s;n++){const s=e[n]?e[n].matrixWorld:Ma;_a.multiplyMatrices(s,t[n]),_a.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){const n=e.bones[i];let s=t[n];void 0===s&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new Bone),this.bones.push(s),this.boneInverses.push((new Matrix4).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,s=t.length;n<s;n++){const s=t[n];e.bones.push(s.uuid);const r=i[n];e.boneInverses.push(r.toArray())}return e}}const xa=new Matrix4,Aa=new Matrix4,Oa=[],Pa=new Mesh;class InstancedMesh extends Mesh{constructor(e,t,i){super(e,t),this.instanceMatrix=new BufferAttribute(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const i=this.matrixWorld,n=this.count;if(Pa.geometry=this.geometry,Pa.material=this.material,void 0!==Pa.material)for(let s=0;s<n;s++){this.getMatrixAt(s,xa),Aa.multiplyMatrices(i,xa),Pa.matrixWorld=Aa,Pa.raycast(e,Oa);for(let e=0,i=Oa.length;e<i;e++){const i=Oa[e];i.instanceId=s,i.object=this,t.push(i)}Oa.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new BufferAttribute(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}InstancedMesh.prototype.isInstancedMesh=!0;class LineBasicMaterial extends os{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}}LineBasicMaterial.prototype.isLineBasicMaterial=!0;const Da=new Vector3,Ca=new Vector3,Ia=new Matrix4,La=new Ray,Ra=new Sphere;class Line extends Object3D{constructor(e=new BufferGeometry,t=new LineBasicMaterial){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)Da.fromBufferAttribute(t,e-1),Ca.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=Da.distanceTo(Ca);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,s=e.params.Line.threshold,r=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ra.copy(i.boundingSphere),Ra.applyMatrix4(n),Ra.radius+=s,!1===e.ray.intersectsSphere(Ra))return;Ia.copy(n).invert(),La.copy(e.ray).applyMatrix4(Ia);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new Vector3,c=new Vector3,h=new Vector3,d=new Vector3,u=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,s=i.attributes.position;if(null!==n){for(let i=Math.max(0,r.start),o=Math.min(n.count,r.start+r.count)-1;i<o;i+=u){const r=n.getX(i),o=n.getX(i+1);l.fromBufferAttribute(s,r),c.fromBufferAttribute(s,o);if(La.distanceSqToSegment(l,c,d,h)>a)continue;d.applyMatrix4(this.matrixWorld);const u=e.ray.origin.distanceTo(d);u<e.near||u>e.far||t.push({distance:u,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,r.start),n=Math.min(s.count,r.start+r.count)-1;i<n;i+=u){l.fromBufferAttribute(s,i),c.fromBufferAttribute(s,i+1);if(La.distanceSqToSegment(l,c,d,h)>a)continue;d.applyMatrix4(this.matrixWorld);const n=e.ray.origin.distanceTo(d);n<e.near||n>e.far||t.push({distance:n,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Line.prototype.isLine=!0;const Na=new Vector3,ka=new Vector3;class LineSegments extends Line{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[];for(let e=0,n=t.count;e<n;e+=2)Na.fromBufferAttribute(t,e),ka.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+Na.distanceTo(ka);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}LineSegments.prototype.isLineSegments=!0;class LineLoop extends Line{constructor(e,t){super(e,t),this.type="LineLoop"}}LineLoop.prototype.isLineLoop=!0;class PointsMaterial extends os{constructor(e){super(),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}}PointsMaterial.prototype.isPointsMaterial=!0;const Ba=new Matrix4,Fa=new Ray,Ua=new Sphere,Va=new Vector3;class Points extends Object3D{constructor(e=new BufferGeometry,t=new PointsMaterial){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,s=e.params.Points.threshold,r=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ua.copy(i.boundingSphere),Ua.applyMatrix4(n),Ua.radius+=s,!1===e.ray.intersectsSphere(Ua))return;Ba.copy(n).invert(),Fa.copy(e.ray).applyMatrix4(Ba);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(i.isBufferGeometry){const s=i.index,o=i.attributes.position;if(null!==s){for(let i=Math.max(0,r.start),l=Math.min(s.count,r.start+r.count);i<l;i++){const r=s.getX(i);Va.fromBufferAttribute(o,r),Ha(Va,r,a,n,e,t,this)}}else{for(let i=Math.max(0,r.start),s=Math.min(o.count,r.start+r.count);i<s;i++)Va.fromBufferAttribute(o,i),Ha(Va,i,a,n,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Ha(e,t,i,n,s,r,o){const a=Fa.distanceSqToPoint(e);if(a<i){const i=new Vector3;Fa.closestPointToPoint(e,i),i.applyMatrix4(n);const l=s.ray.origin.distanceTo(i);if(l<s.near||l>s.far)return;r.push({distance:l,distanceToRay:Math.sqrt(a),point:i,index:t,face:null,object:o})}}Points.prototype.isPoints=!0;class VideoTexture extends Texture{constructor(e,t,i,n,s,r,o,a,l){super(e,t,i,n,s,r,o,a,l),this.format=void 0!==o?o:Be,this.minFilter=void 0!==r?r:be,this.magFilter=void 0!==s?s:be,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}VideoTexture.prototype.isVideoTexture=!0;class CompressedTexture extends Texture{constructor(e,t,i,n,s,r,o,a,l,c,h,d){super(null,r,o,a,l,c,n,s,h,d),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}CompressedTexture.prototype.isCompressedTexture=!0;class CanvasTexture extends Texture{constructor(e,t,i,n,s,r,o,a,l){super(e,t,i,n,s,r,o,a,l),this.needsUpdate=!0}}CanvasTexture.prototype.isCanvasTexture=!0;class DepthTexture extends Texture{constructor(e,t,i,n,s,r,o,a,l,c){if((c=void 0!==c?c:Ge)!==Ge&&c!==ze)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Ge&&(i=Ae),void 0===i&&c===ze&&(i=Ne),super(null,n,s,r,o,a,c,i,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:me,this.minFilter=void 0!==a?a:me,this.flipY=!1,this.generateMipmaps=!1}}DepthTexture.prototype.isDepthTexture=!0;class CircleGeometry extends BufferGeometry{constructor(e=1,t=8,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},t=Math.max(3,t);const s=[],r=[],o=[],a=[],l=new Vector3,c=new Vector2;r.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let s=0,h=3;s<=t;s++,h+=3){const d=i+s/t*n;l.x=e*Math.cos(d),l.y=e*Math.sin(d),r.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(r[h]/e+1)/2,c.y=(r[h+1]/e+1)/2,a.push(c.x,c.y)}for(let e=1;e<=t;e++)s.push(e,e+1,0);this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(r,3)),this.setAttribute("normal",new Float32BufferAttribute(o,3)),this.setAttribute("uv",new Float32BufferAttribute(a,2))}}class CylinderGeometry extends BufferGeometry{constructor(e=1,t=1,i=1,n=8,s=1,r=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:s,openEnded:r,thetaStart:o,thetaLength:a};const l=this;n=Math.floor(n),s=Math.floor(s);const c=[],h=[],d=[],u=[];let p=0;const m=[],g=i/2;let f=0;function v(i){const s=p,r=new Vector2,m=new Vector3;let v=0;const y=!0===i?e:t,b=!0===i?1:-1;for(let e=1;e<=n;e++)h.push(0,g*b,0),d.push(0,b,0),u.push(.5,.5),p++;const S=p;for(let e=0;e<=n;e++){const t=e/n*a+o,i=Math.cos(t),s=Math.sin(t);m.x=y*s,m.y=g*b,m.z=y*i,h.push(m.x,m.y,m.z),d.push(0,b,0),r.x=.5*i+.5,r.y=.5*s*b+.5,u.push(r.x,r.y),p++}for(let e=0;e<n;e++){const t=s+e,n=S+e;!0===i?c.push(n,n+1,t):c.push(n+1,n,t),v+=3}l.addGroup(f,v,!0===i?1:2),f+=v}!function(){const r=new Vector3,v=new Vector3;let y=0;const b=(t-e)/i;for(let l=0;l<=s;l++){const c=[],f=l/s,y=f*(t-e)+e;for(let e=0;e<=n;e++){const t=e/n,s=t*a+o,l=Math.sin(s),m=Math.cos(s);v.x=y*l,v.y=-f*i+g,v.z=y*m,h.push(v.x,v.y,v.z),r.set(l,b,m).normalize(),d.push(r.x,r.y,r.z),u.push(t,1-f),c.push(p++)}m.push(c)}for(let e=0;e<n;e++)for(let t=0;t<s;t++){const i=m[t][e],n=m[t+1][e],s=m[t+1][e+1],r=m[t][e+1];c.push(i,n,r),c.push(n,s,r),y+=6}l.addGroup(f,y,0),f+=y}(),!1===r&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new Float32BufferAttribute(h,3)),this.setAttribute("normal",new Float32BufferAttribute(d,3)),this.setAttribute("uv",new Float32BufferAttribute(u,2))}}class ConeGeometry extends CylinderGeometry{constructor(e=1,t=1,i=8,n=1,s=!1,r=0,o=2*Math.PI){super(0,e,t,i,n,s,r,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:s,thetaStart:r,thetaLength:o}}}class PolyhedronGeometry extends BufferGeometry{constructor(e,t,i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};const s=[],r=[];function o(e,t,i,n){const s=n+1,r=[];for(let n=0;n<=s;n++){r[n]=[];const o=e.clone().lerp(i,n/s),a=t.clone().lerp(i,n/s),l=s-n;for(let e=0;e<=l;e++)r[n][e]=0===e&&n===s?o:o.clone().lerp(a,e/l)}for(let e=0;e<s;e++)for(let t=0;t<2*(s-e)-1;t++){const i=Math.floor(t/2);t%2==0?(a(r[e][i+1]),a(r[e+1][i]),a(r[e][i])):(a(r[e][i+1]),a(r[e+1][i+1]),a(r[e+1][i]))}}function a(e){s.push(e.x,e.y,e.z)}function l(t,i){const n=3*t;i.x=e[n+0],i.y=e[n+1],i.z=e[n+2]}function c(e,t,i,n){n<0&&1===e.x&&(r[t]=e.x-1),0===i.x&&0===i.z&&(r[t]=n/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}!function(e){const i=new Vector3,n=new Vector3,s=new Vector3;for(let r=0;r<t.length;r+=3)l(t[r+0],i),l(t[r+1],n),l(t[r+2],s),o(i,n,s,e)}(n),function(e){const t=new Vector3;for(let i=0;i<s.length;i+=3)t.x=s[i+0],t.y=s[i+1],t.z=s[i+2],t.normalize().multiplyScalar(e),s[i+0]=t.x,s[i+1]=t.y,s[i+2]=t.z}(i),function(){const e=new Vector3;for(let i=0;i<s.length;i+=3){e.x=s[i+0],e.y=s[i+1],e.z=s[i+2];const n=h(e)/2/Math.PI+.5,o=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);r.push(n,1-o)}var t;(function(){const e=new Vector3,t=new Vector3,i=new Vector3,n=new Vector3,o=new Vector2,a=new Vector2,l=new Vector2;for(let d=0,u=0;d<s.length;d+=9,u+=6){e.set(s[d+0],s[d+1],s[d+2]),t.set(s[d+3],s[d+4],s[d+5]),i.set(s[d+6],s[d+7],s[d+8]),o.set(r[u+0],r[u+1]),a.set(r[u+2],r[u+3]),l.set(r[u+4],r[u+5]),n.copy(e).add(t).add(i).divideScalar(3);const p=h(n);c(o,u+0,e,p),c(a,u+2,t,p),c(l,u+4,i,p)}})(),function(){for(let e=0;e<r.length;e+=6){const t=r[e+0],i=r[e+2],n=r[e+4],s=Math.max(t,i,n),o=Math.min(t,i,n);s>.9&&o<.1&&(t<.2&&(r[e+0]+=1),i<.2&&(r[e+2]+=1),n<.2&&(r[e+4]+=1))}}()}(),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(s.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(r,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}}const Ga=new Vector3,za=new Vector3,Wa=new Vector3,ja=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(e,t){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,!0===e.isGeometry)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const i=Math.pow(10,4),n=Math.cos(Bi*t),s=e.getIndex(),r=e.getAttribute("position"),o=s?s.count:r.count,a=[0,0,0],l=["a","b","c"],c=new Array(3),h={},d=[];for(let e=0;e<o;e+=3){s?(a[0]=s.getX(e),a[1]=s.getX(e+1),a[2]=s.getX(e+2)):(a[0]=e,a[1]=e+1,a[2]=e+2);const{a:t,b:o,c:u}=ja;if(t.fromBufferAttribute(r,a[0]),o.fromBufferAttribute(r,a[1]),u.fromBufferAttribute(r,a[2]),ja.getNormal(Wa),c[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,c[1]=`${Math.round(o.x*i)},${Math.round(o.y*i)},${Math.round(o.z*i)}`,c[2]=`${Math.round(u.x*i)},${Math.round(u.y*i)},${Math.round(u.z*i)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let e=0;e<3;e++){const t=(e+1)%3,i=c[e],s=c[t],r=ja[l[e]],o=ja[l[t]],u=`${i}_${s}`,p=`${s}_${i}`;p in h&&h[p]?(Wa.dot(h[p].normal)<=n&&(d.push(r.x,r.y,r.z),d.push(o.x,o.y,o.z)),h[p]=null):u in h||(h[u]={index0:a[e],index1:a[t],normal:Wa.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:i}=h[e];Ga.fromBufferAttribute(r,t),za.fromBufferAttribute(r,i),d.push(Ga.x,Ga.y,Ga.z),d.push(za.x,za.y,za.z)}this.setAttribute("position",new Float32BufferAttribute(d,3))}}const Ka=function(e,t,i){i=i||2;const n=t&&t.length,s=n?t[0]*i:e.length;let r=qa(e,0,s,i,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c,h,d,u,p;if(n&&(r=function(e,t,i,n){const s=[];let r,o,a,l,c;for(r=0,o=t.length;r<o;r++)a=t[r]*n,l=r<o-1?t[r+1]*n:e.length,c=qa(e,a,l,n,!1),c===c.next&&(c.steiner=!0),s.push(sl(c));for(s.sort(el),r=0;r<s.length;r++)tl(s[r],i),i=Za(i,i.next);return i}(e,t,r,i)),e.length>80*i){a=c=e[0],l=h=e[1];for(let t=i;t<s;t+=i)d=e[t],u=e[t+1],d<a&&(a=d),u<l&&(l=u),d>c&&(c=d),u>h&&(h=u);p=Math.max(c-a,h-l),p=0!==p?1/p:0}return Ya(r,o,i,a,l,p),o};function qa(e,t,i,n,s){let r,o;if(s===function(e,t,i,n){let s=0;for(let r=t,o=i-n;r<i;r+=n)s+=(e[o]-e[r])*(e[r+1]+e[o+1]),o=r;return s}(e,t,i,n)>0)for(r=t;r<i;r+=n)o=ml(r,e[r],e[r+1],o);else for(r=i-n;r>=t;r-=n)o=ml(r,e[r],e[r+1],o);return o&&ll(o,o.next)&&(gl(o),o=o.next),o}function Za(e,t){if(!e)return e;t||(t=e);let i,n=e;do{if(i=!1,n.steiner||!ll(n,n.next)&&0!==al(n.prev,n,n.next))n=n.next;else{if(gl(n),n=t=n.prev,n===n.next)break;i=!0}}while(i||n!==t);return t}function Ya(e,t,i,n,s,r,o){if(!e)return;!o&&r&&function(e,t,i,n){let s=e;do{null===s.z&&(s.z=nl(s.x,s.y,t,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){let t,i,n,s,r,o,a,l,c=1;do{for(i=e,e=null,r=null,o=0;i;){for(o++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ,n);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(s=i,i=i.nextZ,a--):(s=n,n=n.nextZ,l--),r?r.nextZ=s:e=s,s.prevZ=r,r=s;i=n}r.nextZ=null,c*=2}while(o>1)}(s)}(e,n,s,r);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,r?Qa(e,n,s,r):$a(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),gl(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?Ya(e=Xa(Za(e),t,i),t,i,n,s,r,2):2===o&&Ja(e,t,i,n,s,r):Ya(Za(e),t,i,n,s,r,1);break}}function $a(e){const t=e.prev,i=e,n=e.next;if(al(t,i,n)>=0)return!1;let s=e.next.next;for(;s!==e.prev;){if(rl(t.x,t.y,i.x,i.y,n.x,n.y,s.x,s.y)&&al(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function Qa(e,t,i,n){const s=e.prev,r=e,o=e.next;if(al(s,r,o)>=0)return!1;const a=s.x<r.x?s.x<o.x?s.x:o.x:r.x<o.x?r.x:o.x,l=s.y<r.y?s.y<o.y?s.y:o.y:r.y<o.y?r.y:o.y,c=s.x>r.x?s.x>o.x?s.x:o.x:r.x>o.x?r.x:o.x,h=s.y>r.y?s.y>o.y?s.y:o.y:r.y>o.y?r.y:o.y,d=nl(a,l,t,i,n),u=nl(c,h,t,i,n);let p=e.prevZ,m=e.nextZ;for(;p&&p.z>=d&&m&&m.z<=u;){if(p!==e.prev&&p!==e.next&&rl(s.x,s.y,r.x,r.y,o.x,o.y,p.x,p.y)&&al(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==e.prev&&m!==e.next&&rl(s.x,s.y,r.x,r.y,o.x,o.y,m.x,m.y)&&al(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&rl(s.x,s.y,r.x,r.y,o.x,o.y,p.x,p.y)&&al(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=u;){if(m!==e.prev&&m!==e.next&&rl(s.x,s.y,r.x,r.y,o.x,o.y,m.x,m.y)&&al(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function Xa(e,t,i){let n=e;do{const s=n.prev,r=n.next.next;!ll(s,r)&&cl(s,n,n.next,r)&&ul(s,r)&&ul(r,s)&&(t.push(s.i/i),t.push(n.i/i),t.push(r.i/i),gl(n),gl(n.next),n=e=r),n=n.next}while(n!==e);return Za(n)}function Ja(e,t,i,n,s,r){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&ol(o,e)){let a=pl(o,e);return o=Za(o,o.next),a=Za(a,a.next),Ya(o,t,i,n,s,r),void Ya(a,t,i,n,s,r)}e=e.next}o=o.next}while(o!==e)}function el(e,t){return e.x-t.x}function tl(e,t){if(t=function(e,t){let i=t;const n=e.x,s=e.y;let r,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const e=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=n&&e>o){if(o=e,e===n){if(s===i.y)return i;if(s===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===o)return r;const a=r,l=r.x,c=r.y;let h,d=1/0;i=r;do{n>=i.x&&i.x>=l&&n!==i.x&&rl(s<c?n:o,s,l,c,s<c?o:n,s,i.x,i.y)&&(h=Math.abs(s-i.y)/(n-i.x),ul(i,e)&&(h<d||h===d&&(i.x>r.x||i.x===r.x&&il(r,i)))&&(r=i,d=h)),i=i.next}while(i!==a);return r}(e,t)){const i=pl(t,e);Za(t,t.next),Za(i,i.next)}}function il(e,t){return al(e.prev,e,t.prev)<0&&al(t.next,e,e.next)<0}function nl(e,t,i,n,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function sl(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function rl(e,t,i,n,s,r,o,a){return(s-o)*(t-a)-(e-o)*(r-a)>=0&&(e-o)*(n-a)-(i-o)*(t-a)>=0&&(i-o)*(r-a)-(s-o)*(n-a)>=0}function ol(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&cl(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(ul(e,t)&&ul(t,e)&&function(e,t){let i=e,n=!1;const s=(e.x+t.x)/2,r=(e.y+t.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&s<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(al(e.prev,e,t.prev)||al(e,t.prev,t))||ll(e,t)&&al(e.prev,e,e.next)>0&&al(t.prev,t,t.next)>0)}function al(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function ll(e,t){return e.x===t.x&&e.y===t.y}function cl(e,t,i,n){const s=dl(al(e,t,i)),r=dl(al(e,t,n)),o=dl(al(i,n,e)),a=dl(al(i,n,t));return s!==r&&o!==a||(!(0!==s||!hl(e,i,t))||(!(0!==r||!hl(e,n,t))||(!(0!==o||!hl(i,e,n))||!(0!==a||!hl(i,t,n)))))}function hl(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function dl(e){return e>0?1:e<0?-1:0}function ul(e,t){return al(e.prev,e,e.next)<0?al(e,t,e.next)>=0&&al(e,e.prev,t)>=0:al(e,t,e.prev)<0||al(e,e.next,t)<0}function pl(e,t){const i=new fl(e.i,e.x,e.y),n=new fl(t.i,t.x,t.y),s=e.next,r=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function ml(e,t,i,n){const s=new fl(e,t,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function gl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function fl(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class ShapeUtils{static area(e){const t=e.length;let i=0;for(let n=t-1,s=0;s<t;n=s++)i+=e[n].x*e[s].y-e[s].x*e[n].y;return.5*i}static isClockWise(e){return ShapeUtils.area(e)<0}static triangulateShape(e,t){const i=[],n=[],s=[];vl(e),yl(i,e);let r=e.length;t.forEach(vl);for(let e=0;e<t.length;e++)n.push(r),r+=t[e].length,yl(i,t[e]);const o=Ka(i,n);for(let e=0;e<o.length;e+=3)s.push(o.slice(e,e+3));return s}}function vl(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function yl(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class ExtrudeGeometry extends BufferGeometry{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,n=[],s=[];for(let t=0,i=e.length;t<i;t++){r(e[t])}function r(e){const r=[],o=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:6,d=void 0!==t.bevelSize?t.bevelSize:h-2,u=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const m=t.extrudePath,g=void 0!==t.UVGenerator?t.UVGenerator:bl;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let f,v,y,b,S,E=!1;m&&(f=m.getSpacedPoints(a),E=!0,c=!1,v=m.computeFrenetFrames(a,!1),y=new Vector3,b=new Vector3,S=new Vector3),c||(p=0,h=0,d=0,u=0);const w=e.extractPoints(o);let T=w.shape;const _=w.holes;if(!ShapeUtils.isClockWise(T)){T=T.reverse();for(let e=0,t=_.length;e<t;e++){const t=_[e];ShapeUtils.isClockWise(t)&&(_[e]=t.reverse())}}const M=ShapeUtils.triangulateShape(T,_),x=T;for(let e=0,t=_.length;e<t;e++){const t=_[e];T=T.concat(t)}function A(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}const O=T.length,P=M.length;function D(e,t,i){let n,s,r;const o=e.x-t.x,a=e.y-t.y,l=i.x-e.x,c=i.y-e.y,h=o*o+a*a,d=o*c-a*l;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(h),u=Math.sqrt(l*l+c*c),p=t.x-a/d,m=t.y+o/d,g=((i.x-c/u-p)*c-(i.y+l/u-m)*l)/(o*c-a*l);n=p+o*g-e.x,s=m+a*g-e.y;const f=n*n+s*s;if(f<=2)return new Vector2(n,s);r=Math.sqrt(f/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(n=-a,s=o,r=Math.sqrt(h)):(n=o,s=a,r=Math.sqrt(h/2))}return new Vector2(n/r,s/r)}const C=[];for(let e=0,t=x.length,i=t-1,n=e+1;e<t;e++,i++,n++)i===t&&(i=0),n===t&&(n=0),C[e]=D(x[e],x[i],x[n]);const I=[];let L,R=C.concat();for(let e=0,t=_.length;e<t;e++){const t=_[e];L=[];for(let e=0,i=t.length,n=i-1,s=e+1;e<i;e++,n++,s++)n===i&&(n=0),s===i&&(s=0),L[e]=D(t[e],t[n],t[s]);I.push(L),R=R.concat(L)}for(let e=0;e<p;e++){const t=e/p,i=h*Math.cos(t*Math.PI/2),n=d*Math.sin(t*Math.PI/2)+u;for(let e=0,t=x.length;e<t;e++){const t=A(x[e],C[e],n);B(t.x,t.y,-i)}for(let e=0,t=_.length;e<t;e++){const t=_[e];L=I[e];for(let e=0,s=t.length;e<s;e++){const s=A(t[e],L[e],n);B(s.x,s.y,-i)}}}const N=d+u;for(let e=0;e<O;e++){const t=c?A(T[e],R[e],N):T[e];E?(b.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),S.copy(f[0]).add(b).add(y),B(S.x,S.y,S.z)):B(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<O;t++){const i=c?A(T[t],R[t],N):T[t];E?(b.copy(v.normals[e]).multiplyScalar(i.x),y.copy(v.binormals[e]).multiplyScalar(i.y),S.copy(f[e]).add(b).add(y),B(S.x,S.y,S.z)):B(i.x,i.y,l/a*e)}for(let e=p-1;e>=0;e--){const t=e/p,i=h*Math.cos(t*Math.PI/2),n=d*Math.sin(t*Math.PI/2)+u;for(let e=0,t=x.length;e<t;e++){const t=A(x[e],C[e],n);B(t.x,t.y,l+i)}for(let e=0,t=_.length;e<t;e++){const t=_[e];L=I[e];for(let e=0,s=t.length;e<s;e++){const s=A(t[e],L[e],n);E?B(s.x,s.y+f[a-1].y,f[a-1].x+i):B(s.x,s.y,l+i)}}}function k(e,t){let i=e.length;for(;--i>=0;){const n=i;let s=i-1;s<0&&(s=e.length-1);for(let e=0,i=a+2*p;e<i;e++){const i=O*e,r=O*(e+1);U(t+n+i,t+s+i,t+s+r,t+n+r)}}}function B(e,t,i){r.push(e),r.push(t),r.push(i)}function F(e,t,s){V(e),V(t),V(s);const r=n.length/3,o=g.generateTopUV(i,n,r-3,r-2,r-1);H(o[0]),H(o[1]),H(o[2])}function U(e,t,s,r){V(e),V(t),V(r),V(t),V(s),V(r);const o=n.length/3,a=g.generateSideWallUV(i,n,o-6,o-3,o-2,o-1);H(a[0]),H(a[1]),H(a[3]),H(a[1]),H(a[2]),H(a[3])}function V(e){n.push(r[3*e+0]),n.push(r[3*e+1]),n.push(r[3*e+2])}function H(e){s.push(e.x),s.push(e.y)}!function(){const e=n.length/3;if(c){let e=0,t=O*e;for(let e=0;e<P;e++){const i=M[e];F(i[2]+t,i[1]+t,i[0]+t)}e=a+2*p,t=O*e;for(let e=0;e<P;e++){const i=M[e];F(i[0]+t,i[1]+t,i[2]+t)}}else{for(let e=0;e<P;e++){const t=M[e];F(t[2],t[1],t[0])}for(let e=0;e<P;e++){const t=M[e];F(t[0]+O*a,t[1]+O*a,t[2]+O*a)}}i.addGroup(e,n.length/3-e,0)}(),function(){const e=n.length/3;let t=0;k(x,t),t+=x.length;for(let e=0,i=_.length;e<i;e++){const i=_[e];k(i,t),t+=i.length}i.addGroup(e,n.length/3-e,1)}()}this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("uv",new Float32BufferAttribute(s,2)),this.computeVertexNormals()}toJSON(){const e=BufferGeometry.prototype.toJSON.call(this);return function(e,t,i){if(i.shapes=[],Array.isArray(e))for(let t=0,n=e.length;t<n;t++){const n=e[t];i.shapes.push(n.uuid)}else i.shapes.push(e.uuid);void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,e)}}const bl={generateTopUV:function(e,t,i,n,s){const r=t[3*i],o=t[3*i+1],a=t[3*n],l=t[3*n+1],c=t[3*s],h=t[3*s+1];return[new Vector2(r,o),new Vector2(a,l),new Vector2(c,h)]},generateSideWallUV:function(e,t,i,n,s,r){const o=t[3*i],a=t[3*i+1],l=t[3*i+2],c=t[3*n],h=t[3*n+1],d=t[3*n+2],u=t[3*s],p=t[3*s+1],m=t[3*s+2],g=t[3*r],f=t[3*r+1],v=t[3*r+2];return Math.abs(a-h)<.01?[new Vector2(o,1-l),new Vector2(c,1-d),new Vector2(u,1-m),new Vector2(g,1-v)]:[new Vector2(a,1-l),new Vector2(h,1-d),new Vector2(p,1-m),new Vector2(f,1-v)]}};class IcosahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}}class LatheGeometry extends BufferGeometry{constructor(e,t=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=Vi(n,0,2*Math.PI);const s=[],r=[],o=[],a=1/t,l=new Vector3,c=new Vector2;for(let s=0;s<=t;s++){const h=i+s*a*n,d=Math.sin(h),u=Math.cos(h);for(let i=0;i<=e.length-1;i++)l.x=e[i].x*d,l.y=e[i].y,l.z=e[i].x*u,r.push(l.x,l.y,l.z),c.x=s/t,c.y=i/(e.length-1),o.push(c.x,c.y)}for(let i=0;i<t;i++)for(let t=0;t<e.length-1;t++){const n=t+i*e.length,r=n,o=n+e.length,a=n+e.length+1,l=n+1;s.push(r,o,l),s.push(o,a,l)}if(this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(r,3)),this.setAttribute("uv",new Float32BufferAttribute(o,2)),this.computeVertexNormals(),n===2*Math.PI){const i=this.attributes.normal.array,n=new Vector3,s=new Vector3,r=new Vector3,o=t*e.length*3;for(let t=0,a=0;t<e.length;t++,a+=3)n.x=i[a+0],n.y=i[a+1],n.z=i[a+2],s.x=i[o+a+0],s.y=i[o+a+1],s.z=i[o+a+2],r.addVectors(n,s).normalize(),i[a+0]=i[o+a+0]=r.x,i[a+1]=i[o+a+1]=r.y,i[a+2]=i[o+a+2]=r.z}}}class OctahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}}class ParametricGeometry extends BufferGeometry{constructor(e,t,i){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i};const n=[],s=[],r=[],o=[],a=1e-5,l=new Vector3,c=new Vector3,h=new Vector3,d=new Vector3,u=new Vector3;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=t+1;for(let n=0;n<=i;n++){const p=n/i;for(let i=0;i<=t;i++){const n=i/t;e(n,p,c),s.push(c.x,c.y,c.z),n-a>=0?(e(n-a,p,h),d.subVectors(c,h)):(e(n+a,p,h),d.subVectors(h,c)),p-a>=0?(e(n,p-a,h),u.subVectors(c,h)):(e(n,p+a,h),u.subVectors(h,c)),l.crossVectors(d,u).normalize(),r.push(l.x,l.y,l.z),o.push(n,p)}}for(let e=0;e<i;e++)for(let i=0;i<t;i++){const t=e*p+i,s=e*p+i+1,r=(e+1)*p+i+1,o=(e+1)*p+i;n.push(t,s,o),n.push(s,r,o)}this.setIndex(n),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(r,3)),this.setAttribute("uv",new Float32BufferAttribute(o,2))}}class RingGeometry extends BufferGeometry{constructor(e=.5,t=1,i=8,n=1,s=0,r=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:s,thetaLength:r},i=Math.max(3,i);const o=[],a=[],l=[],c=[];let h=e;const d=(t-e)/(n=Math.max(1,n)),u=new Vector3,p=new Vector2;for(let e=0;e<=n;e++){for(let e=0;e<=i;e++){const n=s+e/i*r;u.x=h*Math.cos(n),u.y=h*Math.sin(n),a.push(u.x,u.y,u.z),l.push(0,0,1),p.x=(u.x/t+1)/2,p.y=(u.y/t+1)/2,c.push(p.x,p.y)}h+=d}for(let e=0;e<n;e++){const t=e*(i+1);for(let e=0;e<i;e++){const n=e+t,s=n,r=n+i+1,a=n+i+2,l=n+1;o.push(s,r,l),o.push(r,a,l)}}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}}class ShapeGeometry extends BufferGeometry{constructor(e,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],n=[],s=[],r=[];let o=0,a=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(o,a,t),o+=a,a=0;function l(e){const o=n.length/3,l=e.extractPoints(t);let c=l.shape;const h=l.holes;!1===ShapeUtils.isClockWise(c)&&(c=c.reverse());for(let e=0,t=h.length;e<t;e++){const t=h[e];!0===ShapeUtils.isClockWise(t)&&(h[e]=t.reverse())}const d=ShapeUtils.triangulateShape(c,h);for(let e=0,t=h.length;e<t;e++){const t=h[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];n.push(t.x,t.y,0),s.push(0,0,1),r.push(t.x,t.y)}for(let e=0,t=d.length;e<t;e++){const t=d[e],n=t[0]+o,s=t[1]+o,r=t[2]+o;i.push(n,s,r),a+=3}}this.setIndex(i),this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("normal",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(r,2))}toJSON(){const e=BufferGeometry.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,n=e.length;i<n;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class SphereGeometry extends BufferGeometry{constructor(e=1,t=8,i=6,n=0,s=2*Math.PI,r=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:s,thetaStart:r,thetaLength:o},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const a=Math.min(r+o,Math.PI);let l=0;const c=[],h=new Vector3,d=new Vector3,u=[],p=[],m=[],g=[];for(let u=0;u<=i;u++){const f=[],v=u/i;let y=0;0==u&&0==r?y=.5/t:u==i&&a==Math.PI&&(y=-.5/t);for(let i=0;i<=t;i++){const a=i/t;h.x=-e*Math.cos(n+a*s)*Math.sin(r+v*o),h.y=e*Math.cos(r+v*o),h.z=e*Math.sin(n+a*s)*Math.sin(r+v*o),p.push(h.x,h.y,h.z),d.copy(h).normalize(),m.push(d.x,d.y,d.z),g.push(a+y,1-v),f.push(l++)}c.push(f)}for(let e=0;e<i;e++)for(let n=0;n<t;n++){const t=c[e][n+1],s=c[e][n],o=c[e+1][n],l=c[e+1][n+1];(0!==e||r>0)&&u.push(t,s,l),(e!==i-1||a<Math.PI)&&u.push(s,o,l)}this.setIndex(u),this.setAttribute("position",new Float32BufferAttribute(p,3)),this.setAttribute("normal",new Float32BufferAttribute(m,3)),this.setAttribute("uv",new Float32BufferAttribute(g,2))}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}}class TextGeometry extends ExtrudeGeometry{constructor(e,t={}){const i=t.font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new BufferGeometry;const n=i.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(n,t),this.type="TextGeometry"}}class TorusGeometry extends BufferGeometry{constructor(e=1,t=.4,i=8,n=6,s=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:s},i=Math.floor(i),n=Math.floor(n);const r=[],o=[],a=[],l=[],c=new Vector3,h=new Vector3,d=new Vector3;for(let r=0;r<=i;r++)for(let u=0;u<=n;u++){const p=u/n*s,m=r/i*Math.PI*2;h.x=(e+t*Math.cos(m))*Math.cos(p),h.y=(e+t*Math.cos(m))*Math.sin(p),h.z=t*Math.sin(m),o.push(h.x,h.y,h.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),d.subVectors(h,c).normalize(),a.push(d.x,d.y,d.z),l.push(u/n),l.push(r/i)}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){const i=(n+1)*e+t-1,s=(n+1)*(e-1)+t-1,o=(n+1)*(e-1)+t,a=(n+1)*e+t;r.push(i,s,a),r.push(s,o,a)}this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(a,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2))}}class TorusKnotGeometry extends BufferGeometry{constructor(e=1,t=.4,i=64,n=8,s=2,r=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:s,q:r},i=Math.floor(i),n=Math.floor(n);const o=[],a=[],l=[],c=[],h=new Vector3,d=new Vector3,u=new Vector3,p=new Vector3,m=new Vector3,g=new Vector3,f=new Vector3;for(let o=0;o<=i;++o){const y=o/i*s*Math.PI*2;v(y,s,r,e,u),v(y+.01,s,r,e,p),g.subVectors(p,u),f.addVectors(p,u),m.crossVectors(g,f),f.crossVectors(m,g),m.normalize(),f.normalize();for(let e=0;e<=n;++e){const s=e/n*Math.PI*2,r=-t*Math.cos(s),p=t*Math.sin(s);h.x=u.x+(r*f.x+p*m.x),h.y=u.y+(r*f.y+p*m.y),h.z=u.z+(r*f.z+p*m.z),a.push(h.x,h.y,h.z),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(o/i),c.push(e/n)}}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){const i=(n+1)*(e-1)+(t-1),s=(n+1)*e+(t-1),r=(n+1)*e+t,a=(n+1)*(e-1)+t;o.push(i,s,a),o.push(s,r,a)}function v(e,t,i,n,s){const r=Math.cos(e),o=Math.sin(e),a=i/t*e,l=Math.cos(a);s.x=n*(2+l)*.5*r,s.y=n*(2+l)*o*.5,s.z=n*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}}class TubeGeometry extends BufferGeometry{constructor(e,t=64,i=1,n=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:s};const r=e.computeFrenetFrames(t,s);this.tangents=r.tangents,this.normals=r.normals,this.binormals=r.binormals;const o=new Vector3,a=new Vector3,l=new Vector2;let c=new Vector3;const h=[],d=[],u=[],p=[];function m(s){c=e.getPointAt(s/t,c);const l=r.normals[s],u=r.binormals[s];for(let e=0;e<=n;e++){const t=e/n*Math.PI*2,s=Math.sin(t),r=-Math.cos(t);a.x=r*l.x+s*u.x,a.y=r*l.y+s*u.y,a.z=r*l.z+s*u.z,a.normalize(),d.push(a.x,a.y,a.z),o.x=c.x+i*a.x,o.y=c.y+i*a.y,o.z=c.z+i*a.z,h.push(o.x,o.y,o.z)}}!function(){for(let e=0;e<t;e++)m(e);m(!1===s?t:0),function(){for(let e=0;e<=t;e++)for(let i=0;i<=n;i++)l.x=e/t,l.y=i/n,u.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=n;t++){const i=(n+1)*(e-1)+(t-1),s=(n+1)*e+(t-1),r=(n+1)*e+t,o=(n+1)*(e-1)+t;p.push(i,s,o),p.push(s,r,o)}}()}(),this.setIndex(p),this.setAttribute("position",new Float32BufferAttribute(h,3)),this.setAttribute("normal",new Float32BufferAttribute(d,3)),this.setAttribute("uv",new Float32BufferAttribute(u,2))}toJSON(){const e=BufferGeometry.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e}}class WireframeGeometry extends BufferGeometry{constructor(e){if(super(),this.type="WireframeGeometry",!0===e.isGeometry)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const t=[],i=[0,0],n={},s=new Vector3;if(null!==e.index){const r=e.attributes.position,o=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let e=0,t=a.length;e<t;++e){const t=a[e],s=t.start;for(let e=s,r=s+t.count;e<r;e+=3)for(let t=0;t<3;t++){const s=o.getX(e+t),r=o.getX(e+(t+1)%3);i[0]=Math.min(s,r),i[1]=Math.max(s,r);const a=i[0]+","+i[1];void 0===n[a]&&(n[a]={index1:i[0],index2:i[1]})}}for(const e in n){const i=n[e];s.fromBufferAttribute(r,i.index1),t.push(s.x,s.y,s.z),s.fromBufferAttribute(r,i.index2),t.push(s.x,s.y,s.z)}}else{const i=e.attributes.position;for(let e=0,n=i.count/3;e<n;e++)for(let n=0;n<3;n++){const r=3*e+n;s.fromBufferAttribute(i,r),t.push(s.x,s.y,s.z);const o=3*e+(n+1)%3;s.fromBufferAttribute(i,o),t.push(s.x,s.y,s.z)}}this.setAttribute("position",new Float32BufferAttribute(t,3))}}var Sl=Object.freeze({__proto__:null,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronGeometry,EdgesGeometry:EdgesGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeGeometry,WireframeGeometry:WireframeGeometry});class ShadowMaterial extends os{constructor(e){super(),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}ShadowMaterial.prototype.isShadowMaterial=!0;class RawShaderMaterial extends ShaderMaterial{constructor(e){super(e),this.type="RawShaderMaterial"}}RawShaderMaterial.prototype.isRawShaderMaterial=!0;class MeshStandardMaterial extends os{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this}}MeshStandardMaterial.prototype.isMeshStandardMaterial=!0;class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=Vi(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Color).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this}}MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0;class MeshPhongMaterial extends os{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}MeshPhongMaterial.prototype.isMeshPhongMaterial=!0;class MeshToonMaterial extends os{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}MeshToonMaterial.prototype.isMeshToonMaterial=!0;class MeshNormalMaterial extends os{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}MeshNormalMaterial.prototype.isMeshNormalMaterial=!0;class MeshLambertMaterial extends os{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}MeshLambertMaterial.prototype.isMeshLambertMaterial=!0;class MeshMatcapMaterial extends os{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0;class LineDashedMaterial extends LineBasicMaterial{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}LineDashedMaterial.prototype.isLineDashedMaterial=!0;var El=Object.freeze({__proto__:null,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:os});const wl={arraySlice:function(e,t,i){return wl.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,i=new Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort((function(t,i){return e[t]-e[i]})),i},sortedArray:function(e,t,i){const n=e.length,s=new e.constructor(n);for(let r=0,o=0;o!==n;++r){const n=i[r]*t;for(let i=0;i!==t;++i)s[o++]=e[n+i]}return s},flattenJSON:function(e,t,i,n){let s=1,r=e[0];for(;void 0!==r&&void 0===r[n];)r=e[s++];if(void 0===r)return;let o=r[n];if(void 0!==o)if(Array.isArray(o))do{o=r[n],void 0!==o&&(t.push(r.time),i.push.apply(i,o)),r=e[s++]}while(void 0!==r);else if(void 0!==o.toArray)do{o=r[n],void 0!==o&&(t.push(r.time),o.toArray(i,i.length)),r=e[s++]}while(void 0!==r);else do{o=r[n],void 0!==o&&(t.push(r.time),i.push(o)),r=e[s++]}while(void 0!==r)},subclip:function(e,t,i,n,s=30){const r=e.clone();r.name=t;const o=[];for(let e=0;e<r.tracks.length;++e){const t=r.tracks[e],a=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const r=t.times[e]*s;if(!(r<i||r>=n)){l.push(t.times[e]);for(let i=0;i<a;++i)c.push(t.values[e*a+i])}}0!==l.length&&(t.times=wl.convertArray(l,t.times.constructor),t.values=wl.convertArray(c,t.values.constructor),o.push(t))}r.tracks=o;let a=1/0;for(let e=0;e<r.tracks.length;++e)a>r.tracks[e].times[0]&&(a=r.tracks[e].times[0]);for(let e=0;e<r.tracks.length;++e)r.tracks[e].shift(-1*a);return r.resetDuration(),r},makeClipAdditive:function(e,t=0,i=e,n=30){n<=0&&(n=30);const s=i.tracks.length,r=t/n;for(let t=0;t<s;++t){const n=i.tracks[t],s=n.ValueTypeName;if("bool"===s||"string"===s)continue;const o=e.tracks.find((function(e){return e.name===n.name&&e.ValueTypeName===s}));if(void 0===o)continue;let a=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const d=n.times.length-1;let u;if(r<=n.times[0]){const e=a,t=l-a;u=wl.arraySlice(n.values,e,t)}else if(r>=n.times[d]){const e=d*l+a,t=e+l-a;u=wl.arraySlice(n.values,e,t)}else{const e=n.createInterpolant(),t=a,i=l-a;e.evaluate(r),u=wl.arraySlice(e.resultBuffer,t,i)}if("quaternion"===s){(new Quaternion).fromArray(u).normalize().conjugate().toArray(u)}const p=o.times.length;for(let e=0;e<p;++e){const t=e*h+c;if("quaternion"===s)Quaternion.multiplyQuaternionsFlat(o.values,t,u,0,o.values,t);else{const e=h-2*c;for(let i=0;i<e;++i)o.values[t+i]-=u[i]}}}return e.blendMode=Kt,e}};class Interpolant{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],s=t[i-1];e:{t:{let r;i:{n:if(!(e<n)){for(let r=i+2;;){if(void 0===n){if(e<s)break n;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,s)}if(i===r)break;if(s=n,n=t[++i],e<n)break t}r=t.length;break i}if(e>=s)break e;{const o=t[1];e<o&&(i=2,s=o);for(let r=i-2;;){if(void 0===s)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(i===r)break;if(n=s,s=t[--i-1],e>=s)break t}r=i,i=0}}for(;i<r;){const n=i+r>>>1;e<t[n]?r=n:i=n+1}if(n=t[i],s=t[i-1],void 0===s)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,s,e)}this._cachedIndex=i,this.intervalChanged_(i,s,n)}return this.interpolate_(i,s,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=e*n;for(let e=0;e!==n;++e)t[e]=i[s+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Interpolant.prototype.beforeStart_=Interpolant.prototype.copySampleValue_,Interpolant.prototype.afterEnd_=Interpolant.prototype.copySampleValue_;class CubicInterpolant extends Interpolant{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Gt,endingEnd:Gt}}intervalChanged_(e,t,i){const n=this.parameterPositions;let s=e-2,r=e+1,o=n[s],a=n[r];if(void 0===o)switch(this.getSettings_().endingStart){case zt:s=e,o=2*t-i;break;case Wt:s=n.length-2,o=t+n[s]-n[s+1];break;default:s=e,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case zt:r=e,a=2*i-t;break;case Wt:r=1,a=i+n[1]-n[0];break;default:r=e-1,a=t}const l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(a-i),this._offsetPrev=s*c,this._offsetNext=r*c}interpolate_(e,t,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,u=this._weightNext,p=(i-t)/(n-t),m=p*p,g=m*p,f=-d*g+2*d*m-d*p,v=(1+d)*g+(-1.5-2*d)*m+(-.5+d)*p+1,y=(-1-u)*g+(1.5+u)*m+.5*p,b=u*g-u*m;for(let e=0;e!==o;++e)s[e]=f*r[c+e]+v*r[l+e]+y*r[a+e]+b*r[h+e];return s}}class LinearInterpolant extends Interpolant{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=(i-t)/(n-t),h=1-c;for(let e=0;e!==o;++e)s[e]=r[l+e]*h+r[a+e]*c;return s}}class DiscreteInterpolant extends Interpolant{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class KeyframeTrack{constructor(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=wl.convertArray(t,this.TimeBufferType),this.values=wl.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:wl.convertArray(e.times,Array),values:wl.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(i.interpolation=t)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ut:t=this.InterpolantFactoryMethodDiscrete;break;case Vt:t=this.InterpolantFactoryMethodLinear;break;case Ht:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ut;case this.InterpolantFactoryMethodLinear:return Vt;case this.InterpolantFactoryMethodSmooth:return Ht}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let s=0,r=n-1;for(;s!==n&&i[s]<e;)++s;for(;-1!==r&&i[r]>t;)--r;if(++r,0!==s||r!==n){s>=r&&(r=Math.max(r,1),s=r-1);const e=this.getValueSize();this.times=wl.arraySlice(i,s,r),this.values=wl.arraySlice(this.values,s*e,r*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,s=i.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let r=null;for(let t=0;t!==s;t++){const n=i[t];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,n),e=!1;break}if(null!==r&&r>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,n,r),e=!1;break}r=n}if(void 0!==n&&wl.isTypedArray(n))for(let t=0,i=n.length;t!==i;++t){const i=n[t];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,i),e=!1;break}}return e}optimize(){const e=wl.arraySlice(this.times),t=wl.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===Ht,s=e.length-1;let r=1;for(let o=1;o<s;++o){let s=!1;const a=e[o];if(a!==e[o+1]&&(1!==o||a!==e[0]))if(n)s=!0;else{const e=o*i,n=e-i,r=e+i;for(let o=0;o!==i;++o){const i=t[e+o];if(i!==t[n+o]||i!==t[r+o]){s=!0;break}}}if(s){if(o!==r){e[r]=e[o];const n=o*i,s=r*i;for(let e=0;e!==i;++e)t[s+e]=t[n+e]}++r}}if(s>0){e[r]=e[s];for(let e=s*i,n=r*i,o=0;o!==i;++o)t[n+o]=t[e+o];++r}return r!==e.length?(this.times=wl.arraySlice(e,0,r),this.values=wl.arraySlice(t,0,r*i)):(this.times=e,this.values=t),this}clone(){const e=wl.arraySlice(this.times,0),t=wl.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}KeyframeTrack.prototype.TimeBufferType=Float32Array,KeyframeTrack.prototype.ValueBufferType=Float32Array,KeyframeTrack.prototype.DefaultInterpolation=Vt;class BooleanKeyframeTrack extends KeyframeTrack{}BooleanKeyframeTrack.prototype.ValueTypeName="bool",BooleanKeyframeTrack.prototype.ValueBufferType=Array,BooleanKeyframeTrack.prototype.DefaultInterpolation=Ut,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=(i-t)/(n-t);let l=e*o;for(let e=l+o;l!==e;l+=4)Quaternion.slerpFlat(s,0,r,l-o,r,l,a);return s}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion",QuaternionKeyframeTrack.prototype.DefaultInterpolation=Vt,QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{}StringKeyframeTrack.prototype.ValueTypeName="string",StringKeyframeTrack.prototype.ValueBufferType=Array,StringKeyframeTrack.prototype.DefaultInterpolation=Ut,StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(e,t=-1,i,n=jt){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=Ui(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let e=0,s=i.length;e!==s;++e)t.push(Tl(i[e]).scale(n));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,n=i.length;e!==n;++e)t.push(KeyframeTrack.toJSON(i[e]));return n}static CreateFromMorphTargetSequence(e,t,i,n){const s=t.length,r=[];for(let e=0;e<s;e++){let o=[],a=[];o.push((e+s-1)%s,e,(e+1)%s),a.push(0,1,0);const l=wl.getKeyframeOrder(o);o=wl.sortedArray(o,1,l),a=wl.sortedArray(a,1,l),n||0!==o[0]||(o.push(s),a.push(a[0])),r.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[e].name+"]",o,a).scale(1/i))}return new this(e,-1,r)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},s=/^([\w-]*?)([\d]+)$/;for(let t=0,i=e.length;t<i;t++){const i=e[t],r=i.name.match(s);if(r&&r.length>1){const e=r[1];let t=n[e];t||(n[e]=t=[]),t.push(i)}}const r=[];for(const e in n)r.push(this.CreateFromMorphTargetSequence(e,n[e],t,i));return r}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(e,t,i,n,s){if(0!==i.length){const r=[],o=[];wl.flattenJSON(i,r,o,n),0!==r.length&&s.push(new e(t,r,o))}},n=[],s=e.name||"default",r=e.fps||30,o=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const s=l[e].keys;if(s&&0!==s.length)if(s[0].morphTargets){const e={};let t;for(t=0;t<s.length;t++)if(s[t].morphTargets)for(let i=0;i<s[t].morphTargets.length;i++)e[s[t].morphTargets[i]]=-1;for(const i in e){const e=[],r=[];for(let n=0;n!==s[t].morphTargets.length;++n){const n=s[t];e.push(n.time),r.push(n.morphTarget===i?1:0)}n.push(new NumberKeyframeTrack(".morphTargetInfluence["+i+"]",e,r))}a=e.length*(r||1)}else{const r=".bones["+t[e].name+"]";i(VectorKeyframeTrack,r+".position",s,"pos",n),i(QuaternionKeyframeTrack,r+".quaternion",s,"rot",n),i(VectorKeyframeTrack,r+".scale",s,"scl",n)}}if(0===n.length)return null;return new this(s,a,n,o)}resetDuration(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){const i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Tl(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],i=[];wl.flattenJSON(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const _l={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class LoadingManager{constructor(e,t,i){const n=this;let s,r=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===r&&void 0!==n.onStart&&n.onStart(e,o,a),r=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,a),o===a&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){const i=l[t],n=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null}}}const Ml=new LoadingManager;class Loader{constructor(e){this.manager=void 0!==e?e:Ml,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise((function(n,s){i.load(e,n,t,s)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const xl={};class FileLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,r=_l.get(e);if(void 0!==r)return s.manager.itemStart(e),setTimeout((function(){t&&t(r),s.manager.itemEnd(e)}),0),r;if(void 0!==xl[e])return void xl[e].push({onLoad:t,onProgress:i,onError:n});const o=e.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(o){const i=o[1],r=!!o[2];let a=o[3];a=decodeURIComponent(a),r&&(a=atob(a));try{let n;const r=(this.responseType||"").toLowerCase();switch(r){case"arraybuffer":case"blob":const e=new Uint8Array(a.length);for(let t=0;t<a.length;t++)e[t]=a.charCodeAt(t);n="blob"===r?new Blob([e.buffer],{type:i}):e.buffer;break;case"document":const t=new DOMParser;n=t.parseFromString(a,i);break;case"json":n=JSON.parse(a);break;default:n=a}setTimeout((function(){t&&t(n),s.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){n&&n(t),s.manager.itemError(e),s.manager.itemEnd(e)}),0)}}else{xl[e]=[],xl[e].push({onLoad:t,onProgress:i,onError:n}),a=new XMLHttpRequest,a.open("GET",e,!0),a.addEventListener("load",(function(t){const i=this.response,n=xl[e];if(delete xl[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),_l.add(e,i);for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onLoad&&t.onLoad(i)}s.manager.itemEnd(e)}else{for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}s.manager.itemError(e),s.manager.itemEnd(e)}}),!1),a.addEventListener("progress",(function(t){const i=xl[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onProgress&&n.onProgress(t)}}),!1),a.addEventListener("error",(function(t){const i=xl[e];delete xl[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}s.manager.itemError(e),s.manager.itemEnd(e)}),!1),a.addEventListener("abort",(function(t){const i=xl[e];delete xl[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}s.manager.itemError(e),s.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)a.setRequestHeader(e,this.requestHeader[e]);a.send(null)}return s.manager.itemStart(e),a}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class AnimationLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=this,r=new FileLoader(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(i){try{t(s.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}}),i,n)}parse(e){const t=[];for(let i=0;i<e.length;i++){const n=AnimationClip.parse(e[i]);t.push(n)}return t}}class CompressedTextureLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=this,r=[],o=new CompressedTexture,a=new FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(s.withCredentials);let l=0;function c(c){a.load(e[c],(function(e){const i=s.parse(e,!0);r[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(o.minFilter=be),o.image=r,o.format=i.format,o.needsUpdate=!0,t&&t(o))}),i,n)}if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)c(t);else a.load(e,(function(e){const i=s.parse(e,!0);if(i.isCubemap){const e=i.mipmaps.length/i.mipmapCount;for(let t=0;t<e;t++){r[t]={mipmaps:[]};for(let e=0;e<i.mipmapCount;e++)r[t].mipmaps.push(i.mipmaps[t*i.mipmapCount+e]),r[t].format=i.format,r[t].width=i.width,r[t].height=i.height}o.image=r}else o.image.width=i.width,o.image.height=i.height,o.mipmaps=i.mipmaps;1===i.mipmapCount&&(o.minFilter=be),o.format=i.format,o.needsUpdate=!0,t&&t(o)}),i,n);return o}}class ImageLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,r=_l.get(e);if(void 0!==r)return s.manager.itemStart(e),setTimeout((function(){t&&t(r),s.manager.itemEnd(e)}),0),r;const o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),_l.add(e,this),t&&t(this),s.manager.itemEnd(e)}function l(t){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),n&&n(t),s.manager.itemError(e),s.manager.itemEnd(e)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(e),o.src=e,o}}class CubeTextureLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=new CubeTexture,r=new ImageLoader(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);let o=0;function a(i){r.load(e[i],(function(e){s.images[i]=e,o++,6===o&&(s.needsUpdate=!0,t&&t(s))}),void 0,n)}for(let t=0;t<e.length;++t)a(t);return s}}class DataTextureLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=this,r=new DataTexture,o=new FileLoader(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(e,(function(e){const i=s.parse(e);i&&(void 0!==i.image?r.image=i.image:void 0!==i.data&&(r.image.width=i.width,r.image.height=i.height,r.image.data=i.data),r.wrapS=void 0!==i.wrapS?i.wrapS:ue,r.wrapT=void 0!==i.wrapT?i.wrapT:ue,r.magFilter=void 0!==i.magFilter?i.magFilter:be,r.minFilter=void 0!==i.minFilter?i.minFilter:be,r.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.encoding&&(r.encoding=i.encoding),void 0!==i.flipY&&(r.flipY=i.flipY),void 0!==i.format&&(r.format=i.format),void 0!==i.type&&(r.type=i.type),void 0!==i.mipmaps&&(r.mipmaps=i.mipmaps,r.minFilter=we),1===i.mipmapCount&&(r.minFilter=be),void 0!==i.generateMipmaps&&(r.generateMipmaps=i.generateMipmaps),r.needsUpdate=!0,t&&t(r,i))}),i,n),r}}class TextureLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=new Texture,r=new ImageLoader(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(e,(function(i){s.image=i;const n=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);s.format=n?Be:Fe,s.needsUpdate=!0,void 0!==t&&t(s)}),i,n),s}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),s=0;t.push(0);for(let r=1;r<=e;r++)i=this.getPoint(r/e),s+=i.distanceTo(n),t.push(s),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let n=0;const s=i.length;let r;r=t||e*i[s-1];let o,a=0,l=s-1;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),o=i[n]-r,o<0)a=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(n=l,i[n]===r)return n/(s-1);const c=i[n];return(n+(r-c)/(i[n+1]-c))/(s-1)}getTangent(e,t){const i=1e-4;let n=e-i,s=e+i;n<0&&(n=0),s>1&&(s=1);const r=this.getPoint(n),o=this.getPoint(s),a=t||(r.isVector2?new Vector2:new Vector3);return a.copy(o).sub(r).normalize(),a}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new Vector3,n=[],s=[],r=[],o=new Vector3,a=new Matrix4;for(let t=0;t<=e;t++){const i=t/e;n[t]=this.getTangentAt(i,new Vector3),n[t].normalize()}s[0]=new Vector3,r[0]=new Vector3;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),h=Math.abs(n[0].y),d=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),d<=l&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),s[0].crossVectors(n[0],o),r[0].crossVectors(n[0],s[0]);for(let t=1;t<=e;t++){if(s[t]=s[t-1].clone(),r[t]=r[t-1].clone(),o.crossVectors(n[t-1],n[t]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(Vi(n[t-1].dot(n[t]),-1,1));s[t].applyMatrix4(a.makeRotationAxis(o,e))}r[t].crossVectors(n[t],s[t])}if(!0===t){let t=Math.acos(Vi(s[0].dot(s[e]),-1,1));t/=e,n[0].dot(o.crossVectors(s[0],s[e]))>0&&(t=-t);for(let i=1;i<=e;i++)s[i].applyMatrix4(a.makeRotationAxis(n[i],t*i)),r[i].crossVectors(n[i],s[i])}return{tangents:n,normals:s,binormals:r}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(e=0,t=0,i=1,n=1,s=0,r=2*Math.PI,o=!1,a=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=r,this.aClockwise=o,this.aRotation=a}getPoint(e,t){const i=t||new Vector2,n=2*Math.PI;let s=this.aEndAngle-this.aStartAngle;const r=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(s=r?0:n),!0!==this.aClockwise||r||(s===n?s=-n:s-=n);const o=this.aStartAngle+e*s;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=a-this.aX,n=l-this.aY;a=i*e-n*t+this.aX,l=i*t+n*e+this.aY}return i.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}EllipseCurve.prototype.isEllipseCurve=!0;class ArcCurve extends EllipseCurve{constructor(e,t,i,n,s,r){super(e,t,i,i,n,s,r),this.type="ArcCurve"}}function Al(){let e=0,t=0,i=0,n=0;function s(s,r,o,a){e=s,t=o,i=-3*s+3*r-2*o-a,n=2*s-2*r+o+a}return{initCatmullRom:function(e,t,i,n,r){s(t,i,r*(i-e),r*(n-t))},initNonuniformCatmullRom:function(e,t,i,n,r,o,a){let l=(t-e)/r-(i-e)/(r+o)+(i-t)/o,c=(i-t)/o-(n-t)/(o+a)+(n-i)/a;l*=o,c*=o,s(t,i,l,c)},calc:function(s){const r=s*s;return e+t*s+i*r+n*(r*s)}}}ArcCurve.prototype.isArcCurve=!0;const Ol=new Vector3,Pl=new Al,Dl=new Al,Cl=new Al;class CatmullRomCurve3 extends Curve{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new Vector3){const i=t,n=this.points,s=n.length,r=(s-(this.closed?0:1))*e;let o,a,l=Math.floor(r),c=r-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s)+1)*s:0===c&&l===s-1&&(l=s-2,c=1),this.closed||l>0?o=n[(l-1)%s]:(Ol.subVectors(n[0],n[1]).add(n[0]),o=Ol);const h=n[l%s],d=n[(l+1)%s];if(this.closed||l+2<s?a=n[(l+2)%s]:(Ol.subVectors(n[s-1],n[s-2]).add(n[s-1]),a=Ol),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(d),e),n=Math.pow(d.distanceToSquared(a),e);i<1e-4&&(i=1),t<1e-4&&(t=i),n<1e-4&&(n=i),Pl.initNonuniformCatmullRom(o.x,h.x,d.x,a.x,t,i,n),Dl.initNonuniformCatmullRom(o.y,h.y,d.y,a.y,t,i,n),Cl.initNonuniformCatmullRom(o.z,h.z,d.z,a.z,t,i,n)}else"catmullrom"===this.curveType&&(Pl.initCatmullRom(o.x,h.x,d.x,a.x,this.tension),Dl.initCatmullRom(o.y,h.y,d.y,a.y,this.tension),Cl.initCatmullRom(o.z,h.z,d.z,a.z,this.tension));return i.set(Pl.calc(c),Dl.calc(c),Cl.calc(c)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new Vector3).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Il(e,t,i,n,s){const r=.5*(n-t),o=.5*(s-i),a=e*e;return(2*i-2*n+r+o)*(e*a)+(-3*i+3*n-2*r-o)*a+r*e+i}function Ll(e,t,i,n){return function(e,t){const i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,n)}function Rl(e,t,i,n,s){return function(e,t){const i=1-e;return i*i*i*t}(e,t)+function(e,t){const i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,s)}CatmullRomCurve3.prototype.isCatmullRomCurve3=!0;class CubicBezierCurve extends Curve{constructor(e=new Vector2,t=new Vector2,i=new Vector2,n=new Vector2){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new Vector2){const i=t,n=this.v0,s=this.v1,r=this.v2,o=this.v3;return i.set(Rl(e,n.x,s.x,r.x,o.x),Rl(e,n.y,s.y,r.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}CubicBezierCurve.prototype.isCubicBezierCurve=!0;class CubicBezierCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3,i=new Vector3,n=new Vector3){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new Vector3){const i=t,n=this.v0,s=this.v1,r=this.v2,o=this.v3;return i.set(Rl(e,n.x,s.x,r.x,o.x),Rl(e,n.y,s.y,r.y,o.y),Rl(e,n.z,s.z,r.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}CubicBezierCurve3.prototype.isCubicBezierCurve3=!0;class LineCurve extends Curve{constructor(e=new Vector2,t=new Vector2){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Vector2){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new Vector2;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}LineCurve.prototype.isLineCurve=!0;class LineCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new Vector3){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class QuadraticBezierCurve extends Curve{constructor(e=new Vector2,t=new Vector2,i=new Vector2){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Vector2){const i=t,n=this.v0,s=this.v1,r=this.v2;return i.set(Ll(e,n.x,s.x,r.x),Ll(e,n.y,s.y,r.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0;class QuadraticBezierCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3,i=new Vector3){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Vector3){const i=t,n=this.v0,s=this.v1,r=this.v2;return i.set(Ll(e,n.x,s.x,r.x),Ll(e,n.y,s.y,r.y),Ll(e,n.z,s.z,r.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0;class SplineCurve extends Curve{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Vector2){const i=t,n=this.points,s=(n.length-1)*e,r=Math.floor(s),o=s-r,a=n[0===r?r:r-1],l=n[r],c=n[r>n.length-2?n.length-1:r+1],h=n[r>n.length-3?n.length-1:r+2];return i.set(Il(o,a.x,l.x,c.x,h.x),Il(o,a.y,l.y,c.y,h.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new Vector2).fromArray(i))}return this}}SplineCurve.prototype.isSplineCurve=!0;var Nl=Object.freeze({__proto__:null,ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new LineCurve(t,e))}getPoint(e){const t=e*this.getLength(),i=this.getCurveLengths();let n=0;for(;n<i.length;){if(i[n]>=t){const e=i[n]-t,s=this.curves[n],r=s.getLength(),o=0===r?0:1-e/r;return s.getPointAt(o)}n++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let n=0,s=this.curves;n<s.length;n++){const r=s[n],o=r&&r.isEllipseCurve?2*e:r&&(r.isLineCurve||r.isLineCurve3)?1:r&&r.isSplineCurve?e*r.points.length:e,a=r.getPoints(o);for(let e=0;e<a.length;e++){const n=a[e];i&&i.equals(n)||(t.push(n),i=n)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push((new Nl[i.type]).fromJSON(i))}return this}}class Path extends CurvePath{constructor(e){super(),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){const s=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,n));return this.curves.push(s),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,s,r){const o=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,n),new Vector2(s,r));return this.curves.push(o),this.currentPoint.set(s,r),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new SplineCurve(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,s,r){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+o,t+a,i,n,s,r),this}absarc(e,t,i,n,s,r){return this.absellipse(e,t,i,i,n,s,r),this}ellipse(e,t,i,n,s,r,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,n,s,r,o,a),this}absellipse(e,t,i,n,s,r,o,a){const l=new EllipseCurve(e,t,i,n,s,r,o,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Shape extends Path{constructor(e){super(e),this.uuid=Ui(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push((new Path).fromJSON(i))}return this}}class Light extends Object3D{constructor(e,t=1){super(),this.type="Light",this.color=new Color(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}Light.prototype.isLight=!0;class HemisphereLight extends Light{constructor(e,t,i){super(e,i),this.type="HemisphereLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}copy(e){return Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}HemisphereLight.prototype.isHemisphereLight=!0;const kl=new Matrix4,Bl=new Vector3,Fl=new Vector3;class LightShadow{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;Bl.setFromMatrixPosition(e.matrixWorld),t.position.copy(Bl),Fl.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Fl),t.updateMatrixWorld(),kl.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(kl),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,i=2*Fi*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;i===t.fov&&n===t.aspect&&s===t.far||(t.fov=i,t.aspect=n,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}SpotLightShadow.prototype.isSpotLightShadow=!0;class SpotLight extends Light{constructor(e,t,i=0,n=Math.PI/3,s=0,r=1){super(e,t),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.distance=i,this.angle=n,this.penumbra=s,this.decay=r,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}SpotLight.prototype.isSpotLight=!0;const Ul=new Matrix4,Vl=new Vector3,Hl=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,n=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Vl.setFromMatrixPosition(e.matrixWorld),i.position.copy(Vl),Hl.copy(i.position),Hl.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Hl),i.updateMatrixWorld(),n.makeTranslation(-Vl.x,-Vl.y,-Vl.z),Ul.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ul)}}PointLightShadow.prototype.isPointLightShadow=!0;class PointLight extends Light{constructor(e,t,i=0,n=1){super(e,t),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new PointLightShadow}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}PointLight.prototype.isPointLight=!0;class OrthographicCamera extends Camera{constructor(e=-1,t=1,i=1,n=-1,s=.1,r=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=s,this.far=r,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,s,r){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-e,r=i+e,o=n+t,a=n-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=e*this.view.offsetX,r=s+e*this.view.width,o-=t*this.view.offsetY,a=o-t*this.view.height}this.projectionMatrix.makeOrthographic(s,r,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}OrthographicCamera.prototype.isOrthographicCamera=!0;class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500))}}DirectionalLightShadow.prototype.isDirectionalLightShadow=!0;class DirectionalLight extends Light{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}DirectionalLight.prototype.isDirectionalLight=!0;class AmbientLight extends Light{constructor(e,t){super(e,t),this.type="AmbientLight"}}AmbientLight.prototype.isAmbientLight=!0;class RectAreaLight extends Light{constructor(e,t,i=10,n=10){super(e,t),this.type="RectAreaLight",this.width=i,this.height=n}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}RectAreaLight.prototype.isRectAreaLight=!0;class SphericalHarmonics3{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Vector3)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,n=e.y,s=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.282095),t.addScaledVector(r[1],.488603*n),t.addScaledVector(r[2],.488603*s),t.addScaledVector(r[3],.488603*i),t.addScaledVector(r[4],i*n*1.092548),t.addScaledVector(r[5],n*s*1.092548),t.addScaledVector(r[6],.315392*(3*s*s-1)),t.addScaledVector(r[7],i*s*1.092548),t.addScaledVector(r[8],.546274*(i*i-n*n)),t}getIrradianceAt(e,t){const i=e.x,n=e.y,s=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.886227),t.addScaledVector(r[1],1.023328*n),t.addScaledVector(r[2],1.023328*s),t.addScaledVector(r[3],1.023328*i),t.addScaledVector(r[4],.858086*i*n),t.addScaledVector(r[5],.858086*n*s),t.addScaledVector(r[6],.743125*s*s-.247708),t.addScaledVector(r[7],.858086*i*s),t.addScaledVector(r[8],.429043*(i*i-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(e,t+3*n);return this}toArray(e=[],t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(e,t+3*n);return e}static getBasisAt(e,t){const i=e.x,n=e.y,s=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-n*n)}}SphericalHarmonics3.prototype.isSphericalHarmonics3=!0;class LightProbe extends Light{constructor(e=new SphericalHarmonics3,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}LightProbe.prototype.isLightProbe=!0;class MaterialLoader extends Loader{constructor(e){super(e),this.textures={}}load(e,t,i,n){const s=this,r=new FileLoader(s.manager);r.setPath(s.path),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(e,(function(i){try{t(s.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}}),i,n)}parse(e){const t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const n=new El[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&void 0!==n.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.sheen&&(n.sheen=(new Color).setHex(e.sheen)),void 0!==e.emissive&&void 0!==n.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==n.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.shadowSide&&(n.shadowSide=e.shadowSide),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(n.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(n.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(n.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(n.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(n.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(n.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(n.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(n.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(n.skinning=e.skinning),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(n.morphNormals=e.morphNormals),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.alphaToCoverage&&(n.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(n.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.vertexTangents&&(n.vertexTangents=e.vertexTangents),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const s=e.uniforms[t];switch(n.uniforms[t]={},s.type){case"t":n.uniforms[t].value=i(s.value);break;case"c":n.uniforms[t].value=(new Color).setHex(s.value);break;case"v2":n.uniforms[t].value=(new Vector2).fromArray(s.value);break;case"v3":n.uniforms[t].value=(new Vector3).fromArray(s.value);break;case"v4":n.uniforms[t].value=(new Vector4).fromArray(s.value);break;case"m3":n.uniforms[t].value=(new Matrix3).fromArray(s.value);break;case"m4":n.uniforms[t].value=(new Matrix4).fromArray(s.value);break;default:n.uniforms[t].value=s.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)n.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=i(e.map)),void 0!==e.matcap&&(n.matcap=i(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(n.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),n.normalScale=(new Vector2).fromArray(t)}return void 0!==e.displacementMap&&(n.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=i(e.specularMap)),void 0!==e.envMap&&(n.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(n.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Vector2).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(n.transmission=e.transmission),void 0!==e.transmissionMap&&(n.transmissionMap=i(e.transmissionMap)),n}setTextures(e){return this.textures=e,this}}class LoaderUtils{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}InstancedBufferGeometry.prototype.isInstancedBufferGeometry=!0;class InstancedBufferAttribute extends BufferAttribute{constructor(e,t,i,n){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,i),this.meshPerAttribute=n||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}InstancedBufferAttribute.prototype.isInstancedBufferAttribute=!0;class BufferGeometryLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=this,r=new FileLoader(s.manager);r.setPath(s.path),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(e,(function(i){try{t(s.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}}),i,n)}parse(e){const t={},i={};function n(e,n){if(void 0!==t[n])return t[n];const s=e.interleavedBuffers[n],r=function(e,t){if(void 0!==i[t])return i[t];const n=e.arrayBuffers[t],s=new Uint32Array(n).buffer;return i[t]=s,s}(e,s.buffer),o=vs(s.type,r),a=new InterleavedBuffer(o,s.stride);return a.uuid=s.uuid,t[n]=a,a}const s=e.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,r=e.data.index;if(void 0!==r){const e=vs(r.type,r.array);s.setIndex(new BufferAttribute(e,1))}const o=e.data.attributes;for(const t in o){const i=o[t];let r;if(i.isInterleavedBufferAttribute){const t=n(e.data,i.data);r=new InterleavedBufferAttribute(t,i.itemSize,i.offset,i.normalized)}else{const e=vs(i.type,i.array);r=new(i.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute)(e,i.itemSize,i.normalized)}void 0!==i.name&&(r.name=i.name),void 0!==i.usage&&r.setUsage(i.usage),void 0!==i.updateRange&&(r.updateRange.offset=i.updateRange.offset,r.updateRange.count=i.updateRange.count),s.setAttribute(t,r)}const a=e.data.morphAttributes;if(a)for(const t in a){const i=a[t],r=[];for(let t=0,s=i.length;t<s;t++){const s=i[t];let o;if(s.isInterleavedBufferAttribute){const t=n(e.data,s.data);o=new InterleavedBufferAttribute(t,s.itemSize,s.offset,s.normalized)}else{const e=vs(s.type,s.array);o=new BufferAttribute(e,s.itemSize,s.normalized)}void 0!==s.name&&(o.name=s.name),r.push(o)}s.morphAttributes[t]=r}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];s.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new Vector3;void 0!==c.center&&e.fromArray(c.center),s.boundingSphere=new Sphere(e,c.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}}class ObjectLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=this,r=""===this.path?LoaderUtils.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const o=new FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(i){let r=null;try{r=JSON.parse(i)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const o=r.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?s.parse(r,t):console.error("THREE.ObjectLoader: Can't load "+e)}),i,n)}parse(e,t){const i=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,n),r=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),o=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,s,a,i),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in r)if(r[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}parseShapes(e){const t={};if(void 0!==e)for(let i=0,n=e.length;i<n;i++){const n=(new Shape).fromJSON(e[i]);t[n.uuid]=n}return t}parseSkeletons(e,t){const i={},n={};if(t.traverse((function(e){e.isBone&&(n[e.uuid]=e)})),void 0!==e)for(let t=0,s=e.length;t<s;t++){const s=(new Skeleton).fromJSON(e[t],n);i[s.uuid]=s}return i}parseGeometries(e,t){const i={};let n;if(void 0!==e){const s=new BufferGeometryLoader;for(let r=0,o=e.length;r<o;r++){let o;const a=e[r];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new Sl[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":o=new Sl[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new Sl[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new Sl[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new Sl[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new Sl[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new Sl[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new Sl[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new Sl[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new Sl[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new Sl[a.type]((new Nl[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new Sl[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new Sl[a.type](a.vertices,a.indices,a.radius,a.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":n=[];for(let e=0,i=a.shapes.length;e<i;e++){const i=t[a.shapes[e]];n.push(i)}o=new Sl[a.type](n,a.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":n=[];for(let e=0,i=a.shapes.length;e<i;e++){const i=t[a.shapes[e]];n.push(i)}const e=a.options.extrudePath;void 0!==e&&(a.options.extrudePath=(new Nl[e.type]).fromJSON(e)),o=new Sl[a.type](n,a.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=s.parse(a);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),!0===o.isBufferGeometry&&void 0!==a.userData&&(o.userData=a.userData),i[a.uuid]=o}}return i}parseMaterials(e,t){const i={},n={};if(void 0!==e){const s=new MaterialLoader;s.setTextures(t);for(let t=0,r=e.length;t<r;t++){const r=e[t];if("MultiMaterial"===r.type){const e=[];for(let t=0;t<r.materials.length;t++){const n=r.materials[t];void 0===i[n.uuid]&&(i[n.uuid]=s.parse(n)),e.push(i[n.uuid])}n[r.uuid]=e}else void 0===i[r.uuid]&&(i[r.uuid]=s.parse(r)),n[r.uuid]=i[r.uuid]}}return n}parseAnimations(e){const t={};if(void 0!==e)for(let i=0;i<e.length;i++){const n=e[i],s=AnimationClip.parse(n);t[s.uuid]=s}return t}parseImages(e,t){const i=this,n={};let s;function r(e){if("string"==typeof e){const t=e;return function(e){return i.manager.itemStart(e),s.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemError(e),i.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:i.resourcePath+t)}return e.data?{data:vs(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const i=new LoadingManager(t);s=new ImageLoader(i),s.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],s=i.url;if(Array.isArray(s)){n[i.uuid]=[];for(let e=0,t=s.length;e<t;e++){const t=r(s[e]);null!==t&&(t instanceof HTMLImageElement?n[i.uuid].push(t):n[i.uuid].push(new DataTexture(t.data,t.width,t.height)))}}else{const e=r(i.url);null!==e&&(n[i.uuid]=e)}}}return n}parseTextures(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const n={};if(void 0!==e)for(let s=0,r=e.length;s<r;s++){const r=e[s];let o;void 0===r.image&&console.warn('THREE.ObjectLoader: No "image" specified for',r.uuid),void 0===t[r.image]&&console.warn("THREE.ObjectLoader: Undefined image",r.image);const a=t[r.image];Array.isArray(a)?(o=new CubeTexture(a),6===a.length&&(o.needsUpdate=!0)):(o=a&&a.data?new DataTexture(a.data,a.width,a.height):new Texture(a),a&&(o.needsUpdate=!0)),o.uuid=r.uuid,void 0!==r.name&&(o.name=r.name),void 0!==r.mapping&&(o.mapping=i(r.mapping,Gl)),void 0!==r.offset&&o.offset.fromArray(r.offset),void 0!==r.repeat&&o.repeat.fromArray(r.repeat),void 0!==r.center&&o.center.fromArray(r.center),void 0!==r.rotation&&(o.rotation=r.rotation),void 0!==r.wrap&&(o.wrapS=i(r.wrap[0],zl),o.wrapT=i(r.wrap[1],zl)),void 0!==r.format&&(o.format=r.format),void 0!==r.type&&(o.type=r.type),void 0!==r.encoding&&(o.encoding=r.encoding),void 0!==r.minFilter&&(o.minFilter=i(r.minFilter,Wl)),void 0!==r.magFilter&&(o.magFilter=i(r.magFilter,Wl)),void 0!==r.anisotropy&&(o.anisotropy=r.anisotropy),void 0!==r.flipY&&(o.flipY=r.flipY),void 0!==r.premultiplyAlpha&&(o.premultiplyAlpha=r.premultiplyAlpha),void 0!==r.unpackAlignment&&(o.unpackAlignment=r.unpackAlignment),n[r.uuid]=o}return n}parseObject(e,t,i,n){let s,r,o;function a(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let n=0,s=e.length;n<s;n++){const s=e[n];void 0===i[s]&&console.warn("THREE.ObjectLoader: Undefined material",s),t.push(i[s])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}switch(e.type){case"Scene":s=new Scene,void 0!==e.background&&Number.isInteger(e.background)&&(s.background=new Color(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?s.fog=new Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(s.fog=new FogExp2(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":s=new PerspectiveCamera(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(s.focus=e.focus),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.filmGauge&&(s.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(s.filmOffset=e.filmOffset),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new AmbientLight(e.color,e.intensity);break;case"DirectionalLight":s=new DirectionalLight(e.color,e.intensity);break;case"PointLight":s=new PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new HemisphereLight(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=(new LightProbe).fromJSON(e);break;case"SkinnedMesh":r=a(e.geometry),o=l(e.material),s=new SkinnedMesh(r,o),void 0!==e.bindMode&&(s.bindMode=e.bindMode),void 0!==e.bindMatrix&&s.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(s.skeleton=e.skeleton);break;case"Mesh":r=a(e.geometry),o=l(e.material),s=new Mesh(r,o);break;case"InstancedMesh":r=a(e.geometry),o=l(e.material);const t=e.count,i=e.instanceMatrix,n=e.instanceColor;s=new InstancedMesh(r,o,t),s.instanceMatrix=new BufferAttribute(new Float32Array(i.array),16),void 0!==n&&(s.instanceColor=new BufferAttribute(new Float32Array(n.array),n.itemSize));break;case"LOD":s=new LOD;break;case"Line":s=new Line(a(e.geometry),l(e.material));break;case"LineLoop":s=new LineLoop(a(e.geometry),l(e.material));break;case"LineSegments":s=new LineSegments(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":s=new Points(a(e.geometry),l(e.material));break;case"Sprite":s=new Sprite(l(e.material));break;case"Group":s=new Group;break;case"Bone":s=new Bone;break;default:s=new Object3D}if(s.uuid=e.uuid,void 0!==e.name&&(s.name=e.name),void 0!==e.matrix?(s.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==e.position&&s.position.fromArray(e.position),void 0!==e.rotation&&s.rotation.fromArray(e.rotation),void 0!==e.quaternion&&s.quaternion.fromArray(e.quaternion),void 0!==e.scale&&s.scale.fromArray(e.scale)),void 0!==e.castShadow&&(s.castShadow=e.castShadow),void 0!==e.receiveShadow&&(s.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(s.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(s.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(s.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&s.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(s.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.frustumCulled&&(s.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(s.renderOrder=e.renderOrder),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.layers&&(s.layers.mask=e.layers),void 0!==e.children){const r=e.children;for(let e=0;e<r.length;e++)s.add(this.parseObject(r[e],t,i,n))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const i=t[e];s.animations.push(n[i])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(s.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const i=t[e],n=s.getObjectByProperty("uuid",i.object);void 0!==n&&s.addLevel(n,i.distance)}}return s}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const i=t[e.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(i,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const Gl={UVMapping:se,CubeReflectionMapping:re,CubeRefractionMapping:oe,EquirectangularReflectionMapping:ae,EquirectangularRefractionMapping:le,CubeUVReflectionMapping:ce,CubeUVRefractionMapping:he},zl={RepeatWrapping:de,ClampToEdgeWrapping:ue,MirroredRepeatWrapping:pe},Wl={NearestFilter:me,NearestMipmapNearestFilter:ge,NearestMipmapLinearFilter:ve,LinearFilter:be,LinearMipmapNearestFilter:Se,LinearMipmapLinearFilter:we};class ImageBitmapLoader extends Loader{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,r=_l.get(e);if(void 0!==r)return s.manager.itemStart(e),setTimeout((function(){t&&t(r),s.manager.itemEnd(e)}),0),r;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(s.options,{colorSpaceConversion:"none"}))})).then((function(i){_l.add(e,i),t&&t(i),s.manager.itemEnd(e)})).catch((function(t){n&&n(t),s.manager.itemError(e),s.manager.itemEnd(e)})),s.manager.itemStart(e)}}ImageBitmapLoader.prototype.isImageBitmapLoader=!0;class ShapePath{constructor(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,n){return this.currentPath.quadraticCurveTo(e,t,i,n),this}bezierCurveTo(e,t,i,n,s,r){return this.currentPath.bezierCurveTo(e,t,i,n,s,r),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function i(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i],s=new Shape;s.curves=n.curves,t.push(s)}return t}function n(e,t){const i=t.length;let n=!1;for(let s=i-1,r=0;r<i;s=r++){let i=t[s],o=t[r],a=o.x-i.x,l=o.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=t[r],a=-a,o=t[s],l=-l),e.y<i.y||e.y>o.y)continue;if(e.y===i.y){if(e.x===i.x)return!0}else{const t=l*(e.x-i.x)-a*(e.y-i.y);if(0===t)return!0;if(t<0)continue;n=!n}}else{if(e.y!==i.y)continue;if(o.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=o.x)return!0}}return n}const s=ShapeUtils.isClockWise,r=this.subPaths;if(0===r.length)return[];if(!0===t)return i(r);let o,a,l;const c=[];if(1===r.length)return a=r[0],l=new Shape,l.curves=a.curves,c.push(l),c;let h=!s(r[0].getPoints());h=e?!h:h;const d=[],u=[];let p,m,g=[],f=0;u[f]=void 0,g[f]=[];for(let t=0,i=r.length;t<i;t++)a=r[t],p=a.getPoints(),o=s(p),o=e?!o:o,o?(!h&&u[f]&&f++,u[f]={s:new Shape,p:p},u[f].s.curves=a.curves,h&&f++,g[f]=[]):g[f].push({h:a,p:p[0]});if(!u[0])return i(r);if(u.length>1){let e=!1;const t=[];for(let e=0,t=u.length;e<t;e++)d[e]=[];for(let i=0,s=u.length;i<s;i++){const s=g[i];for(let r=0;r<s.length;r++){const o=s[r];let a=!0;for(let s=0;s<u.length;s++)n(o.p,u[s].p)&&(i!==s&&t.push({froms:i,tos:s,hole:r}),a?(a=!1,d[s].push(o)):e=!0);a&&d[i].push(o)}}t.length>0&&(e||(g=d))}for(let e=0,t=u.length;e<t;e++){l=u[e].s,c.push(l),m=g[e];for(let e=0,t=m.length;e<t;e++)l.holes.push(m[e].h)}return c}}class Font{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){const i=[],n=function(e,t,i){const n=Array.from(e),s=t/i.resolution,r=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*s,o=[];let a=0,l=0;for(let e=0;e<n.length;e++){const t=n[e];if("\n"===t)a=0,l-=r;else{const e=jl(t,s,a,l,i);a+=e.offsetX,o.push(e.path)}}return o}(e,t,this.data);for(let e=0,t=n.length;e<t;e++)Array.prototype.push.apply(i,n[e].toShapes());return i}}function jl(e,t,i,n,s){const r=s.glyphs[e]||s.glyphs["?"];if(!r)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+s.familyName+".");const o=new ShapePath;let a,l,c,h,d,u,p,m;if(r.o){const e=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let s=0,r=e.length;s<r;){switch(e[s++]){case"m":a=e[s++]*t+i,l=e[s++]*t+n,o.moveTo(a,l);break;case"l":a=e[s++]*t+i,l=e[s++]*t+n,o.lineTo(a,l);break;case"q":c=e[s++]*t+i,h=e[s++]*t+n,d=e[s++]*t+i,u=e[s++]*t+n,o.quadraticCurveTo(d,u,c,h);break;case"b":c=e[s++]*t+i,h=e[s++]*t+n,d=e[s++]*t+i,u=e[s++]*t+n,p=e[s++]*t+i,m=e[s++]*t+n,o.bezierCurveTo(d,u,p,m,c,h)}}}return{offsetX:r.ha*t,path:o}}Font.prototype.isFont=!0;class FontLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=this,r=new FileLoader(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(s.withCredentials),r.load(e,(function(e){let i;try{i=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}const n=s.parse(i);t&&t(n)}),i,n)}parse(e){return new Font(e)}}let Kl;const ql={getContext:function(){return void 0===Kl&&(Kl=new(window.AudioContext||window.webkitAudioContext)),Kl},setContext:function(e){Kl=e}};class AudioLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=this,r=new FileLoader(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(i){try{const e=i.slice(0);ql.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}}),i,n)}}class HemisphereLightProbe extends LightProbe{constructor(e,t,i=1){super(void 0,i);const n=(new Color).set(e),s=(new Color).set(t),r=new Vector3(n.r,n.g,n.b),o=new Vector3(s.r,s.g,s.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(r).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(r).sub(o).multiplyScalar(l)}}HemisphereLightProbe.prototype.isHemisphereLightProbe=!0;class AmbientLightProbe extends LightProbe{constructor(e,t=1){super(void 0,t);const i=(new Color).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}AmbientLightProbe.prototype.isAmbientLightProbe=!0;const Zl=new Matrix4,Yl=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const i=e.projectionMatrix.clone(),n=t.eyeSep/2,s=n*t.near/t.focus,r=t.near*Math.tan(Bi*t.fov*.5)/t.zoom;let o,a;Yl.elements[12]=-n,Zl.elements[12]=n,o=-r*t.aspect+s,a=r*t.aspect+s,i.elements[0]=2*t.near/(a-o),i.elements[8]=(a+o)/(a-o),this.cameraL.projectionMatrix.copy(i),o=-r*t.aspect-s,a=r*t.aspect-s,i.elements[0]=2*t.near/(a-o),i.elements[8]=(a+o)/(a-o),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Yl),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Zl)}}class Clock{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=$l(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=$l();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function $l(){return("undefined"==typeof performance?Date:performance).now()}const Ql=new Vector3,Xl=new Quaternion,Jl=new Vector3,ec=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=ql.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ql,Xl,Jl),ec.set(0,0,-1).applyQuaternion(Xl),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Ql.x,e),t.positionY.linearRampToValueAtTime(Ql.y,e),t.positionZ.linearRampToValueAtTime(Ql.z,e),t.forwardX.linearRampToValueAtTime(ec.x,e),t.forwardY.linearRampToValueAtTime(ec.y,e),t.forwardZ.linearRampToValueAtTime(ec.z,e),t.upX.linearRampToValueAtTime(i.x,e),t.upY.linearRampToValueAtTime(i.y,e),t.upZ.linearRampToValueAtTime(i.z,e)}else t.setPosition(Ql.x,Ql.y,Ql.z),t.setOrientation(ec.x,ec.y,ec.z,i.x,i.y,i.z)}}class Audio extends Object3D{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const tc=new Vector3,ic=new Quaternion,nc=new Vector3,sc=new Vector3;class PositionalAudio extends Audio{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(tc,ic,nc),sc.set(0,0,1).applyQuaternion(ic);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(tc.x,e),t.positionY.linearRampToValueAtTime(tc.y,e),t.positionZ.linearRampToValueAtTime(tc.z,e),t.orientationX.linearRampToValueAtTime(sc.x,e),t.orientationY.linearRampToValueAtTime(sc.y,e),t.orientationZ.linearRampToValueAtTime(sc.z,e)}else t.setPosition(tc.x,tc.y,tc.z),t.setOrientation(sc.x,sc.y,sc.z)}}class AudioAnalyser{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class PropertyMixer{constructor(e,t,i){let n,s,r;switch(this.binding=e,this.valueSize=i,t){case"quaternion":n=this._slerp,s=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,s=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,n=this.valueSize,s=e*n+n;let r=this.cumulativeWeight;if(0===r){for(let e=0;e!==n;++e)i[s+e]=i[e];r=t}else{r+=t;const e=t/r;this._mixBufferRegion(i,s,0,e,n)}this.cumulativeWeight=r}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,n=e*t+t,s=this.cumulativeWeight,r=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const e=t*this._origIndex;this._mixBufferRegion(i,n,e,1-s,t)}r>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let e=t,s=t+t;e!==s;++e)if(i[e]!==i[e+t]){o.setValue(i,n);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let e=i,s=n;e!==s;++e)t[e]=t[n+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,s){if(n>=.5)for(let n=0;n!==s;++n)e[t+n]=e[i+n]}_slerp(e,t,i,n){Quaternion.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,s){const r=this._workIndex*s;Quaternion.multiplyQuaternionsFlat(e,r,e,t,e,i),Quaternion.slerpFlat(e,t,e,t,e,r,n)}_lerp(e,t,i,n,s){const r=1-n;for(let o=0;o!==s;++o){const s=t+o;e[s]=e[s]*r+e[i+o]*n}}_lerpAdditive(e,t,i,n,s){for(let r=0;r!==s;++r){const s=t+r;e[s]=e[s]+e[i+r]*n}}}const rc="\\[\\]\\.:\\/",oc=new RegExp("[\\[\\]\\.:\\/]","g"),ac="[^\\[\\]\\.:\\/]",lc="[^"+rc.replace("\\.","")+"]",cc=/((?:WC+[\/:])*)/.source.replace("WC",ac),hc=/(WCOD+)?/.source.replace("WCOD",lc),dc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",ac),uc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",ac),pc=new RegExp("^"+cc+hc+dc+uc+"$"),mc=["material","materials","bones"];class PropertyBinding{constructor(e,t,i){this.path=t,this.parsedPath=i||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new PropertyBinding.Composite(e,t,i):new PropertyBinding(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(oc,"")}static parseTrackName(e){const t=pc.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const e=i.nodeName.substring(n+1);-1!==mc.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){const i=function(e){for(let n=0;n<e.length;n++){const s=e[n];if(s.name===t||s.uuid===t)return s;const r=i(s.children);if(r)return r}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let s=t.propertyIndex;if(e||(e=PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}const r=e[n];if(void 0===r){const i=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[s]&&(s=e.morphTargetDictionary[s])}a=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=s}else void 0!==r.fromArray&&void 0!==r.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(a=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=class Composite{constructor(e,t,i){const n=i||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=i.length;n!==s;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray],PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.uuid=Ui(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,n=this._parsedPaths,s=this._bindings,r=s.length;let o,a=e.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],d=h.uuid;let u=t[d];if(void 0===u){u=a++,t[d]=u,e.push(h);for(let e=0,t=r;e!==t;++e)s[e].push(new PropertyBinding(h,i[e],n[e]))}else if(u<l){o=e[u];const a=--l,c=e[a];t[c.uuid]=u,e[u]=c,t[d]=a,e[a]=h;for(let e=0,t=r;e!==t;++e){const t=s[e],r=t[a];let o=t[u];t[u]=r,void 0===o&&(o=new PropertyBinding(h,i[e],n[e])),t[a]=o}}else e[u]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let s=this.nCachedObjects_;for(let r=0,o=arguments.length;r!==o;++r){const o=arguments[r],a=o.uuid,l=t[a];if(void 0!==l&&l>=s){const r=s++,c=e[r];t[c.uuid]=l,e[l]=c,t[a]=r,e[r]=o;for(let e=0,t=n;e!==t;++e){const t=i[e],n=t[r],s=t[l];t[l]=n,t[r]=s}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let s=this.nCachedObjects_,r=e.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<s){const o=--s,a=e[o],c=--r,h=e[c];t[a.uuid]=l,e[l]=a,t[h.uuid]=o,e[o]=h,e.pop();for(let e=0,t=n;e!==t;++e){const t=i[e],n=t[o],s=t[c];t[l]=n,t[o]=s,t.pop()}}else{const s=--r,o=e[s];s>0&&(t[o.uuid]=l),e[l]=o,e.pop();for(let e=0,t=n;e!==t;++e){const t=i[e];t[l]=t[s],t.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const i=this._bindingsIndicesByPath;let n=i[e];const s=this._bindings;if(void 0!==n)return s[n];const r=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,h=new Array(l);n=s.length,i[e]=n,r.push(e),o.push(t),s.push(h);for(let i=c,n=a.length;i!==n;++i){const n=a[i];h[i]=new PropertyBinding(n,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){const n=this._paths,s=this._parsedPaths,r=this._bindings,o=r.length-1,a=r[o];t[e[o]]=i,r[i]=a,r.pop(),s[i]=s[o],s.pop(),n[i]=n[o],n.pop()}}}AnimationObjectGroup.prototype.isAnimationObjectGroup=!0;class AnimationAction{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;const s=t.tracks,r=s.length,o=new Array(r),a={endingStart:Gt,endingEnd:Gt};for(let e=0;e!==r;++e){const t=s[e].createInterpolant(null);o[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Bt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const i=this._clip.duration,n=e._clip.duration,s=n/i,r=i/n;e.warp(1,s,t),this.warp(r,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const n=this._mixer,s=n.time,r=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,a[1]=s+i,l[0]=e/r,l[1]=t/r,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled)return void this._updateWeight(e);const s=this._startTime;if(null!==s){const n=(e-s)*i;if(n<0||0===i)return;this._startTime=null,t=i*n}t*=this._updateTimeScale(e);const r=this._updateTime(t),o=this._updateWeight(e);if(o>0){const e=this._interpolants,t=this._propertyBindings;switch(this.blendMode){case Kt:for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(r),t[i].accumulateAdditive(o);break;case jt:default:for(let i=0,s=e.length;i!==s;++i)e[i].evaluate(r),t[i].accumulate(n,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let n=this.time+e,s=this._loopCount;const r=i===Ft;if(0===e)return-1===s?n:r&&1==(1&s)?t-n:n;if(i===kt){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===s&&(e>=0?(s=0,this._setEndings(!0,0===this.repetitions,r)):this._setEndings(0===this.repetitions,!0,r)),n>=t||n<0){const i=Math.floor(n/t);n-=t*i,s+=Math.abs(i);const o=this.repetitions-s;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){const t=e<0;this._setEndings(t,!t,r)}else this._setEndings(!1,!1,r);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(r&&1==(1&s))return t-n}return n}_setEndings(e,t,i){const n=this._interpolantSettings;i?(n.endingStart=zt,n.endingEnd=zt):(n.endingStart=e?this.zeroSlopeAtStart?zt:Gt:Wt,n.endingEnd=t?this.zeroSlopeAtEnd?zt:Gt:Wt)}_scheduleFading(e,t,i){const n=this._mixer,s=n.time;let r=this._weightInterpolant;null===r&&(r=n._lendControlInterpolant(),this._weightInterpolant=r);const o=r.parameterPositions,a=r.sampleValues;return o[0]=s,a[0]=t,o[1]=s+e,a[1]=i,this}}class AnimationMixer extends EventDispatcher{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,n=e._clip.tracks,s=n.length,r=e._propertyBindings,o=e._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let e=0;e!==s;++e){const s=n[e],l=s.name;let h=c[l];if(void 0!==h)r[e]=h;else{if(h=r[e],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,l));continue}const n=t&&t._propertyBindings[e].binding.parsedPath;h=new PropertyMixer(PropertyBinding.create(i,l,n),s.ValueTypeName,s.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,l),r[e]=h}o[e].resultBuffer=h.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){const n=this._actions,s=this._actionsByClip;let r=s[t];if(void 0===r)r={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=r;else{const t=r.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=n.length,n.push(e),r.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,r=this._actionsByClip,o=r[s],a=o.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null;delete o.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete r[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_addInactiveBinding(e,t,i){const n=this._bindingsByRootAndName,s=this._bindings;let r=n[t];void 0===r&&(r={},n[t]=r),r[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,n=i.rootNode.uuid,s=i.path,r=this._bindingsByRootAndName,o=r[n],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete o[s],0===Object.keys(o).length&&delete r[n]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,s=t[n];e.__cacheIndex=n,t[n]=e,s.__cacheIndex=i,t[i]=s}clipAction(e,t,i){const n=t||this._root,s=n.uuid;let r="string"==typeof e?AnimationClip.findByName(n,e):e;const o=null!==r?r.uuid:e,a=this._actionsByClip[o];let l=null;if(void 0===i&&(i=null!==r?r.blendMode:jt),void 0!==a){const e=a.actionByRoot[s];if(void 0!==e&&e.blendMode===i)return e;l=a.knownActions[0],null===r&&(r=l._clip)}if(null===r)return null;const c=new AnimationAction(this,r,t,i);return this._bindAction(c,l),this._addInactiveAction(c,o,s),c}existingAction(e,t){const i=t||this._root,n=i.uuid,s="string"==typeof e?AnimationClip.findByName(i,e):e,r=s?s.uuid:e,o=this._actionsByClip[r];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,n=this.time+=e,s=Math.sign(e),r=this._accuIndex^=1;for(let o=0;o!==i;++o){t[o]._update(n,e,s,r)}const o=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)o[e].apply(r);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,n=this._actionsByClip,s=n[i];if(void 0!==s){const e=s.knownActions;for(let i=0,n=e.length;i!==n;++i){const n=e[i];this._deactivateAction(n);const s=n._cacheIndex,r=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,r._cacheIndex=s,t[s]=r,t.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const e in i){const n=i[e].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[t];if(void 0!==n)for(const e in n){const t=n[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}AnimationMixer.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Uniform{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(e,t,i=1){super(e,t),this.meshPerAttribute=i||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}InstancedInterleavedBuffer.prototype.isInstancedInterleavedBuffer=!0;class GLBufferAttribute{constructor(e,t,i,n,s){this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=n,this.count=s,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}GLBufferAttribute.prototype.isGLBufferAttribute=!0;class Raycaster{constructor(e,t,i=0,n=1/0){this.ray=new Ray(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!1,i=[]){return fc(e,this,i,t),i.sort(gc),i}intersectObjects(e,t=!1,i=[]){for(let n=0,s=e.length;n<s;n++)fc(e[n],this,i,t);return i.sort(gc),i}}function gc(e,t){return e.distance-t.distance}function fc(e,t,i,n){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===n){const n=e.children;for(let e=0,s=n.length;e<s;e++)fc(n[e],t,i,!0)}}class Spherical{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Vi(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Cylindrical{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const vc=new Vector2;class Box2{constructor(e=new Vector2(1/0,1/0),t=new Vector2(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=vc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Vector2),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Vector2),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return vc.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Box2.prototype.isBox2=!0;const yc=new Vector3,bc=new Vector3;class Line3{constructor(e=new Vector3,t=new Vector3){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Vector3),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Vector3),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Vector3),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){yc.subVectors(e,this.start),bc.subVectors(this.end,this.start);const i=bc.dot(bc);let n=bc.dot(yc)/i;return t&&(n=Vi(n,0,1)),n}closestPointToPoint(e,t,i){const n=this.closestPointToPointParameter(e,t);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new Vector3),this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class ImmediateRenderObject extends Object3D{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}ImmediateRenderObject.prototype.isImmediateRenderObject=!0;const Sc=new Vector3;class SpotLightHelper extends Object3D{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const i=new BufferGeometry,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,i=32;e<i;e++,t++){const s=e/i*Math.PI*2,r=t/i*Math.PI*2;n.push(Math.cos(s),Math.sin(s),1,Math.cos(r),Math.sin(r),1)}i.setAttribute("position",new Float32BufferAttribute(n,3));const s=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Sc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Sc),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Ec=new Vector3,wc=new Matrix4,Tc=new Matrix4;class SkeletonHelper extends LineSegments{constructor(e){const t=_c(e),i=new BufferGeometry,n=[],s=[],r=new Color(0,0,1),o=new Color(0,1,0);for(let e=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(r.r,r.g,r.b),s.push(o.r,o.g,o.b))}i.setAttribute("position",new Float32BufferAttribute(n,3)),i.setAttribute("color",new Float32BufferAttribute(s,3));super(i,new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,n=i.getAttribute("position");Tc.copy(this.root.matrixWorld).invert();for(let e=0,i=0;e<t.length;e++){const s=t[e];s.parent&&s.parent.isBone&&(wc.multiplyMatrices(Tc,s.matrixWorld),Ec.setFromMatrixPosition(wc),n.setXYZ(i,Ec.x,Ec.y,Ec.z),wc.multiplyMatrices(Tc,s.parent.matrixWorld),Ec.setFromMatrixPosition(wc),n.setXYZ(i+1,Ec.x,Ec.y,Ec.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function _c(e){const t=[];e&&e.isBone&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,_c(e.children[i]));return t}class PointLightHelper extends Mesh{constructor(e,t,i){super(new SphereGeometry(t,4,2),new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Mc=new Vector3,xc=new Color,Ac=new Color;class HemisphereLightHelper extends Object3D{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const n=new OctahedronGeometry(t);n.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const s=n.getAttribute("position"),r=new Float32Array(3*s.count);n.setAttribute("color",new BufferAttribute(r,3)),this.add(new Mesh(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");xc.copy(this.light.color),Ac.copy(this.light.groundColor);for(let e=0,i=t.count;e<i;e++){const n=e<i/2?xc:Ac;t.setXYZ(e,n.r,n.g,n.b)}t.needsUpdate=!0}e.lookAt(Mc.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(e=10,t=10,i=4473924,n=8947848){i=new Color(i),n=new Color(n);const s=t/2,r=e/t,o=e/2,a=[],l=[];for(let e=0,c=0,h=-o;e<=t;e++,h+=r){a.push(-o,0,h,o,0,h),a.push(h,0,-o,h,0,o);const t=e===s?i:n;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new BufferGeometry;c.setAttribute("position",new Float32BufferAttribute(a,3)),c.setAttribute("color",new Float32BufferAttribute(l,3));super(c,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class PolarGridHelper extends LineSegments{constructor(e=10,t=16,i=8,n=64,s=4473924,r=8947848){s=new Color(s),r=new Color(r);const o=[],a=[];for(let i=0;i<=t;i++){const n=i/t*(2*Math.PI),l=Math.sin(n)*e,c=Math.cos(n)*e;o.push(0,0,0),o.push(l,0,c);const h=1&i?s:r;a.push(h.r,h.g,h.b),a.push(h.r,h.g,h.b)}for(let t=0;t<=i;t++){const l=1&t?s:r,c=e-e/i*t;for(let e=0;e<n;e++){let t=e/n*(2*Math.PI),i=Math.sin(t)*c,s=Math.cos(t)*c;o.push(i,0,s),a.push(l.r,l.g,l.b),t=(e+1)/n*(2*Math.PI),i=Math.sin(t)*c,s=Math.cos(t)*c,o.push(i,0,s),a.push(l.r,l.g,l.b)}}const l=new BufferGeometry;l.setAttribute("position",new Float32BufferAttribute(o,3)),l.setAttribute("color",new Float32BufferAttribute(a,3));super(l,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const Oc=new Vector3,Pc=new Vector3,Dc=new Vector3;class DirectionalLightHelper extends Object3D{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1);let n=new BufferGeometry;n.setAttribute("position",new Float32BufferAttribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(n,s),this.add(this.lightPlane),n=new BufferGeometry,n.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(n,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Oc.setFromMatrixPosition(this.light.matrixWorld),Pc.setFromMatrixPosition(this.light.target.matrixWorld),Dc.subVectors(Pc,Oc),this.lightPlane.lookAt(Pc),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Pc),this.targetLine.scale.z=Dc.length()}}const Cc=new Vector3,Ic=new Camera;class CameraHelper extends LineSegments{constructor(e){const t=new BufferGeometry,i=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],s=[],r={},o=new Color(16755200),a=new Color(16711680),l=new Color(43775),c=new Color(16777215),h=new Color(3355443);function d(e,t,i){u(e,i),u(t,i)}function u(e,t){n.push(0,0,0),s.push(t.r,t.g,t.b),void 0===r[e]&&(r[e]=[]),r[e].push(n.length/3-1)}d("n1","n2",o),d("n2","n4",o),d("n4","n3",o),d("n3","n1",o),d("f1","f2",o),d("f2","f4",o),d("f4","f3",o),d("f3","f1",o),d("n1","f1",o),d("n2","f2",o),d("n3","f3",o),d("n4","f4",o),d("p","n1",a),d("p","n2",a),d("p","n3",a),d("p","n4",a),d("u1","u2",l),d("u2","u3",l),d("u3","u1",l),d("c","t",c),d("p","c",h),d("cn1","cn2",h),d("cn3","cn4",h),d("cf1","cf2",h),d("cf3","cf4",h),t.setAttribute("position",new Float32BufferAttribute(n,3)),t.setAttribute("color",new Float32BufferAttribute(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update()}update(){const e=this.geometry,t=this.pointMap;Ic.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Lc("c",t,e,Ic,0,0,-1),Lc("t",t,e,Ic,0,0,1),Lc("n1",t,e,Ic,-1,-1,-1),Lc("n2",t,e,Ic,1,-1,-1),Lc("n3",t,e,Ic,-1,1,-1),Lc("n4",t,e,Ic,1,1,-1),Lc("f1",t,e,Ic,-1,-1,1),Lc("f2",t,e,Ic,1,-1,1),Lc("f3",t,e,Ic,-1,1,1),Lc("f4",t,e,Ic,1,1,1),Lc("u1",t,e,Ic,.7,1.1,-1),Lc("u2",t,e,Ic,-.7,1.1,-1),Lc("u3",t,e,Ic,0,2,-1),Lc("cf1",t,e,Ic,-1,0,1),Lc("cf2",t,e,Ic,1,0,1),Lc("cf3",t,e,Ic,0,-1,1),Lc("cf4",t,e,Ic,0,1,1),Lc("cn1",t,e,Ic,-1,0,-1),Lc("cn2",t,e,Ic,1,0,-1),Lc("cn3",t,e,Ic,0,-1,-1),Lc("cn4",t,e,Ic,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Lc(e,t,i,n,s,r,o){Cc.set(s,r,o).unproject(n);const a=t[e];if(void 0!==a){const e=i.getAttribute("position");for(let t=0,i=a.length;t<i;t++)e.setXYZ(a[t],Cc.x,Cc.y,Cc.z)}}const Rc=new Box3;class BoxHelper extends LineSegments{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),s=new BufferGeometry;s.setIndex(new BufferAttribute(i,1)),s.setAttribute("position",new BufferAttribute(n,3)),super(s,new LineBasicMaterial({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Rc.setFromObject(this.object),Rc.isEmpty())return;const t=Rc.min,i=Rc.max,n=this.geometry.attributes.position,s=n.array;s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=t.x,s[4]=i.y,s[5]=i.z,s[6]=t.x,s[7]=t.y,s[8]=i.z,s[9]=i.x,s[10]=t.y,s[11]=i.z,s[12]=i.x,s[13]=i.y,s[14]=t.z,s[15]=t.x,s[16]=i.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=i.x,s[22]=t.y,s[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return LineSegments.prototype.copy.call(this,e),this.object=e.object,this}}class Box3Helper extends LineSegments{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new BufferGeometry;n.setIndex(new BufferAttribute(i,1)),n.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new LineBasicMaterial({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class PlaneHelper extends Line{constructor(e,t=1,i=16776960){const n=i,s=new BufferGeometry;s.setAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),s.computeBoundingSphere(),super(s,new LineBasicMaterial({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),r.computeBoundingSphere(),this.add(new Mesh(r,new MeshBasicMaterial({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?g:m,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const Nc=new Vector3;let kc,Bc;class ArrowHelper extends Object3D{constructor(e=new Vector3(0,0,1),t=new Vector3(0,0,0),i=1,n=16776960,s=.2*i,r=.2*s){super(),this.type="ArrowHelper",void 0===kc&&(kc=new BufferGeometry,kc.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),Bc=new CylinderGeometry(0,.5,1,5,1),Bc.translate(0,-.5,0)),this.position.copy(t),this.line=new Line(kc,new LineBasicMaterial({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(Bc,new MeshBasicMaterial({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,s,r)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Nc.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Nc,t)}}setLength(e,t=.2*e,i=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class AxesHelper extends LineSegments{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new BufferGeometry;i.setAttribute("position",new Float32BufferAttribute(t,3)),i.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(i,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Fc=new Float32Array(1),Uc=new Int32Array(Fc.buffer);class DataUtils{static toHalfFloat(e){Fc[0]=e;const t=Uc[0];let i=t>>16&32768,n=t>>12&2047;const s=t>>23&255;return s<103?i:s>142?(i|=31744,i|=(255==s?0:1)&&8388607&t,i):s<113?(n|=2048,i|=(n>>114-s)+(n>>113-s&1),i):(i|=s-112<<10|n>>1,i+=1&n,i)}}const Vc=Math.pow(2,8),Hc=[.125,.215,.35,.446,.526,.582],Gc=5+Hc.length,zc=20,Wc={[$t]:0,[Qt]:1,[Jt]:2,[ti]:3,[ii]:4,[ni]:5,[Xt]:6},jc=new MeshBasicMaterial({side:g,depthWrite:!1,depthTest:!1}),Kc=new Mesh(new BoxGeometry,jc),qc=new OrthographicCamera,{_lodPlanes:Zc,_sizeLods:Yc,_sigmas:$c}=sh(),Qc=new Color;let Xc=null;const Jc=(1+Math.sqrt(5))/2,eh=1/Jc,th=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,Jc,eh),new Vector3(0,Jc,-eh),new Vector3(eh,0,Jc),new Vector3(-eh,0,Jc),new Vector3(Jc,eh,0),new Vector3(-Jc,eh,0)];function ih(e){const t=Math.max(e.r,e.g,e.b),i=Math.min(Math.max(Math.ceil(Math.log2(t)),-128),127);e.multiplyScalar(Math.pow(2,-i));return(i+128)/255}class PMREMGenerator{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(e),i=new Vector3(0,1,0);return new RawShaderMaterial({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:Wc[$t]},outputEncoding:{value:Wc[$t]}},vertexShader:ch(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${hh()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:b,depthTest:!1,depthWrite:!1})}(zc),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){Xc=this._renderer.getRenderTarget();const s=this._allocateTargets();return this._sceneToCubeUV(e,i,n,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=lh(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=ah(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<Zc.length;e++)Zc[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Xc),e.scissorTest=!1,oh(e,0,0,e.width,e.height)}_fromTexture(e){Xc=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:me,minFilter:me,generateMipmaps:!1,type:_e,format:He,encoding:nh(e)?e.encoding:Jt,depthBuffer:!1},i=rh(t);return i.depthBuffer=!e,this._pingPongRenderTarget=rh(t),i}_compileMaterial(e){const t=new Mesh(Zc[0],e);this._renderer.compile(t,qc)}_sceneToCubeUV(e,t,i,n){const s=new PerspectiveCamera(90,1,t,i),r=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.outputEncoding,h=a.toneMapping;a.getClearColor(Qc),a.toneMapping=X,a.outputEncoding=$t,a.autoClear=!1;let d=!1;const u=e.background;if(u){if(u.isColor){jc.color.copy(u).convertSRGBToLinear(),e.background=null;const t=ih(jc.color);jc.opacity=t,d=!0}}else{jc.color.copy(Qc).convertSRGBToLinear();const e=ih(jc.color);jc.opacity=e,d=!0}for(let t=0;t<6;t++){const i=t%3;0==i?(s.up.set(0,r[t],0),s.lookAt(o[t],0,0)):1==i?(s.up.set(0,0,r[t]),s.lookAt(0,o[t],0)):(s.up.set(0,r[t],0),s.lookAt(0,0,o[t])),oh(n,i*Vc,t>2?Vc:0,Vc,Vc),a.setRenderTarget(n),d&&a.render(Kc,s),a.render(e,s)}a.toneMapping=h,a.outputEncoding=c,a.autoClear=l}_textureToCubeUV(e,t){const i=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=lh()):null==this._equirectShader&&(this._equirectShader=ah());const n=e.isCubeTexture?this._cubemapShader:this._equirectShader,s=new Mesh(Zc[0],n),r=n.uniforms;r.envMap.value=e,e.isCubeTexture||r.texelSize.value.set(1/e.image.width,1/e.image.height),r.inputEncoding.value=Wc[e.encoding],r.outputEncoding.value=Wc[t.texture.encoding],oh(t,0,0,3*Vc,2*Vc),i.setRenderTarget(t),i.render(s,qc)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let t=1;t<Gc;t++){const i=Math.sqrt($c[t]*$c[t]-$c[t-1]*$c[t-1]),n=th[(t-1)%th.length];this._blur(e,t-1,t,i,n)}t.autoClear=i}_blur(e,t,i,n,s){const r=this._pingPongRenderTarget;this._halfBlur(e,r,t,i,n,"latitudinal",s),this._halfBlur(r,e,i,i,n,"longitudinal",s)}_halfBlur(e,t,i,n,s,r,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==r&&"longitudinal"!==r&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Mesh(Zc[n],l),h=l.uniforms,d=Yc[i]-1,u=isFinite(s)?Math.PI/(2*d):2*Math.PI/39,p=s/u,m=isFinite(s)?1+Math.floor(3*p):zc;m>zc&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);const g=[];let f=0;for(let e=0;e<zc;++e){const t=e/p,i=Math.exp(-t*t/2);g.push(i),0==e?f+=i:e<m&&(f+=2*i)}for(let e=0;e<g.length;e++)g[e]=g[e]/f;h.envMap.value=e.texture,h.samples.value=m,h.weights.value=g,h.latitudinal.value="latitudinal"===r,o&&(h.poleAxis.value=o),h.dTheta.value=u,h.mipInt.value=8-i,h.inputEncoding.value=Wc[e.texture.encoding],h.outputEncoding.value=Wc[e.texture.encoding];const v=Yc[n];oh(t,3*Math.max(0,Vc-2*v),(0===n?0:2*Vc)+2*v*(n>4?n-8+4:0),3*v,2*v),a.setRenderTarget(t),a.render(c,qc)}}function nh(e){return void 0!==e&&e.type===_e&&(e.encoding===$t||e.encoding===Qt||e.encoding===Xt)}function sh(){const e=[],t=[],i=[];let n=8;for(let s=0;s<Gc;s++){const r=Math.pow(2,n);t.push(r);let o=1/r;s>4?o=Hc[s-8+4-1]:0==s&&(o=0),i.push(o);const a=1/(r-1),l=-a/2,c=1+a/2,h=[l,l,c,l,c,c,l,l,c,c,l,c],d=6,u=6,p=3,m=2,g=1,f=new Float32Array(p*u*d),v=new Float32Array(m*u*d),y=new Float32Array(g*u*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,i=e>2?0:-1,n=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];f.set(n,p*u*e),v.set(h,m*u*e);const s=[e,e,e,e,e,e];y.set(s,g*u*e)}const b=new BufferGeometry;b.setAttribute("position",new BufferAttribute(f,p)),b.setAttribute("uv",new BufferAttribute(v,m)),b.setAttribute("faceIndex",new BufferAttribute(y,g)),e.push(b),n>4&&n--}return{_lodPlanes:e,_sizeLods:t,_sigmas:i}}function rh(e){const t=new WebGLRenderTarget(3*Vc,3*Vc,e);return t.texture.mapping=ce,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function oh(e,t,i,n,s){e.viewport.set(t,i,n,s),e.scissor.set(t,i,n,s)}function ah(){const e=new Vector2(1,1);return new RawShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:Wc[$t]},outputEncoding:{value:Wc[$t]}},vertexShader:ch(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${hh()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:b,depthTest:!1,depthWrite:!1})}function lh(){return new RawShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Wc[$t]},outputEncoding:{value:Wc[$t]}},vertexShader:ch(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${hh()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:b,depthTest:!1,depthWrite:!1})}function ch(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function hh(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}const dh=0,uh=1,ph=0,mh=1,gh=2;function fh(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function vh(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function yh(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Points(e,t)}function bh(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sprite(e)}function Sh(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Points(e,t)}function Eh(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function wh(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function Th(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function _h(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3(e,t,i)}function Mh(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new BufferAttribute(e,t).setUsage(Mi)}function xh(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Int8BufferAttribute(e,t)}function Ah(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uint8BufferAttribute(e,t)}function Oh(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Uint8ClampedBufferAttribute(e,t)}function Ph(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Int16BufferAttribute(e,t)}function Dh(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Uint16BufferAttribute(e,t)}function Ch(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Int32BufferAttribute(e,t)}function Ih(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uint32BufferAttribute(e,t)}function Lh(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Float32BufferAttribute(e,t)}function Rh(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Float64BufferAttribute(e,t)}function Nh(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AxesHelper(e)}function kh(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(e,t)}function Bh(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new LineSegments(new EdgesGeometry(e.geometry),new LineBasicMaterial({color:void 0!==t?t:16777215}))}function Fh(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new LineSegments(new WireframeGeometry(e.geometry),new LineBasicMaterial({color:void 0!==t?t:16777215}))}function Uh(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new FileLoader(e)}function Vh(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new DataTextureLoader(e)}function Hh(e,t,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new WebGLCubeRenderTarget(e,i)}function Gh(){console.error("THREE.CanvasRenderer has been removed")}function zh(){console.error("THREE.JSONLoader has been removed.")}Curve.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Path.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Loader.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),LoaderUtils.extractUrlBase(e)},Loader.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Box2.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},Box2.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Box2.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Box2.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},Box3.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Box3.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Box3.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Box3.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Box3.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Sphere.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Frustum.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Line3.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Matrix3.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Matrix3.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Matrix3.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Matrix3.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Matrix3.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Matrix3.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Matrix4.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Matrix4.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Matrix4.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Vector3).setFromMatrixColumn(this,3)},Matrix4.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Matrix4.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Matrix4.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Matrix4.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Matrix4.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Matrix4.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Matrix4.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Matrix4.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Matrix4.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Matrix4.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Matrix4.prototype.makeFrustum=function(e,t,i,n,s,r){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,i,s,r)},Matrix4.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Plane.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Quaternion.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Quaternion.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Ray.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Ray.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},Ray.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Triangle.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Triangle.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},Triangle.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},Triangle.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},Triangle.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},Triangle.barycoordFromPoint=function(e,t,i,n,s){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(e,t,i,n,s)},Triangle.normal=function(e,t,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(e,t,i,n)},Shape.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},Shape.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,e)},Shape.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,e)},Vector2.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},Vector2.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Vector2.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Vector3.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Vector3.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Vector3.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},Vector3.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},Vector3.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},Vector3.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},Vector3.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},Vector3.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Vector3.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Vector4.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},Vector4.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Object3D.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},Object3D.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Object3D.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},Object3D.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Object3D.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Mesh.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),qt},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},PerspectiveCamera.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Mi},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Mi)}}}),BufferAttribute.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Mi:_i),this},BufferAttribute.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},BufferAttribute.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},BufferGeometry.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},BufferGeometry.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new BufferAttribute(arguments[1],arguments[2])))},BufferGeometry.prototype.addDrawCall=function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},BufferGeometry.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},BufferGeometry.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},BufferGeometry.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},BufferGeometry.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),InterleavedBuffer.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Mi:_i),this},InterleavedBuffer.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ExtrudeGeometry.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},ExtrudeGeometry.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},ExtrudeGeometry.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Scene.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Uniform.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(os.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===v}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),ta.prototype.clearTarget=function(e,t,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,n)},ta.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},ta.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},ta.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},ta.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},ta.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},ta.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},ta.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},ta.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},ta.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},ta.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},ta.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},ta.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},ta.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},ta.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},ta.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},ta.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},ta.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},ta.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},ta.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},ta.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},ta.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},ta.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},ta.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},ta.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(ta.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Qt:$t}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Yo.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Audio.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new AudioLoader).load(e,(function(e){t.setBuffer(e)})),this},AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},CubeCamera.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},CubeCamera.prototype.clear=function(e,t,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,i,n)},ImageUtils.crossOrigin=void 0,ImageUtils.loadTexture=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const s=new TextureLoader;s.setCrossOrigin(this.crossOrigin);const r=s.load(e,i,void 0,n);return t&&(r.mapping=t),r},ImageUtils.loadTextureCube=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const s=new CubeTextureLoader;s.setCrossOrigin(this.crossOrigin);const r=s.load(e,i,void 0,n);return t&&(r.mapping=t),r},ImageUtils.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ImageUtils.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Wh={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function jh(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:n}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=n)},92924:(e,t,i)=>{"use strict";i.d(t,{ej:()=>l,kG:()=>c,U6:()=>p});var n=i(70655);!function(e){function t(){var t=this||self;t.globalThis=t,delete e.prototype._T_}"object"!=typeof globalThis&&(this?t():(e.defineProperty(e.prototype,"_T_",{configurable:!0,get:t}),_T_))}(Object);const s=globalThis;var r="Invariant Violation",o=Object.setPrototypeOf,a=void 0===o?function(e,t){return e.__proto__=t,e}:o,l=function(e){function t(i){void 0===i&&(i=r);var n=e.call(this,"number"==typeof i?r+": "+i+" (see https://github.com/apollographql/invariant-packages)":i)||this;return n.framesToPop=1,n.name=r,a(n,t.prototype),n}return(0,n.ZT)(t,e),t}(Error);function c(e,t){if(!e)throw new l(t)}var h=["log","warn","error","silent"],d=h.indexOf("log");function u(e){return function(){if(h.indexOf(e)>=d)return console[e].apply(console,arguments)}}function p(e){var t=h[d];return d=Math.max(0,h.indexOf(e)),t}!function(e){e.log=u("log"),e.warn=u("warn"),e.error=u("error")}(c||(c={}));var m=s.process||{env:{}};if(!s.process)try{Object.defineProperty(s,"process",{value:m})}catch(e){}},94015:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ErrorType:()=>f,default:()=>ErrorGui});var n=i(47724),s=i(41452),r=i(13789),o=i(60771),a=i(87207),l=i(68472),c=i(75673),h=i(81826);const d=e=>({problem:"",solution:e.t(r.Z.ERROR_BROWSER_SOLUTION),explanation:e.t(r.Z.ERROR_BROWSER_EXPLANATION),actions:(0,o.tq)()?"":["<div id='browser-tiles'>","<a href='https://www.google.com/chrome/browser/' target='_blank'>","<div class='tile'>",`<img src=${a}>`,"</div>","</a>","<a href='https://www.mozilla.org/en-US/firefox/new/' target='_blank'>","<div class='tile'>",`<img src=${l}>`,"</div>","</a>","<a href='https://www.microsoft.com/en-us/edge' target='_blank'>","<div class='tile'>",`<img src=${c}>`,"</div>","</a>","<a href='https://support.apple.com/en-us/HT204416' target='_blank'>","<div class='tile'>",`<img src=${h}>`,"</div>","</a>","</div>"].join("")}),u=e=>Object.assign(Object.assign({},d(e)),{problem:`${e.t(r.Z.ERROR_WEBGL_UNSUPPORTED_PROBLEM)}`}),p="https://support.matterport.com/hc/articles/208220058",m=e=>{const t=p,i=(0,o.tq)()?e.t(r.Z.ERROR_GENERIC_ACTIONS_MOBILE,{"support-url":t}):e.t(r.Z.ERROR_GENERIC_ACTIONS,{"browsers-url":"#install-browser","support-url":t});return{problem:e.t(r.Z.ERROR_GENERIC_PROBLEM),solution:e.t(r.Z.ERROR_GENERIC_SOLUTION),explanation:"",actions:i}},g=e=>{const t=e.t(r.Z.ERROR_LOADING_FAILED_ACTIONS,{"support-url":"https://support.matterport.com/hc/articles/208220058"});return{problem:e.t(r.Z.ERROR_LOADING_FAILED_PROBLEM),solution:"",explanation:"",actions:t}};var f;!function(e){e[e.UNSUPPORTED=1]="UNSUPPORTED",e[e.WEBGL=2]="WEBGL",e[e.GENERIC=3]="GENERIC"}(f||(f={}));class ErrorGui extends n.Y{constructor(){super(...arguments),this.name="error-gui"}async init(e,t){this.container=document.querySelector("#error-container"),this.problem=document.querySelector("#error-problem"),this.solution=document.querySelector("#error-solution"),this.explanation=document.querySelector("#error-explanation"),this.actions=document.querySelector("#error-actions"),this.localeModule=await t.getModule(s.default)}showError(e){switch(e){case f.UNSUPPORTED:this.populateErrorScreen(u);break;case f.WEBGL:this.populateErrorScreen(m);break;case f.GENERIC:default:this.populateErrorScreen(g)}const t=this.actions.querySelector('[href="#install-browser"]');t&&t.addEventListener("click",(e=>{e.preventDefault(),this.populateErrorScreen(d)}))}populateErrorScreen(e){const t=e(this.localeModule);this.container.classList.remove("hidden"),this.problem.innerText=t.problem,this.solution.innerText=t.solution,this.explanation.innerText=t.explanation,this.actions.innerHTML=t.actions}}},5029:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseGui});var n,s,r=i(26605),o=i(47724),a=i(94184),l=i.n(a),c=i(8150),h=i(21479),d=i(79553),u=i(92824),p=i(2904),m=i(13789),g=i(67027),f=i(35597),v=i(27326),y=i(3805),b=i(25923),S=i(96216),E=i(88512);!function(e){e.Inside="panorama",e.InsideMesh="mesh",e.Dollhouse="dollhouse",e.Floorplan="floorplan",e.None="none"}(n||(n={})),function(e){e.Inside="click_inside_mode_button",e.InsideMesh="click_mesh_mode_button",e.Dollhouse="click_dollhouse_mode_button",e.Floorplan="click_dollhouse_mode_button"}(s||(s={}));var w=i(60771),T=i(36114),_=i(47210),M=i(33746);class ModeButton extends r.Component{constructor(e){super(e),this.onClick=()=>{const{buttonId:e,analyticsName:t}=this.props;this.props.onClick(e,t)}}static isTouchDevice(){return(0,w.Jm)()}get tooltip(){return this.context.locale.t(this.props.tooltipPhraseKey)}render(){const{disabled:e,decorative:t,active:i,buttonId:n,tooltipPos:s}=this.props,o=i?_.BN.ACTIVE:e?_.BN.DISABLED:t?_.BN.DECORATIVE:_.BN.ENABLED,a=!ModeButton.isTouchDevice(),l=`icon-${n}`;return(0,r.h)(T.h,{onClick:this.onClick,className:`mode-${n}`,iconClass:a?void 0:l,buttonState:o,ariaLabel:this.tooltip},a&&(0,r.h)(M.oO,{content:this.tooltip,position:s||M.lZ.UP},(0,r.h)("span",{class:`icon ${l}`})))}}var x=i(3248);const A=["dh",x.gx.Dollhouse],O=["fp",x.gx.FloorPlan];function P(e,t){if(t)return!1;const i=e.checkUrlParam("dh",0,1),n=!e.tryGetProperty(x.gx.Dollhouse,!1);return i||n}function D(e,t){if(t)return!1;const i=e.checkUrlParam("fp",0,1),n=!e.tryGetProperty(x.gx.FloorPlan,!1);return i||n}function C(e,t){return!t&&!e}function I(e,t,i){const s=e===t;switch(e){case n.Dollhouse:case n.Floorplan:return i||!s;case n.Inside:return i?t!==n.InsideMesh:!s;case n.InsideMesh:return i?s:t===n.Inside}return!1}function L(e){switch(e){case n.Dollhouse:return y.BD.DOLLHOUSE;case n.Floorplan:return y.BD.FLOORPLAN;case n.Inside:case n.InsideMesh:return y.BD.INSIDE;default:throw new Error(`cannot get viewmode for mode buttonId ${e}`)}}const R=new E.Z("mode-buttons");class ModeButtons extends r.Component{constructor(e){super(e),this.onClick=async(e,t)=>{const{transitioning:i,activeButtonId:s,activeStateDisplay:r}=this.props;if(i)return;let o,a=L(e);if(e===s){if(!r)return;switch(e){case n.Inside:a=L(n.InsideMesh),o=1;break;case n.InsideMesh:a=L(n.Inside),o=0;break;case n.Dollhouse:case n.Floorplan:return}}else if(!r)switch(e){case n.Inside:o=0;break;case n.InsideMesh:o=1}const{analytics:l,commandBinder:c}=this.context;l.track("showcase_gui",{gui_action:t});try{await c.issueCommand(new S.vy),await c.issueCommand(new y._i(a)),void 0!==o&&c.issueCommand(new b.g(o))}catch(e){R.warn(e)}}}render(){const{activeButtonId:e,transitioning:t,viewmodeChangeEnabled:i,activeStateDisplay:o,dollhousePrevented:a,floorplanPrevented:l,insidePrevented:c,meshPrevented:h}=this.props,d=o?M.lZ.DOWN:M.lZ.UP,u=!i,p=t,g=!h&&I(n.InsideMesh,e,!!o),f=!c&&I(n.Inside,e,!!o),v=!a&&I(n.Dollhouse,e,!!o),y=!l&&I(n.Floorplan,e,!!o);return(0,r.h)("div",{class:"mode-buttons"},g&&(0,r.h)(ModeButton,{tooltipPhraseKey:m.Z.VIEW_INSIDE_MESH,tooltipPos:d,analyticsName:s.InsideMesh,buttonId:n.InsideMesh,active:e===n.InsideMesh,onClick:this.onClick,disabled:u,decorative:p}),f&&(0,r.h)(ModeButton,{tooltipPhraseKey:m.Z.VIEW_INSIDE,tooltipPos:d,analyticsName:s.Inside,buttonId:n.Inside,active:e===n.Inside,onClick:this.onClick,disabled:u,decorative:p}),v&&(0,r.h)(ModeButton,{tooltipPhraseKey:m.Z.VIEW_DOLLHOUSE,tooltipPos:d,analyticsName:s.Dollhouse,buttonId:n.Dollhouse,active:e===n.Dollhouse,onClick:this.onClick,disabled:u,decorative:p}),y&&(0,r.h)(ModeButton,{tooltipPhraseKey:m.Z.VIEW_FLOORPLAN,tooltipPos:d,analyticsName:s.Floorplan,buttonId:n.Floorplan,active:e===n.Floorplan,onClick:this.onClick,disabled:u,decorative:p}))}}class ModeControls extends r.Component{constructor(e){super(e),this.bindings=[],this.updateDollhouseState=()=>{const{editMode:e,settings:t}=this.context;this.setState({dollhousePrevented:P(t,e)})},this.updateFloorplanState=()=>{const{editMode:e,settings:t}=this.context;this.setState({floorplanPrevented:D(t,e)})},this.onCurrentFloorChanged=()=>{const{editMode:e}=this.context,t=this.floorsViewData.currentFloor,i=this.floorsViewData.hasEnabledAlignedSweeps(t&&t.id);this.setState({insidePrevented:C(i,e)})},this.onMeshDataUpdate=e=>{this.setState({showingMesh:0!==e.value})},this.onViewmodeChangeLockUpdate=()=>{const{market:e}=this.context,t=e.tryGetData(f.O);if(!t)return;const i=t.viewmodeChangeEnabled;this.setState({viewmodeChangeEnabled:i})},this.state={showingMesh:!1,dollhousePrevented:!1,floorplanPrevented:!1,insidePrevented:!1,viewmodeChangeEnabled:!0}}componentDidMount(){const{market:e,settings:t}=this.context;Promise.all([e.waitForData(g._),e.waitForData(f.O),e.waitForData(v.c)]).then((([e,i,n])=>{this.floorsViewData=n,this.bindings.push(i.onPropertyChanged("viewmodeChangeEnabled",this.onViewmodeChangeLockUpdate),n.makeFloorChangeSubscription(this.onCurrentFloorChanged),e.onPropertyChanged("meshTextureOpacity",this.onMeshDataUpdate)),A.forEach((e=>{this.bindings.push(t.onPropertyChanged(e,this.updateDollhouseState))})),O.forEach((e=>{this.bindings.push(t.onPropertyChanged(e,this.updateFloorplanState))})),this.onCurrentFloorChanged(),this.updateDollhouseState(),this.updateFloorplanState(),this.onMeshDataUpdate(e.meshTextureOpacity),this.onViewmodeChangeLockUpdate()}))}componentWillUnmount(){for(const e of this.bindings)e.cancel();this.bindings=[]}render(){const{editMode:e}=this.context,{unaligned:t,viewmode:i,activeStateDisplay:s}=this.props,{showingMesh:o,viewmodeChangeEnabled:a,dollhousePrevented:l,floorplanPrevented:c,insidePrevented:h}=this.state,d=i===y.BD.TRANSITIONING;d||(this.activeButtonId=function(e,t,i){return e?n.None:t===y.BD.DOLLHOUSE?n.Dollhouse:t===y.BD.FLOORPLAN?n.Floorplan:t===y.BD.INSIDE?i?n.InsideMesh:n.Inside:n.None}(t,i,o));const u=function(e){return!e}(e);return(0,r.h)(ModeButtons,{activeStateDisplay:s,activeButtonId:this.activeButtonId,transitioning:d,dollhousePrevented:l,floorplanPrevented:c,insidePrevented:h,meshPrevented:u,viewmodeChangeEnabled:a})}}var N=i(2116),k=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const B=new E.Z("tour-controls");let F=class TourControls extends r.Component{constructor(e){super(e),this.handlePlayPause=async()=>{if(!this.props.tourEmpty)try{this.props.tourPlaying?await this.stopTour():(this.context.analytics.track("showcase_gui",{gui_action:"play_highlights"}),await this.startTour())}catch(e){B.debug(e)}}}async startTour(){try{await this.context.commandBinder.issueCommand(new S.TH)}catch(e){B.debug(e)}}async stopTour(){try{this.context.analytics.track("showcase_gui",{gui_action:"pause_highlights"}),await this.context.commandBinder.issueCommand(new S.vy)}catch(e){B.debug(e)}}render(){const{tourEmpty:e,tourPlaying:t}=this.props,i="ontouchstart"in window,n=e?_.BN.DISABLED:t?_.BN.ACTIVE:_.BN.ENABLED,s=t?this.context.locale.t(m.Z.PAUSE):this.context.locale.t(m.Z.PLAY);return(0,r.h)(T.h,{buttonState:n,onClick:this.handlePlayPause,className:"tour-controls",ariaLabel:s},e?(0,r.h)("span",{class:"icon icon-play"}):(0,r.h)(M.oO,{content:s,position:M.lZ.UP,tooltipTimeout:i?1e3:void 0},(0,r.h)("span",{class:a({icon:!0,"icon-pause":t,"icon-play":!t})})))}};F=k([N.Z],F);const U=F,V=250;var H,G;!function(e){e.horizontal="horizontal",e.vertical="vertical"}(H||(H={})),function(e){e.x="x",e.y="y"}(G||(G={}));const z=e=>{switch(e){case H.horizontal:return G.x;case H.vertical:return G.y}throw Error()},W=e=>{switch(e){case G.x:return H.horizontal;case G.y:return H.vertical}throw Error()},j={[H.horizontal]:{scrollOffset:"scrollLeft",offsetLength:"offsetWidth",clientLength:"clientWidth",positionOffset:"offsetLeft",lengthName:"width",offsetName:"left",eventPosition:"clientX",delta:G.x},[H.vertical]:{scrollOffset:"scrollTop",offsetLength:"offsetHeight",clientLength:"clientHeight",positionOffset:"offsetTop",lengthName:"height",offsetName:"top",eventPosition:"clientY",delta:G.y}};var K;!function(e){e.Beginning="Beginning",e.Middle="Middle",e.End="End",e.None="None"}(K||(K={}));const q=(e,t)=>{for(const i in t)if(e[i]!==t[i])return!0;return!1};var Z=i(74002),Y=i(45862);class InputFilter{constructor(e){this.couldBeDrag=!1,this.isDragging=!1,this.shouldHandleEvents=!0,this.handleEvent=e=>{if(this.shouldHandleEvents)switch(e.stopPropagation(),e.type){case"mousedown":case"touchstart":case"pointerdown":this.onPressStart(e);break;case"mousemove":case"pointermove":case"touchmove":this.onPressMove(e);break;case"mouseup":case"pointerup":case"mouseleave":case"touchend":case"touchcancel":case"pointercancel":case"pointerleave":this.onPressEnd(e)}},this.callbacks=e}setEnabled(e){this.shouldHandleEvents=e,this.couldBeDrag=this.couldBeDrag&&e}getPosition(e){return(0,Z.z6)(e)?{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:{x:e.clientX,y:e.clientY}}onPressStart(e){this.couldBeDrag=!0,this.dragEvents=[],this.dragStart=this.getPosition(e),this.callbacks.handlePressStart&&this.callbacks.handlePressStart(this.getPosition(e))}onPressMove(e){if(!this.couldBeDrag)return;const t=this.getPosition(e);this.addDragEvent(t),this.isDragging||Math.sqrt(Math.pow(t.x-this.dragStart.x,2)+Math.pow(t.y-this.dragStart.y,2))>Y.JU&&(this.isDragging=!0,this.callbacks.handleDragStart&&this.callbacks.handleDragStart()),this.callbacks.handlePressMove&&this.callbacks.handlePressMove({x:this.dragStart.x-t.x,y:this.dragStart.y-t.y})}onPressEnd(e){if(this.couldBeDrag){if(this.couldBeDrag=!1,this.isDragging){if(!this.dragEvents||!this.dragEvents[0])return;const e=this.dragEvents[0],t=this.dragEvents[this.dragEvents.length-1];if(this.callbacks.handleDragEnd){const i={x:0,y:0};Date.now()-t.timestamp<InputFilter.dragMoveTimeout&&(i.x=e.position.x-t.position.x,i.y=e.position.y-t.position.y),this.callbacks.handleDragEnd(i,t.timestamp-e.timestamp)}}else this.callbacks.handleClick&&this.callbacks.handleClick(e);this.isDragging=!1}}addDragEvent(e){this.dragEvents.push({position:e,timestamp:Date.now()}),this.dragEvents.length>10&&this.dragEvents.shift()}}InputFilter.dragMoveTimeout=100;class Scrollbar extends r.Component{constructor(e){super(e),this.state={visible:!1,trackLength:1,thumbLength:1,thumbOffset:0},this.direction=j[e.direction],this.handlePressStart=this.handlePressStart.bind(this),this.handlePressMove=this.handlePressMove.bind(this),this.handleTrackClick=this.handleTrackClick.bind(this),this.inputFilter=new InputFilter({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove}),window.PointerEvent||(window.addEventListener("mousemove",this.inputFilter.handleEvent),window.addEventListener("mouseleave",this.inputFilter.handleEvent),window.addEventListener("mouseup",this.inputFilter.handleEvent)),window.addEventListener("pointermove",this.inputFilter.handleEvent),window.addEventListener("pointerup",this.inputFilter.handleEvent)}componentWillUnmount(){window.PointerEvent||(window.removeEventListener("mousemove",this.inputFilter.handleEvent),window.removeEventListener("mouseleave",this.inputFilter.handleEvent),window.removeEventListener("mouseup",this.inputFilter.handleEvent)),window.removeEventListener("pointermove",this.inputFilter.handleEvent),window.removeEventListener("pointerup",this.inputFilter.handleEvent)}getTrackLength(){return Number(this.thumbTrack&&this.thumbTrack[this.direction.clientLength]||window.innerWidth)}handleTrackClick(e){if(e.target!==this.thumbTrack)return;const t=this.direction.eventPosition,i=this.thumbTrack.getBoundingClientRect()[this.direction.offsetName],n=e[t]<i+this.state.thumbOffset,s=this.getTrackLength();let r=0;r=n?Math.max(0,(this.state.thumbOffset-this.state.thumbLength)/s):Math.min(s,(this.state.thumbOffset+this.state.thumbLength)/s),this.props.scrollTo({[z(this.props.direction)]:r})}handlePressStart(e){this.dragStartThumbOffset=this.state.thumbOffset}handlePressMove(e){const t=this.getTrackLength(),i=(this.dragStartThumbOffset-e[this.direction.delta])/t;this.props.scrollTo({[z(this.props.direction)]:i}),this.props.onThumbDrag&&this.props.onThumbDrag()}componentDidUpdate(){const{wrapperLength:e,childLength:t,scrollOffset:i}=this.props;if(e>0&&t>0){const s=this.getTrackLength(),r=e/t*s,o={thumbLength:r,visible:t>e,thumbOffset:Math.min(i/t*s,s-r)};if(q(this.state,o)){const e=this.state.visible!==o.visible;e&&this.props.onVisibilityChange&&this.props.onVisibilityChange(o.visible);const t=(n=o.thumbOffset/(s-r),o.visible?n<.01?K.Beginning:1-n<.01?K.End:K.Middle:K.None);(t!==this.scrollPosition||e)&&(this.scrollPosition=t,this.props.onScrollPositionChange&&this.props.onScrollPositionChange(t)),this.setState(o)}}var n}render(){const e={[`${this.direction.lengthName}`]:this.state.thumbLength+"px",[`${this.direction.offsetName}`]:this.state.thumbOffset+"px"},t=this.inputFilter.handleEvent,i=window.PointerEvent,n=i?t:void 0,s=i?void 0:t,o=i?void 0:t;return(0,r.h)("div",null,this.state.visible&&!this.props.forceHidden&&(0,r.h)("div",{class:"scrollbarTrack "+this.props.direction,onClick:this.handleTrackClick,ref:e=>{this.thumbTrack=e}},(0,r.h)("div",{class:"scrollbarThumb",style:e,onPointerDown:n,onMouseDown:o,onTouchStart:s})))}}var $=i(70179),Q=i(79437),X=i(85917);r.options.debounceRendering=requestAnimationFrame;class Scrollbars extends r.Component{constructor(e){super(e),this.horizontal={scrollbar:null,animation:null,dragStartScroll:0},this.vertical={scrollbar:null,animation:null,dragStartScroll:0},this.manuallyMoved=!1,this.scrollPosition={horizontal:K.Beginning,vertical:K.End},this.handleEvent=e=>{this.inputFilter.handleEvent(e)},this.getScrollableContainer=()=>this.innerWrapper,this.getScrolledOffset=e=>{const t=j[e].scrollOffset;return this.innerWrapper[t]/this.state[e].childLength},this.state={horizontal:{wrapperLength:1,childLength:1,scrollOffset:1,isVisible:!1},vertical:{wrapperLength:1,childLength:1,scrollOffset:1,isVisible:!1}},this.resizeSubscription=(0,X.kp)(X.g_.RESIZE,(()=>this.handleExternalChange(X.g_.RESIZE))),this.scrollTo=this.scrollTo.bind(this),this.handlePressStart=this.handlePressStart.bind(this),this.handlePressMove=this.handlePressMove.bind(this),this.handleDragEnd=this.handleDragEnd.bind(this),this.handleDragStart=this.handleDragStart.bind(this),this.handleWheelEvent=this.handleWheelEvent.bind(this),this.handleClick=this.handleClick.bind(this),this.toggleVisibility=this.toggleVisibility.bind(this),this.hasManuallyMoved=this.hasManuallyMoved.bind(this),this.inputFilter=new InputFilter({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove,handleDragStart:this.handleDragStart,handleDragEnd:this.handleDragEnd,handleClick:this.handleClick});const t=this.handleEvent;window.PointerEvent||(window.addEventListener("mousemove",t),window.addEventListener("mouseleave",t),window.addEventListener("mouseup",t)),window.addEventListener("pointermove",t),window.addEventListener("pointerup",t),window.addEventListener("touchmove",t),window.addEventListener("touchend",t),window.addEventListener("touchcancel",t)}componentDidMount(){if(this.resizeSubscription.renew(),this.innerWrapper.addEventListener("wheel",this.handleWheelEvent,!0),this.props.thumbScrollingOnly)this.innerWrapper.addEventListener("click",this.handleClick);else{const e=this.handleEvent;this.innerWrapper.addEventListener("mousedown",e),this.innerWrapper.addEventListener("pointerdown",e),this.innerWrapper.addEventListener("touchstart",e)}this.firstChild=this.innerWrapper.firstElementChild,this.props.onScrollPositionChange&&this.props.onScrollPositionChange(),this.props.hasOwnProperty("suppressDrag")&&this.inputFilter.setEnabled(!!this.props.suppressDrag)}componentWillUnmount(){const e=this.handleEvent;this.resizeSubscription.cancel(),window.PointerEvent||(window.removeEventListener("mousemove",e),window.removeEventListener("mouseleave",e),window.removeEventListener("mouseup",e)),window.removeEventListener("pointermove",e),window.removeEventListener("touchmove",e),window.removeEventListener("pointerup",e),window.removeEventListener("touchend",e),window.removeEventListener("touchcancel",e),this.innerWrapper.removeEventListener("wheel",this.handleWheelEvent,!0),this.props.thumbScrollingOnly?this.innerWrapper.removeEventListener("click",this.handleClick):(this.innerWrapper.removeEventListener("mousedown",e),this.innerWrapper.removeEventListener("pointerdown",e),this.innerWrapper.removeEventListener("touchstart",e))}componentWillReceiveProps(e){e.suppressDrag!==this.props.suppressDrag&&(this.inputFilter.setEnabled(!!this.props.suppressDrag),this.props.suppressDrag&&(this.manuallyMoved=!1))}getSnapshotBeforeUpdate(){this.props.waitToUpdate||this.handleExternalChange()}componentDidUpdate(){if(!this.horizontal.animation&&!this.vertical.animation)return;const e={};for(const t in this.state){const i=t;this[i].animation&&(this[i].animation.isAnimating?e[z(i)]=this[i].animation.getUpdatedValue():this[i].animation=null)}Object.keys(e).length>0&&window.requestAnimationFrame((()=>{this.innerWrapper&&this.scrollTo(e)}))}scrollTo(e){if(!e.hasOwnProperty(G.x)&&!e.hasOwnProperty(G.y))return;const t={};for(const i of this.getVisibleAxes(e)){const n=W(i),s=j[n].scrollOffset,r=e[i];if(void 0!==r){if(isNaN(r))return;this.innerWrapper[s]=Math.max(Math.min(1,r)*this.state[n].childLength,0),t[n]=Object.assign(Object.assign({},this.state[n]),{scrollOffset:this.innerWrapper[s]})}}this.setState(t)}animatedScrollTo(e,t){if(e.hasOwnProperty(G.x)||e.hasOwnProperty(G.y))for(const i of this.getVisibleAxes(e)){const n=W(i),s=j[n].scrollOffset;this[n].animation=new $.Z({duration:t||V,startValue:this.innerWrapper[s]/this.state[n].childLength,endValue:Math.max(0,Math.min(1,e[i]))})}}setScrollCenter(e){if(!(e&&e.compareDocumentPosition(this.innerWrapper)&Node.DOCUMENT_POSITION_CONTAINS))return;this.scrollCenter=e;const t={},i={};for(const n of this.getVisibleAxes(this.state)){const s=z(n);t[s]=e[j[n].positionOffset]+e[j[n].offsetLength]/2;let r=e;for(;r.parentElement&&r!==this.innerWrapper;)r=r.parentElement,t[s]+=r[j[n].positionOffset];const o=this.outerWrapper.parentElement[j[n].offsetLength];i[s]=(t[s]-o/2)/this.state[n].childLength}Object.keys(i).length>0&&this.animatedScrollTo(i)}getVisibleAxes(e){const t=[];for(const i in e)(e[i]||"number"==typeof e[i])&&(i in G&&this.state[W(i)].isVisible||i in H&&this.state[i].isVisible)&&t.push(i);return t}handleDragStart(){delete this.scrollCenter,this.hasManuallyMoved()}handlePressStart(){this.horizontal.dragStartScroll=this.innerWrapper.scrollLeft,this.vertical.dragStartScroll=this.innerWrapper.scrollTop}handlePressMove(e){const t={};for(const i of this.getVisibleAxes(e)){const n=W(i);t[i]=(e[i]+this[n].dragStartScroll)/this.state[n].childLength}this.scrollTo(t)}handleWheelEvent(e){this.props.singleScrollDirection===H.horizontal&&0===e.deltaX&&0!==e.deltaY?(this.handlePressStart(),this.handlePressMove({x:e.deltaY,y:0})):(this.hasManuallyMoved(),this.handleExternalChange())}handleClick(e){this.props.handleClick&&this.props.handleClick(e)}toggleVisibility(e){return t=>{const i=Object.assign(Object.assign({},this.state[e]),{isVisible:t});if(q(this.state[e],i)){const t={};t[e]=i,this.setState(t),this.props.onScrollbarVisibilityChange&&this.props.onScrollbarVisibilityChange()}}}toggleScrollPosition(e){return t=>{this.scrollPosition[e]=t,this.props.onScrollPositionChange&&this.props.onScrollPositionChange(t)}}handleDragEnd(e,t){for(const i of this.getVisibleAxes(e)){const n=W(i),s=e[i]/t,r=Math.min(V,Math.abs(V*s)),o=this.innerWrapper[j[n].scrollOffset],a=s*r/2;this[n].animation=new $.Z({duration:r,startValue:o/this.state[n].childLength,endValue:Math.max(0,Math.min((o+a)/this.state[n].childLength,1)),easingFunction:Q.hl})}this.setState({})}handleExternalChange(e){this.scrollCenter&&e&&e===X.g_.RESIZE&&this.setScrollCenter(this.scrollCenter);const t={};for(const e in this.state){const i=e,n=j[i].clientLength,s=Object.assign(Object.assign({},this.state[i]),{wrapperLength:Number(this.innerWrapper&&this.innerWrapper[n])||1,childLength:Number(this.firstChild&&this.firstChild[n])||1,scrollOffset:this.innerWrapper&&this.innerWrapper[j[i].scrollOffset]});q(this.state[i],s)&&(t[i]=s)}Object.keys(t).length>0&&this.setState(t)}hasManuallyMoved(){this.manuallyMoved=!0,this.props.onScrolled&&this.props.onScrolled()}resetManuallyMoved(){this.manuallyMoved=!1}renderScrollbar(e,t){const{forceHidden:i}=this.props,{wrapperLength:n,childLength:s,scrollOffset:o}=t;return(0,r.h)(Scrollbar,{direction:e,ref:e=>{this.horizontal.scrollbar=e},wrapperLength:n,childLength:s,scrollOffset:o,scrollTo:this.scrollTo,onVisibilityChange:this.toggleVisibility(e),onScrollPositionChange:this.toggleScrollPosition(e),forceHidden:i,onThumbDrag:this.hasManuallyMoved})}render(){const{scrollbarHeight:e,singleScrollDirection:t,name:i,children:n}=this.props,s={"max-height":e||""},o=t||`${H.vertical} ${H.horizontal}`;return(0,r.h)("div",{class:a("outerScrollbarWrapper",o,`scrollbar-${i}`),ref:e=>{this.outerWrapper=e},style:s},(0,r.h)("div",{class:"innerScrollbarWrapper",ref:e=>{this.innerWrapper=e}},(0,r.h)("div",{class:"paddingScrollbarWrapper"},n)),t!==H.vertical&&this.renderScrollbar(H.horizontal,this.state.horizontal),t!==H.horizontal&&this.renderScrollbar(H.vertical,this.state.vertical))}}class FloorIconSelector extends r.Component{constructor(e){super(e),this.floors={},this.scrollbars=null,this.canClick=!1,this.mobile=(0,w.tq)(),this.updateScrollCenter=()=>{if(Object.keys(this.floors).length<6||!this.scrollbars)return;const{currentFloor:e}=this.props;e?this.scrollbars.setScrollCenter(this.floors[e.id]):this.scrollbars.scrollTo({y:0})},this.onScrollbarClick=()=>{this.canClick=!0},this.setScrollbarRef=e=>{this.scrollbars=e,this.updateScrollCenter()},this.onOutsideClick=e=>{this.setShowMenu(!1)},this.onIconClick=e=>{e.stopPropagation(),this.setShowMenu(!this.state.showMenu),this.context.analytics.track("showcase_gui",{gui_action:"floor_controls"})},this.setShowMenu=e=>{this.state.showMenu!==e&&(e?window.addEventListener("click",this.onOutsideClick):window.removeEventListener("click",this.onOutsideClick),this.setState({showMenu:e}))},this.onFloorClick=e=>{if(this.scrollbars&&!this.canClick)return;e.stopPropagation(),this.setShowMenu(!1);const t=e.target.getAttribute("data-value");this.props.handleClickFloor(t),this.context.analytics.track("showcase_gui",{gui_action:"floor_clicked"})},this.renderFloorName=e=>{const{currentFloor:t,currentFloorIndicator:i}=this.props,n=i&&(null==t?void 0:t.id)===e.id,s=a("floor-button",{current:n});return(0,r.h)("div",{class:s,key:e.id,ref:t=>{this.floors[e.id]=t},onClick:this.onFloorClick,"data-value":e.id},e.name)},this.state={showMenu:!1}}componentDidUpdate(e){e.currentFloor!==this.props.currentFloor&&this.updateScrollCenter()}renderAllFloorName(){const e=!this.props.currentFloor,t=a("floor-button",{current:e}),i=this.context.locale.t(m.Z.FLOOR_ALL);return(0,r.h)("div",{class:t,key:"all",onClick:this.onFloorClick},i)}getFloorMenu(){let e=this.props.floors.map(this.renderFloorName);this.props.shouldShowAll&&e.push(this.renderAllFloorName()),e=e.reverse();const t=e.length>=6,i=a("floor-menu-wrapper",{"faded-in":this.state.showMenu,scrollable:t});return t?(0,r.h)("div",{class:i},(0,r.h)(Scrollbars,{name:"floor-menu-wrapper",forceHidden:this.mobile,ref:this.setScrollbarRef,singleScrollDirection:H.vertical,onScrollbarVisibilityChange:this.updateScrollCenter,handleClick:this.onScrollbarClick},e)):(this.scrollbars=null,(0,r.h)("div",{class:i},e))}render(){const{currentFloor:e,currentFloorIndicator:t}=this.props,{showMenu:i}=this.state,n=t&&e&&e.index+1,s=this.context.locale.t(m.Z.HELP_MORE_FLOORS_A),o=i?_.BN.ACTIVE:_.BN.ENABLED,l=a("select-floor",{"tooltip-hidden":i}),c=a("floor-number",{"two-digit":void 0!==n&&n>=10}),h=a("icon",{"icon-floor-controls-all":!n,"icon-floor-controls":n});return(0,r.h)(T.h,{buttonState:o,onClick:this.onIconClick,className:"floor-controls",ariaLabel:s},this.getFloorMenu(),(0,r.h)(M.oO,{content:s,position:M.lZ.UP,className:l},(0,r.h)("div",{class:c},(0,r.h)("span",null,n)),(0,r.h)("span",{class:h})))}}var J,ee,te=i(19806),ie=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e.NONE="no-arrow",e.TOP_LEFT="position-top-left",e.TOP_RIGHT="position-top-right",e.TOP_CENTER="position-top-center",e.BOTTOM_RIGHT="position-bottom-right",e.BOTTOM_LEFT="position-bottom-left",e.BOTTOM_CENTER="position-bottom-center",e.RIGHT_BOTTOM="position-right-bottom"}(ee||(ee={}));let ne=J=class Tooltip extends r.Component{constructor(e){super(e),this.closeTooltip=()=>{this.setState({showing:!1}),window.removeEventListener("click",this.handleOutsideClick)},this.timeoutTooltip=()=>{this.closeTooltip(),this.props.onTimeout&&this.props.onTimeout()},this.openTooltip=e=>{this.setState({showing:!0}),window.addEventListener("click",this.handleOutsideClick),void 0!==e&&window.setTimeout(this.timeoutTooltip,e)},this.getContentPosition=()=>{if(!this.tooltipWrapper)return{};const e=this.tooltipWrapper.parentElement;switch(this.props.arrowPos){case ee.BOTTOM_RIGHT:return{transform:`translate(${15-this.tooltipContent.offsetWidth}px, ${-this.tooltipContent.offsetHeight-e.getBoundingClientRect().height-22}px)`};case ee.BOTTOM_LEFT:return{transform:`translate(0, ${-this.tooltipContent.offsetHeight-e.getBoundingClientRect().height-35}px)`};case ee.RIGHT_BOTTOM:return{transform:`translate(${-this.tooltipContent.offsetWidth-7}px, ${9-this.tooltipContent.offsetHeight}px)`};default:return{}}},this.handleOutsideClick=e=>{this.props.onClose&&this.props.onClose(e)},this.state={showing:e.open};const t=J.count++;this.wrapperId=`tooltip-wrapper-${e.name||t}`,this.id=`${e.tooltipId||`tooltip-${t}`}`}static clearCount(){this.count=0}componentDidMount(){this.props.open&&this.openTooltip(this.props.maxMsOpen)}componentWillUnmount(){this.state.showing&&this.closeTooltip()}componentWillReceiveProps(e){e.open&&!this.props.open?this.openTooltip(e.maxMsOpen):!e.open&&this.props.open&&this.closeTooltip()}render(){const{arrowPos:e,title:t,message:i,onClose:n,closeButton:s,darkTheme:o,appendHTML:a,bodyClassName:c,className:h}=this.props,{showing:d}=this.state,u={emulatedDialog:!0,open:d,dark:o,[void 0===e?ee.TOP_CENTER:e]:!0};return(0,r.h)("div",{id:this.wrapperId,class:l()(u,h),ref:e=>this.tooltipWrapper=e},(0,r.h)("div",{id:this.id,class:l()("tooltip",c),style:this.getContentPosition(),ref:e=>this.tooltipContent=e},t&&(0,r.h)("div",{class:"title"},t),s&&n&&(0,r.h)(te.P,{onClose:n}),i,a))}};ne.POPUP_OFFSET=28,ne.count=0,ne=J=ie([N.Z],ne);class SelectMenu extends r.Component{constructor(e){super(e),this.onSelectOption=e=>{const t=e.target,i=t.getAttribute("data-index"),n=t.getAttribute("data-value");i&&this.props.onSelect(parseInt(i,10),n)}}getSelectedOption(){return this.props.options.find((e=>e.selected))||null}renderPopupContents(){const e=[];return this.props.options.forEach(((t,i)=>{const n=t.className||"";e.push((0,r.h)("div",{"data-index":i,"data-value":t.value,class:l()({tpMsg:!0,disabled:!!t.disabled,[n]:!!n}),onClick:this.onSelectOption},t.text))})),(0,r.h)("div",{class:"tooltip-menu"},e)}render(){const{id:e,onToggle:t,open:i,onClose:n,arrowPos:s,label:o,className:a,menuStyle:c}=this.props,h=this.getSelectedOption(),d=h?h.text:"",u=a||"",p={[u]:!!u,"select-button":c===se.BUTTON,"select-dropdown":c===se.DROPDOWN};return(0,r.h)("div",{class:l()("select-popup",p),id:e},o&&(0,r.h)("label",{class:"select-label"},o),(0,r.h)("div",{class:"select-trigger",onClick:t},(0,r.h)("span",{class:"select-menu-text"},d),(0,r.h)("span",{class:"icon icon-dpad-down"}),(0,r.h)(ne,{open:!!i,onClose:n,message:this.renderPopupContents(),arrowPos:s||ee.NONE,bodyClassName:"item-tooltip"})))}}var se;!function(e){e[e.DROPDOWN=0]="DROPDOWN",e[e.BUTTON=1]="BUTTON"}(se||(se={}));class FloorMenuSelector extends r.Component{constructor(e){super(e),this.changeFloor=(e,t)=>{this.props.handleClickFloor(t),this.context.analytics.track("showcase_gui",{gui_action:"floor_clicked"})},this.toggleMenu=e=>{e.stopPropagation(),this.setState((e=>({menuOpen:!e.menuOpen})))},this.closeMenu=()=>{this.setState({menuOpen:!1})},this.state={menuOpen:!1}}getFloorMenu(){const{locale:e}=this.context,{floors:t,shouldShowAll:i,currentFloor:n}=this.props,s=t.map((e=>({text:e.name,value:e.id,selected:(null==n?void 0:n.id)===e.id})));return i&&s.push({text:e.t(m.Z.FLOOR_ALL),value:"",selected:!n}),s}render(){const{menuOpen:e}=this.state,t=this.getFloorMenu();return(0,r.h)("div",{class:"floor-menu-selector"},(0,r.h)(SelectMenu,{menuStyle:se.DROPDOWN,open:e,onToggle:this.toggleMenu,onSelect:this.changeFloor,onClose:this.closeMenu,options:t}))}}var re=i(2725),oe=i(73844);const ae=new E.Z("floor-controls");class FloorControls extends r.Component{constructor(e){super(e),this.bindings=[],this.handleClickFloor=async e=>{try{await this.context.commandBinder.issueCommand(new S.vy);const t=null===e?"click_toggle_all_floors_button":"click_floor_select_button";this.context.analytics.track("showcase_gui",{gui_action:t});const i=new re.Vw(e);await this.context.commandBinder.issueCommand(i)}catch(e){ae.debug(e)}},this.onCurrentFloorChanged=()=>{var e,t;const i=(null===(e=this.floorsViewData)||void 0===e?void 0:e.currentFloor)||void 0,n=i&&(null===(t=this.floorsViewData)||void 0===t?void 0:t.getViewData(i.id));this.setState({currentFloor:n})},this.onFloorsChanged=()=>{var e,t;const i=(null===(e=this.floorsViewData)||void 0===e?void 0:e.getNavigableFloorIds()).map(null===(t=this.floorsViewData)||void 0===t?void 0:t.getViewData);this.setState({floors:i})},this.state={currentFloorIndicator:!0,floors:[]}}onSettingsChanged(){const{settings:e}=this.context,t=e.tryGetProperty(oe.u_,!0);this.setState({currentFloorIndicator:t})}componentDidMount(){const{settings:e,market:t}=this.context;e&&(this.bindings.push(e.onPropertyChanged(oe.u_,(()=>this.onSettingsChanged()))),this.onSettingsChanged()),t&&t.waitForData(v.c).then((e=>{this.floorsViewData=e,this.bindings.push(this.floorsViewData.makeFloorChangeSubscription(this.onCurrentFloorChanged),this.floorsViewData.floors.onNameChange(this.onFloorsChanged),this.floorsViewData.onNavigableFloorIdsChanged(this.onFloorsChanged)),this.onCurrentFloorChanged(),this.onFloorsChanged()}))}componentWillUnmount(){this.bindings.forEach((e=>{e.cancel()}))}render(){const{viewmode:e,iconStyle:t}=this.props,{currentFloor:i,currentFloorIndicator:n,floors:s}=this.state;if(!(s.length>1&&e!==y.BD.OUTSIDE))return null;const o=e!==y.BD.INSIDE;return(0,r.h)("div",{class:"floor-selector"},t&&(0,r.h)(FloorIconSelector,{floors:s,currentFloor:i,handleClickFloor:this.handleClickFloor,shouldShowAll:o,currentFloorIndicator:n}),!t&&(0,r.h)("span",{class:"divider"}),!t&&(0,r.h)(FloorMenuSelector,{floors:s,currentFloor:i,handleClickFloor:this.handleClickFloor,shouldShowAll:o,currentFloorIndicator:n}))}}var le=i(49080),ce=i(89046),he=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let de=class VrModalControls extends r.Component{constructor(e){super(e),this.handleClick=()=>{this.context.commandBinder.issueCommand(new ce.Bz(le.P.VR_SELECT,!this.props.open))}}render(){const e=this.context.locale.t(m.Z.VIEW_IN_VR);return(0,r.h)(T.h,{className:"view-in-vr",onClick:this.handleClick,ariaLabel:e},(0,r.h)(M.oO,{content:e,position:M.lZ.UP,tooltipTimeout:(0,w.Jm)()?1e3:void 0},(0,r.h)("span",{class:"icon icon-vr"})))}};de=he([N.Z],de);class FullscreenControls extends r.Component{constructor(e){super(e),this.handleButtonClick=()=>{w.rm()?(this.context.analytics.track("showcase_gui",{gui_action:"click_exit_fullscreen",interaction_source:"gui"}),w.Qg()):(this.context.analytics.track("showcase_gui",{gui_action:"click_enter_fullscreen",interaction_source:"gui"}),w.Zx(document.body))},this.onFullScreenChange=()=>{this.setState({fullscreen:w.rm()})},this.state={fullscreen:w.rm()},document.addEventListener("fullscreenchange",this.onFullScreenChange),document.addEventListener("webkitfullscreenchange",this.onFullScreenChange),document.addEventListener("MSFullscreenChange",this.onFullScreenChange),document.addEventListener("mozfullscreenchange",this.onFullScreenChange)}render(){const e=w.Jm(),{fullscreen:t}=this.state,i=t?this.context.locale.t(m.Z.EXIT_FULLSCREEN):this.context.locale.t(m.Z.VIEW_FULLSCREEN);return(0,r.h)("div",{class:"fullscreen-mode"},(0,r.h)(T.h,{onClick:this.handleButtonClick,ariaLabel:i},(0,r.h)(M.oO,{content:i,position:M.lZ.UP_LEFT,tooltipTimeout:e?1e3:void 0},(0,r.h)("span",{class:a("icon",t?"icon-fullscreen-exit":"icon-fullscreen")}))))}}var ue=i(66157),pe=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let me=class HighlightButton extends r.Component{constructor(e){super(e),this.handleButtonClick=()=>{const e=this.props.reelOpen?"hide_":"show_";this.context.analytics.track("showcase_gui",{gui_action:e+"highlight_reel"}),this.props.onToggleHLR(!this.props.reelOpen)}}render(){const{reelEnabled:e,reelOpen:t}=this.props,i=t?this.context.locale.t(m.Z.CLOSE_HIGHLIGHTS):this.context.locale.t(m.Z.OPEN_HIGHLIGHTS);return e?(0,r.h)(T.h,{className:"highlight-button",onClick:this.handleButtonClick,ariaLabel:i,"aria-expanded":t?"true":"false"},(0,r.h)(M.oO,{content:i,position:M.lZ.UP_RIGHT,tooltipTimeout:(0,w.Jm)()?1e3:void 0},(0,r.h)("span",{class:"icon "+(t?"icon-dpad-down":"icon-dpad-up")}))):null}};me=pe([N.Z],me);const ge=me,fe=e=>e.innerWidth<487||e.innerHeight<487;var ve=i(27408);r.options.debounceRendering=requestAnimationFrame;class SingleScrollbar extends r.Component{constructor(e){super(e),this.dragStartScroll=0,this.listening=!1,this.animation=null,this.handlingPaused=!1,this.handleEvent=e=>{"mousedown"!==e.type&&"pointerdown"!==e.type&&"touchstart"!==e.type||(this.handlingPaused=!1),this.props.suppressDrag||this.handlingPaused||this.inputFilter.handleEvent(e)},this.getScrolledOffset=()=>{if(!this.innerWrapper&&0===this.state.contentSize)return 0;const e=this.props.direction===H.vertical?"scrollTop":"scrollLeft";return this.innerWrapper[e]/this.state.contentSize},this.getScrollableContainer=()=>this.innerWrapper,this.pauseScrollHandling=()=>{this.handlingPaused=!0,this.toggleDownEventListening(!1)},this.scrollWithScrollBar=e=>{if(!this.props.suppressDrag){const t=this.getAxis();e.hasOwnProperty(t)&&this.scrollTo(e[t])}},this.scrollTo=e=>{void 0===e||isNaN(e)||(this.setScrollPosition(Math.max(Math.min(1,e)*this.state.contentSize,0)),this.setState({scrollOffset:this.getScrollPosition()}))},this.handleDragStart=()=>{this.setState({scrollCenter:null})},this.handlePressStart=()=>{this.dragStartScroll=this.getScrollPosition()},this.handlePressMove=e=>{if(!this.props.suppressDrag){const t=(e[this.getAxis()]+this.dragStartScroll)/this.state.contentSize;this.scrollTo(t)}},this.handleWheelEvent=e=>{if(this.props.suppressDrag)return void e.preventDefault();this.props.direction===H.horizontal&&0===e.deltaX&&0!==e.deltaY?(this.handlePressStart(),this.handlePressMove({x:e.deltaY,y:0})):(this.setState({scrollCenter:null}),this.handleExternalChange())},this.handleClick=e=>{this.props.handleClick&&this.props.handleClick(e)},this.handleDragEnd=(e,t)=>{const i=e[this.getAxis()]/t,n=Math.min(V,Math.abs(V*i)),s=this.getScrollPosition(),r=i*n/2;this.animation=new $.Z({duration:n,startValue:s/this.state.contentSize,endValue:Math.max(0,Math.min((s+r)/this.state.contentSize,1)),easingFunction:Q.hl})},this.onManualScroll=()=>{this.props.onScrolled&&this.props.onScrolled()},this.onButtonScroll=e=>{if(this.contentContainer&&this.props.steps){const t=this.props.direction===H.vertical?"offsetHeight":"offsetWidth",i=this.contentContainer[t]/this.props.steps,n=this.getScrollPosition();let s;s=e?(n+i)/this.state.contentSize:(n-i)/this.state.contentSize,this.scrollTo((0,ve.uZ)(s,0,1))}},this.onScrollBack=()=>{this.onButtonScroll(!1)},this.onScrollForward=()=>{this.onButtonScroll(!0)},this.onHoldScrollBack=()=>{this.mouseInterval=window.setInterval(this.onScrollBack,300)},this.onHoldScrollForward=()=>{this.mouseInterval=window.setInterval(this.onScrollForward,300)},this.onScrollButtonUp=()=>{window.clearInterval(this.mouseInterval)},this.renderScrollBackButton=()=>{const e=this.getScrollPosition(),t=this.props.direction===H.vertical?"icon-dpad-up":"icon-dpad-left",i=0===e?_.BN.DISABLED:_.BN.ENABLED;return(0,r.h)(T.h,{className:l()("scroll-button","scroll-back"),iconClass:t,buttonStyle:T.D.CLEAR,buttonState:i,onClick:this.onScrollBack,onMouseDown:this.onHoldScrollBack,onMouseUp:this.onScrollButtonUp})},this.renderScrollForwardButton=()=>{const e=this.getScrollPosition(),t=this.props.direction===H.vertical?"offsetHeight":"offsetWidth",i=this.props.direction===H.vertical?"icon-dpad-down":"icon-dpad-right",n=this.contentContainer[t]-this.innerWrapper[t]-e>0?_.BN.ENABLED:_.BN.DISABLED;return(0,r.h)(T.h,{className:l()("scroll-button","scroll-forward"),iconClass:i,buttonStyle:T.D.CLEAR,buttonState:n,onClick:this.onScrollForward,onMouseDown:this.onHoldScrollForward,onMouseUp:this.onScrollButtonUp})},this.setOuterWrapper=e=>this.outerWrapper=e,this.setInnerWrapper=e=>this.innerWrapper=e,this.setcontentContainer=e=>this.contentContainer=e,this.state={scrollCenter:null,scrollOffset:0,innerSize:0,contentSize:0},this.resizeSubscription=(0,X.kp)(X.g_.RESIZE,(()=>this.handleExternalChange(X.g_.RESIZE))),this.inputFilter=new InputFilter({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove,handleDragStart:this.handleDragStart,handleDragEnd:this.handleDragEnd,handleClick:this.handleClick})}componentDidMount(){this.resizeSubscription.renew(),this.props.thumbScrollingOnly?this.innerWrapper.addEventListener("click",this.handleClick):this.toggleDownEventListening(!0),this.toggleDragHandling(!0),this.innerWrapper.addEventListener("wheel",this.handleWheelEvent),this.inputFilter.setEnabled(!this.props.suppressDrag),this.handleExternalChange()}componentWillUnmount(){this.resizeSubscription.cancel(),this.innerWrapper.removeEventListener("wheel",this.handleWheelEvent),this.toggleDragHandling(!1),this.props.thumbScrollingOnly?this.innerWrapper.removeEventListener("click",this.handleClick):this.toggleDownEventListening(!1)}componentWillReceiveProps(e){e.thumbScrollingOnly&&!this.props.thumbScrollingOnly?(this.innerWrapper.addEventListener("click",this.handleClick),this.toggleDownEventListening(!1)):!e.thumbScrollingOnly&&this.props.thumbScrollingOnly&&(this.toggleDownEventListening(!0),this.innerWrapper.removeEventListener("click",this.handleClick)),e.suppressDrag!==this.props.suppressDrag&&this.inputFilter.setEnabled(!e.suppressDrag)}componentDidUpdate(e,t){const i=this.animation;if(i)if(i.isAnimating){const e=i.getUpdatedValue();window.requestAnimationFrame((()=>{this.innerWrapper&&this.scrollTo(e)}))}else this.animation=null;t.scrollOffset!==this.state.scrollOffset&&this.props.onScrolled&&this.props.onScrolled()}toggleDownEventListening(e){const t=this.handleEvent;e?window.PointerEvent?this.innerWrapper.addEventListener("pointerdown",t):(this.innerWrapper.addEventListener("mousedown",t),this.innerWrapper.addEventListener("touchstart",t)):window.PointerEvent?this.innerWrapper.removeEventListener("pointerdown",t):(this.innerWrapper.removeEventListener("mousedown",t),this.innerWrapper.removeEventListener("touchstart",t))}toggleDragHandling(e){const t=this.handleEvent;!this.listening&&e?(this.listening=!0,window.PointerEvent?(window.addEventListener("pointermove",t),window.addEventListener("pointerup",t)):(window.addEventListener("mousemove",t),window.addEventListener("mouseleave",t),window.addEventListener("mouseup",t),window.addEventListener("touchmove",t),window.addEventListener("touchend",t),window.addEventListener("touchcancel",t))):this.listening&&!e&&(this.listening=!1,window.PointerEvent?(window.removeEventListener("pointermove",t),window.removeEventListener("pointerup",t)):(window.removeEventListener("mousemove",t),window.removeEventListener("mouseleave",t),window.removeEventListener("mouseup",t),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)))}getScrollPosition(){if(!this.innerWrapper)return 0;const e=this.props.direction===H.vertical?"scrollTop":"scrollLeft";return this.innerWrapper[e]}setScrollPosition(e){if(!this.innerWrapper)return;const t=this.props.direction===H.vertical?"scrollTop":"scrollLeft";this.innerWrapper[t]=e}getAxis(){return this.props.direction===H.vertical?"y":"x"}getSnapshotBeforeUpdate(){this.props.waitToUpdate||this.handleExternalChange()}scrollToPercentage(e,t){this.animation=new $.Z({duration:t,startValue:this.getScrolledOffset(),endValue:Math.max(0,Math.min(1,e))})}scrollToElement(e){if(!(e&&e.compareDocumentPosition(this.innerWrapper)&Node.DOCUMENT_POSITION_CONTAINS))return;const t=this.props.direction===H.vertical;this.setState({scrollCenter:e});const i=t?"offsetTop":"offsetLeft",n=t?"offsetHeight":"offsetWidth";let s=e[i]+e[n]/2,r=e;for(;r.parentElement&&r!==this.innerWrapper;)r=r.parentElement,s+=r[i];const o=(s-this.outerWrapper.parentElement[n]/2)/this.state.contentSize;this.animation=new $.Z({duration:V,startValue:this.getScrollPosition()/this.state.contentSize,endValue:Math.max(0,Math.min(1,o))})}handleExternalChange(e){if(!this.innerWrapper||!this.contentContainer)return;this.state.scrollCenter&&e&&e===X.g_.RESIZE&&this.scrollToElement(this.state.scrollCenter);const t=this.props.direction===H.vertical?"clientHeight":"clientWidth",i={innerSize:Number(this.innerWrapper&&this.innerWrapper[t])||1,contentSize:Number(this.contentContainer&&this.contentContainer[t])||1,scrollOffset:this.innerWrapper&&this.getScrollPosition()};q(this.state,i)&&this.setState(i)}needScrolling(){if(!this.contentContainer||!this.outerWrapper)return!1;const e=this.props.direction===H.vertical?"offsetHeight":"offsetWidth";return this.contentContainer[e]>this.outerWrapper[e]}render(){const{hideScrollbar:e,children:t,onScrollableChanged:i,scrollButtons:n,steps:s,onScrollPositionChange:o,direction:a,className:c}=this.props,{innerSize:h,contentSize:d,scrollOffset:u}=this.state,p=n&&!!s&&this.needScrolling();return(0,r.h)("div",{class:l()("outerScrollbarWrapper",[a],[c],{"button-scrolling":p}),ref:this.setOuterWrapper},p&&this.renderScrollBackButton(),(0,r.h)("div",{class:"innerScrollbarWrapper",ref:this.setInnerWrapper},(0,r.h)("div",{class:"paddingScrollbarWrapper",ref:this.setcontentContainer},t)),(0,r.h)(Scrollbar,{direction:a,wrapperLength:h,childLength:d,scrollOffset:u,scrollTo:this.scrollWithScrollBar,forceHidden:!!e,onVisibilityChange:i,onScrollPositionChange:o,onThumbDrag:this.onManualScroll}),p&&this.renderScrollForwardButton())}}class ReelScrollContainer extends r.Component{constructor(e){super(e),this.onWindowResize=()=>{const e=fe(window);this.state.hideScrollbar!==e&&this.setState({hideScrollbar:e})},this.onScrollableChanged=e=>{this.setState({scrollable:e})},this.onScrollPositionChange=e=>{this.setState({scrollPosition:e})},this.getScrollableContainer=()=>this.scrollbar?this.scrollbar.getScrollableContainer():void 0,this.handleHighlightClickable=()=>{this.props.highlightClickable(!0)},this.state={scrollLeft:0,hideScrollbar:fe(window),scrollPosition:K.None,scrollable:!1},this.resizeSubscription=(0,X.kp)(X.g_.RESIZE,this.onWindowResize)}componentDidMount(){this.resizeSubscription.renew(),this.onScrollableChanged(!0),this.onScrollPositionChange(K.Beginning)}componentWillUnmount(){this.resizeSubscription.cancel()}componentDidUpdate(e){const{activeElement:t}=this.props;null!==t&&e.activeElement!==t&&this.scrollbar.scrollToElement(t)}setSorting(e){e?(this.el.classList.add("sorting"),this.props.mobile&&this.scrollbar.pauseScrollHandling()):this.el.classList.remove("sorting")}render(){const{thumbScrollingOnly:e,children:t,totalSteps:i}=this.props,{hideScrollbar:n,scrollPosition:s,scrollable:o}=this.state,l=a({scrollable:o,[s]:!0});return(0,r.h)("div",{id:"reel",class:l,ref:e=>{this.el=e}},(0,r.h)(SingleScrollbar,{direction:H.horizontal,ref:e=>this.scrollbar=e,hideScrollbar:n,thumbScrollingOnly:e,waitToUpdate:0===i,handleClick:this.handleHighlightClickable,onScrollableChanged:this.onScrollableChanged,onScrollPositionChange:this.onScrollPositionChange},t))}}class EmptyReel extends r.Component{constructor(){super()}render(){return(0,r.h)("div",{class:"no-highlights-message"},(0,r.h)("p",null,"Your space does not have any highlights yet."),(0,r.h)("p",null,"A Highlight Reel lets your visitors get a taste of what the Space is like.",(0,r.h)("a",{class:"link",target:"_blank",href:"https://support.matterport.com/hc/en-us/articles/360019401733"},"Learn More")))}}var ye,be=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e[e.OPEN=0]="OPEN",e[e.UNLOADING=1]="UNLOADING",e[e.CLOSED=2]="CLOSED"}(ye||(ye={}));let Se=class TransitionedUnload extends r.Component{constructor(e){super(e),this.onTransitionEnd=()=>{this.state.phase===ye.UNLOADING&&this.setState({phase:ye.CLOSED,activeChild:null})},this.onClick=e=>{this.props.onClick&&this.props.onClick(e)},this.onPointerDown=e=>{this.props.onPointerDown&&this.props.onPointerDown(e)},this.onPointerUp=e=>{this.props.onPointerUp&&this.props.onPointerUp(e)},this.state={phase:e.open?ye.OPEN:ye.CLOSED,activeChild:e.selectChild&&e.childKey||null}}componentWillReceiveProps(e){const{open:t}=this.props;t&&!e.open?this.setState({phase:ye.UNLOADING}):!t&&e.open&&this.setState({phase:ye.OPEN,activeChild:e.selectChild&&e.childKey||null})}renderChildren(){const{children:e,selectChild:t}=this.props,{phase:i,activeChild:n}=this.state;return i===ye.CLOSED||t&&!n?null:t?e&&Array.isArray(e)&&e.length&&e.find((e=>e&&e.key===n))||null:e}render(){const{id:e,className:t}=this.props,{phase:i}=this.state,n=l()({unloading:i===ye.UNLOADING},t);return(0,r.h)("div",{id:e,class:n,onTransitionEnd:this.onTransitionEnd,onClick:this.onClick,onPointerDown:this.onPointerDown,onPointerUp:this.onPointerUp},this.renderChildren())}};Se=be([N.Z],Se);var Ee=i(98828),we=i(10757),Te=i(31278),_e=i(52599),Me=i(94329);const{HLR:xe}=m.Z.WORKSHOP;class Highlight extends r.Component{constructor(e){super(e),this.editHighlight=e=>{e.stopPropagation(),this.props.onClickHighlight(this.props.index,!0)},this.removeHighlight=e=>{e.stopPropagation(),this.props.onRemoveHighlight&&this.props.onRemoveHighlight(this.props.highlight.snapshot.sid)},this.onClickHighlight=e=>{e.preventDefault(),this.props.onClickHighlight(this.props.index,!1)},this.setContainerRef=e=>{const{index:t,getRef:i}=this.props;this.element=e,i(t,this.element)},this.setState({thumbnailUrl:""})}componentDidMount(){this.loadThumbnail()}async loadThumbnail(){const{snapshot:e}=this.props.highlight,t=await e.thumbnailUrl.get();this.setState({thumbnailUrl:t})}renderTransitionSettings(){const{locale:e}=this.context,{transitionType:t,panDirection:i,transitionCondition:n}=this.props;let s="pan-auto";i===_e.kw.Left?s="icon icon-rotate-left":i===_e.kw.Right&&(s="icon icon-rotate-right");let o="";return t===Te.n.FadeToBlack?o=e.t(xe.TRANSITION_SETTING_SLIDESHOW):t===Te.n.Interpolate&&(o=e.t(xe.TRANSITION_SETTING_WALKTHROUGH)),(0,r.h)("div",{class:"transition-settings"},(0,r.h)("span",{class:"transition-type"},o,n&&(0,r.h)("span",null,"*")),(0,r.h)("span",{class:`pan-icon ${s}`}))}renderImageBar(){const{locale:e}=this.context,{highlight:t,editable:i}=this.props,n=t.snapshot.is360,s=t.snapshot.metadata.cameraMode,o=this.getMarker(s,n),l=e.t(xe.REMOVE_HIGHLIGHT_TOOLTIP_MESSAGE),c=e.t(xe.EDIT_HIGHLIGHT_TOOLTIP_MESSAGE);return(0,r.h)("div",{class:"image-bar"},(0,r.h)("span",{class:a("highlight-marker",o)}),i&&(0,r.h)(M.oO,{className:"highlight-remove",content:l,position:M.lZ.DOWN_RIGHT},(0,r.h)("span",{class:a("icon-delete"),"aria-label":l,"aria-labelledby":"",onClick:this.removeHighlight})),i&&(0,r.h)(M.oO,{className:"highlight-edit",content:c,position:M.lZ.DOWN_LEFT},(0,r.h)("span",{class:a("icon-toggle-pencil"),"aria-label":c,onClick:this.editHighlight})))}getMarker(e,t){return e===Me.Ey.Dollhouse||e===Me.Ey.Floorplan?null:t?"icon-360":"icon-panorama"}render(){const{thumbnailUrl:e}=this.state,{highlight:t,active:i,editable:n}=this.props,{name:s}=t.snapshot,o=!!s||n,l=e?{backgroundImage:`url('${e}')`}:{};return(0,r.h)("div",{class:a("highlight-box",{active:i,editable:n}),onClick:this.onClickHighlight,ref:this.setContainerRef},(0,r.h)("div",{class:"highlight-image",style:l}),this.renderImageBar(),n&&this.renderTransitionSettings(),(0,r.h)("div",{class:a("image-name",{shadowed:o})},(0,r.h)("span",{class:"static-text",role:"listitem","aria-label":s||"highlight"},s)))}}class ReelContents extends r.Component{constructor(e){super(e),this.highlights=[],this.highlightList=e=>{const{currentStep:t,onHighlightClicked:i}=this.props;return(0,r.h)("div",{class:"hlr-container"},(0,r.h)("div",{class:"highlights",role:"list"},e.items.map(((e,n)=>(0,r.h)(Highlight,{key:`${e.sid}_${n}`,highlight:e,index:n,active:n===t,editable:!1,onClickHighlight:i,getRef:this.addHighlightRef})))))},this.addHighlightRef=(e,t)=>{this.highlights[e]=t,e===this.props.currentStep&&this.props.setActiveElement&&this.props.setActiveElement(t)}}render(){const{highlights:e}=this.props;return e&&e.length?(0,r.h)(this.highlightList,{items:e}):null}}var Ae=i(80191),Oe=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const Pe=new E.Z("highlight-reel");var De;!function(e){e[e.flash=0]="flash",e[e.expanded=1]="expanded",e[e.collapsed=2]="collapsed"}(De||(De={}));const Ce=[De.flash,De.expanded,De.collapsed];let Ie=class ReelReadOnly extends r.Component{constructor(e){super(e),this.bindings=[],this.mobile=(0,w.tq)(),this.showReel=()=>{if(this.props.onToggleHLR&&this.props.highlights.length>0)switch(this.hlStartupStyle){case De.expanded:case De.flash:this.props.onToggleHLR(!0)}},this.setActiveElement=e=>{this.setState({activeElement:e})},this.setHighlightClickable=(e=>this.highlightClickable=e).bind(this),this.onHighlightClicked=async e=>{const{commandBinder:t,analytics:i}=this.context;if(this.highlightClickable)try{this.props.tourPlaying&&await t.issueCommand(new S.vy),this.props.transition.active||(i.track("showcase_gui",{gui_action:"click_highlight"}),await t.issueCommand(new S.rU(e)).catch((e=>{if(!(e instanceof Ae.z))throw e;Pe.warn(e.message)})),this.setHighlightClickable(!1))}catch(e){Pe.debug(e)}},this.state={activeElement:null}}componentDidMount(){if(this.props.briefHlr){const e=this.context.settings.tryGetProperty(x.gx.HighlightReel,!0);!this.context.editMode&&this.props.totalSteps>0&&e&&(this.hlStartupStyle=this.getHlStartupValue(),(0,we.gw)(100).then((()=>{this.showReel(),(0,we.gw)(3e3).then((()=>{this.dismissReel(),this.props.onBriefHLR&&this.props.onBriefHLR()}))})))}}componentWillUnmount(){this.bindings.forEach((e=>{e.cancel()}))}render(){const{reelOpen:e,activeStep:t,highlights:i,totalSteps:n}=this.props,s=n>0,o=s?(0,r.h)(ReelContents,{highlights:i,currentStep:t,onHighlightClicked:this.onHighlightClicked,setActiveElement:this.setActiveElement}):(0,r.h)(EmptyReel,null);return(0,r.h)(Se,{className:l()("highlight-reel",{"reel-viewing":s,"reel-empty":!s}),open:e},(0,r.h)("div",{id:"reel-container"},(0,r.h)(ReelScrollContainer,{totalSteps:n,activeElement:this.state.activeElement,mobile:this.mobile,highlightClickable:this.setHighlightClickable,thumbScrollingOnly:!1},o)))}getHlStartupValue(){if(""!==(0,Ee.h)("note",""))return De.collapsed;const e=this.props.highlights.some((e=>e.snapshot.is360))?De.expanded:De.flash,t=(0,Ee.h)("hl",e);return Ce.includes(t)?t:e}dismissReel(){this.props.onToggleHLR&&this.hlStartupStyle===De.flash&&this.props.onToggleHLR(!1)}};Ie=Oe([N.Z],Ie);const Le=Ie;var Re=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ne=class TourProgress extends r.Component{constructor(e){super(e),this.handleClick=()=>{this.context.analytics.track("showcase_gui",{gui_action:"tour_progress"}),this.props.reelOpen||this.props.onToggleHLR(!0)}}getTourSteps(){const{totalSteps:e,activeStep:t}=this.props,i=[];for(let n=0;n<e;n++)i.push((0,r.h)("div",{class:a({active:n===t}),key:n.toString()}));return i}render(){const{reelOpen:e,tourPlaying:t,activeStep:i,totalSteps:n}=this.props,s=i+1+"/"+n,o=-1!==i&&!e&&s,l=-1!==i&&e&&t;return n>0?(0,r.h)("div",{id:"tour-progress",class:a({"faded-in":t}),onClick:this.handleClick,"data-balloon":o,"data-balloon-pos":"right","data-balloon-size":"xs"},l&&(0,r.h)("div",{class:"progress-number"},s),-1!==i&&(0,r.h)("div",{class:"progress-bar"},this.getTourSteps())):null}};Ne=Re([N.Z],Ne);const ke=Ne,Be=new E.Z("pause-button");class PauseButton extends r.Component{constructor(e){super(e),this.justEnded=!1,this.stopTour=async e=>{this.context.analytics.track("showcase_gui",{gui_action:"tour_stopped"}),e.preventDefault();try{this.context.commandBinder.issueCommand(new S.vy)}catch(e){Be.debug(e)}},this.state={justPaused:!1}}componentDidUpdate(){this.state.justPaused&&this.setState({justPaused:!1}),this.justEnded=!1}componentWillReceiveProps(e){!this.props.tourPlaying||e.tourPlaying||this.justEnded||this.setState({justPaused:!0}),this.props.tourEnded&&(this.justEnded=!0)}render(){const{tourPlaying:e}=this.props,{justPaused:t}=this.state;return(0,r.h)("div",{id:"pause-button",onClick:this.stopTour,onTouchMove:this.stopTour,onTouchStart:this.stopTour},!e&&(0,r.h)("img",{src:i(31896),class:a({justPaused:t}),alt:"","aria-hidden":"true"}))}}var Fe,Ue=i(98292),Ve=i(87182),He=i(55305),Ge=i(92532),ze=i(84842),We=i(76495),je=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ke=Fe=class NotesModeButton extends r.Component{constructor(e,t){super(e),this.nudgeTimeout=0,this.bindings=[],this.onModalToggled=e=>{e.modal!==le.P.NOTES_INTRO||e.open||this.toggleNotesMode(!0)},this.dismissNudge=()=>{this.state.showNudge&&(this.trackEvent("notes_nudge_dismissed"),this.context.settings.setLocalStorageProperty(He.F.NotesModeNudgeSeen,!0),this.setState({showNudge:!1}))},this.modeButtonClicked=()=>{const e=this.props.openTool!==d.w1.NOTES;if(e){const{commandBinder:e,settings:t}=this.context;this.trackEvent("notes_mode_click_open");if(!t.tryGetProperty(He.F.NotesIntroModalSeen,!1))return void e.issueCommand(new ce.Bz(le.P.NOTES_INTRO,!0))}this.toggleNotesMode(e)},this.localized={notesModeString:t.locale.t(m.Z.NOTES_MODE),nudgeTitleString:t.locale.t(m.Z.NOTES_NUDGE_TITLE),nudgeMessageString:t.locale.t(m.Z.NOTES_NUDGE_MESSAGE)},this.state={showNudge:!1}}componentDidMount(){this.updateNudge(),this.bindings.push(this.context.messageBus.subscribe(ze.nV,this.onModalToggled))}componentWillUnmount(){for(const e of this.bindings)e.cancel()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}updateNudge(){const e=this.context.settings.tryGetProperty(Ve.pE,!1),t=this.context.settings.tryGetProperty(He.F.NotesModeNudgeSeen,!1);!e||t||this.nudgeTimeout||(this.nudgeTimeout=window.setTimeout((()=>{this.setState({showNudge:!0}),window.setTimeout((()=>{this.dismissNudge()}),Fe.DISMISS_NUDGE_TIMEOUT)}),Fe.SHOW_NUDGE_TIMEOUT))}toggleNotesMode(e){const{commandBinder:t,messageBus:i}=this.context;e&&i.broadcast(new We.Ey),t.issueCommand(new Ge.tT(d.w1.NOTES,e))}render(){const{tooltipTimeout:e,openTool:t}=this.props,{showNudge:i}=this.state,{nudgeTitleString:n,nudgeMessageString:s}=this.localized,o=this.localized.notesModeString,a=t===d.w1.NOTES?_.BN.ACTIVE:_.BN.ENABLED;return(0,r.h)("div",{class:"notes-mode-button"},(0,r.h)(T.h,{ariaLabel:o,buttonState:a,onClick:this.modeButtonClicked},(0,r.h)(M.oO,{content:o,position:M.lZ.UP,tooltipTimeout:e},(0,r.h)("span",{class:"icon icon-comment-outline"}))),(0,r.h)(ne,{className:l()("tooltip-title-large","nudge-tooltip"),open:i,closeButton:!0,onClose:this.dismissNudge,title:n,message:(0,r.h)("div",{class:"nudge-message"},(0,r.h)("span",{class:"message"},s)),arrowPos:ee.BOTTOM_CENTER}))}};Ke.SHOW_NUDGE_TIMEOUT=15e3,Ke.DISMISS_NUDGE_TIMEOUT=1e4,Ke=Fe=je([N.Z],Ke);const qe=Ke;var Ze,Ye=i(30060),$e=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Qe=Ze=class MeasurementModeButton extends r.Component{constructor(e,t){super(e),this.nudgeTimeout=0,this.updateNudge=()=>{const e=this.context.settings.tryGetProperty(Ye.b,!1),t=this.context.settings.tryGetProperty(He.F.MeasurementUserNudgeSeen,!1);!e||t||this.nudgeTimeout||(this.nudgeTimeout=window.setTimeout((()=>{this.setState({showNudge:!0}),window.setTimeout((()=>{this.dismissNudge()}),Ze.DISMISS_NUDGE_TIMEOUT)}),Ze.SHOW_NUDGE_TIMEOUT))},this.dismissNudge=()=>{this.state.showNudge&&(this.context.analytics.track("showcase_gui",{gui_action:"mesasure_nudge"}),this.context.settings.setLocalStorageProperty(He.F.MeasurementUserNudgeSeen,!0),this.setState({showNudge:!1}))},this.modeButtonClicked=()=>{const e=this.props.openTool!==d.w1.MEASUREMENTS;e&&this.context.analytics.track("showcase_gui",{gui_action:"measure_mode"}),this.context.commandBinder.issueCommand(new Ge.tT(d.w1.MEASUREMENTS,e))},this.localized={measurement_mode:t.locale.t(m.Z.MEASUREMENT_MODE),nudgeTitleString:t.locale.t(m.Z.MEASUREMENT_NUDGE_TITLE),nudgeMessageString:t.locale.t(m.Z.MEASUREMENT_NUDGE_MESSAGE)},this.state={showNudge:!1}}componentDidMount(){this.updateNudge()}render(){const{tooltipTimeout:e,openTool:t}=this.props,{showNudge:i}=this.state,{nudgeTitleString:n,nudgeMessageString:s}=this.localized,o=this.localized.measurement_mode,a=t===d.w1.MEASUREMENTS?_.BN.ACTIVE:_.BN.ENABLED;return(0,r.h)("div",{class:"measure-mode-button"},(0,r.h)(T.h,{onClick:this.modeButtonClicked,buttonState:a,ariaLabel:o},(0,r.h)(M.oO,{content:o,position:M.lZ.UP,tooltipTimeout:e},(0,r.h)("span",{class:"icon icon-tape-measure"}))),(0,r.h)(ne,{className:l()("tooltip-title-large","nudge-tooltip"),open:i,closeButton:!0,onClose:this.dismissNudge,title:n,message:(0,r.h)("div",{class:"nudge-message"},(0,r.h)("span",{class:"message"},s)),arrowPos:ee.BOTTOM_CENTER}))}};Qe.SHOW_NUDGE_TIMEOUT=6e4,Qe.DISMISS_NUDGE_TIMEOUT=1e4,Qe=Ze=$e([N.Z],Qe);const Xe=Qe;var Je=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var i=-1;return e.some((function(e,n){return e[0]===t&&(i=n,!0)})),i}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var i=e(this.__entries__,t),n=this.__entries__[i];return n&&n[1]},t.prototype.set=function(t,i){var n=e(this.__entries__,t);~n?this.__entries__[n][1]=i:this.__entries__.push([t,i])},t.prototype.delete=function(t){var i=this.__entries__,n=e(i,t);~n&&i.splice(n,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var i=0,n=this.__entries__;i<n.length;i++){var s=n[i];e.call(t,s[1],s[0])}},t}()}(),et="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,tt=void 0!==i.g&&i.g.Math===Math?i.g:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),it="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(tt):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var nt=["top","right","bottom","left","width","height","size","weight"],st="undefined"!=typeof MutationObserver,rt=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var i=!1,n=!1,s=0;function r(){i&&(i=!1,e()),n&&a()}function o(){it(r)}function a(){var e=Date.now();if(i){if(e-s<2)return;n=!0}else i=!0,n=!1,setTimeout(o,t);s=e}return a}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,i=t.indexOf(e);~i&&t.splice(i,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){et&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),st?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){et&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,i=void 0===t?"":t;nt.some((function(e){return!!~i.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),ot=function(e,t){for(var i=0,n=Object.keys(t);i<n.length;i++){var s=n[i];Object.defineProperty(e,s,{value:t[s],enumerable:!1,writable:!1,configurable:!0})}return e},at=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||tt},lt=mt(0,0,0,0);function ct(e){return parseFloat(e)||0}function ht(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return t.reduce((function(t,i){return t+ct(e["border-"+i+"-width"])}),0)}function dt(e){var t=e.clientWidth,i=e.clientHeight;if(!t&&!i)return lt;var n=at(e).getComputedStyle(e),s=function(e){for(var t={},i=0,n=["top","right","bottom","left"];i<n.length;i++){var s=n[i],r=e["padding-"+s];t[s]=ct(r)}return t}(n),r=s.left+s.right,o=s.top+s.bottom,a=ct(n.width),l=ct(n.height);if("border-box"===n.boxSizing&&(Math.round(a+r)!==t&&(a-=ht(n,"left","right")+r),Math.round(l+o)!==i&&(l-=ht(n,"top","bottom")+o)),!function(e){return e===at(e).document.documentElement}(e)){var c=Math.round(a+r)-t,h=Math.round(l+o)-i;1!==Math.abs(c)&&(a-=c),1!==Math.abs(h)&&(l-=h)}return mt(s.left,s.top,a,l)}var ut="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof at(e).SVGGraphicsElement}:function(e){return e instanceof at(e).SVGElement&&"function"==typeof e.getBBox};function pt(e){return et?ut(e)?function(e){var t=e.getBBox();return mt(0,0,t.width,t.height)}(e):dt(e):lt}function mt(e,t,i,n){return{x:e,y:t,width:i,height:n}}var gt=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=mt(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=pt(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),ft=function(e,t){var i,n,s,r,o,a,l,c=(n=(i=t).x,s=i.y,r=i.width,o=i.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,l=Object.create(a.prototype),ot(l,{x:n,y:s,width:r,height:o,top:s,right:n+r,bottom:o+s,left:n}),l);ot(this,{target:e,contentRect:c})},vt=function(){function e(e,t,i){if(this.activeObservations_=[],this.observations_=new Je,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=i}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof at(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new gt(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof at(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new ft(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),yt="undefined"!=typeof WeakMap?new WeakMap:new Je,bt=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=rt.getInstance(),n=new vt(t,i,this);yt.set(this,n)};["observe","unobserve","disconnect"].forEach((function(e){bt.prototype[e]=function(){var t;return(t=yt.get(this))[e].apply(t,arguments)}}));const St=void 0!==tt.ResizeObserver?tt.ResizeObserver:bt;var Et=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},wt=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i};var Tt;!function(e){e.UP="up",e.DOWN="down"}(Tt||(Tt={}));let _t=class Dropdown extends r.Component{constructor(e){super(e),this.onOutsideClick=e=>{this.toggleDropdown(!1)},this.onToggleClick=e=>{e.stopPropagation(),this.toggleDropdown()},this.onTransitionEnd=e=>{e&&e.target!==e.currentTarget||(window.clearTimeout(this.transitionTimeout),this.setState({transitioning:!1}))},this.toggleDropdown=e=>{const{open:t}=this.state,i=void 0!==e?e:!t;i?window.addEventListener("click",this.onOutsideClick):window.removeEventListener("click",this.onOutsideClick),this.transitionTimeout=window.setTimeout(this.onTransitionEnd,1e3),this.setState({open:i,transitioning:!0})},this.state={open:!1,transitioning:!1}}componentWillUnmount(){window.removeEventListener("click",this.onOutsideClick)}render(){const{open:e,transitioning:t}=this.state,i=this.props,{children:n,className:s,direction:o}=i,a=wt(i,["children","className","direction"]),c={up:o===Tt.UP,open:e,transitioning:t};return(0,r.h)("div",Object.assign({className:l()("dropdown",c,s)},a),(0,r.h)("div",{className:"dropdown-mask"},(0,r.h)("div",{className:"dropdown-menu",onTransitionEnd:this.onTransitionEnd},n)),(0,r.h)("div",{className:"dropdown-toggle"},(0,r.h)(T.h,{iconClass:"icon-toolbar-more-horiz",onClick:this.onToggleClick,className:"dropdown-toggle"})))}};_t.defaultProps={direction:Tt.DOWN},_t=Et([N.Z],_t);var Mt=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},xt=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i};const At="collapsed";let Ot=class CollapsibleList extends r.Component{constructor(e){super(e),this.onResize=()=>{this.update()},this.setContentRef=e=>{this.contentRef=e},this.setCollapsedRef=e=>{this.collapsedRef=e},this.setToggleRef=e=>{this.toggleRef=e},this.state={collapsed:!1},this.observer=new St(this.onResize)}componentDidMount(){this.connectObserver(),this.update()}componentDidUpdate(){this.update()}componentWillUnmount(){this.disconnectObserver(),this.reset()}connectObserver(){this.observer.observe(this.contentRef)}disconnectObserver(){this.observer&&this.observer.disconnect()}reset(){if(!this.contentRef)return;const e=this.contentRef.querySelectorAll(".collapsed");Array.from(e).forEach((e=>e.classList.remove(At)))}update(){if(!this.contentRef||!this.collapsedRef||!this.toggleRef)return;const e=this.contentRef.children,t=this.collapsedRef.children;if(!e||e.length!==t.length)return;const{collapsed:i}=this.state,n=this.contentRef.offsetWidth,s=this.toggleRef.base&&this.toggleRef.base.offsetWidth||0;let r=0,o=0;for(let i=0;i<e.length;i++){let a=e[i].offsetWidth||0;o||i!==e.length-1||(a-=s),r+=a,r<=n?(e[i].classList.remove(At),t[i].classList.add(At)):(o++,e[i].classList.add(At),t[i].classList.remove(At))}!!o!==i&&this.setState({collapsed:!i})}render(){const e=this.props,{children:t,className:i}=e,n=xt(e,["children","className"]),{collapsed:s}=this.state,o=`collapsible-list ${i}`,l={hidden:!s};return t&&Array.isArray(t)?(0,r.h)("div",Object.assign({className:a(o)},n),(0,r.h)("div",{ref:this.setContentRef,class:"collapsible-list-items"},t),(0,r.h)(_t,{ref:this.setToggleRef,direction:Tt.UP,className:a(l)},(0,r.h)("div",{ref:this.setCollapsedRef,class:"collapsible-list-menu"},t))):{children:t}}};Ot.defaultProps={},Ot=Mt([N.Z],Ot);var Pt=i(25138),Dt=i(43229),Ct=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let It=class Footer extends r.Component{constructor(e){super(e),this.handleTermsClick=()=>{const e=this.props.openModal===le.P.TERMS;this.context.commandBinder.issueCommand(new ce.Bz(le.P.TERMS,!e)),this.context.analytics.track("showcase_gui",{gui_action:"click_terms_button",interaction_source:"gui"})},this.handleHelpClick=()=>{const e=this.props.openModal===le.P.HELP;this.context.commandBinder.issueCommand(new ce.Bz(le.P.HELP,!e)),this.context.analytics.track("showcase_gui",{gui_action:"click_help_button",interaction_source:"gui"})},this.handleFeedbackClick=()=>{const{isWorkshop:e}=this.props;this.context.commandBinder.issueCommand(new Dt.m),this.context.analytics.track(e?"workshop_gui":"showcase_gui",{gui_action:"click_feedback_button",interaction_source:"gui"})}}getFooterLogo(){const{locale:e,settings:t}=this.context,n=e.t(m.Z.ALT_MATTERPORT_LOGO),s=!t.tryGetProperty(Pt.sX,!1),o=i(89992),a=(0,r.h)("img",{class:"footer-logo",alt:n,src:o});return s?(0,r.h)("a",{class:"link logo-link",href:"https://matterport.com",target:"_blank"},a):a}render(){const{isWorkshop:e=!1,modelRatingEnabled:t}=this.props;return e&&!t?null:(0,r.h)("div",{id:"footer"},t&&(0,r.h)("span",{onClick:this.handleFeedbackClick,class:"link feedback-link",role:"link"},this.context.locale.t(m.Z.FEEDBACK)),!e&&t&&(0,r.h)("span",null," | "),!e&&(0,r.h)("span",{onClick:this.handleHelpClick,class:"link",role:"link"},this.context.locale.t(m.Z.HELP)),!e&&(0,r.h)("span",null," | "),!e&&(0,r.h)("span",{onClick:this.handleTermsClick,class:"link",role:"link"},this.context.locale.t(m.Z.TERMS)),!e&&this.getFooterLogo())}};It=Ct([N.Z],It);const Lt=It;var Rt,Nt=i(98811),kt=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.FILTER=1]="FILTER"}(Rt||(Rt={}));let Bt=class Checkbox extends r.Component{constructor(e){super(e),this.onChange=e=>{this.props.stopPropagation&&e.stopPropagation(),this.setState((e=>({checkedValue:!e.checkedValue})),(()=>{this.props.onChange&&this.props.onChange(this.checkboxElement,...this.props.onChangeArgs||[])}))},this.setCheckboxRef=e=>{this.checkboxElement=e},this.state={checkedValue:e.checked}}componentWillReceiveProps(e){this.setState({checkedValue:e.checked})}render(){const{checkboxStyle:e=Rt.DEFAULT,className:t,dataValue:i,enabled:n,error:s,helpText:o,id:l,key:c,label:h}=this.props,{checkedValue:d}=this.state,u=!n;return(0,r.h)("div",{ref:this.setCheckboxRef,id:l,role:"checkbox","aria-checked":d?"true":"false","aria-disabled":u,"data-value":i,class:a("checkbox-element",`checkbox-style-${Rt[e].toLowerCase()}`,{checked:d,disabled:u,error:s},t),onClick:this.onChange,key:c},e!==Rt.FILTER&&(0,r.h)("div",{class:"checkbox icon-checkmark"}),(0,r.h)("div",{class:"checkbox-text"},h),o&&(0,r.h)("span",{className:"help-text"},o))}};Bt.defaultProps={enabled:!0,error:!1},Bt=kt([N.Z],Bt);var Ft,Ut=i(81507),Vt=i(57370),Ht=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e[e.OUTLINED=0]="OUTLINED"}(Ft||(Ft={}));const Gt=function*(){let e=0;for(;;)yield e++}();let zt=class Textarea extends r.Component{constructor(e){super(e),this.onInput=e=>{if(this.props.onInput){const t=e.target;this.props.onInput(t.value)}},this.onKeyPress=e=>{e.stopPropagation();const t=e.which||e.keyCode,i=[Ut.R.RETURN];if("keydown"===e.type&&!i.includes(t))return!1;const n=e.target;switch(this.props.maxLength&&n.value.length>this.props.maxLength&&e.preventDefault(),t){case Ut.R.RETURN:e.shiftKey||(e.preventDefault(),this.blur(),this.props.onDone(n.value))}return!1},this.stopPropagation=e=>e.stopPropagation(),this.onFocus=e=>{this.context.messageBus.broadcast(new Vt.S(this.input,!0)),this.props.onFocus&&this.props.onFocus(e),this.setState({isFocused:!0})},this.onBlur=e=>{this.context.messageBus.broadcast(new Vt.S(this.input,!1)),this.props.onBlur&&this.props.onBlur(e),this.setState({isFocused:!1})},this.setRef=e=>this.input=e,this.instanceId=`textarea-${Gt.next().value}`,this.state={currentText:e.text,isFocused:!1}}componentDidMount(){this.props.focusOnMount&&this.input&&this.input.focus(),this.props.scrollIntoViewOnMount&&this.input&&this.input.scrollIntoView()}componentWillUnmount(){this.input&&this.input.blur()}componentWillReceiveProps(e){e.text!==this.props.text&&this.setState({currentText:e.text})}getText(){return this.input?this.input.value:""}focus(){this.input.focus()}blur(){this.input.blur()}render(){const{placeholder:e,tabIndex:t,maxLength:i,inputStyle:n=Ft.OUTLINED,label:s,name:o,readOnly:l}=this.props,{currentText:c,isFocused:h}=this.state,d=o||this.instanceId;return(0,r.h)("div",{class:a("textarea-container",`textarea-style-${Ft[n].toLowerCase()}`,{focused:h,readonly:l})},s&&(0,r.h)("label",{className:"label",for:d},s),(0,r.h)("textarea",{class:"textarea",value:c,ref:this.setRef,name:d,placeholder:e,maxLength:i,onInput:this.onInput,onKeyPress:this.onKeyPress,onKeyDown:this.onKeyPress,onKeyUp:this.stopPropagation,onBlur:this.onBlur,onFocus:this.onFocus,tabIndex:t,readOnly:l}))}};zt=Ht([N.Z],zt);const Wt=zt;class ButtonGroup extends r.Component{render(){const{children:e,className:t}=this.props;return(0,r.h)("div",{class:a("button-group",t)},e)}}var jt=i(74394),Kt=i(51922),qt=i(26684),Zt=i(48670),Yt=i(78347);const{MODEL_RATING:$t}=m.Z.WORKSHOP,Qt={HAPPINESS:"happiness",QUALITY:"quality",NAVIGATION:"navigation",FEEDBACK:"feedback"},Xt=Qt.HAPPINESS,Jt={[Qt.HAPPINESS]:$t.HAPPINESS_TITLE,[Qt.QUALITY]:$t.QUALITY_ISSUES_TITLE,[Qt.NAVIGATION]:$t.NAVIGATION_ISSUES_TITLE,[Qt.FEEDBACK]:$t.FEEDBACK_TITLE},ei={[Qt.HAPPINESS]:$t.HAPPINESS_BODY},ti={[Qt.QUALITY]:[{text:$t.QUALITY_ISSUES_LIGHTING,value:"lighting"},{text:$t.QUALITY_ISSUES_3D_MESH,value:"3d_mesh"},{text:$t.QUALITY_ISSUES_COLORING,value:"coloring"},{text:$t.QUALITY_ISSUES_IMAGE_QUALITY,value:"image_quality"}],[Qt.NAVIGATION]:[{text:$t.NAVIGATION_ISSUES_BLOCKED_DOORWAYS,value:"blocked_doorways"},{text:$t.NAVIGATION_ISSUES_OBSTRUCTIONS,value:"obstructions"},{text:$t.NAVIGATION_ISSUES_MISALIGNED_SCANS,value:"misaligned_scans"},{text:$t.NAVIGATION_ISSUES_FLOOR_SEPARATION,value:"floor_separation"},{text:$t.NAVIGATION_ISSUES_DISAPPEARING_FLOORS,value:"disappearing_floors"}]},ii=[{value:1,altText:m.Z.REUSABLES.EMOJI_ALT_DISAPPOINTED,image:jt},{value:2,altText:m.Z.REUSABLES.EMOJI_ALT_UNSATISFIED,image:Kt},{value:3,altText:m.Z.REUSABLES.EMOJI_ALT_NEUTRAL,image:qt},{value:4,altText:m.Z.REUSABLES.EMOJI_ALT_SATISFIED,image:Zt},{value:5,altText:m.Z.REUSABLES.EMOJI_ALT_HAPPY,image:Yt}],{MODEL_RATING:ni}=m.Z.WORKSHOP,si=Object.values(Qt);class ModelRatingForm extends r.Component{constructor(e){super(e),this.submitRatingIfValid=(e=!1)=>{const t=this.getCurrentValues();t&&this.isValidRating(t)&&(this.context.commandBinder.issueCommand(new Dt.M(t,e)),this.resetValues())},this.resetValues=()=>{this.setState({happiness:void 0,quality:void 0,navigation:void 0,feedback:void 0})},this.getCurrentValues=()=>({happiness:this.state.happiness,quality:this.state.quality||[],navigation:this.state.navigation||[],feedback:this.state.feedback||""}),this.hasPerfectHappinessRating=()=>5===this.state.happiness,this.handlePageVisibilityChange=()=>{"hidden"===document.visibilityState&&this.submitRatingIfValid()},this.handleButtonClick=()=>{const{currentQuestionId:e}=this.state;let t;switch(e){case Qt.QUALITY:t=Qt.NAVIGATION;break;case Qt.NAVIGATION:t=Qt.FEEDBACK;break;case Qt.FEEDBACK:this.submitRatingIfValid(!0)}t&&this.setState({currentQuestionId:t})},this.handleHappinessClick=(e,t)=>{this.setState({happiness:t.value,currentQuestionId:5===t.value?Qt.FEEDBACK:Qt.QUALITY})},this.handleCheckboxChange=(e,t,i)=>{const n=i.value,s={},r=(this.state[t]||[]).slice();r.includes(n)?r.splice(r.indexOf(n),1):r.push(n),s[t]=r,this.setState(s)},this.handleFeedbackChange=e=>{this.setState({feedback:e})},this.handleClose=()=>{this.submitRatingIfValid(),this.context.commandBinder.issueCommand(new Dt.m(!1))},this.renderProgress=()=>{const{locale:e}=this.context,{currentQuestionId:t}=this.state;if(!t)return null;if(t===Qt.HAPPINESS||this.hasPerfectHappinessRating())return;const i=si.indexOf(t);return(0,r.h)("span",{className:"model-rating-progress"},e.t(ni.PROGRESS,{"current-question-number":i,"max-question-number":si.length-1}))},this.state={currentQuestionId:Xt},document.addEventListener("visibilitychange",this.handlePageVisibilityChange,!1)}componentWillUnmount(){this.context.commandBinder.issueCommand(new Dt.m(!1)),this.submitRatingIfValid(),document.removeEventListener("visibilitychange",this.handlePageVisibilityChange,!1)}isValidRating(e){return Object.keys(e).length>0&&void 0!==e.happiness}renderCurrentQuestion(){const{locale:e}=this.context,{currentQuestionId:t}=this.state;if(t===Qt.FEEDBACK)return(0,r.h)("div",{className:"question-type text-entry"},(0,r.h)(Wt,{text:this.state.feedback||"",label:e.t(ni.FEEDBACK_LABEL),onInput:this.handleFeedbackChange,onDone:this.handleFeedbackChange,maxLength:60,focusOnMount:!0,scrollIntoViewOnMount:!0}));if(t===Qt.HAPPINESS)return(0,r.h)("div",{className:"question-type emoji-select"},(0,r.h)(ButtonGroup,null,ii.map((t=>(0,r.h)(_.zx,{key:t.value,buttonState:this.state.happiness===t.value?_.BN.ACTIVE:_.BN.ENABLED,buttonStyle:_.ZJ.PLAIN,buttonSize:_.qE.SMALL,onClick:this.handleHappinessClick,onClickArgs:[t]},(0,r.h)("img",{src:t.image,alt:e.t(t.altText),height:30,width:30}))))));if(t===Qt.QUALITY||t===Qt.NAVIGATION){const i=(t===Qt.QUALITY?this.state.quality:this.state.navigation)||[],n=ti[t];return(0,r.h)("div",{className:"question-type multi-select"},n.map((n=>(0,r.h)(Bt,{key:n.text,enabled:!0,checkboxStyle:Rt.FILTER,onChange:this.handleCheckboxChange,onChangeArgs:[t,n],checked:i.includes(n.value),label:e.t(n.text)}))))}return null}render(){const{locale:e}=this.context,{currentQuestionId:t}=this.state,i=t===Xt,n=Jt[t],s=ei[t],o=t===Qt.FEEDBACK?ni.SAVE:ni.NEXT;return(0,r.h)("div",{className:a("model-rating-dialog",{"in-progress":!i})},(0,r.h)(te.P,{onClose:this.handleClose}),(0,r.h)("div",{className:"model-rating-form"},(0,r.h)("div",{className:"model-rating-question"},(0,r.h)("h3",{className:"question-title"},e.t(n)),s&&(0,r.h)("p",{className:"question-body"},e.t(s)),this.renderCurrentQuestion()),(0,r.h)("footer",{className:"model-rating-footer"},(0,r.h)("div",null,t!==Qt.HAPPINESS&&(0,r.h)(_.zx,{buttonStyle:_.ZJ.SECONDARY,buttonState:_.BN.ENABLED,onClick:this.handleButtonClick,onClickArgs:[t]},e.t(o))),this.renderProgress())))}}var ri=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let oi=class ModelRatingDialog extends r.Component{constructor(e){super(e),this.bindings=[],this.handleDialogVisibilityChange=e=>{this.setState({isVisible:e})},this.state={initializing:!0,isVisible:!1}}componentDidMount(){const{market:e}=this.context.engine;e.waitForData(Nt.P).then((e=>{this.bindings.push(e.onDialogVisibleChanged(this.handleDialogVisibilityChange)),this.setState({initializing:!1})}))}componentWillUnmount(){this.bindings.forEach((e=>e.cancel()))}render(){const{initializing:e,isVisible:t}=this.state;return t&&!e?(0,r.h)(ModelRatingForm,null):null}};oi=ri([N.Z],oi);var ai=i(87220);class BottomUi extends r.Component{constructor(e){super(e),this.touchDevice=(0,w.Jm)(),this.bindings=[],this.viewmodeToClass={[y.BD.INSIDE]:"inside",[y.BD.OUTSIDE]:"outside",[y.BD.DOLLHOUSE]:"dollhouse",[y.BD.FLOORPLAN]:"floorplan",[y.BD.TRANSITIONING]:"transitioning"},this.onBriefHLR=()=>{this.setState((e=>({briefHlr:!e.briefHlr})))},this.onViewingControlsToggle=({show:e})=>{this.setState({autohide:!e})},this.updateViewportSize=()=>{const e=this.context&&this.context.mainDiv?this.context.mainDiv.offsetHeight:window.innerHeight;this.setState({viewportHeight:e})},this.isReelEnabled=()=>{const{settings:e}=this.context,{viewportHeight:t}=this.state,i=e.checkUrlParam("hr",1,1),n=e.tryGetProperty(x.gx.HighlightReel,!0);return t>=400&&i&&n},this.isTourEnabled=()=>{const{settings:e}=this.context,t=!!e.tryGetProperty("gt",1),i=e.tryGetProperty(x.gx.TourButtons,!0);return t&&i},this.isFloorsEnabled=()=>{const{settings:e}=this.context,t=e.tryGetProperty(oe.ws,!0),i=e.tryGetProperty(x.gx.FloorSelect,!0);return t&&i},this.onToggleHLR=e=>{this.isReelEnabled()&&this.props.tourState.totalSteps>0&&this.setState({reelOpen:e})},this.toggleShareModal=()=>{const e=this.props.openModal===le.P.SHARE;this.context.analytics.track("showcase_gui",{gui_action:"click_share_button"}),this.context.commandBinder.issueCommand(new ce.Bz(le.P.SHARE,!e))},this.renderHighlightReelControls=()=>{const{totalSteps:e,tourPlaying:t}=this.props.tourState,i=this.isReelEnabled()&&e>0,n=this.isTourEnabled()&&e>0;return(0,r.h)("div",{class:"highlight-tour-controls"},i&&(0,r.h)(ge,{reelOpen:this.state.reelOpen,onToggleHLR:this.onToggleHLR,reelEnabled:i}),n&&(0,r.h)(U,{tourEmpty:!1,tourPlaying:t}))},this.renderModeControls=()=>{const{unaligned:e,viewmode:t}=this.props;return(0,r.h)(ModeControls,{unaligned:e,viewmode:t})},this.renderFloorPlanControls=()=>{const{viewmode:e}=this.props;return(0,r.h)(FloorControls,{viewmode:e,iconStyle:!0})},this.renderNotesModeButton=()=>{const{openTool:e}=this.props;return(0,r.h)(qe,{tooltipTimeout:this.touchDevice?1e3:void 0,openTool:e})},this.renderMeasurementModeButton=()=>{const{openTool:e}=this.props;return(0,r.h)(Xe,{tooltipTimeout:this.touchDevice?1e3:void 0,openTool:e})},this.renderHighlightReel=e=>{const{totalSteps:t,tourPlaying:i,highlights:n,activeStep:s,transition:o}=this.props.tourState,{reelOpen:a,briefHlr:l}=this.state;return(0,r.h)(Le,{transition:o,activeStep:s,highlights:n,tourPlaying:i,totalSteps:t,reelOpen:a&&e,briefHlr:l,onBriefHLR:this.onBriefHLR,onToggleHLR:this.onToggleHLR})},this.renderFooter=e=>{const{reelOpen:t}=this.state,{openTool:i,openModal:n,tourState:s}=this.props,{totalSteps:o,tourPlaying:a,activeStep:l}=s,c=i===d.w1.NOTES||i===d.w1.TAGS;return(0,r.h)("div",{class:"footer-ui"},!i&&(0,r.h)(ke,{activeStep:l,tourPlaying:a,totalSteps:o,reelOpen:t,onToggleHLR:this.onToggleHLR}),!c&&(0,r.h)(Lt,{openModal:n,modelRatingEnabled:e}))},this.renderLeftControls=()=>{const e=[],{unaligned:t,measurementsModeEnabled:i,notesEnabled:n,openTool:s}=this.props,{totalSteps:r}=this.props.tourState,o=this.isReelEnabled()&&r>0;return(this.isTourEnabled()&&r>0||o)&&!s&&e.push(this.renderHighlightReelControls()),e.push(this.renderModeControls()),this.isFloorsEnabled()&&e.push(this.renderFloorPlanControls()),n&&!t&&e.push(this.renderNotesModeButton()),i&&!t&&e.push(this.renderMeasurementModeButton()),e},this.renderRightControls=()=>{const e=[],{vrEnabled:t,openModal:i,shareEnabled:n}=this.props,s=(0,w.O6)();e.push((0,r.h)("span",{class:"divider"}));const o=this.context.locale.t(m.Z.SOCIAL_SHARING);return n&&e.push((0,r.h)(T.h,{onClick:this.toggleShareModal,ariaLabel:o},(0,r.h)(M.oO,{content:o,position:M.lZ.UP_LEFT,tooltipTimeout:this.touchDevice?1e3:void 0},(0,r.h)("span",{class:"icon icon-share"})))),t&&e.push((0,r.h)(de,{open:i===le.P.VR_SELECT})),s&&e.push((0,r.h)(FullscreenControls,null)),e},this.state={reelOpen:!1,briefHlr:!1,viewportHeight:0,autohide:!1},this.onResize=(0,Ue.D)(this.updateViewportSize,250),this.updateViewportSize()}componentDidMount(){const{messageBus:e}=this.context;this.updateViewportSize(),this.onBriefHLR(),window.addEventListener("resize",this.onResize),this.bindings.push(e.subscribe(ue.ps,this.onViewingControlsToggle))}componentWillUnmount(){this.bindings.map((e=>e.cancel())),window.removeEventListener("resize",this.onResize)}render(){const{tourState:e,viewmode:t,openModal:i,openTool:n}=this.props,{tourPlaying:s,tourEnded:o,totalSteps:l}=e,{reelOpen:c,autohide:h}=this.state,{settings:u}=this.context,p=this.viewmodeToClass[t]||"",m=this.isReelEnabled()&&l>0,g=m&&!n&&!i,f=n!==d.w1.MEASUREMENTS,v=u.tryGetProperty(ai.i,!1),y={"reel-open":g&&c,"modal-open":!!i,"tour-playing":s,autohide:h},b={"faded-out":!!i&&!n};return(0,r.h)("div",{id:"bottom-ui",class:a("bottom-ui",y,p)},(0,r.h)(PauseButton,{tourPlaying:s,tourEnded:o}),(0,r.h)("div",{class:a("bottom-controls",b)},(0,r.h)(Ot,{className:"controls"},this.renderLeftControls(),f&&this.renderRightControls()),v&&(0,r.h)(oi,null)),m&&this.renderHighlightReel(g),this.renderFooter(v))}}var li=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let ci=class Summary extends r.Component{constructor(e){super(e)}render(){let e=this.props.mode===vi.Expanded;const t=this.props.mode===vi.Collapsed,i=this.props.formattedAddress?(0,r.h)("div",{class:"address"},(0,r.h)("i",{class:"icon-pin"},""),this.props.formattedAddress):null,n=this.props.summary?(0,r.h)("div",{class:"summary-description"},this.props.summary):null,s=this.props.contactName?(0,r.h)("span",{id:"summary-name"},this.props.contactName,(0,r.h)("br",null)):null,o=this.props.formattedContactPhone?this.props.formattedContactPhone:this.props.phone;let l;l=o&&(0,w.tq)()?(0,r.h)("div",null,(0,r.h)("a",{id:"phone",class:"link",href:"tel:"+this.props.phone},o)):o?(0,r.h)("span",{id:"summary-phone"},o,(0,r.h)("br",null)):null;const c=this.props.contactEmail?(0,r.h)("a",{id:"email",class:"link",href:"mailto:"+this.props.contactEmail},this.props.contactEmail,(0,r.h)("br",null)):null,h=!!(s||l||c),d=h?(0,r.h)("i",{class:"icon-user"},""):null,u=h?(0,r.h)("span",{class:"contact-block"},d,(0,r.h)("div",{class:"contact-data"},s,l,c)):null,p=this.props.externalUrl&&(0,r.h)("div",{id:"external-link"},(0,r.h)("hr",null),(0,r.h)("i",{class:"icon-ext-link"}),(0,r.h)("div",null,(0,r.h)("span",null,this.context.locale.t(m.Z.LEARN_MORE)+": "),(0,r.h)("a",{class:"link",onClick:this.props.onExternalLinkClicked,href:this.props.externalUrl,target:"_blank"},this.props.externalUrl)));e=!(!e||!(h||i||n));const g=a({"main-title":!0,expanded:e,collapsed:t}),f=a({"summary-details":!0,expanded:e,collapsed:t,hasExternalLink:!!p});return(0,r.h)("div",{id:"summary-wrapper",class:g},(0,r.h)("div",{class:f},n,u,i,p))}};ci=li([N.Z],ci);const hi=ci;var di=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let ui=class TitleToggle extends r.Component{constructor(e){super(e)}render(){const e=this.props.mode===vi.Collapsed?"right":"left";return(0,r.h)("div",{id:"title-toggle",onClick:this.props.handleClick},(0,r.h)("span",{class:"icon icon-dpad-"+e}))}};ui=di([N.Z],ui);const pi=ui;var mi=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let gi=class MainTitle extends r.Component{constructor(e){super(e)}collapsed(){return this.props.mode===vi.Collapsed}expanded(){return this.props.mode===vi.Expanded}render(){const e=this.props.presentedBy,t=this.expanded()?this.context.locale.t(m.Z.LESS):this.context.locale.t(m.Z.MORE),i=this.expanded()?"up":"down",n=a({"main-title":!0,collapsed:this.collapsed()}),s=a({"co-brand":!0,hidden:!e}),o=a({titleText:!0,noCoBrand:!e});return(0,r.h)("div",{type:"button","data-balloon":this.props.name,"data-balloon-pos":"down",class:a("main-title-row",this.collapsed()||this.expanded()?"tooltip-hidden":""),style:"display: inline-block",onClick:this.props.handleClick},(0,r.h)("div",{id:"main-title-wrapper"},(0,r.h)("div",{class:n},(0,r.h)("div",{class:s},this.context.locale.t(m.Z.PRESENTED_BY),(0,r.h)("span",{class:"title",id:"cobrandTitle"}," ",e)),this.props.showHint&&(0,r.h)("div",{class:"hint"},(0,r.h)("span",{class:"link-btn"},t+" ",(0,r.h)("span",{class:"icon icon-dpad-"+i}))),(0,r.h)("div",{id:"gui-name",class:o},this.props.name))))}};gi=mi([N.Z],gi);const fi=gi;var vi,yi=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e[e.Collapsed=0]="Collapsed",e[e.Normal=1]="Normal",e[e.Expanded=2]="Expanded"}(vi||(vi={}));let bi=class TitleBar extends r.Component{constructor(e){super(e),this.toggleTitleCollapse=()=>{this.setTitleBarMode(vi.Collapsed)},this.toggleTitleExpand=()=>{this.state.mode===vi.Expanded?this.setTitleBarMode(vi.Normal):this.setTitleBarMode(vi.Expanded)},this.onExternalLinkClicked=e=>{e.preventDefault(),this.context.analytics.track("showcase_share_origin_link_clicked"),window.open(this.props.modelDetails.externalUrl)},this.state={mode:vi.Normal,lastMode:vi.Normal,open:!0}}setTitleBarMode(e){this.setState((t=>({mode:t.mode===e?t.lastMode:e,lastMode:t.mode})))}getFilteredValue(e,t,i,n){return!this.context.settings.tryGetProperty(t,i)||n&&!this.props.brandingEnabled?"":e}render(){const{modelDetails:e,showExternalUrl:t}=this.props,{name:i,presentedBy:n,summary:s,formattedAddress:o,contact:l,externalUrl:c}=e,{mode:h}=this.state,d=t?c:"",u=this.getFilteredValue(i,x.gx.DetailsModelName,!0,!1),p=this.getFilteredValue(s,x.gx.DetailsSummary,!1,!1),m=this.getFilteredValue(o,x.gx.DetailsAddress,!1,!1),g=this.getFilteredValue(n,x.gx.PresentedBy,!1,!0),f=this.getFilteredValue(l.name,x.gx.DetailsName,!1,!0),v=this.getFilteredValue(l.email,x.gx.DetailsEmail,!1,!0),y=this.getFilteredValue(l.phone,x.gx.DetailsPhone,!1,!0),b=this.getFilteredValue(l.formattedPhone,x.gx.DetailsPhone,!1,!0),S=""!==p||""!==m||""!==v||""!==f||""!==b||""!==y;return(0,r.h)("div",{id:"model-title",className:a(vi[h])},(0,r.h)("div",{class:"title-row"},(0,r.h)(pi,{mode:h,handleClick:this.toggleTitleCollapse}),(0,r.h)(fi,{name:u,mode:h,showHint:S,presentedBy:g,handleClick:this.toggleTitleExpand})),(0,r.h)("div",{class:"details-row"},(0,r.h)(hi,{mode:h,summary:p,formattedAddress:m,phone:y,formattedContactPhone:b,contactEmail:v,contactName:f,externalUrl:d,onExternalLinkClicked:this.onExternalLinkClicked})))}};bi=yi([N.Z],bi);const Si=bi;var Ei=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let wi=class SearchModeButton extends r.Component{constructor(e){super(e),this.openSearchMode=()=>{this.context.commandBinder.issueCommand(new Ge.tT(d.w1.SEARCH,!0))},this.localized={searchModeString:"Search"}}render(){const{tooltipTimeout:e}=this.props;return(0,r.h)("div",{class:"search-mode-button"},(0,r.h)(T.h,{onClick:this.openSearchMode,buttonStyle:T.D.OVERLAY,buttonSize:_.qE.LARGE},(0,r.h)(M.oO,{content:this.localized.searchModeString,position:M.lZ.DOWN,tooltipTimeout:e},(0,r.h)("span",{class:"icon icon-magnifying-glass"}))))}};wi=Ei([N.Z],wi);const Ti=wi;class TopUi extends r.Component{constructor(e){super(e),this.bindings=[],this.touchDevice=(0,w.Jm)(),this.renderSearchModeButton=()=>(0,r.h)(Ti,{tooltipTimeout:this.touchDevice?1e3:void 0}),this.updateState=()=>{this.setState({titleActive:!this.floorsViewData.showFloorSelection})},this.state={titleActive:!0}}componentDidMount(){Promise.all([this.context.market.waitForData(v.c)]).then((e=>{[this.floorsViewData]=e,this.bindings.push(this.floorsViewData.onShowFloorSelectionChanged(this.updateState)),this.updateState()}))}componentWillUnmount(){this.bindings.forEach((e=>e.cancel())),this.bindings.length=0}render(){const{showing:e,tourState:t,modelDetails:i,showExternalUrl:n,brandingEnabled:s,titleBarEnabled:o,searchEnabled:l}=this.props,{titleActive:c}=this.state,h=a({"faded-out":!e||t.tourPlaying||!c});return(0,r.h)("div",{id:"top-ui",class:h},o&&i&&(0,r.h)(Si,{modelDetails:i,showExternalUrl:!!n,brandingEnabled:!!s}),l&&this.renderSearchModeButton())}}var _i=i(23502),Mi=i(44060),xi=i(39504),Ai=i(58626),Oi=i(51153),Pi=i(46610),Di=i(34986);const Ci=new E.Z("embedly");class InvalidImageEmbed{constructor(e){this.msg=e}}class InvalidHtmlError{constructor(e){this.msg=e}}class UnsupportedTypeError{constructor(e){this.msg=e}}const Ii="Instagram",Li="Flickr";class Embedly{constructor(e,t){this.key=e,this.queue=t,this.embedEndpoint="https://api.embed.ly/1/oembed",this.imageEndpoint="https://i.embed.ly/1/display/resize",this.saveProvidersForScripts=[Li,Ii]}static clearCache(){Embedly.embedCache={},Embedly.imageCache={}}async getType(e){const t=await this.fetchFromCache(e);if(t)return t.type;try{const t=await this.getEmbedDetails(e);if(t.type===Di.z.rich||t.type===Di.z.video)return t.type}catch(e){if(401!==e.status_code&&404!==e.status_code&&501!==e.status_code&&!(e instanceof InvalidImageEmbed))return Di.z.error}try{return await this.getImageDetails(e),Di.z.photo}catch(e){}return Di.z.error}async fetchFromCache(e){const t=await this.getDisplayUrl(e),i=Embedly.imageCache[t];if(i)return i;const n=await this.getOEmbedUrl(e),s=Embedly.embedCache[n];return s||null}async getMediaDetails(e,t){switch(e){case Di.z.photo:return this.getImageDetails(t);case Di.z.rich:case Di.z.video:return this.getEmbedDetails(t)}throw Error("unsupported media type")}async getOEmbedUrl(e){const t=Math.max(window.screen.height,window.screen.width),i=`&maxwidth=${t}&maxheight=${t}`;return`${this.embedEndpoint}?key=${this.key}&url=${encodeURIComponent(e)}${i}`}async getEmbedDetails(e){const t=await this.getOEmbedUrl(e);return Embedly.embedCache[t]?Promise.resolve(Embedly.embedCache[t]):this.loadEmbed(t)}async getDisplayUrl(e){const t=Math.max(window.screen.height,window.screen.width),i=`&url=${encodeURIComponent(e)}&width=${t}&height=${t}`;return`${this.imageEndpoint}?key=${this.key}${i}`}async getImageDetails(e){const t=await this.getDisplayUrl(e);return Embedly.imageCache[t]?Promise.resolve(Embedly.imageCache[t]):this.loadImage(t)}loadEmbed(e){return this.queue.get(e,{responseType:"json"}).then((t=>this.validateAndCacheEmbed(e,t)))}loadImage(e){return new Promise(((t,i)=>this.queue.get(e,{responseType:"arraybuffer"}).then((t=>this.validateAndCacheImage(e,t))).then(t).catch(i)))}validateAndCacheEmbed(e,t){const i=!!(!t.html||!t.html.match(/<script/i))||this.saveProvidersForScripts.includes(t.provider_name);if(!(t.type!==Di.z.photo||t.html&&i))throw new InvalidImageEmbed('image can\'t be used as a "rich" type');if(!t||t.type===Di.z.rich&&(!t.html||!i))throw new InvalidHtmlError("missing html or html contains Javascript");switch(t.type){case Di.z.photo:t.html&&(t.type=Di.z.rich);break;case Di.z.rich:case Di.z.video:break;case Di.z.link:{const e="not supporting link types because of existing link functionality";throw Ci.debug(e),new UnsupportedTypeError(e)}default:{const e=`Did the OEmbed format extend?! Unknown type: ${t.type}`;throw Ci.debug(e),new UnsupportedTypeError(e)}}const n=(void 0===t.height||void 0===t.width)&&t.thumbnail_width&&t.thumbnail_height,s=n?t.thumbnail_width:t.width,r=n?t.thumbnail_height:t.height,o=t.provider_name,a={width:s,height:r,embedlyResponse:{html:t.html,src:t.url,provider:o},type:t.type};return Embedly.embedCache[e]=a,a}validateAndCacheImage(e,t){return new Promise(((i,n)=>{t||n("Embedly: got an empty response when requesting image");const s=new Uint8Array(t),r=new Blob([s]),o=new Image;o.addEventListener("load",(t=>function(t){const n=t.target,s={width:n.naturalWidth,height:n.naturalHeight,embedlyResponse:{url:a,src:e},type:Di.z.photo};Embedly.imageCache[e]=s,i(s)}(t)));const a=URL.createObjectURL(r);o.src=a}))}}Embedly.embedCache={},Embedly.imageCache={};const Ri=310;var Ni=i(91466);class OpenLinkEditorMessage extends Ni.v{constructor(e=!1){super(),this.urlFocus=e}}class CloseLinkEditorMessage extends Ni.v{}var ki,Bi=i(44574),Fi=i(86010),Ui=i(17141);!function(e){e[e.NOT_READY=1]="NOT_READY",e[e.CUED=2]="CUED",e[e.PLAYING=3]="PLAYING",e[e.PAUSED=4]="PAUSED"}(ki||(ki={}));var Vi=i(53931),Hi=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const Gi=new E.Z("mattertag-media");let zi=class MattertagMedia extends r.Component{constructor(e){super(e),this.playerControls=null,this.handleClick=()=>{this.props.mediaType===Di.z.photo&&this.props.onClickImage&&this.props.onClickImage()},this.onPlayerLoaded=e=>{this.playerControls=e,e.play()},this.setupPlayerControls=e=>{let t=ki.NOT_READY;const i=()=>{t=ki.CUED,this.onPlayerLoaded(a)},n=()=>{t=ki.PLAYING},s=()=>{t=ki.PAUSED},r=()=>{};try{e.on("ready",i),e.on("play",n),e.on("pause",s),e.on("ended",r)}catch(e){Gi.debug(e)}const o=(0,w.tq)(),a={play:()=>{if(e&&t!==ki.NOT_READY&&!o)try{e.play()}catch(e){Gi.error(e)}},pause:()=>{if(e&&t!==ki.NOT_READY)try{e.pause()}catch(e){Gi.debug(e)}}}},this.setEmbedContentRef=e=>{e&&!this.iframe&&this.createEmbed(e)},this.setContainerRef=e=>{this.mediaContainer=e,this.updateMaxDims()},this.updateMaxDims=()=>{if(this.mediaContainer&&this.props.mediaAspectRatio&&this.props.mediaType===Di.z.video){const e=this.mediaContainer.getBoundingClientRect();this.setState({maxWidth:e.width,maxHeight:e.height})}},this.mediaStyles=()=>{const{width:e,height:t,mediaPayload:i,mediaType:n,mediaAspectRatio:s}=this.props,{maxWidth:r,maxHeight:o}=this.state,a={};if(i)switch(n){case Di.z.photo:a.backgroundImage=i.url?`url('${i.url}')`:"none";case Di.z.rich:void 0!==e&&(a.width=`${e}px`),void 0!==t&&(a.height=`${t}px`,i.provider===Ii?a.height=`${t+54}px`:a.height=`${t}px`);break;case Di.z.video:if(void 0!==e&&void 0!==t){const i=(0,Vi.lZ)(e,t);a.width=`${e}px`,a.height=`${i}px`}else if(r&&o&&void 0!==s){const e=Math.min(o,(0,Vi.lZ)(r,r/s)),t=e*s;a.width=`${t}px`,a.height=`${e}px`}}return a},this.state={maxWidth:0,maxHeight:0}}componentDidMount(){this.props.mediaAspectRatio&&this.props.mediaType===Di.z.video&&(window.addEventListener("resize",this.updateMaxDims),this.updateMaxDims())}componentWillUnmount(){this.props.mediaAspectRatio&&this.props.mediaType===Di.z.video&&window.removeEventListener("resize",this.updateMaxDims)}componentWillReceiveProps(e){e.mediaPayload!==this.props.mediaPayload&&this.iframe&&this.iframe.parentNode&&(this.iframe.parentNode.removeChild(this.iframe),this.iframe=null),this.playerControls&&this.props.closing!==e.closing&&(e.closing?this.playerControls.pause():this.playerControls.play())}createEmbed(e){const{mediaType:t,mediaPayload:i,width:n,height:s}=this.props,{html:r,provider:o,src:a}=i,l=document.createElement("div");l.innerHTML=r;let c=l.firstChild;if("iframe"!==c.tagName.toLowerCase()){if(c=document.createElement("iframe"),!("srcdoc"in c))return Gi.warn(`Browser does not support srcdoc, refusing to embed ${r}`),void(this.iframe=null);let e,t;void 0!==n&&(c.width=n.toString()),void 0!==s&&(c.height=s.toString()),c.setAttribute("allow","encrypted-media; autoplay; fullscreen"),c.classList.add("tag-iframe-sandbox","loading"),c.onload=()=>c.classList.remove("loading"),e=o===Li&&void 0!==a?`<img src=${a} />`:r,t=o===Ii?"\n          <style>\n            html, body { padding: 0; margin: 0; border: 0; }\n            img { display: block; max-width: 100%; height: auto; border: 0; }\n            iframe { display: block; max-width: 100%; border: 0; }\n          </style>\n        ":"\n          <style>\n            html, body { padding: 0; margin: 0; border: 0; }\n            img, iframe { display: block; max-width: 100%; height: auto; border: 0; }\n          </style>\n        ";const i=t.replace(/\s+/g," ");c.srcdoc=`<!doctype html>${i}${e}`}else{const e=c.style;e.maxWidth="100%",e.maxHeight="100%",e.minWidth="",e.minHeight=""}if(t===Di.z.video&&c.src)try{const e=new Ui.Player(c);c.addEventListener("load",(()=>this.setupPlayerControls(e)))}catch(e){Gi.error(e)}this.iframe=c,e.appendChild(c)}render(){const{mediaPayload:e,mediaType:t}=this.props;if(!e)return null;const i=a({"tag-image":t===Di.z.photo,"tag-embed":t===Di.z.rich,"tag-video":t===Di.z.video}),n=e&&e.html?(0,r.h)("div",{class:"tag-embed-content",ref:this.setEmbedContentRef}):null;return(0,r.h)("div",{ref:this.setContainerRef,class:"tag-media-content",onClick:this.handleClick},(0,r.h)("div",{className:i,style:this.mediaStyles()},n))}};zi=Hi([N.Z],zi);const Wi=zi;var ji=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ki=class TextInput extends r.Component{constructor(e){super(e),this.touchDevice=(0,w.Jm)(),this.handleOutsideClick=e=>{if(!this.state.editing||!this.input)return;const t=this.getTextString(this.input.value,this.props.defaultText);this.stopEditing(t,!0)},this.stopEditing=(e,t=!0)=>{this.setState({editing:!1}),t&&this.props.text!==e?(this.setState({currentText:e}),this.props.onEdited&&this.props.onEdited(e)):this.props.onCancelEditing&&this.props.onCancelEditing()},this.stopPropagation=e=>{e.stopPropagation()},this.onBlur=()=>{this.context.engine.broadcast(new Vt.S(this.input,!1))},this.onFocus=()=>{this.context.engine.broadcast(new Vt.S(this.input,!0))},this.startEditing=e=>{if(!this.input)return;e&&e.stopPropagation();const{onStartEditing:t,autoSelect:i,defaultText:n}=this.props,{currentText:s}=this.state;this.setState({editing:!0}),t&&t(),this.input.focus(),(i||n&&this.input.select&&s===n)&&this.input.select()},this.onKeyPress=e=>{if(this.props.onKeyPress&&this.props.onKeyPress(e))return;e.stopPropagation();const t=e.which||e.keyCode;if(!("keydown"===e.type&&t!==Ut.R.TAB||t!==Ut.R.RETURN&&t!==Ut.R.TAB||e.shiftKey)){e.preventDefault(),this.input.blur(),this.setState({editing:!1});const t=this.getTextString(e.target.value,this.props.defaultText);this.props.onEdited&&this.props.onEdited(t)}},this.onInput=e=>{const t=e.target.value;this.setState({currentText:t}),this.props.onInput&&this.props.onInput(t)},this.setRef=e=>{this.input=e},this.state={editing:!1,currentText:this.props.text}}componentDidMount(){this.input&&(this.input.addEventListener("keypress",this.stopPropagation),this.input.addEventListener("keydown",this.stopPropagation),this.input.addEventListener("keyup",this.stopPropagation),this.props.closeOnFocusOut&&this.input.addEventListener("focusout",this.handleOutsideClick),this.touchDevice&&(this.input.addEventListener("blur",this.onBlur),this.input.addEventListener("focus",this.onFocus)),(this.props.editing||this.props.autofocus)&&this.startEditing())}componentWillUnmount(){this.input&&(this.input.removeEventListener("keypress",this.stopPropagation),this.input.removeEventListener("keydown",this.stopPropagation),this.input.removeEventListener("keyup",this.stopPropagation),this.props.closeOnFocusOut&&this.input.removeEventListener("focusout",this.handleOutsideClick),this.touchDevice&&(this.input.removeEventListener("blur",this.onBlur),this.input.removeEventListener("focus",this.onFocus)),this.input.blur())}componentWillReceiveProps(e){if(e.editing&&!this.props.editing&&this.startEditing(),e.text!==this.props.text){const t=this.getTextString(e.text,e.defaultText);this.setState({currentText:t})}}componentDidUpdate(e,t){this.input&&(!t.editing&&this.state.editing?this.input.focus():t.editing&&!this.state.editing&&this.input.blur())}getTextString(e,t){return""===e&&void 0!==t?t:e}setCurrentText(e){this.setState({currentText:e}),this.focusInput(),this.props.onEdited&&this.props.onEdited(e)}getCurrentText(){return this.state.currentText}focusInput(){this.input&&this.input.focus()}getFractionalCounter(){if(this.props.maxLength&&this.props.fractionalCounter)return`${this.state.currentText.length}/${this.props.maxLength}`}render(){const{editing:e,currentText:t}=this.state,{hint:i,isDisabled:n,placeholder:s,noFocusedPlaceholder:o,clickToEdit:a,maxLength:c,tabIndex:h,textarea:d,readOnlyText:u,autocapitalize:p,fractionalCounter:m,showUnderline:g,className:f}=this.props,v=!(t||!s||e&&o),y=v?s:void 0,b=!1!==a?this.startEditing:void 0,S={ref:this.setRef,class:l()("inputDiv",{editing:e}),type:"text",value:t,placeholder:y,maxLength:c,onInput:this.onInput,onClick:this.props.propagateMouseEvent?void 0:this.stopPropagation,onKeyPress:this.onKeyPress,disabled:n,readonly:this.props.readOnlyMode,onKeyDown:this.onKeyPress,tabIndex:h,autocapitalize:p},E=(0,r.h)("div",{class:"current-text",onClick:b,"data-hint":i},t||s||"");return(0,r.h)("div",{class:l()("modifiable-text",f,{editing:e,"fractional-counter":m,default:!t,"has-hint":!!i,"has-placeholder":v}),"data-hint":i,"data-fractional-counter":this.getFractionalCounter()},d?(0,r.h)(Scrollbars,{name:"text-input",singleScrollDirection:H.vertical,forceHidden:!1},E):E,(0,r.h)(d?"textarea":"input",S),u&&(0,r.h)("div",{class:"read-only-text"},u),g&&(0,r.h)("div",{class:"editable-line"}))}};Ki=ji([N.Z],Ki);const qi=Ki;var Zi=i(44283),Yi=new RegExp("^(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$","i");const $i=e=>(e=>Yi.test(e))(e)&&/^https?:\/\//.test(e);function Qi(e,t,i){const n=Math.ceil(t/2);return i(e)?t<=1?e:Qi(e+n,n,i):0===e?-1:Qi(Math.max(0,e-n),n,i)}function Xi(e,t){if(e<0)return-1;if(t(e))return e;const i=Math.ceil(e/2);return Qi(e-i,i,t)}class EditableDescription extends r.Component{constructor(e){super(e),this.textParser=new Fi.v({links:!0}),this.getInputDiv=()=>this.inputDiv,this.hasTextSelected=()=>this.range&&this.range.startOffset!==this.range.endOffset,this.onSelectionChange=()=>{const e=this.getCurrentSelection();e&&(this.range=e.cloneRange())},this.addFauxHighlight=()=>{this.execCommand("backColor","#ff315840")},this.removeFauxHighlight=()=>{this.execCommand("backColor","transparent")},this.prepareLinkSelection=()=>{const e=this.getAnchorFromSelection();let t=null;const i=window.getSelection();return i&&(e||this.range?(this.addFauxHighlight(),e||(t=this.range?this.range.toString():i.toString())):(this.inputDiv.focus(),i.selectAllChildren(this.inputDiv),i.collapseToEnd(),this.range=i.getRangeAt(0),t=this.range.toString())),e||(t||"")},this.onMouseDown=e=>{e.stopPropagation(),this.removeFauxHighlight(),this.range=null},this.onKeyDown=e=>{const t=e.which||e.keyCode;return e.stopPropagation(),t===Ut.R.ESCAPE?this.props.onNavigationKey(e):t===Ut.R.RETURN||t===Ut.R.TAB?(e.shiftKey||(e.preventDefault(),this.finalizeInput()),this.props.onNavigationKey(e)):void 0},this.onKeyPress=e=>{const{maxLength:t}=this.props;if(t&&this.range&&this.inputDiv){const[i,n]=this.textParser.getHTMLWithoutSelection(this.inputDiv,this.range),s=this.getTextInsertion(e,i,n);this.textParser.serializeHTMLToMarkdown(`${i}${s}${n}`).length>t&&e.preventDefault()}},this.onInput=()=>{this.props.updateLength()},this.onPaste=e=>{e.preventDefault();const{maxLength:t}=this.props,i=(e.clipboardData||window.clipboardData).getData("text/plain");if(t){if(this.inputDiv&&this.range){const[e,n]=this.textParser.getHTMLWithoutSelection(this.inputDiv,this.range),s=s=>this.textParser.serializeHTMLToMarkdown(`${e}${i.slice(0,s)}${n}`).length<=t,r=Xi(i.length,s);if(r>=0){const e=i.slice(0,r);document.execCommand("insertHTML",!1,e)}}}else document.execCommand("insertHTML",!1,i)},this.onFocus=e=>{this.context.messageBus.broadcast(new Vt.S(this.inputDiv,!0)),this.props.onFocus&&this.props.onFocus()},this.onBlur=()=>{this.context.messageBus.broadcast(new Vt.S(this.inputDiv,!1)),this.props.onBlur&&this.props.onBlur(),this.finalizeInput()},this.setInput=e=>{this.inputDiv=e};const t=new Zi.gm((()=>({})),(e=>document.addEventListener("selectionchange",e)),(e=>document.removeEventListener("selectionchange",e)));this.selectionSubscription=t.createSubscription(this.onSelectionChange)}componentDidMount(){const{description:e,onLinkClick:t}=this.props,i=this.getInputDiv();this.textParser.deserialize(e,!0,t).forEach((e=>{i.appendChild(e)})),this.selectionSubscription.renew(),this.props.updateLength()}componentDidUpdate(e){e.description!==this.props.description&&this.props.updateLength()}componentWillUnmount(){this.selectionSubscription.cancel(),this.inputDiv&&this.inputDiv.blur()}shouldComponentUpdate(){return!1}getCurrentSelection(){const e=window.getSelection();if(e&&e.rangeCount>0){const t=e.getRangeAt(0);if(this.inputDiv===t.commonAncestorContainer||this.inputDiv.compareDocumentPosition(t.commonAncestorContainer)&Node.DOCUMENT_POSITION_CONTAINED_BY)return t}return null}linkify(e,t){this.execCommand("backColor","transparent"),this.execCommand("createLink",t);let i=this.getAnchorFromSelection();!i&&this.range&&(i=document.createElement("a"),i.href=t,i.contentEditable="true",this.range.insertNode(i),this.range.setStartAfter(i),this.range.setEndAfter(i),this.applyRange(),this.inputDiv.setAttribute("placeholder",""),this.props.updateLength()),i&&(i.text=e,this.addLinkProperties(i))}unlink(e){const t=e.parentNode,i=e.textContent;t&&(t.removeChild(e),i&&!$i(i)&&this.execCommand("insertText",i))}applyRange(){if(this.range){const e=window.getSelection();e&&(e.removeAllRanges(),e.addRange(this.range))}}execCommand(e,t){this.range&&(this.applyRange(),document.execCommand(e,!1,t),this.onSelectionChange())}addLinkProperties(e){e.classList.add(Fi.o.LINK),e.onclick=this.props.onLinkClick}getAnchorFromSelection(){const e=this.getCurrentSelection();if(!e)return null;let t=e.commonAncestorContainer;for(;t&&"A"!==t.nodeName;){if(t===this.inputDiv)return null;t=t.parentNode}return t||null}finalizeInput(){this.props.onFinalizeInput(),this.inputDiv.blur()}getTextInsertion(e,t,i){if((e.which||e.keyCode)!==Ut.R.RETURN)return e.key;const n=t.slice(-1),s=i.slice(0,1);return"\n"===n||"\n"===s?"\n":"\n\n"}render(){return(0,r.h)("div",{ref:this.setInput,class:"inputDiv",placeholder:this.props.placeholder,onMouseDown:this.onMouseDown,onKeyDown:this.onKeyDown,onKeyPress:this.onKeyPress,onPaste:this.onPaste,contentEditable:!0,onInput:this.onInput,onFocus:this.onFocus,onBlur:this.onBlur})}}var Ji=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let en=class TextInputBox extends r.Component{constructor(e){super(e),this.onInput=e=>{if(this.props.onInput){const t=e.target;this.props.onInput(t.value)}},this.onKeyPress=e=>{e.stopPropagation();const t=e.which||e.keyCode,i=[Ut.R.TAB,Ut.R.RETURN];if("keydown"===e.type&&!i.includes(t))return!1;const n=e.target;switch(this.props.maxLength&&n.value.length>this.props.maxLength&&e.preventDefault(),t){case Ut.R.TAB:case Ut.R.RETURN:e.shiftKey||(e.preventDefault(),this.blur(),this.props.onDone(n.value))}return!1},this.stopPropagation=e=>e.stopPropagation(),this.onFocus=e=>{this.context.messageBus.broadcast(new Vt.S(this.input,!0)),this.props.onFocus&&this.props.onFocus(e)},this.onBlur=e=>{this.context.messageBus.broadcast(new Vt.S(this.input,!1)),this.props.onBlur&&this.props.onBlur(e)},this.setRef=e=>this.input=e,this.state={currentText:e.text}}componentWillUnmount(){this.input&&this.input.blur()}componentWillReceiveProps(e){e.text!==this.props.text&&this.setState({currentText:e.text})}getText(){return this.input?this.input.value:""}focus(){this.input.focus()}blur(){this.input.blur()}scrollIntoView(e){this.input.scrollIntoView(e)}render(){const{placeholder:e,tabIndex:t,maxLength:i,type:n}=this.props,{currentText:s}=this.state;return(0,r.h)("div",{class:"text-box"},(0,r.h)("input",{ref:this.setRef,class:"text-input-box",type:n||"text",value:s,placeholder:e,maxLength:i,onInput:this.onInput,onKeyPress:this.onKeyPress,onKeyDown:this.onKeyPress,onKeyUp:this.stopPropagation,onBlur:this.onBlur,onFocus:this.onFocus,tabIndex:t}))}};en=Ji([N.Z],en);const tn=en,{MATTERTAGS:nn}=m.Z.WORKSHOP;class LinkEditor extends r.Component{constructor(e){super(e),this.open=e=>{this.el.classList.add("open"),this.focus(e.urlFocus)},this.close=()=>{this.urlInput&&this.urlInput.blur(),this.textInput&&this.textInput.blur(),this.setState({currentText:"",currentUrl:"",validUrl:!0}),this.el.classList.remove("open")},this.onEditedUrl=e=>{const{validUrl:t,currentText:i}=this.state;if(!t)return;const n=""!==i?i:e;this.props.onSaveLink(n,e)},this.onInputUrl=e=>{this.setState({validUrl:$i(e),currentUrl:e})},this.onEditedText=e=>{this.focus(!0)},this.onInputText=e=>{this.setState({currentText:e})},this.onApply=e=>{this.state.currentUrl&&this.onEditedUrl(this.state.currentUrl)},this.onClose=e=>{this.close(),this.props.onCancel()},this.onPreviewUrl=()=>{this.state.validUrl&&window.open(this.state.currentUrl,"_blank")},this.stopPropagation=e=>{e.stopPropagation()},this.setRef=e=>this.el=e,this.setUrlRef=e=>this.urlInput=e,this.setTextRef=e=>this.textInput=e,this.state={currentUrl:e.linkUrl,currentText:e.linkText,validUrl:!0}}componentDidMount(){this.context.messageBus.subscribe(OpenLinkEditorMessage,this.open),this.context.messageBus.subscribe(CloseLinkEditorMessage,this.close)}componentWillUnmount(){this.close(),this.context.messageBus.unsubscribe(OpenLinkEditorMessage,this.open),this.context.messageBus.unsubscribe(CloseLinkEditorMessage,this.close)}componentDidUpdate(e){this.props.linkUrl!==e.linkUrl&&this.setState({currentUrl:this.props.linkUrl}),this.props.linkText!==e.linkText&&this.setState({currentText:this.props.linkText})}focus(e=!1){e?this.urlInput&&this.urlInput.focus():this.textInput&&this.textInput.focus()}renderButtons(){const{locale:e}=this.context,{validUrl:t,currentUrl:i}=this.state,{onRemoveLink:n,linkText:s,linkUrl:o}=this.props,a=""!==s&&""!==o,l=!i||!t?_.BN.DISABLED:_.BN.ENABLED,c=e.t(nn.LINK_EDITOR_APPLY_CTA),h=e.t(nn.LINK_EDITOR_REMOVE_TIP);return(0,r.h)("div",{class:"popover-footer"},this.renderValidationMessage(),a&&(0,r.h)(T.h,{iconClass:"icon-delete",buttonStyle:T.D.CLEAR,tooltipMsg:h,tooltipPosition:M.lZ.UP,onClick:n}),(0,r.h)(_.zx,{className:"button-inline",buttonStyle:_.ZJ.CLEAR,buttonSize:_.qE.SMALL,buttonState:l,onClick:this.onApply},c))}renderValidationMessage(){const{locale:e}=this.context,{linkText:t,linkUrl:i}=this.props,{validUrl:n,currentUrl:s}=this.state,o=""===t&&""===i&&""===s,a=e.t(nn.LINK_EDITOR_INVALID_TIP),l=e.t(nn.LINK_EDITOR_TIP_TEXT);return!n&&s?(0,r.h)("div",{class:"popover-message popover-message-error"},a):(0,r.h)("div",{class:"popover-message"},o&&l)}render(){const{locale:e}=this.context,{validUrl:t,currentText:i,currentUrl:n}=this.state,s=e.t(nn.LINK_EDITOR_TEXT_LABEL),o=e.t(nn.LINK_EDITOR_URL_LABEL),a=e.t(nn.LINK_EDITOR_PREVIEW_TIP);return(0,r.h)("div",{ref:this.setRef,class:"annotation-popup link-editor",onClick:this.stopPropagation},(0,r.h)("div",{class:"popover-header"},(0,r.h)("div",{class:"popover-label"},s),(0,r.h)(te.P,{buttonStyle:te.A.LIGHT,onClose:this.onClose})),(0,r.h)(tn,{ref:this.setTextRef,text:i,onDone:this.onEditedText,onInput:this.onInputText}),(0,r.h)("div",{class:"url-field"},(0,r.h)("div",{class:"popover-label"},o),(0,r.h)(tn,{ref:this.setUrlRef,text:n,type:"url",placeholder:"https://",onDone:this.onEditedUrl,onInput:this.onInputUrl}),t&&n&&(0,r.h)(T.h,{className:"preview-link",iconClass:"icon-ext-link",buttonStyle:T.D.PLAIN,tooltipMsg:a,tooltipPosition:M.lZ.UP,onClick:this.onPreviewUrl})),this.renderButtons())}}var sn=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{MATTERTAGS:rn}=m.Z.WORKSHOP;let on=class EditableBillboardText extends r.Component{constructor(e){super(e),this.textParser=new Fi.v({links:!0}),this.linkElement=null,this.onLabelEdit=e=>{this.handleTextChange("label",e)},this.onLabelKeyPress=e=>{if(e.keyCode===Ut.R.ESCAPE)return this.props.onNavigationKey(e);if(e.stopPropagation(),e.keyCode===Ut.R.TAB){const e=this.editableDescription.getInputDiv();e&&e.focus()}return!1},this.updateDescriptionLength=()=>{if(!this.editableDescription)return;const e=this.editableDescription.getInputDiv();if(!this.editableDescription.getInputDiv())return;const t=this.textParser.serialize(e).length;this.props.onDescriptionInput(0===t),this.setState({descriptionLength:t})},this.onDescriptionEdited=()=>{const e=this.editableDescription.getInputDiv();if(e){const t=this.textParser.serialize(e);this.handleTextChange("description",t)}},this.onLabelFocus=()=>{this.closePopover()},this.onDescriptionFocus=()=>{this.setState({editingDescription:!0})},this.onDescriptionBlur=()=>{this.setState({editingDescription:!1})},this.closePopover=()=>{this.setState({linkUrl:"",linkText:""}),this.linkElement=null,this.props.onClosePopover()},this.linkClicked=e=>{if(e.preventDefault(),this.props.linkEditorOpen)this.closePopover();else{e.stopPropagation(),this.linkElement=e.target;const{href:t,text:i}=this.linkElement;this.setState({linkUrl:t,linkText:i}),this.props.onClickLink()}},this.onRemoveLink=()=>{this.onSaveLink("","")},this.onSaveLink=(e,t)=>{this.linkElement?""!==t?(this.linkElement.href=t,this.linkElement.text=e,this.linkElement.setAttribute("data-value",t)):this.editableDescription.unlink(this.linkElement):this.editableDescription.linkify(e,t),this.closePopover(),this.onDescriptionEdited()},this.state={editingDescription:!1,descriptionLength:0,linkUrl:"",linkText:""}}prepareNewLinkSelection(){const e=this.editableDescription.prepareLinkSelection();let t,i;return"string"==typeof e?(this.linkElement=null,t="",i=e):(this.linkElement=e,t=e.href,i=e.text),this.setState({linkUrl:t,linkText:i}),""!==i&&""===t}handleTextChange(e,t){this.props.modifyMattertag(this.props.id,{[e]:t}).then(this.props.onEdited)}render(){const{locale:e}=this.context,{linkUrl:t,linkText:i,editingDescription:n,descriptionLength:s}=this.state,{label:o,linkEditorOpen:l,onNavigationKey:c,description:h}=this.props,d=`${s}/1000`,u=e.t(rn.TITLE_PLACEHOLDER),p=e.t(rn.DESCRIPTION_PLACEHOLDER);return(0,r.h)("div",{class:"editable-text-content"},(0,r.h)("div",{class:"mattertag-label-editor"},(0,r.h)(qi,{text:o,placeholder:u,onEdited:this.onLabelEdit,onInput:this.onLabelEdit,onKeyPress:this.onLabelKeyPress,maxLength:60,closeOnFocusOut:!0,textarea:!0,fractionalCounter:!0,onStartEditing:this.onLabelFocus})),(0,r.h)("div",{class:"editable-tag-description"},(0,r.h)("div",{class:a("modifiable-text fractional-counter",{editing:n||l,empty:0===s}),"data-fractional-counter":d},(0,r.h)(EditableDescription,{ref:e=>this.editableDescription=e,maxLength:1e3,descriptionLength:s,placeholder:p,description:h,updateLength:this.updateDescriptionLength,onFinalizeInput:this.onDescriptionEdited,onNavigationKey:c,onLinkClick:this.linkClicked,onFocus:this.onDescriptionFocus,onBlur:this.onDescriptionBlur}))),(0,r.h)(LinkEditor,{linkUrl:t,linkText:i,onCancel:this.closePopover,onSaveLink:this.onSaveLink,onRemoveLink:this.onRemoveLink}))}};on=sn([N.A],on);var an=i(28276);let ln=0;class SliderWithTooltip extends r.Component{constructor(e){super(e),this.setValue=e=>{this.setState({value:e}),this.slider&&this.slider.setValue(e)},this.getValue=()=>{const e=this.slider.getValue();return"object"==typeof e?e.value:e},this.onSliderInput=()=>{var e;this.layoutRecalculated||(null===(e=this.slider.MDComponent)||void 0===e||e.layout(),this.layoutRecalculated=!0);const t=this.getValue();this.setState({value:t}),this.props.onInput&&this.props.onInput(t)},this.onSliderChange=()=>{const e=this.getValue();this.setState({value:e}),this.props.onChange&&this.props.onChange(e)},this.getLeftOffset=()=>100*(this.state.value-this.props.min)/(this.props.max-this.props.min)+"%",this.getSliderId=()=>`slider-with-tooltip-${this.id}`,this.getStyleElement=()=>`#${this.getSliderId()} .mdc-slider__thumb-container {\n        left: ${this.getLeftOffset()}\n    }`,this.getDisplayValue=e=>{const{formatNumbers:t,units:i}=this.props;return(t?t(e):e)+(i||"")},this.setActive=e=>()=>this.setState({active:e}),this.hasChanged=()=>{this.setState({hasChanged:!1})},this.onMouseDown=e=>{this.props.onInputStart&&this.props.onInputStart()},this.onMouseUp=e=>{this.props.onInputEnd&&this.props.onInputEnd()},this.id=ln++,this.state={value:void 0!==e.initialValue?e.initialValue:(e.max+e.min)/2,active:!1,hasChanged:!1},this.setActiveSlider=this.setActive(!0),this.setInactiveSlider=this.setActive(!1)}componentDidMount(){document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("mouseleave",this.onMouseUp)}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mouseleave",this.onMouseUp)}componentDidUpdate(e,t){t.value!==this.state.value&&(clearTimeout(this.hasChangedTimeout),this.setState({hasChanged:!0}),this.hasChangedTimeout=window.setTimeout(this.hasChanged,450))}render(){const{width:e,displayBounds:t,min:i,max:n,discrete:s,tooltipPosition:o}=this.props,{active:l,hasChanged:c,value:h}=this.state;return(0,r.h)("div",{id:this.getSliderId(),class:a("slider-with-tooltip",{displayBounds:t}),style:`width:${e}px`,onMouseEnter:this.setActiveSlider,onMouseLeave:this.setInactiveSlider},o===cn.UP&&(0,r.h)("div",{class:a("slider-tooltip",{active:l||c}),"data-balloon":this.getDisplayValue(h),"data-balloon-pos":cn.UP,style:{left:this.getLeftOffset()}}),t&&(0,r.h)("div",{class:"min-amount"},this.getDisplayValue(i)),(0,r.h)(an.ZP,{ref:e=>this.slider=e,discrete:s,min:i,max:n,value:h,onInput:this.onSliderInput,onChange:this.onSliderChange,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp}),t&&(0,r.h)("div",{class:"max-amount"},this.getDisplayValue(n)),(0,r.h)("style",{dangerouslySetInnerHTML:{__html:this.getStyleElement()}}),o===cn.DOWN&&(0,r.h)("div",{class:a("slider-tooltip",{active:l||c}),"data-balloon":this.getDisplayValue(h),"data-balloon-pos":cn.DOWN,style:{left:this.getLeftOffset()}}))}}var cn;!function(e){e.UP="up",e.DOWN="down"}(cn||(cn={}));const hn=e=>{let t="";t+=Math.floor(e)+"'";const i=Math.floor(e%1*12);return i<10&&(t+="0"),t+=i+"''",t};var dn=i(48711),un=i(51058);const{MATTERTAGS:pn}=m.Z.WORKSHOP;class StemSlider extends r.Component{constructor(e){super(e),this.setStemValue=(e,t=!0)=>{const i=t?(0,dn._F)(e):e;i!==this.props.stemHeight&&this.props.modifyMattertag(this.props.sid,{stemHeight:i}).then((()=>{this.props.onEdited()}))},this.onClickReset=()=>{this.slider&&(this.setStemValue(this.state.originalStemHeight,!1),this.slider.setValue((0,dn.zy)(this.state.originalStemHeight)))},this.onToggleStemVisibility=()=>{this.props.modifyMattertag(this.props.sid,{stemVisible:!this.props.stemVisible}).then(this.props.onEdited)},this.stopPropagation=e=>{e.stopPropagation()},this.updateUnits=()=>{this.setState({units:this.context.settings.tryGetProperty(x.gx.Units,un.M.IMPERIAL)})},this.formatStemHeight=e=>{if(this.state.units===un.M.IMPERIAL)return hn(e);return`${Math.round(100*(0,dn._F)(e))/100}m`},this.state={originalStemHeight:e.stemHeight,units:un.M.IMPERIAL}}componentWillMount(){this.updateUnits()}componentDidMount(){this.slider.setValue((0,dn.zy)(this.props.stemHeight)),this.context.settings.onPropertyChanged(x.gx.Units,this.updateUnits)}componentWillUnmount(){this.context.settings.removeOnPropertyChanged(x.gx.Units,this.updateUnits)}render(){const{locale:e}=this.context,{stemVisible:t,stemHeight:i}=this.props,{originalStemHeight:n}=this.state,s=n!==i,o=e.t(pn.STEM_SLIDER_RESET_CTA),l=e.t(pn.SHOW_STEM_LABEL);return(0,r.h)("div",{class:"editable-popover stem-popover",onClick:this.stopPropagation},(0,r.h)(SliderWithTooltip,{ref:e=>this.slider=e,discrete:!1,min:0,max:9,initialValue:(0,dn.zy)(i),onInput:this.setStemValue,displayBounds:!0,width:150,formatNumbers:this.formatStemHeight,tooltipPosition:cn.DOWN}),(0,r.h)("div",{class:a("link-btn","popover-btn","stem-slider-reset",{disabled:!s}),onClick:this.onClickReset},o),(0,r.h)("hr",null),(0,r.h)("div",{class:"stem-checkbox",onClick:this.onToggleStemVisibility},(0,r.h)("div",{class:a("checkbox icon-checkmark",{checked:t})}),(0,r.h)("div",{class:"checkbox-text"},l)))}}var mn=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let gn=class ColorPicker extends r.Component{constructor(e){super(e),this.clickColor=e=>{const t=e.currentTarget;if(t&&t.getAttribute){const i=t.dataset.value;i&&(e.stopPropagation(),this.props.onColorPicked(i),this.setState({activeColor:i}))}},this.renderColorSwatch=e=>{const{activeColor:t}=this.state,i={backgroundColor:e},n=a({"color-swatch":!0,"icon-checkmark":!0,active:e===t});return(0,r.h)("div",{class:n,style:i,"data-value":e,onClick:this.clickColor})},this.state={activeColor:e.defaultColor||""}}componentWillReceiveProps(e){e.defaultColor&&!this.state.activeColor&&this.setState({activeColor:e.defaultColor})}render(){const{colors:e}=this.props;return(0,r.h)("div",{class:"color-picker"},e.map((e=>this.renderColorSwatch(e))))}};gn=mn([N.Z],gn);const fn=["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#03687d","#03a9f4","#00bcd4","#417505","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"];class DiscColorPicker extends r.Component{constructor(e){super(e),this.handleColorPicked=e=>{this.props.modifyMattertag(this.props.sid,{color:e}).then(this.props.onEdited)},this.stopPropagation=e=>{e.stopPropagation()}}render(){const{color:e}=this.props;return(0,r.h)("div",{class:"editable-popover color-editor",onClick:this.stopPropagation},(0,r.h)(gn,{colors:fn,defaultColor:e,onColorPicked:this.handleColorPicked}))}}const{MATTERTAGS:vn}=m.Z.WORKSHOP;var yn;!function(e){e[e.NONE=0]="NONE",e[e.INVALID_URL_SYNTAX=1]="INVALID_URL_SYNTAX",e[e.LOADING=2]="LOADING",e[e.LOADED=3]="LOADED",e[e.ERROR=4]="ERROR"}(yn||(yn={}));class MediaLinkInput extends r.Component{constructor(e){super(e),this.onInput=e=>{const t=$i(e)?yn.NONE:yn.INVALID_URL_SYNTAX;this.setState({validationPhase:t,currentUrl:e})},this.onApply=e=>{e.target.classList.contains("disabled")||this.onChangeMedia(this.state.currentUrl)},this.stopPropagation=e=>{e.stopPropagation()},this.onChangeMedia=async e=>{const{sid:t,mediaSrc:i,onEdited:n}=this.props;if(e!==i){const i=await this.loadMedia(e);i!==Di.z.error?(await this.props.modifyMattertag(t,{mediaSrc:e,mediaType:i}),this.setState({validationPhase:yn.LOADED}),n()):this.setState({validationPhase:yn.ERROR})}else this.props.onCancel()},this.loadMedia=async e=>{let t=Di.z.none;return this.setState({validationPhase:yn.NONE}),e&&(this.setState({validationPhase:yn.LOADING}),t=await this.props.embedlyValidator.getType(e)),t},this.state={currentUrl:e.mediaSrc,validationPhase:this.getInitialValidationPhase()}}getInitialValidationPhase(){return this.props.mediaType===Di.z.error?yn.ERROR:this.props.mediaSrc?yn.LOADED:yn.NONE}componentWillReceiveProps(e){this.state.currentUrl!==e.mediaSrc&&this.setState({currentUrl:e.mediaSrc})}render(){const{locale:e}=this.context,{mediaSrc:t,onCancel:i}=this.props,n=e.t(vn.MEDIA_LINK_LABEL),s=e.t(vn.MEDIA_LINK_SUPPORTED_FORMATS_LINK);return(0,r.h)("div",{class:"annotation-popup open media-editor",onClick:this.stopPropagation},(0,r.h)("div",{class:"popover-header"},(0,r.h)("div",{class:"popover-label"},n,(0,r.h)("a",{class:"link",target:"_blank",href:MediaLinkInput.supportPage},s)),(0,r.h)(te.P,{buttonStyle:te.A.LIGHT,onClose:i})),(0,r.h)(tn,{text:t,type:"url",placeholder:"https://",onDone:this.onChangeMedia,onInput:this.onInput}),this.renderPopoverFooter())}renderPopoverFooter(){const{locale:e}=this.context,{mediaSrc:t}=this.props,{validationPhase:i,currentUrl:n}=this.state,s=i===yn.ERROR||i===yn.LOADING||i===yn.INVALID_URL_SYNTAX&&""!==n||n===t&&""===n?_.BN.DISABLED:_.BN.ENABLED,o=e.t(vn.MEDIA_LINK_APPLY_CTA);return(0,r.h)("div",{class:"popover-footer"},this.renderValidationMessage(),(0,r.h)(_.zx,{className:"button-inline",buttonStyle:_.ZJ.CLEAR,buttonSize:_.qE.SMALL,buttonState:s,onClick:this.onApply},o))}renderValidationMessage(){const{locale:e}=this.context;switch(this.state.validationPhase){case yn.ERROR:return(0,r.h)("div",{class:"popover-message popover-message-error"},e.t(vn.MEDIA_LINK_ERROR_MESSAGE),(0,r.h)("a",{class:"link",target:"_blank",href:MediaLinkInput.supportPage},e.t(vn.MEDIA_LINK_HELP_LINK)));case yn.LOADING:return(0,r.h)("div",{class:"popover-message"},e.t(vn.MEDIA_LINK_LOADING_MESSAGE));case yn.INVALID_URL_SYNTAX:if(""!==this.state.currentUrl)return(0,r.h)("div",{class:"popover-message popover-message-error"},e.t(vn.MEDIA_LINK_INVALID_URL_MESSAGE))}return(0,r.h)("div",{class:"popover-message"})}}MediaLinkInput.supportPage="https://support.matterport.com/hc/en-us/articles/115006363868-Add-Multimedia-to-a-Mattertag-Post";var bn=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{MATTERTAGS:Sn}=m.Z.WORKSHOP;var En;!function(e){e.COLOR="color",e.STEM="stem",e.MEDIA="media",e.LINK="text-link"}(En||(En={}));let wn=class EditableBillboardContent extends r.Component{constructor(e){super(e),this.textParser=new Fi.v({links:!0}),this.getColorStyle=()=>{const e=this.props.getSavedData().color;if(e)return"background-color: "+e},this.toggleVisibility=()=>{const{id:e,manager:t}=this.props;this.closePopover();const i={visible:!this.state.currentValues.visible};t.modifyMattertag(e,i).then(this.onEdited)},this.onEdited=()=>{const e=this.props.getSavedData();e&&this.setState({currentValues:e,tagEmpty:this.props.manager.isTagEmpty(this.props.id)})},this.onMediaEdited=()=>{this.onEdited(),this.closePopover()},this.onMediaCancel=()=>{this.closePopover()},this.cancelEdits=()=>{this.props.manager.revertChanges()},this.doneEditing=()=>{const{manager:e,id:t}=this.props;e.saveMattertag(t)},this.onAddLinkClicked=e=>{if(e.stopPropagation(),this.state.popover===En.LINK)this.closePopover();else if(this.state.linkCount<5){const e=this.billboardText.prepareNewLinkSelection();this.openLinkEditor(e)}},this.onClickLink=()=>{this.openLinkEditor(!1)},this.onDescriptionInput=e=>{const t=this.props.getSavedData(),i=(0,we.Yv)(t.label)&&(0,we.Yv)(t.mediaSrc)&&e;this.updateLinkCount(this.props.description),this.setState({tagEmpty:i})},this.onNavigationKey=e=>{e.keyCode===Ut.R.ESCAPE&&this.cancelEdits()},this.billboardClick=e=>{e.stopPropagation(),this.closePopover()},this.closePopover=()=>{const{popover:e}=this.state;null!==e&&this.setPopover(e,!1)},this.clickOnBackground=e=>{this.closePopover(),e.stopPropagation()},this.setBillboardTextRef=e=>{this.billboardText=e};const t=e.getSavedData();this.state={popover:null,linkCount:0,currentValues:Object.assign({},t),tagEmpty:e.manager.isTagEmpty(e.id)},this.clickColor=this.clickMenuIcon.bind(this,En.COLOR),this.clickStem=this.clickMenuIcon.bind(this,En.STEM),this.clickMedia=this.clickMenuIcon.bind(this,En.MEDIA)}componentDidMount(){this.context.analytics.track("workshop_gui",{gui_action:"mattertag_editor_opened"}),this.updateLinkCount(this.props.description)}componentDidUpdate(e,t){const i=this.props.manager.dataMap.mattertagsViewData.toolState;t.tagEmpty&&!this.state.tagEmpty&&i===Ai.rI.PLACED&&this.props.manager.dataMap.mattertagsViewData.setToolState(Ai.rI.EDITING),this.updateLinkCount(this.props.description)}setPopover(e,t){const i=this.state.popover,n=t?e:null;i!==n&&i===En.LINK&&this.context.messageBus.broadcast(new CloseLinkEditorMessage),this.setState({popover:n})}openLinkEditor(e){this.setPopover(En.LINK,!0),this.context.messageBus.broadcast(new OpenLinkEditorMessage(e))}updateLinkCount(e){let t=0;const i=this.textParser.parse(e);for(const e of i)e.blockType===Bi.C.LINK&&t++;this.setState({linkCount:t})}clickMenuIcon(e,t){t.stopPropagation(),this.setPopover(e,this.state.popover!==e)}render(){const{locale:e}=this.context,{tagEmpty:t,popover:i}=this.state,n=null!==i,s=i===En.LINK||i===En.MEDIA,o=e.t(Sn.EDIT_BILLBOARD_CANCEL_CTA),a=e.t(Sn.EDIT_BILLBOARD_DONE_CTA);return(0,r.h)("div",{class:l()("editable-billboard-body",{"popover-open":n,"url-popover-open":s}),onClick:this.clickOnBackground},(0,r.h)("div",{class:"editable-billboard-content",onClick:this.billboardClick},this.renderTextContent(),this.renderMattertagMedia(),this.renderActivePopover()),(0,r.h)("div",{class:"billboard-footer",onClick:this.billboardClick},this.renderMenuItems(),(0,r.h)("div",{class:"billboard-cta"},(0,r.h)(_.zx,{buttonStyle:_.ZJ.CLEAR,buttonSize:_.qE.SMALL,className:"button-inline",onClick:this.cancelEdits},o),(0,r.h)(_.zx,{className:"button-inline",buttonStyle:_.ZJ.CLEAR,buttonSize:_.qE.SMALL,buttonState:t?_.BN.DISABLED:_.BN.ENABLED,onClick:this.doneEditing},a))))}renderActivePopover(){const{id:e,manager:t}=this.props,{popover:i,currentValues:n}=this.state,{stemVisible:s,stemHeight:o,color:a,mediaSrc:l,mediaType:c}=n;switch(i){case En.STEM:return(0,r.h)(StemSlider,{sid:e,stemVisible:s,stemHeight:o,onEdited:this.onEdited,modifyMattertag:t.modifyMattertag});case En.COLOR:return(0,r.h)(DiscColorPicker,{sid:e,color:a,onEdited:this.onEdited,modifyMattertag:t.modifyMattertag});case En.MEDIA:return(0,r.h)(MediaLinkInput,{sid:e,mediaSrc:l,mediaType:c,embedlyValidator:this.props.embedlyValidator,onEdited:this.onMediaEdited,onCancel:this.onMediaCancel,modifyMattertag:t.modifyMattertag});default:return null}}renderMenuItems(){const{locale:e}=this.context,{manager:t,id:i,fullSized:n}=this.props,{popover:s,currentValues:o,linkCount:a}=this.state,{visible:c}=o,h=t.isNewTag(i),d=s===En.COLOR,u=s===En.STEM,p=s===En.MEDIA,m=s===En.LINK,g=a<5,f=e.t(g?Sn.LINK_TOOLTIP_MESSAGE:Sn.LINK_DISABLED_TOOLTIP_MESSAGE),v=n?M.lZ.UP:M.lZ.DOWN,y=m?_.BN.ACTIVE:g?_.BN.ENABLED:_.BN.DIMMED;return(0,r.h)("div",{class:"billboard-menu"},(0,r.h)(T.h,{iconClass:"icon-link",className:l()("billboard-menu-item","add-link"),buttonState:y,buttonStyle:T.D.CLEAR,onClick:this.onAddLinkClicked,tooltipMsg:m?void 0:f,tooltipPosition:v}),(0,r.h)(T.h,{className:l()("billboard-menu-item","color"),buttonStyle:T.D.CLEAR,buttonState:d?_.BN.ACTIVE:_.BN.ENABLED,onClick:this.clickColor,tooltipMsg:d?void 0:e.t(Sn.COLOR_TOOLTIP_MESSAGE),tooltipPosition:v},(0,r.h)("span",{class:"color-dot",style:this.getColorStyle()})),(0,r.h)(T.h,{iconClass:"icon-stem-height",className:l()("billboard-menu-item","stem"),buttonStyle:T.D.CLEAR,buttonState:u?_.BN.ACTIVE:_.BN.ENABLED,onClick:this.clickStem,tooltipMsg:u?void 0:e.t(Sn.STEM_TOOLTIP_MESSAGE),tooltipPosition:v}),(0,r.h)(T.h,{iconClass:"icon-media-mix",className:l()("billboard-menu-item","media"),buttonStyle:T.D.CLEAR,buttonState:p?_.BN.ACTIVE:_.BN.ENABLED,onClick:this.clickMedia,tooltipMsg:p?void 0:e.t(Sn.MEDIA_TOOLTIP_MESSAGE),tooltipPosition:v}),!h&&(0,r.h)(T.h,{iconClass:c?"icon-eye-hide":"icon-eye-show",className:"billboard-menu-item",buttonStyle:T.D.CLEAR,onClick:this.toggleVisibility,tooltipMsg:e.t(c?Sn.HIDE_TOOLTIP_MESSAGE:Sn.SHOW_TOOLTIP_MESSAGE),tooltipPosition:v}))}renderTextContent(){const{popover:e}=this.state,{id:t,label:i,description:n,manager:s}=this.props,o=e===En.LINK;return(0,r.h)(on,{id:t,ref:this.setBillboardTextRef,label:i,description:n,linkEditorOpen:o,onClickLink:this.onClickLink,onClosePopover:this.closePopover,onDescriptionInput:this.onDescriptionInput,onNavigationKey:this.onNavigationKey,onEdited:this.onEdited,modifyMattertag:s.modifyMattertag})}renderMattertagMedia(){const{id:e,mediaType:t,closing:i,media:{hasMedia:n,mediaPayload:s},mediaAspectRatio:o}=this.props;return n?s?(0,r.h)(Wi,{key:e,mediaPayload:s,mediaType:t,mediaAspectRatio:o,closing:i}):(0,r.h)("div",{class:"loadingSpinner"},(0,r.h)("div",{class:"gui-spinner-icon"})):null}};wn=bn([N.Z],wn);var Tn=i(85861);class MouseThrough extends r.Component{constructor(e){super(e),this.eventsToSend={[MouseThrough.SendEvent.HOVER]:!1,[MouseThrough.SendEvent.CLICK]:!1,[MouseThrough.SendEvent.BUTTON]:!1},this.setRef=e=>this.mouseThroughElement=e,this.onHoverEvent=e=>{switch(e.type){case"mousemove":this.props.onMouseMove&&this.props.onMouseMove(e);break;case"mouseenter":this.props.onMouseEnter&&this.props.onMouseEnter(e);break;case"mouseleave":this.props.onMouseLeave&&this.props.onMouseLeave(e);break;case"pointermove":this.props.onMouseMove&&this.props.onMouseMove(e);break;case"pointerenter":this.props.onMouseEnter&&this.props.onMouseEnter(e);break;case"pointerleave":this.props.onMouseLeave&&this.props.onMouseLeave(e)}this.eventsToSend[MouseThrough.SendEvent.HOVER]&&this.isValidTarget(e.target)&&this.sendEventThrough(e.type,e)},this.isValidTarget=e=>e===this.mouseThroughElement||this.props.includeChildrenEvents&&e.compareDocumentPosition(this.mouseThroughElement)&Node.DOCUMENT_POSITION_CONTAINS,this.onClick=e=>{this.props.onClick&&this.props.onClick(e),this.eventsToSend[MouseThrough.SendEvent.CLICK]&&this.isValidTarget(e.target)&&(this.sendEventThrough("mousedown",e),window.setTimeout((()=>this.sendEventThrough("mouseup",e)),0))},this.onButtonEvent=e=>{switch(e.type){case"pointerdown":this.props.onPointerDown&&this.props.onPointerDown(e);break;case"pointerup":this.props.onPointerUp&&this.props.onPointerUp(e)}this.eventsToSend[MouseThrough.SendEvent.BUTTON]&&this.isValidTarget(e.target)&&this.sendEventThrough(e.type,e)},this.onClick=this.onClick.bind(this),this.target=e.clickTarget||document.getElementsByTagName("canvas")[0],this.registerEvents()}componentWillReceiveProps(e){(0,Tn.NK)(this.props.sendEvents,e.sendEvents)&&this.registerEvents()}render(){return(0,r.h)("div",{id:this.props.id,ref:this.setRef,class:this.props.className,style:this.props.style||{},onMouseEnter:this.onHoverEvent,onMouseLeave:this.onHoverEvent,onMouseMove:this.onHoverEvent,onPointerEnter:this.onHoverEvent,onPointerLeave:this.onHoverEvent,onPointerMove:this.onHoverEvent,onMouseDown:this.onButtonEvent,onMouseUp:this.onButtonEvent,onPointerDown:this.onButtonEvent,onPointerUp:this.onButtonEvent,onClick:this.onClick},this.props.children)}registerEvents(){this.props.sendEvents.length&&(this.eventsToSend[MouseThrough.SendEvent.CLICK]=this.props.sendEvents.indexOf(MouseThrough.SendEvent.CLICK)>-1,this.eventsToSend[MouseThrough.SendEvent.HOVER]=this.props.sendEvents.indexOf(MouseThrough.SendEvent.HOVER)>-1,this.eventsToSend[MouseThrough.SendEvent.BUTTON]=this.props.sendEvents.indexOf(MouseThrough.SendEvent.BUTTON)>-1)}sendEventThrough(e,t){let i;try{i=window.PointerEvent?new PointerEvent(e,t):new MouseEvent(e,t)}catch(n){i=document.createEvent("MouseEvents");const s=t.view;if(!s)return;i.initMouseEvent(e,t.bubbles,t.cancelable,s,t.detail,t.screenX,t.screenY,t.clientX,t.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,t.relatedTarget)}this.target.dispatchEvent(i)}}!function(e){let t;!function(e){e[e.HOVER=1]="HOVER",e[e.CLICK=2]="CLICK",e[e.BUTTON=3]="BUTTON"}(t=e.SendEvent||(e.SendEvent={}))}(MouseThrough||(MouseThrough={}));var _n=i(90756),Mn=i(33874),xn=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const An=new E.Z("mattertag-description");let On=class MattertagDescription extends r.Component{constructor(e){super(e),this.formatLink=(e,t)=>Pn(e,t,!1),this.linkClicked=e=>t=>{if(t.preventDefault(),this.props.onLinkClick(e),void 0===e.link)return;switch(e.link.type){case _n.U.NAVIGATION:this.props.navigationTagClicked(e);break;case _n.U.MODEL:window.location.replace(e.link.url);break;case _n.U.EXT_LINK:const t=1===this.embeddedlinks;t?window.requestAnimationFrame((()=>{try{const t=window.open(e.link.url,"mattertagEmb");t&&t.focus()}catch(t){An.debug(`Could not load the link within an iFrame! Error: ${t}`),window.open(e.link.url)}})):window.open(e.link.url),this.context.messageBus.broadcast(new Pi.Ik(e.link.url,t))}}}async componentDidMount(){this.settings=await this.context.market.waitForData(Mn.e),this.embeddedlinks=this.settings.tryGetProperty("emb",0)}render(){const{description:e,parsedDescription:t}=this.props;let i=e;return t&&t.length>0&&(i=Dn(t,this.formatLink,this.linkClicked)),i?(0,r.h)("div",{className:"tag-description"},i):null}};On=xn([N.Z],On);const Pn=(e,t,i)=>{if(!e.link)return null;const n=e.link,s=n.type===_n.U.NAVIGATION?"Link to position within this model":"Link to external web site";return(0,r.h)("a",{className:"link-url",contentEditable:i,href:n.url,onClick:t(e)},n.label,(0,r.h)("i",{class:"icon-ext-link",title:s}))},Dn=(e,t,i)=>e.map((e=>{switch(e.type){case Di.z.link:if(e.link)return t(e,i);case Di.z.text:return(e.text||"").replace("&zwnj;","")}return null}));var Cn=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let In=class MattertagTextContent extends r.Component{constructor(e){super(e),this.state={height:null,descriptionHeight:0,scrollable:!1,determiningScrollability:!1,scrollClass:K.None},this.onScrollPositionChange=()=>{if(!this.scrollbars||this.state.determiningScrollability)return;const e=this.scrollbars.scrollPosition.vertical;this.setState({scrollClass:e})}}componentWillReceiveProps(e){e.tagWidth!==this.props.tagWidth&&this.setState({height:null,scrollable:!0,determiningScrollability:!0})}componentDidMount(){this.determineScrollability()}componentDidUpdate(){this.state.determiningScrollability&&this.determineScrollability()}determineScrollability(){const e=this.textContainer&&this.textContainer.querySelector(".tag-description");let t={determiningScrollability:!1};if(this.props.description&&e){const i=this.props.mediaTag?65:159;if(e.scrollHeight>i+12){const e=this.textContainer&&this.textContainer.querySelector(".tag-label"),n=this.props.label?i+e.scrollHeight-5:i;t=Object.assign(Object.assign({},t),{height:n,scrollable:!0,scrollClass:K.Beginning})}else t=Object.assign(Object.assign({},t),{height:null,scrollable:!1,scrollClass:K.None})}this.setState(t)}render(){const{label:e,description:t,parsedDescription:i,onLinkClick:n,navigationTagClicked:s}=this.props;if(e||t||i){const o=a({"tag-text-content":!0,noScroll:!this.state.height||!this.state.scrollable,[this.state.scrollClass]:!0});return(0,r.h)("div",{class:o,style:{height:this.state.scrollable&&this.state.height||"auto"},ref:e=>{this.textContainer=e}},(0,r.h)(Scrollbars,{name:"mattertag-text-content",forceHidden:!1,waitToUpdate:this.state.determiningScrollability,singleScrollDirection:H.vertical,ref:e=>this.scrollbars=e,onScrollPositionChange:this.onScrollPositionChange},e&&(0,r.h)("div",{class:"tag-label",onClick:this.onBoundClick},(0,r.h)("span",null,e)),(0,r.h)(On,{description:t,parsedDescription:i,onLinkClick:n,navigationTagClicked:s})))}return null}};In=Cn([N.Z],In);const Ln=In;class CustomWidgetFrame extends r.Component{shouldComponentUpdate(){return!1}componentDidMount(){this.base&&this.props.widget.frame.mount(this.base)}componentWillUnmount(){this.base&&this.props.widget.frame.unmount()}render(){const{width:e,height:t}=this.props.widget.size,i={};return e&&t&&(i.width=e+"px",i.height=t+"px"),(0,r.h)("div",{class:"custom-widget-container",style:i})}}var Rn=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Nn=class ReadonlyBillboardContent extends r.Component{constructor(e){super(e),this.clickBillboard=()=>{this.props.onClickBillboard()},this.onClickImage=()=>{this.props.allowTagOverlay?this.props.onOpenOverlay():this.props.onClickBillboard()}}render(){const{media:e,style:t,selected:i,allowTagOverlay:n,label:s,description:o,parsedDescription:l}=this.props;return(0,r.h)("div",{class:a("billboard-body",{expandable:n}),onClick:this.clickBillboard},(0,r.h)("div",{className:"billboard-content",style:t.bodyStyle},(0,r.h)(Ln,{label:s,description:o,parsedDescription:l,tagWidth:t.width,imgHeight:t.height,mediaTag:e.hasMedia,onLinkClick:this.props.onLinkClick,navigationTagClicked:this.props.navigationTagClicked}),this.renderMattertagMedia(),this.renderCustomWidget()),!i&&(0,r.h)(MouseThrough,{sendEvents:[MouseThrough.SendEvent.BUTTON],className:"hover-arrow"}))}renderMattertagMedia(){const{id:e,allowTagOverlay:t,mediaType:i,style:{width:n,height:s,closing:o},media:{hasMedia:a,mediaPayload:l}}=this.props;return a?l?(0,r.h)(Wi,{key:e,mediaPayload:l,mediaType:i,width:n,height:s,onClickImage:t?this.onClickImage:void 0,closing:o}):(0,r.h)("div",{class:"loadingSpinner"},(0,r.h)("div",{class:"gui-spinner-icon"})):null}renderCustomWidget(){if(this.props.customWidget)return(0,r.h)(CustomWidgetFrame,{widget:this.props.customWidget})}};Nn=Rn([N.A],Nn);var kn=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Bn=class MattertagOverlay extends r.Component{constructor(e){super(e),this.toggleCollapseText=()=>{this.setState((e=>({collapsed:!e.collapsed})))},this.onScrollPositionChange=()=>{if(!this.scrollbars||this.state.determiningScrollability)return;const e=this.scrollbars.scrollPosition.vertical;this.setState({scrollClass:e})},this.updateScrollAndCollapse=()=>{const e=this.textContainer?this.textContainer.scrollHeight:0,t=this.textContainer&&this.textContainer.querySelector(".tag-description");let i={determiningScrollability:!1};if(e){const n=Math.max(e-41-this.state.overlayHeight,0),s=n>0,r=e-n,o=t&&t.scrollHeight-n,a=s?K.Beginning:K.None,l=t&&e>41;i=Object.assign(Object.assign({},i),{height:r,scrollable:s,descriptionHeight:o,scrollClass:a,collapsible:l})}this.setState(i)},this.updateOverlayDimensions=()=>{const{label:e,description:t,maxWidth:i,maxHeight:n,mediaAspectRatio:s}=this.props,r=i-24,o=n-24-(e||t?41:0),a=s<r/o;this.setState({overlayWidth:a?o*s:r,overlayHeight:a?o:r/s})},this.stopPropagation=e=>{e.stopPropagation()},this.state={overlayWidth:0,overlayHeight:0,collapsible:!!(e.description&&e.description.length>0),collapsed:!1,height:null,descriptionHeight:0,scrollable:!1,determiningScrollability:!1,scrollClass:K.None}}componentDidMount(){this.updateOverlayDimensions(),this.updateScrollAndCollapse()}componentDidUpdate(e,t){const i=e.mediaAspectRatio!==this.props.mediaAspectRatio,n=e.maxWidth!==this.props.maxWidth,s=e.maxHeight!==this.props.maxHeight;(i||n||s)&&(this.setState({determiningScrollability:!0,scrollable:!1,scrollClass:K.None,height:0}),window.requestAnimationFrame((()=>{this.updateOverlayDimensions(),this.updateScrollAndCollapse()})))}render(){const{mediaPayload:e,mediaType:t,closing:i}=this.props,{overlayWidth:n,overlayHeight:s,collapsible:o}=this.state;return(0,r.h)("div",{class:"billboard-body",onClick:this.stopPropagation},(0,r.h)("div",{className:l()("billboard-content",{collapsible:o})},this.renderOverlayText(),(0,r.h)(Wi,{mediaPayload:e,mediaType:t,width:n,height:s,closing:i})))}renderOverlayText(){const{label:e,description:t,parsedDescription:i,onLinkClick:n,navigationTagClicked:s,closeImageOverlay:o}=this.props,{collapsible:a,collapsed:c,descriptionHeight:h,scrollable:d,height:u,determiningScrollability:p,scrollClass:m}=this.state,g=p||c?void 0:{maxHeight:u+"px"},f={};return t&&u&&d&&(f.height=h+"px",f.overflow="hidden"),(0,r.h)("div",{class:l()("tag-text-content",{collapsed:c,noScroll:!u||!d}),style:g,ref:e=>{this.textContainer=e}},e&&(0,r.h)("div",{class:"tag-label",onClick:this.toggleCollapseText},(0,r.h)("div",{class:"labelText"},e)),t&&(0,r.h)("div",{style:f,class:l()(m,"wrappedDesc")},(0,r.h)(Scrollbars,{name:"mattertag-overlay-text",forceHidden:!1,waitToUpdate:p,singleScrollDirection:H.vertical,ref:e=>this.scrollbars=e,onScrollPositionChange:this.onScrollPositionChange},(0,r.h)("div",null,(0,r.h)(On,{description:t,parsedDescription:i,onLinkClick:n,navigationTagClicked:s})))),(0,r.h)("div",{class:"buttons"},a&&(0,r.h)(T.h,{className:l()("tag-button","tag-collapse-button"),iconClass:"icon-dpad-down",onClick:this.toggleCollapseText}),(0,r.h)(T.h,{className:"tag-button",iconClass:"icon-close",onClick:o})))}};Bn=kn([N.Z],Bn);const Fn=Bn;class FullSizeOnSmallScreens extends r.Component{constructor(){super(...arguments),this.onResize=()=>{this.adjustSizing(this.props)},this.adjustSizing=(e=this.props,t=!0)=>{const i=FullSizeOnSmallScreens.isFullSized(e.editing);i!==this.state.fullSized&&(this.context.messageBus.broadcast(new ue.Zi(i)),t&&this.setState({fullSized:i}))}}static isFullSized(e){return e&&(window.innerWidth<=700||window.innerHeight<=600)}componentDidMount(){window.addEventListener("resize",this.onResize),this.adjustSizing(this.props)}componentDidUpdate(){this.adjustSizing(this.props)}render(){const e=a({"full-size-on-small-screens":this.state.fullSized,"floating-on-normal-screens":!this.state.fullSized});return(0,r.h)("div",{className:e},this.props.children)}componentWillUnmount(){this.adjustSizing({editing:!1},!1),window.removeEventListener("resize",this.onResize)}}var Un,Vn=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const Hn=new E.Z("billboard");var Gn;!function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED",e[e.FAILED=3]="FAILED",e[e.ENABLED=4]="ENABLED"}(Gn||(Gn={}));let zn=Un=class Billboard extends r.Component{constructor(e,t){super(e),this.linkCount=0,this.linksClicked=[],this.linkEditorOpened=()=>this.setState({expanded:!0}),this.linkEditorClosed=()=>this.setState({expanded:!1}),this.getSavedData=()=>{const{label:e,description:t,mediaSrc:i,mediaType:n,stemVisible:s,enabled:r}=this.props.tag,{stemHeight:o,color:a}=this.props.view;return{visible:r,color:a,label:e,description:t,stemHeight:o,mediaSrc:i,mediaType:n,stemVisible:s}},this.updateBillboardSize=()=>{const{mediaWidth:e,mediaHeight:t}=this.state,{tag:i}=this.props;if(i.mediaType===Di.z.photo||i.mediaType===Di.z.rich||i.mediaType===Di.z.video){const n=this.getDimensionsForMedia(i.mediaType,e,t);this.setState(Object.assign({},n))}},this.closeImageOverlay=()=>{const{overlay:e,toggleImageOverlay:t,tag:i}=this.props;e&&t(i.sid,!1)},this.onOpenOverlay=()=>{const{toggleImageOverlay:e,allowTagOverlay:t,tag:i}=this.props;t&&e(i.sid,!0)},this.onBillboardClicked=()=>{const{manager:e,toolOpen:t,tag:i,selected:n}=this.props;t&&e&&!n&&e.selectMattertag(i.sid)},this.setBillboardRef=e=>{this.billboardRef=e},this.updateTagDirection=()=>{const{direction:e}=this.state,{getTagContainer:t,tag:i}=this.props,{navigating:n,navigatingPosition:s,position:r,onTagDirectionChanged:o}=this.props.view,a=t();if(!a)return;const[l,c]=[a.offsetWidth,a.offsetHeight];let h;h=n&&s?Un.getTagDirection(s.x,s.y,l,c):r?Un.getTagDirection(r.x,r.y,l,c):Un.getTagDirection(0,0,l,c),h!==e&&(o(i.sid,h),this.setState({direction:h}))},this.onLinkClick=e=>{if(void 0===e.link)return;-1===this.linksClicked.indexOf(e.link)&&this.linksClicked.push(e.link);const t=e.link.type;this.linkCount++,this.context.analytics.track("click_mattertag_link",{link_type:t,link_count:this.linkCount,links_clicked:this.linksClicked.length})};const i=this.getDimensionsForMedia(e.tag.mediaType,1024,1024),n=t.settings.getProperty(Mi.l);this.embedly=new Embedly(n,t.queue),this.state={width:i.width,height:190,expanded:!1,mediaWidth:0,mediaHeight:0,mediaPayload:null,landscape:!1,active:!1,mediaLoadingState:e.mediaEnabled?Gn.NOT_LOADED:Gn.ENABLED,savedData:this.getSavedData(),direction:void 0};const s=e.tag,r=new Zi.gm((()=>({})),(e=>{s.onPropertyChanged("mediaSrc",e),s.onPropertyChanged("mediaType",e)}),(e=>{s.removeOnPropertyChanged("mediaSrc",e),s.removeOnPropertyChanged("mediaType",e)}));this.tagOnChangedSub=r.createSubscription((()=>{this.loadMedia(!0)}),!1),this.updateTagDirection()}componentDidMount(){const{view:e,manager:t}=this.props;this.loadMedia(),!e.located||e.navigating&&!e.navigatingPosition||this.setState({active:!0}),window.addEventListener("resize",this.updateBillboardSize),t&&(this.context.messageBus.subscribe(OpenLinkEditorMessage,this.linkEditorOpened),this.context.messageBus.subscribe(CloseLinkEditorMessage,this.linkEditorClosed)),this.tagOnChangedSub.renew()}componentWillUnmount(){this.tagOnChangedSub.cancel(),this.props.manager&&(this.context.messageBus.unsubscribe(OpenLinkEditorMessage,this.linkEditorOpened),this.context.messageBus.unsubscribe(CloseLinkEditorMessage,this.linkEditorClosed))}componentDidUpdate(e,t){const{manager:i,editing:n,tag:s,view:r,overlay:o}=this.props,{active:a}=this.state;if(i===e.manager||e.manager||(this.context.messageBus.subscribe(OpenLinkEditorMessage,this.linkEditorOpened),this.context.messageBus.subscribe(CloseLinkEditorMessage,this.linkEditorClosed)),n===e.editing&&o===e.overlay||this.updateBillboardSize(),r.closeTheTag||s&&s.mediaSrc!==e.tag.mediaSrc&&this.loadMedia(!0),a||e.view.navigatingPosition===r.navigatingPosition||this.updateTagDirection(),r.closeTheTag)a&&this.setState({active:!1});else if(a||!r.located||r.navigating&&!r.navigatingPosition||this.setState({active:!0}),n&&(!e.editing||null===this.state.savedData)){const e=this.getSavedData();e&&this.setState({savedData:e})}}loadMedia(e=!1){const{mediaType:t,mediaSrc:i}=this.props.tag,{mediaLoadingState:n}=this.state;if(Un.isMediaTag(t)&&(e||![Gn.LOADING,Gn.FAILED,Gn.ENABLED].includes(n)))return this.setState({mediaLoadingState:Gn.LOADING}),this.embedly.getMediaDetails(t,i).then((e=>{if(e&&this.billboardRef){const i=this.getDimensionsForMedia(t,e.width,e.height);this.setState(Object.assign(Object.assign({},i),{mediaWidth:e.width,mediaHeight:e.height,mediaPayload:e.embedlyResponse,mediaLoadingState:Gn.LOADED}))}})).catch((e=>{if(Hn.debug(e),this.billboardRef){const e=this.getDimensionsForMedia(Di.z.text,1024,1024);this.setState(Object.assign(Object.assign({},e),{mediaLoadingState:Gn.FAILED}))}}))}getDimensionsForMedia(e,t,i){if(e===Di.z.text||e===Di.z.none||e===Di.z.error)return{width:298,height:0,landscape:!1};const{getTagContainer:n,editing:s,overlay:r}=this.props;let o=t,a=i;const l=Math.max(t,1)/Math.max(i,1),c=n();if(c)if(r)o=c.offsetWidth,a=c.offsetHeight;else{const i=e===Di.z.photo;let n;n=s?i?150:340:80;const r=c.offsetWidth-100,h=c.offsetHeight-n;o=i?l>1?Math.max(Math.min(t,400,r),Ri):Math.max(Math.min(t,300),200):Math.max(Math.min(t,350,r),Ri),a=o/l,a>h&&(a=h,o=a*l)}return{width:o,height:a,landscape:l>1}}render(){const{overlay:e,editing:t,view:i,tag:n}=this.props,{closeTheTag:s}=i,{sid:o,mediaType:l,label:c,description:h}=n,{landscape:d,mediaLoadingState:u,active:p,direction:m,expanded:g}=this.state,f=Un.isMediaTag(l)&&u!==Gn.FAILED&&u!==Gn.ENABLED,v=u===Gn.LOADING&&l===Di.z.photo,y=t||e?void 0:this.getTagPositionStyle(),b=t||e||!m?void 0:"tag"+m.trim().replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase();const S=this.isImageTag(),E=f&&l===Di.z.video,w=f&&(l===Di.z.rich||v),T=E||w||S,_=c.length>0||h.length>0;return(0,r.h)(FullSizeOnSmallScreens,{editing:t},(0,r.h)("div",{className:a("tag-position",{"billboard-standard-view":!t&&!e,"billboard-overlay":e,"billboard-editing":t,"media-only-mattertag":!_&&T,"media-mattertag":T,"video-mattertag":E,"embed-mattertag":w,"image-mattertag":S,"link-popover-expanded":g}),key:o,style:y},(0,r.h)("div",{className:a("tag-wrapper",{active:!s&&p})},(0,r.h)("div",{ref:this.setBillboardRef,className:a("tag-container",[b],{"media-landscape":T&&d,"media-portrait":T&&!d}),onClick:this.closeImageOverlay},this.renderBillboard(f)))))}renderBillboard(e){const{mediaPayload:t,width:i,height:n,savedData:s,mediaWidth:o,mediaHeight:a}=this.state,{onNavigationLinkClicked:l,overlay:c,selected:h,view:d,tag:u,allowTagOverlay:p}=this.props,m=a>0?o/a:void 0;if(c&&m){const{label:e,description:s,parsedDescription:o,mediaType:a}=u;return(0,r.h)(Fn,{label:e,description:s,parsedDescription:o,mediaPayload:t,mediaType:a,maxWidth:i,maxHeight:n,mediaAspectRatio:m,closing:d.closeTheTag,closeImageOverlay:this.closeImageOverlay,onLinkClick:this.onLinkClick,navigationTagClicked:l})}{const{sid:o}=u,a={mediaPayload:t,hasMedia:e},c=e&&!t?{width:i+"px"}:{},{editing:g,manager:f}=this.props;if(g&&f){const e=FullSizeOnSmallScreens.isFullSized(g);return(0,r.h)(wn,{id:o,getSavedData:this.getSavedData,manager:f,fullSized:e,mediaAspectRatio:m,media:a,mediaType:u.mediaType,closing:d.closeTheTag,label:u.label,description:u.description,originalValues:s,embedlyValidator:this.embedly})}{const e={width:i,height:n,bodyStyle:c,closing:d.closeTheTag};return(0,r.h)(Nn,{id:o,allowTagOverlay:p,selected:h,style:e,onClickBillboard:this.onBillboardClicked,onOpenOverlay:this.onOpenOverlay,onLinkClick:this.onLinkClick,navigationTagClicked:l,media:a,mediaType:u.mediaType,mediaSrc:u.mediaSrc,label:u.label,parsedDescription:u.parsedDescription,description:u.description,customWidget:u.widgetFrame})}}}isImageTag(){const{tag:e}=this.props;return this.state.mediaLoadingState!==Gn.FAILED&&this.state.mediaLoadingState!==Gn.ENABLED&&e.mediaType===Di.z.photo}getTagPositionStyle(){const{view:e}=this.props;if(e.located){const{position:t}=e;return{transform:`translate(${t?t.x:0}px, ${t?t.y:0}px)`}}return{pointerEvents:"none",visibility:"hidden"}}static isMediaTag(e){return e===Di.z.photo||e===Di.z.video||e===Di.z.rich}};zn.getTagDirection=(e,t,i,n)=>{const s=.2,r=1-(e+1)/(i=i||window.innerWidth)*2,o=1-(t+1)/(n=n||window.innerHeight)*2,a=o<-.2?0:o<s?1:2,l=r<-.2?2:r<s?1:0,c=Math.max(e,i-e);let h;return h=0===l?1===a?Ai.Pg.RIGHT:0===a?Ai.Pg.RIGHT_UP:Ai.Pg.RIGHT_DOWN:2===l?1===a?Ai.Pg.LEFT:0===a?Ai.Pg.LEFT_UP:Ai.Pg.LEFT_DOWN:1===a&&c>Ri?r<0?Ai.Pg.RIGHT:Ai.Pg.LEFT:2===a?Ai.Pg.DOWN:Ai.Pg.UP,Hn.debug(`Selected ${h} for [${e}, ${t}] in ${i}x${n} (${l}, ${a})`),h},zn=Un=Vn([N.Z],zn);zn.getTagDirection;var Wn,jn=i(60225),Kn=i(40698),qn=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Zn=Wn=class CircularProgressBar extends r.Component{constructor(e){super(e),this.strokePattern=[0,100],this.strokeOffset=0,this.innerRadius=15.92,this.strokeWidth=1,this.drawRadius=this.innerRadius+this.strokeWidth/2,this.updateSvgAttributes(e),this.elementId=this.props.id||"circle-progress-"+Wn.id++}componentWillReceiveProps(e){this.updateSvgAttributes(e)}updateSvgAttributes(e){this.strokeWidth=e.barWidth||this.strokeWidth,this.innerRadius=e.innerRadius||this.innerRadius,this.drawRadius=this.innerRadius+this.strokeWidth/2;const t=2*this.drawRadius*Math.PI;this.strokeOffset=t*(e.startPosition||this.strokeOffset),this.strokePattern[0]=t*(0,ve.uZ)(e.progress,0,100)/100,this.strokePattern[1]=t-this.strokePattern[0]}render(){const{progressColor:e}=this.props,t=2*(this.innerRadius+this.strokeWidth),i=t/2;return(0,r.h)("svg",{id:this.elementId,class:l()("circular-progress",this.props.className),viewBox:`${-i} ${-i} ${t} ${t}`},(0,r.h)("circle",{class:"bar-bg",cx:"0",cy:"0",r:this.drawRadius,transform:"rotate(-90) "+(this.props.ccw?"scale(-1 1)":""),"stroke-dasharray":`${this.strokePattern[1]} ${this.strokePattern[0]}`,"stroke-dashoffset":this.strokeOffset-this.strokePattern[0],"stroke-width":this.strokeWidth,fill:"none"}),(0,r.h)("circle",{class:e?void 0:"progress",cx:"0",cy:"0",r:this.drawRadius,transform:"rotate(-90) "+(this.props.ccw?"scale(-1 1)":""),"stroke-dasharray":`${this.strokePattern[0]} ${this.strokePattern[1]}`,"stroke-width":this.strokeWidth,stroke:e,fill:"none"}),this.props.children)}};Zn.id=0,Zn=Wn=qn([N.Z],Zn);class Tags extends r.Component{constructor(e){super(e),this.bindings=[],this.onUpdateSelectedTag=()=>this.setState({selectedTag:this.mattertagsViewData.selectedTag}),this.onUpdateToolState=()=>this.setState({toolState:this.mattertagsViewData.toolState}),this.onUpdateScreenPosition=()=>this.setState({screenPosition:this.mattertagsViewData.screenPosition}),this.onUpdateProgress=()=>this.setState({creationProgress:this.mattertagsViewData.progress}),this.onUpdateBillboards=()=>this.setState({billboards:this.mattertagsViewData.activeBillboards.keys}),this.toggleImageOverlay=async(e,t)=>{if(this.props.allowTagOverlay||!t)if(this.setState({overlay:t}),this.context.commandBinder.issueCommand(new ce.Bz(le.P.MATTERTAG_PHOTO,t)),t){this.context.messageBus.broadcast(new Pi.dJ(e,Oi.V.OVERLAY));const t=e!==this.state.selectedTag?Te.n.Interpolate:Te.n.Instant,i=this.mattertagsData.getTag(e);this.context.commandBinder.issueCommand(new jn.Y(i.sid,t))}else this.closeBillboard(e)},this.getTagContainer=()=>this.tagsRoot,this.onNavigationLinkClicked=e=>{this.context.commandBinder.issueCommand(new jn.c(e))},this.setState({billboards:[],selectedTag:null,overlay:!1,toolState:Ai.rI.CLOSED,creationProgress:0,screenPosition:null})}componentDidMount(){const e=this.context.market;Promise.all([e.waitForData(Kn.n),e.waitForData(Ai.P5),e.waitForData(Mn.e)]).then((([e,t,i])=>{this.init(e,t,i)}))}init(e,t,i){this.mattertagsData=e,this.mattertagsViewData=t,this.settingsData=i,this.bindings.push(this.mattertagsViewData.onSelectedTagChanged(this.onUpdateSelectedTag),this.mattertagsViewData.onChanged(this.onUpdateBillboards),this.mattertagsViewData.onToolStateChanged(this.onUpdateToolState)),this.context.editMode&&this.bindings.push(this.mattertagsViewData.onScreenPositionChanged(this.onUpdateScreenPosition),this.mattertagsViewData.onProgressChanged(this.onUpdateProgress)),this.setState({selectedTag:this.mattertagsViewData.selectedTag,toolState:this.mattertagsViewData.toolState,screenPosition:this.mattertagsViewData.screenPosition,creationProgress:this.mattertagsViewData.progress,billboards:this.mattertagsViewData.activeBillboards.keys})}componentWillUnmount(){this.bindings.forEach((e=>{e.cancel()})),this.bindings.length=0}componentDidUpdate(e){const{allowTagOverlay:t,toolOpen:i}=this.props;if(this.context.editMode&&(t!==e.allowTagOverlay||i!==e.toolOpen)){const e=this.mattertagsViewData&&this.mattertagsViewData.openTag;e&&(this.state.overlay?t||this.toggleImageOverlay(e,!1):this.closeBillboard(e))}}closeBillboard(e){this.mattertagsViewData.closeBillboard(e)}renderBillboards(){const{overlay:e,selectedTag:t,toolState:i,billboards:n}=this.state,{toolOpen:s,manager:o,allowTagOverlay:a}=this.props,l=[],c=i===Ai.rI.CREATING||i===Ai.rI.PRESSING||i===Ai.rI.PLACING,h=!(!s||i!==Ai.rI.EDITING&&i!==Ai.rI.PLACED);return c||n.forEach((i=>{const n=t===i,c=h&&n,d=this.mattertagsViewData.getViewData(i),u=this.mattertagsData.getTag(i),p=this.settingsData.tryGetProperty(Pt.sX,!1),m=c||!p;!u||d.closeTheTag&&c||l.push((0,r.h)(zn,{key:`billboard-${i}`,editing:c,selected:n,overlay:e,allowTagOverlay:a,toolOpen:s,view:d,tag:u,manager:o,mediaEnabled:m,toggleImageOverlay:this.toggleImageOverlay,onNavigationLinkClicked:this.onNavigationLinkClicked,getTagContainer:this.getTagContainer}))})),l}renderProgressCircle(){const{mobile:e}=this.props,{creationProgress:t,screenPosition:i,toolState:n}=this.state;if(!(n===Ai.rI.PRESSING&&t>0&&e)||!i)return null;const s={left:i.x-Tags.creationButtonRadius/2+"px",top:i.y-Tags.creationButtonRadius/2+"px"};return(0,r.h)("div",{class:"point-button-wrapper",style:s},(0,r.h)(Zn,{className:a({complete:1===t,reset:0===t}),progress:100*t,innerRadius:Tags.creationButtonRadius,barWidth:Tags.progressBarThickness},(0,r.h)("circle",{class:"point",cx:"0",cy:"0",r:"22",transform:"rotate(-90)",fill:"#fff"})))}render(){if(!this.mattertagsData||!this.mattertagsViewData||!this.settingsData)return null;const{toolOpen:e}=this.props,{toolState:t}=this.state,i=!(!e||t!==Ai.rI.EDITING&&t!==Ai.rI.PLACED);return(0,r.h)("div",{className:a("overlay-layer","tags-layer",{"tag-editable":e,"tags-layer-editing":i,"tags-layer-displaying":!i}),ref:e=>{this.tagsRoot=e}},this.renderProgressCircle(),this.renderBillboards())}}Tags.creationButtonRadius=132,Tags.progressBarThickness=8;var Yn=i(74371),$n=i(59088),Qn=i(15982),Xn=i(2212),Jn=i(88814),es=i(68576),ts=i(90454),is=i(76896);class RoomLabel extends r.Component{constructor(e){super(e)}render(){const{sid:e,position:t,text:i,readOnlyText:n,rotation:s,visible:o}=this.props,a={left:t.x+"px",top:t.y+"px",transform:s?`translate(-50%, -50%) rotate(${s}deg) `:"translate(-50%, -50%)"},l=n?`${i} ${n}`:i;return o?(0,r.h)("div",{id:e,class:"label",style:a},(0,r.h)("span",null,l)):null}}const ns=new E.Z("label-ui");class LabelLayer extends r.Component{constructor(e){super(e),this.subscriptions=[],this.reusableVector=new Xn.Vector3,this.inFloorPlan=e=>e===y.BD.FLOORPLAN,this.onCameraUpdate=()=>{this.inFloorPlan(this.props.viewmode)&&this.updateLabelPositions()},this.onViewTransitionStart=()=>{this.setState({inModeTransition:!0})},this.onViewTransitionEnd=async e=>{this.inFloorPlan((0,y.ty)(e.toMode))&&(this.setState({inModeTransition:!1}),this.updateLabelPositions())},this.updateFloorState=()=>{this.setState({currentFloorId:this.floorsViewData.currentFloorId,topMostFloorId:this.floorsViewData.topFloorId})},this.updateLabelPositions=async()=>{const e={};for(const t of this.labelData.getCollection()){this.reusableVector.set(t.position.x,t.position.y,t.position.z);const i=await this.context.commandBinder.issueCommand(new Qn.b({worldPosition:this.reusableVector}));e[t.sid]=Object.assign({screenPosition:i},t)}this.setState({labelPositions:e})},this.clearVisibleFloor=()=>{this.setState({currentFloorId:null})},this.updateVisibleFloor=e=>{this.setState({currentFloorId:e.floorId})},this.setState({labelPositions:{},currentFloorId:null,topMostFloorId:null,inModeTransition:!1})}async componentDidMount(){const e=this.context.messageBus;try{this.floorsViewData=await this.context.market.waitForData(v.c);const e=this.floorsViewData.onChanged(this.updateFloorState);this.subscriptions.push(e),this.updateFloorState(),this.labelData=await this.context.market.waitForData(Yn.D)}catch(e){ns.debug(e)}this.updateLabelPositions();const t=await this.context.market.waitForData($n.M_);this.subscriptions.push(t.onChanged(this.onCameraUpdate),e.subscribe(ts.S,this.clearVisibleFloor),e.subscribe(is.P,this.updateVisibleFloor),e.subscribe(es.Z,this.onViewTransitionStart),e.subscribe(Jn.Z,this.onViewTransitionEnd)),this.subscriptions.forEach((e=>e.renew()))}componentWillUnmount(){this.subscriptions.forEach((e=>e.cancel()))}renderLabel(e){const{currentFloorId:t,topMostFloorId:i,labelPositions:n}=this.state,{floorId:s,screenPosition:o,text:a,visible:l,sid:c,rotation:h}=n[e];return(0,r.h)(RoomLabel,{key:c,position:o,rotation:h,text:a,visible:(!t&&i===s||t===s)&&l,sid:c})}render(){const{inModeTransition:e,labelPositions:t}=this.state,{viewmode:i}=this.props;if(!this.inFloorPlan(i)||e)return null;const n=[];return Object.keys(t).forEach((e=>{n.push(this.renderLabel(e))})),(0,r.h)("div",{class:"overlay-layer labels-layer"},n)}}var ss=i(42835),rs=i(38321),os=i(32025),as=i(65049),ls=i(62679),cs=i(96168),hs=i(85004),ds=i(75352);function us(e,t,i,n){let s=e,r=t;if(i&&s>i){const e=i/s;s*=e,r&&(r*=e)}if(r&&n&&r>n){const e=n/r;s*=e,r*=e}return{width:s,height:r}}class OEmbedTextComponent extends r.Component{constructor(e){super(e)}render(){const{cover:e,data:t,onClick:i}=this.props,n=a("oembed","oembed-text",{"oembed-text--cover":e}),s=t.provider_name?`${t.provider_name} content`:"Embedded content",o=t.author_name?`from ${t.author_name}`:"";return(0,r.h)("div",{class:n,onClick:i},t.title&&(0,r.h)("h3",null,t.title),(0,r.h)("p",null,`${s} ${o}`))}}const ps=["soundcloud","spotify"];class OEmbedThumbnailComponent extends r.Component{constructor(e){super(e)}getAttributes(){const{data:e}=this.props;let t=e.thumbnail_url,i=e.thumbnail_width,n=e.thumbnail_height;return(!t||!i||!n)&&e.type===ds.ht.PHOTO&&(t=e.url,i=e.width,n=e.height),{url:t,width:i,height:n}}renderIcon(){const{data:e,disabled:t}=this.props;return t||!function(e){const t=(e.provider_name||"").toLowerCase();return e.type===ds.ht.VIDEO?"giphy"!==t:!(e.type!==ds.ht.RICH||!ps.includes(t))}(e)?null:(0,r.h)(T.h,{className:"oembed-thumbnail__cta",iconClass:"icon-play-unicode"})}render(){const{cover:e,maxHeight:t,maxWidth:i,disabled:n,onClick:s}=this.props,{url:o,width:a,height:c}=this.getAttributes();if(!o||!a||!c)return(0,r.h)(OEmbedTextComponent,Object.assign({},this.props));const h=function(e,t){return e<128||t<128}(a,c),d=l()("oembed","oembed-thumbnail",{"oembed-thumbnail--cover":e,"oembed-thumbnail--cover--icon":e&&h}),u={backgroundImage:`url('${o}')`};if(!e){const{width:e,height:n}=us(a,c,i,t);u.width=`${e}px`,u.height=`${n}px`}return e&&h&&(u.maxWidth=1.5*a+"px"),(0,r.h)("div",{class:d,style:u,onClick:n?void 0:s},this.renderIcon())}}class OEmbedPhotoComponent extends r.Component{constructor(e){super(e)}render(){const{data:e,cover:t,maxWidth:i,maxHeight:n,onClick:s}=this.props,o=a("oembed","oembed-photo",{"oembed-photo--cover":t});if(t){const t={backgroundImage:`url('${e.url}')`};return(0,r.h)("div",{class:o,style:t,onClick:s})}if(!i&&!n)return(0,r.h)("img",{class:o,src:e.url,onClick:s});const{width:l,height:c}=us(e.width,e.height,i,n);return(0,r.h)("img",{class:o,src:e.url,onClick:s,width:l,height:c})}}const ms={flickr:!0,instagram:!0},gs="oembed-iframe--loading",fs=/^<iframe.*>.*<\/iframe>$/;function vs(e,t,i,n){const{html:s}=e;let r;var o,a;o=s,r=fs.test(o)?function(e){const t=document.createElement("div");return t.innerHTML=e,t.firstChild}(s):function(e){const t=document.createElement("iframe");return t.setAttribute("allow","encrypted-media; autoplay; fullscreen"),t.srcdoc=`<!doctype html>${e}`,t}(s),r.src||void 0!==(a=e.provider_name)&&ms[a.toLowerCase()]?r.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-presentation"):r.setAttribute("sandbox","allow-same-origin"),r.classList.add("oembed-iframe",gs),r.onload=t;const{width:l,height:c}=us(e.width,e.height,i,n);return r.width=`${l}`,c&&(r.height=`${c}`),r}const ys=new E.Z("oembed-video");class OEmbedVideoComponent extends r.Component{constructor(e){super(e),this.saveRef=e=>{this.ref=e,this.iframe||this.createEmbed()},this.createEmbed=()=>{if(!this.ref)return;const{data:e,maxWidth:t,maxHeight:i}=this.props;this.iframe=vs(e,this.onIFrameLoad,t,i),this.ref.innerHTML="",this.ref.appendChild(this.iframe)},this.onIFrameLoad=async()=>{if(this.iframe){this.iframe.classList.remove(gs);try{this.player=await function(e){const t=new Ui.Player(e);return new Promise(((e,i)=>{t.on("ready",(()=>{e(t)}))}))}(this.iframe),(0,w.tq)()||this.player.play()}catch(e){ys.warn("unable to autoplay video"),ys.warn(e)}}}}componentDidUpdate(e){e.data.html!==this.props.data.html&&this.iframe&&(this.iframe.remove(),delete this.iframe,this.createEmbed())}render(){const{cover:e,loading:t,onClick:i}=this.props;return e?(0,r.h)(OEmbedThumbnailComponent,Object.assign({},this.props)):(0,r.h)("div",{class:"oembed oembed-video",ref:this.saveRef,onClick:i},!this.iframe&&t)}}class OEmbedRichComponent extends r.Component{constructor(e){super(e),this.saveRef=e=>{this.ref=e,this.iframe||this.createEmbed()},this.createEmbed=()=>{if(!this.ref)return;const{data:e,maxWidth:t,maxHeight:i}=this.props;this.iframe=vs(e,this.onIFrameLoad,t,i),this.ref.innerHTML="",this.ref.appendChild(this.iframe)},this.onIFrameLoad=()=>{this.iframe&&(this.props.data.height||(this.stopHeightCheck=function(e,t){let i,n=t;const s=()=>{e(),n*=1.5,i=window.setTimeout(s,n)};return i=window.setTimeout(s,n),()=>window.clearTimeout(i)}(this.checkHeight,100)),this.iframe.classList.remove(gs))},this.checkHeight=()=>{if(!this.iframe)return;const e=function(e){var t;const i=null===(t=e.contentWindow)||void 0===t?void 0:t.document;if(!i)return;const n=i.body,s=i.documentElement;return Math.max(n.scrollHeight,n.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight)}(this.iframe),t=e?`${e}`:"";t&&(this.iframe.height=t)}}componentDidUpdate(e){e.data.html!==this.props.data.html&&this.iframe&&(this.iframe.remove(),delete this.iframe,this.createEmbed())}componentWillUnmount(){this.stopHeightCheck&&this.stopHeightCheck()}render(){const{cover:e,loading:t,onClick:i}=this.props;return e?(0,r.h)(OEmbedThumbnailComponent,Object.assign({},this.props)):(0,r.h)("div",{class:"oembed oembed-rich",ref:this.saveRef,onClick:i},!this.iframe&&t)}}function bs({loading:e}){return e?(0,r.h)("div",{class:"oembed oembed-loading"},e):null}class OEmbedComponent extends r.Component{constructor(e){super(e)}render(){const{cover:e,data:t,maxHeight:i,maxWidth:n,onClick:s,disabled:o,thumbnail:a}=this.props,l=(0,r.h)(bs,{loading:this.props.loading});if(!t)return l;const c={cover:e,onClick:s,maxHeight:i,maxWidth:n};return a?(0,r.h)(OEmbedThumbnailComponent,Object.assign({data:t,disabled:o},c)):t.type===ds.ht.PHOTO?(0,r.h)(OEmbedPhotoComponent,Object.assign({data:t},c)):t.type===ds.ht.VIDEO?(0,r.h)(OEmbedVideoComponent,Object.assign({data:t,loading:l},c)):t.type===ds.ht.RICH?(0,r.h)(OEmbedRichComponent,Object.assign({data:t,loading:l},c)):null}}var Ss=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Es=class EmbeddedMedia extends r.Component{constructor(e){super(e),this.state={}}componentDidMount(){this.getEmbeddedMedia()}componentDidUpdate(e){this.props.attachment.id!==e.attachment.id&&this.getEmbeddedMedia()}async getEmbeddedMedia(){const{attachment:e}=this.props,{commandBinder:t}=this.context,i=await t.issueCommand(new cs.st(e));this.setState({attachmentId:e.id,embed:i})}render(){const{cover:e,thumbnail:t,disabled:i,maxWidth:n,maxHeight:s}=this.props,{embed:o}=this.state,a=o&&this.state.attachmentId===this.props.attachment.id,l=(0,r.h)("div",{class:"gui-spinner-icon"});return(0,r.h)(OEmbedComponent,{data:a?o:void 0,loading:l,thumbnail:t,cover:e,disabled:i,maxWidth:n,maxHeight:s})}};Es=Ss([N.Z],Es);var ws=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ts=class Image extends r.Component{constructor(e){super(e),this.clickImage=e=>{this.props.onClick&&this.props.onClick(e,this.props.id)}}render(){const{className:e,onClick:t,url:i,width:n,height:s,cover:o}=this.props,l={"image-cover":!!o};if(e&&Object.assign(l,{[e]:!0}),o){const e={backgroundImage:i?`url('${i}')`:"none"};return(0,r.h)("div",{class:a("image",l),style:e,onClick:t?this.clickImage:void 0})}{const e={};return n&&(e.width=`${n}px`),s&&(e.height=`${s}px`),(0,r.h)("img",{class:a("image",l),src:i,style:e,onClick:t?this.clickImage:void 0})}}};Ts=ws([N.Z],Ts);var _s=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ms=class UploadedMedia extends r.Component{constructor(e){super(e),this.state={mediaUrl:""}}componentDidMount(){this.loadMedia()}componentDidUpdate(e){e.attachment.id!==this.props.attachment.id&&this.loadMedia()}getImageUrl(){const{attachment:e,cover:t,smartWidth:i,smartHeight:n}=this.props,{mediaUrl:s}=this.state;if(!(0,ls.lV)(e))return null;if(!t||void 0===i||void 0===n||!(0,ls.Uq)(e))return s;const r=-1!==s.indexOf("?");return`${s}${r?"&":"?"}height=${n}&crop=${i}:${n},smart`}async loadMedia(){const{attachment:e,thumbnail:t}=this.props,i=t&&e.thumbnailUrl?e.thumbnailUrl:e.url,n=await i.get();this.setState({mediaUrl:n})}render(){const{attachment:e,cover:t,inline:i}=this.props,{id:n,category:s,filename:o,bytes:l}=e;if(s!==hs.G.UPLOAD)return null;const c=this.getImageUrl();if(c)return(0,r.h)(Ts,{id:n,url:c,cover:t,className:"attachment-view"});{const{mediaUrl:e}=this.state,t="Download",n=l?(0,ls.VV)(l):"";return(0,r.h)("div",{class:a("attachment-view","attachment-other",{inline:i})},!i&&(0,r.h)("div",{class:"icon icon-file"}),(0,r.h)("div",{class:"attachment-label"},(0,r.h)("div",{class:"file-label"},o),n&&!i&&(0,r.h)("div",{class:"size-label"},n)),!i&&e&&(0,r.h)("a",{class:"link download-link","data-balloon":t,"data-balloon-pos":"down",href:e,download:!0},(0,r.h)("span",{class:"icon-download"})))}}};Ms=_s([N.Z],Ms);var xs=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let As=class Attachment extends r.Component{constructor(e){super(e),this.removeAttachment=e=>{const{inline:t,attachment:i}=this.props;e.stopPropagation(),t&&(this.trackEvent("click_remove_attachment"),this.context.commandBinder.issueCommand(new cs.$T(i)))},this.onClick=e=>{this.props.onClick&&this.props.onClick(e,this.props.attachment.id)}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}render(){const{attachment:e,onClick:t,inline:i,hero:n}=this.props,s={clickable:!!t,inline:!!i,hero:!!n};return(0,r.h)("div",{class:l()("attachment",s),onClick:this.onClick},this.renderMedia(),i&&(0,r.h)(T.h,{iconClass:"icon-close",className:"attachment-delete",buttonStyle:T.D.SOCIAL,buttonSize:_.qE.SMALL,tooltipMsg:"Delete",tooltipPosition:M.lZ.DOWN_LEFT,onClick:this.removeAttachment,dataValue:e.id}))}renderMedia(){const{attachment:e,thumbnail:t,inline:i,cover:n,maxWidth:s,maxHeight:o,smartWidth:a,smartHeight:l}=this.props,c={attachment:e,thumbnail:t,cover:n};return e.category===hs.G.UPLOAD?(0,r.h)(Ms,Object.assign({},c,{inline:i,smartWidth:a,smartHeight:l})):(0,r.h)(Es,Object.assign({},c,{disabled:i,maxWidth:s,maxHeight:o}))}};As=xs([N.Z],As);var Os=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ps=class AttachmentCarousel extends r.Component{constructor(e){super(),this.onNext=e=>{const{attachments:t}=this.props,{index:i}=this.state;e.stopPropagation();const n=i+1<t.length?i+1:0;this.trackEvent("notes_viewer_next"),this.setState({index:n})},this.onPrev=e=>{const{attachments:t}=this.props,{index:i}=this.state;e.stopPropagation();const n=i>0?i-1:t.length-1;this.trackEvent("notes_viewer_prev"),this.setState({index:n})},this.state={index:e.startIndex}}componentWillReceiveProps(e){this.setState({index:e.startIndex})}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}render(){const{attachments:e,onClick:t,smartWidth:i,smartHeight:n}=this.props,{index:s}=this.state,o=e[s];if(!o)return null;const a=e.length>1,c=void 0!==i&&void 0!==n;return(0,r.h)("div",{class:"attachment-carousel"},(0,r.h)("div",{class:"attachment-carousel-view"},(0,r.h)(As,{attachment:o,onClick:t,cover:c,smartWidth:i,smartHeight:n,thumbnail:!1})),a&&(0,r.h)(T.h,{className:l()("modal-nav","modal-prev"),iconClass:"icon-dpad-left",onClick:this.onPrev}),a&&(0,r.h)(T.h,{className:l()("modal-nav","modal-next"),iconClass:"icon-dpad-right",onClick:this.onNext}))}};Ps=Os([N.Z],Ps);var Ds=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Cs=class Badge extends r.Component{constructor(e){super(e)}render(){const{iconClass:e,label:t,badgeStyle:i,onClick:n}=this.props;return(0,r.h)("span",{class:a("badge",{clickable:!!n}),style:i,onClick:n},e&&(0,r.h)("span",{class:`icon badge-icon ${e}`}),t&&(0,r.h)("span",{class:"badge-label"},t))}};Cs=Ds([N.Z],Cs);var Is=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ls=class TextBox extends r.Component{constructor(e){super(e),this.editing=!1,this.stopPropagation=e=>e.stopPropagation(),this.onPaste=e=>{if(!e.clipboardData)return;const{maxLength:t}=this.props,i=e.clipboardData.getData("text/plain");let n=i.length;const s=this.textElement.innerText,r=window.getSelection();if(r&&t&&s&&s.length+n>t){const e=t-s.length+r.toString().length;n=Math.min(e,n)}document.execCommand("insertText",!1,i.slice(0,n)),e.preventDefault()},this.onMouseDown=e=>{const{onClick:t,clickToEdit:i}=this.props;(this.editing||i)&&t&&(e.stopPropagation(),t(e),this.editing||this.toggleEditing(!0))},this.onKeyDown=e=>{const{maxLength:t,onKeyDown:i}=this.props;t&&this.textElement&&this.textElement.innerText.length>t?e.preventDefault():i&&i(e)},this.onFocus=e=>{this.context.messageBus.broadcast(new Vt.S(this.textElement,!0)),this.props.onFocus&&this.props.onFocus(e)},this.onBlur=e=>{this.context.messageBus.broadcast(new Vt.S(this.textElement,!1)),this.props.onBlur&&this.props.onBlur(e)},this.setRef=e=>{this.textElement=e}}componentDidMount(){this.replaceTextContent(this.props.text)}componentWillUnmount(){this.textElement&&this.textElement.blur()}componentDidUpdate(e){const{text:t,active:i}=this.props;t===e.text&&i===e.active||this.replaceTextContent(t)}shouldComponentUpdate(){return!1}getTextElement(){return this.textElement}getPlainText(){var e;return(null===(e=this.textElement)||void 0===e?void 0:e.innerText)||""}getMarkdown(){return this.textElement?this.props.textParser.serialize(this.textElement):""}focus(){this.editing&&this.textElement.focus()}toggleEditing(e){this.textElement&&(this.editing!==e&&(this.editing=e,this.textElement.contentEditable=e?"true":"false",e?this.textElement.classList.add("editing"):this.textElement.classList.remove("editing")),e?this.textElement.focus():this.textElement.blur())}replaceTextContent(e){const{textParser:t,onClickAnchor:i,active:n}=this.props;if(!this.textElement)return;for(;this.textElement.firstChild;)this.textElement.removeChild(this.textElement.firstChild);const s=t.deserialize(e,!n,i),r=document.createDocumentFragment();s.forEach((e=>{n&&"A"===e.nodeName&&(e.contentEditable="true"),r.appendChild(e)})),this.textElement.appendChild(r),this.focus()}render(){const{placeholder:e,tabIndex:t,onInput:i}=this.props;return(0,r.h)("div",{ref:this.setRef,class:"text-box-text",role:"textbox",draggable:!1,spellcheck:!0,contentEditable:!1,placeholder:e,onMouseDown:this.onMouseDown,onKeyDown:this.onKeyDown,onKeyUp:this.stopPropagation,onFocus:this.onFocus,onBlur:this.onBlur,onInput:i,onPaste:this.onPaste,tabIndex:t})}};Ls=Is([N.A],Ls);const Rs=Ls;var Ns,ks=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Bs=Ns=class NotePreviewer extends r.Component{constructor(e){super(),this.openAttachment=(e,t)=>{this.trackEvent("notes_preview_click_attachment"),e.stopPropagation(),this.props.onClick(t)},this.onClickNote=e=>{e.stopPropagation(),this.props.onClick()},this.state={noteView:null}}componentDidMount(){this.updateNoteView()}componentDidUpdate(e){e.previewId!==this.props.previewId&&this.updateNoteView()}updateNoteView(){var e;const{previewId:t}=this.props,{toolsData:i}=this.context,n=null===(e=i.getTool(d.w1.NOTES))||void 0===e?void 0:e.manager.dataMap.notesViewData;n&&(this.textParser||(this.textParser=n.getTextParser()),this.setState({noteView:n.getNoteView(t)}))}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderNoteImages(e){const t=e.filter((e=>(0,ls.lV)(e)));return 0===t.length?null:(0,r.h)(Ps,{attachments:t,startIndex:0,onClick:this.openAttachment,smartWidth:318,smartHeight:130})}renderNoteHeader(e,t){var i;const n=e.created,s=this.context.userData.getUserDisplay(e.user.email),o=s.color,a=e.comments.length-1,l=1===a?`${a} reply`:`${a} replies`,c=""===((null===(i=e.comments.get(0))||void 0===i?void 0:i.text)||"")&&!t?"Original content was deleted":n.toLocaleString();return(0,r.h)("header",{class:"note-header"},(0,r.h)(Cs,{label:s.initials,badgeStyle:{color:o,"border-color":o}}),(0,r.h)("div",{class:"note-details"},(0,r.h)("span",{class:"note-user"},s.name),a>0&&(0,r.h)("span",{class:"note-summary-info note-replies"},l),(0,r.h)("div",{class:"note-subheader"},c)))}renderNotePost(e){var t;const i=(null===(t=e.comments.get(0))||void 0===t?void 0:t.text)||"",n=i.length>Ns.MAX_NOTE_LENGTH,s=n||e.comments.length>0,o=n?`${i.substring(0,Ns.MAX_NOTE_LENGTH)}...`:i;return(0,r.h)("div",{class:a("note-post",{"note-summary-info":!o})},o&&(0,r.h)(Rs,{text:o,textParser:this.textParser}),s&&(0,r.h)("div",{class:"link link-more"},"Read more"))}render(){var e;const{noteView:t}=this.state;if(!t)return null;const i=(null===(e=t.comments.get(0))||void 0===e?void 0:e.attachments.values())||[],n=i.length>0;return(0,r.h)("div",{class:a("annotation-preview-contents","note-preview-contents",{"has-image":n}),onClick:this.onClickNote},n&&this.renderNoteImages(i),this.renderNoteHeader(t,n),this.renderNotePost(t))}};Bs.MAX_NOTE_LENGTH=150,Bs=Ns=ks([N.Z],Bs);var Fs=i(74886),Us=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Vs=class TagMedia extends r.Component{constructor(e){super(),this.clickAttachment=(e,t)=>{const{attachments:i,onClick:n}=this.props;0!==i.length&&(e.stopPropagation(),n(e,t))}}getMediaDimensions(e){if(e.category!==hs.G.EXTERNAL)return{};const t=function(e){const{mediaType:t,width:i,height:n}=e;if(i&&n&&t===Fs.DD.IMAGE&&Math.max(i,1)/Math.max(n,1)<1)return 200;return 310}(e),i=function(e){const{mediaType:t,width:i,height:n}=e;if(i&&n&&t===Fs.DD.IMAGE)return Math.max(i,1)/Math.max(n,1)>=1?400:300;return 350}(e),{layerWidth:n,layerHeight:s}=this.props;if(void 0===n||void 0===s)return{maxWidth:i};let r=Math.min(i,.4*n);r=Math.max(r,t);return{maxWidth:r,maxHeight:.7*s,minWidth:t}}renderAttachment(e){const{maxWidth:t,maxHeight:i,minWidth:n}=this.getMediaDimensions(e),s={maxHeight:`${i}px`,maxWidth:`${t}px`,minWidth:`${n}px`};return(0,r.h)("div",{class:"tag-media",style:s},(0,r.h)(As,{attachment:e,onClick:this.clickAttachment,maxWidth:t,maxHeight:i}))}render(){const{attachments:e}=this.props;return 0===e.length?null:1===e.length?this.renderAttachment(e[0]):(0,r.h)("div",{class:"tag-media"},(0,r.h)(Ps,{attachments:e,startIndex:0,onClick:this.clickAttachment,smartWidth:318,smartHeight:130}))}};Vs=Us([N.Z],Vs);var Hs,Gs=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let zs=Hs=class TagPreviewer extends r.Component{constructor(e){super(),this.textParser=new Fi.v({links:!0}),this.openAttachment=(e,t)=>{this.trackEvent("tags_preview_click_attachment"),this.props.onClick(t)},this.onClickTag=e=>{e.stopPropagation(),this.props.onClick()},this.state={tagView:null}}componentDidMount(){this.updateTagView()}componentDidUpdate(e){e.previewId!==this.props.previewId&&this.updateTagView()}updateTagView(){const{previewId:e}=this.props,{toolsData:t}=this.context,i=t.getTool(d.w1.TAGS);if(i){const t=i.manager.dataMap.tagsViewData.getTagView(e);this.setState({tagView:t})}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderWidgetFrame(e){const{widgetFrame:t}=e;return t?(0,r.h)(CustomWidgetFrame,{widget:t}):null}renderTitle(e){const{label:t}=e;return t?(0,r.h)("header",{class:"tag-header"},t):null}renderDescription(e){const{description:t}=e;if(!t)return null;const i=t.length>Hs.MAX_TAG_LENGTH,n=i?`${t.substring(0,Hs.MAX_TAG_LENGTH)}...`:t;return(0,r.h)("div",{class:"tag-description"},n&&(0,r.h)(Rs,{text:n,textParser:this.textParser}),i&&(0,r.h)("div",{class:"link link-more"},"Read more"))}render(){const{tagView:e}=this.state;if(!e)return null;const{layerWidth:t,layerHeight:i}=this.props,n=e.attachments,s=n.length>0;return(0,r.h)("div",{class:a("annotation-preview-contents","tag-preview-contents",{"has-image":s}),onClick:this.onClickTag},(0,r.h)(Vs,{attachments:n,layerWidth:t,layerHeight:i,onClick:this.openAttachment}),this.renderTitle(e),this.renderDescription(e),this.renderWidgetFrame(e))}};zs.MAX_TAG_LENGTH=100,zs=Hs=Gs([N.Z],zs);var Ws=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let js=class AnnotationsLayer extends r.Component{constructor(e){super(),this.bindings=[],this.clickOuterAnnotation=()=>{const{currentPin:e,pinState:t}=this.state;e&&(e.pinType===ss.Er.MATTERTAG?t===ss.tS.SELECTED?this.context.commandBinder.issueCommand(new as.xb):(this.trackEvent("select_tag"),this.context.commandBinder.issueCommand(new rs.Ar(e.id,ss.Er.MATTERTAG))):e.pinType===ss.Er.NOTE&&this.onClickNote())},this.onClickNote=async e=>{const{currentPin:t}=this.state;t&&(this.trackEvent("open_note_preview"),this.clickInnerAnnotationToOpen(t,d.w1.NOTES,e))},this.onClickTag=e=>{const{currentPin:t}=this.state;t&&(this.trackEvent("open_tag_preview"),this.clickInnerAnnotationToOpen(t,d.w1.TAGS,e))},this.onResize=()=>{this.updatePositioning()},this.onScreenPositionChanged=()=>{this.updatePositioning()},this.updateOpenPin=()=>{const{openPin:e,pinState:t}=this.viewData,{currentPin:i}=this.state;if(e&&t===ss.tS.SELECTED){const t=e.id!==(null==i?void 0:i.id);this.setState({currentPin:e}),t&&this.trackEvent("switch_pin_annotation"),this.updatePositioning()}else this.setState({currentPin:null,previewDirection:null})},this.updatePreviewPin=()=>{const{previewPin:e}=this.viewData,{currentPin:t}=this.state;if(e){e.id!==(null==t?void 0:t.id)&&this.trackEvent("preview_pin_annotation"),this.updatePositioning(),this.setState({currentPin:e})}else this.setState({currentPin:null,previewDirection:null})},this.updatePinState=()=>{this.setState({pinState:this.viewData.pinState})},this.updatePositioning=()=>{if(!(this.viewData&&this.layer&&this.preview&&this.state.currentPin))return;const e=this.viewData.screenPosition;if(e){const t=e.x,i=e.y;this.updatePreviewDirection(t,i),this.setState({screenPosition:e,layerWidth:this.layer.offsetWidth,layerHeight:this.layer.offsetHeight})}},this.updatePreviewDirection=(e,t)=>{const{offsetWidth:i,offsetHeight:n}=this.layer,{offsetWidth:s,offsetHeight:r}=this.preview;if(!(i&&n&&s&&r))return;let o=this.state.previewDirection;const a=t<r,l=t>n-r,c=e<s,h=e>i-s;c&&h?o=a?ss.Od.DOWN:ss.Od.UP:c?o=a?ss.Od.DOWN_RIGHT:l?ss.Od.UP_RIGHT:ss.Od.RIGHT:h?o=a?ss.Od.DOWN_LEFT:l?ss.Od.UP_LEFT:ss.Od.LEFT:a&&l?o=h?ss.Od.LEFT:ss.Od.RIGHT:a?o=ss.Od.DOWN:l?o=ss.Od.UP:null===o&&(o=ss.Od.RIGHT),o!==this.state.previewDirection&&this.setState({previewDirection:o})},this.setLayerRef=e=>{this.layer=e,e&&(this.resizeObserver.observe(e),this.updatePositioning())},this.setPreviewRef=e=>{this.preview=e,e&&(this.resizeObserver.observe(e),this.updatePositioning())},this.state={currentPin:null,screenPosition:null,previewDirection:null,pinState:ss.tS.IDLE,layerWidth:0,layerHeight:0},this.resizeObserver=new St(this.onResize)}componentDidMount(){const{market:e}=this.context;e.waitForData(os.B).then((e=>{this.viewData=e,this.bindings.push(e.onOpenPinChanged(this.updateOpenPin),e.onPreviewPinChanged(this.updatePreviewPin),e.onScreenPositionChanged(this.onScreenPositionChanged),e.onPinStateChanged(this.updatePinState)),this.updatePinState()}))}componentWillUnmount(){for(const e of this.bindings)e.cancel();this.resizeObserver&&this.resizeObserver.disconnect()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}async clickInnerAnnotationToOpen(e,t,i){const{activeTool:n}=this.props,{commandBinder:s}=this.context,r=n===t;n&&!r&&await s.issueCommand(new Ge.tT(n,!1)),r||await s.issueCommand(new Ge.tT(t,!0)),await s.issueCommand(new rs.$b(e.id,e.pinType,Te.n.Interpolate,i))}getPreviewPositioning(){const{screenPosition:e,previewDirection:t}=this.state;if(e){let i="",n=e.x;switch(t){case ss.Od.UP:i="translate(-50%, -100%)";break;case ss.Od.DOWN:i="translateX(-50%)";break;case ss.Od.LEFT:i="translate(-100%, -50%)";break;case ss.Od.RIGHT:i="translateY(-50%)";break;case ss.Od.UP_LEFT:n+=50,i="translate(-100%, -100%)";break;case ss.Od.UP_RIGHT:i="translate(-50px, -100%)";break;case ss.Od.DOWN_LEFT:n+=50,i="translate(-100%, 5px)";break;case ss.Od.DOWN_RIGHT:i="translate(-50px, 5px)"}return{top:`${e.y}px`,left:`${n}px`,visibility:null===t?"hidden":"",transform:i}}return{}}render(){const{openModal:e,newTagsEnabled:t,notesEnabled:i}=this.props;if(e)return null;const{currentPin:n,pinState:s,previewDirection:o,layerWidth:l,layerHeight:c}=this.state,h=s===ss.tS.PREVIEWING||s===ss.tS.SELECTED,d=h&&t&&n&&n.pinType===ss.Er.MATTERTAG,u=h&&i&&n&&n.pinType===ss.Er.NOTE;return(0,r.h)("div",{ref:this.setLayerRef,class:"annotations-preview-layer"},n&&(d||u)&&(0,r.h)("div",{ref:this.setPreviewRef,class:a("annotation-preview",`annotation-preview-${o}`,{"tag-preview":!!d,"note-preview":!!u}),style:this.getPreviewPositioning(),onClick:this.clickOuterAnnotation},d&&(0,r.h)(zs,{previewId:n.id,onClick:this.onClickTag,layerWidth:l,layerHeight:c}),u&&(0,r.h)(Bs,{previewId:n.id,onClick:this.onClickNote})))}};js=Ws([N.Z],js);var Ks=i(28470),qs=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Zs=class AttachmentViewer extends r.Component{constructor(){super(),this.bindings=[],this.onKey=async e=>{const{attachments:t,attachmentIndex:i}=this.state,n=t.length;let s=-1;switch(e.keyCode){case Ut.R.ESCAPE:this.closeAttachmentViewer();break;case Ut.R.LEFTARROW:s=i-1,s<0&&(s=n-1);break;case Ut.R.RIGHTARROW:s=i+1,s>=n&&(s=0)}-1!==s&&this.setState({attachmentIndex:s}),e.stopPropagation()},this.closeAttachmentViewer=()=>{this.state.open&&this.context.commandBinder.issueCommand(new cs.xW(!1))},this.onModalToggled=e=>{e.modal!==le.P.ATTACHMENT||e.open||this.closeAttachmentViewer()},this.onViewerClosed=()=>{this.state.open&&(document.removeEventListener("keydown",this.onKey,{capture:!0}),this.context.commandBinder.issueCommand(new ce.Bz(le.P.ATTACHMENT,!1)),this.setState({open:!1}))},this.onViewAttachments=e=>{const{attachments:t,attachmentId:i}=e,n=t.findIndex((e=>e.id===i));t.length>0&&-1!==n&&(this.state.open||(document.addEventListener("keydown",this.onKey,{capture:!0}),this.context.commandBinder.issueCommand(new ce.Bz(le.P.ATTACHMENT,!0)),this.setState({open:!0})),this.setState({attachments:t,attachmentIndex:n}))},this.state={open:!1,attachmentIndex:-1,attachments:[]}}componentDidMount(){const{messageBus:e}=this.context;this.bindings.push(e.subscribe(Ks.O,this.onViewAttachments),e.subscribe(Ks.Rd,this.onViewerClosed),e.subscribe(ze.nV,this.onModalToggled))}componentWillUnmount(){for(const e of this.bindings)e.cancel();document.removeEventListener("keydown",this.onKey,{capture:!0})}render(){const{open:e,attachments:t,attachmentIndex:i}=this.state;return(0,r.h)("div",{class:a("overlay-layer","attachment-overlay",{open:e})},e&&(0,r.h)("div",{class:"overlay-close"},(0,r.h)(T.h,{iconClass:"icon-close",buttonStyle:T.D.OVERLAY,tooltipMsg:"Close",tooltipPosition:M.lZ.DOWN,onClick:this.closeAttachmentViewer})),e&&(0,r.h)(Ps,{attachments:t,startIndex:i}))}};Zs=qs([N.Z],Zs);var Ys=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let $s=class LoadIndicator extends r.Component{constructor(e){super(e)}render(){const{showing:e}=this.props;return(0,r.h)(Se,{open:e,className:l()("load-indicator",{"fade-in":e,"fade-out":!e})},(0,r.h)("div",{class:"center-container"},(0,r.h)(Zn,{progress:33,barWidth:4,progressColor:"#ffffff"})))}};$s=Ys([N.Z],$s);const Qs=$s;class FloorNameLayer extends r.Component{constructor(){super(),this.bindings=[],this.clearFloors=async()=>{await this.context.commandBinder.issueCommand(new re.Vw(null,!1))},this.updateState=()=>{const{floorsViewData:e}=this;this.setState({active:e.showFloorSelection&&this.appData.phase===h.nh.PLAYING,floorName:e.currentFloorId?e.getFloorName(e.currentFloorId):this.state.floorName})},this.state={active:!1,floorName:void 0}}componentDidMount(){const e=this.context.market;Promise.all([e.waitForData(v.c),e.waitForData(h.pu)]).then((e=>{[this.floorsViewData,this.appData]=e,this.updateState(),this.bindings.push(this.floorsViewData.makeFloorChangeSubscription(this.updateState),this.floorsViewData.onShowFloorSelectionChanged(this.updateState),this.appData.onPropertyChanged("phase",this.updateState))}))}componentWillUnmount(){this.bindings.forEach((e=>e.cancel())),this.bindings.length=0}render(){const{floorName:e,active:t}=this.state;if(!this.floorsViewData||!this.appData||this.appData.phase!==h.nh.PLAYING)return null;const i=a("floor-container",{"faded-out":!t});return(0,r.h)("div",{class:i},(0,r.h)("div",{class:"floor-title"},(0,r.h)("div",{class:"h4"},e||"")),(0,r.h)(T.h,{iconClass:"icon-close",buttonStyle:T.D.CLEAR,buttonSize:_.qE.STANDARD,tooltipPosition:M.lZ.DOWN_RIGHT,onClick:this.clearFloors}))}}var Xs=i(91302);class OverlayUi extends r.Component{constructor(e){super(e),this.propertiesToRefreshUi=[Mi.r,Ve.Mp,_i.Nj,x.gx.Labels,oe.Q5,_i.Mr,oe.gu],this.bindings=[],this.inTransition=!1,this.newTagsEnabled=!1,this.notesEnabled=!1,this.onLoadSpinnerMessage=e=>{this.setState({loadSpinnerOn:e.isOpen})},this.onLoadSpinnerSuppressMessage=e=>{this.setState({loadSpinnerSuppress:e.suppress})},this.refreshVisibility=()=>{const e=this.context.settings;this.setState({floorNameOn:e.tryGetProperty(oe.gu,!0),labelsOn:e.tryGetProperty(_i.Nj,!1)&&e.tryGetProperty(x.gx.Labels,!1)&&!e.tryGetProperty(_i.Mr,!1)&&!this.inTransition,mattertagsOn:e.tryGetProperty(Mi.r,!1),notesOn:e.tryGetProperty(Ve.Mp,!1),roomBasedNav:e.tryGetProperty(oe.Q5,!1)})},this.state={floorNameOn:!1,mattertagsOn:!1,labelsOn:!1,notesOn:!1,loadSpinnerOn:!1,loadSpinnerSuppress:!1,roomBasedNav:!1}}componentDidMount(){for(const e of this.propertiesToRefreshUi)this.context.settings.onPropertyChanged(e,this.refreshVisibility);const e=()=>{this.inTransition=!0},t=()=>{this.inTransition=!1,this.refreshVisibility()};this.bindings.push(this.context.messageBus.subscribe(es.Z,e),this.context.messageBus.subscribe(Jn.Z,t),this.context.messageBus.subscribe(ts.S,e),this.context.messageBus.subscribe(is.P,t),this.context.messageBus.subscribe(ze.Z_,this.onLoadSpinnerMessage),this.context.messageBus.subscribe(ze.bN,this.onLoadSpinnerSuppressMessage),this.context.messageBus.subscribe(Xs.oR,(()=>this.setState({loadSpinnerSuppress:!0}))),this.context.messageBus.subscribe(Xs.NR,(()=>this.setState({loadSpinnerSuppress:!1})))),this.refreshVisibility(),this.newTagsEnabled=this.context.settings.tryGetProperty(xi.R,!1),this.notesEnabled=this.context.settings.tryGetProperty(Ve.IA,!1)}componentWillUnmount(){for(const e of this.propertiesToRefreshUi)this.context.settings.removeOnPropertyChanged(e,this.refreshVisibility);this.bindings.forEach((e=>e.cancel())),this.bindings.length=0}render(){const{floorNameOn:e,labelsOn:t,mattertagsOn:i,notesOn:n,roomBasedNav:s,loadSpinnerOn:o,loadSpinnerSuppress:a}=this.state,{mobile:l,viewmode:c,openModal:h,activeTool:d,tourPlaying:u}=this.props,p=o&&!a,m=i&&this.newTagsEnabled,g=n&&this.notesEnabled,f=g||m;return(0,r.h)("div",{class:"overlay-ui"},f&&(0,r.h)(Zs,null),f&&(0,r.h)(js,{notesEnabled:g,newTagsEnabled:m,openModal:h,activeTool:d}),i&&!this.newTagsEnabled&&(0,r.h)(Tags,{tourPlaying:u,toolOpen:!1,mobile:l,allowTagOverlay:!0}),t&&(0,r.h)(LabelLayer,{viewmode:c}),s&&e&&(0,r.h)(FloorNameLayer,null),(0,r.h)(Qs,{showing:p}))}}var Js=i(3184),er=i(7677);const tr={"en-US":"./terms/terms-en-US.html",es:"./terms/terms-es-MX.html",fr:"./terms/terms-fr-FR.html",de:"./terms/terms-de-DE.html",ru:"./terms/terms-ru-RU.html",ja:"./terms/terms-ja-JP.html","zh-CN":"./terms/terms-zh-CN.html","zh-TW":"./terms/terms-zh-TW.html",ko:"./terms/terms-ko-KR.html",nl:"./terms/terms-nl-NL.html",it:"./terms/terms-it-IT.html",pt:"./terms/terms-pt-BR.html"};class Terms extends r.Component{constructor(){super(),this.onScrollPositionChange=()=>{this.scrollbars&&this.setState({scrollClass:this.scrollbars.scrollPosition.vertical})},this.onClose=()=>{this.setState({showing:!1}),this.context.commandBinder.issueCommand(new ce.Bz(le.P.TERMS,!1))},this.stopPropagation=e=>{e.stopPropagation()},this.state={termsText:"",showing:!1,scrollClass:K.None}}async componentDidMount(){const e=function(e){if((0,er.y)(e)&&e in tr)return tr[e]}(this.context.locale?this.context.locale.languageCode:Js.k$);let t="";try{t=await this.context.queue.get(e)}catch(e){t=this.context.locale.t(m.Z.TERMS_FAIL)}window.requestAnimationFrame((()=>{this.setState({showing:!0,termsText:t})}))}componentDidUpdate(e){this.state.termsText!==e.termsText&&(this.termsTextDiv.innerHTML=this.state.termsText,[].slice.call(this.termsTextDiv.querySelectorAll("a")).forEach((e=>{e.setAttribute("target","_blank"),e.classList.add("link")})))}render(){const{showing:e,scrollClass:t}=this.state;return(0,r.h)("div",{class:a("modal","terms-modal",{"faded-in":e,[t]:!0}),onClick:this.stopPropagation},(0,r.h)("div",{id:"terms-wrapper"},(0,r.h)(Scrollbars,{name:"terms",ref:e=>this.scrollbars=e,onScrollPositionChange:this.onScrollPositionChange,forceHidden:fe(window)},(0,r.h)("div",{ref:e=>this.termsTextDiv=e,id:"terms-text"}))),(0,r.h)(te.P,{buttonStyle:te.A.LIGHT,onClose:this.onClose}))}}var ir=i(7855),nr=i(42472),sr=i(40285),rr=i(1630),or=i(36704);const ar=new E.Z("webvr");class WebVRUtility{constructor(e,t,i){this.vrDisplay=e,this.commandBinder=t,this.onEvent=i,this.startWebVR=()=>{if(this.vrDisplay&&this.vrDisplay.capabilities.canPresent&&!this.vrDisplay.isPresenting){this.onEvent("vr_enter_app"),this.commandBinder.issueCommand(new or.w);const e=document.createElement("canvas");for(e.getContext("webgl"),e.className="webvr-canvas",document.bgColor="#000",document.body.style.backgroundColor="#000";document.body.firstChild;)document.body.removeChild(document.body.firstChild);document.body.appendChild(e),this.vrDisplay.requestPresent([{source:e}]).then((()=>{window.addEventListener("vrdisplaypresentchange",this.onExitWebVr)})).catch((e=>{ar.error("requestPresent Failed:",e),this.onEvent("vr_present_error")})),window.dispatchEvent(new Event("vrapp-start"))}else ar.error("vrDisplay not found, or already presenting"),this.onEvent("vr_present_error")},this.onExitWebVr=()=>{if(!this.vrDisplay.isPresenting){this.onEvent("vr_exit_app"),window.removeEventListener("vrdisplaypresentchange",this.onExitWebVr);let e=window.location.href;-1===window.location.search.indexOf("&qs=1")&&(e+="&qs=1"),ar.info("redirecting to:",e),window.location.replace(e)}},t.issueCommand(new or.s)}}var lr=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const cr=new E.Z("vr-select");let hr=class VrModal extends r.Component{constructor(e){super(e),this.webVRUtility=null,this.stopPropagation=e=>{e.stopPropagation()},this.renderHeadsetHeader=()=>{const{locale:e}=this.context,{vrPlatform:t}=this.state;switch(t){case ir.bk.webvr:return(0,r.h)("div",{class:"headset-header"},(0,r.h)("img",{class:"headset-cardboard",src:i(7560),width:230,height:190}));case ir.bk.unsupported:case ir.bk.webxr:return(0,r.h)("div",{class:"headset-header dark"},(0,r.h)("span",{class:"headset-titles"},(0,r.h)("h2",null,e.t(m.Z.VR_RECOMMENDED)),(0,r.h)("h1",null,e.t(m.Z.VR_QUEST))),(0,r.h)("img",{class:"headset-quest",src:i(49529),height:200,width:342}));default:return null}},this.renderBodyText=()=>{const{locale:e}=this.context,{vrPlatform:t}=this.state;switch(t){case ir.bk.webvr:return(0,r.h)("div",null,(0,r.h)("p",null,e.t(m.Z.VR_APP_INSTRUCT)),(0,r.h)("p",null,e.t(m.Z.VR_APP_RECCOMMENDED)));case ir.bk.unsupported:case ir.bk.webxr:return(0,r.h)("div",null,(0,r.h)("p",null,e.t(m.Z.VR_SUPPORTS)));default:return null}},this.getFooterButtons=()=>{const{locale:e}=this.context,{vrPlatform:t}=this.state,i=[];i.push((0,r.h)(_.zx,{buttonStyle:_.ZJ.OUTLINE,className:l()("button-inline","cancel"),onClick:this.onLearnMoreClicked},e.t(m.Z.VR_LEARN_MORE_CAPS)));return(t===ir.bk.webvr||t===ir.bk.webxr)&&i.push((0,r.h)(_.zx,{buttonState:_.BN.ENABLED,className:l()("button-inline","confirm"),onClick:this.onActionClicked},e.t(m.Z.VR_ENTER))),i},this.closeModal=()=>{this.context.commandBinder.issueCommand(new ce.Bz(le.P.VR_SELECT,!1))},this.onCloseClicked=()=>{this.trackEvent("vr_modal_close"),this.closeModal()},this.onActionClicked=()=>{switch(this.state.vrPlatform){case ir.bk.webvr:this.webVRUtility&&(this.webVRUtility.startWebVR(),this.closeModal());break;case ir.bk.webxr:this.startWebXR(),this.closeModal()}},this.onLearnMoreClicked=()=>{window.open("https://support.matterport.com/hc/en-us/articles/360050098973-Exploring-Matterport-Spaces-in-VR-","_blank"),this.trackEvent("vr_learn_more")},this.startWebXR=()=>{this.context.commandBinder.issueCommand(new rr.j({type:"immersive-vr",features:["local-floor"]})).then((e=>{if(e){this.trackEvent("vr_enter_app");const t=()=>{this.trackEvent("vr_exit_app"),e.removeEventListener("end",t)};e.addEventListener("end",t)}else cr.error("requestPresent Failed"),this.trackEvent("vr_present_error"),this.updatePlatformState()})).catch((e=>{cr.error("requestPresent Failed:",e);const t=e?{message:e.message||"",name:e.name||""}:void 0;this.trackEvent("vr_present_error",t)}))},this.state={vrPlatform:null}}async componentDidMount(){nr.Z.apiExists()&&navigator.xr.addEventListener("ondevicechange",this.updatePlatformState),await this.updatePlatformState(),this.trackEvent("click_vr_button")}componentWillUnmount(){nr.Z.apiExists()&&navigator.xr.removeEventListener("ondevicechange",this.updatePlatformState)}render(){const{isMobile:e}=this.props,{vrPlatform:t}=this.state,{locale:i}=this.context,n=l()("vr-modal","modal","full-modal",{mobile:e,desktop:!e}),s=t===ir.bk.webvr,o=l()("modal-footer",{cardboard:s});return(0,r.h)("dialog",{class:n,onClick:this.stopPropagation},(0,r.h)("header",{class:"modal-header"},(0,r.h)("div",{class:"modal-title"},i.t(m.Z.VR_VIEW_SPACE)),(0,r.h)(te.P,{onClose:this.onCloseClicked})),this.renderHeadsetHeader(),(0,r.h)("div",{class:"modal-body"},this.renderBodyText()),(0,r.h)("div",{class:o},this.getFooterButtons()))}async updatePlatformState(){const e=await(0,ir.pl)();switch(e){case ir.bk.webvr:const e=await sr.H();e&&!this.webVRUtility&&(this.webVRUtility=new WebVRUtility(e,this.context.commandBinder,this.trackEvent.bind(this)))}this.setState({vrPlatform:e}),cr.debug(this.state)}trackEvent(e,t){let i={gui_action:e,orientation:(0,w.mI)()?"landscape":"portrait",vr_platform:this.state.vrPlatform};i=Object.assign(i,t),this.context.analytics.track("showcase_gui",i)}};hr=lr([N.Z],hr);const dr=hr;class CtaSmall extends r.Component{render(){const{isMobile:e}=this.props,{locale:t}=this.context;return(0,r.h)("div",{class:"cta"},(0,r.h)("h1",{class:a({mobile:e})},t.t(e?m.Z.MOBILE_SHORT_CTA:m.Z.DESKTOP_SHORT_CTA)))}}const ur={mouse:{click:i(41891),clickInside:i(70626),dragLeft:i(73993),dragRight:i(26668),play:i(31891),positionLeft:i(82906),positionRight:i(64991),zoom:i(12136)},gesture:{drag:i(72145),dragTwoFinger:i(12742),pinch:i(5435),position:i(67649),positionTwoFinger:i(2433),tap:i(24367),tapInside:i(90619),play:i(94874)},keyboard:{all:i(76064),inside:i(64549),leftRight:i(81202),spaceBar:i(71002),upDown:i(42135),zoom:i(26407)},moreHelp:{view360:i(86533),mattertag:i(14653)}},{HELP:pr}=m.Z.SHOWCASE;class CtaDesktop extends r.Component{constructor(){super(...arguments),this.keys={header:m.Z.DESKTOP_SHORT_CTA,move:m.Z.MOVE,inside:m.Z.INSIDE,rotate:m.Z.ROTATE,play:m.Z.PLAY,zoom:m.Z.ZOOM},this.clickInside={Icon:ur.mouse.clickInside,Label:this.keys.inside,FooterIcon:ur.keyboard.inside,Alt:pr.ALT_MOUSE_CLICKINSIDE,FooterAlt:pr.ALT_KEYBOARD_INSIDE},this.clickMove={Icon:ur.mouse.positionRight,Label:this.keys.move,FooterIcon:"",Alt:pr.ALT_MOUSE_POSITIONRIGHT},this.moveUpDown={Icon:ur.mouse.click,Label:this.keys.move,FooterIcon:ur.keyboard.upDown,Alt:pr.ALT_MOUSE_CLICK,FooterAlt:pr.ALT_KEYBOARD_UPDOWN},this.play={Icon:ur.mouse.play,Label:this.keys.play,FooterIcon:null,Alt:pr.ALT_MOUSE_PLAY},this.zoom={Icon:ur.mouse.zoom,Label:this.keys.zoom,FooterIcon:ur.keyboard.zoom,Alt:pr.ALT_MOUSE_ZOOM,FooterAlt:pr.ALT_KEYBOARD_ZOOM},this.dragMove={Icon:ur.mouse.positionLeft,Label:this.keys.move,FooterIcon:null,Alt:pr.ALT_MOUSE_POSITIONLEFT},this.dragRotateLeft={Icon:ur.mouse.dragLeft,Label:this.keys.rotate,FooterIcon:ur.keyboard.leftRight,Alt:pr.ALT_MOUSE_DRAGLEFT,FooterAlt:pr.ALT_KEYBOARD_LEFTRIGHT},this.dragRotateRight={Icon:ur.mouse.dragRight,Label:this.keys.rotate,FooterIcon:ur.keyboard.leftRight,Alt:pr.ALT_MOUSE_DRAGRIGHT,FooterAlt:pr.ALT_KEYBOARD_LEFTRIGHT},this.left=this.clickInside,this.center=this.clickMove,this.right=this.play}render(){const{viewmode:e}=this.props,{locale:t}=this.context;return this.configureViewmodeSpecifics(e),(0,r.h)("div",{class:a({cta:!0})},(0,r.h)("h1",null,t.t(this.keys.header)),(0,r.h)("h2",null,t.t(this.left.Label)),(0,r.h)("img",{src:this.left.Icon,alt:this.left.Alt}),this.left.FooterIcon?(0,r.h)("hr",null):(0,r.h)("span",null),this.left.FooterIcon?(0,r.h)("img",{class:"footer-icon",src:this.left.FooterIcon,alt:this.left.FooterAlt}):(0,r.h)("span",null),(0,r.h)("h2",null,t.t(this.center.Label)),(0,r.h)("img",{src:this.center.Icon,alt:this.center.Alt}),this.center.FooterIcon?(0,r.h)("hr",null):(0,r.h)("span",null),this.center.FooterIcon?(0,r.h)("img",{class:"footer-icon",src:this.center.FooterIcon,alt:this.center.FooterAlt}):(0,r.h)("span",null),(0,r.h)("h2",null,t.t(this.right.Label)),(0,r.h)("img",{src:this.right.Icon,alt:this.right.Alt}),this.right.FooterIcon?(0,r.h)("hr",null):(0,r.h)("span",null),this.right.FooterIcon?(0,r.h)("img",{class:"footer-icon",src:this.right.FooterIcon,alt:this.right.FooterAlt}):(0,r.h)("span",null))}configureViewmodeSpecifics(e){switch(e){case y.BD.INSIDE:this.left=this.dragRotateLeft,this.center=this.moveUpDown,this.right=this.props.isHelpCta?this.zoom:this.play;break;case y.BD.OUTSIDE:case y.BD.DOLLHOUSE:this.left=this.dragRotateLeft,this.center=this.clickMove,this.right=this.clickInside;break;case y.BD.FLOORPLAN:this.left=this.dragMove,this.center=this.dragRotateRight,this.right=this.clickInside}}}const{HELP:mr}=m.Z.SHOWCASE;class CtaMobile extends r.Component{constructor(){super(...arguments),this.keys={shortCta:m.Z.MOBILE_SHORT_CTA,move:m.Z.MOVE,inside:m.Z.INSIDE,rotate:m.Z.ROTATE,play:m.Z.PLAY,zoom:m.Z.ZOOM},this.clickInside={Icon:ur.gesture.tapInside,Label:this.keys.inside,Alt:mr.ALT_GESTURE_TAPINSIDE},this.clickMove={Icon:ur.gesture.tap,Label:this.keys.move,Alt:mr.ALT_GESTURE_TAP},this.dragRotate={Icon:ur.gesture.drag,Label:this.keys.rotate,Alt:mr.ALT_GESTURE_DRAG},this.dragMove={Icon:ur.gesture.position,Label:this.keys.move,Alt:mr.ALT_GESTURE_POSITION},this.play={Icon:ur.gesture.play,Label:this.keys.play,Alt:mr.ALT_GESTURE_PLAY},this.zoom={Icon:ur.gesture.pinch,Label:this.keys.zoom,Alt:mr.ALT_GESTURE_PINCH},this.left=this.dragRotate,this.center=this.clickInside,this.right=this.play}render(){const e=a({mobile:!0}),{viewmode:t}=this.props,{locale:i}=this.context;return this.configureViewmodeSpecifics(t),(0,r.h)("div",{class:a({cta:!0,mobile:!0})},(0,r.h)("h1",{class:e},i.t(this.keys.shortCta)),(0,r.h)("h2",{class:e},i.t(this.left.Label)),(0,r.h)("img",{src:this.left.Icon}),(0,r.h)("h2",{class:e},i.t(this.center.Label)),(0,r.h)("img",{src:this.center.Icon}),(0,r.h)("h2",{class:e},i.t(this.right.Label)),(0,r.h)("img",{src:this.right.Icon}))}configureViewmodeSpecifics(e){switch(e){case y.BD.INSIDE:this.left=this.dragRotate,this.center=this.clickMove,this.right=this.props.isHelpCta?this.zoom:this.play;break;case y.BD.DOLLHOUSE:case y.BD.OUTSIDE:this.left=this.dragRotate,this.center=this.clickInside,this.right=this.props.isHelpCta?this.zoom:this.play;break;case y.BD.FLOORPLAN:this.left=this.dragMove,this.center=this.clickInside,this.right=this.props.isHelpCta?this.zoom:this.play}}}var gr=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const fr=new E.Z("cta");var vr,yr;!function(e){e[e.NONE=0]="NONE",e[e.LARGE=1]="LARGE",e[e.SMALL=2]="SMALL"}(vr||(vr={})),function(e){e[e.HELP=0]="HELP",e[e.TOUR=1]="TOUR"}(yr||(yr={}));let br=class Cta extends r.Component{constructor(e){super(e),this.styles=[vr.NONE],this.bindings=[],this.handleInteraction=()=>{this.props.showCta&&(this.setState({seenCta:!0}),this.context.commandBinder.issueCommand(new ce.Bz(le.P.CTA,!1)))},this.onTourStopped=()=>{this.state.ctaSource!==yr.TOUR||this.state.seenCta||(this.setState({seenCta:!0}),this.context.commandBinder.issueCommand(new ce.Bz(le.P.CTA,!0)))},this.onTourStarted=()=>{this.state.ctaSource===yr.HELP&&2===this.styles.length&&this.setState({ctaSource:yr.TOUR,seenCta:!1,style:this.styles[1]}),this.props.showCta&&this.context.commandBinder.issueCommand(new ce.Bz(le.P.CTA,!1))},this.state={ctaSource:yr.TOUR,seenCta:!1,style:this.styles[0]}}componentDidMount(){const{canvas:e}=this.props,{messageBus:t,settings:i}=this.context;try{e&&(e.addEventListener("mousedown",this.handleInteraction),e.addEventListener("pointerdown",this.handleInteraction),e.addEventListener("touchstart",this.handleInteraction)),this.bindings.push(t.subscribe(Xs.NR,this.onTourStopped),t.subscribe(Xs.Mt,this.onTourStopped),t.subscribe(Xs.oR,this.onTourStarted))}catch(e){fr.debug(e)}let n=this.state.ctaSource;const s=parseInt(i.tryGetProperty("tourcta",1),10);!isNaN(s)&&s in vr&&(this.styles[0]=s,n=yr.TOUR);const r=i.tryGetProperty("help",0);!isNaN(r)&&r in vr&&r!==vr.NONE&&(this.styles[0]===vr.NONE?this.styles[0]=r:this.styles.unshift(r),n=yr.HELP),this.styles[0]!==vr.NONE&&this.setState({style:this.styles[0],ctaSource:n})}componentWillUnmount(){const{canvas:e}=this.props;e&&(e.removeEventListener("mousedown",this.handleInteraction),e.removeEventListener("pointerdown",this.handleInteraction),e.removeEventListener("touchstart",this.handleInteraction)),this.bindings.forEach((e=>e.cancel()))}renderCtaStyle(){const{isMobile:e,viewmode:t}=this.props,{style:i,ctaSource:n}=this.state;switch(i){case vr.NONE:return null;case vr.SMALL:return(0,r.h)(CtaSmall,{isMobile:e});case vr.LARGE:return e?(0,r.h)(CtaMobile,{isMobile:e,viewmode:t,isHelpCta:n===yr.HELP}):(0,r.h)(CtaDesktop,{viewmode:t,isHelpCta:n===yr.HELP})}}render(){const{showCta:e,isMobile:t}=this.props,{style:i,ctaSource:n}=this.state,s={ctaContainer:!0,mobile:t,showMessage:e,small:i===vr.SMALL,helpCta:n===yr.HELP};return(0,r.h)("div",{id:"cta-container",class:a(s)},this.renderCtaStyle())}};br=gr([N.Z],br);const Sr=br;var Er,wr,Tr,_r,Mr,xr;!function(e){e[e.navigation=0]="navigation",e[e.moreHelp=1]="moreHelp"}(Er||(Er={})),function(e){e.left="left",e.middle="middle",e.right="right"}(wr||(wr={})),function(e){e.topInfo="topInfo",e.bigImage="bigImage",e.bottomInfo="bottomInfo",e.keyboard="keyboard"}(Tr||(Tr={})),function(e){e.desktop="desktop",e.mobile="mobile"}(_r||(_r={})),function(e){e.hlr="hlr",e.dollhouse="dollhouse",e.floors="floors",e.mattertag="mattertag",e.floorplan="floorplan",e.tour="tour",e.inside="inside",e.vr="vr",e.view360="view360",e.fullscreen="fullscreen"}(Mr||(Mr={})),function(e){e.landscape="landscape",e.portrait="portrait"}(xr||(xr={}));const{HELP:Ar}=m.Z.SHOWCASE,Or={[_r.desktop]:{[wr.left]:{[Tr.topInfo]:"HELP_DESKTOP_PANORAMA_1A",[Tr.bottomInfo]:"HELP_DESKTOP_PANORAMA_1B",[Tr.bigImage]:{img:ur.mouse.dragLeft,alt:Ar.ALT_MOUSE_DRAGLEFT},[Tr.keyboard]:{img:ur.keyboard.leftRight,alt:Ar.ALT_KEYBOARD_LEFTRIGHT}},[wr.middle]:{[Tr.topInfo]:"HELP_DESKTOP_PANORAMA_2A",[Tr.bottomInfo]:"HELP_DESKTOP_PANORAMA_2B",[Tr.bigImage]:{img:ur.mouse.click,alt:Ar.ALT_MOUSE_CLICK},[Tr.keyboard]:{img:ur.keyboard.upDown,alt:Ar.ALT_KEYBOARD_UPDOWN}},[wr.right]:{[Tr.topInfo]:"HELP_DESKTOP_PANORAMA_3A",[Tr.bottomInfo]:"HELP_DESKTOP_PANORAMA_3B",[Tr.bigImage]:{img:ur.mouse.zoom,alt:Ar.ALT_MOUSE_ZOOM},[Tr.keyboard]:{img:ur.keyboard.zoom,alt:Ar.ALT_KEYBOARD_ZOOM}}},[_r.mobile]:{[wr.left]:{[Tr.topInfo]:"HELP_MOBILE_PANORAMA_1",[Tr.bigImage]:{img:ur.gesture.drag,alt:Ar.ALT_GESTURE_DRAG}},[wr.middle]:{[Tr.topInfo]:"HELP_MOBILE_PANORAMA_2",[Tr.bigImage]:{img:ur.gesture.tap,alt:Ar.ALT_GESTURE_TAP}},[wr.right]:{[Tr.topInfo]:"HELP_MOBILE_3",[Tr.bigImage]:{img:ur.gesture.pinch,alt:Ar.ALT_GESTURE_PINCH}}}},Pr={[_r.desktop]:{[wr.left]:{[Tr.topInfo]:"HELP_DESKTOP_DOLLHOUSE_1A",[Tr.bottomInfo]:"HELP_DESKTOP_DOLLHOUSE_1B",[Tr.bigImage]:{img:ur.mouse.dragLeft,alt:Ar.ALT_MOUSE_DRAGLEFT},[Tr.keyboard]:{img:ur.keyboard.all,alt:Ar.ALT_KEYBOARD_ALL}},[wr.middle]:{[Tr.topInfo]:"HELP_DESKTOP_DOLLHOUSE_2A",[Tr.bigImage]:{img:ur.mouse.positionRight,alt:Ar.ALT_MOUSE_POSITIONRIGHT}},[wr.right]:{[Tr.topInfo]:"HELP_DESKTOP_DOLLHOUSE_3A",[Tr.bigImage]:{img:ur.mouse.zoom,alt:Ar.ALT_MOUSE_ZOOM}}},[_r.mobile]:{[wr.left]:{[Tr.topInfo]:"HELP_MOBILE_DOLLHOUSE_1",[Tr.bigImage]:{img:ur.gesture.drag,alt:Ar.ALT_GESTURE_DRAG}},[wr.middle]:{[Tr.topInfo]:"HELP_MOBILE_DOLLHOUSE_2",[Tr.bigImage]:{img:ur.gesture.positionTwoFinger,alt:Ar.ALT_GESTURE_POSITIONTWOFINGER}},[wr.right]:{[Tr.topInfo]:"HELP_MOBILE_3",[Tr.bigImage]:{img:ur.gesture.pinch,alt:Ar.ALT_GESTURE_PINCH}}}},Dr={[_r.desktop]:{[wr.left]:{[Tr.topInfo]:"HELP_DESKTOP_FLOORPLAN_1A",[Tr.bigImage]:{img:ur.mouse.positionLeft,alt:Ar.ALT_MOUSE_POSITIONLEFT}},[wr.middle]:{[Tr.topInfo]:"HELP_DESKTOP_FLOORPLAN_2A",[Tr.bottomInfo]:"HELP_DESKTOP_FLOORPLAN_2B",[Tr.bigImage]:{img:ur.mouse.dragRight,alt:Ar.ALT_MOUSE_DRAGRIGHT},[Tr.keyboard]:{img:ur.keyboard.leftRight,alt:Ar.ALT_KEYBOARD_LEFTRIGHT}},[wr.right]:{[Tr.topInfo]:"HELP_DESKTOP_FLOORPLAN_3A",[Tr.bottomInfo]:"HELP_DESKTOP_FLOORPLAN_3B",[Tr.bigImage]:{img:ur.mouse.zoom,alt:Ar.ALT_MOUSE_ZOOM},[Tr.keyboard]:{img:ur.keyboard.upDown,alt:Ar.ALT_KEYBOARD_UPDOWN}}},[_r.mobile]:{[wr.left]:{[Tr.topInfo]:"HELP_MOBILE_FLOORPLAN_1",[Tr.bigImage]:{img:ur.gesture.position,alt:Ar.ALT_GESTURE_POSITION}},[wr.middle]:{[Tr.topInfo]:"HELP_MOBILE_FLOORPLAN_2",[Tr.bigImage]:{img:ur.gesture.dragTwoFinger,alt:Ar.ALT_GESTURE_DRAGTWOFINGER}},[wr.right]:{[Tr.topInfo]:"HELP_MOBILE_3",[Tr.bigImage]:{img:ur.gesture.pinch,alt:Ar.ALT_GESTURE_PINCH}}}},Cr=JSON.parse(JSON.stringify(Or));Cr.desktop.middle={[Tr.topInfo]:"HELP_DESKTOP_360_2A",[Tr.bottomInfo]:"HELP_DESKTOP_360_2B",[Tr.bigImage]:{img:ur.mouse.clickInside,alt:Ar.ALT_MOUSE_CLICKINSIDE},[Tr.keyboard]:{img:ur.keyboard.inside,alt:Ar.ALT_KEYBOARD_INSIDE}},Cr.mobile.middle={[Tr.topInfo]:"HELP_MOBILE_360_2",[Tr.bigImage]:{img:ur.gesture.tapInside,alt:Ar.ALT_GESTURE_TAPINSIDE}};const Ir={INSIDE:Or,OUTSIDE:Cr,FLOORPLAN:Dr,DOLLHOUSE:Pr};var Lr=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Rr=class NavigationTab extends r.Component{constructor(e){super(e),this.state={overflow:!1}}componentWillReceiveProps(e){(this.navigationDiv&&this.navigationDiv.clientHeight||0)/(this.navigationDiv.parentElement&&this.navigationDiv.parentElement.clientHeight||1)>.7&&this.setState({overflow:!0})}getAssetObj(e){switch(e){case this.props.Modes.DOLLHOUSE:return Ir.DOLLHOUSE[this.props.device];case this.props.Modes.FLOORPLAN:return Ir.FLOORPLAN[this.props.device];case this.props.Modes.OUTSIDE:return Ir.OUTSIDE[this.props.device];case this.props.Modes.INSIDE:default:return Ir.INSIDE[this.props.device]}}buildRows(){const e=this.getAssetObj(this.props.viewmode),t=[];for(const i in Tr){const n=[],s=[];for(const t in wr)if(n.push(this.wrapAsset(e,t,i,!1)),i===Tr.bigImage){const i=!e[t][Tr.bottomInfo];s.push((0,r.h)("div",{class:a(t,"column",{noDivider:i})},(0,r.h)("hr",null)))}t.push((0,r.h)("div",{class:a(i,"row")},n))}return t}buildMobilePortrait(){const e=this.getAssetObj(this.props.viewmode),t=[];for(const i in e)for(const n in e[i])t.push(this.wrapAsset(e,i,n,!0));return t}wrapAsset(e,t,i,n){const s=e[t][i],o=i===Tr.bigImage||i===Tr.keyboard,l=s?s.img:void 0,c=s&&s.alt?this.context.locale.t(s.alt):void 0,h=(0,r.h)("img",{src:l,alt:c});return(0,r.h)("div",{class:n?a(i,"row"):a(t,"column")},s&&o?h:s&&this.context.locale.t(s))}render(){const e=this.props.device===_r.mobile&&this.props.orientation===X.i5.PORTRAIT,t=a({navigation:!0,small:this.state.overflow,[this.props.viewmode]:!0});return(0,r.h)("div",{class:t,ref:e=>{this.navigationDiv=e}},e?(0,r.h)(Scrollbars,{name:"navigation",forceHidden:!1},(0,r.h)("div",{class:"nav-wrapper"},this.buildMobilePortrait())):this.buildRows())}};Rr=Lr([N.Z],Rr);const Nr=Rr,kr={[Mr.hlr]:{[Tr.topInfo]:"HELP_MORE_HLR_A",[Tr.bigImage]:"icon-hlr",[Tr.bottomInfo]:"HELP_DESKTOP_MORE_HLR_B"},[Mr.dollhouse]:{[Tr.topInfo]:"HELP_MORE_DOLLHOUSE_A",[Tr.bigImage]:"icon-dollhouse",[Tr.bottomInfo]:"HELP_MOBILE_MORE_DOLLHOUSE_B"},[Mr.floors]:{[Tr.topInfo]:"HELP_MORE_FLOORS_A",[Tr.bigImage]:"icon-floor-controls",[Tr.bottomInfo]:"HELP_DESKTOP_MORE_FLOORS_B"},[Mr.mattertag]:{[Tr.topInfo]:"HELP_MORE_MATTERTAG_A",[Tr.bigImage]:ur.moreHelp.mattertag,[Tr.bottomInfo]:"HELP_MOBILE_MORE_MATTERTAG_B"},[Mr.tour]:{[Tr.topInfo]:"HELP_MORE_TOUR_A",[Tr.bigImage]:"icon-play",[Tr.bottomInfo]:"HELP_DESKTOP_MORE_TOUR_B"},[Mr.inside]:{[Tr.topInfo]:"HELP_MORE_INSIDE_A",[Tr.bigImage]:"icon-panorama",[Tr.bottomInfo]:"HELP_MOBILE_MORE_INSIDE_B"},[Mr.vr]:{[Tr.topInfo]:"HELP_MORE_VR_A",[Tr.bigImage]:"icon-vr",[Tr.bottomInfo]:"HELP_MOBILE_MORE_VR_B"},[Mr.view360]:{[Tr.topInfo]:"HELP_MORE_360_A",[Tr.bigImage]:ur.moreHelp.view360,[Tr.bottomInfo]:"HELP_MOBILE_MORE_360_B"},[Mr.floorplan]:{[Tr.topInfo]:"HELP_MORE_FLOORPLAN_A",[Tr.bigImage]:"icon-floorplan",[Tr.bottomInfo]:"HELP_MOBILE_FLOORPLAN_B"}},Br=JSON.parse(JSON.stringify(kr));Br[Mr.fullscreen]={[Tr.topInfo]:"HELP_MORE_FULLSCREEN_A",[Tr.bigImage]:"icon-fullscreen",[Tr.bottomInfo]:"HELP_DESKTOP_MORE_FULLSCREEN_B"},Br[Mr.dollhouse][Tr.bottomInfo]="HELP_DESKTOP_MORE_DOLLHOUSE_B",Br[Mr.mattertag][Tr.bottomInfo]="HELP_DESKTOP_MORE_MATTERTAG_B",Br[Mr.inside][Tr.bottomInfo]="HELP_DESKTOP_MORE_INSIDE_B",Br[Mr.vr][Tr.bottomInfo]="HELP_DESKTOP_MORE_VR_B",Br[Mr.view360][Tr.bottomInfo]="HELP_DESKTOP_MORE_360_B",Br[Mr.floorplan][Tr.bottomInfo]="HELP_DESKTOP_FLOORPLAN_B";const Fr={[_r.desktop]:Br,[_r.mobile]:kr},Ur=[Tr.topInfo,Tr.bigImage,Tr.bottomInfo];class MoreHelpTab extends r.Component{constructor(e){super(e)}componentDidMount(){this.scrollbars.scrollTo({x:0,y:0})}buildInstructions(){const e=[],t=this.props.device===_r.desktop?5:this.props.orientation===X.i5.LANDSCAPE?3:2,i=Object.keys(Fr[this.props.device]);for(let n=0;n<i.length;n+=t){for(const s of Ur){const o=[];for(let e=0;e<t;e++){if(n+e>=i.length)continue;const t=Fr[this.props.device][i[n+e]][s],l=a(s,i[n+e],{noAsset:!t});switch(s){case Tr.topInfo:o.push((0,r.h)("div",{class:l},this.context.locale.t(t)));break;case Tr.bigImage:o.push((0,r.h)("div",{class:l},t.indexOf(".png")>-1?(0,r.h)("img",{src:t}):(0,r.h)("span",{class:t},"floors"===i[n+e]?(0,r.h)("span",null,"2"):null)));break;case Tr.bottomInfo:o.push((0,r.h)("div",{class:l},this.context.locale.t(t)))}}e.push((0,r.h)("div",{class:a("innerRow",s)},o))}e.push((0,r.h)("div",{class:"rowPadding"}))}return e.pop(),e}render(){return(0,r.h)("div",{class:a("more-help-wrapper",this.props.device)},(0,r.h)(Scrollbars,{name:"more-help-wrapper",ref:e=>this.scrollbars=e,forceHidden:!1},(0,r.h)("div",{class:a("more-help")},this.buildInstructions())))}}var Vr=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Hr=class Help extends r.Component{constructor(e){super(e),this.setOrientation=e=>{const{orientation:t}=e;this.setState({orientation:t})},this.handleTabClick=e=>()=>{this.setState({tab:e})},this.closeHelp=()=>{this.setState({showing:!1}),this.context.commandBinder.issueCommand(new ce.Bz(le.P.HELP,!1))},this.stopPropagation=e=>{e.stopPropagation()},this.device=this.props.isMobile?_r.mobile:_r.desktop,this.state={showing:!1,tab:Er.navigation,orientation:(0,X.T8)().orientation},this.orientationSubscription=(0,X.kp)(X.g_.ORIENTATION_CHANGED,this.setOrientation)}componentDidMount(){this.orientationSubscription.renew(),window.requestAnimationFrame((()=>{this.setState({showing:!0})}))}componentWillUnmount(){this.orientationSubscription.cancel()}render(){const{showing:e,tab:t,orientation:i}=this.state;return(0,r.h)("div",{id:"help-modal",class:a(this.device,{"faded-in":e}),onClick:this.stopPropagation},(0,r.h)("div",{class:a("tabs",t)},(0,r.h)("div",{class:a("navigation-tab",{active:t===Er.navigation}),onClick:this.handleTabClick(Er.navigation)},(0,r.h)("span",null,this.context.locale.t(m.Z.HELP_NAVIGATION_TAB))),(0,r.h)("div",{class:a("more-help-tab",{active:t===Er.moreHelp}),onClick:this.handleTabClick(Er.moreHelp)},(0,r.h)("span",null,this.context.locale.t(m.Z.HELP_MORE_HELP_TAB)))),t===Er.navigation&&(0,r.h)(Nr,{device:this.device,Modes:this.props.allModes,viewmode:this.props.viewmode,orientation:i}),t===Er.moreHelp&&(0,r.h)(MoreHelpTab,{device:this.device,orientation:i}),(0,r.h)(te.P,{buttonStyle:te.A.LIGHT,onClose:this.closeHelp}))}};Hr=Vr([N.Z],Hr);const Gr=Hr;class MattertagEmbLink extends r.Component{constructor(){super(),this.closeIframe=()=>{this.context.commandBinder.issueCommand(new ce.Bz(le.P.MATTERTAG_EMBED,!1)),this.setState({url:"",isIframeOpen:!1})},this.setIFrameOpen=e=>{e.embed&&(this.context.commandBinder.issueCommand(new ce.Bz(le.P.MATTERTAG_EMBED,!0)),this.setState({isIframeOpen:!0,url:e.url}))}}componentDidMount(){this.context.messageBus.subscribe(Pi.Ik,this.setIFrameOpen)}componentWillUnmount(){this.context.messageBus.unsubscribe(Pi.Ik,this.setIFrameOpen)}render(){return this.state.url?(0,r.h)("div",{class:"mattertag-emb-link"},(0,r.h)("iframe",{id:"mattertag-emb-iframe",name:"mattertagEmb",sandbox:"allow-forms allow-scripts allow-same-origin allow-presentation"}),(0,r.h)(te.P,{buttonStyle:te.A.SHADOW,onClose:this.closeIframe})):null}}var zr,Wr=i(8445),jr=i(73272),Kr=i(75892),qr=i(65006);!function(e){e.MAIL="mail",e.PINTEREST="pinterest",e.LINKEDIN="linkedin",e.TWITTER="twitter",e.FACEBOOK="facebook",e.COPYLINK="copylink",e.NATIVE="native"}(zr||(zr={}));const{FACEBOOK:Zr,TWITTER:Yr,MAIL:$r,PINTEREST:Qr,LINKEDIN:Xr,COPYLINK:Jr,NATIVE:eo}=zr,to={[$r]:"em",[Qr]:"pn",[Xr]:"ln",[Yr]:"tw",[Zr]:"fb",[Jr]:"cp",[eo]:"os"},io={[Zr]:{width:626,height:436},[Yr]:{width:550,height:440},[Qr]:{width:750,height:749},[Xr]:{width:550,height:453},[Jr]:{},[$r]:{},[eo]:{}},no=async(e,t=!0)=>{let i={};if(t){const[t,n,s,r]=await Promise.all([e.engine.market.waitForData(Kr.Z),e.engine.market.waitForData(f.O),e.engine.market.waitForData(v.c),e.engine.market.waitForData($n.M_)]);i=jr.K.serialize({cameraData:r,viewmodeData:n,floorsViewData:s,sweepData:t})}else i=jr.K.removeNavigationKeys(w.AO());const n=["ref","gclid","fbclid","cloudEdit","back","note","comment","apiHost","applicationKey","host","sdkKey"];Object.keys(i).forEach((e=>{(n.includes(e)||0===e.indexOf("utm_"))&&delete i[e]}));const s=Object.keys(i).map((e=>e+"="+i[e])).join("&");let r=null;return e.settings.hasProperty("apiHost")&&(r=(0,qr.KK)(e.settings.getProperty("apiHost"))),!r&&(0,qr.KK)(window.location.origin)&&(r=window.location.origin),r||(r="https://my.matterport.com"),`${r}/show/?${s}`},so=e=>Object.keys(e).map((t=>t+"="+encodeURIComponent(e[t]))).join("&"),ro=(e,t,i)=>{const n=e.replace("?",`?ref=${to[Zr]}&`);return`http://www.facebook.com/sharer.php?${so({display:"popup",u:n})}`},oo=(e,t,i)=>{const n=e.replace("?",`?ref=${to[Yr]}&`),s={text:i.t(m.Z.SHARED_MESSAGE_HASHTAG,{title:t,url:n,hashtag:"#Matterport"})};return`http://twitter.com/intent/tweet?${so(s)}`},ao=(e,t,i)=>{const n=e.replace("?",`?ref=${to[$r]}&`),s={subject:i.t(m.Z.SHARED_TITLE,{title:t}),body:i.t(m.Z.SHARED_MESSAGE,{title:t,url:n})};return`mailto:?${so(s)}`},lo=(e,t,i,n)=>{const s={url:e.replace("?",`?ref=${to[Qr]}&`),media:i,description:n.t(m.Z.SHARED_TITLE,{title:t})};return`http://pinterest.com/pin/create/link/?${so(s)}`},co=(e,t,i)=>{const n=e.replace("?",`?ref=${to[Xr]}&`);return`https://www.linkedin.com/shareArticle?${so({mini:"true",url:n})}`},ho=(e,t,i,n)=>({[Zr]:ro(e),[Yr]:oo(e,t,n),[$r]:ao(e,t,n),[Qr]:lo(e,t,i,n),[Xr]:co(e),[Jr]:e,[eo]:e}),uo=new E.Z("share-modal");class ShareModal extends r.Component{constructor(){super(),this.copyURL=()=>{const{deeplink:e}=this.state;this.urlInputRef.select(),document.execCommand("copy"),window.getSelection().removeAllRanges(),this.urlInputRef.blur(),this.setState({copied:!0}),this.context.analytics.track("showcase_share_action",{channel:zr.COPYLINK,pano_id:this.sweepData.currentSweep,deeplink:e}),window.setTimeout((()=>{this.setState({copied:!1})}),2500)},this.toggleDeeplinks=()=>{const{deeplink:e}=this.state;this.setState({deeplink:!e})},this.close=()=>{this.context.commandBinder.issueCommand(new ce.Bz(le.P.SHARE,!1))},this.openShareWindow=e=>{const{urls:t,deeplink:i,deeplinkUrls:n}=this.state,{width:s,height:r}=io[e],o=i?n[e]:t[e];let a;if(s&&r){a="top="+(window.screenY+(window.innerHeight-r)/2)+",left="+(window.screenX+(window.innerWidth-s)/2)+",width="+s+",height="+r}this.context.analytics.track("showcase_share_action",{channel:e,pano_id:this.sweepData.currentSweep,deeplink:i}),window.open(o,"",a)},this.openWebShareApi=e=>{if(!navigator.share)return;const{excerpt:t,title:i,urls:n,deeplinkUrls:s}=this.state,r={url:e?s[zr.COPYLINK]:n[zr.COPYLINK],text:t,title:i};uo.debug("Launching Web Share API",r),navigator.share(r),this.context.analytics.track("showcase_share_action",{channel:zr.NATIVE,pano_id:this.sweepData.currentSweep,deeplink:e})},this.onWebShareClick=()=>{this.openWebShareApi(!1)},this.onWebShareDeeplinkClick=()=>{this.openWebShareApi(!0)},this.stopPropagation=e=>e.stopPropagation(),this.setUrlInputRef=e=>{this.urlInputRef=e},this.state={urls:{},deeplinkUrls:{},title:"",excerpt:"",image:"",copied:!1,deeplink:!1,webShareEnabled:(0,w.J1)()},this.openFacebook=this.openShareWindow.bind(this,zr.FACEBOOK),this.openTwitter=this.openShareWindow.bind(this,zr.TWITTER),this.openPinterest=this.openShareWindow.bind(this,zr.PINTEREST),this.openLinkedIn=this.openShareWindow.bind(this,zr.LINKEDIN),this.openEmail=this.openShareWindow.bind(this,zr.MAIL)}async componentDidMount(){const{market:e}=this.context,[t,i]=await Promise.all([e.waitForData(Wr.T),e.waitForData(Kr.Z)]);this.sweepData=i;const n=t.model,s=`${window.location.origin}/api/v1/player/models/${n.sid}/thumb`,r=n.details.name;this.setState({title:r,image:s},this.updateUrls)}async updateUrls(){const{title:e,image:t}=this.state,[i,n]=await Promise.all([no(this.context,!1),no(this.context,!0)]),s=ho(i,e,t,this.context.locale),r=ho(n,e,t,this.context.locale);uo.debug("Social Share URLs:",s),uo.debug("Social Share URLs, with current location",r),this.setState({urls:s,deeplinkUrls:r})}renderWebShareDialog(){return(0,r.h)("div",{class:"share-controls"},(0,r.h)(_.zx,{className:"share-modal-button",buttonStyle:_.ZJ.PRIMARY,onClick:this.onWebShareDeeplinkClick},this.context.locale.t(m.Z.SHARE_CURRENT_LOCATION)),(0,r.h)(_.zx,{className:"share-modal-button",buttonStyle:_.ZJ.OUTLINE,onClick:this.onWebShareClick},this.context.locale.t(m.Z.SHARE_DEFAULT_LOCATION)))}renderShareDialog(){const{copied:e,deeplink:t,urls:i,deeplinkUrls:n}=this.state,s=t?n[zr.COPYLINK]:i[zr.COPYLINK],o=this.sweepData&&this.sweepData.isSweepDisabled(),a=o?this.context.locale.t(m.Z.SHARE_ERROR_SWEEP_DISABLED):void 0;return(0,r.h)("div",{class:"share-controls"},(0,r.h)("div",{class:"social-icons"},(0,r.h)(T.h,{onClick:this.openFacebook,iconClass:"icon-facebook",buttonStyle:T.D.SOCIAL,buttonSize:_.qE.LARGE}),(0,r.h)(T.h,{onClick:this.openTwitter,iconClass:"icon-twitter",buttonStyle:T.D.SOCIAL,buttonSize:_.qE.LARGE}),(0,r.h)(T.h,{onClick:this.openLinkedIn,iconClass:"icon-linkedin",buttonStyle:T.D.SOCIAL,buttonSize:_.qE.LARGE}),(0,r.h)(T.h,{onClick:this.openPinterest,iconClass:"icon-pinterest",buttonStyle:T.D.SOCIAL,buttonSize:_.qE.LARGE}),(0,r.h)(T.h,{onClick:this.openEmail,iconClass:"icon-email",buttonStyle:T.D.SOCIAL,buttonSize:_.qE.LARGE})),(0,r.h)("div",{class:"input-group"},(0,r.h)("input",{class:"input",type:"text",value:s||"",ref:this.setUrlInputRef,onKeyDown:this.stopPropagation,onKeyPress:this.stopPropagation,onKeyUp:this.stopPropagation,readOnly:!0}),(0,r.h)(M.oO,{content:e?this.context.locale.t(m.Z.SHARE_COPIED):this.context.locale.t(m.Z.COPY_URL),position:M.lZ.UP,tooltipTimeout:2e3},(0,r.h)("button",{class:"input-addon",onClick:this.copyURL},this.context.locale.t(m.Z.COPY)))),(0,r.h)(Bt,{dataValue:"deeplink",key:"deeplink",checked:t,enabled:!o,error:o,helpText:a,label:this.context.locale.t(m.Z.SHARE_LINK_TO_LOCATION),onChange:this.toggleDeeplinks}))}render(){const{webShareEnabled:e}=this.state,t=l()("modal","share-modal","modal-dialog",{"share-dialog":!e,"web-share-dialog":e}),i=e?this.renderWebShareDialog():this.renderShareDialog();return(0,r.h)("dialog",{open:!0,class:t,onClick:this.stopPropagation},(0,r.h)("header",{class:"modal-header"},(0,r.h)("div",{class:"modal-title"},this.context.locale.t(m.Z.SHARE_MODAL_TITLE)),(0,r.h)(te.P,{onClose:this.close})),(0,r.h)("div",{class:"modal-body"},i))}}class MeasurementModeHelp extends r.Component{constructor(e,t){super(e),this.closeModal=()=>{this.context.commandBinder.issueCommand(new ce.Bz(le.P.MEASUREMENT_HELP,!1))},this.stopPropagation=e=>{e.stopPropagation()},this.locale={headerString:t.locale.t(m.Z.MEASUREMENT_MODE),subHeaderString:t.locale.t(m.Z.MEASUREMENT_HELP_MODAL_SUB_HEADER),body1String:t.locale.t(m.Z.MEASUREMENT_HELP_MODAL_BODY_1),body2String:t.locale.t(m.Z.MEASUREMENT_HELP_MODAL_BODY_2)}}render(){const{headerString:e,subHeaderString:t,body1String:i,body2String:n}=this.locale,{mobile:s}=this.props;return(0,r.h)("div",{class:a("modal","full-modal","measurement-mode-help-modal",{mobile:s}),onClick:this.stopPropagation},(0,r.h)("header",{class:"modal-header"},(0,r.h)("div",{class:"modal-title"},e),(0,r.h)(te.P,{onClose:this.closeModal})),(0,r.h)("div",{class:"modal-subheader"},t),(0,r.h)("div",{class:"modal-body"},(0,r.h)("p",{class:"modal-paragraph"},i),(0,r.h)("p",{class:"modal-paragraph"},n)))}}class NotesIntro extends r.Component{constructor(){super(...arguments),this.onClose=()=>{this.context.commandBinder.issueCommand(new ce.Bz(le.P.NOTES_INTRO,!1))},this.stopPropagation=e=>{e.stopPropagation()}}componentDidMount(){this.context.settings.setLocalStorageProperty(He.F.NotesIntroModalSeen,!0)}getModalCopy(){return"You can now add Notes in the space.             Each Note is a conversation thread             where collaborators with edit access             can comment and upload attachments.             Only collaborators you invite can see Notes.             Add a Note and mention someone with             @name to start the conversation."}renderHeader(){return(0,r.h)("div",{class:"notes-intro-header"},(0,r.h)("div",null,"Welcome to the ",(0,r.h)("div",{class:"h4"},"Notes Beta")),(0,r.h)("div",{class:"note-badges"},(0,r.h)(Cs,{badgeStyle:{"background-color":"#E993A7"},iconClass:"icon-comment"}),(0,r.h)(Cs,{badgeStyle:{"background-color":"#6140B0"},iconClass:"icon-comment"}),(0,r.h)(Cs,{badgeStyle:{"background-color":"#385DFF"},iconClass:"icon-comment"})))}render(){return(0,r.h)("dialog",{class:"modal full-modal notes-intro open",onClick:this.stopPropagation,onPointerDown:this.stopPropagation,onPointerUp:this.stopPropagation},(0,r.h)("header",{class:"modal-header"},(0,r.h)("div",{class:"modal-title"},"New feature"),(0,r.h)(te.P,{onClose:this.onClose})),this.renderHeader(),(0,r.h)("div",{class:"modal-body"},(0,r.h)("div",{class:"modal-content"},this.getModalCopy())),(0,r.h)("div",{class:"modal-footer"},(0,r.h)("div",{class:"modal-buttons"},(0,r.h)(_.zx,{buttonSize:_.qE.LARGE,onClick:this.onClose},"Try It"))))}}class Link extends r.Component{render(e,t){const{className:i,href:n,children:s,onClick:o}=e;return(0,r.h)("a",{class:a("link",{className:i}),href:n,target:"_blank",onClick:o},s)}}var po;!function(e){e.ThumbsUp="thumbs-up"}(po||(po={}));const mo=new Map;mo.set(po.ThumbsUp,{alt:"Thumbs Up",json:i(85034),fallback:i(64824)});var go=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let fo=class Lottie extends r.Component{constructor(){super(...arguments),this.isUnmounting=!1,this.loadLottie=async()=>this.lottieLib?this.lottieLib:await i.e(932).then(i.t.bind(i,11248,23)),this.handleRef=e=>{this.lottieTargetElement=e},this.updateAnimation=async()=>{const{animation:e,loop:t=!1}=this.props;let i;try{i=await this.loadLottie()}catch(e){return void this.setState({fallbackActive:!0})}const n=mo.get(e);if(i&&n&&this.lottieTargetElement){const e=i.loadAnimation({loop:t,container:this.lottieTargetElement,renderer:"svg",autoplay:!1,animationData:n.json});e.addEventListener("data_failed",(()=>{this.setState({fallbackActive:!0})})),setTimeout((()=>{this.isUnmounting||e.play()}),50)}},this.renderFallback=()=>{const{animation:e}=this.props,t=mo.get(e);return t?(0,r.h)("img",{className:"lottie-fallback",src:t.fallback,alt:t.alt}):null}}componentDidMount(){this.updateAnimation()}componentWillReceiveProps(e,t){e.animation!==this.props.animation&&this.setState({fallbackActive:!1})}componentDidUpdate(e){e.animation===this.props.animation&&e.loop===this.props.loop||this.updateAnimation()}componentWillUnmount(){this.isUnmounting=!0}render(){return(0,r.h)("div",{className:"lottie"},(0,r.h)("div",{className:"lottie-animation",ref:this.handleRef}),this.state.fallbackActive&&this.renderFallback())}};fo=go([N.Z],fo);const vo=fo,{MODEL_RATING:yo}=m.Z.WORKSHOP;class ModelRatingThankYou extends r.Component{constructor(){super(...arguments),this.onClose=()=>{this.context.commandBinder.issueCommand(new ce.Bz(le.P.RATING_THANK_YOU,!1))},this.stopPropagation=e=>{e.stopPropagation()}}render(){const{locale:e}=this.context;return(0,r.h)("dialog",{className:"modal model-rating-thank-you open",onClick:this.stopPropagation,onPointerDown:this.stopPropagation,onPointerUp:this.stopPropagation},(0,r.h)(te.P,{onClose:this.onClose}),(0,r.h)("h4",null,e.t(yo.THANK_YOU_HEADING)),(0,r.h)(vo,{animation:po.ThumbsUp}),(0,r.h)("p",{className:"p4"},e.t(yo.THANK_YOU_BODY)),(0,r.h)("small",{className:"model-rating-cta"},e.t(yo.THANK_YOU_CTA),"",(0,r.h)(Link,{href:"//matterport.com/resources/support",onClick:this.onClose},e.t(yo.THANK_YOU_CTA_LINK_TEXT))))}}class Modals extends r.Component{constructor(e){super(e),this.closeModal=()=>{this.context.commandBinder.issueCommand(new ce.rE)},this.mobile=(0,w.tq)()}componentDidMount(){this.context.market.waitForData(Wr.T).then((e=>{this.setState({modelDetails:e.model.details})}))}render(){const{openModal:e,viewmode:t,glCanvas:i}=this.props,{modelDetails:n}=this.state,s=e===le.P.SHARE,o=e===le.P.TERMS,a=e===le.P.HELP,c=e===le.P.CTA,h=e===le.P.NOTES_INTRO,d=e===le.P.MEASUREMENT_HELP,u=e===le.P.VR_SELECT,p=e===le.P.RATING_THANK_YOU,m=o||a,g=s||m||d||h||p||u&&!!n;return(0,r.h)("div",{id:"showcase-modals"},(0,r.h)(Se,{className:l()("modal-background",{"modal-background":!0,"dark-modal-background":m,open:g}),open:g,selectChild:!0,childKey:e||void 0,onClick:this.closeModal},(0,r.h)(ShareModal,{key:le.P.SHARE}),(0,r.h)(MeasurementModeHelp,{key:le.P.MEASUREMENT_HELP,mobile:this.mobile}),h&&(0,r.h)(NotesIntro,{key:le.P.NOTES_INTRO}),n&&(0,r.h)(dr,{key:le.P.VR_SELECT,isMobile:this.mobile,modelDetails:n}),o&&(0,r.h)(Terms,{key:le.P.TERMS}),a&&(0,r.h)(Gr,{key:le.P.HELP,isMobile:this.mobile,viewmode:t,allModes:y.BD}),p&&(0,r.h)(ModelRatingThankYou,{key:le.P.RATING_THANK_YOU})),(0,r.h)(Sr,{canvas:i,isMobile:this.mobile,viewmode:t,showCta:c}),(0,r.h)(MattertagEmbLink,null))}}var bo=i(69941),So=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Eo=class Panels extends r.Component{constructor(e){super(e),this.bindings=[],this.onTransitionEnd=()=>{const{currentToolPanel:e}=this.state;this.context.engine.broadcast(new ue.rh(!!e))},this.onToggleCollapse=e=>{this.setState({collapsed:e.collapsed})},this.toggleSidePanel=()=>{const{activeTool:e,toolPanelLayout:t}=this.props;e&&t===d.wS.SIDE_PANEL&&this.context.commandBinder.issueCommand(new Ge.zK(!this.state.collapsed))},this.state={currentToolPanel:e.activeTool,closing:!1,collapsed:!1}}componentDidMount(){this.bindings.push(this.context.engine.subscribe(ue.U7,this.onToggleCollapse))}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(e,t){const{activeTool:i,sidePanelCollapsible:n}=this.props,{toolsData:s}=this.context;e.activeTool&&!i||(e.toolPanelLayout===d.wS.NORMAL||e.toolPanelLayout===d.wS.NARROW)&&!s.isPanelOpen()?(window.clearTimeout(this.panelCloseTimeout),this.panelCloseTimeout=window.setTimeout((()=>{this.setState({currentToolPanel:null,closing:!1})}),500),this.setState({closing:!0})):!e.activeTool&&i?(window.clearTimeout(this.panelCloseTimeout),this.setState({currentToolPanel:i,closing:!1})):this.setState({currentToolPanel:i}),e.sidePanelCollapsible&&!n&&this.state.collapsed&&this.context.commandBinder.issueCommand(new Ge.zK(!1))}renderContent(){const{children:e}=this.props,{currentToolPanel:t}=this.state;if(e&&Array.isArray(e)&&e.length){const i=e.find((e=>e&&e.key===t));if(i)return i}return null}render(){const{sidePanelCollapsible:e,toolPanelLayout:t}=this.props,{closing:i,currentToolPanel:n,collapsed:s}=this.state,o=!!n&&!i,l=t===d.wS.SIDE_PANEL,c={"panel-open":o&&!s,"panel-collapsed":o&&s},h=s?"Expand List":"Collapse List",u=s?"icon-dpad-left":"icon-dpad-right",p=this.renderContent();return(0,r.h)("div",{class:a("panels",c),onTransitionEnd:this.onTransitionEnd},p&&l&&e&&!i&&(0,r.h)("div",{class:"panel-track"},(0,r.h)("div",{class:"panel-track-thumb","data-balloon":h,"data-balloon-pos":"left",onClick:this.toggleSidePanel},(0,r.h)("span",{class:`icon ${u}`}))),p)}};Eo=So([N.Z],Eo);const wo=(()=>{let e=0;return function(t,i){window.clearTimeout(e);const n=t.classList;switch(i){case d.wS.NORMAL:n.remove("narrow-layout"),n.contains("side-panel")?e=window.setTimeout((()=>{n.remove("side-panel")}),600):n.remove("bottom-panel");break;case d.wS.NARROW:n.add("narrow-layout"),n.contains("bottom-panel")?e=window.setTimeout((()=>{n.remove("bottom-panel")}),600):n.remove("side-panel");break;case d.wS.SIDE_PANEL:n.add("side-panel"),n.remove("bottom-panel","narrow-layout");break;case d.wS.BOTTOM_PANEL:n.remove("side-panel"),n.add("narrow-layout","bottom-panel")}}})();var To=i(67799);var _o,Mo=i(15881),xo=i(36169),Ao=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};r.options.debounceRendering=requestAnimationFrame,function(e){e.CENTER="center",e.TOP="top"}(_o||(_o={}));let Oo=class Scroller extends r.Component{constructor(e){super(e),this.usePointerEvents=window.PointerEvent,this.focusedSelector=null,this.listening=!1,this.startY=0,this.onThumb=!1,this.scrollTop=0,this.handleResize=()=>{this.computeStateValues(),this.focusedSelector&&this.scrollToSelector(this.focusedSelector)},this.handleWheelEvent=e=>{this.props.disabled||(this.onThumb=!1,this.focusedSelector=null,this.scrollBy(e.deltaY))},this.handleEvent=e=>{if(this.scroller&&!this.props.disabled){this.scrollVelocityPixelsMS=0;if("mousedown"===e.type||"pointerdown"===e.type||"touchstart"===e.type){const t=e.target;this.onThumb=t&&t.classList.contains("scroller-thumb")}this.focusedSelector=null,this.inputFilter.handleEvent(e)}},this.handlePressStart=e=>{this.onThumb?this.startY=this.getThumbTop():this.startY=this.getScrollTop()},this.handlePressMove=e=>{const{trackHeight:t,contentsHeight:i}=this.state;let n;this.onThumb?(n=(this.startY-e.y)/t,this.scrollToPercent(n)):(n=(e.y+this.startY)/i,this.scrollToPercent(n))},this.handleDragStart=()=>{},this.handleDragEnd=(e,t)=>{this.scrollVelocityPixelsMS=e.y/t,this.lastScrollTimeMS=void 0,Math.abs(this.scrollVelocityPixelsMS)<1?this.scrollVelocityPixelsMS=0:this.animateScroll()},this.onTrackClick=e=>{if(e.target!==this.track)return;const t=this.getThumbHeight(),i=this.getThumbTop(),n=this.track.getBoundingClientRect().top,s=this.state.trackHeight;let r;r=e.clientY<n+i?Math.max(0,(i-t)/s):Math.min(s,(i+t)/s),this.scrollToPercent(r)},this.scrollToPercent=e=>{this.isOverflowing()&&this.scroller&&!isNaN(e)&&this.setScrollPosition(Math.max(Math.min(1,e)*this.state.contentsHeight,0))},this.scrollBy=e=>{this.isOverflowing()&&this.scroller&&!isNaN(e)&&this.setScrollPosition(Math.max(this.scroller.scrollTop+e,0))},this.computeStateValues=()=>{if(this.props.disabled)return;const e=Number(this.scroller&&this.scroller.clientHeight)||1,t=Number(this.track&&this.track.clientHeight)||e,i=Number(this.contents&&this.contents.clientHeight)||1,n=Number(this.contents&&this.contents.offsetTop)||0;this.setState({scrollerHeight:e,contentsHeight:i,trackHeight:t,offsetTop:n})},this.setContentsRef=e=>{e?(this.contents=e,this.resizeObserver.observe(this.contents)):this.contents&&this.resizeObserver.unobserve(this.contents)},this.setScrollerRef=e=>{e&&(this.scroller=e)},this.setTrackRef=e=>{e&&(this.track=e)},this.setThumbRef=e=>{e&&(this.thumb=e)},this.state={scrollerHeight:1,contentsHeight:1,trackHeight:1,offsetTop:0},this.resizeObserver=new St(this.handleResize),this.resizeSubscription=(0,X.kp)(X.g_.RESIZE,this.handleResize),this.inputFilter=new InputFilter({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove,handleDragStart:this.handleDragStart,handleDragEnd:this.handleDragEnd})}componentDidMount(){this.toggleEventHandling(!0),this.computeStateValues()}componentWillUnmount(){this.toggleEventHandling(!1),this.resizeObserver&&this.resizeObserver.disconnect()}componentDidUpdate(e,t){this.scroller&&e.disabled!==this.props.disabled&&(this.props.disabled?this.toggleEventHandling(!1):this.toggleEventHandling(!0))}resetScrollTop(){this.focusedSelector=null,this.setScrollPosition(0)}scrollToElement(e,t=_o.CENTER){if(!(e&&e.compareDocumentPosition(this.scroller)&Node.DOCUMENT_POSITION_CONTAINS))return;if(!this.isOverflowing()||!this.scroller)return;const{contentsHeight:i,scrollerHeight:n,offsetTop:s}=this.state;let r=e.offsetTop,o=e;for(;o.parentElement&&(o=o.parentElement,r+=o.offsetTop,o.offsetParent!==this.contents););let a=s+r;t===_o.CENTER&&(a+=e.offsetHeight/2-n/2),a=Math.max(Math.min(i,a),0);const l=this.scroller.scrollTop,c=a-l;let h=0;const d=e=>{h||(h=e);const t=e-h,i=Math.min(t/500,1);this.scroller.scrollTo(0,l+c*i),t<500?window.requestAnimationFrame(d):this.setScrollPosition(a)};window.requestAnimationFrame(d)}scrollToSelector(e){const t=this.scroller.querySelector(e);t?(this.focusedSelector=e,this.scrollToElement(t)):this.focusedSelector=null}setScrollPosition(e){if(this.scroller){const t=this.scroller.scrollTop;this.scroller.scrollTop=e,this.scrollTop=this.getScrollTop(),this.props.onScrolled&&t!==this.scrollTop&&this.props.onScrolled(),this.thumb&&(this.thumb.style.height=`${this.getThumbHeight()}px`,this.thumb.style.top=`${this.getThumbTop()}px`)}}toggleEventHandling(e){const t=this.handleEvent,i=xo.h?{passive:!0}:void 0;!this.listening&&e?(this.resizeSubscription.renew(),this.scroller.addEventListener("wheel",this.handleWheelEvent,i),this.usePointerEvents?(this.scroller.addEventListener("pointerdown",t,i),window.addEventListener("pointermove",t,i),window.addEventListener("pointerup",t,i)):(this.scroller.addEventListener("touchstart",t,i),this.scroller.addEventListener("mousedown",t,i),window.addEventListener("mousemove",t,i),window.addEventListener("mouseleave",t,i),window.addEventListener("mouseup",t,i),window.addEventListener("touchmove",t,i),window.addEventListener("touchend",t,i),window.addEventListener("touchcancel",t,i))):this.listening&&!e&&(this.resizeSubscription.cancel(),this.scroller.removeEventListener("wheel",this.handleWheelEvent),this.usePointerEvents?(this.scroller.removeEventListener("pointerdown",t),window.removeEventListener("pointermove",t),window.removeEventListener("pointerup",t)):(this.scroller.removeEventListener("touchstart",t),this.scroller.removeEventListener("mousedown",t),window.removeEventListener("mousemove",t),window.removeEventListener("mouseleave",t),window.removeEventListener("mouseup",t),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)))}animateScroll(){window.requestAnimationFrame((e=>{void 0===this.lastScrollTimeMS&&(this.lastScrollTimeMS=e);let t=e-this.lastScrollTimeMS;if(t>0){this.scrollBy(this.scrollVelocityPixelsMS*t);const e=this.scrollVelocityPixelsMS>0?-1:1;for(;t>0;)this.scrollVelocityPixelsMS+=this.scrollVelocityPixelsMS*this.scrollVelocityPixelsMS*.01*e,t-=1}Math.abs(this.scrollVelocityPixelsMS)>.001&&this.animateScroll()}))}getThumbTop(){const{contentsHeight:e,trackHeight:t}=this.state;return Math.min(this.scrollTop/e*t,t-this.getThumbHeight())}getThumbHeight(){const{scrollerHeight:e,contentsHeight:t,trackHeight:i}=this.state;return e/t*i}getScrollTop(){return this.scroller?this.scroller.scrollTop:0}isOverflowing(){const{contentsHeight:e,scrollerHeight:t,offsetTop:i}=this.state;return e+i>t}renderTrack(){const e={height:`${this.getThumbHeight()}px`,top:`${this.getThumbTop()}px`};return(0,r.h)("div",{ref:this.setTrackRef,class:"scroller-track",onClick:this.onTrackClick},(0,r.h)("div",{ref:this.setThumbRef,class:"scroller-thumb",style:e,onPointerDown:this.usePointerEvents?this.handleEvent:void 0,onMouseDown:this.usePointerEvents?void 0:this.handleEvent,onTouchStart:this.usePointerEvents?void 0:this.handleEvent}))}render(){const{children:e,className:t,hideThumb:i,disabled:n}=this.props,s=!n&&this.isOverflowing();return(0,r.h)("div",{class:l()("scroller-container",t)},(0,r.h)("div",{class:"scroller-scroller",ref:this.setScrollerRef},(0,r.h)("div",{class:"scroller-contents",ref:this.setContentsRef},e)),!i&&s&&this.renderTrack())}};Oo=Ao([N.Z],Oo);class DetailPanel extends r.Component{constructor(e){super(e),this.touchDevice=(0,w.Jm)(),this.handleTextBoxFocus=e=>{this.setState({textFocused:e.focused})},this.setScrollerRef=e=>{e&&(this.scroller=e)},this.state={textFocused:!1}}componentDidMount(){this.context.messageBus.subscribe(Vt.S,this.handleTextBoxFocus)}componentWillUnmount(){this.context.messageBus.unsubscribe(Vt.S,this.handleTextBoxFocus)}resetScrollTop(){this.scroller&&this.scroller.resetScrollTop()}scrollToSelector(e){this.scroller&&this.scroller.scrollToSelector(e)}render(){const{open:e,className:t,children:i,onScrolled:n,toolPanelLayout:s,scrollingDisabled:o}=this.props,{textFocused:a}=this.state,c=s===d.wS.BOTTOM_PANEL,h=c,u={open:e,"sticky-header":!(this.touchDevice&&a&&c)};return(0,r.h)("div",{class:l()("detail-panel",u,t)},(0,r.h)(Oo,{ref:this.setScrollerRef,hideThumb:h,disabled:o,onScrolled:n},i))}}var Po=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Do=class ButtonWithIcon extends r.Component{constructor(e){super(e)}render(){const{onClick:e,label:t,icon:i,buttonSize:n,buttonStyle:s,className:o}=this.props;return(0,r.h)(_.zx,{className:l()("button-with-icon",o),buttonSize:n,buttonStyle:s,onClick:e},(0,r.h)("span",{class:l()("icon",i)}),t)}};Do=Po([N.Z],Do);var Co=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Io=class ListNavigation extends r.Component{constructor(e){super(),this.onGotoNextNote=()=>{const e=this.getNextIndex();-1!==e&&this.props.onNavigate(e)},this.onGotoPrevNote=()=>{const e=this.getPrevIndex();-1!==e&&this.props.onNavigate(e)}}getNextIndex(){const{total:e,index:t,wrapAround:i}=this.props;return t+1<e?t+1:i?0:-1}getPrevIndex(){const{total:e,index:t,wrapAround:i}=this.props;return t>0?t-1:i?e-1:-1}render(){const{total:e,index:t,disabled:i}=this.props;if(e<2||-1===t)return null;const n=i||-1===this.getNextIndex()?"disabled":"",s=i||-1===this.getPrevIndex()?"disabled":"",o=`${t+1} of ${e}`;return(0,r.h)("div",{class:"list-nav"},(0,r.h)("span",{class:"list-nav-btn list-nav-btn-prev"},(0,r.h)("span",{class:`icon icon-dpad-left ${s}`,onClick:this.onGotoPrevNote})),(0,r.h)("span",{class:"list-nav-label"},o),(0,r.h)("span",{class:"list-nav-btn list-nav-btn-next"},(0,r.h)("span",{class:`icon icon-dpad-right ${n}`,onClick:this.onGotoNextNote})))}};Io=Co([N.Z],Io);var Lo=i(84933),Ro=i(90662),No=i(22151),ko=i(91735),Bo=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Fo=class PendingUpload extends r.Component{constructor(e){super(e),this.onRemoveFailed=e=>{const{uploadId:t,error:i,onRemoveFailed:n}=this.props;i&&n&&(e.stopPropagation(),n(t))}}renderError(e){const{onRemoveFailed:t}=this.props;let i=M.ig.SMALL,n="Upload failed";switch(e){case Fs.kV.FILE_TOO_LARGE:n="File is too large (500MB limit)";break;case Fs.kV.EMPTY_FILE:n="File is empty";break;case Fs.kV.OVER_QUOTA:n="Your organization is over its quota for file uploads.",i=M.ig.MEDIUM}return(0,r.h)("div",{class:"upload-status"},(0,r.h)(M.oO,{className:"upload-error-message",content:n,position:M.lZ.DOWN,tooltipWidth:i,showOnClick:!0},(0,r.h)("span",{class:"icon icon-error"})),t&&(0,r.h)(T.h,{iconClass:"icon-close",className:"attachment-delete",buttonStyle:T.D.SOCIAL,buttonSize:_.qE.SMALL,tooltipMsg:"Remove",tooltipPosition:M.lZ.DOWN_LEFT,onClick:this.onRemoveFailed}))}renderInProgress(){const{progress:e}=this.props;return(0,r.h)("div",{class:"upload-status"},(0,r.h)(Zn,{progress:e,innerRadius:20,barWidth:4}))}render(){const{className:e,error:t}=this.props,i={"upload-error":!!t};return(0,r.h)("div",{class:l()("attachment","attachment-upload",i,e)},t?this.renderError(t):this.renderInProgress())}};Fo=Bo([N.Z],Fo);var Uo=i(7683),Vo=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ho=class SmartTextEditor extends r.Component{constructor(e){super(e),this.emailMention=!1,this.wordToken=null,this.endTokens={"@":[","," ","!","?","/",";",":","(",")"],"#":[","," ",".","!","?","/",";",":"]},this.wordElement=null,this.linkElement=null,this.onClickAnchor=e=>{const t=e.target,i=t.dataset.blocktype;this.props.active?(e.preventDefault(),i===Bi.C.LINK&&this.prepareLinkForEdit(t)):i!==Bi.C.HASH&&i!==Bi.C.USER||this.props.onClickBlock({blockType:i,text:t.innerText,value:t.dataset.value,id:t.dataset.id})},this.onSelectionChange=()=>{const e=this.getCurrentRange();if(e){this.range=e.cloneRange();const t=this.wordElement&&null===this.wordElement.parentElement,i=!!this.wordElement&&this.wordElement!==this.getAnchorFromSelection();(t||i)&&this.wordElement&&(this.wordElement.classList.add("link-annotation-active"),this.endWordMatching()),this.insertFocusNodeIfNeeded()}},this.addFauxHighlight=()=>{this.execCommand("backColor","#ff315840")},this.removeFauxHighlight=()=>{this.execCommand("backColor","transparent")},this.isEmailMention=(e="")=>e.lastIndexOf("@")>0,this.onInput=e=>{var t;const i=e.inputType,n=i.startsWith("insert"),s="insertLineBreak"===i,r=e.data,o=this.startTokens;e.stopPropagation();const{isLinkNode:a,isSpecialNode:l,anchorNode:c}=this.tryGetAnchorNode();if(o.length&&!a&&!s){let s=r&&r.length>0?r.charAt(r.length-1):"";const a=(this.getTextElement().innerText||"").trim().length;if(i.startsWith("delete")&&0===a&&(this.getTextElement().innerHTML=""),this.updateWordElement(e,l,c),!this.wordToken&&o.includes(s)?(e.preventDefault(),this.wordToken=s,this.emailMention=!1,this.createWordElement(s),this.updateSuggestions()):!this.wordToken&&r&&r.length>1&&o.includes(r[0])&&(e.preventDefault(),this.wordToken=r[0],s=r[r.length-1],this.emailMention=this.isEmailMention(r),this.createWordElement(r),this.updateSuggestions()),this.wordToken&&this.wordElement){const i=this.wordElement.textContent||"",r=this.getMatches(i),o=r.length,a=null===(t=this.endTokens[this.wordToken])||void 0===t?void 0:t.includes(s);1===o&&this.sanitizeForSearch(i)===this.sanitizeForSearch(r[0].text)&&n?(e.preventDefault(),this.chooseMatch(r[0].text,r[0].value,r[0].id)):a&&"#"===this.wordToken?(e.preventDefault(),this.finishWordElement(!0)):a&&"@"===this.wordToken?(e.preventDefault(),this.emailMention?this.finishWordElement(!0):0===o&&this.clearWordElement()):"@"===this.wordToken?(this.updateUserMatches(),this.isEmailMention(i)&&(this.wordElement.classList.add("link-annotation-active"),this.emailMention=!0)):this.filterSuggestions()}}this.props.onInput(this.textBox.getMarkdown())},this.updateUserMatches=(0,Ue.D)((()=>this.fetchUserMatches()),350),this.onClickMatch=e=>{const t=e.currentTarget;if(t){const i=t.dataset.value,n=t.dataset.id,s=t.dataset.text||t.innerText;e.stopPropagation(),e.preventDefault(),this.chooseMatch(s,i,n)}},this.onHoverMatch=e=>{const t=e.currentTarget;if(t){const e=parseInt(t.dataset.index||"0",10);this.setState({activeMatch:e})}},this.onClick=e=>{const{active:t,onClickToEdit:i}=this.props;t?(this.removeFauxHighlight(),this.range=null):i&&i(e)},this.onBlur=e=>{this.endWordMatching(),this.props.onBlur&&this.props.onBlur(e)},this.onKeyDown=e=>{const{onCancelEditing:t,onDoneEditing:i}=this.props,{matches:n,activeMatch:s}=this.state;e.stopPropagation(),this.range||(this.range=this.getCurrentRange());switch(e.which||e.keyCode){case Ut.R.ESCAPE:return void(t&&t());case Ut.R.TAB:case Ut.R.RETURN:if(n.length&&s>-1)e.preventDefault(),this.chooseMatch(n[s].text,n[s].value,n[s].id);else{const{isSpecialNode:t,anchorNode:n}=this.tryGetAnchorNode();t&&n&&this.range&&(e.preventDefault(),this.insertAndFocusCharacter(n,!1,"\n")),this.wordToken&&(e.preventDefault(),this.finishWordElement(!1,!0)),e.shiftKey||(e.preventDefault(),i&&i())}return;case Ut.R.DOWNARROW:return void(n.length&&(e.preventDefault(),this.setState((e=>{const t=(e.activeMatch+1)%n.length;return this.ensureActiveMatchIsVisible(t),{activeMatch:t}}))));case Ut.R.UPARROW:return void(n.length&&(e.preventDefault(),this.setState((e=>{const t=0===e.activeMatch?n.length-1:e.activeMatch-1;return this.ensureActiveMatchIsVisible(t),{activeMatch:t}}))));case Ut.R.B:case Ut.R.I:case Ut.R.U:if(e.ctrlKey||e.metaKey)return void e.preventDefault();break;case Ut.R.BACKSPACE:case Ut.R.SHIFT:case Ut.R.CONTROL:case Ut.R.ALT:case Ut.R.LEFTARROW:case Ut.R.RIGHTARROW:case Ut.R.DELETE:return}},this.saveRef=e=>{this.textBox=e},this.bindSuggestionMenuRef=e=>{this.suggestionMenuRef=e},this.state={activeMatch:-1,matches:[],sortedSuggestions:[]}}componentDidMount(){this.props.active&&(this.textBox,document.addEventListener("selectionchange",this.onSelectionChange))}componentWillUnmount(){this.endWordMatching(),this.props.active&&document.removeEventListener("selectionchange",this.onSelectionChange),this.wordElement=null}componentWillReceiveProps(e){const{text:t,active:i}=this.props;t===e.text&&i===e.active||(this.endWordMatching(),this.setState({sortedSuggestions:[]}),i!==e.active&&(this.toggleEditing(!!e.active),e.active||this.textBox.replaceTextContent(e.text)))}componentDidUpdate(e){const{text:t,active:i}=this.props;t===e.text&&i===e.active||(i?document.addEventListener("selectionchange",this.onSelectionChange):document.removeEventListener("selectionchange",this.onSelectionChange))}ensureActiveMatchIsVisible(e){if(!this.suggestionMenuRef)return;const{scrollTop:t,offsetHeight:i}=this.suggestionMenuRef,n=this.suggestionMenuRef.querySelector(`[data-index="${e}"]`);if(!n)return;const{offsetTop:s,offsetHeight:r}=n,o=t>s;if(t+i<s+r||o){const e=o;n.scrollIntoView(e)}}getTextElement(){var e;return null===(e=this.textBox)||void 0===e?void 0:e.getTextElement()}toggleEditing(e){this.textBox&&this.textBox.toggleEditing(e)}focus(){this.textBox&&this.textBox.focus()}getMarkdown(){return this.textBox.getMarkdown()}hasTextSelected(){return!(!this.range||this.range.startOffset===this.range.endOffset)}prepareLinkForEdit(e){const t=e||this.getAnchorFromSelection();let i="";const n=window.getSelection();n&&(t||this.range?(this.addFauxHighlight(),t||(i=this.range?this.range.toString():n.toString())):(this.textBox.focus(),n.selectAllChildren(this.getTextElement()),n.collapseToEnd(),this.range=n.getRangeAt(0),i=this.range.toString())),this.linkElement=t;const s=t?t.innerText:i,r=t?t.dataset.value||t.href:"";this.props.onClickBlock({blockType:Bi.C.LINK,text:s,value:r})}saveLink(e,t){this.linkElement?""!==t?(this.linkElement.text=e,this.linkElement.href=t,this.linkElement.setAttribute("data-value",t)):this.unlink(this.linkElement):this.linkify(e,t)}linkify(e,t){this.removeFauxHighlight(),this.execCommand("createLink",t);let i=this.getAnchorFromSelection();!i&&this.range&&(i=document.createElement("a"),i.href=t,this.range.insertNode(i)),i&&(i.text=e,i.className=`link-annotation ${Fi.o.LINK}`,i.setAttribute("data-blocktype",Bi.C.LINK),i.setAttribute("data-value",t),i.onclick=this.onClickAnchor,this.insertAndFocusCharacter(i))}insertAndFocusCharacter(e,t=!1,i=""){if(this.range=this.getCurrentRange(),this.range){const n=document.createTextNode(i),s=t?"setStartBefore":"setStartAfter",r=t?"setEndBefore":"setEndAfter";this.range[s](e),this.range[r](e),this.range.insertNode(n),this.range.selectNodeContents(n),""!==i&&this.range.collapse(!1),this.applyRange()}}unlink(e){const t=e.parentNode,i=e.textContent;t&&(t.removeChild(e),i&&!$i(i)&&this.execCommand("insertText",i))}execCommand(e,t){this.range&&(this.applyRange(),document.execCommand(e,!1,t),this.onSelectionChange())}applyRange(){if(this.range){const e=window.getSelection();e&&(e.removeAllRanges(),e.addRange(this.range))}}getAnchorFromSelection(){const e=this.getCurrentRange();if(!e)return null;let t=e.commonAncestorContainer;for(;t&&"A"!==t.nodeName;){if(t===this.getTextElement())return null;t=t.parentNode}return t||null}insertFocusNodeIfNeeded(){var e,t;const i=window.getSelection();if(!i||!this.range)return;const{anchorNode:n,isLinkNode:s}=this.tryGetAnchorNode();if(n){const r=null!==(t=null===(e=n.textContent)||void 0===e?void 0:e.length)&&void 0!==t?t:0,o=0===i.focusOffset&&r>0,a=null===n.nextSibling&&r===i.focusOffset&&s;(o||a)&&this.insertAndFocusCharacter(n,o)}}getCurrentRange(){const e=window.getSelection();if(e&&e.rangeCount>0){const t=e.getRangeAt(0);if(this.getTextElement()===t.commonAncestorContainer||this.getTextElement().compareDocumentPosition(t.commonAncestorContainer)&Node.DOCUMENT_POSITION_CONTAINED_BY)return t}return null}sortWords(e){return e.sort(((e,t)=>e.text.toLowerCase()<t.text.toLowerCase()?-1:1))}tryGetAnchorNode(){var e;const t=this.getAnchorFromSelection();if(t&&t instanceof HTMLAnchorElement){const i=null===(e=t.dataset)||void 0===e?void 0:e.blocktype,n=i===Bi.C.USER||i===Bi.C.HASH,s=i===Bi.C.LINK;return{isSpecialNode:n,isLinkNode:s,anchorNode:n||s?t:null}}return{isSpecialNode:!1,isLinkNode:!1,anchorNode:null}}updateWordElement(e,t,i){const n=e.inputType.startsWith("delete"),s=window.getSelection(),r=this.startTokens;if(!this.wordElement||this.wordElement.parentElement){if(t&&i&&i.parentElement&&s){const e=i.textContent||"";if(!r.includes(e[0]||""))return void this.clearWordElement();const t=e.substr(0,s.focusOffset),o=s&&s.focusOffset<e.length,a=n||o;if(this.wordElement=i,this.wordToken=t[0],this.emailMention=this.isEmailMention(t),this.updateSuggestions(),this.range=this.getCurrentRange(),a&&this.range){this.range.selectNode(i);const n=this.range.extractContents();if(n&&n.firstElementChild&&n.firstElementChild instanceof HTMLElement){const i=e.substring(t.length),s=document.createTextNode(i);n.firstElementChild.innerText=t,n.firstElementChild.classList.remove("link-annotation-active"),n.firstElementChild.removeAttribute("data-value"),n.firstElementChild.removeAttribute("data-id"),n.appendChild(s),this.range.insertNode(n),this.range.setStartBefore(s),this.range.setEndBefore(s),this.range.collapse(!1),this.range.selectNodeContents(this.wordElement),this.range.collapse(!1),this.applyRange()}}}}else this.endWordMatching()}get startTokens(){const{hashtags:e,userMentions:t}=this.props,i=[];return t&&i.push("@"),e&&i.push("#"),i}fetchUserMatches(){const e=this.wordElement?this.wordElement.textContent:null;if(this.props.active&&this.wordToken&&e){const t=this.sanitizeForSearch(e,!0);this.context.commandBinder.issueCommand(new Uo.V1(t)).then((()=>{this.updateSuggestions()}))}}filterSuggestions(){const{wordToken:e,wordElement:t}=this;if(e&&t&&t.textContent){const e=this.sanitizeForSearch(t.textContent),i=this.getMatches(e),n=i.length>0?0:-1;this.setState({matches:i,activeMatch:n})}}sanitizeForSearch(e="",t){if(!this.wordToken)return e;let i=(e.startsWith(this.wordToken)?e.substr(1):e).toLowerCase().trim().replace(/\s\s+/g," ");if(t){const e=/([^\s]+)/.exec(i);i=e&&e[0]||""}return i}getMatches(e){const{sortedSuggestions:t=[]}=this.state,i=this.sanitizeForSearch(e)||"";return 0===i.length?t:t.filter((e=>{let t=0===this.sanitizeForSearch(e.text).indexOf(i);return!t&&"@"===this.wordToken&&e.value&&(t=0===this.sanitizeForSearch(e.value).indexOf(i)),t}))}chooseMatch(e,t,i){const n=this.wordElement;if(n){const s=this.wordToken&&!e.startsWith(this.wordToken)?this.wordToken:"";n.innerHTML=`${s}${e}`,n.classList.add("link-annotation-active"),t&&n.setAttribute("data-value",t),i&&n.setAttribute("data-id",i),this.finishWordElement(!1,!0),this.props.onInput(this.textBox.getMarkdown())}}updateSuggestions(){const{wordToken:e}=this,{hashtags:t,userMentions:i}=this.props;let n=[];if("#"===e&&t)n=this.sortWords(t.map((e=>({text:e,blockType:Bi.C.HASH}))));else if("@"===e&&i){const e=this.context.userData.getKnownUsers();n=this.sortWords(e.map((e=>({text:e.name,id:e.id,value:e.email,blockType:Bi.C.USER}))))}this.setState({sortedSuggestions:n}),this.filterSuggestions()}endWordMatching(){this.setState({matches:[],activeMatch:-1}),this.wordToken=null,this.wordElement=null,this.emailMention=!1}createWordElement(e){const t=window.getSelection(),i=this.range;if(!i||!t||!this.wordToken)return;const n=document.createElement("a");n.removeAttribute("href"),n.innerText=e,"#"===this.wordToken?(n.className=`link-annotation ${Fi.o.HASH}`,n.setAttribute("data-blocktype",Bi.C.HASH)):"@"===this.wordToken&&(n.className=`link-annotation ${Fi.o.USER}`,n.setAttribute("data-blocktype",Bi.C.USER));const s=i.startContainer,r=i.startOffset,o=i.endOffset+e.length,a=Math.max(0,(s.textContent||"").length);try{i.setStart(s,Math.min(r,a)),i.setEnd(s,Math.min(o,a))}catch(e){i.selectNodeContents(s)}i.deleteContents(),i.insertNode(n),i.selectNodeContents(n),i.collapse(!1),this.applyRange(),this.wordElement=n}clearWordElement(){const e=this.range,t=window.getSelection();e&&t&&this.wordElement&&this.wordToken&&(this.stripAnchorFromNode(this.wordElement),this.endWordMatching())}stripAnchorFromNode(e){const t=this.range;if(!t)return;const i=e.textContent;if(this.textBox.focus(),t.selectNode(e),t.deleteContents(),t.collapse(!1),i){const e=document.createTextNode(i);t.insertNode(e),t.selectNodeContents(e),t.collapse(!1)}this.applyRange()}isValidSpecialWord(e,t){return 0!==this.sanitizeForSearch(t).length||(this.clearWordElement(),!1)}finishWordElement(e,t){const{range:i,wordElement:n,wordToken:s}=this,r=window.getSelection();if(!(i&&r&&n&&s))return;n.contentEditable="true",n.classList.add("link-annotation-active");let o="";const a=n.textContent;if(this.isValidSpecialWord(s,a||"")){if(e&&a&&a.length>1?(o=a.charAt(a.length-1),n.textContent=a.slice(0,-1)):t&&(o=" "),this.textBox.focus(),i.setStartAfter(n),o){const e=document.createTextNode(o);i.insertNode(e),i.selectNodeContents(e),i.collapse(!1)}this.applyRange(),this.endWordMatching()}else this.clearWordElement()}renderMatch(e,t){const{activeMatch:i}=this.state,n=t===i,s=e.blockType===Bi.C.USER,o=s&&e.value?this.context.userData.getUserDisplay(e.value):null,l=s?e.value:void 0;return(0,r.h)("div",{class:a("suggestion",{selected:n}),onMouseDown:this.onClickMatch,onMouseEnter:this.onHoverMatch,"data-value":e.value,"data-id":e.id,"data-text":e.text,"data-index":t},s&&(0,r.h)(Cs,{badgeStyle:{color:o.color,"border-color":o.color,"background-color":"transparent"},label:o.initials}),(0,r.h)("span",{class:"suggestion-text"},e.text),l&&(0,r.h)("p",{class:"suggestion-hint"},"(",l,")"))}renderMatches(){const{active:e}=this.props;if(!e)return null;const{matches:t}=this.state,i=t.length>0;return(0,r.h)("div",{class:a("suggestion-menu",{open:i}),ref:this.bindSuggestionMenuRef},i&&t.map(((e,t)=>this.renderMatch(e,t))))}render(){const{text:e,onClickToEdit:t,active:i,textParser:n,placeholder:s,tabIndex:o,maxLength:l,className:c,onFocus:h}=this.props,d=!!t&&!i,u=c||"";return(0,r.h)("div",{class:a("smart-text-box",`${u}`)},(0,r.h)(Rs,{ref:this.saveRef,text:e,textParser:n,active:!!i,placeholder:s,tabIndex:o,clickToEdit:d,maxLength:l,onClick:this.onClick,onInput:this.onInput,onKeyDown:this.onKeyDown,onBlur:this.onBlur,onFocus:h,onClickAnchor:this.onClickAnchor}),this.renderMatches())}};Ho=Vo([N.A],Ho);var Go=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let zo=class FileUpload extends r.Component{constructor(e){super(e),this.tooltipTimeout=0,this.handleUpload=e=>{const t=e.target;if(!t)return;const i=t.files;i&&this.props.onUpload(i),t.value=""},this.onClick=e=>{const{onClick:t,buttonState:i}=this.props;i===_.BN.DIMMED?(window.clearTimeout(this.tooltipTimeout),this.setState({showingTooltip:!0}),this.tooltipTimeout=window.setTimeout((()=>{this.setState({showingTooltip:!1})}),2500)):t(e)},this.state={showingTooltip:!1}}componentWillUnmount(){window.clearTimeout(this.tooltipTimeout)}render(){const{accept:e,id:t,multi:i,buttonState:n,tooltipMsg:s,dataValue:o,onMouseDown:a}=this.props,{showingTooltip:l}=this.state,c=n===_.BN.ENABLED,h=`file-upload-${t}`;return(0,r.h)("div",{class:"file-upload-button"},(0,r.h)("label",{for:h},(0,r.h)(T.h,{dataValue:o,iconClass:"icon-attach",buttonStyle:T.D.PLAIN,buttonState:n,onClick:this.onClick,onMouseDown:a,tooltipMsg:s,tooltipPersist:l})),c&&(0,r.h)("input",{type:"file",class:"file-input",id:h,accept:e,multiple:!!i,onChange:this.handleUpload}))}};zo=Go([N.Z],zo);var Wo=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let jo=class FileDropZone extends r.Component{constructor(e){super(e),this.active=!1,this.dropZone=null,this.onDragOver=e=>{e.dataTransfer&&e.dataTransfer.types&&e.dataTransfer.types.includes("Files")&&(e.preventDefault(),e.stopPropagation(),this.activate())},this.onDrop=e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer&&e.dataTransfer.files&&this.props.onDropped(e.dataTransfer.files),this.deactivate()},this.onDragEnd=e=>{e.preventDefault(),e.stopPropagation(),this.deactivate()},this.onDragLeave=e=>{e.preventDefault(),e.stopPropagation(),this.deactivate()},this.setDropZoneRef=e=>{this.dropZone=e}}activate(){!this.active&&this.dropZone&&(this.props.onActivate(!0),this.active=!0,this.dropZone.classList.add("active"))}deactivate(){this.active&&this.dropZone&&(this.active=!1,this.dropZone.classList.remove("active"),this.props.onDone&&this.props.onDone())}render(){const{className:e,children:t,disabled:i}=this.props;return(0,r.h)("div",{class:e,onDragEnter:i?void 0:this.onDragOver,onDragLeave:i?void 0:this.onDragLeave,onDragOver:i?void 0:this.onDragOver,onDragEnd:i?void 0:this.onDragEnd,onDrop:i?void 0:this.onDrop},(0,r.h)("div",{class:"file-drop-zone",ref:this.setDropZoneRef},(0,r.h)("span",{class:"icon icon-attach"}),(0,r.h)("label",null,"Upload file")),t)}};jo=Wo([N.Z],jo);class OpenMediaEmbedEditorMessage extends Ni.v{}class CloseMediaEmbedEditorMessage extends Ni.v{}var Ko,qo=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{EMBED:Zo}=m.Z.WORKSHOP;var Yo;!function(e){e.NONE="none",e.INVALID_URL_SYNTAX="invalid",e.LOADING="loading",e.LOADED="loaded",e.ERROR="error"}(Yo||(Yo={}));const $o={currentUrl:"",validationPhase:Yo.NONE,error:void 0};let Qo=Ko=class MediaEmbedEditor extends r.Component{constructor(e){super(e),this.open=()=>{this.el.classList.add("open"),this.focus()},this.close=()=>{this.el.classList.remove("open"),this.setState($o)},this.onInput=e=>{const t=$i(e)?Yo.NONE:Yo.INVALID_URL_SYNTAX;this.setState({validationPhase:t,currentUrl:e})},this.onApply=e=>{this.isDisabled()||this.onDoneEditing(this.state.currentUrl)},this.stopPropagation=e=>{e.stopPropagation()},this.onDoneEditing=async e=>{const{onEmbed:t}=this.props;if(e)try{await this.loadMedia(e),this.setState({validationPhase:Yo.LOADED}),t(e)}catch(t){this.setState({error:t,validationPhase:Yo.ERROR,currentUrl:e})}},this.loadMedia=async e=>{const{assetId:t,assetType:i}=this.props;return this.setState({validationPhase:Yo.LOADING}),this.context.commandBinder.issueCommand(new cs.wu(t,i,e))},this.setRef=e=>this.el=e,this.setUrlRef=e=>this.urlInput=e,this.state=$o}componentDidMount(){this.context.messageBus.subscribe(OpenMediaEmbedEditorMessage,this.open),this.context.messageBus.subscribe(CloseMediaEmbedEditorMessage,this.close)}componentWillUnmount(){this.close(),this.context.messageBus.unsubscribe(OpenMediaEmbedEditorMessage,this.open),this.context.messageBus.unsubscribe(CloseMediaEmbedEditorMessage,this.close)}focus(){this.urlInput&&this.urlInput.focus()}isDisabled(){const{validationPhase:e,currentUrl:t}=this.state;return e===Yo.ERROR||e===Yo.LOADING||e===Yo.INVALID_URL_SYNTAX&&""!==t||""===t}renderError(){const{locale:e}=this.context,{error:t}=this.state;let i=e.t(Zo.ERROR_MESSAGE);return t instanceof ds.HF?i=e.t(Zo.PROVIDER_NOT_SUPPORTED_MESSAGE):t instanceof ds.t1&&(i=e.t(Zo.LINK_TYPE_NOT_SUPPORTED_MESSAGE)),(0,r.h)("div",{class:"popover-message popover-message-error"},i,(0,r.h)("a",{class:"link",target:"_blank",rel:"noreferrer",href:Ko.supportPage},e.t(Zo.HELP_CTA)))}renderHelpMessage(){const{locale:e}=this.context,{currentUrl:t,validationPhase:i}=this.state;switch(i){case Yo.ERROR:return this.renderError();case Yo.LOADING:return(0,r.h)("div",{class:"popover-message"},e.t(Zo.LOADING_MESSAGE));case Yo.INVALID_URL_SYNTAX:if(""!==t)return(0,r.h)("div",{class:"popover-message popover-message-error"},e.t(Zo.INVALID_URL_MESSAGE))}return(0,r.h)("div",{class:"popover-message"},(0,r.h)("a",{class:"link",target:"_blank",href:Ko.supportPage},e.t(Zo.SUPPORTED_FORMATS_MESSAGE)))}render(){const{locale:e}=this.context,{currentUrl:t}=this.state,{onCancel:i}=this.props,n=this.isDisabled()?_.BN.DISABLED:_.BN.ENABLED;return(0,r.h)("div",{ref:this.setRef,class:"annotation-popup media-embed-editor",onClick:this.stopPropagation},(0,r.h)("div",{class:"popover-header"},(0,r.h)("div",{class:"popover-label"},e.t(Zo.MEDIA_LINK_LABEL)),(0,r.h)(te.P,{buttonStyle:te.A.LIGHT,onClose:i})),(0,r.h)(tn,{ref:this.setUrlRef,text:t,type:"url",placeholder:"https://",onDone:this.onDoneEditing,onInput:this.onInput}),(0,r.h)("div",{class:"popover-footer"},this.renderHelpMessage(),(0,r.h)(_.zx,{className:"button-inline",buttonStyle:_.ZJ.CLEAR,buttonSize:_.qE.SMALL,buttonState:n,onClick:this.onApply},e.t(Zo.APPLY_CTA))))}};Qo.supportPage="https://support.matterport.com/hc/en-us/articles/115006363868-Add-Multimedia-to-a-Mattertag-Post",Qo=Ko=qo([N.Z],Qo);var Xo,Jo,ea=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e.EMBED="embed",e.LINK="link"}(Xo||(Xo={})),function(e){e.COLLABORATION="collaboration",e.PRESENTATION="presentation"}(Jo||(Jo={}));let ta=class Annotation extends r.Component{constructor(e){super(e),this.bindings=[],this.iMobile=(0,w.s)()||(0,w._1)(),this.updateAttachments=()=>{if(!this.attachmentsData)return;const{active:e,assetType:t,assetId:i}=this.props;if(!e)return;const n=this.attachmentsData.getPendingAttachmentsForAsset(i,t),s=this.attachmentsData.getRemovedAttachmentsForAsset(i,t);this.setState({pendingAttachments:n,removedAttachments:s})},this.handleFocus=e=>{const t=this.props.toolPanelLayout===d.wS.BOTTOM_PANEL;this.textEditor&&this.iMobile&&t&&window.setTimeout((()=>{this.textEditor.getTextElement().scrollIntoView()}),200)},this.cancelEdits=()=>{this.props.onCancelEditing&&this.props.onCancelEditing()},this.saveEdits=()=>{this.onDoneEditing()},this.onDoneEditing=()=>{const{onDoneEditing:e}=this.props;if(e){const t=this.getMarkdown();e(t,""===t&&0===this.getAttachmentCount())}},this.onClickTextBox=()=>{this.props.active||this.startEditingAnnotation()},this.onInput=e=>{this.setState({textChanged:e.trim()!==this.props.text})},this.startEditingAnnotation=()=>{const{onClickToEdit:e}=this.props;e&&e()},this.setPopupEditor=(e,t)=>{t?this.setState({popup:e}):e===this.state.popup&&this.setState({popup:null})},this.openLinkEditor=()=>{!(this.state.popup===Xo.LINK)&&this.textEditor&&(this.trackEvent("annotation_open_link_editor"),this.textEditor.prepareLinkForEdit())},this.onClickBlock=e=>{const{active:t}=this.props,i=e.blockType;if(i===Bi.C.LINK&&t){this.setState({selectedBlock:e}),this.setPopupEditor(Xo.LINK,!0);const t=""!==e.text;this.context.messageBus.broadcast(new OpenLinkEditorMessage(t))}else t||i!==Bi.C.USER&&i!==Bi.C.HASH||this.context.commandBinder.issueCommand(new Ro.R(e))},this.closeLinkEditor=()=>{this.context.messageBus.broadcast(new CloseLinkEditorMessage),this.setPopupEditor(Xo.LINK,!1),this.setState({selectedBlock:null})},this.toggleEmbedEditor=()=>{this.state.popup!==Xo.EMBED?(this.trackEvent("annotation_open_embed_editor"),this.setPopupEditor(Xo.EMBED,!0),this.context.messageBus.broadcast(new OpenMediaEmbedEditorMessage)):this.closeEmbedEditor()},this.closeEmbedEditor=()=>{this.setPopupEditor(Xo.EMBED,!1),this.context.messageBus.broadcast(new CloseMediaEmbedEditorMessage)},this.onRemoveLink=()=>{this.onSaveLink("","")},this.onSaveLink=(e,t)=>{const{popup:i}=this.state;i===Xo.LINK&&this.textEditor&&(this.setState({textChanged:!0}),this.textEditor.saveLink(e,t),this.closeLinkEditor())},this.onViewAttachment=(e,t)=>{this.props.onViewAttachment&&this.props.onViewAttachment(e,t)},this.removeFailedUpload=e=>{this.setState((t=>{const i=Object.assign({},t.failures);return delete i[e],{failures:i}}))},this.onClickFileInput=()=>{this.startEditingAnnotation()},this.onFileUpload=e=>{const{editable:t,assetId:i,assetType:n}=this.props;if(!t)return;const s=Array.from(e),r=this.getAttachmentCount();e.length+r>ko.yk&&s.splice(ko.yk-r);const o={};s.forEach(((e,t)=>{const i=(0,Lo.f)();o[i]={progress:0,index:t,error:null,file:e,uploadId:i}})),this.setState((e=>({uploads:Object.assign({},e.uploads,o)}))),this.context.commandBinder.issueCommand(new cs.It(i,n,Object.values(o))),this.context.messageBus.subscribe(Ks.Vj,this.updateProgress),this.context.messageBus.subscribe(Ks.RE,this.uploadingDone),this.edit()},this.onDrop=e=>{this.trackEvent("annotation_drag_and_dropped"),this.onFileUpload(e)},this.onFilesChosen=e=>{this.trackEvent("annotation_files_chosen"),this.onFileUpload(e)},this.dropActivated=()=>{const{active:e,creating:t}=this.props;t&&!e&&this.startEditingAnnotation()},this.updateProgress=e=>{if(e.assetType!==this.props.assetType||e.assetId!==this.props.assetId)return;const t=e.uploadStatus;this.setState((e=>{const i=Object.assign({},e.uploads);return i[t.uploadId]=t,{uploads:i}}))},this.uploadingDone=e=>{const{upload:t}=e;t.assetType===this.props.assetType&&t.assetId===this.props.assetId&&this.setState((e=>{const i=Object.assign({},e.uploads),n=Object.assign({},e.failures);return t.error?n[t.uploadId]=t:this.updateAttachments(),delete i[t.uploadId],{uploads:i,failures:n}}),(()=>{0===Object.keys(this.state.uploads).length&&(this.context.messageBus.unsubscribe(Ks.Vj,this.updateProgress),this.context.messageBus.unsubscribe(Ks.RE,this.uploadingDone))}))},this.setTextEditorRef=e=>this.textEditor=e,this.state={textChanged:!1,selectedBlock:null,pendingAttachments:[],removedAttachments:[],uploads:{},failures:{},popup:null}}componentDidMount(){this.context.market.waitForData(No.b).then((e=>{this.attachmentsData=e,this.bindings.push(this.attachmentsData.pendings.onChanged(this.updateAttachments),this.attachmentsData.removals.onChanged(this.updateAttachments))}))}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(e,t){const{active:i,assetId:n,assetType:s}=this.props;e.active&&!i?this.setState({textChanged:!1,pendingAttachments:[],removedAttachments:[],uploads:{},failures:{},popup:null}):n===e.assetId&&s===e.assetType||this.updateAttachments()}edit(){this.textEditor&&this.textEditor.toggleEditing(!0)}focus(){this.textEditor&&this.textEditor.focus()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}getMarkdown(){let e;return e=this.textEditor?this.textEditor.getMarkdown():this.props.text,e.trim()}getAttachmentCount(){const{attachments:e}=this.props,{pendingAttachments:t,removedAttachments:i,uploads:n}=this.state;return e.length+t.length+Object.keys(n).length-i.length}inEmptyState(){const{active:e,text:t}=this.props;return!e&&""===t.trim()&&0===this.getAttachmentCount()}renderButtonBar(){const{active:e,creating:t,assetId:i}=this.props;if(!e)return null;const{pendingAttachments:n,removedAttachments:s,textChanged:o,uploads:a}=this.state,l=this.getAttachmentCount()>=ko.yk,c=o||s.length>0||n.length>0,h=t?"Add":"Save",d=Object.keys(a).length>0,u=c&&e&&!d?_.BN.ENABLED:_.BN.DISABLED,p=l?_.BN.DIMMED:d?_.BN.DISABLED:_.BN.ENABLED,m=l?`Max attachment limit of ${ko.yk}`:"Upload file",g=l?`Max attachment limit of ${ko.yk}`:"Embed media";return(0,r.h)("div",{class:"annotation-button-bar"},(0,r.h)("div",{class:"annotation-editors"},(0,r.h)(zo,{id:`${i}-annotation`,multi:!0,buttonState:p,tooltipMsg:m,onUpload:this.onFilesChosen,onClick:this.onClickFileInput}),(0,r.h)(T.h,{iconClass:"icon-media-mix",buttonStyle:T.D.PLAIN,buttonState:p,tooltipMsg:g,onClick:this.toggleEmbedEditor}),(0,r.h)(T.h,{iconClass:"icon-link",buttonStyle:T.D.PLAIN,tooltipMsg:"Add link",onClick:this.openLinkEditor})),(0,r.h)("div",{class:"annotation-cta-buttons"},(0,r.h)(_.zx,{buttonStyle:_.ZJ.SECONDARY,buttonSize:_.qE.SMALL,className:"button-inline",buttonState:_.BN.ENABLED,onClick:this.cancelEdits},"Cancel"),(0,r.h)(_.zx,{className:"button-inline",buttonStyle:_.ZJ.SECONDARY,buttonSize:_.qE.SMALL,buttonState:u,onClick:this.saveEdits},h)))}renderAttachment(e,t,i){const{active:n}=this.props,s=!n&&(1===i||0===t&&i>2),o=n||!s,a=(0,ls.fy)(n,s),l=!n&&(0,ls.lV)(e)?this.onViewAttachment:void 0;return(0,r.h)(As,{attachment:e,inline:n,hero:s,cover:!0,onClick:l,thumbnail:o,smartWidth:a.width,smartHeight:a.height})}renderPendingUpload(e){return(0,r.h)(Fo,{uploadId:e.uploadId,className:"inline",progress:e.progress,error:e.error,onRemoveFailed:this.removeFailedUpload})}renderAttachments(){if(!this.attachmentsData)return null;const{attachments:e,active:t}=this.props,{pendingAttachments:i,uploads:n,failures:s}=this.state,o=e.length,a=e.filter((e=>!this.attachmentsData.removals.get(e.id)));return(0,r.h)("div",{class:l()("annotation-attachments",{"annotation-attachments-inline":t})},a.map(((e,t)=>this.renderAttachment(e,t,o))),i.map(((e,t)=>this.renderAttachment(e,t,o))),Object.values(n).map((e=>this.renderPendingUpload(e))),Object.values(s).map((e=>this.renderPendingUpload(e))))}renderTextBox(){const{placeholder:e,hashtags:t,text:i,creating:n,clickToEdit:s,textParser:o,active:a,editable:l,maxLength:c,tabIndex:h,annotationType:d}=this.props,u=d===Jo.COLLABORATION,p=this.inEmptyState()&&u,m=p&&!n?"Original content was deleted":e,g=p&&m?"placeholder":void 0,f=s&&l?this.onClickTextBox:void 0;return(0,r.h)(Ho,{ref:this.setTextEditorRef,textParser:o,className:g,text:i,active:!!a,placeholder:m,onClickBlock:this.onClickBlock,onClickToEdit:f,onDoneEditing:this.onDoneEditing,onCancelEditing:this.cancelEdits,onFocus:this.handleFocus,onInput:this.onInput,tabIndex:h,maxLength:c,hashtags:t||[],userMentions:u})}renderReadonlyAnnotation(){const{className:e,creating:t,annotationType:i,title:n}=this.props,s=i===Jo.COLLABORATION,o={"annotation-emptied":this.inEmptyState()&&!t&&s};return(0,r.h)("div",{class:"annotation-box"},!s&&this.renderAttachments(),n&&(0,r.h)("div",{class:"annotation-title"},n),(0,r.h)("div",{class:l()("annotation-text-box",o,e)},this.renderTextBox()),s&&this.renderAttachments())}renderEditableAnnotation(){const{className:e,creating:t,active:i,assetId:n,assetType:s,editable:o,clickToEdit:a,edited:c,annotationType:h}=this.props,{uploads:d,selectedBlock:u}=this.state,p=this.getAttachmentCount()<ko.yk,m=Object.keys(d).length>0,g=o&&!m&&(i||t)&&p,f=h===Jo.COLLABORATION,v=this.inEmptyState()&&!t&&f,y=!i&&c&&!v,b={annotating:i,"editor-box":i||a,"annotation-emptied":v};let S="",E="";return u&&u.blockType===Bi.C.LINK&&(S=u.text,E=u.value||""),(0,r.h)(jo,{className:"annotation-box",onDropped:this.onDrop,disabled:!g,onActivate:this.dropActivated},(0,r.h)("div",{class:l()("annotation-text-box",b,e)},this.renderTextBox(),i&&this.renderAttachments(),i&&this.renderButtonBar()),y&&(0,r.h)("div",{class:"annotation-edited"},"(edited)"),!i&&!t&&this.renderAttachments(),i&&!!n&&(0,r.h)(Qo,{assetId:n,assetType:s,onEmbed:this.closeEmbedEditor,onCancel:this.closeEmbedEditor}),i&&!!n&&(0,r.h)(LinkEditor,{linkText:S,linkUrl:E,onCancel:this.closeLinkEditor,onSaveLink:this.onSaveLink,onRemoveLink:this.onRemoveLink}))}render(){return this.props.editable?this.renderEditableAnnotation():this.renderReadonlyAnnotation()}};ta=ea([N.Z],ta);const ia=ta;var na=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let sa=class TagWidget extends r.Component{constructor(e){super(e),this.bindings=[],this.textParser=new Fi.v({links:!0}),this.onModalChange=()=>{const e=!!this.context.toolsData.openModal;e||this.toolPanel&&this.props.toolPanelLayout===d.wS.BOTTOM_PANEL&&this.toolPanel.resetScrollTop(),this.setState({modalOpen:e})},this.onViewAttachment=(e,t)=>{const{tag:i}=this.props;if(!i)return;const n=i.attachments;n.length&&this.closeTag().then((()=>{this.trackEvent("tags_click_view_attachment");const e=n.filter((e=>(0,ls.lV)(e)));e.length>0&&this.context.commandBinder.issueCommand(new cs.xW(!0,e,t))}))},this.onNavigate=e=>{this.props.manager.navigateInList(e,!0,this.props.toolPanelLayout)},this.closeTag=async()=>this.context.commandBinder.issueCommand(new Ge.tT(d.w1.TAGS,!1)),this.setToolPanelRef=e=>{e&&(this.toolPanel=e)},this.state={modalOpen:!1}}componentDidMount(){const{toolsData:e}=this.context;this.bindings.push(e.onOpenModalChanged(this.onModalChange)),this.onModalChange()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderNavHeader(e){const{listIndex:t,numTags:i,tag:n}=this.props;if(!n)return null;const s=i>1&&-1!==t;return e?(0,r.h)("div",{class:"detail-panel-header"},s&&(0,r.h)(Io,{index:t,total:i,disabled:!1,wrapAround:!0,onNavigate:this.onNavigate}),(0,r.h)(te.P,{onClose:this.closeTag})):(0,r.h)("div",{class:"detail-panel-header"},(0,r.h)(Do,{label:"Close",className:"return-btn",icon:"icon-close",buttonSize:_.qE.SMALL,buttonStyle:_.ZJ.TOOLBAR,onClick:this.closeTag}),s&&(0,r.h)(Io,{index:t,total:i,disabled:!1,wrapAround:!0,onNavigate:this.onNavigate}))}renderWidgetFrame(e){const t=e.widgetFrame;return t?(0,r.h)(CustomWidgetFrame,{widget:t}):null}renderText(e){const{label:t,description:i}=e;return t||i?(0,r.h)("div",{class:"tag-text"},t&&(0,r.h)("header",{class:"tag-header"},t),i&&(0,r.h)("div",{class:"tag-description"},(0,r.h)(Rs,{text:i,textParser:this.textParser}))):null}renderTag(e,t){const{toolPanelLayout:i}=this.props,{label:n,description:s,id:o,attachments:l}=e;return t?(0,r.h)("div",{class:a("tag",{"has-media":l.length>0,"has-text":!(!n&&!s)})},(0,r.h)(Vs,{attachments:l,onClick:this.onViewAttachment}),this.renderText(e),this.renderWidgetFrame(e)):(0,r.h)("div",{class:"tag"},(0,r.h)(ia,{annotationType:Jo.PRESENTATION,assetId:o,assetType:Mo.h.MATTERTAG,attachments:[],textParser:this.textParser,clickToEdit:!1,editable:!1,active:!1,edited:!1,text:s,title:n,toolPanelLayout:i,onViewAttachment:this.onViewAttachment}))}renderTagWidget(e,t){return(0,r.h)("div",{class:a("tag-widget",{modal:t})},this.renderNavHeader(t),this.renderTag(e,t))}render(){const{tag:e,closing:t,toolPanelLayout:i}=this.props,{modalOpen:n}=this.state,s=i===d.wS.BOTTOM_PANEL,o=i===d.wS.SIDE_PANEL,a=s||o,l=a&&!!e&&!t&&(o||!n);return a?(0,r.h)(DetailPanel,{ref:this.setToolPanelRef,open:l,toolPanelLayout:i,scrollingDisabled:!1},e&&this.renderTagWidget(e,!1)):null}};sa=na([N.Z],sa);var ra=i(21909);class ListPanel extends r.Component{constructor(e){super(e),this.bindings=[],this.updateCollapsedState=()=>{this.setState({collapsedToBottom:this.context.toolsData.isPanelCollapsedToBottom()})},this.onToggleBottomCollapsed=e=>{const{collapsedToBottom:t,collapsing:i}=this.state;e&&e.stopPropagation(),i||(this.context.commandBinder.issueCommand(new Ge.zK(!t)),t||(this.setState({collapsing:!0}),window.setTimeout((()=>{this.setState({collapsing:!1})}),500)))},this.state={collapsedToBottom:e.toolPanelLayout===d.wS.BOTTOM_PANEL,collapsing:!1}}componentDidMount(){this.bindings.push(this.context.engine.subscribe(ue.U7,this.updateCollapsedState)),this.updateCollapsedState()}componentWillUnmount(){this.bindings.forEach((e=>e.cancel()))}render(){const{active:e,toolPanelLayout:t,children:i,title:n,onClose:s,className:o,subheader:a,footer:c,subheaderCollapsedHeight:h}=this.props,{collapsedToBottom:u,collapsing:p}=this.state,m=t===d.wS.BOTTOM_PANEL,g=m&&u&&!p,f={active:e,collapsed:g},v=g?"icon-dpad-up":"icon-dpad-down",y=t===d.wS.BOTTOM_PANEL&&h&&u?{height:h+To.c9}:void 0;return(0,r.h)("div",{class:l()("list-panel",f,o),style:y},(n||s)&&(0,r.h)("div",{class:"list-panel-header",onClick:this.onToggleBottomCollapsed},n||null,(0,r.h)("div",null,m&&(0,r.h)(T.h,{iconClass:v,buttonStyle:T.D.PLAIN,onClick:this.onToggleBottomCollapsed}),s&&(0,r.h)(T.h,{iconClass:"icon-close",buttonStyle:T.D.PLAIN,onClick:s}))),h?a:!g&&(a||null),!g&&i,!g&&(c||null))}}var oa=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let aa=class AccordionHeader extends r.Component{constructor(e){super(e)}render(){const{label:e,onToggle:t,children:i,className:n}=this.props;return(0,r.h)("div",{class:l()("accordion-header",n),onClick:t||void 0},i,(0,r.h)("span",{class:"accordion-header-label"},e),!!t&&(0,r.h)("button",{class:"icon accordion-icon accordion-toggle-icon"}))}};aa=oa([N.Z],aa);var la=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let ca=class AccordionGroup extends r.Component{constructor(e){super(e),this.toggleGroup=()=>{this.state.expanded?this.animateCollapseGroup():this.animateExpandGroup();const{id:e,onExpandChange:t}=this.props;t&&t(e,this.state.expanded)};const t=!e.header||!!e.open;this.state={expanded:t,showChildren:t};const{id:i,onExpandChange:n}=this.props;n&&n(i,this.state.expanded)}componentDidUpdate(e){!e.open&&this.props.open&&this.animateExpandGroup(),e.open&&!this.props.open&&this.animateCollapseGroup()}componentWillUnmount(){void 0!==this.timeout&&window.clearTimeout(this.timeout)}animateExpandGroup(){this.setState({showChildren:!0},(()=>{this.timeout=window.setTimeout((()=>{delete this.timeout,this.setState({expanded:!0})}))}))}animateCollapseGroup(){this.setState({expanded:!1},(()=>{this.timeout=window.setTimeout((()=>{delete this.timeout,this.state&&!this.state.expanded&&this.setState({showChildren:!1})}),To.g)}))}renderContents(){const{children:e,emptyMessage:t,doubleLine:i,naturalHeight:n}=this.props,{expanded:s,showChildren:o}=this.state,a=i?60:40,l=e&&Array.isArray(e)&&e.length||0,c=l>0;let h;h=s?c?l*a+"px":`${a}px`:"0";const d=n?void 0:`height: ${h}`,u=c?e:(0,r.h)("p",{class:"hint accordion-empty-message"},t||"");return(0,r.h)("div",{class:"accordion-contents",style:d},o&&u)}renderHeader(){const{header:e,collapsible:t}=this.props,{expanded:i}=this.state,n="string"==typeof e?e:void 0;if(n)return(0,r.h)(aa,{label:n,expanded:i,onToggle:t?this.toggleGroup:void 0});if(void 0!==e){const t=e;return(0,r.cloneElement)(t,{expanded:i,onToggle:this.toggleGroup})}return null}render(){const{doubleLine:e}=this.props,{expanded:t}=this.state;return(0,r.h)("div",{class:a("accordion-group",{expanded:t,collapsed:!t,"double-line":e}),"aria-expanded":t?"true":"false"},this.renderHeader(),this.renderContents())}};ca=la([N.Z],ca);var ha=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let da=class AccordionItem extends r.Component{constructor(e){super(e),this.onClick=e=>{const t=e.target;this.props.onSelect&&!t.classList.contains("icon-more-vert")&&this.props.onSelect(this.props.sid)}}render(){const{enabled:e,selected:t,children:i,className:n}=this.props,s=l()("accordion-item",{"accordion-item-disabled":!e,"accordion-item-selected":t},n);return(0,r.h)("div",{class:s,onClick:this.onClick},i)}};da=ha([N.Z],da);class AccordionOptionsButton extends r.Component{constructor(e){super(e),this.setPopupMenu=e=>{e&&(this.popupMenu=e)},this.onClick=e=>{this.state.open?this.onClose(e):this.onOpen(e)},this.onOpen=e=>{const t=e.clientY+this.popupMenu.offsetHeight+ne.POPUP_OFFSET>window.innerHeight?ee.BOTTOM_RIGHT:ee.TOP_RIGHT;this.setState({open:!0,arrowPosition:t})},this.onClose=e=>{this.setState({open:!1})},this.state={open:!1,arrowPosition:ee.TOP_RIGHT}}renderMenu(){const{menu:e}=this.props,{locale:t}=this.context;return(0,r.h)("div",{class:"tooltip-menu"},e.map((([e,i])=>(0,r.h)("div",{class:"tpMsg",key:e,onClick:e=>{e.stopPropagation(),i()}},t.t(e)))))}render(){const{arrowPosition:e,open:t}=this.state,{id:i}=this.props;return(0,r.h)(T.h,{dataValue:i,className:"accordion-options-button",buttonStyle:T.D.PLAIN,iconClass:"accordion-icon icon-more-vert item-more-options",onClick:this.onClick},(0,r.h)("div",{class:"accordion-options-button__tooltip-container",ref:this.setPopupMenu},(0,r.h)(ne,{open:t,onClose:this.onClose,message:this.renderMenu(),arrowPos:e,bodyClassName:"item-tooltip"})))}}const{DELETE_SELECTED_CTA:ua,SELECT_ALL_CTA:pa,ENTER_SELECT_MODE_CTA:ma,EXIT_SELECT_MODE_CTA:ga}=m.Z.WORKSHOP.ACCORDION;class AccordionSelectorHeader extends r.Component{constructor(e){super(e)}render(){const{locale:e}=this.context,{title:t,hasSelectedItems:i,selectMode:n,selectAllCallback:s,selectButtonCallback:o,batchSupported:l,disableToggle:c}=this.props;if(!t&&!l)return null;const h={"select-mode":n},d=e.t(i?ua:pa),u=e.t(n?ga:ma);return(0,r.h)("div",{class:a("accordion-selector-header",h)},(0,r.h)("span",{class:"title"},n?(0,r.h)(_.zx,{buttonSize:_.qE.MINI,buttonStyle:_.ZJ.CLEAR,onClick:s},d):t),l&&(0,r.h)(_.zx,{buttonSize:_.qE.MINI,buttonStyle:n?_.ZJ.CLEAR:_.ZJ.LIGHT,buttonState:c?_.BN.DISABLED:_.BN.ENABLED,onClick:o},u))}}var fa=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let va=class Accordions extends r.Component{constructor(e){super(e)}render(){const{children:e,className:t}=this.props,i=t||"";return(0,r.h)("div",{class:a("accordion-list",[i])},e)}};va=fa([N.Z],va);var ya=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let ba=class AccordionSelectorContent extends r.Component{render(){const{children:e,selectMode:t}=this.props;return(0,r.h)("div",{class:a("accordion-main-content",{"footer-active":t})},(0,r.h)(SingleScrollbar,{direction:H.vertical,hideScrollbar:fe(window)},(0,r.h)(va,null,e)))}};ba=ya([N.Z],ba);const{TOGGLE_VISIBILITY_FOOTER_CTA:Sa,DELETE_FOOTER_CTA:Ea}=m.Z.WORKSHOP.ACCORDION;class AccordionSelectorFooter extends r.Component{constructor(e){super(e)}renderFooterButton(e,t,i){const{locale:n}=this.context,s=this.props.enabled&&!i,o=n.t(e);return(0,r.h)("span",{class:"footer-button-container"},(0,r.h)(_.zx,{buttonStyle:_.ZJ.CLEAR,buttonSize:_.qE.MINI,buttonState:s?_.BN.ENABLED:_.BN.DISABLED,onClick:t},o))}render(){const{active:e,leftButtonPhraseKey:t=Ea,leftButtonCallback:i,leftButtonDisabled:n=!1,rightButtonPhraseKey:s=Sa,rightButtonCallback:o,rightButtonDisabled:l=!1}=this.props,c={active:e},h=this.renderFooterButton(t,i,n),d=this.renderFooterButton(s,o,l);return(0,r.h)("div",{class:a("accordion-selector-footer",c)},(0,r.h)("div",{class:"footer-list"},h,d))}}var wa=i(17386);class RenameFloorCommand extends wa.m{constructor(e,t){super(),this.id="RENAME_FLOOR",this.payload={floorId:e,text:t}}}var Ta,_a=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{RENAME_HEADER_OPTION_CTA:Ma}=m.Z.WORKSHOP.ACCORDION;let xa=Ta=class FloorRenameHeader extends r.Component{constructor(e){super(e),this.bindings=[],this.registerOnNameChanged=e=>{this.floorsViewData=e;const{group:t}=this.props;try{const i=e.getFloor(t.id),n=e.getDefaultFloorName(t.id);this.setState({renamable:!0,defaultName:n}),this.bindings.push(i.onPropertyChanged("name",this.onNameChanged)),this.onNameChanged(i.name)}catch(e){}},this.onNameChanged=e=>{if(this.floorsViewData){const t=this.floorsViewData.getFloorName(this.props.group.id),i=()=>this.setState({actualName:e,displayName:t});t===this.state.displayName?this.setState({actualName:e,displayName:e},i):i()}},this.onCheckboxClick=e=>{const{group:t,onSelectGroup:i}=this.props;i&&i(t)},this.startRename=()=>{this.setState({renaming:!0})},this.renameFloor=e=>{this.context.commandBinder.issueCommand(new RenameFloorCommand(this.props.group.id,e)),this.setState({renaming:!1})},this.cancelRename=()=>{this.setState({renaming:!1})},this.toggleExpanded=e=>{const t=e.target;this.props.onToggle&&!t.classList.contains("icon-more-vert")&&this.props.onToggle()},this.getMenuOptions=()=>[[Ma,this.startRename]],this.state={renamable:!1,actualName:this.props.group.name,displayName:this.props.group.name,renaming:!1}}componentDidMount(){const{market:e}=this.context;e.waitForData(v.c).then(this.registerOnNameChanged)}componentWillUnmount(){for(const e of this.bindings)e.cancel()}render(){const{group:e,multiFloor:t,selectMode:i,isGroupSelected:n}=this.props,{items:s,id:o}=e,{actualName:l,defaultName:c,displayName:h,renamable:d,renaming:u}=this.state,p={"with-children":!!i,"accordion-header-editing":u,"accordion-collapsible":t,"accordion-header-select-mode":i};return(0,r.h)("div",{class:a("accordion-header","floor-rename-header",p),onClick:this.toggleExpanded},i&&(0,r.h)("div",{class:"accordion-checkbox"},(0,r.h)(Bt,{enabled:s.length>0,checked:n,id:o,onChange:this.onCheckboxClick,stopPropagation:!0,dataValue:o})),(0,r.h)(qi,{isDisabled:!1,editing:u,className:"accordion-header-label",text:u?l:h,placeholder:c,hint:`(${s.length})`,clickToEdit:!1,closeOnFocusOut:!0,onEdited:this.renameFloor,maxLength:Ta.maxFloorNameLength,showUnderline:u,readOnlyMode:!u,propagateMouseEvent:!u,onCancelEditing:this.cancelRename}),t&&(0,r.h)("button",{class:"icon accordion-icon accordion-toggle-icon"}),d&&!i&&!u&&(0,r.h)(AccordionOptionsButton,{id:o,menu:this.getMenuOptions()}))}};function Aa(e){const{locale:t}=this.context,{id:i,visible:n,showTooltip:s,hideTooltip:o,forceDisable:a}=e,c=n?"icon-eye-show":"icon-eye-hide",h=n&&!a?_.BN.ENABLED:_.BN.DIMMED,d=a?void 0:t.t(n?o:s),u=a?()=>{}:this.props.onClick;return(0,r.h)(T.h,{className:l()("accordion-icon","accordion-item-toggle-icon"),iconClass:c,buttonStyle:T.D.PLAIN,buttonState:h,tooltipMsg:d,tooltipPosition:M.lZ.DOWN_RIGHT,dataValue:i,onClick:u})}xa.maxFloorNameLength=24,xa.focusedFloor=-1,xa=Ta=_a([N.Z],xa);const Oa=()=>!0;const{TAGS:Pa}=m.Z.SHOWCASE;class TagsList extends r.Component{constructor(e){super(e),this.bindings=[],this.textParser=new Fi.v({links:!0}),this.onTagsToolStateChanged=()=>{const{selectMode:e,toggleSelectMode:t}=this.props,{tagsViewData:i}=this.props.manager.dataMap;i.tagsToolState!==ra.p.IDLE&&e&&t()},this.updateGroups=()=>{const{floorsViewData:e,tagsViewData:t}=this.props.manager.dataMap,i=t.getAllTagViews().values(),n=e.getFloorIdMap();i.forEach((e=>{var i;const s=e.floorId;if(!n[s])throw Error(`Mattertag on non-existent floor: ${s}`);n[s].items.push({sid:e.id,floorId:e.floorId,text:this.getTagText(e),visible:e.enabled,selected:(null===(i=t.openTagView)||void 0===i?void 0:i.id)===e.id,color:e.color})}));for(const e in n){n[e].items.sort(((e,t)=>e.text.toLowerCase()<t.text.toLowerCase()?-1:1))}this.setState({listGroups:n,numTags:i.length})},this.batchToggleVisibility=async()=>!!this.props.selectedItems,this.batchDelete=async()=>{const{selectedItems:e,clearSelected:t}=this.props;if(e){if(!0)return t(),!0}return!1},this.selectAll=()=>{this.props.onSelectAll(this.state.listGroups)},this.selectTag=e=>{this.trackEvent("tags_list_open_tag"),this.props.onOpenTag(e)},this.deleteItem=e=>{},this.editItem=e=>{},this.toggleItemVisibility=e=>{const t=e.currentTarget,i=t&&t.getAttribute?t.getAttribute("data-value"):null;if(e.stopPropagation(),i){this.context.analytics.track("workshop_gui",{gui_action:"drawer_mattertag_visibility_modified"});const e=this.getListItem(i);e&&this.props.manager.setTagVisibility(i,!e.visible)}},this.getMenuOptions=e=>[[Pa.EDIT_LIST_ITEM_OPTION_CTA,()=>this.editItem(e)],[Pa.DELETE_LIST_ITEM_OPTION_CTA,()=>this.deleteItem(e)]],this.renderFloorRenameHeader=(e,t)=>{const{selectMode:i,onSelectGroup:n,isGroupBatchSelected:s}=this.props,o=s(e);return(0,r.h)(xa,{group:e,multiFloor:t,selectMode:i,isGroupSelected:o,onSelectGroup:n})},this.state={numTags:0,listGroups:{}}}componentDidMount(){const{tagsViewData:e}=this.props.manager.dataMap;this.bindings.push(e.onOpenTagViewChanged(this.updateGroups),e.getAllTagViews().onChanged(this.updateGroups),e.onTagsToolStateChanged(this.onTagsToolStateChanged)),this.updateGroups()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}getTagText(e){let t=e.label;return""===t&&(t=e.description),t}getListItem(e){const{listGroups:t}=this.state;for(const i in t){const n=t[i].items.find((t=>t.sid===e));if(n)return n}return null}getEmptyMessage(){return"You don't have any tags yet."}renderItem(e,t){const{selectedItems:i,onCheckboxClick:n,onSelectItem:s,selectMode:o}=this.props,{sid:a,text:c,visible:h,selected:d,color:u}=e,p={"background-color":u},m=l()("tag-header","accordion-item-with-options","accordion-item-with-toggle");return(0,r.h)(da,{key:a,sid:a,className:m,enabled:h,selected:d,onSelect:o?s:this.selectTag},o&&(0,r.h)("div",{class:"accordion-checkbox"},(0,r.h)(Bt,{enabled:!0,checked:i&&i.has(a),id:a,onChange:n,stopPropagation:!0,dataValue:a})),!o&&(0,r.h)(Aa,{id:a,visible:h,showTooltip:Pa.SHOW_LIST_ITEM_TOOLTIP_MESSAGE,hideTooltip:Pa.HIDE_LIST_ITEM_TOOLTIP_MESSAGE,onClick:this.toggleItemVisibility}),(0,r.h)("span",{class:"accordion-item-text tag-text"},(0,r.h)(Rs,{text:c,textParser:this.textParser})),(0,r.h)("div",{class:"mattertag-color-dot-container"},(0,r.h)("span",{class:"mattertag-color-dot",style:p})),!o&&(0,r.h)(AccordionOptionsButton,{id:a,menu:this.getMenuOptions(e)}))}renderGroups(){const{locale:e}=this.context,{listGroups:t}=this.state,{onExpandChange:i,manager:n}=this.props,s=[],o=Object.keys(t).length>1,a=n.dataMap.floorsViewData.currentFloorId,l=e.t(o?Pa.MULTI_FLOOR_EMPTY_MESSAGE:Pa.SINGLE_FLOOR_EMPTY_MESSAGE);for(const e in t){const n=t[e],c=this.renderFloorRenameHeader(n,o);s.push((0,r.h)(ca,{key:e,id:e,emptyMessage:l,header:c,open:a===n.id||!o,collapsible:o,onExpandChange:i},n.items.map(((e,t)=>this.renderItem(e,t)))))}return s}renderTagsList(){const{numTags:e}=this.state;if(0===e)return(0,r.h)("div",{class:"empty-message"},this.getEmptyMessage());const{locale:t}=this.context,{manager:i,selectedItems:n,selectMode:s,toggleSelectMode:o,batchSelectEnabled:a}=this.props,c=t.t(Pa.NUM_TYPE,e),h=(null==n?void 0:n.size)>0,d=i.dataMap.tagsViewData.tagsToolState!==ra.p.IDLE;return(0,r.h)("div",{class:l()("list-contents","tags-list")},(0,r.h)(AccordionSelectorHeader,{selectMode:!!s,selectAllCallback:this.selectAll,selectButtonCallback:o,disableToggle:d,title:c,hasSelectedItems:h,batchSupported:a}),(0,r.h)(ba,{selectMode:!!s},this.renderGroups()),a&&(0,r.h)(AccordionSelectorFooter,{active:!!s,enabled:h,leftButtonCallback:this.batchDelete,rightButtonCallback:this.batchToggleVisibility}))}render(){const{active:e,toolPanelLayout:t}=this.props;return(0,r.h)(ListPanel,{active:e,className:"tags-list-panel",toolPanelLayout:t},this.renderTagsList())}}const Da=function(e,t=Oa){return class WithBatchSelect extends r.Component{constructor(e){super(e),this.toggleSelectMode=()=>{const{selectMode:e}=this.state;this.setState({checkedItems:new Set,selectMode:!e})},this.setGroupExpandState=(e,t)=>{const{expandedGroups:i}=this.state;i[e]=t,this.setState({expandedGroups:Object.assign({},i)})},this.onCheckboxClick=e=>{const t=e.dataset.value;t&&this.checkItem(t)},this.checkItem=e=>{e&&this.toggleId(e)},this.checkGroup=e=>{const i=e.items.every((e=>this.state.checkedItems.has(e.sid)||!t(e,this.props)));for(const n of e.items)t(n,this.props)&&this.setId(n.sid,!i,!1);this.setState({checkedItems:new Set(this.state.checkedItems)})},this.toggleId=e=>{const t=this.state.checkedItems.has(e);this.setId(e,!t)},this.clearSelected=()=>{this.setState({checkedItems:new Set})},this.setId=(e,t,i=!0)=>{t?this.state.checkedItems.add(e):this.state.checkedItems.delete(e),i&&this.setState({checkedItems:new Set(this.state.checkedItems)})},this.isGroupBatchSelected=e=>{if(!e)return!1;const i=e.items;if(!i||i.length<=0)return!1;const{checkedItems:n}=this.state;return i.every((e=>n.has(e.sid)||!t(e,this.props)))},this.toggleAll=e=>{const{checkedItems:i}=this.state,n=0===i.size;for(const i in e){const s=e[i].items;for(const e of s)t(e,this.props)&&this.setId(e.sid,n,!1)}this.setState({checkedItems:new Set(this.state.checkedItems)})},this.setState({expandedGroups:{},checkedItems:new Set,selectMode:!1})}render(){const{checkedItems:t,selectMode:i,expandedGroups:n}=this.state;return(0,r.h)(e,Object.assign({},this.props,{onCheckboxClick:this.onCheckboxClick,onSelectItem:this.checkItem,onSelectGroup:this.checkGroup,onSelectAll:this.toggleAll,clearSelected:this.clearSelected,toggleSelectMode:this.toggleSelectMode,selectMode:i,selectedItems:t,expandedGroups:n,onExpandChange:this.setGroupExpandState,isGroupBatchSelected:this.isGroupBatchSelected}))}}}(TagsList);var Ca=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ia=class TagsToolPanel extends r.Component{constructor(e){super(e),this.bindings=[],this.tagClosedTimeout=0,this.updateTagViews=()=>{const e=this.props.manager.dataMap.tagsViewData.getEnabledTagViews();this.setState({tagViews:e.values()})},this.updateListIndex=()=>{const e=this.props.manager.dataMap.tagsViewData.listIndex;this.setState({listIndex:e})},this.updateCurrentTag=async()=>{const{manager:e,toolPanelLayout:t}=this.props,{currentTag:i}=this.state,n=e.dataMap.tagsViewData,{openTagView:s,selectedPreview:r}=n,o=t===d.wS.SIDE_PANEL||t===d.wS.BOTTOM_PANEL;!s||r||i&&o?i&&o&&(!s||r)?this.startClosingTagWidget():this.setState({currentTag:s}):this.startOpeningTagWidget()},this.openTagFromList=e=>{const t=this.props.toolPanelLayout===d.wS.SIDE_PANEL?Te.n.FadeToBlack:Te.n.Instant;this.context.commandBinder.issueCommand(new rs.$b(e,ss.Er.MATTERTAG,t))},this.state={tagClosing:!1,tagViews:[],currentTag:null,listIndex:-1}}componentDidMount(){const{manager:e}=this.props,{tagsViewData:t}=e.dataMap;this.bindings.push(t.onOpenTagViewChanged(this.updateCurrentTag),t.onListIndexChanged(this.updateListIndex),t.getEnabledTagViews().onChanged(this.updateTagViews)),this.updateTagViews(),this.updateCurrentTag(),this.updateListIndex()}componentWillUnmount(){window.clearTimeout(this.tagClosedTimeout);for(const e of this.bindings)e.cancel()}startOpeningTagWidget(){const{manager:e}=this.props,t=e.dataMap.tagsViewData;window.clearTimeout(this.tagClosedTimeout),this.setState({currentTag:t.openTagView,tagClosing:!1})}startClosingTagWidget(){this.state.tagClosing||(this.setState({tagClosing:!0}),this.tagClosedTimeout=window.setTimeout((()=>{this.setState({currentTag:null,tagClosing:!1})}),To.El))}render(){const{toolPanelLayout:e,manager:t}=this.props,{tagClosing:i,tagViews:n,listIndex:s,currentTag:o}=this.state,a=e===d.wS.SIDE_PANEL||e===d.wS.BOTTOM_PANEL;if(!i&&!a)return null;const{editMode:l,settings:c}=this.context,h=n.length,u=c.tryGetProperty("features/batch-select",!1);return(0,r.h)("div",{class:"tool-panel tags-panel"},(0,r.h)(sa,{manager:t,closing:i,tag:o,toolPanelLayout:e,numTags:h,listIndex:s}),l&&(0,r.h)(Da,{manager:t,active:i||!o,toolPanelLayout:e,onOpenTag:this.openTagFromList,batchSelectEnabled:u}))}};Ia=Ca([N.Z],Ia);var La=i(48470),Ra=i(8752),Na=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let ka=class OptionsMenu extends r.Component{constructor(e){super(e),this.popupOpened=e=>{const{assetId:t}=this.props;e.id!==t&&this.setState({open:!1})},this.toggleMenu=e=>{const t=e.clientY+this.popupMenu.offsetHeight+ne.POPUP_OFFSET>window.innerHeight?ee.BOTTOM_RIGHT:ee.TOP_RIGHT;this.setState((e=>{const i=!e.open;return i&&this.context.messageBus.broadcast(new ze.nZ(this.props.assetId)),{arrowPosition:t,open:i}}))},this.closeMenu=()=>{this.setState({open:!1})},this.clickMenu=e=>{e.stopPropagation(),this.setState({open:!1})},this.setPopupMenu=e=>{e&&(this.popupMenu=e)},this.state={open:!1,arrowPosition:ee.TOP_RIGHT}}componentDidMount(){this.context.messageBus.subscribe(ze.nZ,this.popupOpened)}componentWillUnmount(){this.context.messageBus.unsubscribe(ze.nZ,this.popupOpened)}renderMenu(){const{children:e}=this.props,{open:t}=this.state;return(0,r.h)("div",{ref:this.setPopupMenu,class:"tooltip-menu",onClick:this.clickMenu},t&&e)}render(){const{assetId:e}=this.props,{open:t,arrowPosition:i}=this.state;return(0,r.h)(T.h,{buttonStyle:T.D.SOCIAL,buttonSize:_.qE.SMALL,iconClass:"icon-more-vert item-more-options",dataValue:e,onClick:this.toggleMenu},(0,r.h)(ne,{open:t,onClose:this.closeMenu,message:this.renderMenu(),arrowPos:i,bodyClassName:"item-tooltip"}))}};ka=Na([N.Z],ka);var Ba=i(61481),Fa=i(80161),Ua=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{INVITE_USER:Va,INVITE_VIEWER_BUTTON:Ha,INVITE_EDITOR_BUTTON:Ga,INVITE_USERS:za,INVITE_VIEWERS_BUTTON:Wa,INVITE_EDITORS_BUTTON:ja,INVITE_VISIBLE_MSG:Ka}=m.Z.USERS;let qa=class UserInviteCard extends r.Component{constructor(e){super(e),this.onInviteUsers=()=>{this.props.onInviteUsers(this.props.invitees)}}render(){const{invitees:e,modelAccess:t}=this.props;if(0===e.length)return null;const{locale:i}=this.context,n=t===Fa.x.FULL;let s,o;1===e.length?(s=i.t(Va,{email:e[0]}),o=i.t(n?Ga:Ha)):(s=i.t(za,{emails:e.join(", ")}),o=i.t(n?ja:Wa));const a=i.t(Ka);return(0,r.h)("div",{class:"user-invite-card"},(0,r.h)("div",{class:"user-invite-info"},(0,r.h)("span",{class:"icon icon-eye-show"}),(0,r.h)("span",{class:""},a)),(0,r.h)("p",{class:"user-invite-msg"},s),(0,r.h)(_.zx,{onClick:this.onInviteUsers,buttonStyle:_.ZJ.TERTIARY,className:l()("button-inline","user-invite-button")},o))}};qa=Ua([N.Z],qa);var Za=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{INVITE_VISIBLE_MSG:Ya,INVITE_USER_FAILED:$a,INVITE_USERS_FAILED:Qa}=m.Z.USERS;let Xa=class UserInviteError extends r.Component{constructor(e){super(e)}render(){const{failedEmails:e}=this.props,{locale:t}=this.context;if(0===e.length)return null;let i;i=1===e.length?t.t($a,{email:e[0]}):t.t(Qa,{failedEmails:e.join(", ")});const n=t.t(Ya);return(0,r.h)("div",{class:"user-invite-card"},(0,r.h)("div",{class:"user-invite-info"},(0,r.h)("span",{class:"icon icon-eye-show"}),(0,r.h)("span",{class:""},n)),(0,r.h)("p",{class:"user-invite-msg"},i))}};Xa=Za([N.Z],Xa);var Ja=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{UNKNOWN_USER:el,UNKNOWN_USERS:tl,INVITE_VISIBLE_MSG:il}=m.Z.USERS;let nl=class UnknownEmailCard extends r.Component{constructor(e){super(e)}render(){const{locale:e}=this.context,{emails:t}=this.props;if(0===t.length)return null;let i;i=1===t.length?e.t(el,{email:t[0]}):e.t(tl,{emails:t.join(", ")});const n=e.t(il);return(0,r.h)("div",{class:"user-invite-card"},(0,r.h)("div",{class:"user-invite-info"},(0,r.h)("span",{class:"icon icon-eye-show"}),(0,r.h)("span",{class:""},n)),(0,r.h)("p",{class:"user-invite-msg"},i))}};nl=Ja([N.Z],nl);var sl=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let rl=class UnknownUserMention extends r.Component{constructor(e){super(e),this.invitationAccess=Fa.x.FULL,this.inviteUsers=async e=>{if(0===e.length)return;const{noteId:t,message:i}=this.props;await this.context.commandBinder.issueCommand(new Uo.JB(e,i,this.invitationAccess,t))}}getInvitees(){const{userMentions:e}=this.props,t=[];return e.forEach((e=>{(e.userStatus===Ba.J.MENTIONED||e.userStatus===Ba.J.KNOWN&&e.modelAccess===Fa.x.PUBLIC)&&t.push(e.email)})),t}getFailedEmails(){const{userMentions:e}=this.props,t=[];return e.forEach((e=>{e.userStatus===Ba.J.FAILED&&t.push(e.email)})),t}render(){const{expires:e,noteId:t}=this.props;if((new Date).getTime()>e)return null;const{userData:i}=this.context,n=i.isInviter(),s=this.getInvitees(),o=this.getFailedEmails();return(0,r.h)("div",{class:"user-mentions-unknown"},n&&s.length>0&&(0,r.h)(qa,{invitees:s,modelAccess:this.invitationAccess,noteId:t,onInviteUsers:this.inviteUsers}),!n&&s.length>0&&(0,r.h)(nl,{emails:s}),o.length>0&&(0,r.h)(Xa,{failedEmails:o}))}};rl=sl([N.Z],rl);var ol=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let al=class Comment extends r.Component{constructor(e){super(e),this.editComment=()=>{const{comment:e}=this.props;this.trackEvent("notes_click_edit_comment"),this.context.commandBinder.issueCommand(new p.cS(e.id)),this.annotation&&this.annotation.edit()},this.deleteComment=()=>{const{noteId:e,comment:t}=this.props;this.trackEvent("notes_click_delete_comment"),this.context.commandBinder.issueCommand(new p.mH(e,t.id))},this.saveChanges=(e,t)=>{const{comment:i,noteId:n,onCancel:s}=this.props;t?(this.trackEvent("notes_delete_empty_comment"),this.context.commandBinder.issueCommand(new p.mH(n,i.id)),s()):this.context.commandBinder.issueCommand(new p.Uw(n,i.id,e))},this.setAnnotationRef=e=>{this.annotation=e}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}getUnknownMentions(){const{manager:e,comment:t,userMentionMap:i}=this.props;return e.dataMap.notesViewData.getCommentUserMentions(t.text,i)}renderAnnotation(e){const{comment:t,attachments:i,hashtags:n,active:s,onViewAttachment:o,manager:a,onCancel:l,toolPanelLayout:c}=this.props,{text:h,edited:d,id:u}=t;return(0,r.h)(ia,{key:u,textParser:a.getTextParser(),ref:this.setAnnotationRef,annotationType:Jo.COLLABORATION,assetType:Mo.h.COMMENT,assetId:u,attachments:i,editable:e,clickToEdit:!1,active:s,edited:d,creating:!1,text:h,hashtags:n,toolPanelLayout:c,onViewAttachment:o,onDoneEditing:this.saveChanges,onCancelEditing:l,maxLength:Ve.Ko})}render(){const{comment:e,active:t,noteId:i,manager:n}=this.props,{user:s,created:o,id:l,text:c}=e,{userData:h}=this.context,d=s.id===h.getCurrentUserId()&&h.isCommenter(),u=d||h.isEditor(),p=e.modified.getTime()+60*Ve.E8*1e3,m=h.getUserDisplay(s.email),g=m.color,f=n.getTextParser().getPlainText(c),v=this.getUnknownMentions();return(0,r.h)("div",{class:a("comment",{active:t}),"data-id":l},(0,r.h)("div",{class:"note-header comment-header"},(0,r.h)(Cs,{badgeStyle:{color:g,"border-color":g},label:m.initials}),(0,r.h)("div",{class:"note-details"},(0,r.h)("span",{class:"note-user"},m.name),(0,r.h)("div",{class:"note-subheader"},o.toLocaleString())),!t&&u&&(0,r.h)(ka,{assetId:l},d&&(0,r.h)("div",{class:"tpMsg",onClick:this.editComment},"Edit"),(0,r.h)("div",{class:"tpMsg",onClick:this.deleteComment},"Delete"))),this.renderAnnotation(d),d&&(0,r.h)(rl,{noteId:i,message:f,userMentions:v,expires:p}))}};al=ol([N.Z],al);var ll=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let cl=class ReplyBox extends r.Component{constructor(e){super(e),this.startReply=()=>{this.trackEvent("notes_click_new_comment"),this.context.commandBinder.issueCommand(new p.cS(this.props.replyId))},this.saveChanges=(e,t)=>{const{replyId:i,noteId:n,onCancel:s}=this.props;t?s():this.context.commandBinder.issueCommand(new p.Df(n,e,i))}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}render(){const{hashtags:e,replyId:t,active:i,onCancel:n,toolPanelLayout:s,manager:o}=this.props;return(0,r.h)(ia,{className:"reply-box",textParser:o.getTextParser(),annotationType:Jo.COLLABORATION,assetType:Mo.h.COMMENT,assetId:t,attachments:[],editable:!0,clickToEdit:!0,active:i,edited:!1,creating:!0,text:"",hashtags:e,toolPanelLayout:s,placeholder:"Reply...",onClickToEdit:this.startReply,onDoneEditing:this.saveChanges,onCancelEditing:n,maxLength:Ve.Ko})}};cl=ll([N.Z],cl);var hl=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let dl=class NoteHeader extends r.Component{constructor(e){super(e),this.editNote=()=>{this.trackEvent("notes_click_edit_note"),this.props.onEditNote()},this.deleteNote=()=>{const{note:e}=this.props;this.trackEvent("notes_click_delete_note"),this.context.commandBinder.issueCommand(new p.sG(e.id))},this.resolveNote=()=>{const{note:e}=this.props;this.trackEvent("notes_click_resolve_note"),this.context.commandBinder.issueCommand(new p.yp(e.id,!0))},this.unresolveNote=()=>{const{note:e}=this.props;this.trackEvent("notes_click_unresolve_note"),this.context.commandBinder.issueCommand(new p.yp(e.id,!1))},this.onCopyLink=async()=>{if(this.state.linkCopied)return;const e=this.createLinkToNote(),t=document.createElement("input");t.type="text",t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),this.setState({linkCopied:!0}),window.setTimeout((()=>{this.setState({linkCopied:!1})}),2500)},this.state={linkCopied:!1}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}createLinkToNote(){this.trackEvent("notes_click_copy_link");const e=jr.K.removeNavigationKeys((0,w.AO)());e.note=this.props.note.id;const t=Object.keys(e).map((t=>t+"="+e[t])).join("&");return`${window.location.origin}${window.location.pathname}?${t}`}render(){const{note:e,creatingNote:t,active:i,onCancelNote:n}=this.props,{linkCopied:s}=this.state,{userData:o}=this.context,a=e.user.id===o.getCurrentUserId()&&o.isCommenter(),l=a||o.isEditor(),c=o.getUserDisplay(e.user.email),h=c.color,d=!t&&!s&&!i,u=d&&l,p=u&&!e.resolved;return(0,r.h)("header",{class:"note-header"},(0,r.h)(Cs,{badgeStyle:{color:h,"border-color":h},label:c.initials}),(0,r.h)("div",{class:"note-details"},(0,r.h)("span",{class:"note-user"},c.name),(0,r.h)("div",{class:"note-subheader"},e.created.toLocaleString())),t&&(0,r.h)(T.h,{iconClass:"icon-close",buttonStyle:T.D.PLAIN,tooltipMsg:"Cancel",tooltipPosition:M.lZ.DOWN,onClick:n}),p&&(0,r.h)(T.h,{iconClass:"icon-checkmark",buttonStyle:T.D.SOCIAL,buttonSize:_.qE.SMALL,buttonState:_.BN.ENABLED,tooltipMsg:"Mark as resolved",tooltipPosition:M.lZ.DOWN,onClick:this.resolveNote}),d&&(0,r.h)(T.h,{iconClass:"icon-link",buttonStyle:T.D.SOCIAL,buttonSize:_.qE.SMALL,buttonState:_.BN.ENABLED,tooltipMsg:"Copy Link",tooltipPosition:M.lZ.DOWN,onClick:this.onCopyLink}),s&&(0,r.h)("div",{class:"link-copied"},"Link copied"),u&&(0,r.h)(ka,{assetId:e.id},a&&(0,r.h)("div",{class:"tpMsg",onClick:this.editNote},"Edit"),e.resolved&&(0,r.h)("div",{class:"tpMsg",onClick:this.unresolveNote},"Unresolve"),(0,r.h)("div",{class:"tpMsg",onClick:this.deleteNote},"Delete")))}};dl=hl([N.Z],dl);var ul=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let pl=class NotePost extends r.Component{constructor(e){super(e),this.bindings=[],this.startEditingNote=()=>{var e;const t=this.props.manager.dataMap.notesViewData.activeAnnotation;this.noteAnnotation&&t===(null===(e=this.props.note)||void 0===e?void 0:e.id)&&this.noteAnnotation.edit()},this.saveNoteChanges=async(e,t)=>{const{note:i,manager:n,onCancel:s}=this.props;i&&(t?s():n.dataMap.notesViewData.isNewNote?await this.context.commandBinder.issueCommand(new p.FB(e)):await this.context.commandBinder.issueCommand(new p.kd(i.id,e)))},this.onEditNote=()=>{const{note:e}=this.props;e&&this.context.commandBinder.issueCommand(new p.cS(e.id))},this.onFocusPin=()=>{this.props.manager.dataMap.notesViewData.isNewNote&&this.startEditingNote()},this.setNoteAnnotationRef=e=>{this.noteAnnotation=e}}componentDidMount(){const{messageBus:e}=this.context;this.bindings.push(e.subscribe(La.nY,this.onFocusPin))}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(e){this.props.active&&!e.active&&this.startEditingNote()}getExpirationTime(e){return e.modified.getTime()+60*Ve.E8*1e3}getUnknownMentions(e){const{manager:t,userMentionMap:i}=this.props;return t.dataMap.notesViewData.getCommentUserMentions(e.text,i)}renderUserMentionCards(e,t){const{manager:i}=this.props,n=i.getTextParser().getPlainText(t.text),s=this.getExpirationTime(t),o=this.getUnknownMentions(t);return 0===o.length?null:(0,r.h)(rl,{message:n,noteId:e.id,expires:s,userMentions:o})}render(){const{note:e,creatingNote:t,toolPanelLayout:i,attachments:n,hashtags:s,onCancel:o,active:a,manager:l,onViewAttachment:c}=this.props,{userData:h}=this.context,d=l.getTextParser(),u=null==e?void 0:e.comments.get(0),p=(null==u?void 0:u.text)||"",m=(null==u?void 0:u.edited)||!1,g=!e||e.user.id===h.getCurrentUserId(),f=!!g&&h.isCommenter(),v=(null==u?void 0:u.id)||(null==e?void 0:e.id)||"",y=u?Mo.h.COMMENT:Mo.h.NOTE;return(0,r.h)("div",{class:"note-post"},e&&(0,r.h)(dl,{note:e,active:a,creatingNote:t,onEditNote:this.onEditNote,onCancelNote:o}),(0,r.h)(ia,{ref:this.setNoteAnnotationRef,textParser:d,annotationType:Jo.COLLABORATION,assetId:v,assetType:y,attachments:n,clickToEdit:!1,editable:f,active:a,edited:m,creating:t,text:p,hashtags:s,placeholder:"Add your message",toolPanelLayout:i,onViewAttachment:c,onDoneEditing:this.saveNoteChanges,onCancelEditing:o,maxLength:Ve.TM}),e&&u&&g&&this.renderUserMentionCards(e,u))}};pl=ul([N.Z],pl);class NoteWidget extends r.Component{constructor(e){super(e),this.bindings=[],this.scrollTimeout=0,this.cancelTimeout=0,this.updateAttachments=()=>{const{note:e,manager:t}=this.props,i=e?t.dataMap.notesViewData.getNoteAttachments(e.id):[];this.setState({attachments:i})},this.updateHashtags=()=>{const{hashtagData:e}=this.props.manager.dataMap;this.setState({hashtags:e.getHashtags()})},this.updateActiveAnnotation=()=>{const{notesViewData:e}=this.props.manager.dataMap;this.setState({activeAnnotation:e.activeAnnotation})},this.updateUserMentionMap=()=>{this.setState({userMentionMap:this.context.userData.getUsersWhoMayNeedAccess()})},this.updateToolAssetAccess=()=>{this.setState({toolAccess:this.context.toolsData.toolAccess})},this.closeNotesMode=()=>{this.context.commandBinder.issueCommand(new Ge.tT(d.w1.NOTES,!1))},this.onAssetFocus=e=>{e.assetType===Mo.h.COMMENT&&this.props.onFocusScroll(`[data-id='${e.assetId}']`)},this.scrollToTextBox=e=>{const{focused:t,textElement:i}=e,{activeAnnotation:n}=this.state;window.clearTimeout(this.scrollTimeout),n&&t&&i&&(this.scrollTimeout=window.setTimeout((()=>{i.scrollIntoView()}),400))},this.cancelNoteChanges=()=>{const{note:e,manager:t}=this.props,{activeAnnotation:i}=this.state;window.clearTimeout(this.cancelTimeout),t.dataMap.notesViewData.isNewNote?this.setState({cancellingCreation:!0},(()=>{this.closeNote(),this.cancelTimeout=window.setTimeout((()=>{this.setState({cancellingCreation:!1})}),500)})):e&&i&&this.cancelCommentChanges()},this.cancelCommentChanges=()=>{this.context.commandBinder.issueCommand(new p.oH)},this.closeNote=()=>{this.props.manager.dataMap.notesViewData.isNewNote?this.context.commandBinder.issueCommand(new p.gc):this.context.commandBinder.issueCommand(new p._N)},this.onViewAttachment=(e,t)=>{const{attachments:i}=this.state;if(i.length){this.trackEvent("notes_click_view_attachment");const e=i.filter((e=>(0,ls.lV)(e)));e.length>0&&this.context.commandBinder.issueCommand(new cs.xW(!0,e,t))}},this.onNavigate=e=>{this.props.onSwitchAnnotation(e)},this.state={activeAnnotation:null,toolAccess:d.X$.SCENE,hashtags:[],attachments:[],userMentionMap:{},cancellingCreation:!1}}componentDidMount(){const{notesViewData:e,hashtagData:t,attachmentsData:i}=this.props.manager.dataMap,{toolsData:n,userData:s,messageBus:r}=this.context;this.bindings.push(n.onToolAssetAccessChanged(this.updateToolAssetAccess),t.onChanged(this.updateHashtags),e.onActiveAnnotationChanged(this.updateActiveAnnotation),i.onChanged(this.updateAttachments),s.onUsersChanged(this.updateUserMentionMap),r.subscribe(ue.ZL,this.onAssetFocus),r.subscribe(Vt.S,this.scrollToTextBox)),this.updateToolAssetAccess(),this.updateHashtags(),this.updateActiveAnnotation(),this.updateUserMentionMap(),this.updateAttachments()}componentWillUnmount(){window.clearTimeout(this.scrollTimeout),window.clearTimeout(this.cancelTimeout);for(const e of this.bindings)e.cancel()}componentDidUpdate(e,t){const{note:i}=this.props;e.note!==i&&(this.updateAttachments(),i&&window.clearTimeout(this.cancelTimeout)),this.handleMissingAnnotation()}shouldComponentUpdate(){return!this.state.cancellingCreation}handleMissingAnnotation(){const{note:e,manager:t,creatingNote:i}=this.props,{activeAnnotation:n}=this.state;if(i||!n)return;const{notesViewData:s}=t.dataMap;if(e){const i=e.id;n===i||n===t.getReplyId(e)||s.getComment(i,n)||s.setActiveAnnotation(null)}else s.setActiveAnnotation(null)}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}getCommentAttachments(e){return this.state.attachments.filter((t=>t.assetId===e))}getNotePostAttachments(){const{note:e}=this.props;if(!e)return[];const t=e.comments.get(0);return t?this.state.attachments.filter((e=>e.assetId===t.id)):[]}renderReplyBox(){const{note:e,toolPanelLayout:t,manager:i}=this.props;if(!e)return null;const{activeAnnotation:n,hashtags:s}=this.state,o=i.getReplyId(e),a=n===o;return a||null===n?(0,r.h)(cl,{key:`reply-${e.comments.length}`,replyId:o,noteId:e.id,active:a,hashtags:s,manager:i,toolPanelLayout:t,onCancel:this.cancelCommentChanges}):null}renderComments(){const{note:e,toolPanelLayout:t,manager:i}=this.props;if(!e)return null;const{activeAnnotation:n,hashtags:s,userMentionMap:o}=this.state;return(0,r.h)("div",{class:"note-comments"},e.comments.map(((a,l)=>{if(0===l)return null;const c=this.getCommentAttachments(a.id);return(0,r.h)(al,{key:a.id,manager:i,comment:a,noteId:e.id,attachments:c,active:n===a.id,hashtags:s,userMentionMap:o,toolPanelLayout:t,onCancel:this.cancelCommentChanges,onViewAttachment:this.onViewAttachment})})))}renderNoteNavHeader(){const{listIndex:e,numAnnotations:t,creatingNote:i,note:n,toolPanelLayout:s}=this.props;if(i||!n)return null;const{toolAccess:o,activeAnnotation:a}=this.state,l=!i&&!a&&t>1&&-1!==e,c=s===d.wS.SIDE_PANEL,h=o===d.X$.SCENE,u=o===d.X$.LIST||!h&&c,p=u?"Back":"Close",m=u?"icon-back":"icon-close",g=u||!h?this.closeNote:this.closeNotesMode;return(0,r.h)("div",{class:"detail-panel-header"},(0,r.h)(Do,{label:p,className:"return-btn",icon:m,buttonSize:_.qE.SMALL,buttonStyle:_.ZJ.TOOLBAR,onClick:g}),l&&(0,r.h)(Io,{index:e,total:t,disabled:!1,wrapAround:!0,onNavigate:this.onNavigate}))}render(){const{manager:e,note:t,toolPanelLayout:i,notesPhase:n,creatingNote:s}=this.props,{activeAnnotation:o,hashtags:l,userMentionMap:c}=this.state,{userData:h}=this.context,d=h.isCommenter(),u=t?t.id:"new",p=!!o&&(o===u||s),m={annotating:!!o,creating:s},g=this.getNotePostAttachments();return(0,r.h)("div",{class:a("note-widget",m)},this.renderNoteNavHeader(),(0,r.h)(pl,{active:p,manager:e,note:t,toolPanelLayout:i,notesPhase:n,creatingNote:s,attachments:g,userMentionMap:c,hashtags:l,onCancel:this.cancelNoteChanges,onViewAttachment:this.onViewAttachment}),!s&&this.renderComments(),!s&&d&&this.renderReplyBox())}}class StemEditor extends r.Component{constructor(e){super(e),this.stemLengthUpdating=(e,t=!0)=>{const i=t?(0,dn._F)(e):e;i!==this.props.stemLength&&this.props.onLengthUpdate(i)},this.saveStemLength=(e,t=!0)=>{const i=t?(0,dn._F)(e):e;this.props.onLengthChanged(i)},this.onChangeStemEnabled=()=>{this.props.onStemEnabledChanged(!this.props.stemEnabled)},this.stopPropagation=e=>e.stopPropagation(),this.updateUnits=()=>{this.setState({units:this.context.settings.tryGetProperty(x.gx.Units,un.M.IMPERIAL)})},this.formatStemHeight=e=>{if(this.state.units===un.M.IMPERIAL)return hn(e);return`${Math.round(100*(0,dn._F)(e))/100}m`},this.state={units:un.M.IMPERIAL}}componentDidMount(){this.updateUnits(),this.slider.setValue((0,dn.zy)(this.props.stemLength)),this.context.settings.onPropertyChanged(x.gx.Units,this.updateUnits)}componentWillUnmount(){this.context.settings.removeOnPropertyChanged(x.gx.Units,this.updateUnits)}componentWillReceiveProps(e){e.stemLength!==this.props.stemLength&&this.slider.setValue((0,dn.zy)(e.stemLength))}render(){const{stemEnabled:e,stemLength:t}=this.props;return(0,r.h)("div",{class:"stem-editor",onClick:this.stopPropagation},(0,r.h)("div",{class:"stem-slider"},(0,r.h)(SliderWithTooltip,{ref:e=>this.slider=e,discrete:!1,min:.1,max:9,initialValue:(0,dn.zy)(t),onChange:this.saveStemLength,onInput:this.stemLengthUpdating,displayBounds:!0,width:150,formatNumbers:this.formatStemHeight,tooltipPosition:cn.DOWN})),(0,r.h)(Bt,{enabled:!0,checked:e,label:"Show Stem",onChange:this.onChangeStemEnabled}))}}var ml=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let gl=class PinAssetEditor extends r.Component{constructor(e){super(),this.closePinAssetEditor=e=>{e&&e.stopPropagation(),this.props.onClose()},this.handleColorPicked=e=>{this.trackEvent("pin_change_color"),this.props.onSave({color:e})},this.saveStemEnabled=e=>{this.trackEvent(e?"pin_show_stem":"pin_hide_stem"),this.props.onSave({stemEnabled:e})},this.saveStemLength=e=>{this.trackEvent("pin_change_stem_height"),this.props.onSave({stemLength:e})},this.previewStemLength=e=>{const{pin:t,pinType:i}=this.props;this.context.commandBinder.issueCommand(new rs.fe(t.id,i,e))},this.stopPropagation=e=>{e.stopPropagation()}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderStemEditor(){const{pin:e}=this.props;return(0,r.h)(StemEditor,{stemLength:e.stemLength,stemEnabled:e.stemEnabled,onLengthUpdate:this.previewStemLength,onLengthChanged:this.saveStemLength,onStemEnabledChanged:this.saveStemEnabled})}render(){const{toolPanelLayout:e,open:t,pin:i,colors:n}=this.props,s=e===d.wS.BOTTOM_PANEL;return t||s?(0,r.h)("div",{class:a("pin-tool-editor",{"tool-popup":!s,open:s&&t}),onClick:this.stopPropagation},(0,r.h)("div",{class:"tool-editor-title"},(0,r.h)("span",null,"Color & Stem"),(0,r.h)(te.P,{buttonStyle:te.A.LIGHT,onClose:this.closePinAssetEditor,hideTooltip:!0})),(0,r.h)(gn,{colors:n,defaultColor:i.color,onColorPicked:this.handleColorPicked}),this.renderStemEditor()):null}};gl=ml([N.Z],gl);var fl=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let vl=class NoteDetailsPanel extends r.Component{constructor(e){super(e),this.onFocusScroll=e=>{this.toolPanel.scrollToSelector(e)},this.closeEditor=()=>{this.context.commandBinder.issueCommand(new p.df(!1))},this.savePinAppearance=e=>{const{note:t}=this.props;t&&this.context.commandBinder.issueCommand(new p.oE(t.id,e))},this.setToolPanelRef=e=>{e&&(this.toolPanel=e)}}componentDidUpdate(e){var t,i;this.toolPanel&&(e.notesPhase!==Ra.U.EDITING&&this.props.notesPhase===Ra.U.EDITING||(null===(t=e.note)||void 0===t?void 0:t.id)!==(null===(i=this.props.note)||void 0===i?void 0:i.id)||e.modalOpen&&!this.props.modalOpen)&&this.toolPanel.resetScrollTop()}render(){const{note:e,numAnnotations:t,listIndex:i,notesPhase:n,closing:s,creatingNote:o,modalOpen:a,toolPanelLayout:l,onSwitchAnnotation:c,manager:h}=this.props,{userData:u}=this.context,p=(null==e?void 0:e.user.id)===u.getCurrentUserId()&&u.isCommenter(),m=u.isEditor(),g=n===Ra.U.EDITING,f=l===d.wS.BOTTOM_PANEL,v=!(!e||s||f&&a),y=g&&f;return(0,r.h)(DetailPanel,{ref:this.setToolPanelRef,open:v,toolPanelLayout:l,scrollingDisabled:y},(0,r.h)(NoteWidget,{manager:h,note:e,toolPanelLayout:l,notesPhase:n,creatingNote:o,numAnnotations:t,listIndex:i,onSwitchAnnotation:c,onFocusScroll:this.onFocusScroll}),e&&f&&(m||p)&&(0,r.h)(gl,{key:e.id,pin:e,pinType:ss.Er.NOTE,onSave:this.savePinAppearance,onClose:this.closeEditor,colors:Ve.ZP.colors,open:g,toolPanelLayout:l}))}};vl=fl([N.Z],vl);class MissingNotePanel extends r.Component{constructor(e){super(e)}render(){const{message:e,onClose:t,toolPanelLayout:i,closing:n}=this.props;return(0,r.h)(DetailPanel,{open:!n,toolPanelLayout:i,scrollingDisabled:!1},(0,r.h)("div",{class:"missing-note-panel"},(0,r.h)("div",{class:"detail-panel-header"},(0,r.h)(Do,{label:"Back",className:"return-btn",icon:"icon-back",buttonSize:_.qE.SMALL,buttonStyle:_.ZJ.TOOLBAR,onClick:t})),(0,r.h)("div",{class:"missing-note-panel-message"},e)))}}var yl=i(84834);const{NOTES:bl}=m.Z.SHOWCASE;var Sl;!function(e){e.TODAY="Today",e.YESTERDAY="Yesterday",e.THIS_WEEK="This week",e.ONE_WEEK_AGO="1 week ago",e.TWO_WEEKS_AGO="2 weeks ago",e.THREE_WEEKS_AGO="3 weeks ago",e.OLDER="Older"}(Sl||(Sl={}));class AnnotationsList extends r.Component{constructor(e){super(e),this.bindings=[],this.transitionTimeout=0,this.updateNoteFilter=()=>{const e=this.props.manager.dataMap.notesViewData;this.setState({filter:e.notesFilter})},this.transitionNoteOut=e=>{const{filter:t}=this.state,i=e.resolved&&t===yl.$.OPEN?e.id:null;this.setState({filteringOutId:i}),window.clearTimeout(this.transitionTimeout),i&&(this.transitionTimeout=window.setTimeout((()=>{this.setState({filteringOutId:null})}),To.g))},this.updateNoteGroups=()=>{const e=this.getSortedNoteGroups();this.setState({listGroups:e})},this.onSelectAnnotation=e=>{this.trackEvent("notes_list_open_note");const[t,i]=e.split("-");this.openAnnotation(i,t,!1)},this.editNote=e=>{this.trackEvent("notes_list_edit_note"),this.openAnnotation(e.id,Mo.h.NOTE,!0)},this.deleteNote=e=>{this.trackEvent("notes_list_delete_note"),this.context.commandBinder.issueCommand(new p.sG(e.id))},this.openNotesIntro=()=>{this.context.commandBinder.issueCommand(new ce.Bz(le.P.NOTES_INTRO,!0))},this.changeFilter=(e,t)=>{if(t){const e=t;this.trackEvent("notes_list_change_filter"),this.props.manager.dataMap.notesViewData.setNotesFilter(e)}},this.toggleFilter=e=>{e.stopPropagation(),this.setState((e=>({filterMenuOpen:!e.filterMenuOpen})))},this.closeFilter=()=>{this.setState({filterMenuOpen:!1})},this.onCloseLayer=async e=>{e&&e.stopPropagation(),await this.context.commandBinder.issueCommand(new Ge.tT(d.w1.NOTES,!1))},this.getMenuOptions=(e,t)=>{const i=()=>this.editNote(e),n=()=>this.deleteNote(e);return t?[[bl.EDIT_LIST_ITEM_OPTION_CTA,i],[bl.DELETE_LIST_ITEM_OPTION_CTA,n]]:[[bl.DELETE_LIST_ITEM_OPTION_CTA,n]]},this.state={listGroups:{},filter:yl.$.OPEN,filterMenuOpen:!1,filteringOutId:null}}componentDidMount(){const{notesViewData:e}=this.props.manager.dataMap,{messageBus:t}=this.context;this.bindings.push(e.onNotesFilterChanged(this.updateNoteFilter),t.subscribe(We.hY,this.transitionNoteOut)),this.textParser=new Fi.v({links:!0,hashtags:!0,users:this.context.userData}),this.updateNoteGroups(),this.updateNoteFilter()}componentWillUnmount(){window.clearTimeout(this.transitionTimeout);for(const e of this.bindings)e.cancel()}componentDidUpdate(e,t){e.annotationViews===this.props.annotationViews&&t.filter===this.state.filter&&e.searchBlock===this.props.searchBlock||this.updateNoteGroups()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}getSortedNoteGroups(){const e={};return this.props.annotationViews.forEach((t=>{const i=this.getDateBucket(t.createdTime);e[i]||(e[i]={dateBucket:i,items:[]}),e[i].items.push(t)})),e}getDateBucket(e){const t=new Date(e),i=new Date;i.setHours(0,0,0,0),t.setHours(0,0,0,0);const n=(i.getTime()-t.getTime())/864e5;if(0===n)return Sl.TODAY;if(1===n)return Sl.YESTERDAY;if(n<7)return Sl.THIS_WEEK;const s=Math.floor(n/7);return 1===s?Sl.ONE_WEEK_AGO:2===s?Sl.TWO_WEEKS_AGO:3===s?Sl.THREE_WEEKS_AGO:Sl.OLDER}openAnnotation(e,t,i){this.context.commandBinder.issueCommand(new p.uT(e,t,i))}getEmptyMessage(){const{searchBlock:e}=this.props,{filter:t}=this.state;return e?"No matches":t===yl.$.OPEN?"You don't have any open notes.":t===yl.$.RESOLVED?"You don't have any resolved notes.":"You don't have any notes yet."}getAnnotationText(e){let t=e.text;if(""===t){const i=e.numAttachments,n=e.numComments-1;1===i?t="1 attachment":i>1?t=`${i} attachments`:0===n&&(t="Original content was deleted")}return t}getListTitle(){const{annotationViews:e,searchBlock:t}=this.props;let i;const n=e.length;return i=t?1===n?"1 Result":`${n} Results`:1===n?"1 Note":`${n} Notes`,(0,r.h)("div",{class:"list-panel-title"},i,(0,r.h)("span",{class:"word-badge"},"Beta"),(0,r.h)(T.h,{iconClass:"icon-question",buttonStyle:T.D.PLAIN,onClick:this.openNotesIntro}))}renderAnnotationSummary(e){const t=this.getAnnotationText(e);return(0,r.h)("div",{class:l()("note-text",{"note-summary-info":!e.text})},(0,r.h)(Rs,{text:t,textParser:this.textParser}))}renderItem(e,t){const{filteringOutId:i}=this.state,{searchBlock:n}=this.props,{id:s,user:o,color:a,assetType:c,numComments:h}=e,d=`${c}-${s}`,{userData:u}=this.context,p=o.id===u.getCurrentUserId()&&u.isCommenter(),m=p||u.isEditor(),g=u.getUserDisplay(o.email),f=h-1,v=1===f?`${f} reply`:`${f} replies`,y=l()("note-header",{"accordion-item-with-options":m,"accordion-item-closing":s===i});return(0,r.h)(da,{key:d,sid:d,className:y,enabled:!0,selected:!1,onSelect:this.onSelectAnnotation},(0,r.h)(Cs,{badgeStyle:{"background-color":a,"border-color":a},iconClass:"icon-comment"}),(0,r.h)("div",{class:"note-details"},(0,r.h)("span",{class:"note-user"},g.name),f>0&&!n&&(0,r.h)("span",{class:"note-summary-info note-replies"},v),this.renderAnnotationSummary(e)),!n&&m&&(0,r.h)(AccordionOptionsButton,{id:s,menu:this.getMenuOptions(e,p)}))}renderGroups(){const{listGroups:e,filteringOutId:t}=this.state,i=[];for(const n in e){const s=e[n];i.push((0,r.h)(ca,{key:n,id:n,header:s.dateBucket,open:!0,doubleLine:!0,naturalHeight:!!t},s.items.map(((e,t)=>this.renderItem(e,t)))))}return i}renderFilter(){const{filter:e,filterMenuOpen:t}=this.state,i=[{text:"Unresolved",value:yl.$.OPEN,selected:e===yl.$.OPEN},{text:"Resolved",value:yl.$.RESOLVED,selected:e===yl.$.RESOLVED},{text:"All",value:yl.$.ALL,selected:e===yl.$.ALL}];return(0,r.h)("div",{class:"list-menu note-filter"},(0,r.h)(SelectMenu,{className:"filter-note-select",menuStyle:se.DROPDOWN,open:t,onToggle:this.toggleFilter,onSelect:this.changeFilter,onClose:this.closeFilter,options:i}))}renderAnnotations(){const{annotationViews:e}=this.props;if(0===e.length){const e=this.getEmptyMessage();return(0,r.h)("div",{class:"empty-message"},e)}return(0,r.h)(va,null,this.renderGroups())}renderFeedbackLink(){return(0,r.h)("div",{class:"feedback"},(0,r.h)("a",{class:"link",href:"https://forms.gle/LkkQ1kphFKGtBFfUA",target:"_blank"},"Feedback",(0,r.h)("span",{class:"icon icon-comment-outline"})))}renderSearchHeader(){const{searchBlock:e,onCancelSearch:t}=this.props;return e?(0,r.h)("div",{class:"list-search"},(0,r.h)("span",{class:"search-term"},e.text),(0,r.h)(_.zx,{buttonStyle:_.ZJ.PLAIN,onClick:t},"Clear")):null}renderSubheader(){return(0,r.h)("div",{class:"list-subheaders"},this.renderSearchHeader(),this.renderFilter())}render(){const{active:e,toolPanelLayout:t,searchBlock:i}=this.props,n=!!i&&i.blockType===Bi.C.USER,s=!!i&&i.blockType===Bi.C.HASH;return(0,r.h)(ListPanel,{active:e,className:"annotations-list-panel",title:this.getListTitle(),subheader:this.renderSubheader(),toolPanelLayout:t,onClose:this.onCloseLayer},(0,r.h)("div",{class:l()("list-contents","annotations-list",{"search-results-user":n,"search-results-hash":s})},this.renderAnnotations(),this.renderFeedbackLink()))}}var El=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let wl=class NotesPanel extends r.Component{constructor(e){super(e),this.bindings=[],this.detailPanelClosedTimeout=0,this.updateAnnotationViews=()=>{const e=this.props.manager.dataMap.notesViewData.getAnnotationViewList();this.setState({annotationViews:e.values()})},this.updateListIndex=()=>{const e=this.props.manager.dataMap.notesViewData.listIndex;this.setState({listIndex:e})},this.updateNotesPhase=()=>{this.setState({notesPhase:this.props.manager.dataMap.notesViewData.notesPhase})},this.pinPlaced=e=>{e.pinType===ss.Er.NOTE&&this.startOpeningNoteWidget()},this.openMissingNotePanel=()=>{window.clearTimeout(this.detailPanelClosedTimeout),this.setState({missingNote:!0,detailPanelClosing:!1})},this.startClosingDetailPanel=()=>{this.state.detailPanelClosing||(this.setState({detailPanelClosing:!0}),this.detailPanelClosedTimeout=window.setTimeout((()=>{this.setState({currentNote:null,missingNote:!1,detailPanelClosing:!1})}),To.El))},this.updateCurrentNote=async()=>{const{currentNote:e}=this.state,t=this.props.manager.dataMap.notesViewData,i=t.notesPhase,n=this.placingNewNote(i),s=t.openNoteView;n?e&&this.startClosingDetailPanel():!e&&s?(this.setState({missingNote:!1}),this.startOpeningNoteWidget()):e&&!s?this.startClosingDetailPanel():this.setState({currentNote:s})},this.updateSearchTerm=()=>{const e=this.props.manager.dataMap.annotationsViewData;this.setState({searchBlock:e.searchBlock})},this.onSwitchAnnotation=async e=>{const t=this.state.annotationViews[e];if(!t)return;const i=t.assetType===Mo.h.COMMENT,n=i&&t.assetId?t.assetId:t.id,s=this.props.toolPanelLayout===d.wS.SIDE_PANEL?Te.n.FadeToBlack:Te.n.Instant;this.context.commandBinder.issueCommand(new cs.xW(!1)),await this.context.commandBinder.issueCommand(new rs.$b(n,ss.Er.NOTE,s,void 0,e)),i&&this.context.messageBus.broadcast(new ue.ZL(Mo.h.COMMENT,t.id))},this.onCancelSearch=()=>{this.context.commandBinder.issueCommand(new Ro.B)},this.state={detailPanelClosing:!1,annotationViews:[],notesPhase:Ra.U.CLOSED,currentNote:null,searchBlock:null,listIndex:-1,missingNote:!1}}componentDidMount(){const{notesViewData:e,annotationsViewData:t}=this.props.manager.dataMap,{messageBus:i}=this.context;this.bindings.push(e.onNotesPhaseChanged(this.updateNotesPhase),e.onOpenNoteViewChanged(this.updateCurrentNote),e.onListIndexChanged(this.updateListIndex),e.getAnnotationViewList().onChanged(this.updateAnnotationViews),t.onSearchBlockChanged(this.updateSearchTerm),i.subscribe(La.b0,this.pinPlaced),i.subscribe(We.pn,this.openMissingNotePanel)),this.updateAnnotationViews(),this.updateCurrentNote(),this.updateListIndex(),this.updateNotesPhase(),this.updateSearchTerm()}componentWillUnmount(){window.clearTimeout(this.detailPanelClosedTimeout);for(const e of this.bindings)e.cancel()}placingNewNote(e){return e===Ra.U.CREATING}startOpeningNoteWidget(){const e=this.props.manager.dataMap.notesViewData;window.clearTimeout(this.detailPanelClosedTimeout),this.setState({currentNote:e.openNoteView,detailPanelClosing:!1})}render(){const{toolPanelLayout:e,manager:t,modalOpen:i}=this.props,{notesViewData:n}=t.dataMap,{detailPanelClosing:s,searchBlock:o,annotationViews:a,listIndex:l,notesPhase:c,currentNote:h,missingNote:d}=this.state,u=s||!h&&!d,p=a.length,m=n.isNewNote;return(0,r.h)("div",{class:"tool-panel notes-panel"},d?(0,r.h)(MissingNotePanel,{message:"Note does not exist or may have been deleted.",closing:s,toolPanelLayout:e,onClose:this.startClosingDetailPanel}):(0,r.h)(vl,{manager:t,closing:s,note:h,modalOpen:i,toolPanelLayout:e,notesPhase:c,creatingNote:m,numAnnotations:p,listIndex:l,onSwitchAnnotation:this.onSwitchAnnotation}),(0,r.h)(AnnotationsList,{manager:t,active:u,toolPanelLayout:e,annotationViews:a,searchBlock:o,onCancelSearch:this.onCancelSearch}))}};wl=El([N.Z],wl);var Tl,_l=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ml=Tl=class NotesOverlay extends r.Component{constructor(e){super(),this.bindings=[],this.touchDevice=(0,w.Jm)(),this.nudgeTimeout=0,this.updateNotesPhase=()=>{this.setState({notesPhase:this.props.manager.dataMap.notesViewData.notesPhase})},this.updateOpenNoteView=()=>{const e=this.props.manager.dataMap.notesViewData.openNoteView;e!==this.state.openNoteView&&(this.setState({openNoteView:e}),this.dismissNudge())},this.updateActiveAnnotation=()=>{const e=this.props.manager.dataMap.notesViewData.activeAnnotation;this.setState({activeAnnotation:e})},this.updateForPinChanges=()=>{const e=this.props.manager.dataMap.pinsViewData;this.setState({pinState:e.pinState,creationProgress:e.progress,screenPosition:e.screenPosition,canPlace:e.canPlace,canAdd:e.canAdd})},this.clickCTAButton=e=>{this.dismissNudge(),this.hasCancelCta()?(e.stopPropagation(),this.props.manager.dataMap.notesViewData.isNewNote&&this.context.commandBinder.issueCommand(new p.gc)):this.onStartAddingNote(e)},this.savePinAppearance=e=>{const{openNoteView:t}=this.state;t&&this.context.commandBinder.issueCommand(new p.oE(t.id,e))},this.onStartAddingNote=e=>{e.stopPropagation(),this.trackEvent("notes_overlay_click_add"),this.context.commandBinder.issueCommand(new p.VI)},this.deleteNote=()=>{const{openNoteView:e}=this.state;e&&(this.trackEvent("notes_overlay_click_delete"),this.context.commandBinder.issueCommand(new p.sG(e.id)))},this.closeEditor=()=>{this.context.commandBinder.issueCommand(new p.df(!1))},this.toggleColorPicker=e=>{e.stopPropagation();const{notesPhase:t}=this.state,i=t===Ra.U.EDITING;this.context.commandBinder.issueCommand(new p.df(!i)),this.setState({showAddNudge:!1})},this.state={showAddNudge:!1,notesPhase:Ra.U.CLOSED,pinState:ss.tS.IDLE,openNoteView:null,activeAnnotation:null,screenPosition:null,creationProgress:0,canPlace:!0,canAdd:!0}}componentDidMount(){const{notesViewData:e,pinsViewData:t}=this.props.manager.dataMap;this.bindings.push(e.onNotesPhaseChanged(this.updateNotesPhase),e.onOpenNoteViewChanged(this.updateOpenNoteView),e.onActiveAnnotationChanged(this.updateActiveAnnotation),t.onChanged(this.updateForPinChanges)),this.setNudge(),this.updateNotesPhase(),this.updateForPinChanges(),this.updateOpenNoteView(),this.updateActiveAnnotation()}componentWillUnmount(){window.clearTimeout(this.nudgeTimeout);for(const e of this.bindings)e.cancel()}setNudge(){this.context.settings.tryGetProperty(He.F.NotesAddNudgeSeen,!1)||this.nudgeTimeout||(this.nudgeTimeout=window.setTimeout((()=>{this.setState({showAddNudge:!0}),window.setTimeout((()=>{this.dismissNudge()}),Tl.DISMISS_NUDGE_TIMEOUT)}),Tl.SHOW_NUDGE_TIMEOUT))}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}hasCancelCta(){const{pinState:e}=this.state;return e===ss.tS.CREATING||e===ss.tS.PLACING}dismissNudge(){this.context.settings.setLocalStorageProperty(He.F.NotesAddNudgeSeen,!0),this.setState({showAddNudge:!1})}renderOverlayMessage(){const{pinState:e,canPlace:t}=this.state;if(e===ss.tS.CREATING||!this.touchDevice&&e===ss.tS.PLACING||!t){const e=this.touchDevice?"Press and hold on the space to add a note":"Click on the space to add a note",i=this.touchDevice?"Unable to add note here, press and hold on the space to add a note":"Unable to add note here, click on the space to add a note.",n=t?e:i;return(0,r.h)("div",{class:"overlay-message"},(0,r.h)("div",{class:"icon icon-notes"}),(0,r.h)("span",{class:"message"},n))}return null}renderProgressCircle(){const{creationProgress:e,screenPosition:t,pinState:i}=this.state;if(!(i===ss.tS.PRESSING&&e>0&&this.touchDevice)||!t)return null;const n={left:t.x-Tl.PROGRESS_RADIUS/2+"px",top:t.y-Tl.PROGRESS_RADIUS/2+"px"};return(0,r.h)("div",{class:"point-button-wrapper",style:n},(0,r.h)(Zn,{progress:100*e,innerRadius:Tl.PROGRESS_RADIUS,barWidth:Tl.PROGRESS_WIDTH},(0,r.h)("circle",{class:"point",cx:"0",cy:"0",r:"22",transform:"rotate(-90)",fill:"#fff"})))}renderTopBar(e){const{notesPhase:t,openNoteView:i}=this.state,{toolPanelLayout:n,manager:s}=this.props,{notesViewData:o}=s.dataMap,a=n===d.wS.SIDE_PANEL,l=o.isNewNote;if(a||l)return this.renderOverlayMessage();if(i&&e){const e=t!==Ra.U.OPENING&&!!i,n=t===Ra.U.EDITING?_.BN.ACTIVE:e?_.BN.ENABLED:_.BN.DISABLED;return(0,r.h)("div",{class:"overlay-bar overlay-top-right"},(0,r.h)(T.h,{iconClass:"icon-stem-height",buttonStyle:T.D.OVERLAY,buttonState:n,onClick:this.toggleColorPicker}))}return null}renderCta(e){const{showAddNudge:t,canAdd:i}=this.state,n=this.hasCancelCta(),s=i?_.BN.ENABLED:_.BN.DISABLED,o=!i||t?void 0:n?"Cancel note":"Add note";return(0,r.h)(T.h,{className:"overlay-cta-btn",buttonStyle:T.D.PRIMARY,buttonState:s,tooltipMsg:o,tooltipPosition:e,onClick:this.clickCTAButton},(0,r.h)("div",{class:l()("overlay-cta-rotate-btn",{"overlay-cta-cancel":n})},(0,r.h)("span",{class:"icon icon-plus"})))}renderActionBar(e){const{showAddNudge:t,notesPhase:i,activeAnnotation:n,pinState:s,openNoteView:o}=this.state;if(i===Ra.U.CLOSED||n)return null;const{toolPanelLayout:a}=this.props,c=s===ss.tS.CREATING||s===ss.tS.PLACING,h=i===Ra.U.EDITING,u=i===Ra.U.OPENING;if(a===d.wS.SIDE_PANEL){const i=!c&&!u&&!!o,n=h?_.BN.ACTIVE:i?_.BN.ENABLED:_.BN.DISABLED;return(0,r.h)("div",{class:"overlay-cta"},e&&(0,r.h)(T.h,{className:l()("overlay-cta-button-outer","overlay-cta-button-outer-left"),iconClass:"icon-stem-height",buttonStyle:T.D.OVERLAY,buttonState:n,tooltipMsg:"Change color & stem",tooltipPosition:M.lZ.DOWN,onClick:this.toggleColorPicker}),(0,r.h)(ne,{className:"tooltip-simple-medium",open:t,message:(0,r.h)("span",null,"Click to add a note to your Space."),arrowPos:ee.BOTTOM_CENTER}),this.renderCta(M.lZ.DOWN),e&&(0,r.h)(T.h,{className:"overlay-cta-button-outer",buttonStyle:T.D.OVERLAY,iconClass:"icon-delete",tooltipMsg:"Delete note",tooltipPosition:M.lZ.DOWN,buttonState:i?_.BN.ENABLED:_.BN.DISABLED,onClick:this.deleteNote}))}return(0,r.h)("div",{class:"overlay-cta"},this.renderCta(M.lZ.UP))}render(){const{toolPanelLayout:e,openModal:t}=this.props;if(t)return null;const{openNoteView:i,notesPhase:n}=this.state,{userData:s}=this.context,o=s.isCommenter(),a=o&&(null==i?void 0:i.id)===s.getCurrentUserId(),l=s.isEditor(),c=n===Ra.U.EDITING,h=e===d.wS.SIDE_PANEL;return(0,r.h)("div",{class:"overlay"},this.renderTopBar(a||l),o&&this.renderActionBar(a||l),i&&h&&l&&(0,r.h)(gl,{pin:i,pinType:ss.Er.NOTE,onSave:this.savePinAppearance,onClose:this.closeEditor,open:c,colors:Ve.ZP.colors,toolPanelLayout:e}),this.renderProgressCircle())}};Ml.PROGRESS_RADIUS=132,Ml.PROGRESS_WIDTH=8,Ml.SHOW_NUDGE_TIMEOUT=5e3,Ml.DISMISS_NUDGE_TIMEOUT=5e3,Ml=Tl=_l([N.Z],Ml);var xl=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Al=class TagsNavigationBar extends r.Component{constructor(e){super(),this.bindings=[],this.updateTagData=()=>{const{tagsViewData:e}=this.props.manager.dataMap,{listIndex:t,openTagView:i}=e;this.setState({listIndex:t,numTags:e.getEnabledTagViews().length,openTagView:i})},this.updatePinData=()=>{const{pinsViewData:e}=this.props.manager.dataMap;this.setState({pinState:e.pinState})},this.onNavigateList=e=>{this.props.manager.navigateInList(e,!1,this.props.toolPanelLayout)},this.state={pinState:ss.tS.IDLE,openTagView:null,listIndex:-1,numTags:0}}componentDidMount(){const{tagsViewData:e,pinsViewData:t}=this.props.manager.dataMap;this.bindings.push(e.onChanged(this.updateTagData),t.onChanged(this.updatePinData)),this.updateTagData(),this.updatePinData()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}render(){const{pinState:e,openTagView:t,listIndex:i,numTags:n}=this.state;return t&&e===ss.tS.SELECTED&&n>1?(0,r.h)("div",{class:"overlay-top-center tags-navigation-bar"},(0,r.h)("div",{class:"overlay-info"},(0,r.h)(Io,{index:i,total:n,disabled:!1,wrapAround:!0,onNavigate:this.onNavigateList}))):null}};Al=xl([N.Z],Al);var Ol=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Pl=class TagsOverlay extends r.Component{constructor(e){super(),this.bindings=[],this.updateTagData=()=>{this.setState({openTagView:this.props.manager.dataMap.tagsViewData.openTagView})},this.updatePinData=()=>{this.setState({pinState:this.props.manager.dataMap.pinsViewData.pinState})},this.state={pinState:ss.tS.IDLE,openTagView:null}}componentDidMount(){const{tagsViewData:e,pinsViewData:t}=this.props.manager.dataMap;this.bindings.push(e.onOpenTagViewChanged(this.updateTagData),t.onPinStateChanged(this.updatePinData)),this.updateTagData(),this.updatePinData()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}render(){const{toolPanelLayout:e,manager:t,openModal:i}=this.props;return i?null:(0,r.h)("div",{class:"overlay"},(0,r.h)(Al,{toolPanelLayout:e,manager:t}))}};Pl=Ol([N.Z],Pl);var Dl=i(60725),Cl=i(58878),Il=i(62518),Ll=i(41911);var Rl=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Nl=class SettingsBox extends r.Component{constructor(){super(...arguments),this.stopClickPropagation=e=>{e.stopPropagation()}}render(){const{children:e,open:t,className:i,close:n,arrowPosition:s}=this.props,o=(0,r.h)("div",{class:"settings-container settings-box",onClick:this.stopClickPropagation},e);return(0,r.h)(ne,{open:t,message:o,className:i,arrowPos:s,onClose:n})}};Nl=Rl([N.Z],Nl);var kl=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Bl=class SettingsToggle extends r.Component{render(){const{label:e,children:t,className:i}=this.props;return(0,r.h)("div",{class:l()("settings-toggle",i)},e&&(0,r.h)("div",{class:"settings-label"},e),t)}};Bl=kl([N.Z],Bl);var Fl=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ul=class Toggle extends r.Component{constructor(e,t){super(e),this.onClick=()=>{this.props.enabled&&this.props.onToggle()},this.locale={onSettingString:t.locale.t(m.Z.ON),offSettingString:t.locale.t(m.Z.OFF)};const i=Math.max(this.props.toggleTime||300);this.trackTransitionStyle=`transition: background-color ${i}ms`,this.thumbTransitionStyle=`${this.trackTransitionStyle}, left ${i}ms`}render(){const{id:e,toggled:t,enabled:i,onOffLabel:n}=this.props,s=t?this.locale.onSettingString:this.locale.offSettingString;return(0,r.h)("div",{class:a("reusable-toggle",{"toggle-on":t,enabled:i}),id:e,onClick:this.onClick},n&&(0,r.h)("span",{class:"toggle-label"},s),(0,r.h)("div",{style:this.trackTransitionStyle,class:"track"}),(0,r.h)("div",{style:this.thumbTransitionStyle,class:"thumb"}))}};Ul=Fl([N.Z],Ul);var Vl=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Hl=class RadioButton extends r.Component{constructor(e){super(e),this.onChange=e=>{this.props.onChange(e)}}render(){const{id:e,name:t,value:i,checked:n,children:s,enabled:o}=this.props,l=!o;return(0,r.h)("div",{class:a("radio-element","radio-button",{disabled:l})},(0,r.h)("input",{type:"radio",id:e,name:t,value:i,checked:n,onChange:this.onChange}),(0,r.h)("label",{for:e},s))}};Hl=Vl([N.Z],Hl);var Gl=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let zl=class MeasurementSettings extends r.Component{constructor(e,t){super(),this.propertiesToRefreshUi=[He.F.UnitType,He.F.MeasurementSnapping,He.F.MeasurementContinuousLines],this.close=()=>{this.setState({settingsOpen:!1})},this.updatePerSettings=()=>{this.setState({units:this.context.settings.tryGetProperty(He.F.UnitType,un.M.METRIC),snapping:this.context.settings.tryGetProperty(He.F.MeasurementSnapping,!1),continuousLines:this.context.settings.tryGetProperty(He.F.MeasurementContinuousLines,!1)})},this.toggleUnits=()=>{const e=this.state.units!==un.M.METRIC?un.M.METRIC:un.M.IMPERIAL;this.context.settings.setLocalStorageProperty(He.F.UnitType,e)},this.toggleSnapping=()=>{const e=this.state.snapping;this.context.settings.setLocalStorageProperty(He.F.MeasurementSnapping,!e)},this.toggleOpen=e=>{const{onToggle:t}=this.props;t&&t(e,!this.state.settingsOpen),this.setState((e=>({settingsOpen:!e.settingsOpen})))},this.toggleContinuousLines=()=>{const e=this.state.continuousLines;this.context.settings.setLocalStorageProperty(He.F.MeasurementContinuousLines,!e)},this.locale={continuousLinesString:t.locale.t(m.Z.MEASUREMENT_CONTINUOUS_LINES),snappingString:t.locale.t(m.Z.MEASUREMENT_SNAPPING),unitsString:t.locale.t(m.Z.MEASUREMENT_UNITS),imperialString:t.locale.t(m.Z.MEASUREMENT_IMPERIAL),metricString:t.locale.t(m.Z.MEASUREMENT_METRIC),settingsString:t.locale.t(m.Z.MEASUREMENT_SETTINGS),closeString:t.locale.t(m.Z.CLOSE)},this.state={settingsOpen:!1,units:un.M.METRIC,snapping:!1,continuousLines:!1}}async componentDidMount(){for(const e of this.propertiesToRefreshUi)this.context.settings.onPropertyChanged(e,this.updatePerSettings);this.updatePerSettings()}componentWillUnmount(){for(const e of this.propertiesToRefreshUi)this.context.settings.removeOnPropertyChanged(e,this.updatePerSettings)}render(){const{iconButtonStyle:e}=this.props,{settingsOpen:t}=this.state,{settingsString:i}=this.locale,n=e||T.D.OVERLAY;return(0,r.h)(T.h,{className:"measurement-settings-btn",buttonStyle:n,iconClass:"icon-settings",buttonState:t?_.BN.ACTIVE:_.BN.ENABLED,onClick:this.toggleOpen,tooltipMsg:!t&&i||void 0,tooltipPosition:M.lZ.DOWN},this.renderSettingsPopup())}renderSettingsPopup(){const{settingsOpen:e,units:t,snapping:i,continuousLines:n}=this.state,{continuousLinesString:s,snappingString:o,unitsString:a,imperialString:l,metricString:c}=this.locale,h=t===un.M.METRIC;return(0,r.h)(Nl,{className:"measurement-settings-popup",arrowPosition:ee.TOP_RIGHT,open:e,close:this.close},(0,r.h)(Bl,{label:o},(0,r.h)(Ul,{onToggle:this.toggleSnapping,enabled:!0,onOffLabel:!0,toggled:i})),(0,r.h)(Bl,{label:s},(0,r.h)(Ul,{onToggle:this.toggleContinuousLines,enabled:!0,onOffLabel:!0,toggled:n})),(0,r.h)(Bl,{label:a,className:"units-setting"},(0,r.h)("div",{class:"radio-group radio-buttons"},(0,r.h)(Hl,{name:"unit",value:un.M.IMPERIAL,id:"unit-imperial",enabled:!0,checked:!h,onChange:this.toggleUnits},l),(0,r.h)(Hl,{name:"unit",value:un.M.METRIC,id:"unit-metric",enabled:!0,checked:h,onChange:this.toggleUnits},c))))}};zl=Gl([N.Z],zl);const Wl={[Dl.au.CREATING]:!0,[Dl.au.CONFIRMING_POINT]:!0},jl={[Dl.au.IDLE]:!0,[Dl.au.CREATING]:!0,[Dl.au.CREATING_NEXT_POINT]:!0},Kl=(Dl.au.CREATING,Dl.au.CONFIRMING_POINT,{[Dl.au.IDLE]:!0,[Dl.au.CREATING]:!0,[Dl.au.CREATING_NEXT_POINT]:!0}),ql="measurement-mode-add-tooltip",Zl="measurement-mode-desktop-help",Yl="measurement-mode-mobile-help";var $l,Ql=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Xl=$l=class MeasurementsOverlay extends r.Component{constructor(e,t){super(),this.bindings=[],this.propertiesToRefreshUi=[He.F.UnitType,He.F.MeasurementSnapping,He.F.MeasurementContinuousLines,ql,Zl,Yl],this.onMeasurementModeDataChanged=()=>{const{measurementModeData:e}=this.props.manager.dataMap,t=e.selectedGroupInfo,i=e.phase,n=e.pressProgress>=.95?1:e.pressProgress;i===Dl.au.CLOSED?(this.closeMeasurementHelpModal(),this.dismissAddTooltip()):i===Dl.au.IDLE&&this.updateAddTooltipVisibility(),this.setState({phase:i,pressProgress:n,selectedGroup:t,pointPosition:e.pointPosition})},this.updatePerSettings=()=>{const e=this.context.settings;this.setState({units:e.tryGetProperty(He.F.UnitType,un.M.METRIC),snapping:e.tryGetProperty(He.F.MeasurementSnapping,!1),continuousLines:e.tryGetProperty(He.F.MeasurementContinuousLines,!1),addTooltipShown:e.tryGetProperty(ql,!1),desktopHelpShown:e.tryGetProperty(Zl,!1),mobileHelpShown:e.tryGetProperty(Yl,!1)})},this.updateAddTooltipVisibility=()=>{this.state.addTooltipShown||this.context.editMode||(this.setState({showAddTooltip:!0}),window.clearTimeout(this.startAddingTooltip),this.startAddingTooltip=window.setTimeout((()=>{this.dismissAddTooltip()}),$l.START_ADDING_TOOLTIP_TIMEOUT))},this.dismissAddTooltip=()=>{this.setState({showAddTooltip:!1}),this.context.settings.setProperty(ql,!0)},this.getOverlayComponents=()=>{const{mobile:e,openModal:t}=this.props,{mobileHelpShown:i,desktopHelpShown:n,phase:s}=this.state,{editMode:o}=this.context,a=t===le.P.MEASUREMENT_HELP,{closeString:c,helpString:h}=this.locale,d=o?"overlay-top-center":"overlay-bar",u=s!==Dl.au.IDLE&&s!==Dl.au.CLOSED,p=[(0,r.h)("div",{class:l()(d,{"active-phase":u})},!o&&(0,r.h)("div",{class:"overlay-bar-filler"}),(0,r.h)("div",{class:"overlay-bar-center"},this.renderOverlayInfo()),!o&&(0,r.h)("div",{class:"overlay-bar-right"},(0,r.h)(T.h,{className:"measurement-help-btn",buttonStyle:T.D.OVERLAY,iconClass:"icon-help",buttonState:a?_.BN.ACTIVE:_.BN.ENABLED,onClick:this.toggleHelpOpen,tooltipMsg:!a&&h||void 0,tooltipPosition:M.lZ.DOWN}),(0,r.h)(zl,{ref:e=>this.measurementSettings=e,onToggle:this.settingsToggled}),(0,r.h)(T.h,{iconClass:"icon-close",buttonStyle:T.D.OVERLAY,tooltipMsg:c,tooltipPosition:M.lZ.DOWN,onClick:this.onCloseMeasurementTool})))];if(!n||!i){const t=e?this.getMobileHelp():this.getDesktopHelp();p.push(t)}return p},this.getMobileHelp=()=>{const{phase:e}=this.state,{pressHoldStart:t,pressHoldEnd:i,dragEdit:n}=this.locale.mobileHelp;let s,o;switch(e){case Dl.au.CREATING_NEXT_POINT:s=(0,r.h)("div",{class:"icon icon-drag-edit"}),o=(0,r.h)("span",{class:"message"},i);break;case Dl.au.EDITING:case Dl.au.POINT_PLACED:s=(0,r.h)("div",{class:"icon icon-finger-drag"}),o=(0,r.h)("span",{class:"message"},n);break;case Dl.au.CREATING:s=(0,r.h)("div",{class:"icon icon-press-hold"}),o=(0,r.h)("span",{class:"message"},t)}return(0,r.h)("div",{class:"overlay-message"},s,o)},this.getDesktopHelp=()=>{const{phase:e,selectedGroup:t}=this.state,{clickAnywhereString:n,escapeString:s}=this.locale.desktopHelp;let o,a;switch(e){case Dl.au.CREATING:o=(0,r.h)("div",{class:"icon icon-draw-lines"}),a=(0,r.h)("span",{class:"message"},n);break;case Dl.au.CREATING_NEXT_POINT:t&&t.count>=3&&(o=(0,r.h)("div",{class:"escape-key"},(0,r.h)("img",{src:i(78899)})),a=(0,r.h)("span",{class:"message escape-message"},s))}return(0,r.h)("div",{class:"overlay-message"},o,a)},this.clickCTAButton=e=>{const{phase:t}=this.state;t===Dl.au.IDLE?this.onStartPointPlacement(e):this.onStopPointPlacement(e)},this.onDeleteMeasurement=e=>{e&&e.stopPropagation(),this.context.commandBinder.issueCommand(new Cl.Ev)},this.onStartPointPlacement=e=>{e&&e.stopPropagation(),this.context.commandBinder.issueCommand(new Il.c),this.dismissAddTooltip()},this.onStopPointPlacement=e=>{e&&e.stopPropagation(),this.context.commandBinder.issueCommand(new Ll.B)},this.onCloseMeasurementTool=async e=>{e&&e.stopPropagation(),this.closeMeasurementHelpModal(),await this.context.commandBinder.issueCommand(new Ge.tT(d.w1.MEASUREMENTS,!1)),this.measurementSettings&&this.measurementSettings.close(),this.dismissAddTooltip()},this.settingsToggled=(e,t)=>{e.stopPropagation(),t&&this.closeMeasurementHelpModal()},this.toggleHelpOpen=e=>{const{openModal:t}=this.props,i=t===le.P.MEASUREMENT_HELP;e.stopPropagation(),this.measurementSettings&&this.measurementSettings.close(),i||this.context.analytics.track("showcase_gui",{gui_action:"measure_mode_help_clicked"}),this.context.commandBinder.issueCommand(new ce.Bz(le.P.MEASUREMENT_HELP,!i))},this.locale={startAddingString:t.locale.t(m.Z.MEASUREMENT_START_ADDING),continuousLinesString:t.locale.t(m.Z.MEASUREMENT_CONTINUOUS_LINES),snappingString:t.locale.t(m.Z.MEASUREMENT_SNAPPING),unitsString:t.locale.t(m.Z.MEASUREMENT_UNITS),imperialString:t.locale.t(m.Z.MEASUREMENT_IMPERIAL),metricString:t.locale.t(m.Z.MEASUREMENT_METRIC),desktopHelp:{clickAnywhereString:t.locale.t(m.Z.MEASUREMENT_HELP_CLICK_ANYWHERE),escapeString:t.locale.t(m.Z.MEASUREMENT_HELP_ESCAPE)},mobileHelp:{pressHoldStart:t.locale.t(m.Z.MEASUREMENT_HELP_PRESS_START),dragEdit:t.locale.t(m.Z.MEASUREMENT_HELP_DRAG_EDIT),pressHoldEnd:t.locale.t(m.Z.MEASUREMENT_HELP_PRESS_END)},helpString:t.locale.t(m.Z.HELP),closeString:t.locale.t(m.Z.CLOSE)},this.state={units:un.M.METRIC,snapping:!1,continuousLines:!1,phase:Dl.au.CLOSED,selectedGroup:null,pressProgress:0,pointPosition:null,showAddTooltip:!1,desktopHelpShown:!1,mobileHelpShown:!1,addTooltipShown:!1}}async componentDidMount(){const{measurementModeData:e}=this.props.manager.dataMap;this.bindings.push(e.onChanged(this.onMeasurementModeDataChanged),e.onDataChanged(this.onMeasurementModeDataChanged));for(const e of this.propertiesToRefreshUi)this.bindings.push(this.context.settings.onPropertyChanged(e,this.updatePerSettings));this.onMeasurementModeDataChanged(),this.updatePerSettings()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(){const{mobile:e}=this.props,{continuousLines:t,selectedGroup:i}=this.state;if(e)this.isCheckVisible()&&this.context.settings.setProperty(Yl,!0);else if(null!==i){const e=i.count;(t?e>3:2===e)&&this.context.settings.setProperty(Zl,!0)}}renderProgressCircle(){const{mobile:e}=this.props,{pressProgress:t,pointPosition:i,phase:n}=this.state;if(!e||null===i||t<=0||!Wl[n])return null;const s={left:i.x-$l.pointButtonRadius/2+"px",top:i.y-$l.pointButtonRadius/2+"px"};return(0,r.h)("div",{class:"point-button-wrapper",style:s},(0,r.h)(Zn,{className:l()({complete:1===t,reset:0===t}),progress:100*t,innerRadius:$l.pointButtonRadius,barWidth:$l.pressProgressBarThickness},(0,r.h)("circle",{class:"point",cx:"0",cy:"0",r:"22",transform:"rotate(-90)",fill:"#fff"})))}renderOverlayInfo(){const{selectedGroup:e,units:t}=this.state;if(null===e)return null;const i=e.info.text?` ${e.info.text}`:"",n=`${((e,t)=>{if(t===un.M.METRIC)return`${e.toFixed(2)}m`;const{feet:i,inches:n}=(0,dn.XJ)(e);return i>0?`${i}' ${n}"`:`${n}"`})(e.length,t)} ${i}`;return(0,r.h)("div",{class:"overlay-info"},n)}render(){return(0,r.h)("div",{class:"overlay measurements-overlay"},this.getOverlayComponents(),this.renderProgressCircle(),this.renderOverlayCta())}hasCancelCta(){if(this.isCheckVisible())return!1;const{phase:e,selectedGroup:t}=this.state,i=e===Dl.au.CREATING&&(!t||0===t.count),n=e===Dl.au.CREATING_NEXT_POINT&&!!t&&2===t.count;return i||n}isCheckVisible(){const{phase:e,continuousLines:t}=this.state;return this.isCompleteMeasurement()&&(t?e===Dl.au.CREATING_NEXT_POINT:e===Dl.au.CREATING)}isCompleteMeasurement(){const{continuousLines:e,selectedGroup:t}=this.state;if(null===t)return!1;const i=t.count;return e?i>2:2===i}renderOverlayCta(){const{startAddingString:e}=this.locale,{mobile:t,unaligned:i}=this.props,{phase:n,showAddTooltip:s,selectedGroup:o}=this.state,a=n===Dl.au.EDITING,c=o&&o.count>0&&(t?!!jl[n]:!!Kl[n])?_.BN.ENABLED:_.BN.DISABLED,h=this.isCheckVisible()?"icon-checkmark":"icon-plus",d=i||a?_.BN.DISABLED:_.BN.ENABLED,u=l()("overlay-cta-btn",{"overlay-cta-cancel":this.hasCancelCta()});return(0,r.h)("div",{class:"overlay-cta"},(0,r.h)(ne,{className:"tooltip-simple-medium",open:s,message:(0,r.h)("span",null,e),arrowPos:ee.BOTTOM_CENTER}),(0,r.h)(T.h,{className:u,iconClass:h,buttonStyle:T.D.PRIMARY,buttonState:d,onClick:this.clickCTAButton}),(0,r.h)(T.h,{className:"overlay-cta-button-outer",buttonStyle:T.D.OVERLAY,iconClass:"icon-delete",buttonState:c,onClick:this.onDeleteMeasurement}))}closeMeasurementHelpModal(){const{openModal:e}=this.props;e===le.P.MEASUREMENT_HELP&&this.context.commandBinder.issueCommand(new ce.Bz(e,!1))}};Xl.pointButtonRadius=132,Xl.pressProgressBarThickness=8,Xl.START_ADDING_TOOLTIP_TIMEOUT=5e3,Xl=$l=Ql([N.Z],Xl);var Jl=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let ec=class VrEnterButtonControls extends r.Component{constructor(){super(),this.startWebXR=()=>{this.context.commandBinder.issueCommand(new rr.j({type:"immersive-vr",features:["local-floor"]})).then((e=>{if(e){this.trackEvent("vr_enter_app");const t=()=>{this.trackEvent("vr_exit_app"),e.removeEventListener("end",t)};e.addEventListener("end",t)}else this.trackEvent("vr_present_error"),this.updatePlatformState()})).catch((e=>{const t=e?{message:e.message||"",name:e.name||""}:void 0;this.trackEvent("vr_present_error",t)}))},this.state={vrPlatform:null}}async componentDidMount(){nr.Z.apiExists()&&navigator.xr.addEventListener("ondevicechange",this.updatePlatformState),await this.updatePlatformState()}componentWillUnmount(){nr.Z.apiExists()&&navigator.xr.removeEventListener("ondevicechange",this.updatePlatformState)}async updatePlatformState(){const e=await(0,ir.pl)();this.setState({vrPlatform:e})}render(){return this.state.vrPlatform===ir.bk.webxr?this.renderOverlayCta():null}renderOverlayCta(){const{locale:e}=this.context;return(0,r.h)("div",{id:"vr-overlay-layer",class:"overlay"},(0,r.h)("div",{class:"overlay-cta"},(0,r.h)(_.zx,{buttonSize:_.qE.LARGE,buttonState:_.BN.ENABLED,buttonStyle:_.ZJ.OVERLAY,className:l()("inline-block","confirm"),onClick:this.startWebXR},e.t(m.Z.VR_ENTER))))}trackEvent(e,t){let i={gui_action:e,orientation:(0,w.mI)()?"landscape":"portrait",platform:this.state.vrPlatform};i=Object.assign(i,t),this.context.analytics.track("showcase_gui",i)}};ec=Jl([N.Z],ec);var tc=i(62644),ic=i(4141);const nc="<mark>",sc="</mark>",{SEARCH:rc}=m.Z.SHOWCASE;class SearchPanelList extends r.Component{constructor(){super(...arguments),this.textParser=new Fi.v({links:!0,markers:[nc,sc]})}escape(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}groupItems(){const{grouping:e}=this.props;switch(e){case oc.TYPE:return this.groupByType();case oc.FLOOR:return this.groupByFloor();default:return this.groupByType()}}groupByType(){const{searchResults:e}=this.props,t={};for(const i of e){const e=i.type+"s";e in t||(t[e]={header:e,items:[]}),t[e].items.push(this.renderItem(i))}return t}groupByFloor(){const{searchResults:e,floorsViewData:t}=this.props,i={};for(const n of e){const e=n.floorId,s=t.getFloorName(e);e in i||(i[e]={header:s,items:[]}),i[e].items.push(this.renderItem(n))}return i}mark(e){const{searchText:t}=this.props,[i,n]=[nc,sc],s=`${i}|${n}`;let r=!1;if(e.match(new RegExp(s))&&(e=e.replace(new RegExp(`(${s})`,"g"),((e,t)=>t.split("").join(""))),r=!0),t){let s;s=r?t.split("").map((e=>this.escape(e))).join("[]?"):this.escape(t),e=e.replace(new RegExp(`(${s})`,"gi"),((e,t)=>`${i}${t}${n}`))}return e}getSearchSnippet(e){var t;const{searchText:i}=this.props,n=e.toLowerCase(),[s,r,o]=[n.indexOf(i),e.length,(null===(t=n.match(new RegExp(`${this.escape(i)}`,"g")))||void 0===t?void 0:t.length)||1];let a=e,l=s;if(r>20&&l>0){if(1===o){const e=Math.floor((20-i.length)/2);e>0&&l>e&&(l-=e)}a=`...${a.substr(l)}`,a.length<20&&(l-=20-a.length,l>0&&(a=`...${e.substr(l)}`))}return a}getIconFromItem(e){switch(e.type){case ic.B.MATTERTAG:return"icon-simple-tag";case ic.B.LABEL:return"icon-toolbar-labels";case ic.B.MEASUREMENT:return"icon-tape-measure";default:return""}}renderItem(e){const{selectedId:t}=this.props,i=e.id,n=e.color;let s=e.title;s&&(s=this.mark(s));let o=e.description;return o&&(o=this.mark(this.getSearchSnippet(this.textParser.getPlainText(o)))),(0,r.h)(da,{key:i,sid:i,enabled:!0,selected:i===t,onSelect:this.props.onSelect(e.onSelect)},(0,r.h)(Cs,{badgeStyle:void 0!==n?{background:n,"border-color":n}:{},iconClass:this.getIconFromItem(e)}),(0,r.h)("div",{class:"item-details"},s&&(0,r.h)("div",{class:"item-header"},(0,r.h)(Rs,{text:s,textParser:this.textParser})),o&&(0,r.h)("div",{class:"item-description"},(0,r.h)(Rs,{text:o,textParser:this.textParser}))),(0,r.h)(T.h,{buttonStyle:T.D.PLAIN}))}render(){const e=[];for(const[t,i]of Object.entries(this.groupItems())){const n=0===i.items.length,{header:s,items:o}=i;e.push((0,r.h)(ca,{key:t,id:t,header:`${s} (${o.length})`,open:!0,doubleLine:!0,collapsible:!n,emptyMessage:this.context.locale.t(rc.EMPTY_LIST_MESSAGE)},i.items))}return(0,r.h)(va,null,e)}}var oc,ac=i(69617),lc=i(67790),cc=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e.TYPE="type",e.FLOOR="floor"}(oc||(oc={}));const{SEARCH:hc}=m.Z.SHOWCASE;let dc=class SearchPanel extends r.Component{constructor(e){super(e),this.bindings=[],this.setTextInputRef=e=>this.textInputRef=e,this.focus=()=>{this.textInputRef&&!(0,w.Jm)()&&this.textInputRef.focus()},this.onTransitionEnd=e=>{const{active:t}=e,{collapsedToBottom:i}=this.state,{toolPanelLayout:n}=this.props;!t||n!==d.wS.SIDE_PANEL&&i||this.focus()},this.searchResultsOnChange=e=>{this.setState({searchResults:e.getResults()})},this.updateCollapsedState=()=>{this.setState({collapsedToBottom:this.context.toolsData.isPanelCollapsedToBottom()})},this.sendQuery=async e=>{this.props.manager.updateSearchText(e),this.context.commandBinder.issueCommand(new tc.H(e)),this.setState({searchText:e})},this.onDone=e=>{this.state.collapsedToBottom&&this.context.commandBinder.issueCommand(new Ge.zK(!1))},this.selectItem=e=>t=>{this.setState({selectedId:t}),e(),this.props.toolPanelLayout===d.wS.BOTTOM_PANEL&&this.context.commandBinder.issueCommand(new Ge.zK(!0))},this.onCloseLayer=async e=>{e&&e.stopPropagation(),await this.context.commandBinder.issueCommand(new Ge.tT(d.w1.SEARCH,!1))},this.onClearSearch=()=>{this.sendQuery(""),this.focus()},this.onShareSearch=()=>{const{searchText:e}=this.state,t=encodeURIComponent(e),i=new URLSearchParams(window.location.search);i.set("search",t);const n=window.location.href.replace(/\?.*?(?=(#|$))/,`?${i}`),s=document.createElement("input");document.body.appendChild(s),s.value=n,s.select(),document.execCommand("copy"),document.body.removeChild(s),this.setState({linkCopied:!0},(()=>{this.shareTimeout=window.setTimeout((()=>{this.setState({linkCopied:!1})}),2500)}))},this.scrollToInputOnResize=()=>{this.focused&&this.state.collapsedToBottom&&(0,w.Jm)()&&this.textInputRef.scrollIntoView()},this.onFocus=()=>this.focused=!0,this.onBlur=()=>this.focused=!1,this.renderShareButton=()=>{const{toolPanelLayout:e}=this.props,{collapsedToBottom:t,linkCopied:i}=this.state;let n;return n=i?(0,r.h)("span",{class:"link-copied"},this.context.locale.t(m.Z.SHARE_COPIED)):(0,r.h)(T.h,{onClick:this.onShareSearch,buttonStyle:T.D.PLAIN,buttonSize:_.qE.SMALL},e!==d.wS.SIDE_PANEL&&t?(0,r.h)("span",{class:"icon icon-share"}):(0,r.h)(M.oO,{content:this.context.locale.t(m.Z.COPY_URL),position:M.lZ.DOWN,tooltipTimeout:2e3},(0,r.h)("span",{class:"icon icon-share"}))),n},this.changeGrouping=(e,t)=>{if(t){const e=t;this.setState({grouping:e})}},this.toggleGrouping=e=>{e.stopPropagation(),this.setState((e=>({groupingsMenuOpen:!e.groupingsMenuOpen})))},this.closeGrouping=()=>{this.setState({groupingsMenuOpen:!1})},this.floorsViewData=this.props.manager.floorsViewData;const t=this.props.manager.getSearchText();this.state={active:!0,collapsedToBottom:!1,searchText:t,searchResults:[],selectedId:"",groupingsMenuOpen:!1,grouping:oc.TYPE,linkCopied:!1}}componentDidMount(){const{engine:e}=this.context;this.bindings.push(e.subscribe(lc.a,this.scrollToInputOnResize),e.subscribe(ue.rh,this.onTransitionEnd),e.subscribe(ue.U7,this.updateCollapsedState)),e.market.waitForData(ac.r).then((e=>{this.bindings.push(e.onChanged(this.searchResultsOnChange)),this.sendQuery(this.state.searchText)})),this.updateCollapsedState()}componentWillUnmount(){window.clearTimeout(this.shareTimeout),this.bindings.forEach((e=>e.cancel()))}renderSearchResults(){const{searchResults:e,selectedId:t,grouping:i,searchText:n}=this.state;return this.state.searchResults.length>0?(0,r.h)(SearchPanelList,{searchText:n,searchResults:e,selectedId:t,onSelect:this.selectItem,grouping:i,floorsViewData:this.floorsViewData}):this.renderEmptyMessage()}renderEmptyMessage(){return(0,r.h)("p",{class:"search-empty-message"},"No matches found")}renderSubheader(){const{collapsedToBottom:e}=this.state,t=!e;return(0,r.h)("div",{class:"list-subheaders"},this.renderSearchHeader(),t&&this.renderGroupingsMenu())}renderSearchHeader(){const{searchText:e}=this.state;return(0,r.h)("div",{class:"list-search"},(0,r.h)("span",{class:a("search-header-icon","icon","icon-magnifying-glass",{"search-header-icon-active":""!==e})}),(0,r.h)(tn,{text:e,onInput:this.sendQuery,onDone:this.onDone,placeholder:"Search space",onFocus:this.onFocus,onBlur:this.onBlur,ref:this.setTextInputRef}),""!==e&&(0,r.h)("div",{class:"search-header-button-container"},(0,r.h)(_.zx,{onClick:this.onClearSearch,buttonStyle:_.ZJ.PLAIN,buttonSize:_.qE.STANDARD},this.context.locale.t(hc.CLEAR_SEARCH).toLocaleUpperCase()),this.renderShareButton()))}renderGroupingsMenu(){const{grouping:e,groupingsMenuOpen:t}=this.state,{locale:i}=this.context,n=[{text:i.t(hc.GROUP_TYPE),value:oc.TYPE,selected:e===oc.TYPE},{text:i.t(hc.GROUP_FLOOR),value:oc.FLOOR,selected:e===oc.FLOOR}];return(0,r.h)("div",{class:"list-menu groupings search-groupings"},(0,r.h)("span",{class:"groupings-label"},i.t(hc.GROUP_BY).toLocaleUpperCase()),(0,r.h)(SelectMenu,{className:"groupings-search-select",menuStyle:se.DROPDOWN,open:t,onToggle:this.toggleGrouping,onSelect:this.changeGrouping,onClose:this.closeGrouping,options:n}))}getListTitle(){const{searchResults:e}=this.state,t=e.length,i=this.context.locale.t(hc.ITEMS,t);return(0,r.h)("div",{class:"list-panel-title"},i)}render(){const{active:e}=this.state,{toolPanelLayout:t}=this.props;return(0,r.h)("div",{class:"tool-panel search-panel"},(0,r.h)(ListPanel,{active:e,toolPanelLayout:t,title:this.getListTitle(),onClose:this.onCloseLayer,subheader:this.renderSubheader(),subheaderCollapsedHeight:To._U},(0,r.h)("div",{class:"list-contents"},this.renderSearchResults())))}};dc=cc([N.Z],dc);var uc=i(69808);const pc=new E.Z("showcase-ui");class ShowcaseUi extends r.Component{constructor(e){super(e),this.bindings=[],this.mobile=(0,w.tq)(),this.propertiesToRefreshUi=[x.gx.Measurements,x.gx.DetailsModelName,oe.ws,x.gx.FloorSelect],this.getModeChange=e=>({viewmode:(0,y.ty)(e.toMode)}),this.updateToolPanelLayout=()=>{const{toolsData:e,mainDiv:t}=this.props,i=e.toolPanelLayout;this.setState({toolPanelLayout:i}),wo(t,i)},this.showHelpOnPlaying=e=>{e.phase===h.nh.PLAYING&&(this.props.commandBinder.issueCommand(new ce.Bz(le.P.CTA,!0)),this.props.messageBus.unsubscribe(c.LZ,this.showHelpOnPlaying))},this.updateTools=()=>{const{toolsData:e,market:t,commandBinder:i}=this.props;e.toolsMap.length>0&&!this.state.toolsLoaded&&(this.setState({toolsLoaded:!0}),t.waitForData(u.X).then((()=>{i.issueCommand(new p.xy)})))},this.updatePerSettings=()=>{this.setState(Object.assign({measurementsModeEnabled:this.isMeasurementsEnabled(),notesEnabled:this.isNotesEnabled(),newTagsEnabled:this.isNewTagsEnabled(),searchEnabled:this.isSearchEnabled()},this.getTitleBarEnablement()))},this.getTourState=()=>{if(!this.tourData)return{tourState:this.state.tourState};return{tourState:this.tourData.getCurrentTourState()}},this.getTitleBarEnablement=()=>{const{settings:e}=this.props,t=e.tryGetProperty(Pt.Zz,!0),i=this.props.settings.tryGetProperty(x.gx.DetailsModelName,!0);return{titleBarEnabled:t&&i}},this.isVrButtonEnabled=()=>(0,ir.hX)(this.props.settings),this.updateActiveTool=()=>{const{tourState:e}=this.state,{toolsData:t,commandBinder:i,mainDiv:n}=this.props,s=t.activeToolName;this.setState({activeTool:s}),window.clearTimeout(this.panelCloseTimeout),s?n.classList.add("tool-open"):this.panelCloseTimeout=window.setTimeout((()=>{n.classList.remove("tool-open")}),400),s&&e.tourPlaying&&i.issueCommand(new S.vy,!1)},this.openModalChanged=()=>{const{toolsData:e,commandBinder:t,mainDiv:i}=this.props,{tourState:n}=this.state,s=e.openModal;s?i.classList.add("modal-open"):i.classList.remove("modal-open"),s&&n.tourPlaying&&t.issueCommand(new S.vy,!1),this.setState({openModal:s})},this.glCanvas=document.getElementsByClassName("webgl-canvas")[0],this.state={viewmode:y.g,activeTool:null,openModal:null,toolsLoaded:!1,toolPanelLayout:e.toolsData.toolPanelLayout,tourState:{},modelDetails:null,measurementsModeEnabled:!1,notesEnabled:!1,newTagsEnabled:!1,searchEnabled:!1,vrEnabled:!1,brandingEnabled:!1,shareEnabled:!1,titleBarEnabled:!1,unaligned:!0,showExternalUrl:!1}}getChildContext(){const{editMode:e,locale:t,analytics:i,settings:n,toolsData:s,userData:r,mainDiv:o,engine:a,messageBus:l,market:c,commandBinder:h,queue:d}=this.props;return{editMode:e,locale:t,analytics:i,settings:n,toolsData:s,userData:r,mainDiv:o,engine:a,messageBus:l,market:c,commandBinder:h,queue:d}}async componentDidMount(){const{settings:e,messageBus:t,market:i,toolsData:n}=this.props;for(const t of this.propertiesToRefreshUi)e.onPropertyChanged(t,this.updatePerSettings);try{this.cancelBindings(),this.bindings=[n.onToolsLoadedChanged(this.updateTools),n.onToolChanged(this.updateActiveTool),n.onOpenModalChanged(this.openModalChanged),n.onToolPanelLayoutChanged(this.updateToolPanelLayout),n.toolsMap.onChanged(this.updatePerSettings)],this.handleStartUpHelp();const[e,s,r,o]=await Promise.all([i.waitForData(Wr.T),i.waitForData(f.O),i.waitForData(Kr.Z),i.waitForData(bo.k3)]);this.bindings.push(t.subscribe(Jn.Z,(e=>this.setState(Object.assign(Object.assign({},this.getModeChange(e)),this.getUnalignedSweepState())))),t.subscribe(Xs.NR,(()=>this.setState(this.getTourState()))),t.subscribe(Xs.oR,(()=>this.setState(this.getTourState()))),t.subscribe(Xs.Vx,(()=>this.setState(this.getTourState()))),t.subscribe(Xs.Mt,(()=>this.setState(this.getTourState()))),t.subscribe(Xs.dW,(()=>this.setState(this.getTourState()))),o.getReel().onChanged((()=>this.setState(this.getTourState()))),r.makeSweepChangeSubscription((()=>this.setState(this.getUnalignedSweepState()))));const a=(0,y.ty)(s.currentMode||Me.Ey.Panorama);this.tourData=o,this.sweepData=r,this.viewmodeData=s,this.setState(Object.assign(Object.assign(Object.assign({viewmode:a,modelDetails:e.model.details,brandingEnabled:this.isBrandingEnabled()&&!this.isMlsEnabled(),shareEnabled:this.isShareEnabled()&&!this.isMlsEnabled(),showExternalUrl:this.isBrandingEnabled()&&!this.isMlsEnabled(),vrEnabled:this.isVrButtonEnabled()},this.getTitleBarEnablement()),this.getTourState()),this.getUnalignedSweepState())),this.props.onAppReadyChanged(!0,!1)}catch(e){pc.debug(e)}this.updateActiveTool(),this.updateTools(),this.updatePerSettings()}async componentWillUnmount(){for(const e of this.propertiesToRefreshUi)this.props.settings.removeOnPropertyChanged(e,this.updatePerSettings);this.cancelBindings(),this.props.onAppReadyChanged(!1,!1)}handleStartUpHelp(){const{settings:e,messageBus:t,commandBinder:i}=this.props,n=e.tryGetProperty("help",0);if(1===n||2===n){const n=1===e.tryGetProperty("ts",0),s=1===e.tryGetProperty("qs",0);n||(s?i.issueCommand(new ce.Bz(le.P.CTA,!0)):t.subscribe(c.LZ,this.showHelpOnPlaying))}}getUnalignedSweepState(){if(!this.sweepData||!this.viewmodeData)return{unaligned:this.state.unaligned};return{unaligned:this.viewmodeData.isPano()&&this.sweepData.isSweepUnaligned(this.sweepData.currentSweep)}}cancelBindings(){for(const e of this.bindings)e.cancel()}isNotesEnabled(){const{settings:e,toolsData:t}=this.props;return e.tryGetProperty(Ve.IA,!1)&&!!t.getTool(d.w1.NOTES)}isNewTagsEnabled(){const{settings:e,toolsData:t}=this.props;return e.tryGetProperty(xi.R,!1)&&!!t.getTool(d.w1.TAGS)}isSearchEnabled(){const{settings:e,toolsData:t}=this.props;return e.tryGetProperty(uc.B,!1)&&!!t.getTool(d.w1.SEARCH)}isMeasurementsEnabled(){const{settings:e,toolsData:t}=this.props;return e.tryGetProperty(x.gx.Measurements,!0)&&!!t.getTool(d.w1.MEASUREMENTS)}isShareEnabled(){const{settings:e}=this.props;return e.tryGetProperty(Pt.Yo,!1)&&e.tryGetProperty("is_public",!1)}isMlsEnabled(){return this.props.settings.tryGetProperty(Pt.sX,!1)}isBrandingEnabled(){const{settings:e}=this.props;return e.tryGetProperty(Pt.L,!0)}renderToolPanels(){const{notesEnabled:e,newTagsEnabled:t,searchEnabled:i,activeTool:n,openModal:s,toolPanelLayout:o}=this.state;if(!e&&!t&&!i)return null;const{toolsData:a}=this.props,l=a.getTool(d.w1.NOTES),c=a.getTool(d.w1.TAGS),h=a.getTool(d.w1.SEARCH);return(0,r.h)(Eo,{activeTool:n,sidePanelCollapsible:!1,toolPanelLayout:o},l&&(0,r.h)(wl,{key:d.w1.NOTES,manager:l.manager,modalOpen:!!s,toolPanelLayout:o}),c&&(0,r.h)(Ia,{key:d.w1.TAGS,manager:c.manager,toolPanelLayout:o}),h&&(0,r.h)(dc,{key:d.w1.SEARCH,manager:h.manager,toolPanelLayout:o}))}renderToolOverlay(){const{toolsData:e}=this.props,{openModal:t,activeTool:i,unaligned:n,toolPanelLayout:s}=this.state,o=e.toolsMap.get(d.w1.MEASUREMENTS),a=e.toolsMap.get(d.w1.NOTES),l=e.toolsMap.get(d.w1.TAGS);return(0,r.h)("div",{class:"tool-overlay"},!i&&(0,r.h)(ec,null),i===d.w1.MEASUREMENTS&&o&&(0,r.h)(Xl,{mobile:this.mobile,openModal:t,unaligned:n,manager:o.manager}),i===d.w1.NOTES&&a&&(0,r.h)(Ml,{openModal:t,toolPanelLayout:s,manager:a.manager}),i===d.w1.TAGS&&l&&(0,r.h)(Pl,{openModal:t,toolPanelLayout:s,manager:l.manager}))}render(){const{toolsData:e}=this.props,{viewmode:t,unaligned:i,tourState:n,modelDetails:s,measurementsModeEnabled:o,notesEnabled:l,searchEnabled:c,shareEnabled:h,brandingEnabled:u,titleBarEnabled:p,vrEnabled:m,openModal:g,toolsLoaded:f,toolPanelLayout:v,activeTool:y,showExternalUrl:b}=this.state,S=g===le.P.MATTERTAG_EMBED,E=e.toolOpen?y:null,w=E===d.w1.SEARCH;return(0,r.h)("div",{id:"gui",class:a({"search-mode":w})},!!s&&(0,r.h)(TopUi,{showing:!g&&!y,modelDetails:s,tourState:n,brandingEnabled:u,showExternalUrl:b,titleBarEnabled:p,searchEnabled:c}),(0,r.h)(Modals,{viewmode:t,glCanvas:this.glCanvas,openModal:g}),!S&&(0,r.h)("div",{class:"showcase-ui-overlay"},(0,r.h)("div",{class:"scene-overlay"},!S&&(0,r.h)(OverlayUi,{viewmode:t,toolPanelLayout:v,activeTool:y,openModal:g,tourPlaying:n.tourPlaying,mobile:this.mobile}),f&&this.renderToolOverlay(),(0,r.h)(BottomUi,{openModal:g,openTool:E,unaligned:i,viewmode:t,tourState:n,measurementsModeEnabled:o,notesEnabled:l,shareEnabled:h,vrEnabled:m,toolPanelLayout:v})),this.renderToolPanels()))}}var mc=i(24151),gc=i(23953);class SettingsToggler{constructor(e,t){this.settingsData=e,this.settings=t,this.cache={}}apply(){this.cache={};for(const e of Object.keys(this.settings)){const t=this.settingsData.tryGetProperty(e,void 0);t!==this.settings[e]&&(this.cache[e]=t,this.settingsData.setProperty(e,this.settings[e]))}}reset(){for(const e of Object.keys(this.cache)){const t=this.cache[e];this.settingsData.setProperty(e,void 0!==t&&t)}this.cache={}}toggle(e){e?this.apply():this.reset()}}var fc,vc=i(28963),yc=i(66999),bc=i(40688),Sc=i(52247),Ec=i(13341),wc=i(39712),Tc=i(38003),_c=i(2782);!function(e){e[e.CLOSE=0]="CLOSE",e[e.DISPLAY=1]="DISPLAY",e[e.UPDATE=2]="UPDATE"}(fc||(fc={}));class WorkshopModalCommand extends wa.m{constructor(e,t){if(super(),e&&!t)throw new Error("Cannot open empty modal");this.payload={action:e,properties:t}}}WorkshopModalCommand.id="WORKSHOP_MODAL";var Mc=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const xc=new E.Z("workshop-modal");var Ac;!function(e){e[e.CONFIRM=0]="CONFIRM",e[e.CLOSE=1]="CLOSE"}(Ac||(Ac={}));const Oc={message:"",title:"",modalClass:"",cancellable:!0,closeButton:!0,confirmDisabled:!1};let Pc=class WorkshopModal extends r.Component{constructor(e){super(),this.handleModalCommand=async e=>{if(e.action===fc.DISPLAY){if(this.state.open){if(!this.state.cancellable)return Promise.reject("Cannot close non-cancellable modal");await this.close(Ac.CLOSE)}return this.openModal(e.properties)}if(e.action===fc.UPDATE)this.updateModal(e.properties);else{if(!this.state.open)return Promise.reject("Cannot cancel a closed modal");this.close(Ac.CLOSE)}return this.togglePromise},this.close=async e=>{await this.props.commandBinder.issueCommand(new _c.n(400,0)),this.props.handleBlur(!1),this.promiseResolve(e),this.setState({open:!1})},this.stopPropagation=e=>{e.stopPropagation()},this.onCancel=e=>{e.stopPropagation(),this.close(Ac.CLOSE)},this.onConfirm=async e=>{e.stopPropagation(),this.close(Ac.CONFIRM)},this.state={open:!1}}async componentDidMount(){try{this.props.commandBinder.addBinding(WorkshopModalCommand,this.handleModalCommand)}catch(e){xc.debug(e)}}async componentWillUnmount(){try{this.props.commandBinder.removeBinding(WorkshopModalCommand,this.handleModalCommand)}catch(e){xc.debug(e)}}updateModal(e){this.state.open&&this.setState(Object.assign({},e))}openModal(e){this.props.commandBinder.issueCommand(new _c.n(400,3)),this.props.handleBlur(!0);const t=Object.assign({},Oc,e);return this.setState(Object.assign({open:!0},t)),this.togglePromise=new Promise((e=>{this.promiseResolve=e})),this.togglePromise}render(){const{locale:e}=this.context,{open:t,title:i,titleLocalizationOptions:n,message:s,messageLocalizationOptions:o,confirmPhraseKey:a,cancelPhraseKey:c,closeButton:h,modalClass:d,confirmDisabled:u}=this.state,p=d||"";let m=i;if("string"==typeof i){const t=void 0===n?{}:n,s=e.t(i,t);m=(0,r.h)("span",null,s)}let g=s;if("string"==typeof s){const t=void 0===o?{}:o,i=e.t(s,t);g=(0,r.h)("p",{class:"modal-message"},i)}return(0,r.h)(Se,{open:t,className:l()("modal-background","workshop-modal-background",{open:t}),onClick:this.stopPropagation},(0,r.h)("dialog",{class:`modal workshop-modal ${p}`},(0,r.h)("header",{class:"modal-header"},(0,r.h)("div",{class:"modal-title"},m),h&&(0,r.h)(te.P,{onClose:this.onCancel})),(0,r.h)("div",{class:"modal-body"},g),(0,r.h)("div",{class:"modal-footer"},c&&(0,r.h)(_.zx,{buttonStyle:_.ZJ.OUTLINE,className:l()("button-inline","cancel"),onClick:this.onCancel},e.t(c)),a&&(0,r.h)(_.zx,{buttonState:u?_.BN.DISABLED:_.BN.ENABLED,className:l()("button-inline","confirm"),onClick:this.onConfirm},e.t(a)))))}};Pc=Mc([N.Z],Pc);const{ACCORDION:Dc,MODAL:Cc}=m.Z.WORKSHOP;function Ic({itemTypePhraseKey:e,number:t}){const{locale:i}=this.context,n=i.t(e,t);return i.t(Dc.BATCH_DELETE_MODAL_TITLE,{itemType:n})}function Lc({itemTypePhraseKey:e,number:t}){const{locale:i}=this.context,n=i.t(e,t);return i.t(Dc.BATCH_DELETE_MODAL_MESSAGE,{number:t,itemType:n})}const{MEASUREMENTS:Rc}=m.Z.WORKSHOP;class MeasurementsManager{constructor(e,t){this.engine=e,this.initialized=!1,this.disabledAssets={[yc.U]:!1,[vc.s]:!1,[_i.Nj]:!1,[Mi.r]:!1,[Ve.Mp]:!1},this.settingsToggler=new SettingsToggler(t,this.disabledAssets)}async activate(){if(!this.initialized){this.initialized=!0;const e=this.engine,[t,i,n,s]=await Promise.all([e.market.waitForData(Tc.X),e.market.waitForData(v.c),e.market.waitForData(Kr.Z),e.market.waitForData(f.O)]);this.dataMap={measurementModeData:t,floorsViewData:i,sweepData:n,viewmodeData:s}}this.settingsToggler.toggle(!0),await this.engine.commandBinder.issueCommandWhenBound(new bc.O(!0,!0))}async deactivate(){this.settingsToggler.toggle(!1),this.dataMap.measurementModeData.setSelectedGroupIndex(-1),await this.engine.commandBinder.issueCommand(new bc.O(!1))}in360view(){const e=this.dataMap.sweepData.currentSweep?this.dataMap.sweepData.currentSweep:"";return this.dataMap.viewmodeData.isPano()&&this.dataMap.sweepData.isSweepUnaligned(e)}getSelectedMeasurement(){return this.dataMap.measurementModeData.selectedGroupSid}renameMeasurement(e,t){return this.engine.commandBinder.issueCommand(new Sc.R(e,t))}setMeasurementVisibility(e,...t){return this.engine.commandBinder.issueCommand(new Ec.W(e,...t))}async batchDeleteMeasurement(e){const t=((e,t)=>({title:(0,r.h)(Ic,{number:e,itemTypePhraseKey:t}),message:(0,r.h)(Lc,{number:e,itemTypePhraseKey:t}),cancellable:!0,cancelPhraseKey:Cc.NO,confirmPhraseKey:Cc.YES}))(e.length,Rc.TYPE);return await this.engine.commandBinder.issueCommand(new WorkshopModalCommand(fc.DISPLAY,t))!==Ac.CLOSE&&(this.engine.commandBinder.issueCommand(new Cl.JM(...e)),!0)}async deleteMeasurement(e){await this.engine.commandBinder.issueCommand(new Cl.JM(e))}async toggleSelected(e){await this.engine.commandBinder.issueCommand(new wc.t(e))}}var Nc=i(19980),kc=i(39950);class NotesManager{constructor(e,t){this.engine=e,this.initialized=!1,this.disabledAssets={[yc.U]:!1,[_i.Nj]:!1,[vc.s]:!1,[Mi.r]:!1},this.settingsToggler=new SettingsToggler(t,this.disabledAssets),this.initPromise=this.init()}async init(){const e=this.engine.market;return Promise.all([e.waitForData(u.X),e.waitForData(kc.c),e.waitForData(No.b),e.waitForData(os.B),e.waitForData(Nc.A)]).then((([e,t,i,n,s])=>(this.dataMap={notesViewData:e,hashtagData:t,attachmentsData:i,pinsViewData:n,annotationsViewData:s},!0)))}async activate(){this.initialized||(this.initialized=!0,await this.initPromise),this.settingsToggler.toggle(!0),await this.engine.commandBinder.issueCommand(new p.yK(!0))}async deactivate(){await this.engine.commandBinder.issueCommand(new p.yK(!1)),this.settingsToggler.toggle(!1)}getTextParser(){return this.dataMap.notesViewData.getTextParser()}getReplyId(e){return e?`${e.id}-reply`:""}}var Bc=i(51627);class TagsManager{constructor(e,t){this.engine=e,this.initialized=!1,this.bindings=[],this.disabledEditorAssets={[yc.U]:!1,[_i.Nj]:!1,[vc.s]:!1,[Ve.Mp]:!1},this.settingsToggler=new SettingsToggler(t,this.disabledEditorAssets),this.initPromise=this.init()}async init(){const e=this.engine.market;return Promise.all([e.waitForData(Bc.n),e.waitForData(No.b),e.waitForData(v.c),e.waitForData(os.B)]).then((([e,t,i,n])=>(this.dataMap={tagsViewData:e,attachmentsData:t,floorsViewData:i,pinsViewData:n},!0)))}async activate(e){const t=this.engine;if(this.initialized)for(const e of this.bindings)e.renew();else this.initialized=!0,await this.initPromise;e&&this.settingsToggler.toggle(!0),await t.commandBinder.issueCommand(new as.bF(!0))}async deactivate(){this.settingsToggler.toggle(!1),await this.engine.commandBinder.issueCommand(new as.bF(!1))}navigateInList(e,t,i){const{tagsViewData:n}=this.dataMap,s=n.getCurrentTagViewByIndex(e);if(s)if(t){const t=i===d.wS.SIDE_PANEL?Te.n.FadeToBlack:Te.n.Instant;this.engine.commandBinder.issueCommand(new rs.$b(s.id,ss.Er.MATTERTAG,t,void 0,e))}else this.engine.commandBinder.issueCommand(new rs.Ar(s.id,ss.Er.MATTERTAG))}setTagVisibility(e,t){}}const{TOOLS:Fc}=m.Z;class ShowcaseGui extends o.Y{constructor(){super(...arguments),this.name="showcase-gui-module",this.log=new E.Z(this.name),this.loadUi=async(e,t,i,n,s,o,a,l,c,h,d)=>{const u={editMode:!1,locale:e,analytics:t,settings:i,toolsData:this.toolsData,userData:n,mainDiv:s,engine:o,messageBus:a,market:l,commandBinder:c,onAppReadyChanged:h,queue:d};this.container=s,this.ref=(0,r.render)((0,r.h)(ShowcaseUi,u),s),this.initializeTools()}}async init(e,t){this.engine=t,[this.settingsData,this.toolsData]=await Promise.all([t.market.waitForData(Mn.e),t.market.waitForData(mc.t)])}async unloadUi(){if(this.ref&&this.container)return(0,r.render)(null,this.container,this.ref)}initializeTools(){const e=[new gc.U({id:d.w1.NOTES,namePhraseKey:Fc.NOTES,drawer:!1,panel:!0,icon:"icon-comment-outline",analytic:"notes_mode",toolbar:!1,dimmed:!1,enabled:this.settingsData.tryGetProperty(Ve.IA,!1),manager:new NotesManager(this.engine,this.settingsData)}),new gc.U({id:d.w1.MEASUREMENTS,namePhraseKey:Fc.MEASUREMENTS,drawer:!1,panel:!1,icon:"icon-tape-measure",analytic:"measure_mode",toolbar:!1,dimmed:!1,enabled:this.settingsData.tryGetProperty(x.gx.Measurements,!0),manager:new MeasurementsManager(this.engine,this.settingsData)})];this.settingsData.tryGetProperty(xi.R,!1)&&e.push(new gc.U({id:d.w1.TAGS,namePhraseKey:Fc.TAGS,drawer:!1,panel:!0,icon:"icon-toolbar-mattertags",analytic:"mattertag",toolbar:!1,dimmed:!1,enabled:!0,manager:new TagsManager(this.engine,this.settingsData)})),this.engine.commandBinder.issueCommand(new Ge.MV(e))}}},27088:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>LoadingGui});var n=i(47724),s=i(8150),r=i(21479),o=i(8445),a=i(41452),l=i(13789),c=i(60771),h=i(98828),d=i(10757),u=i(88512),p=i(64185),m=i(90831),g=i(91466);class ShowcaseExpansionMessage extends g.v{constructor(e){super(),this.expanded=e}}var f=i(93331);class ProgressRadial{constructor(e){this.lastProgress=0,this.currentProgress=0,this.webpackChunks=[],this.meshAlloc={alloc:2e6,loaded:0},this.showingProgress=!1,this.progressElm=document.getElementById("bar"),window.addEventListener("WebpackChunkProgress",this.onWebpackChunkProgress.bind(this)),this.engine=e,this.meshProgressBinding=this.onMeshLoadProgress.bind(this),this.engine.subscribe(f.Z,this.meshProgressBinding)}showProgress(){this.showingProgress=!0,this.setProgress(this.currentProgress)}setDone(){this.currentProgress=100,this.setProgress(this.currentProgress),this.engine.unsubscribe(f.Z,this.meshProgressBinding)}setProgress(e){if(!this.progressElm||isNaN(e))return;this.lastProgress=Math.max(this.lastProgress,e),e=this.lastProgress;const t=Number.parseFloat(this.progressElm.getAttribute("r")||"0"),i=Math.PI*(2*t),n=(100-(e=Math.max(Math.min(e,100),0)))/100*i;this.progressElm.style.strokeDashoffset=n.toString(10)}calcProgress(){let e=0,t=0;this.webpackChunks.forEach((i=>{e+=i.loaded,t+=i.total})),e+=this.meshAlloc.loaded,t+=this.meshAlloc.alloc,this.currentProgress=75*Math.min(e/t,1),this.showingProgress&&this.setProgress(this.currentProgress)}onWebpackChunkProgress(e){this.webpackChunks[e.chunkID]?this.webpackChunks[e.chunkID].loaded=e.loaded:this.webpackChunks[e.chunkID]={loaded:e.loaded,total:e.total},this.calcProgress()}onMeshLoadProgress(e){this.meshAlloc.loaded=e.loaded/e.total*this.meshAlloc.alloc,this.calcProgress()}}var v=i(17386);class ShowcaseStartCommand extends v.m{}ShowcaseStartCommand.id="SHOWCASE_START";class ShowcaseStopCommand extends v.m{}ShowcaseStopCommand.id="SHOWCASE_STOP";class ShowcaseReadyCommand extends v.m{}ShowcaseReadyCommand.id="SHOWCASE_READY";class StartApplicationCommand extends v.m{constructor(e){super(),this.payload={startup:e}}}StartApplicationCommand.id="START_APPLICATION";class ExpandIframeCommand extends v.m{constructor(e){super(),this.payload={expand:e}}}ExpandIframeCommand.id="EXPAND_APP";var y=i(25138),b=i(33874),S=i(18654);const E=new u.Z("loading-gui");class LoadingGui extends n.Y{constructor(){super(...arguments),this.name="loading-ui",this.playPromise=new p.Q,this.resolvePlayPromise=async(e,t)=>{if(this.config.allowPlayInIframe||!this.config.startNewTab){if((0,c.yL)())if(t&&(this.config.allowPlayInIframe||1===(0,h.h)("expand",0)))this.toggleIframeExpansion(!0);else if(!this.config.allowPlayInIframe){const e=(0,c.AO)();t&&(e.edit="1"),e.back="1",delete e.cloudEdit;const i=Object.keys(e).map((t=>t+"="+e[t])).join("&"),n=`${window.location.origin}${window.location.pathname}?${i}`;try{return void(window.top.location.href=n)}catch(e){E.debug("Couldn't set top window location; was Showcase sandboxed?"),E.debug(e)}}t&&this.settings.setProperty("quickstart",!0),e&&(this.config.noUi||(this.playIcon.classList.add("hidden"),this.progressUI.showProgress()),this.playPromise.resolve())}else{const e=(0,S.m5)(window.location.href);window.open(e,"_blank")}},this.toggleIframeExpansion=e=>{const t=e?new ShowcaseStartCommand:new ShowcaseStopCommand;this.engine.commandBinder.issueCommand(t),this.engine.broadcast(new ShowcaseExpansionMessage(e))},this.onAppPhaseChangeMessage=async e=>{e.phase!==r.nh.STARTING&&e.phase!==r.nh.PLAYING&&e.phase!==r.nh.ERROR||(this.progressUI.setDone(),this.config.quickstart?this.showQuickstartUI():this.uiRoot.classList.add("faded-out"),this.engine.unsubscribe(s.LZ,this.onAppPhaseChangeMessage))}}async init(e,t){this.engine=t,this.config=e,this.locale=await t.getModule(a.default),this.settings=await t.market.waitForData(b.e);const i=await t.market.waitForData(o.T);this.model=i.model.details,this.bindings.push(t.commandBinder.addBinding(StartApplicationCommand,(async e=>{this.resolvePlayPromise(e.startup,!0)})),t.commandBinder.addBinding(ExpandIframeCommand,(async e=>{this.toggleIframeExpansion(e.expand)}))),e.noUi||(this.bindings.push(this.settings.onPropertyChanged(y.DU,(()=>this.renderTitle())),this.settings.onPropertyChanged(y.L,(()=>this.renderBranding())),this.settings.onPropertyChanged(y.sX,(()=>this.renderBranding())),t.subscribe(s.LZ,this.onAppPhaseChangeMessage)),this.progressUI=new ProgressRadial(t),this.loadUi(),this.getLoadingElements(),this.renderSplashScreen())}get waitForPlaying(){return this.playPromise.nativePromise()}loadUi(){if(this.uiRoot=document.getElementById("loading-gui"),!this.uiRoot)throw Error("Loading GUI root not found");this.uiRoot.classList.remove("hidden"),this.config.quickstart&&(this.uiRoot.style.pointerEvents="none")}getPresentationOptions(){const{hideTitle:e,hideBranding:t,quickstart:i}=this.config,n=!i&&(void 0!==e?!e:this.settings.tryGetProperty(y.DU,!0)),s=this.settings.tryGetProperty(y.sX,!1),r=this.settings.tryGetProperty(y.L,!0);return{title:n,presentedBy:void 0!==t?!t:r&&!s}}getLoadingElements(){this.presentedBy=document.getElementById("loading-presented-by"),this.poweredBy=document.getElementById("loading-powered-by"),this.mpLogo=document.getElementById("loading-mp-logo"),this.mpLogo.src=m,this.mpLogo.alt=this.locale.t(l.Z.ALT_MATTERPORT_LOGO),this.circleLoader=document.getElementById("circleLoader"),this.nameHeader=document.getElementById("loading-header"),this.background=document.getElementById("loading-background"),this.tint=document.getElementById("tint"),this.playIcon=document.getElementById("showcase-play")}addCobrand(){var e;if(null===(e=this.model)||void 0===e?void 0:e.presentedBy){const e=this.presentedBy.querySelector(".loading-label");e&&(e.textContent=this.locale.t(l.Z.PRESENTED_BY_CAPS));const t=this.presentedBy.querySelector(".subheader");t&&(t.textContent=this.model.presentedBy),this.presentedBy.classList.remove("hidden")}}hidePlayButtonUI(){this.background.style.backgroundImage="none",this.presentedBy.style.transition="none",this.presentedBy.classList.remove("faded-in"),this.poweredBy.style.transition="none",this.poweredBy.classList.remove("faded-in"),this.nameHeader.classList.add("hidden"),this.tint.classList.add("hidden"),this.circleLoader.classList.add("hidden"),this.uiRoot.classList.add("quickstart")}async showQuickstartUI(){this.background.classList.add("faded-out"),await(0,d.gw)(500),this.presentedBy.style.transition="",this.presentedBy.classList.add("faded-in"),this.poweredBy.style.transition="",this.poweredBy.classList.add("faded-in"),await(0,d.gw)(2500),this.presentedBy.classList.remove("faded-in"),this.poweredBy.classList.remove("faded-in"),this.uiRoot.classList.add("faded-out")}showLoadingUI(e){const t=document.createAttribute("data-status");t.value=this.locale.t(l.Z.LOADING);const i=document.getElementById("loader-cont");i.attributes.setNamedItem(t),i.classList.add(this.locale.languageCode),i.classList.add("loading"),e.classList.add("faded-out"),this.presentedBy.classList.add("faded-in")}renderTitle(){const{title:e}=this.getPresentationOptions();this.nameHeader.classList.toggle("hidden",!e)}renderBranding(){const{presentedBy:e}=this.getPresentationOptions();e?this.addCobrand():this.presentedBy.classList.add("hidden")}renderSplashScreen(){this.renderTitle(),this.renderBranding(),this.config.hidePoweredBy&&this.poweredBy.classList.add("hidden"),this.nameHeader.textContent=this.model.name,this.poweredBy.classList.add("faded-in"),this.tint.classList.add("faded-in");const e=document.getElementById("play-prompt");this.playPromise.then((()=>{this.config.quickstart?this.hidePlayButtonUI():this.showLoadingUI(e)})),this.config.autoplay?(this.progressUI.showProgress(),this.playPromise.resolve()):(e.classList.remove("hidden"),e.innerText=this.locale.t(l.Z.EXPLORE_3D_SPACE),this.playIcon.classList.remove("hidden"),this.uiRoot.addEventListener("click",(()=>this.resolvePlayPromise(!0,!1)))),this.renderBackground(),this.config.allowPlayInIframe||window.scrollTo(0,0)}renderBackground(){const e=window.devicePixelRatio||1,t=Math.max(window.innerWidth,400);this.background.style.backgroundImage=`url(${this.config.baseUrl}/api/v1/player/models/${this.config.modelId}/thumb?width=${t}&dpr=${e}&disable=upscale)`}}},19917:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>QuickMenus});var n=i(47724),s=i(736),r=i(24930),o=i(77719),a=i(59088),l=i(75892),c=i(35597),h=i(10613),d=i(45870),u=i(62881),p=i(27326),m=i(66999),g=i(73272),f=i(77037),v=i(20601),y=i(33874),b=i(81507),S=i(28963),E=i(44060),w=i(55461);class QuickMenus extends n.Y{constructor(){super(...arguments),this.name="quick-menus"}async init(e,t){this.settingsModule=await t.getModuleSync(r.default),this.scanInfoDataModule=await t.getModuleBySymbol(s.y.SCAN_INFO),this.settingsGui=this.settingsModule.getSettingsGui();const i=await t.market.waitForData(l.Z),n=await t.market.waitForData(y.e),g=await t.market.waitForData(c.O),T=await t.market.waitForData(p.c),_=await t.market.waitForData(a.M_);this.uIndex=this.settingsGui.addPanel("Link to location",[b.R.U],{allowSubGroups:!1,width:400,ratio:90});const M=[38,38,40,40,37,39,37,39,66,65,b.R.O];this.oIndex=this.settingsGui.addPanel("Scan Info",M,{allowSubGroups:!1,width:400,ratio:75}),this.pIndex=this.settingsGui.addPanel("Quick settings",[b.R.P],{allowSubGroups:!1}),this.settingsGui.loadPromise.then((()=>{this.settingsGui.addControl(this.uIndex,"","Link",{}),this.settingsGui.addControl(this.uIndex,"","Shorten URL",!0),this.settingsGui.addButton(this.uIndex,"","Copy to clipboard",(()=>{const e=document.createElement("input");e.type="text",e.value=this.buildLink(_,g,T,i),document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)})),this.settingsGui.toggle(this.uIndex),this.settingsGui.addControl(this.oIndex,"","Scan ID",{}),this.settingsGui.addControl(this.oIndex,"","Anchor ID",{}),this.settingsGui.addControl(this.oIndex,"","Created",{}),this.settingsGui.addControl(this.oIndex,"","Time of Day",{}),this.settingsGui.addControl(this.oIndex,"","Alignment",{}),this.settingsGui.addControl(this.oIndex,"","Options",{}),this.settingsGui.addControl(this.oIndex,"","Camera",{}),this.settingsGui.addControl(this.oIndex,"","Camera Types",{}),this.settingsGui.addControl(this.oIndex,"","Sensor Serials",{}),this.settingsGui.addControl(this.oIndex,"","Serial Number",{}),this.settingsGui.addControl(this.oIndex,"","Mount Calibration",{}),this.settingsGui.addControl(this.oIndex,"","Software Version",{}),this.settingsGui.addButton(this.oIndex,"","Copy Scan ID",(async()=>{if(i.currentSweep){const e=await this.scanInfoDataModule.getScanInfo(i.currentSweep);if(e){const t=document.createElement("input");t.type="text",t.value=e.id,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}}})),this.settingsGui.addButton(this.oIndex,"","Download Scan",(async()=>{if(i.currentSweep){const e=await this.scanInfoDataModule.getScanDownloadURL(i.currentSweep);e&&window.open(e)}})),this.settingsGui.toggle(this.oIndex);const e=d.WI*(180/Math.PI)*60;this.settingsGui.addControl(this.pIndex,"",m.U,!0),this.settingsGui.addControl(this.pIndex,"",S.s,!0),this.settingsGui.addControl(this.pIndex,"",E.r,!0),this.settingsGui.addControl(this.pIndex,"",w.b,!0),this.settingsGui.addSlider(this.pIndex,"",u.lookAccelerationKey,e,.25,10,2),this.settingsGui.addSlider(this.pIndex,"",o.baseTransitionSpeedKey,h.Z.camera.baseTransitionTime,1,5e3,0);const t=n.tryGetProperty(f.EU,f.Im);this.settingsGui.addSlider(this.pIndex,"",f.WQ,(0,v.JG)(t),.5,10,2),this.settingsGui.toggle(this.pIndex),this.settingsModule.registerSetting("Quick settings",u.lookAccelerationKey,e,!1),this.settingsModule.registerSetting("Quick settings",o.baseTransitionSpeedKey,h.Z.camera.baseTransitionTime,!1),this.settingsGui.onToggle(this.uIndex,(e=>{e&&this.settingsGui.updateSetting(this.uIndex,"Link",this.buildLink(_,g,T,i))})),this.settingsGui.onToggle(this.oIndex,(e=>{e&&this.refreshScanInfo(i)})),_.pose.onChanged((()=>{this.settingsGui.isLoaded&&this.settingsGui.isVisible(this.uIndex)&&this.settingsGui.updateSetting(this.uIndex,"Link",this.buildLink(_,g,T,i)),this.settingsGui.isLoaded&&this.settingsGui.isVisible(this.oIndex)&&this.refreshScanInfo(i)})),n.onPropertyChanged(f.WQ,(e=>{n.setProperty(f.EU,(0,v.HG)(e))}))}))}refreshScanInfo(e){e.currentSweep?this.scanInfoDataModule.getScanInfo(e.currentSweep).then((e=>{this.updateScanInfo(e)})):this.updateScanInfo(void 0)}updateScanInfo(e){this.settingsGui.updateSetting(this.oIndex,"Scan ID",e?e.id:""),this.settingsGui.updateSetting(this.oIndex,"Anchor ID",e?e.anchorId:""),this.settingsGui.updateSetting(this.oIndex,"Created",e?e.created:""),this.settingsGui.updateSetting(this.oIndex,"Time of Day",e?e.timeOfDay:""),this.settingsGui.updateSetting(this.oIndex,"Alignment",e?e.alignment:""),this.settingsGui.updateSetting(this.oIndex,"Options",e?JSON.stringify(e.options):""),this.settingsGui.updateSetting(this.oIndex,"Camera",e?`${e.camera.vendor} ${e.camera.model}`:""),this.settingsGui.updateSetting(this.oIndex,"Camera Types",e?JSON.stringify(e.camera.cameraTypes):""),this.settingsGui.updateSetting(this.oIndex,"Sensor Serials",e?JSON.stringify(e.camera.sensorSerialNumbers):""),this.settingsGui.updateSetting(this.oIndex,"Serial Number",e?e.camera.serialNumber:""),this.settingsGui.updateSetting(this.oIndex,"Mount Calibration",e?e.camera.mountCalibrationVersion:""),this.settingsGui.updateSetting(this.oIndex,"Software Version",e?e.camera.softwareVersion:"")}buildLink(e,t,i,n){const s=this.settingsGui.getSetting(this.uIndex,"Shorten URL"),r=g.K.getQueryString({cameraData:e,viewmodeData:t,floorsViewData:i,sweepData:n},s);return`${location.origin}/show/?${r}`}}},45386:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseAnalytics});var n=i(47724),s=i(66542),r=i(23847),o=i(69669),a=i(67838),l=i(42238),c=i(14973),h=i(65006),d=i(60771),u=i(98828),p=i(82702);const m=e=>`${e}_3.0`,g=()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return""}},f=()=>{const e=(new l.UAParser).getResult();let t=e.os.name,i=e.browser.name;const n=Object.assign({},e.device);return d._1()&&(t="iPadOS",n.vendor="Apple",n.model="iPad",n.type="tablet","Safari"===i&&(i="Mobile Safari")),{browser:{name:i,major:e.browser.major,version:e.browser.version,language:navigator.language||"",languages:navigator.languages?navigator.languages.join(", "):""},os:{name:t,version:e.os.version},device:{vendor:n.vendor,model:n.model,type:n.type}}};function v(e,t){return{app:{name:m(t),version:"3.1.51.7-84-g0dcbe0591"},locale:e,screen:{width:window.screen.width,height:window.screen.height,density:window.devicePixelRatio},timezone:g(),location:{}}}const y=a.K.Logging;var b=i(46114),S=i(19047);class InteractionmodeAnalytics{constructor(){this.handlers=[{msgType:b.m,func:(e,t,i)=>{const n=i.tryGetData(S.Z);n&&e.track("interaction_mode_changed",{interaction_mode_prev:t.fromMode,interaction_mode:t.mode,interaction_source:n.source})}}]}}var E,w=i(29397),T=i(85895),_=i(69941),M=i(35026);function x(e,t){switch(e){case M.z9.ALIGNED:return 1;case M.z9.UNALIGNED:return 2}switch(t){case M.hU.MANUAL:return 3}return 0}!function(e){e.USER="self-guided",e.TOUR="tour"}(E||(E={}));class CameraDataAnalytics{constructor(){this.startLoadTime=Date.now(),this.endLoadTime=Date.now(),this.panosViewed=0,this.handlers=[{msgType:w.Z,func:(e,t,i)=>{this.onMoveToSweepBegin(t.timestamp)}},{msgType:T.Z,func:(e,t,i)=>{const n=i.tryGetData(S.Z),s=i.tryGetData(_.k3);this.endLoadTime=Date.now();const r=this.endLoadTime-this.startLoadTime;e.track("pano_viewed",{pano_id:t.toSweep,pano_view_count:++this.panosViewed,alignment_type:x(t.alignmentType,t.placementType),navigation_source:s&&s.tourPlaying?E.TOUR:E.USER,interaction_source:n?n.source:S.Z.defaultSource,interaction_mode:n?n.mode:S.Z.defaultMode,load_time:r/1e3})}}]}onMoveToSweepBegin(e){this.startLoadTime=e}}var A=i(88814);class ViewmodeAnalytics{constructor(){this.handlers=[{msgType:A.Z,func:(e,t,i)=>{const n=i.tryGetData(S.Z),s={view_mode:t.toMode};n&&(s.interaction_source=n.source,s.interaction_mode=n.mode),e.track("mode_changed",s)}}]}}var O=i(51153),P=i(76896),D=i(74003),C=i(26627);const I=(e,t)=>{const i=t.tryGetData(C.i);if(!e||!i)return-1;return i.getFloor(e).index};class FloorChangeAnalytics{constructor(){this.handlers=[{msgType:P.P,func:(e,t,i)=>{const n=i.tryGetData(S.Z);e.track("floor_changed",{floor_id:t.floorName,interaction_source:n?n.source:S.Z.defaultSource,interaction_mode:n?n.mode:S.Z.defaultMode})}},{msgType:D.M,func:(e,t,i)=>{const n=i.tryGetData(S.Z);e.track("sweep_floor_fixup",{sweep_index:t.sweep.index,sweep_alignment:t.sweep.alignmentType,sweep_placement:t.sweep.placementType,sweep_floor_from:I(t.from,i),sweep_floor_to:I(t.to,i),interaction_source:n?n.source:S.Z.defaultSource,interaction_mode:n?n.mode:S.Z.defaultMode})}}]}}var L=i(24285),R=i(75892);class ZoomAnalytics{constructor(){this.firstZoom=!0,this.fromZoom=1,this.toZoom=1,this.handlers=[{msgType:L.Z,func:(e,t,i)=>{this.analytics||(this.analytics=e);const n=i.tryGetData(R.Z);n&&n.currentSweep!==this.currentPano&&(this.firstZoom=!0,this.currentPano=n.currentSweep,this.fromZoom=1),this.toZoom=t.zoomLevel,clearTimeout(this.sendTimeout),this.sendTimeout=window.setTimeout(this.trackZoomEvent.bind(this),150)}}]}trackZoomEvent(){const e=this.firstZoom?"initial":"followup";this.analytics.track("zoom_"+e,{from:this.fromZoom,to:this.toZoom,pano:this.currentPano}),this.firstZoom=!1,this.fromZoom=this.toZoom}}var N=i(736),k=i(8150),B=i(21479),F=i(32770);class TimingData extends F.V{constructor(){super(...arguments),this.name="timing",this.modelLoadingStartTime=0,this.waitingStartTime=0,this.appPlayingTime=0,this.appStartedTime=0}get totalTimeToAppStarting(){let e=this.appStartedTime-performance.timing.navigationStart;return this.modelLoadingStartTime&&this.waitingStartTime&&(e-=this.modelLoadingStartTime-this.waitingStartTime),e}get totalTimeToAppPlaying(){let e=this.appPlayingTime-performance.timing.navigationStart;return this.modelLoadingStartTime&&this.waitingStartTime&&(e-=this.modelLoadingStartTime-this.waitingStartTime),e}}var U=i(88512),V=i(3248);const H=new U.Z("showcase-session"),G=new TimingData;class ShowcaseSessionAnalytics{constructor(e,t){this.analytics=e,this.engine=t,this.handlers=[{msgType:k.LZ,func:async(e,t,i)=>{switch(t.phase){case B.nh.WAITING:G.waitingStartTime=Date.now(),G.commit(),e.track("impression",{url_params:d.UD(),visible:!0});break;case B.nh.LOADING:G.modelLoadingStartTime=Date.now(),G.commit();break;case B.nh.STARTING:{G.appStartedTime=Date.now(),G.commit(),H.info("First render, model loaded "+G.totalTimeToAppStarting/1e3);const t=this.engine.market.tryGetData(V.af),i=(await this.engine.getModuleBySymbol(N.y.WEBGL_RENDERER)).getCapabilities(),n={has_hlr:!t||t.options.highlight_reel,duration:Date.now()-G.modelLoadingStartTime,duration_from_navigation_start:Date.now()-performance.timing.navigationStart,gl_v2:i.gl_v2,gl_max_textures:i.gl_max_textures,gl_max_texture_size:i.gl_max_texture_size,gl_max_cubemap_size:i.gl_max_cubemap_size,gl_instancing:i.gl_instancing,gl_oes_texture_float:i.gl_oes_texture_float,gl_oes_texture_half_float:i.gl_oes_texture_half_float,gl_depth_texture:i.gl_depth_texture,gl_draw_buffers:i.gl_draw_buffers,gl_oes_fbo_render_mip_map:i.gl_oes_fbo_render_mip_map,gl_shader_texture_lod:i.gl_shader_texture_lod,gl_oes_vertex_array_obj:i.gl_oes_vertex_array_obj,gl_ovr_multi_view:i.gl_ovr_multi_view,gl_color_buffer_float:i.gl_color_buffer_float,gl_astc_supported:i.gl_astc_supported,gl_etc1_supported:i.gl_etc1_supported,gl_etc2_supported:i.gl_etc2_supported,gl_dxt_supported:i.gl_dxt_supported,gl_bptc_supported:i.gl_bptc_supported,gl_pvrtc_supported:i.gl_pvrtc_supported};e.track("model_loaded",n);break}case B.nh.PLAYING:G.appPlayingTime=Date.now(),G.commit(),H.info("Playing, session started "+G.totalTimeToAppPlaying/1e3),e.track("session_started"),window.addEventListener("unload",this.sessionEnded),e.track("load_times",{time_to_app_start:G.totalTimeToAppStarting,time_to_app_playing:G.totalTimeToAppPlaying});break;case B.nh.ERROR:{const t=await i.waitForData(B.pu),{error:n}=t,s=n&&n.name?n.name:n&&n.constructor?n.constructor.name:null,r=n?n.message:null,o=n&&n.stack?n.stack.split("\n"):[],a=o.length>=2?o[1].match(/\s+at\s+([^\s]+)/):null,l=!!u.h("oops",""),c={error_dialog:"oops",error_type:s||"",exception:{message:`${s}: ${r}`,function:a?a[1]:null,stack:o.slice(1,5).join("\n")},duration:Date.now()-G.modelLoadingStartTime,duration_from_navigation_start:Date.now()-performance.timing.navigationStart,mock_error:l};e.track("error_displayed",c);break}}}}],this.sessionEnded=()=>{this.analytics.trackAsync("session_ended",{duration:Date.now()-G.appPlayingTime})}}dispose(){window.removeEventListener("unload",this.sessionEnded)}}var z=i(68576),W=i(10757),j=i(58232),K=i(94329),q=i(35597),Z=i(64323);const Y=new U.Z("/index.js");let $=0,Q=1/0,X=null,J=null,ee=window.devicePixelRatio||1;const te={},ie=new j.P(1e3);class RenderingPerformanceAnalytics{constructor(){this.handlers=[{msgType:z.Z,func:(e,t,i)=>{J!==B.nh.STARTING&&J!==B.nh.PLAYING||ne(e,K.Ey[t.toMode],1e4)}},{msgType:k.LZ,func:(e,t,i)=>{const n=i.tryGetData(q.O);t.phase===B.nh.LOADING?ne(e,"Loading",6e4):t.phase===B.nh.STARTING?ne(e,"Starting",6e4):t.phase===B.nh.PLAYING&&n&&n.currentMode&&ne(e,K.Ey[n.currentMode],1e4),J=t.phase}},{msgType:Z.V,func:(e,t,i)=>{ee=t.pixelRatio}}]}}function ne(e,t,i){t!==X&&(X&&(re(e),se()),te[t]||(X=t,Q=i,te[X]=!0))}const se=()=>{X=null,ie.clear(),$=0},re=e=>{const t=ie.getList();if(0!==t.length)try{const i=oe(t);e.track("performance",i)}catch(e){Y.warn("Could not send performance metrics",e)}},oe=e=>{let t=0,i=0,n=0,s=0,r=0,o=0;for(const a of e)t+=a,a<0||(a<=16.7?i+=a:a<=33.3?n+=a:a<=100?s+=a:a<=1e3?r+=a:o+=a);if(t<=0)throw Error("No positive timings, cannot calculate performance data");const a=t/e.length;i/=t,n/=t,s/=t,r/=t,o/=t;const l=e.slice(),c=(0,W.Pe)(l,50),h=(0,W.Pe)(l,95,!1),d=l[l.length-1];return{phase:X,frame_delta:a,frame_delta_avg:a,frame_delta_median:c,frame_delta_95th:h,frame_delta_max:d,duration:t,time_60_fps:i,time_60_30_fps:n,time_30_10_fps:s,time_10_1_fps:r,time_1_0_fps:o,pixel_ratio:ee}};var ae=i(33874),le=i(21244),ce=i(27326);const he=(e,t)=>{const i=t.tryGetData(ce.c);if(!i)return-1;return(e?i.floors.getFloor(e):i.getHighestVisibleFloor()).index};class MeasurementAnalytics{constructor(){this.handlers=[{msgType:le.rf,func:(e,t,i)=>{const n={measure_sid:t.data.sid,start_position:t.data.startPosition,end_position:t.data.endPosition,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:he(t.data.floorId,i),feature_type:t.data.featureType,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_segment_add",n)}},{msgType:le.u6,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:he(t.data.floorId,i),feature_type:t.data.featureType,measure_type:t.data.type,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_add",n)}},{msgType:le.ty,func:(e,t)=>{const i={measure_sid:t.sid,measure_text:t.text};e.track("measure_add_title",i)}},{msgType:le.mM,func:(e,t)=>{const i={measure_sid:t.sid,measure_old_text:t.oldText,measure_new_text:t.newText};e.track("measure_update_title",i)}},{msgType:le.$Z,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:he(t.data.floorId,i),measure_count:t.data.count,continuous:t.data.continuous};e.track("measure_remove",n)}},{msgType:le.av,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:he(t.data.floorId,i),feature_type:t.data.featureType,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_update",n)}},{msgType:le.$n,func:(e,t)=>{const i=t.opened?"measure_mode_enter":"measure_mode_exit",n={viewmode:t.viewmode,measure_count:t.count};e.track(i,n)}},{msgType:le.ff,func:(e,t)=>{e.track("measure_cancelled",{})}}]}}var de=i(41452),ue=i(38587);class ActivityAnalytics{constructor(){this.handlers=[{msgType:ue.i,func:(e,t)=>{const i={duration_dollhouse:t.durationDollhouse,duration_floorplan:t.durationFloorplan,duration_inside:t.durationInside,duration:t.durationDollhouse+t.durationFloorplan+t.durationInside,main_mode:t.mainMode,bytes_downloaded:t.totalBytesDownloaded,tiles_downloaded:t.tilesDownloaded};e.track("activity_ping",i)}}]}}var pe,me=i(35003),ge=i(51869),fe=i(88727),ve=i(49340),ye=i(38022),be=i(3805),Se=i(50401);!function(e){e.UNINITIALIZED="uninitialized",e.INACTIVE="inactive",e.ACTIVE="active"}(pe||(pe={}));class ShowcaseActivityTracking{constructor(){this.name="activity-analytics",this._state=pe.UNINITIALIZED,this.activeModeMap=new Map,this.totalTilesDownloaded=0,this.onTileDownloaded=()=>{this.totalTilesDownloaded++}}async init(e,t,i){this.engine=e,this.requestQueue=i,[this.input,this.viewmodeData,this.applicationData]=await Promise.all([await e.getModuleBySymbol(N.y.INPUT),await e.market.waitForData(q.O),await e.market.waitForData(B.pu)]);const n=[],s=[me.R,ge._t,fe.e,ve.er,ye.G],r=()=>this.active=!0;this.applicationData.phase===B.nh.PLAYING?this._state=pe.INACTIVE:n.push(e.subscribe(k.LZ,(()=>{this.applicationData.phase===B.nh.PLAYING&&(this._state=pe.INACTIVE)}))),n.push(...(()=>{const e=[];return s.forEach((t=>{e.push(this.input.registerUnfilteredHandler(t,r))})),e})()),n.push(e.subscribe(A.Z,(e=>{const t=e.fromMode,i=e.toMode;t&&t!==K.Ey.Transition&&this.applicationData.phase===B.nh.PLAYING&&this.handleModeChange(t,i)}))),n.push(this.engine.subscribe(Se.o,this.onTileDownloaded)),t(n)}get active(){return this._state===pe.ACTIVE}set active(e){this._state!==pe.UNINITIALIZED&&(e&&this._state===pe.INACTIVE&&this.startActivityTimeout(),this._state=e?pe.ACTIVE:pe.INACTIVE)}handleModeChange(e,t){this.activeModeMap.has(t)?this.updateActivityTimeForMode(t,!0):this.activeModeMap.set(t,{previousTime:Date.now(),totalTimeinMS:0}),this.updateActivityTimeForMode(e)}updateActivityTimeForMode(e,t){const i=this.activeModeMap.get(e);if(void 0===i)return;const{previousTime:n,totalTimeinMS:s}=i;t?this.activeModeMap.set(e,{previousTime:Date.now(),totalTimeinMS:s}):this.activeModeMap.set(e,{previousTime:Date.now(),totalTimeinMS:s+(Date.now()-n)})}startActivityTimeout(){this.activeModeMap.set(K.Ey.Dollhouse,{previousTime:Date.now(),totalTimeinMS:0}),this.activeModeMap.set(K.Ey.Floorplan,{previousTime:Date.now(),totalTimeinMS:0}),this.activeModeMap.set(K.Ey.Panorama,{previousTime:Date.now(),totalTimeinMS:0}),window.setTimeout(this.notifyActivityAnalytic.bind(this),ShowcaseActivityTracking.ACTIVITY_INTERVAL)}notifyActivityAnalytic(){if(this.viewmodeData.currentMode&&this.viewmodeData.currentMode!==K.Ey.Transition&&this.updateActivityTimeForMode(this.viewmodeData.currentMode),this.active){let e=0,t=K.Ey.Panorama;this.activeModeMap.forEach(((i,n)=>{i.totalTimeinMS>e&&(t=n,e=i.totalTimeinMS)})),this.active=!1;const[i,n,s]=[this.activeModeMap.get(K.Ey.Dollhouse),this.activeModeMap.get(K.Ey.Floorplan),this.activeModeMap.get(K.Ey.Panorama)].map((e=>e?e.totalTimeinMS:0));this.engine.broadcast(new ue.i(i,n,s,be.KP[t],this.requestQueue.totalBytesDownloaded,this.totalTilesDownloaded))}}}ShowcaseActivityTracking.ACTIVITY_INTERVAL=15e3;var Ee,we=i(79548);!function(e){e.USER="self-guided",e.TOUR="tour"}(Ee||(Ee={}));class RoomDataAnalytics{constructor(){this.handlers=[{msgType:we.D,func:(e,t,i)=>{const n=i.tryGetData(S.Z),s=i.tryGetData(_.k3),r={room_id:t.roomId,room_index:t.meshSubgroup,room_type:t.roomType,viewmode:t.viewmode?be.KP[t.viewmode]:t.viewmode,room_visit_count:t.visitCount,room_count:t.roomCount,navigation_source:s&&s.tourPlaying?Ee.TOUR:Ee.USER,interaction_source:n?n.source:S.Z.defaultSource,interaction_mode:n?n.mode:S.Z.defaultMode};e.track("room_visited",r)}}]}}var Te=i(61119),_e=i(25643);class ShowcaseLabelAnalytics{constructor(){this.handlers=[{msgType:_e.V,func:(e,t,i)=>{e.track("internal_warning",{warningType:"rtl_disabled_roomnav"})}}]}}var Me=i(62627);class ModelRatingAnalytics{constructor(){this.handlers=[{msgType:Me.E,func:(e,t)=>{const{happiness:i,quality:n=[],navigation:s=[],feedback:r=""}=t.rating,o={happiness:+i,quality_issues_lighting:n.includes("lighting"),quality_issues_3d_mesh:n.includes("3d_mesh"),quality_issues_coloring:n.includes("coloring"),quality_issues_image_quality:n.includes("image_quality"),navigation_issues_blocked_doorways:s.includes("blocked_doorways"),navigation_issues_obstructions:s.includes("obstructions"),navigation_issues_misaligned_scans:s.includes("misaligned_scans"),navigation_issues_floor_separation:s.includes("floor_separation"),navigation_issues_disappearing_floors:s.includes("disappearing_floors"),feedback:r};e.track("model_rated",o)}}]}}const xe=new U.Z("showcase-analytics");class ShowcaseAnalytics extends n.Y{constructor(){super(...arguments),this.name="showcase-analytics",this.loaded=!1,this.handlers=[],this.track=(e,t)=>{this.analytics.track(e,t)}}async init(e,t){this.analytics=await t.getModule(r.default),this.apiClient=(await t.getModule(s.default)).getApi();const i=await t.market.waitForData(ae.e),n=await t.getModule(de.default);this.addMessageHandlers(this.analytics,t),this.context=function(e,t,i){const n=v(t,i);return(0,c.Z)(e).then((e=>{n.location={city:e.city,country:e.country_name,region:e.region}})),n}(e.apiQueue,n.languageCode,e.appName),this.options=Object.assign(Object.assign({mds_enabled:i.tryGetProperty(Te.$,!1)},{model_id:(0,h.uz)(),start_source:u.h("play",!1)?"autoplay":d.yL()?"click":"fullpage",autoplay:u.h("play",!1)||!d.yL(),quickstart:1===u.h("qust",0)||1===u.h("qs",0),language_tag:u.h("lang",null),is_mobile:d.tq(),iframe:d.yL(),aspect_ratio:d.dy(),session_id:(0,p.D)(),window:{height:window.innerHeight,width:window.innerWidth},platform:f()}),e.additionalValues),this.activityTracking=new ShowcaseActivityTracking,this.activityTracking.init(t,this.registerBindings.bind(this),e.apiQueue);const o=await this.createAnalyticsConfigs(e,i);this.analytics.load(o,e.analyticsQueue,this.options,this.context,this.apiClient.user).then((()=>{this.loaded=!0}))}addMessageHandlers(e,t){this.addMessageHandler(new ShowcaseSessionAnalytics(e,t),t),this.addMessageHandler(new ViewmodeAnalytics,t),this.addMessageHandler(new CameraDataAnalytics,t),this.addMessageHandler(new InteractionmodeAnalytics,t),this.addMessageHandler(new FloorChangeAnalytics,t),this.addMessageHandler(new O.s,t),this.addMessageHandler(new ZoomAnalytics,t),this.addMessageHandler(new MeasurementAnalytics,t),this.addMessageHandler(new RenderingPerformanceAnalytics,t),this.addMessageHandler(new ActivityAnalytics,t),this.addMessageHandler(new RoomDataAnalytics,t),this.addMessageHandler(new ShowcaseLabelAnalytics,t),this.addMessageHandler(new ModelRatingAnalytics,t)}addMessageHandler(e,t){this.handlers.push(e),e.handlers.forEach(((e,i)=>{this.bindings.push(t.subscribe(e.msgType,(i=>{e.func(this.analytics,i,t.market)})))}))}registerBindings(e){this.bindings.push(...e)}async createAnalyticsConfig(e,t){if(((e,t)=>{const i=Object.keys(e);for(const n of i)if(e[n]===t)return!0;return!1})(a.K,e)){const{apiClient:i}=this,n=o.H[e],s=null!==n.key?await i.getAppKey(t,n.key):null,r=null!==n.url?await i.getAppKey(t,n.url):null;if(null===n.key||null!==s&&null===n.url||null!==r)return{provider:e,token:s,url:r}}return null}async createAnalyticsConfigs(e,t){const i=e.appName,n=void 0!==e.provider?e.provider:await this.apiClient.getAppKey(i,"analytics_provider"),s=[];if(!n)return s;const r=n.split(",");for(const e of r){const t=await this.createAnalyticsConfig(e,i);null!==t?s.push(t):xe.warn(`Failed to set up ${e}, token/url required but not found in config`)}return s.length<1&&s.push({provider:y,token:null,url:null}),s}onUpdate(e){this.loaded&&((e,t)=>{X&&(ie.push(t),$+=t,$>=Q&&(re(e),se()))})(this.analytics,e)}dispose(e){super.dispose(e);for(const e of this.handlers)e.dispose&&e.dispose();this.handlers=[]}getSessionId(){return this.options.session_id}}},38587:(e,t,i)=>{"use strict";i.d(t,{i:()=>ActivityPingMessage});var n=i(91466);class ActivityPingMessage extends n.v{constructor(e,t,i,n,s,r){super(),this.durationDollhouse=e,this.durationFloorplan=t,this.durationInside=i,this.mainMode=n,this.totalBytesDownloaded=s,this.tilesDownloaded=r}}},32086:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseHotkeys});var n=i(88727),s=i(81507),r=i(3805),o=i(25923),a=i(47724),l=i(88216),c=i(35597),h=i(94329),d=i(33874),u=i(2388),p=i(736);class ShowcaseHotkeys extends a.Y{constructor(){super(...arguments),this.name="showcase-hotkeys",this.inputCommandMap={[l.M.PRESSED]:{[s.R.ONE]:()=>(this.viewmodeData.currentMode===h.Ey.Panorama&&(this.issueCommand(new o.g(0)),this.settings.setProperty(u.Lp,!1),this.currentView=0),this.switchToMode(r.BD.INSIDE)),[s.R.TWO]:()=>this.switchToMode(r.BD.DOLLHOUSE),[s.R.THREE]:()=>this.switchToMode(r.BD.FLOORPLAN),[s.R.ZERO]:()=>{const e=this.currentView++%this.meshViews.length;return this.meshViews[e](),this.switchToMode(r.BD.INSIDE)}}},this.currentView=0,this.meshViews=[()=>{this.issueCommand(new o.g(1)),this.settings.setProperty(u.Lp,!1)},()=>{this.issueCommand(new o.g(1)),this.settings.setProperty(u.Lp,!0)},()=>{this.issueCommand(new o.g(0)),this.settings.setProperty(u.Lp,!0)},()=>{this.issueCommand(new o.g(0)),this.settings.setProperty(u.Lp,!1)}]}async init(e,t){const i=await t.getModuleBySymbol(p.y.INPUT);[this.viewmodeData,this.settings]=await Promise.all([t.market.waitForData(c.O),t.market.waitForData(d.e)]),this.issueCommand=t.commandBinder.issueCommand.bind(t.commandBinder),i.registerHandler(n.e,(async e=>{this.inputCommandMap[e.state]&&this.inputCommandMap[e.state][e.key]&&await this.inputCommandMap[e.state][e.key]()}))}async switchToMode(e){this.viewmodeData.currentMode!==h.Ey.Transition&&await this.issueCommand(new r._i(e))}}},81220:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcasePasswordModule});var n=i(26605),s=i(47724),r=i(69759),o=i(18349),a=i(41452),l=i(88512),c=i(94184),h=i(13789),d=i(90831);class PoweredBy extends n.Component{constructor(e){super(e)}render(){const{attributionLinkText:e,attributionLinkUrl:t}=this.props,{locale:i}=this.context;return(0,n.h)("div",{class:"powered-by"},(0,n.h)("p",{class:"powered-by-label"},i.t(h.Z.POWERED_BY)),(0,n.h)("img",{class:"powered-by-logo",alt:"Matterport",src:d,width:"150",height:"32"}),t&&(0,n.h)("a",{href:t,class:"powered-by-link"},e||t))}}var u=i(24877),p=i(31102);class InvalidPasswordException extends p.y{constructor(e="Invalid password"){super(e),this.name="InvalidPassword"}}class TooManyAttemptsException extends p.y{constructor(e="Too many attempts, please try again in a few minutes"){super(e),this.name="TooManyAttempts"}}const m=new l.Z("showcase-password");class ShowcasePasswordUi extends n.Component{constructor(e){super(e),this.onInputChange=e=>{const{name:t,value:i}=e.target;"password"===t&&this.setState({password:i,hasError:!1})},this.onSubmit=async e=>{e.preventDefault(),this.setState({formEnabled:!1}),await this.authenticate(),this.setState({formEnabled:!0})},this.state={formEnabled:!0,hasError:!1,tooManyAttempts:!1,password:""}}async authenticate(){const{authenticate:e}=this.props,{password:t}=this.state;m.debug("Validating password input...");const i=await e(t).catch((e=>(e instanceof TooManyAttemptsException&&this.setState({hasError:!0,tooManyAttempts:!0}),!1)));this.setState({hasError:!i})}getChildContext(){const{locale:e}=this.props;return{locale:e}}stopPropagation(e){e.stopPropagation()}renderLockout(){const{locale:e}=this.props;return(0,n.h)("div",{class:"sc-password-modal sc-password-lockout"},(0,n.h)("header",{class:"modal-header"},(0,n.h)("h1",{class:"modal-title"},e.t(h.Z.SC_LOCKOUT_TITLE))),(0,n.h)("p",{class:"modal-body"},e.t(h.Z.SC_LOCKOUT_MESSAGE)))}renderLoginForm(){const{hasError:e,password:t,formEnabled:i}=this.state,{locale:s}=this.props;return(0,n.h)("div",{class:"sc-password-modal sc-password-login"},(0,n.h)("header",{class:"modal-header"},(0,n.h)("h1",{class:"modal-title"},s.t(h.Z.SC_PASSWORD_TITLE))),(0,n.h)("div",{class:"modal-body"},(0,n.h)("form",{onSubmit:this.onSubmit,class:"sc-password-form"},(0,n.h)("input",{type:"password",name:"password",placeholder:s.t(h.Z.SC_PASSWORD_PLACEHOLDER),onInput:this.onInputChange,onKeyDown:this.stopPropagation,onKeyPress:this.stopPropagation,onKeyUp:this.stopPropagation,disabled:!i,value:t,class:c("sc-password-input",{error:e}),autocomplete:"on"}),(0,n.h)("button",{type:"submit",disabled:!i,class:"sc-password-submit"},s.t(h.Z.SC_PASSWORD_SUBMIT))),e&&(0,n.h)("p",{class:"help-text error"},(0,n.h)("span",{class:"icon icon-error"}),s.t(h.Z.SC_PASSWORD_INVALID)),!e&&(0,n.h)("p",{class:"help-text"})))}render(){const{hasError:e,tooManyAttempts:t}=this.state,i=e&&t?this.renderLockout():this.renderLoginForm();return(0,n.h)("div",{class:"sc-password-ui",style:`background-image: url(${u})`},(0,n.h)("div",{class:"sc-password-content"},i),(0,n.h)("footer",{class:"sc-password-footer"},(0,n.h)(PoweredBy,null)))}}var g=i(15030);const f=new l.Z("showcase-password");class ShowcasePasswordModule extends s.Y{constructor(){super(...arguments),this.name="showcase-password",this.authenticated=!1}async init(e,t){this.config=e,this.engine=t;const i=e.baseUrl||window.location.origin;this.auth=new r.L(i)}showPasswordScreen(){this.loadUi()}hidePasswordScreen(){this.unloadUi()}async loadUi(){const{container:e}=this.config,t=await this.engine.getModule(a.default),i=(0,n.h)(ShowcasePasswordUi,{locale:t,authenticate:e=>this.authenticate(e)});this.ref=(0,n.render)(i,e)}unloadUi(){if(!this.ref)return;const{container:e}=this.config;(0,n.render)(null,e,this.ref)}async authenticate(e){const{modelId:t}=this.config;if(!await this.auth.authenticate(t,e)){switch(this.engine.broadcast(new g.s(this.auth.errorType)),this.auth.errorType){case o.s.INVALID_CREDENTIALS:throw new InvalidPasswordException;case o.s.TOO_MANY_ATTEMPTS:throw new TooManyAttemptsException}return!1}return f.debug("Password authentication was successful"),this.engine.broadcast(new g.L),!0}}},15030:(e,t,i)=>{"use strict";i.d(t,{L:()=>PasswordAuthenticationSuccess,s:()=>PasswordAuthenticationFail});var n=i(91466);class PasswordAuthenticationSuccess extends n.v{}class PasswordAuthenticationFail extends n.v{constructor(e){super(),this.errorType=e}}},31778:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseSettings});var n=i(66097),s=i(47724),r=i(24930),o=i(33874),a=i(3248),l=i(3506),c=i(31278),h=i(88512),d=i(38330),u=i(80121),p=i(99398),m=i(18630);const g=e=>{if(!e||!e.player_options)return null;const t=e.player_options||{},i={address:t.address,background_color:t.background_color,contact_email:t.contact_email,contact_name:t.contact_name,contact_phone:t.contact_phone,dollhouse:t.dollhouse,dollhouse_pan_speed:t.dollhouse_pan_speed,external_url:t.external_url,fast_transitions:t.fast_transitions,floor_plan:t.floor_plan,floor_select:t.floor_select,highlight_reel:t.highlight_reel,labels:t.labels,labels_dh:t.labels_dh,measurements:t.measurements,measurements_saved:t.measurements_saved,model_name:t.model_name,model_summary:t.model_summary,pan_angle:t.pan_angle,pan_direction:t.pan_direction,pan_speed:t.pan_speed,presented_by:t.presented_by,tour_buttons:t.tour_buttons,transition_speed:t.transition_speed,transition_time:t.transition_time,unit_type:t.unit_type||e.unit_type,zoom_duration:t.zoom_duration};return new a.af(i)},f=(e,t)=>({player_options:{address:e.options.address,background_color:e.options.background_color,contact_email:e.options.contact_email,contact_name:e.options.contact_name,contact_phone:e.options.contact_phone,dollhouse:e.options.dollhouse,dollhouse_pan_speed:e.options.dollhouse_pan_speed,external_url:e.options.external_url,fast_transitions:e.options.fast_transitions,floor_plan:e.options.floor_plan,floor_select:e.options.floor_select,highlight_reel:e.options.highlight_reel,labels:e.options.labels,labels_dh:e.options.labels_dh,measurements:e.options.measurements,measurements_saved:e.options.measurements_saved,model_name:e.options.model_name,model_summary:e.options.model_summary,pan_angle:e.options.pan_angle,pan_direction:e.options.pan_direction,pan_speed:e.options.pan_speed,presented_by:e.options.presented_by,tour_buttons:e.options.tour_buttons,transition_speed:e.options.transition_speed,transition_time:e.options.transition_time,unit_type:e.options.unit_type,zoom_duration:e.options.zoom_duration}});var v,y=i(94474);!function(e){e.black="black",e.grey="grey",e.white="white",e.default="black"}(v||(v={}));var b,S,E,w=i(16047);!function(e){e.BLACK="black",e.GREY="grey",e.WHITE="white"}(b||(b={})),function(e){e.DISABLED="disabled",e.MEASURE="measure",e.MEASURE_AND_VIEW="measureAndView"}(S||(S={})),function(e){e.metric="metric",e.imperial="imperial"}(E||(E={}));var T=i(51058),_=i(52599);const M=new h.Z("mds-player-options-deserializer"),x={[w.Y.LEFT]:_.kw.Left,[w.Y.RIGHT]:_.kw.Right,[w.Y.AUTO]:_.kw.Auto},A={[b.BLACK]:v.black,[b.GREY]:v.grey,[b.WHITE]:v.white};class MdsPlayerOptionsDeserializer{deserialize(e){if(!e||!this.validate(e))return M.debug("Deserialized invalid options data from MDS",e),null;const t=(e.publication||{}).options||{},i=e.options,n=x[i.tourPanDirection],s={address:t.address,contact_email:t.contactEmail,contact_name:t.contactName,contact_phone:t.contactPhone,dollhouse:i.dollhouseEnabled,external_url:t.externalUrl,floor_plan:i.floorplanEnabled,floor_select:i.floorSelectEnabled,highlight_reel:i.highlightReelEnabled,labels:i.labelsEnabled,labels_dh:i.dollhouseLabelsEnabled,model_name:t.modelName,model_summary:t.modelSummary,presented_by:t.presentedBy,measurements:i.measurements!==S.DISABLED,measurements_saved:i.measurements===S.MEASURE_AND_VIEW,unit_type:i.unitType===E.imperial?T.M.IMPERIAL:T.M.METRIC,background_color:A[i.backgroundColor],tour_buttons:i.tourButtonsEnabled,fast_transitions:i.tourFastTransitionsEnabled,transition_speed:i.tourTransitionSpeed,transition_time:i.tourTransitionTime,pan_speed:i.tourPanSpeed,dollhouse_pan_speed:i.tourDollhousePanSpeed,zoom_duration:i.tourZoomDuration,pan_angle:i.tourPanAngle,pan_direction:n};return new a.af(s)}validate(e){return["id","options","publication"].every((t=>t in e))}}var O;!function(e){e.ENABLED="enabled",e.DISABLED="disabled",e.DEFAULT="default"}(O||(O={}));var P=i(71918);const D=(0,P.Sc)(x),C=(0,P.Sc)(A);class MdsPlayerOptionsSerializer{serialize(e){const t={},i=e.options||{};if(void 0!==i.dollhouse&&(t.dollhouseOverride=i.dollhouse?O.ENABLED:O.DISABLED),void 0!==i.floor_plan&&(t.floorplanOverride=i.floor_plan?O.ENABLED:O.DISABLED),void 0!==i.floor_select&&(t.floorSelectOverride=i.floor_select?O.ENABLED:O.DISABLED),void 0!==i.labels&&(t.labelsOverride=i.labels?O.ENABLED:O.DISABLED),void 0!==i.labels_dh&&(t.dollhouseLabelsOverride=i.labels_dh?O.ENABLED:O.DISABLED),void 0!==i.highlight_reel&&(t.highlightReelOverride=i.highlight_reel?O.ENABLED:O.DISABLED),void 0!==i.background_color&&(t.backgroundColor={set:C[i.background_color]||b.BLACK}),void 0!==i.unit_type){const e=i.unit_type===T.M.METRIC?E.metric:E.imperial;t.unitType={set:e}}if(void 0!==i.measurements||void 0!==i.measurements_saved){const e=i.measurements&&i.measurements_saved?S.MEASURE_AND_VIEW:i.measurements?S.MEASURE:S.DISABLED;t.measurements={set:e}}void 0!==i.tour_buttons&&(t.tourButtonsOverride=i.tour_buttons?O.ENABLED:O.DISABLED),void 0!==i.fast_transitions&&(t.tourFastTransitionsOverride=i.fast_transitions?O.ENABLED:O.DISABLED),void 0!==i.pan_angle&&(t.tourPanAngle={set:i.pan_angle}),void 0!==i.pan_direction&&(t.tourPanDirection={set:D[i.pan_direction]}),void 0!==i.pan_speed&&(t.tourPanSpeed={set:i.pan_speed}),void 0!==i.transition_speed&&(t.tourTransitionSpeed={set:i.transition_speed}),void 0!==i.transition_time&&(t.tourTransitionTime={set:i.transition_time}),void 0!==i.zoom_duration&&(t.tourZoomDuration={set:i.zoom_duration}),void 0!==i.dollhouse_pan_speed&&(t.tourDollhousePanSpeed={set:i.dollhouse_pan_speed});const n={};return void 0!==i.presented_by&&(n.presentedByOverride=i.presented_by?O.ENABLED:O.DISABLED),void 0!==i.contact_email&&(n.contactEmailOverride=i.contact_email?O.ENABLED:O.DISABLED),void 0!==i.contact_name&&(n.contactNameOverride=i.contact_name?O.ENABLED:O.DISABLED),void 0!==i.contact_phone&&(n.contactPhoneOverride=i.contact_phone?O.ENABLED:O.DISABLED),void 0!==i.external_url&&(n.externalUrlOverride=i.external_url?O.ENABLED:O.DISABLED),void 0!==i.model_name&&(n.modelNameOverride=i.model_name?O.ENABLED:O.DISABLED),void 0!==i.model_summary&&(n.modelSummaryOverride=i.model_summary?O.ENABLED:O.DISABLED),void 0!==i.address&&(n.addressOverride=i.address?O.ENABLED:O.DISABLED),{options:t,publication:{options:n}}}}var I=i(91985);const L=new h.Z("mds-player-options-store");class MdsPlayerOptionsStore extends y.u{constructor(){super(...arguments),this.serializer=new MdsPlayerOptionsSerializer,this.deserializer=new MdsPlayerOptionsDeserializer,this.prefetchKey="data.model.publication.options"}async read(e={}){const t={modelId:this.getViewId()};return this.query(I.GetModelOptions,t,e).then((e=>{var t;return this.deserializer.deserialize(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)}))}async update(e){const t=this.getViewId(),i=this.serializer.serialize(e);if(0===Object.keys(i).length)throw new Error("No data to update?");return this.mutate(I.PatchModel,{modelId:t,patch:i}).then((e=>{L.debug(e)}))}}var R=i(57938),N=i(39729),k=i(26587),B=i(38420),F=i(50988);const U=new h.Z("showcase-settings");class ShowcaseSettings extends s.Y{constructor(){super(...arguments),this.name="showcase-settings",this.updateTransitionType=(e,t,i)=>{const n=e.options.fast_transitions?c.n.FadeToBlack:c.n.Interpolate;t.hasProperty(l.gj)?t.setProperty(l.gj,n):i.registerSetting("player_options",l.gj,n)}}async init(e,t){this.engine=t,this.store=this.configureStorage(e);const[i,n,s,l]=await Promise.all([t.getModule(r.default),t.market.waitForData(o.e),t.getModule(k.F),this.store.read()]);this.playerOptionsData=l||new a.af,t.market.register(this,a.af,this.playerOptionsData),this.configureMonitor(e);for(const e in a.gx){const t=a.gx[e],n=this.playerOptionsData.options[t];if(i.hasProperty(t)){const e=i.getProperty(t);i.updateSetting(t,n&&e),U.debug(`Updated player_options setting ${t} = ${n&&e}`)}else i.registerSetting("player_options",t,n),U.debug(`Registered player_options setting ${t} = ${n}`)}this.updateTransitionType(this.playerOptionsData,n,i),this.bindings.push(n.onPropertyChanged(a.gx.InstantTransitions,(()=>this.updateTransitionType(this.playerOptionsData,n,i))),s.onSave((()=>this.save()),{dataType:B.g.SETTINGS}),s.onRevert((()=>this.revert()),{dataType:B.g.SETTINGS}))}configureStorage(e){const{modelId:t,baseUrl:i,queue:s}=e,r=e.storageProvider||B.Xq.JSONSTORE,o=!("readonly"in e)||!!e.readonly;if(U.info(`Loading player options from ${r}`),r===B.Xq.MDS)return new MdsPlayerOptionsStore({readonly:o,baseUrl:i});const a=function(e){const{modelId:t,readonly:i}=e,n=e.baseUrl||"",s=e.queue,r={data:null},o=`${n}/api/v1/player/models/${t}`;if(i){const e=new d.gh({queue:s,path:o,deserialize:g,cachedData:r});return new u.nM({publishStores:[e]})}const a=new d.yh({queue:s,path:o,httpMethod:d.w$.PATCH,deserialize:g,serialize:f}),l=`${n}/api/v1/jsonstore/model/workshopSession/${t}`,c=new m.Z({queue:s,path:l,cachedData:{data:null},httpMethod:d.w$.PATCH,deserialize:p.S.sessionObjectExtract(m.j.Model,g),serialize:f},m.j.Model);return new u.nM({publishStores:[a],editStore:c,editStoreKey:u.aw.SETTINGS})}({modelId:t,baseUrl:i,readonly:o,queue:s});return new n.N(a,{dataType:B.g.SETTINGS,readonly:o,engine:this.engine})}configureMonitor(e){e.readonly||(this.monitor=new R.u(this.playerOptionsData,{aggregationType:N.E.NextFrame},this.engine),this.monitor.onChanged((()=>this.engine.commandBinder.issueCommand(new F.VQ({dataTypes:[B.g.SETTINGS]})))),this.store instanceof n.N&&this.store.addMonitor(this.monitor))}async save(){if(!this.store||!this.monitor)return void U.warn("Settings changes will NOT be saved");if(this.store instanceof n.N)return;const e=this.monitor.getDiffRecord(),t=e.options;return t&&(t&&void 0===t.measurements&&void 0!==t.measurements_saved&&(t.measurements=this.playerOptionsData.options.measurements),t&&void 0!==t.measurements&&void 0===t.measurements_saved&&(t.measurements_saved=this.playerOptionsData.options.measurements_saved),void 0!==(null==t?void 0:t.floor_select)&&(t.floor_select=this.playerOptionsData.options.floor_select),void 0!==(null==t?void 0:t.labels_dh)&&(t.labels_dh=this.playerOptionsData.options.labels_dh),void 0===t.presented_by&&void 0===t.contact_email&&void 0===t.contact_name&&void 0===t.contact_phone&&void 0===t.external_url&&void 0===t.model_name&&void 0===t.model_summary&&void 0===t.address||(t.presented_by=this.playerOptionsData.options.presented_by,t.contact_email=this.playerOptionsData.options.contact_email,t.contact_name=this.playerOptionsData.options.contact_name,t.contact_phone=this.playerOptionsData.options.contact_phone,t.external_url=this.playerOptionsData.options.external_url,t.model_name=this.playerOptionsData.options.model_name,t.model_summary=this.playerOptionsData.options.model_summary,t.address=this.playerOptionsData.options.address)),this.monitor.clearDiffRecord(),this.store.update(e)}async revert(){if(this.store instanceof n.N)return this.store.revert()}}},55402:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseStart});var n=i(2212),s=i(47724),r=i(736),o=i(75892),a=i(94329),l=i(93263),c=i(31278),h=i(35026),d=i(10757),u=i(33874),p=i(77719),m=i(56365),g=i(27088),f=i(17386);class FlyInCommand extends f.m{constructor(e){super(),this.payload={pose:e}}}var v=i(3248),y=i(19674),b=i(56656),S=i(64185),E=i(2725),w=i(31778),T=i(84842),_=i(44382);class ShowcaseStart extends s.Y{constructor(){super(...arguments),this.name="showcase-start",this.firstRenderPromise=new S.Q,this.flyInPromise=new S.Q,this.handleFlyIn=(e,t,i)=>(this.renderer.startRender(!1),this.doStandardStart(e,t,i,!0).catch((()=>this.renderer.startRender(!0))))}async init(e,t){const[i,n]=await Promise.all([t.market.waitForData(u.e),t.getModule(m.default)]);[this.sweepData,this.sweepModule,this.cameraModule,this.renderer]=await Promise.all([t.market.waitForData(o.Z),t.getModule(b.default),t.getModule(p.default),t.getModuleBySymbol(r.y.WEBGL_RENDERER)]);const s=i.tryGetProperty("quickstart",!1);s||await t.getModule(w.default);const a=n.getStartingPose();return(s?this.doQuickStart(a,t):this.doStandardStart(a,t,i,!1)).then((()=>this.flyInPromise.resolve())),this.bindings.push(t.commandBinder.addBinding(FlyInCommand,(async e=>{this.handleFlyIn(e.pose||n.getStartingPose(),t,i)}))),this.waitForFirstRender}get waitForFirstRender(){return this.firstRenderPromise.nativePromise()}get waitForFlyin(){return this.flyInPromise.nativePromise()}async doQuickStart(e,t){const i=this.sweepData.getStartSweep(e),n=i&&i.id,s=await t.getModule(l.default);return await s.switchToMode(e.mode,c.n.Instant,{sweepID:n,position:e.camera.position||i&&i.position,rotation:e.camera.rotation,zoom:-1!==e.camera.zoom?e.camera.zoom:void 0}),t.broadcast(new T.bN(!1)),e.mode!==a.Ey.Dollhouse&&e.mode!==a.Ey.Floorplan||e.floorVisibility&&await t.commandBinder.issueCommandWhenBound(new E.h9(e.floorVisibility.lastIndexOf(1),!0,0)),this.renderBeforeStarting(t)}async doStandardStart(e,t,i,s){var o;const[h]=await Promise.all([t.getModule(l.default)]),u=i.checkUrlParam("dh",0,1)||!i.tryGetProperty(v.gx.Dollhouse,!0),p=i.checkUrlParam("fp",0,1)||!i.tryGetProperty(v.gx.FloorPlan,!0);e&&(e.mode===a.Ey.Dollhouse&&u||e.mode===a.Ey.Floorplan&&p||e.mode===a.Ey.Panorama&&!e.pano)&&(e=null);const m=!e||e&&(e.mode===a.Ey.Dollhouse||e.mode===a.Ey.Floorplan),g=!e||e&&!this.is360Pano(e)&&e.mode===a.Ey.Panorama&&!u,f=e?e.mode:a.Ey.Panorama,b=this.sweepData.getStartSweep(e),S=b&&b.id,w=this.sweepData.getFirstSweep();let M=w&&w.rotation;if((null===(o=null==e?void 0:e.camera)||void 0===o?void 0:o.rotation)&&!(0,_.mB)(e.camera.rotation)&&(M=e.camera.rotation),M&&f!==a.Ey.Floorplan&&(M=(0,y.Z)(M)),g){await t.getModuleBySymbol(r.y.MODEL_MESH);const i=h.getFlyinEndPose({sweepID:S,position:e?e.camera.position:void 0,rotation:M}),o=h.getFlyinStartPose(i,s?new n.Vector3(0,0,0):void 0);t.broadcast(new T.bN(!0));const u=S?this.sweepModule.activateSweep({sweepId:S}):Promise.resolve();return await h.switchToMode(a.Ey.Dollhouse,c.n.Instant,o),await this.renderBeforeStarting(t),await(0,d.gw)(750),await this.cameraModule.moveTo({transitionType:c.n.Interpolate,pose:i}).nativePromise(),await u,t.broadcast(new T.bN(!1)),h.switchToMode(a.Ey.Panorama,c.n.Interpolate,{sweepID:S,rotation:M},l.DEFAULT_TRANSITION_TIME)}await h.switchToMode(f,c.n.Instant,{sweepID:S,position:e?e.camera.position:void 0,rotation:M,zoom:e&&-1!==e.camera.zoom?e.camera.zoom:void 0}),m&&e&&(e.floorVisibility?await t.commandBinder.issueCommandWhenBound(new E.h9(e.floorVisibility.lastIndexOf(1),!0,0)):await t.commandBinder.issueCommandWhenBound(new E.Vw(null))),await this.renderBeforeStarting(t)}is360Pano(e){if(e.pano.uuid){const t=this.sweepData.getSweep(e.pano.uuid);if(t)return t.alignmentType!==h.z9.ALIGNED}else{const e=this.sweepData.getFirstSweep();if(void 0!==e)return e.alignmentType!==h.z9.ALIGNED}return!1}async renderBeforeStarting(e){await this.renderer.renderOnce(),await e.getModule(g.default),this.renderer.startRender(!0),this.firstRenderPromise.resolve()}}},36704:(e,t,i)=>{"use strict";i.d(t,{s:()=>PreloadWebVr,w:()=>PresentWebVr});var n=i(17386);class PreloadWebVr extends n.m{constructor(){super(...arguments),this.id="WEBVR_PRELOAD"}}class PresentWebVr extends n.m{constructor(){super(...arguments),this.id="WEBVR_PRESENT"}}},88454:(e,t,i)=>{"use strict";i.d(t,{KW:()=>ToggleWorkshopBarCommand});var n=i(17386);class AppSwitchCommand extends n.m{constructor(e){super(),this.payload={application:e}}}AppSwitchCommand.id="APP_SWITCH";class ToggleWorkshopBarCommand extends n.m{constructor(e){super(),this.payload={visible:e}}}ToggleWorkshopBarCommand.id="TOGGLE_WORKSHOP_BAR";class EditFromParentCommand extends n.m{}EditFromParentCommand.id="EDIT_FROM_PARENT"},36371:(e,t,i)=>{"use strict";i.d(t,{M:()=>Matrix});var n=i(2212);class ROMatrix{constructor(e){this.elements=[],e?(e=>void 0!==e.elements)(e)?this.elements=e.elements.slice():n.Matrix4.prototype.set.apply(this,e):n.Matrix4.prototype.set.apply(this,ROMatrix.identity)}equals(e){return n.Matrix4.prototype.equals.call(this,e)}clone(){return new ROMatrix(this)}}ROMatrix.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];class Matrix extends ROMatrix{constructor(e){e instanceof Array||e?super(e):super(),this.threeMatrix=new n.Matrix4}set(e,t,i,s,r,o,a,l,c,h,d,u,p,m,g,f){return n.Matrix4.prototype.set.call(this,e,t,i,s,r,o,a,l,c,h,d,u,p,m,g,f),this}makeScale(e,t,i){return n.Matrix4.prototype.makeScale.call(this,e,t,i),this}copy(e){for(let t=0;t<this.elements.length;t++)this.elements[t]=e.elements[t];return this}clone(){return(new Matrix).copy(this)}transpose(){return n.Matrix4.prototype.transpose.call(this)}lookAt(e,t,i){return n.Matrix4.prototype.lookAt.call(this,e,t,i),this}setPosition(e){return n.Matrix4.prototype.setPosition.call(this,e.x,e.y,e.z),this}extractRotation(e){return n.Matrix4.prototype.extractRotation.call(this,e),this}makePerspective(e,t,i,s,r,o){return n.Matrix4.prototype.makePerspective.call(this,e,t,i,s,r,o),this}makePerspectiveFov(e,t,i=.1,s=1e3){const r=i*Math.tan(e*(Math.PI/180)/2),o=-r,a=r*t,l=-a;return n.Matrix4.prototype.makePerspective.call(this,l,a,r,o,i,s),this}makeOrthographic(e,t,i,s,r,o){return n.Matrix4.prototype.makeOrthographic.call(this,e,t,i,s,r,o),this}identity(){return this.set.apply(this,ROMatrix.identity)}makeRotationFromQuaternion(e){return n.Matrix4.prototype.makeRotationFromQuaternion.call(this,e),this}makeRotationFromEuler(e){return n.Matrix4.prototype.makeRotationFromEuler.call(this,e),this}getInverse(e){return n.Matrix4.prototype.copy.call(this,e),n.Matrix4.prototype.invert.call(this),this}premultiply(e){return n.Matrix4.prototype.premultiply.call(this,e),this}multiplyMatrices(e,t){return n.Matrix4.prototype.multiplyMatrices.call(this,e,t),this}scale(e){return n.Matrix4.prototype.scale.call(this,e),this}compose(e,t,i){return n.Matrix4.prototype.compose.call(this,e,t,i),this}asThreeMatrix4(){return this.threeMatrix.set(this.elements[0],this.elements[4],this.elements[8],this.elements[12],this.elements[1],this.elements[5],this.elements[9],this.elements[13],this.elements[2],this.elements[6],this.elements[10],this.elements[14],this.elements[3],this.elements[7],this.elements[11],this.elements[15])}}},68524:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n=Object.freeze({signedUrlDefaultExpireTime:24e4,signedUrlCheckInterval:1e4,signedUrlRefreshBuffer:15e3,visionTilingStartDate:new Date("8/26/2016"),visionTilingStartVersion:"1.1.407.13667",epsilon:1e-5,skyboxMeshGroup:"_group_skybox_",skysphereMeshGroup:"_group_skysphere_"})},17386:(e,t,i)=>{"use strict";i.d(t,{m:()=>Command});class Command{}},32770:(e,t,i)=>{"use strict";i.d(t,{V:()=>Data});var n=i(23573);class Data extends n.T{}},66097:(e,t,i)=>{"use strict";i.d(t,{N:()=>DataSyncStore});var n=i(48602),s=i(49398),r=i(46963);class DataSyncStore{constructor(e,t){this.sync=e,this.config=t}async read(){const{engine:e,dataType:t}=this.config,i=await this.sync.load();return this.sync.isDirty()&&e.market.waitForData(n.Q).then((e=>{e.setUnpublished(t)})),i}addMonitor(e){if(this.config.readonly)throw new s.pp("Datasync is in read-only");this.sync.addMonitor(e)}async revert(){return this.sync.reset()}async create(){throw new r.n}async update(){throw new r.n}async delete(){throw new r.n}}},80121:(e,t,i)=>{"use strict";i.d(t,{aw:()=>h,b3:()=>DataSync,nM:()=>ObjectSync,iY:()=>CollectionSync});var n=i(85861),s=i(71194),r=i(88512),o=i(23573),a=i(96781);const l=new r.Z("datasync");var c,h,d;!function(e){e[e.NONE=0]="NONE",e[e.LEGACY_SYNC=1]="LEGACY_SYNC",e[e.IGNORE_LEGACY_SAVE=2]="IGNORE_LEGACY_SAVE"}(c||(c={})),function(e){e.FLOOR_NAMES="FLOOR_NAMES",e.HIGHLIGHTS="HIGHLIGHTS",e.LABELS="LABELS",e.MATTERTAGS="MATTERTAGS",e.MEASUREMENTS="MEASUREMENTS",e.SETTINGS="SETTINGS",e.START_LOCATION="START_LOCATION",e.SWEEPS="SWEEPS"}(h||(h={}));class GlobalState extends o.T{constructor(){super(...arguments),this.dirty=!1,this.dirtyWS2=!1,this.sessionsSaving=0}}!function(e){e[e.IDLE=0]="IDLE",e[e.LOADING=1]="LOADING",e[e.CLEAN=2]="CLEAN",e[e.DIRTY=3]="DIRTY"}(d||(d={}));class DataSync{constructor(e,t){this.state=d.IDLE,this.diff={},this.deletedKeys=[],this.config=e,this.collectionData=t,this.config.extras||(this.config.extras=0),this.config.extras&c.LEGACY_SYNC||DataSync.configuredSyncs.push(this)}static setGlobalStore(e){if(this.sharedStore)throw Error("Attempting to overwrite sync's internal store");this.sharedStore=e,this.sharedStore.read().then((e=>{this.sharedState.lastPublished=e.lastPublished,this.sharedState.commit()}))}static setMessageBus(e){this.msgBus=e}static setAfterPublish(e){DataSync.afterPublishCallback=e}static async publishAll(){const e=this.configuredSyncs.map((e=>e.publish()));return await Promise.all(e),l.debug("sharedState.dirty = false"),this.sharedState.dirty=!1,this.sharedState.lastPublished=new Date,this.sharedState.commit(),this.sharedStore&&this.sharedStore.update(this.sharedState),this.afterPublishCallback&&await this.afterPublishCallback(),this.sharedState.lastPublished}static async resetEditStore(e){const t=this.configuredSyncs.find((t=>t.config.editStoreKey===e));t&&await t.reset()}static getStateOfEditStores(){const e=[];return this.configuredSyncs.forEach((t=>{void 0!==t.config.editStoreKey&&e.push({key:t.config.editStoreKey,dirty:t.isDirty()})})),e}static get globalSession(){return this.sharedState}isDirty(){return this.state===d.DIRTY}async load(){if(this.state!==d.IDLE)throw Error("Data already loaded");this.setState(d.LOADING);const e=this.config.publishStores&&this.config.publishStores.length>0?this.config.publishStores.map((e=>this.loadStore(e))):[];this.config.editStore&&e.push(this.loadStore(this.config.editStore)),this.config.legacyEditStore&&e.push(this.loadStore(this.config.legacyEditStore,!0));const t=await Promise.all(e),i=(e,t,i)=>t&&t.modified&&i.modified&&t.modified>i.modified?t:(e&&this.setState(d.DIRTY),i),s=(e,t,i,n,s)=>{if(!t)return e&&this.setState(d.DIRTY),i;if(n&&s&&s<n)return t;for(const n in i)i.hasOwnProperty(n)&&(e&&this.setState(d.DIRTY),t[n]=i[n]);return t};if(this.data=t[0].data||{},this.setState(d.CLEAN),this.publishedData=(0,n.p$)(this.data),this.collectionData)for(let e=1;e<t.length;e++){const n=e>=this.config.publishStores.length,r=t[e];if(r.data){for(const e in r.data)r.data.hasOwnProperty(e)&&(this.data[e]?this.config.partialData?this.data[e]=s(n,this.data[e],r.data[e]):this.data[e]=i(n,this.data[e],r.data[e]):(n&&this.setState(d.DIRTY),this.data[e]=r.data[e]));if(r.isLegacy)for(const e in this.data)r.data[e]||(n&&this.setState(d.DIRTY),this.data[e]=null,this.diff[e]=null);r.isLegacy||(this.diff=r.data)}}else for(let e=1;e<t.length;e++){const n=e>=this.config.publishStores.length,r=t[e].data;if(!r)continue;const o=r;if(this.config.partialData){const e=this.data.modified instanceof Date?this.data.modified:void 0,t=o.modified instanceof Date?o.modified:void 0;this.data=s(n,this.data,o,e,t)}else this.data=i(n,this.data,o)}for(const e in this.data)this.data[e]||(this.deletedKeys.push(e),delete this.data[e]);return this.data}loadStore(e,t=!1){return e.read().then((e=>({data:e,isLegacy:t})))}get monitorNeeded(){return void 0!==this.config.editStore||void 0!==this.config.legacyEditStore||this.config.publishStores.length>0}addMonitor(e){if(!this.monitorNeeded)throw Error("Adding a monitor unnecessarily!");this._monitor=e;this._monitor.onChanged((async()=>{if(this.onDataChanged(),this.config.safeKeys){let e=!1;if(this.collectionData)for(const t in this.diff)for(const i in this.diff[t])-1!==this.config.safeKeys.indexOf(i)&&(e=!0);else for(const t in this.diff)-1!==this.config.safeKeys.indexOf(t)&&(e=!0);if(!e)return}this.setState(d.DIRTY),await this.saveSession()}))}get monitor(){return this._monitor}setState(e){this.config.extras&c.LEGACY_SYNC?e!==d.DIRTY||DataSync.sharedState.dirtyWS2||(l.debug("sharedState.dirtyWS2 = true"),DataSync.sharedState.dirtyWS2=!0,DataSync.sharedState.commit()):(this.state=e,this.state!==d.DIRTY||DataSync.sharedState.dirty||(l.debug("sharedState.dirty = true"),DataSync.sharedState.dirty=!0,DataSync.sharedState.commit()))}async saveSession(){l.info("Saving session..."),DataSync.sharedState.sessionsSaving++,DataSync.sharedState.commit();try{this.config.editStore&&await this.config.editStore.update(this.data,this.diff),!this.config.legacyEditStore||this.config.extras&c.IGNORE_LEGACY_SAVE||await this.config.legacyEditStore.update(this.data,this.diff)}catch(e){l.error(e),DataSync.msgBus.broadcast(new a.dz(e))}DataSync.sharedState.sessionsSaving--,DataSync.sharedState.commit()}async publish(){if(this.state===d.DIRTY){for(const e of this.config.publishStores){if(!this.isWritable(e))throw Error("Trying to publish with readonly store");try{await e.update(this.data,this.diff),this.publishedData=(0,n.p$)(this.data)}catch(t){throw l.error("Failed to publish data: ",e.config,this.data,this.diff),t}}try{this.config.editStore&&await this.config.editStore.delete(),!this.config.legacyEditStore||this.config.extras&c.IGNORE_LEGACY_SAVE||await this.config.legacyEditStore.delete(),this.setState(d.CLEAN)}catch(e){throw Error("Failed to clear session data after publishing: "+e)}}}async reset(){switch(this.state){case d.CLEAN:return this.data;case d.IDLE:throw Error("Attempting to reset a Sync that was not loaded.");case d.LOADING:throw Error("Attempting to reset a Sync that is still loading.");case d.DIRTY:l.info("Clearing session..."),DataSync.sharedState.sessionsSaving++,DataSync.sharedState.commit();try{this.config.editStore&&await this.config.editStore.delete(),!this.config.legacyEditStore||this.config.extras&c.IGNORE_LEGACY_SAVE||await this.config.legacyEditStore.delete(),this.data=(0,n.p$)(this.publishedData),this.setState(d.CLEAN)}catch(e){l.error(e),DataSync.msgBus.broadcast(new a.dz(e))}return DataSync.sharedState.sessionsSaving--,DataSync.sharedState.commit(),this.data}}isWritable(e){return void 0!==e.update}}DataSync.sharedState=new GlobalState,DataSync.configuredSyncs=[];class ObjectSync extends DataSync{constructor(e){super(e,!1)}onDataChanged(){const e=this.monitor.getDiffRecord();this.diff=e,this.diff.modified=new Date}}class CollectionSync extends DataSync{constructor(e){super(e,!0)}onDataChanged(){const e=this.monitor.getDiffRecord();for(const t of e)switch(t.action){case s.KI.added:this.diff[t.index]=t.diff;break;case s.KI.updated:this.diff[t.index]||(this.diff[t.index]={}),(0,n.TS)(this.diff[t.index],t.diff);break;case s.KI.removed:delete this.diff[t.index],this.data[t.index]=null}this.monitor.clearDiffRecord()}}},76701:(e,t,i)=>{"use strict";var n,s;i.d(t,{p3:()=>n,Jj:()=>NullGeneratorResult,M8:()=>WaitForPromiseGeneratorResult,ZP:()=>EngineGenerators}),function(e){e[e.None=0]="None",e[e.Duration=1]="Duration",e[e.Phase=2]="Phase",e[e.Promise=3]="Promise"}(n||(n={}));class EngineGeneratorResult{constructor(e){this.type=e}}class NullGeneratorResult extends EngineGeneratorResult{constructor(){super(n.None)}}class WaitDurationGeneratorResult extends EngineGeneratorResult{constructor(e){super(n.Duration),this.duration=e,this.startTime=Date.now()}}class WaitForPhaseGeneratorResult extends EngineGeneratorResult{constructor(e){super(n.Phase),this.phase=e}}!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(s||(s={}));class WaitForPromiseGeneratorResult extends EngineGeneratorResult{constructor(e){super(n.Promise),this.promise=e,this.promiseState=s.Pending,e.then((()=>{this.promiseState=s.Fulfilled})).catch((()=>{this.promiseState=s.Rejected}))}}class EngineGenerator{constructor(e,t=!0){this.generator=e,t&&this.start()}start(){this.started||(this.iterator=this.generator()),this.started=!0}iterate(){const e=this.iterator.next();this.currentResult=e.value,e.done&&(this.started=!1)}}class EngineGenerators{constructor(){this.generators=[]}startGenerator(e){let t=this.generators.length;for(let i=0;i<this.generators.length;i++){this.generators[i].generator===e&&(t=i)}this.generators[t]=new EngineGenerator(e)}stopGenerator(e){for(const t of this.generators)t.generator===e&&(t.started=!1)}processGenerators(e,t){for(const i of this.generators)if(i.started)switch(e){case n.None:(!i.currentResult||i.currentResult instanceof NullGeneratorResult)&&i.iterate();break;case n.Phase:if(i.currentResult instanceof WaitForPhaseGeneratorResult){const e=i.currentResult;void 0!==t&&e.phase===t&&i.iterate()}break;case n.Promise:if(i.currentResult instanceof WaitForPromiseGeneratorResult){i.currentResult.promiseState===s.Fulfilled&&i.iterate()}break;case n.Duration:if(i.currentResult instanceof WaitDurationGeneratorResult){const e=i.currentResult;Date.now()-e.startTime>=e.duration&&i.iterate()}}}}},91466:(e,t,i)=>{"use strict";i.d(t,{v:()=>Message});class Message{constructor(){this.msgId=-1}setID(e){if(-1!==this.msgId)throw Error("Message.msgId can only be set once.");this.msgId=e}}},63432:(e,t,i)=>{"use strict";i.d(t,{Q:()=>a,Y:()=>MessageBus});var n=i(90933),s=i(88512),r=i(44283);const o=new s.Z("message-bus");var a;!function(e){e[e.PERMANENT=0]="PERMANENT",e[e.ONCE=1]="ONCE"}(a||(a={}));class MessageBus{constructor(){this.typeLookup=new n.cj,this.callbacks={},this.messageQueue=[],this.messageCount=0}subscribe(e,t,i=a.PERMANENT){return(0,r.k1)((()=>this._subscribe(e,t,i)),(()=>this.unsubscribe(e,t)),!0,(0,n.HS)(e))}_subscribe(e,t,i=a.PERMANENT){const n=this.typeLookup.getKeyByType(e,!0);this.callbacks[n]||(this.callbacks[n]=[]),this.callbacks[n].push({type:i,callback:t})}unsubscribe(e,t){const i=this.typeLookup.getKeyByType(e);i?this.unsubscribeByIndex(i,t):o.debug(`Message callback not bound for Type: ${e.name}`)}unsubscribeByIndex(e,t){const i=this.callbacks[e].findIndex((e=>e.callback===t));-1!==i?this.callbacks[e].splice(i,1):o.debug(`Message callback not bound for TypeIndex: ${e}`)}broadcast(e){if(e.setID(this.messageCount++),this.messageQueue.push(e),1===this.messageQueue.length){for(const e of this.messageQueue){const t=this.typeLookup.getKeyByInstance(e);if(!t)continue;const i=this.callbacks[t].slice();for(const n of i)n.callback(e),n.type===a.ONCE&&this.unsubscribeByIndex(t,n.callback)}this.messageQueue=[]}}}},47724:(e,t,i)=>{"use strict";i.d(t,{Y:()=>Module});var n=i(88512);class Module{constructor(){this.bindings=[],this.log=new n.Z("module")}init(e,t){return Promise.resolve()}onUpdate(e){}dispose(e){for(const e of this.bindings)e.cancel();this.bindings=[]}}},84561:(e,t,i)=>{"use strict";i.d(t,{o:()=>RenderLayers});class RenderLayer{constructor(e){this._mask=e}get mask(){return this._mask}addLayers(e){this._mask|=e.mask}removeLayers(e){return this._mask&=~e.mask}clone(){return new RenderLayer(this._mask)}}class RenderLayers{constructor(){this.layerRegistry=[],this.unusedLayers=[];for(let e=1;e<32;e++)this.unusedLayers.push(e)}static get ALL(){return new RenderLayer(-1)}static get NONE(){return new RenderLayer(0)}static get DEFAULT(){return new RenderLayer(1)}claimLayer(e){const t=this.getLayer(e);if(t.mask)return t;if(0===this.unusedLayers.length)throw Error("All render layers have already been claimed");const i=this.unusedLayers[0];return this.layerRegistry[i]=e,this.unusedLayers.shift(),new RenderLayer(1<<i)}getLayer(e){const t=this.layerRegistry.indexOf(e);return-1!==t?new RenderLayer(1<<t):RenderLayers.NONE}disposeLayer(e){const t=this.layerRegistry.indexOf(e);-1!==t&&this.unusedLayers.push(t)}}},90933:(e,t,i)=>{"use strict";i.d(t,{z$:()=>n,oL:()=>s,HS:()=>r,cj:()=>TypeLookup});const n=e=>e.prototype.constructor.name,s=e=>e.constructor,r=e=>{if("string"==typeof e)return e;if(e&&e.name)return e.name;const t=e.toString();return t.substring(0,t.indexOf("\n")).split(" ")[1]};class TypeLookup{constructor(){this.typeLookupMap={}}getKey(e){return"string"==typeof e?e:e.name}addType(e){if(!e)throw Error("Cannot index undefined type");const t=this.getKey(e);if(this.typeLookupMap[t])throw Error(`Type ${t} already registered`);return this.typeLookupMap[t]=e,t}getKeyByType(e,t){if(!e)throw Error("Cannot index undefined type");const i=this.getKey(e);let n=this.typeLookupMap[i];return!n&&t&&(n=e,this.addType(n)),n?i:""}getKeyByInstance(e,t){if(!e)throw Error("Cannot index undefined data");const i=e.constructor.name;let n=this.typeLookupMap[i];return!n&&t&&(n=e.constructor,this.addType(n)),n?i:""}getTypeByKey(e){const t=this.typeLookupMap[e];if(!t)throw Error("Key not found");if("string"==typeof t)throw Error("non type keyed result not supported");return t}getKnownTypes(){return Object.values(this.typeLookupMap)}}},84303:(e,t,i)=>{"use strict";var n;i.d(t,{A:()=>n}),function(e){e[e.Begin=0]="Begin",e[e.Logic=1]="Logic",e[e.Render=2]="Render",e[e.End=3]="End"}(n||(n={}))},51198:(e,t,i)=>{"use strict";i.d(t,{k:()=>PlayerMovedMessage});var n=i(91466);class PlayerMovedMessage extends n.v{constructor(e,t){super(),this.x=e,this.y=t}}},67790:(e,t,i)=>{"use strict";i.d(t,{a:()=>PlayerResizedMessage});var n=i(91466);class PlayerResizedMessage extends n.v{constructor(e,t){super(),this.width=e,this.height=t}}},21479:(e,t,i)=>{"use strict";i.d(t,{nh:()=>n,Mx:()=>s,pu:()=>ApplicationData,RU:()=>a});var n,s,r=i(32770),o=i(11321);!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.WAITING=1]="WAITING",e[e.LOADING=2]="LOADING",e[e.STARTING=3]="STARTING",e[e.PLAYING=4]="PLAYING",e[e.ERROR=5]="ERROR"}(n||(n={})),function(e){e.UNKNOWN="unknown",e.WEBVR="webvr",e.SHOWCASE="showcase",e.WORKSHOP="workshop"}(s||(s={}));class ApplicationData extends r.V{constructor(e,t=s.UNKNOWN){super(),this.name="app",this.phase=e,this.application=t,this.phaseTimes=(0,o.$)({[n.UNINITIALIZED]:0,[n.WAITING]:0,[n.LOADING]:0,[n.STARTING]:0,[n.PLAYING]:0,[n.ERROR]:0}),this.error=null}getName(){return this.application.toString()}getVersion(){return"3.1.51.7-84-g0dcbe0591"}}const a=()=>new ApplicationData(n.UNINITIALIZED)},36822:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>AppPhaseModule});var n=i(47724),s=i(21479),r=i(8150),o=i(88512),a=i(54073),l=i(97325);const c=new o.Z("app-phase");class AppPhaseModule extends n.Y{constructor(){super(...arguments),this.name="app-phase"}async init(e,t){this.market=t.market,this.broadcast=t.broadcast.bind(t),this.tasks=e.tasks,this.appState=(0,s.RU)(),this.appState.phase=s.nh.UNINITIALIZED,this.appState.phaseTimes[s.nh.UNINITIALIZED]=Date.now(),this.appState.application=s.Mx.SHOWCASE,this.market.register(this,s.pu,this.appState),this.watchTasks(this.appState.phase),this.watchErrors(),this.updateAppHeaders(),this.bindings.push(this.appState.onPropertyChanged("application",(()=>this.updateAppHeaders())))}async watchTasks(e){if(e>=s.nh.PLAYING)return;const t=e+1;try{await Promise.all(this.tasks[t])}catch(e){this.error(e)}t===s.nh.PLAYING&&this.broadcast(new r.pB(this.appState.application)),this.appState.phase!==s.nh.ERROR&&e!==s.nh.ERROR&&(this.updateCurrentPhase(t),this.watchTasks(t))}async watchErrors(){try{await Promise.all(this.tasks[s.nh.ERROR])}catch(e){this.error(e)}}updateCurrentPhase(e){this.appState.phase=e,this.appState.phaseTimes[e]=Date.now(),c.info(`${JSON.stringify(this.appState)}`),this.appState.commit(),this.broadcast(new r.LZ(e))}error(e){this.appState.error=e,this.updateCurrentPhase(s.nh.ERROR)}updateActiveApp(e){this.appState.application=e,this.appState.commit(),this.broadcast(new r.bS(e))}getData(){return this.appState}updateAppHeaders(){(0,a.l)(this.appState.getName()),(0,l.t)(this.appState.getVersion())}}},8150:(e,t,i)=>{"use strict";i.d(t,{LZ:()=>AppPhaseChangeMessage,bS:()=>ApplicationChangeMessage,pB:()=>ApplicationLoadedMessage});var n=i(91466);class AppPhaseChangeMessage extends n.v{constructor(e){super(),this.phase=e}}class ApplicationChangeMessage extends n.v{constructor(e){super(),this.application=e}}class ApplicationLoadedMessage extends n.v{constructor(e){super(),this.application=e}}},40918:(e,t,i)=>{"use strict";i.d(t,{l:()=>SdkObservable,W:()=>SdkObserver});class SdkObservable{constructor(e,t,i){this.dependencies=e,this.subscriptionFactory=t,this.observers=new Set,this.currentData=i.create(),this.freshDataCache=i.create()}static async create(e,t,i){const n=await e.getDependencies();return new SdkObservable(n,t,i)}getData(){return this.currentData.data}subscribe(e){return this.addObserver(e),new class ObserverSubscription{constructor(e){this.sdkObservable=e,this.renew()}renew(){this.sdkObservable.addObserver(e)}cancel(){this.sdkObservable.removeObserver(e)}}(this)}addObserver(e){if(!this.observers.has(e)){class SdkObservableFacade{constructor(e){this.observable=e}onChanged(){this.observable.onChanged()}}this.observers.add(e),1===this.observers.size&&(this.currentData.update(...this.dependencies),this.changeSubscription=this.subscriptionFactory.create(new SdkObservableFacade(this),...this.dependencies)),e.dirty=!0}}removeObserver(e){0!==this.observers.size&&(this.observers.delete(e),0===this.observers.size&&this.changeSubscription.cancel())}onChanged(){if(this.freshDataCache.update(...this.dependencies),!this.currentData.equals(this.freshDataCache)){this.currentData.copy(this.freshDataCache);for(const e of this.observers)e.dirty=!0}}}class SdkObserver{constructor(){this.dirty=!1}}},13377:(e,t,i)=>{"use strict";i.d(t,{I:()=>SdkData});var n=i(32770);class SdkData extends n.V{constructor(){super(...arguments),this.name="sdk",this.applicationKey=null}}},60003:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Sdk:()=>Sdk,default:()=>R});var n,s,r,o,a,l,c,h,d,u,p,m,g,f=i(47724),v=i(17187);!function(e){e.POSTMESSAGE="postmessage",e.DIRECT="direct"}(n||(n={}));!function(e){let t,i,n;!function(e){e.PHASE_CHANGE="application.phasechange"}(t=e.Event||(e.Event={})),function(e){e.UNINITIALIZED="appphase.uninitialized",e.WAITING="appphase.waiting",e.LOADING="appphase.loading",e.STARTING="appphase.starting",e.PLAYING="appphase.playing",e.ERROR="appphase.error"}(i=e.Phase||(e.Phase={})),function(e){e.SHOWCASE="application.showcase"}(n=e.Application||(e.Application={}))}(s||(s={})),function(e){let t,i;!function(e){e.MOVE="camera.move"}(t=e.Event||(e.Event={})),function(e){e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.BACK="BACK",e.UP="UP",e.DOWN="DOWN"}(i=e.Direction||(e.Direction={}))}(r||(r={})),function(e){let t;!function(e){e.CHANGE_START="floors.changestart",e.CHANGE_END="floors.changeend"}(t=e.Event||(e.Event={}))}(o||(o={})),function(e){let t;!function(e){e.POSITION_UPDATED="label.positionupdated"}(t=e.Event||(e.Event={}))}(a||(a={})),function(e){let t,i,n,s,r;!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(t=e.Transition||(e.Transition={})),function(e){e.NAVIGATION="tag.link.nav",e.MODEL="tag.link.model",e.EXT_LINK="tag.link.ext"}(i=e.LinkType||(e.LinkType={})),function(e){e.NONE="tag.chunk.none",e.TEXT="tag.chunk.text",e.LINK="tag.chunk.link"}(n=e.DescriptionChunkType||(e.DescriptionChunkType={})),function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(s=e.Event||(e.Event={})),function(e){e.NONE="mattertag.media.none",e.PHOTO="mattertag.media.photo",e.VIDEO="mattertag.media.video",e.RICH="mattertag.media.rich"}(r=e.MediaType||(e.MediaType={}))}(l||(l={})),function(e){let t,i,n;!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(t=e.Mode||(e.Mode={})),function(e){e.CHANGE_START="viewmode.changestart",e.CHANGE_END="viewmode.changeend"}(i=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(n=e.TransitionType||(e.TransitionType={}))}(c||(c={})),function(e){let t;!function(e){e.MODEL_LOADED="model.loaded"}(t=e.Event||(e.Event={}))}(h||(h={})),function(e){let t;!function(e){e.NONE="intersectedobject.none",e.MODEL="intersectedobject.model",e.TAG="intersectedobject.tag",e.SWEEP="intersectedobject.sweep",e.UNKNOWN="intersectedobject.unknown"}(t=e.Colliders||(e.Colliders={}))}(d||(d={})),function(e){let t,i;!function(e){e.CLICK="INTERACTION.CLICK",e.HOVER="INTERACTION.HOVER",e.DRAG="INTERACTION.DRAG",e.DRAG_BEGIN="INTERACTION.DRAG_BEGIN",e.DRAG_END="INTERACTION.DRAG_END",e.POINTER_MOVE="INTERACTION.POINTER_MOVE",e.POINTER_BUTTON="INTERACTION.POINTER_BUTTON",e.SCROLL="INTERACTION.SCROLL",e.KEY="INTERACTION.KEY",e.LONG_PRESS_START="INTERACTION.LONG_PRESS_START",e.LONG_PRESS_END="INTERACTION.LONG_PRESS_END",e.MULTI_SWIPE="INTERACTION.MULTI_SWIPE",e.MULTI_SWIPE_END="INTERACTION.MULTI_SWIPE_END",e.PINCH="INTERACTION.PINCH",e.PINCH_END="INTERACTION.PINCH_END",e.ROTATE="INTERACTION.ROTATE",e.ROTATE_END="INTERACTION.ROTATE_END"}(t=e.InteractionType||(e.InteractionType={})),function(e){e.INPUT="input",e.OUTPUT="output",e.EVENT="event",e.EMIT="emit"}(i=e.PathType||(e.PathType={}))}(u||(u={})),function(e){let t,i;!function(e){e.CAMERA="sensor.sensortype.camera"}(t=e.SensorType||(e.SensorType={})),function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(i=e.SourceType||(e.SourceType={}))}(p||(p={})),function(e){let t,i,n,s;!function(e){e.ENTER="sweep.enter",e.EXIT="sweep.exit"}(t=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(i=e.Transition||(e.Transition={})),function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(n=e.Alignment||(e.Alignment={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(s=e.Placement||(e.Placement={}))}(m||(m={})),function(e){let t;!function(e){e.STARTED="tour.started",e.STOPPED="tour.stopped",e.ENDED="tour.ended",e.STEPPED="tour.stepped"}(t=e.Event||(e.Event={}))}(g||(g={}));Math.PI;c.Mode.DOLLHOUSE,new Float32Array(16);var y,b,S;!function(e){e.EVENT="postmessage.event",e.RESPONSE="postmessage.response",e.OBSERVATION="postmessage.observation",e.COLLECTION_UPDATE="collection.updated"}(y||(y={})),function(e){e.ITEM_ADDED="collection.item.added",e.ITEM_REMOVED="collection.item.removed",e.ITEM_UPDATED="collection.item.updated",e.COLL_UPDATED="collection.coll.updated"}(b||(b={}));!function(e){e.DISCONNECT="sdk.client.disconnect",e.ACTION="postmessage.action",e.EVENT_SUB="postmessage.subscribe",e.EVENT_UNSUB="postmessage.unsubscribe",e.OBSERVABLE_SUB="postmessage.observe",e.OBSERVABLE_UNSUB="postmessage.unobserve",e.COLLECTION_SUB="collection.sub",e.COLLECTION_UNSUB="collection.unsub"}(S||(S={}));var E;i(24467),i(23549);!function(e){e.map=new Map}(E||(E={}));var w;i(40388);!function(e){e.CONNECT="postmessage.connect",e.DISCONNECT="postmessage.disconnect",e.HANDSHAKE="postmessage.handshake",e.ACCEPT="postmessage.accept",e.REJECT="postmessage.reject",e.ACTION="postmessage.action",e.RESPONSE="postmessage.response",e.EVENT="postmessage.event",e.EVENT_SUB="postmessage.subscribe",e.EVENT_UNSUB="postmessage.unsubscribe",e.OBSERVABLE_SUB="postmessage.observe",e.OBSERVABLE_UNSUB="postmessage.unobserve",e.OBSERVABLE_UPDATE="postmessage.observation"}(w||(w={}));class PostMessage extends v.EventEmitter{constructor(e,t,i){super(),this.id=t,this.clientId=i,this.clientWindow=null,this.clientOrigin=null,this.hostWindow=e,this.messageHandler=e=>{this.onPostmessageReceived(e)},this.bindEvents()}send(e){this.clientWindow&&this.clientOrigin&&this.clientWindow.postMessage(Object.assign(Object.assign({payload:e},e),{fromId:this.id}),this.clientOrigin)}setTarget(e,t){this.clientWindow=e,this.clientOrigin=t}clearTarget(){this.clientWindow=null,this.clientOrigin=null}bindEvents(){this.hostWindow.addEventListener("message",this.messageHandler)}dispose(){this.hostWindow.removeEventListener("message",this.messageHandler)}onPostmessageReceived(e){const t=e.origin,i=e.source;if(i){switch(e.data.type){case w.CONNECT:break;case w.DISCONNECT:case w.ACTION:case w.EVENT_SUB:case w.EVENT_UNSUB:case w.OBSERVABLE_SUB:case w.OBSERVABLE_UNSUB:case S.COLLECTION_SUB:case S.COLLECTION_UNSUB:if(!this.validateMessageOrigin(e.data.fromId,t,i))return;break;default:return}if(e.data.payload)this.emit(e.data.type,Object.assign(Object.assign({},e.data.payload),{type:e.data.type,fromId:e.data.fromId,source:i,origin:t,method:n.POSTMESSAGE}));else{const s=Object.assign(Object.assign({},e.data),{source:i,origin:t,timestamp:Date.now(),method:n.POSTMESSAGE});this.emit(e.data.type,s)}}}validateMessageOrigin(e,t,i){return-1===this.clientId&&"*"===this.clientOrigin||this.clientId===e&&this.clientWindow===i&&this.clientOrigin===t}}var T;!function(e){e.CONNECTION="sdk.connection",e.DISCONNECT="sdk.disconnect",e.MESSAGED="sdk.messaged",e.SUBSCRIBED="sdk.subscribed",e.UNSUBSCRIBED="sdk.unsubscribed",e.OBSERVABLE_SUB="sdk.obs.subscribe",e.OBSERVABLE_UNSUB="sdk.obs.unsubscribe",e.COLLECTION_SUB="sdk.coll.subscribe",e.COLLECTION_UNSUB="sdk.coll.unsubscribe"}(T||(T={}));var _=i(88512);const M=new _.Z("SdkHost");class PostMessageHost extends v.EventEmitter{constructor(e,t){super(),this.hostWindow=e,this.id=t,this.clients={},this.connectionHandler=new PostMessage(e,this.id,-1),this.bindEvents(e)}broadcastEventToClient(e,t,i){const n=this.clients[e];if(!n)return;const s={type:w.EVENT,eventType:t,eventData:i,toId:e};n.messenger.send(s)}broadcastObservationToClient(e,t,i){const n=this.clients[e];if(!n)return;const s={type:w.OBSERVABLE_UPDATE,observableKey:t,observableData:i,toId:e};n.messenger.send(s)}broadcastCollectionItemAdded(e,t,i,n){const s=this.clients[e];if(!s)return;const r={type:y.COLLECTION_UPDATE,operation:b.ITEM_ADDED,collectionKey:t,collectionIndex:i,item:n,toId:e};s.messenger.send(r)}broadcastCollectionItemRemoved(e,t,i){const n=this.clients[e];if(!n)return;const s={type:y.COLLECTION_UPDATE,operation:b.ITEM_REMOVED,collectionKey:t,collectionIndex:i,toId:e};n.messenger.send(s)}broadcastCollectionItemUpdated(e,t,i,n){const s=this.clients[e];if(!s)return;const r={type:y.COLLECTION_UPDATE,operation:b.ITEM_UPDATED,collectionKey:t,collectionIndex:i,item:n,toId:e};s.messenger.send(r)}broadcastCollectionUpdated(e,t){const i=this.clients[e];if(!i)return;const n={type:y.COLLECTION_UPDATE,operation:b.COLL_UPDATED,collectionKey:t,toId:e};i.messenger.send(n)}broadcastEvent(e,t,i=!0){for(const n of Object.keys(this.clients))(i||this.clients[parseInt(n,10)].subscriptions[e])&&this.broadcastEventToClient(parseInt(n,10),e,t)}bindEvents(e){this.connectionHandler.on(w.CONNECT,(t=>{const i=new PostMessage(e,this.id,t.fromId);this.onConnectionReceived(i,t)}))}onConnectionReceived(e,t){const i=Object.assign(Object.assign({},t),{handshake:()=>{const n=this.clients[i.fromId];if(n&&n.connected)return void M.info(`client already connected: ${i.fromId}`);this.clients[i.fromId]={origin:t.origin,messenger:e,subscriptions:{},connected:!1};const s={type:w.HANDSHAKE,toId:i.fromId};M.info(`handshake ${i.fromId}`),e.send(s)},accept:(t,n,s)=>{const r=this.clients[i.fromId];if(r&&r.connected)return void M.info(`client already connected: ${i.fromId}`);const o={type:w.ACCEPT,toId:i.fromId,targetId:this.id,targetOrigin:`${this.hostWindow.location.protocol}//${this.hostWindow.location.host}`,warning:s,scriptUrl:t,interface:n};M.info(`accept ${i.fromId}`),e.send(o),r.connected=!0,e.on(w.DISCONNECT,(e=>this.onDisconnectReceived(r,e))),e.on(w.ACTION,(e=>this.onMessageReceived(r,e))),e.on(w.EVENT_SUB,(e=>this.onEventSubscribe(r,e))),e.on(w.EVENT_UNSUB,(e=>this.onEventUnsubscribe(r,e))),e.on(w.OBSERVABLE_SUB,(e=>this.onObservableSubscribe(r,e))),e.on(w.OBSERVABLE_UNSUB,(e=>this.onObservableUnsubscribe(r,e))),e.on(S.COLLECTION_SUB,(e=>this.onCollectionSubscribe(r,e))),e.on(S.COLLECTION_UNSUB,(e=>this.onCollectionUnsubscribe(r,e)))},reject:t=>{const n={type:w.REJECT,toId:i.fromId,reason:t};e.send(n),e.clearTarget(),e.dispose(),delete this.clients[i.fromId]},method:n.POSTMESSAGE});e.setTarget(i.source,i.origin),this.emit(T.CONNECTION,i)}onDisconnectReceived(e,t){delete this.clients[t.fromId],this.emit(T.DISCONNECT,e,t)}onMessageReceived(e,t){const i={toId:t.fromId,uid:t.uid,message:null,success:!0,type:w.RESPONSE,timestamp:Date.now()};function n(t){i.message=t,e.messenger.send(i)}const s=Object.assign(Object.assign({},t),{origin:e.origin,onSuccess:e=>{n(e)},onFail:e=>{i.success=!1,i.error=e,n(e)}});this.emit(T.MESSAGED,s)}onEventSubscribe(e,t){e.subscriptions[t.subscription]=!0,this.emitSdkEvent(T.SUBSCRIBED,e,t)}onEventUnsubscribe(e,t){e.subscriptions[t.subscription]=!1,this.emitSdkEvent(T.UNSUBSCRIBED,e,t)}onObservableSubscribe(e,t){this.emitSdkEvent(T.OBSERVABLE_SUB,e,t)}onObservableUnsubscribe(e,t){this.emitSdkEvent(T.OBSERVABLE_UNSUB,e,t)}onCollectionSubscribe(e,t){this.emitSdkEvent(T.COLLECTION_SUB,e,t)}onCollectionUnsubscribe(e,t){this.emitSdkEvent(T.COLLECTION_UNSUB,e,t)}emitSdkEvent(e,t,i){this.emit(e,Object.assign(Object.assign({},i),{origin:t.origin}))}}var x=i(48073),A=i(18201);class ConnectionObserverAdaptor{constructor(e,t){this.observer=e,this.origin=t}notify(e,t,i){this.observer.onConnectionReceived(this.origin,{id:e,node:t,messenger:i})}}class FunctionCallMessageObserver{constructor(e,t){this.receiver=e,this.clientId=t,this.messageType=S.ACTION}notify(e){this.receiver.receiveAction(e,this.clientId)}}class EventSubscribeMessageObserver{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=S.EVENT_SUB}notify(e){this.observer.receiveEventSub(e,this.clientId)}}class EventUnsubscribeMessageObserver{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=S.EVENT_UNSUB}notify(e){this.observer.receiveEventUnsub(e,this.clientId)}}class ObservableSubMessageObserver{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=S.OBSERVABLE_SUB}notify(e){this.observer.receiveObservableSub(e,this.clientId)}}class ObservableUnsubMessageObserver{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=S.OBSERVABLE_UNSUB}notify(e){this.observer.receiveObservableUnsub(e,this.clientId)}}class CollectionSubMessageObserver{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=S.COLLECTION_SUB}notify(e){this.observer.receiveCollectionSub(e,this.clientId)}}class CollectionUnsubMessageObserver{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=S.COLLECTION_UNSUB}notify(e){this.observer.receiveCollectionUnsub(e,this.clientId)}}class ResponseMessage{constructor(e,t,i,n){this.type=y.RESPONSE,this.payload={uid:e,message:t,success:i,error:n}}}class EventMessage{constructor(e,t){this.type=y.EVENT,this.payload={eventType:e,eventData:t}}}class ObservationMessage{constructor(e,t){this.type=y.OBSERVATION,this.payload={observableKey:e,observableData:t}}}class CollectionItemAddedMessage{constructor(e,t,i,n){this.type=y.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i,item:n}}}class CollectionItemRemovedMessage{constructor(e,t,i){this.type=y.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i}}}class CollectionItemUpdatedMessage{constructor(e,t,i,n){this.type=y.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i,item:n}}}class CollectionUpdatedMessage{constructor(e,t){this.type=y.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t}}}class DirectMessageHost{constructor(e){this.hostId=e,this.host=new x.Ej,this.clientConnections={},this.clientEventSubscriptions=new A.X,this.clientObservableSubscriptions=new A.X,this.clientCollectionSubscriptions=new A.X,this.facade=new DirectMessageHost.DirectMessageHostFacade(this)}createFactory(e){const t=new ConnectionObserverAdaptor(this.facade,e);return new x.UX(this.hostId,this.host,t)}broadcastEvent(e,t,i=!0){const n=this.clientEventSubscriptions.getValuesAtKey(e);if(n||i)for(const i of n)this.clientConnections[i].hostToClient.send(new EventMessage(e,t||[]))}broadcastObservationToClient(e,t){const i=this.clientObservableSubscriptions.getValuesAtKey(e);if(i)for(const n of i)this.clientConnections[n].hostToClient.send(new ObservationMessage(e,t))}broadcastCollectionItemAdded(e,t,i){const n=this.clientCollectionSubscriptions.getValuesAtKey(e);if(n)for(const s of n)this.clientConnections[s].hostToClient.send(new CollectionItemAddedMessage(b.ITEM_ADDED,e,t,i))}broadcastCollectionItemRemoved(e,t){const i=this.clientCollectionSubscriptions.getValuesAtKey(e);if(i)for(const n of i)this.clientConnections[n].hostToClient.send(new CollectionItemRemovedMessage(b.ITEM_REMOVED,e,t))}broadcastCollectionItemUpdated(e,t,i){const n=this.clientCollectionSubscriptions.getValuesAtKey(e);if(n)for(const s of n)this.clientConnections[s].hostToClient.send(new CollectionItemUpdatedMessage(b.ITEM_UPDATED,e,t,i))}broadcastCollectionUpdated(e){const t=this.clientCollectionSubscriptions.getValuesAtKey(e);if(t)for(const i of t)this.clientConnections[i].hostToClient.send(new CollectionUpdatedMessage(b.COLL_UPDATED,e))}onDisconnectReceived(e){this.disconnectCallback=e}onCallReceived(e){this.functionCallcallback=e}onSubscribeReceived(e){this.eventSubCallback=e}onUnsubscribeReceived(e){this.eventUnsubCallback=e}onObservableSubReceived(e){this.observableSubCallback=e}onObservableUnsubReceived(e){this.observableUnsubCallback=e}onCollectionSubReceived(e){this.collectionSubCallback=e}onCollectionUnsubReceived(e){this.collectionUnsubCallback=e}createHostToClientConnection(e,t){const i=new x.Pf(this.hostId,e,new x.WT(this.host,t)),n=new DirectMessageHost.DirectMessageHostFacade(this);return i.addObserver(new FunctionCallMessageObserver(n,e)),i.addObserver(new EventSubscribeMessageObserver(n,e)),i.addObserver(new EventUnsubscribeMessageObserver(n,e)),i.addObserver(new ObservableSubMessageObserver(n,e)),i.addObserver(new ObservableUnsubMessageObserver(n,e)),i.addObserver(new CollectionSubMessageObserver(n,e)),i.addObserver(new CollectionUnsubMessageObserver(n,e)),i.init(),i}onConnectionReceived(e,t){const i=t.id,n=this.createHostToClientConnection(i,t.node);this.clientConnections[i]={id:i,clientToHost:t.messenger,hostToClient:n,origin:e}}disconnect(e,t){const i=this.clientConnections[t];i&&(delete this.clientConnections[t],this.disconnectCallback&&this.disconnectCallback(Object.assign(Object.assign({},e),{type:w.DISCONNECT,uid:-1,fromId:t,origin:i.origin,method:n.DIRECT,source:void 0})))}receiveAction(e,t){const i=this.clientConnections[t];if(!i)return;const s=t=>{i.hostToClient.send(new ResponseMessage(e.uid,t,!0,""))},r=t=>{i.hostToClient.send(new ResponseMessage(e.uid,{},!1,t))};this.functionCallcallback&&this.functionCallcallback(Object.assign(Object.assign({},e),{type:w.ACTION,onSuccess:s,onFail:r,fromId:t,origin:i.origin,method:n.DIRECT,source:void 0}))}receiveEventSub(e,t){const i=this.clientConnections[t];i&&this.eventSubCallback&&(this.clientEventSubscriptions.add(e.subscription,t),this.eventSubCallback(this.createBridgedMessage(w.EVENT_SUB,e,i)))}receiveEventUnsub(e,t){const i=this.clientConnections[t];i&&this.eventUnsubCallback&&(this.clientEventSubscriptions.remove(e.subscription,t),this.eventUnsubCallback(this.createBridgedMessage(w.EVENT_UNSUB,e,i)))}receiveObservableSub(e,t){const i=this.clientConnections[t];i&&this.observableSubCallback&&(this.clientObservableSubscriptions.add(e.observableKey,t),this.observableSubCallback(this.createBridgedMessage(w.OBSERVABLE_SUB,e,i)))}receiveObservableUnsub(e,t){const i=this.clientConnections[t];i&&this.observableUnsubCallback&&(this.clientObservableSubscriptions.remove(e.observableKey,t),this.observableUnsubCallback(this.createBridgedMessage(w.OBSERVABLE_UNSUB,e,i)))}receiveCollectionSub(e,t){const i=this.clientConnections[t];i&&this.collectionSubCallback&&(this.clientCollectionSubscriptions.add(e.collectionKey,t),this.collectionSubCallback(this.createBridgedMessage(S.COLLECTION_SUB,e,i)))}receiveCollectionUnsub(e,t){const i=this.clientConnections[t];i&&this.collectionUnsubCallback&&(this.clientCollectionSubscriptions.remove(e.collectionKey,t),this.collectionUnsubCallback(this.createBridgedMessage(S.COLLECTION_UNSUB,e,i)))}createBridgedMessage(e,t,i){return Object.assign(Object.assign({},t),{fromId:i.id,uid:-1,type:e,origin:i.origin,method:n.DIRECT,source:void 0})}}DirectMessageHost.DirectMessageHostFacade=class{constructor(e){this.directMessageHost=e}onConnectionReceived(e,t){this.directMessageHost.onConnectionReceived(e,t)}disconnect(e,t){this.directMessageHost.disconnect(e,t)}receiveAction(e,t){this.directMessageHost.receiveAction(e,t)}receiveEventSub(e,t){this.directMessageHost.receiveEventSub(e,t)}receiveEventUnsub(e,t){this.directMessageHost.receiveEventUnsub(e,t)}receiveObservableSub(e,t){this.directMessageHost.receiveObservableSub(e,t)}receiveObservableUnsub(e,t){this.directMessageHost.receiveObservableUnsub(e,t)}receiveCollectionSub(e,t){this.directMessageHost.receiveCollectionSub(e,t)}receiveCollectionUnsub(e,t){this.directMessageHost.receiveCollectionUnsub(e,t)}};var O,P=i(40918),D=i(13377),C=i(23847),I=i(64185);!function(e){e.EMBED="sdk.embed",e.BUNDLE="sdk.bundle"}(O||(O={}));class AnalyticsProxy{constructor(e,t){this.analytics=e,this.sdkType=t,this.trackedEvents={}}track(e,t,i){this.trackedEvents[e]&&this.trackedEvents[e][t]||(this.trackedEvents[e]=this.trackedEvents[e]||{},this.trackedEvents[e][t]=!0,this.analytics.track(e,Object.assign({sdkType:this.sdkType},i)))}}const L=new _.Z("sdk");class Sdk extends f.Y{constructor(){super(...arguments),this.name="sdk",this.hostId=Math.floor(1e6*Math.random()),this.triedLoadingInterface=!1,this.clientInterface={functions:{},commands:{},enums:{},observables:{},collections:{}},this.valueToClientInterface={},this.commandCreators={},this.registeredEventUsers={},this.commands={},this.observables={},this.registeredObservers={},this.collections={},this.registeredCollectionObservers={},this.observerMap=new Map}async init(e,t){this.config=e,this.applicationKey=e.applicationKey,this.validationUrl=e.validationUrl,this.postMessageHost=new PostMessageHost(window,this.hostId),this.directMessageHost=new DirectMessageHost(this.hostId),this.analytics=new AnalyticsProxy(await t.getModule(C.default),O.BUNDLE),this.clientFilter=e.clientFilter||(()=>!0),this.issueCommand=t.commandBinder.issueCommand.bind(t.commandBinder),this.interfacePromise=new I.Q,this.getClientScriptUrl=e.getClientScriptUrl,this.requestQueue=e.queue,this.data=new D.I,t.market.register(this,D.I,this.data),this.enableHandshaking()}dispose(){this.clearInterface()}async connect(e,t){return new Promise(((i,s)=>{this.setupInterface(),this.onConnectionReceived({accept:(t,n,s)=>{i({targetId:this.hostId,targetOrigin:e,scriptUrl:t,serializedInterface:n,messengerFactory:this.directMessageHost.createFactory(e),warning:s}),this.data.atomic((()=>{this.data.applicationKey=this.applicationKey}))},reject:s,handshake:()=>{},options:t,origin:e,method:n.DIRECT})}))}enableHandshaking(){this.postMessageHost.once(T.CONNECTION,(()=>this.setupInterface())),this.postMessageHost.on(T.CONNECTION,(e=>this.onConnectionReceived(e)))}async setupInterface(){if(!this.triedLoadingInterface)try{this.triedLoadingInterface=!0,await this.config.setupExternalSdk(this),this.acceptConnections()}catch(e){this.interfacePromise.reject(e.message)}}acceptConnections(){this.postMessageHost.on(T.DISCONNECT,(e=>this.disconnectClient(e))),this.postMessageHost.on(T.MESSAGED,(e=>this.onActionReceived(e))),this.postMessageHost.on(T.SUBSCRIBED,(e=>this.onSubscribeReceived(e))),this.postMessageHost.on(T.UNSUBSCRIBED,(e=>this.onUnsubscribeReceived(e))),this.postMessageHost.on(T.OBSERVABLE_SUB,(e=>this.onObservableSubReceived(e))),this.postMessageHost.on(T.OBSERVABLE_UNSUB,(e=>this.onObservableUnsubReceived(e))),this.postMessageHost.on(T.COLLECTION_SUB,(e=>this.onCollectionSubReceived(e))),this.postMessageHost.on(T.COLLECTION_UNSUB,(e=>this.onCollectionUnsubReceived(e))),this.directMessageHost.onDisconnectReceived((e=>this.disconnectClient(e))),this.directMessageHost.onCallReceived((e=>this.onActionReceived(e))),this.directMessageHost.onSubscribeReceived((e=>this.onSubscribeReceived(e))),this.directMessageHost.onUnsubscribeReceived((e=>this.onUnsubscribeReceived(e))),this.directMessageHost.onObservableSubReceived((e=>this.onObservableSubReceived(e))),this.directMessageHost.onObservableUnsubReceived((e=>this.onObservableUnsubReceived(e))),this.directMessageHost.onCollectionSubReceived((e=>this.onCollectionSubReceived(e))),this.directMessageHost.onCollectionUnsubReceived((e=>this.onCollectionUnsubReceived(e))),this.interfacePromise.resolve()}clearInterface(){this.clientInterface.functions={},this.clientInterface.commands={},this.clientInterface.enums={},this.clientInterface.observables={},this.clientInterface.collections={},this.commandCreators={}}onUpdate(){if(this.observerMap.size)for(const[e,[t,i,n]]of this.observerMap)e.dirty&&(this.notifyObservableUpdate(t,i,n.getData()),e.dirty=!1)}addCommandCreator(e,t){const i=this.getInterfaceIndex(e);this.clientInterface.functions.hasOwnProperty(i)&&L.debug(`Overwriting ${i} function in sdk interface`),this.clientInterface.functions[i]=e,this.commandCreators[i]=t}addEnumToInterface(e){const t=this.getInterfaceIndex(e);if(this.clientInterface.functions.hasOwnProperty(t)&&L.debug(`Overwriting ${t} enum in sdk interface`),this.clientInterface.enums[t]=Object.assign(Object.assign({},e),{values:Object.assign({},e.values)}),"Event"===e.name){const t=Object.keys(e.values);for(const i in t){this.valueToClientInterface;const n=e.values[t[i]];this.valueToClientInterface.hasOwnProperty(n)?L.warn(`Duplicate event detected for ${JSON.stringify(e)}`):this.valueToClientInterface[n]=e}}}async addCommandToInterface(e,t){const i=this.getInterfaceIndex(e);this.addCommand(i,t),this.clientInterface.commands[i]=e}async addCommand(e,t){this.clientInterface.commands.hasOwnProperty(e),this.commands[e]=await t;const i=this;return{dispose(){i.removeCommand(e)}}}removeCommand(e){delete this.commands[e]}addObservableToInterface(e,t){const i=this.getInterfaceIndex(e);this.addObservable(i,t),this.clientInterface.observables[i]=Object.assign({},e)}addObservable(e,t){this.clientInterface.observables.hasOwnProperty(e),this.observables[e]=t;const i=this;return{dispose(){i.removeObservable(e)}}}removeObservable(e){delete this.observables[e];for(const t in this.registeredObservers){const i=this.registeredObservers[t],n=i[e];n&&n.cancel(),delete i[e]}}addCollectionToInterface(e,t){const i=this.getInterfaceIndex(e);this.addCollection(i,t),this.clientInterface.collections[i]=Object.assign({},e)}addCollection(e,t){this.clientInterface.collections.hasOwnProperty(e),this.collections[e]=t;const i=this;return{dispose(){i.removeCollection(e)}}}removeCollection(e){delete this.collections[e];for(const t in this.registeredCollectionObservers){const i=this.registeredCollectionObservers[t],n=i[e];n&&n.cancel(),delete i[e]}}getInterfaceIndex(e){let t=`${e.name}`;return e.namespace&&(t=`${e.namespace}.${t}`),t}broadcast(e,t,i,n=!0){const s=this.registeredEventUsers[e]>0;if(n||s)if(t)if(void 0!==i){const s=t(i);this.postMessageHost.broadcastEvent(e,s,n),this.directMessageHost.broadcastEvent(e,s,n)}else{const i=t();this.postMessageHost.broadcastEvent(e,i,n),this.directMessageHost.broadcastEvent(e,i,n)}else this.postMessageHost.broadcastEvent(e,void 0,n),this.directMessageHost.broadcastEvent(e,void 0,n)}notifyObservableUpdate(e,t,i){this.postMessageHost.broadcastObservationToClient(e,t,i),this.directMessageHost.broadcastObservationToClient(t,i)}async onConnectionReceived(e){if(this.applicationKey=this.applicationKey||e.applicationKey||null,!this.clientFilter(e))return e.reject("Connection refused");try{await this.verifyConnection(e)}catch(t){return e.reject("key/referrer mismatch")}const t=async t=>{var i;const n={enums:this.clientInterface.enums,functions:Object.assign(Object.assign({},this.clientInterface.functions),this.clientInterface.commands),observables:this.clientInterface.observables,collections:this.clientInterface.collections};this.trackSdkConnect(e),this.config.onClientConnect(null===(i=e.options)||void 0===i?void 0:i.auth),e.accept(await this.getClientScriptUrl(),n,t)};e.handshake();try{await this.interfacePromise,await t()}catch(t){e.reject(t)}}verifyConnection(e){const t={cache:!1,headers:{"X-Matterport-Application-Key":this.applicationKey,"X-Matterport-Referrer":e.origin}};return this.requestQueue.get(this.validationUrl,t)}disconnectClient(e){}onActionReceived(e){if(this.tryActionThroughCommand(e))return;const t=this.commandCreators[e.targetFunction];if(!t)return e.onFail(`${e.targetFunction} is not a valid command`);this.trackSdkCall(e);try{this.issueCommand(t(e.params)).then(e.onSuccess,(t=>e.onFail(t.message)))}catch(t){L.debug(t),e.onFail(t.message)}}tryActionThroughCommand(e){const t=this.commands[e.targetFunction];if(!t)return!!this.clientInterface.commands.hasOwnProperty(e.targetFunction)&&(e.onFail(`${e.targetFunction} is not ready to be called`),!0);this.trackSdkCall(e);try{t.exec(e.params,new ReturnObserver(e))}catch(t){L.debug(t),e.onFail(t.message)}return!0}onSubscribeReceived(e){this.registeredEventUsers.hasOwnProperty(e.subscription)||(this.registeredEventUsers[e.subscription]=0),this.registeredEventUsers[e.subscription]++,this.trackSdkEvent(T.SUBSCRIBED,e)}onUnsubscribeReceived(e){this.registeredEventUsers.hasOwnProperty(e.subscription)&&(this.trackSdkEvent(T.UNSUBSCRIBED,e),this.registeredEventUsers[e.subscription]--)}async onObservableSubReceived(e){const t=e.fromId,i=e.observableKey,n=this.observables[i];if(n){const s=await n;if(!this.observables[i])return;if(this.registeredObservers[t]=this.registeredObservers[t]||{},void 0===this.registeredObservers[t][i]){const n=new P.W;this.registeredObservers[t][i]=s.subscribe(n),this.observerMap.set(n,[t,i,s]),this.trackClientSubscribe(T.OBSERVABLE_SUB,e)}}else L.error(i,"is not a valid, registered observable")}onObservableUnsubReceived(e){const t=e.fromId,i=e.observableKey;this.registeredObservers[t]&&this.registeredObservers[t][i]&&(this.registeredObservers[t][i].cancel(),delete this.registeredObservers[t][i],this.trackClientSubscribe(T.OBSERVABLE_UNSUB,e))}async onCollectionSubReceived(e){const t=e.fromId,i=e.collectionKey,n=this.collections[i];if(n){const s=await n;if(!this.collections[i])return;this.registeredCollectionObservers[t]=this.registeredCollectionObservers[t]||{},void 0===this.registeredCollectionObservers[t][i]&&(this.registeredCollectionObservers[t][i]=s.observe({onAdded:(e,n)=>{this.postMessageHost.broadcastCollectionItemAdded(t,i,e,n),this.directMessageHost.broadcastCollectionItemAdded(i,e,n)},onRemoved:e=>{this.postMessageHost.broadcastCollectionItemRemoved(t,i,e),this.directMessageHost.broadcastCollectionItemRemoved(i,e)},onUpdated:(e,n)=>{this.postMessageHost.broadcastCollectionItemUpdated(t,i,e,n),this.directMessageHost.broadcastCollectionItemUpdated(i,e,n)},onCollectionUpdated:()=>{this.postMessageHost.broadcastCollectionUpdated(t,i),this.directMessageHost.broadcastCollectionUpdated(i)}}),this.trackClientSubCollection(T.COLLECTION_SUB,e))}else L.error(i,"is not a valid, registered collection")}onCollectionUnsubReceived(e){const{fromId:t,collectionKey:i}=e;this.registeredCollectionObservers[t]&&this.registeredCollectionObservers[t][i]&&(this.registeredCollectionObservers[t][i].cancel(),delete this.registeredCollectionObservers[t][i],this.trackClientSubCollection(T.COLLECTION_UNSUB,e))}trackSdkEvent(e,t){if(!this.analytics)return;const i=e===T.SUBSCRIBED?"on":"off",n=this.valueToClientInterface[t.subscription];if(!n)return;const s=Object.keys(n.values),r=s.find(((e,i)=>{const r=s[i];return n.values[r]===t.subscription}));if(!r)return;const o={origin:t.origin,applicationKey:this.applicationKey,name:i,namespace:n.namespace,eventType:r,count:this.registeredEventUsers[t.subscription],method:t.method};this.analytics.track("sdk_event",t.subscription,o)}trackSdkConnect(e){if(!this.analytics)return;const t={origin:e.origin,applicationKey:this.applicationKey,method:e.method};this.analytics.track("sdk_connect","connect",t)}trackSdkCall(e){if(!this.analytics)return;const t=this.clientInterface.functions[e.targetFunction]||this.clientInterface.commands[e.targetFunction],i=Object.assign(Object.assign({origin:e.origin,applicationKey:this.applicationKey},t),{method:e.method});this.analytics.track("sdk_call",e.targetFunction,i)}trackClientSubscribe(e,t){const i=e===T.OBSERVABLE_SUB,n=this.clientInterface.observables[t.observableKey],s=Object.assign(Object.assign({origin:t.origin,applicationKey:this.applicationKey},n),{is_collection:!1,action:i?"subscribe":"cancel",method:t.method});this.analytics.track("sdk_subscribe",t.observableKey,s)}trackClientSubCollection(e,t){const i=e===T.COLLECTION_SUB,n=this.clientInterface.collections[t.collectionKey],s=Object.assign(Object.assign({origin:t.origin,applicationKey:this.applicationKey},n),{is_collection:!0,action:i?"subscribe":"cancel",method:t.method});this.analytics.track("sdk_subscribe",t.collectionKey,s)}}class ReturnObserver{constructor(e){this.action=e}return(e){this.action.onSuccess(e)}throw(e){this.action.onFail(e)}}const R=Sdk},55305:(e,t,i)=>{"use strict";var n;i.d(t,{F:()=>n}),function(e){e.UnitType="user_preference/unit_type",e.MeasurementSnapping="user_preference/measurement_snapping",e.MeasurementContinuousLines="user_preference/measurement_continuous",e.MeasurementUserNudgeSeen="user_preference/measurement_nudge",e.HighlightReelSettingsTab="user_preference/highlight_reel_settings_tab",e.NotesModeNudgeSeen="user_preference/notes_mode_nudge",e.NotesAddNudgeSeen="user_preference/notes_add_nudge",e.NotesIntroModalSeen="user_preference/notes_intro_seen"}(n||(n={}))},33874:(e,t,i)=>{"use strict";i.d(t,{e:()=>SettingsData});var n=i(32770),s=i(64781),r=i(98612);class SettingsData extends n.V{constructor(){super(...arguments),this.name="settings",this.properties=(0,s.q)()}setProperty(e,t){const i=this.properties.get(e);null!=t&&i===t||(this.properties.set(e,t),this.commit([e]))}notifyPropertyObserver(e,t){e(this.properties.get(t))}setLocalStorageProperty(e,t){(0,r.m8)(e,t),this.setProperty(e,t)}hasProperty(e){return this.properties.has(e)}tryGetProperty(e,t){return this.hasProperty(e)?this.properties.get(e):t}getProperty(e){if(this.hasProperty(e))return this.properties.get(e);throw new Error("SettingsData: "+e+" not found")}checkUrlParam(e,t,i=0){const n=this.tryGetProperty(e,i);return"number"==typeof n?n===t:parseInt(n,10)===t}iterate(e){for(const t of this.properties.keys)e(t,this.getProperty(t))}}},24930:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SettingPersistence:()=>p,default:()=>SettingsModule});var n,s=i(88512),r=i(2212),o=i(10757),a=i(64185);!function(e){e[e.Init=0]="Init",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded"}(n||(n={}));class SettingsGUI{constructor(e){this.onChange=e,this.settings={},this.helperObject={colors:{},vectors:{},quaternions:{}},this.initPromise=new a.Q,this.loadState=n.Init,this.uninitError="ControlKit not yet initialized",this.lastKeys=[],this.lastKeysBufferLength=0,this.controlKit=void 0,this.updateRequired=!1,this.panels=[],this.onToggleCallbacks={},this.onKeyDown=e=>{this.lastKeys.unshift(e.keyCode),this.lastKeys.length>this.lastKeysBufferLength&&this.lastKeys.pop();for(let e=0;e<this.panels.length;e++){const t=this.panels[e].activationSequence;(0,o.Jq)(this.lastKeys,t)&&this.toggle(e)}},this.getPanelId=e=>{for(const t of this.panels)if(e===t.header)return t.index;return-1},this.getSubGroup=(e,t)=>{const i=this.panels[e];if(i.guiPanel||(i.guiPanel=i.makeGuiPanel()),!i.allowSubGroups)return i.guiPanel;let n=i.subGroups[t];return n||(n=i.guiPanel.addSubGroup({label:t,enable:!1}),i.subGroups[t]=n),n},this.addColor=(e,t,i,n)=>{this.updateHelperObject(t+i,n),e.addColor(this.helperObject.colors,t+i,{label:i,colorMode:"hex",onChange:e=>{this.settings[t+i].setHex(parseInt(e.substring(1),16));const n={};n[i]=this.settings[t+i],this.onChange(n)}})},this.addVector3=(e,t,i,n)=>{this.updateHelperObject(i,n);const s=e.addSubGroup({label:i}),o=["x","y","z"];for(const e in o)s.addNumberInput(this.helperObject.vectors[t+i],o[e],{label:o[e],onChange:()=>{this.settings[t+i]=new r.Vector3(this.helperObject.vectors[i].x,this.helperObject.vectors[i].y,this.helperObject.vectors[i].z);const e={};e[i]=this.settings[t+i],this.onChange(e)}})},this.addQuaternion=(e,t,i,n)=>{this.updateHelperObject(i,n);const s=e.addSubGroup({label:i}),o=["x","y","z","w"];for(const e in o){const n=i+o[e];s.addNumberInput(this.helperObject.quaternions[t+i],n,{label:o[e],onChange:()=>{this.settings[t+i]=new r.Quaternion(this.helperObject.quaternions[t+i].x,this.helperObject.quaternions[t+i].y,this.helperObject.quaternions[t+i].z,this.helperObject.quaternions[t+i].w);const e={};e[i]=this.settings[t+i],this.onChange(e)}})}}}init(){}async loadGuiPackage(){return this.loadState===n.Init&&(i.e(66).then(i.t.bind(i,94810,23)).then((e=>{const t=document.createElement("div");t.id="controlKitElement",(document.getElementById("control-kit-wrapper")||document.body).appendChild(t);const i=e=>e.stopPropagation();t.addEventListener("keydown",i),t.addEventListener("keyup",i),t.addEventListener("keypress",i),this.controlKit=new e.default({opacity:.9,enable:!1,parentDomElementId:"controlKitElement"}),this.controlKit.setShortcutEnable(""),this.controlKit.enable(),this.initPromise.resolve(),this.loadState=n.Loaded})),this.loadState=n.Loading),this.loadPromise}get loadPromise(){return this.initPromise.nativePromise()}get isLoaded(){return void 0!==this.controlKit}addPanel(e,t,i={}){for(void 0===i.width&&(i.width=250),void 0===i.allowSubGroups&&(i.allowSubGroups=!0),void 0===i.ratio&&(i.ratio=60),this.lastKeysBufferLength=Math.max(this.lastKeysBufferLength,t.length);this.lastKeysBufferLength>this.lastKeys.length;)this.lastKeys.unshift(-1);return this.panels.push({index:this.panels.length,header:e,guiPanel:null,makeGuiPanel:()=>this.controlKit.addPanel({label:e,align:"right",ratio:i.ratio,width:i.width}),subGroups:[],allowSubGroups:i.allowSubGroups,activationSequence:t.reverse()}),this.panels.length-1}isVisible(e){if(!this.controlKit)throw new Error(this.uninitError);return this.panels[e].guiPanel._enabled}toggle(e){this.controlKit?this.toggleVisibility(e):this.loadGuiPackage().then((()=>{this.toggleVisibility(e)}))}onToggle(e,t){this.onToggleCallbacks[e]||(this.onToggleCallbacks[e]=[]),this.onToggleCallbacks[e].push(t)}toggleVisibility(e){if(!this.controlKit)throw new Error(this.uninitError);const t=this.panels[e].guiPanel._enabled;if(t?this.panels[e].guiPanel.disable():this.panels[e].guiPanel.enable(),this.onToggleCallbacks[e])for(const i of this.onToggleCallbacks[e])i(!t)}dispose(){const e=document.getElementById("controlKit");e&&e.remove(),this.controlKit=void 0}activate(e){window.addEventListener("keydown",this.onKeyDown)}deactivate(e){this.controlKit&&this.controlKit.disable(),window.removeEventListener("keydown",this.onKeyDown)}render(){this.controlKit&&this.updateRequired&&(this.updateRequired=!1,this.controlKit.update())}updateSetting(e,t,i){if(!this.controlKit)throw new Error(this.uninitError);const n=e+t,s=this.settings[n];i&&"function"==typeof i.equals&&"function"==typeof i.copy&&s&&"function"==typeof s.equals&&"function"==typeof s.copy?i.equals(this.settings[n])||(this.settings[n].copy(i),this.updateHelperObject(n,i),this.updateRequired=!0):i!==this.settings[e+t]&&(this.settings[n]=i,this.updateRequired=!0)}getSetting(e,t){return this.settings[e+t]}isRegistered(e,t){return void 0!==this.settings[e+t]}addControl(e,t,i,n,s,o=2,a){if(!this.controlKit)throw new Error(this.uninitError);const l=this.getSubGroup(e,t),c=`${e}${i}`;this.settings[c]=n;let h=typeof n;if(("string"===h&&"true"===n||"false"===n)&&(h="boolean"),n instanceof r.Color)this.addColor(l,e,i,n);else if(n instanceof r.Vector3)this.addVector3(l,e,i,n);else if(n instanceof r.Quaternion)this.addQuaternion(l,e,i,n);else switch(h){case"string":Array.isArray(a)?(this.settings[c]={options:a,selected:n},l.addSelect(this.settings[c],"options",{target:"selected",label:i,onChange:e=>{const t={[i]:a[e]};this.onChange(t)}})):l.addStringInput(this.settings,e+i,{label:i,onChange:t=>{const n={};this.settings[e+i]=t,n[i]=this.settings[e+i],this.onChange(n)}});break;case"number":this.settings[`${e+i}_range`]=s||[0,10],l.addSlider(this.settings,e+i,`${e+i}_range`,{label:i,onChange:()=>{const t={};t[i]=this.settings[e+i],this.onChange(t)},dp:o});break;case"boolean":l.addCheckbox(this.settings,e+i,{label:i,ratio:10,onChange:()=>{const t={};t[i]=this.settings[e+i],this.onChange(t)}});break;default:l.addStringOutput(this.settings,e+i,{label:i})}}addButton(e,t,i,n){if(!this.controlKit)throw new Error(this.uninitError);this.getSubGroup(e,t).addButton(i,n,{label:"none",ratio:100})}addSlider(e,t,i,n,s,r,o){if(!this.controlKit)throw new Error(this.uninitError);const a=this.getSubGroup(e,t);this.settings[e+i]=n,this.settings[e+i+"_range"]=[s,r],a.addSlider(this.settings,e+i,e+i+"_range",{label:i,dp:o,onChange:()=>{const t={};t[i]=this.settings[e+i],this.onChange(t)}})}updateHelperObject(e,t){t instanceof r.Color?this.helperObject.colors[e]="#"+t.getHexString():t instanceof r.Vector3?(this.helperObject.vectors[e]={},this.helperObject.vectors[e].x=t.x,this.helperObject.vectors[e].y=t.y,this.helperObject.vectors[e].z=t.z):t instanceof r.Quaternion&&(this.helperObject.quaternions[e]={},this.helperObject.quaternions[e].x=t.x,this.helperObject.quaternions[e].y=t.y,this.helperObject.quaternions[e].z=t.z,this.helperObject.quaternions[e].w=t.w)}}var l=i(47724),c=i(33874),h=i(60771),d=i(98612);const u=new s.Z("settings");var p;!function(e){e[e.NONE=0]="NONE",e[e.LOCAL_STORAGE=1]="LOCAL_STORAGE"}(p||(p={}));class SettingsModule extends l.Y{constructor(){super(...arguments),this.name="settings",this.queuedControls=[],this.queuedButtons=[],this.secretWord=[38,38,40,40,37,39,37,39,66,65,72],this.panelID=-1,this.addPanel=(e,t,i)=>{const n=this.getPanelId(e);return-1===n?this.settingsGUI.addPanel(e,t,i):n},this.getPanelId=e=>this.settingsGUI.getPanelId(e)}async init(e,t){this.engine=t,this.settings=new c.e,this.engine.market.register(this,c.e,this.settings),e.useGUI&&(this.settingsGUI=new SettingsGUI((e=>{this.updateSettings(e)})),t.addComponent(this,this.settingsGUI),this.panelID=this.settingsGUI.addPanel("3.1.51.7-84-g0dcbe0591",this.secretWord));const i=(0,h.AO)();for(const t in i){let n=i[t];if("string"==typeof n){const e=Number.parseFloat(n);isNaN(e)||(n=e)}this.settings.setProperty(t,n),e.useGUI&&this.queuedControls.push({panelId:this.panelID,group:"Engine Config",settingName:t,value:n})}e.useGUI&&this.settingsGUI.loadPromise.then((()=>{for(const e of this.queuedControls)this.settingsGUI.addControl(e.panelId,e.group,e.settingName,e.value,e.range,e.rangePrecision,e.options);for(const e of this.queuedButtons)this.settingsGUI.addButton(e.panelId,e.group,e.buttonName,e.callback);this.settingsGUI.toggle(this.panelID)}))}get loadPromise(){return this.settingsGUI.loadPromise}getSettingsGui(){return this.settingsGUI}getMainPanelId(){return this.panelID}updateSetting(e,t,i=this.panelID){t&&t.clone&&"function"==typeof t.clone?this.settings.setProperty(e,t.clone()):this.settings.setProperty(e,t),this.settingsGUI&&this.settingsGUI.isLoaded&&this.settingsGUI.updateSetting(i,e,t)}updateSettings(e){for(const t in e)this.updateSetting(t,e[t])}registerSetting(e,t,i,n=!0,s=p.NONE,r,o=this.panelID,a=2,l){if(this.settingsGUI&&this.settingsGUI.isRegistered(o,t))return void u.warn(`Duplicate setting ${t} registered. Is a module being used twice?`);let c;c=i&&i.clone&&"function"==typeof i.clone?i.clone():i,this.settingsGUI&&n&&(this.settingsGUI.isLoaded?this.settingsGUI.addControl(o,e,t,c,r,a,l):this.queuedControls.push({panelId:o,group:e,settingName:t,value:i,range:r,rangePrecision:a,options:l}));const h=s===p.LOCAL_STORAGE?(0,d.fp)(t,i):i;this.updateSetting(t,h)}registerMenuEntry(e){const{header:t,setting:i,initialValue:n,persist:s,displayInUi:r,range:o,panel:a,onChange:l,rangePrecision:c,options:d,urlParam:u}=e;let p=n();const m=encodeURIComponent(i);if(u){let e=(0,h.AO)()[m];void 0!==e&&(Number.isNaN(Number.parseFloat(e))?"true"===e?e=!0:"false"===e&&(e=!1):e=Number.parseFloat(e),p=e)}if(this.registerSetting(t,i,p,r,s,o,a,c,d),!l&&!u)return null;if(l&&l(p),u){const e=n(),t=t=>{const i=(0,h.AO)();void 0!==i[m]&&t===e?delete i[m]:i[m]=t,(0,h.Vf)(i,!0),l&&l(t)};return this.settings.onPropertyChanged(i,t)}return l?this.settings.onPropertyChanged(i,l):null}registerMenuButton(e){const{header:t,buttonName:i,panel:n,callback:s}=e;this.registerButton(t,i,s,n)}registerButton(e,t,i,n=this.panelID){this.settingsGUI&&(this.settingsGUI.isLoaded?this.settingsGUI.addButton(n,e,t,i):this.queuedButtons.push({panelId:n,group:e,buttonName:t,callback:i}))}hasProperty(e){return this.settings.hasProperty(e)}getProperty(e){return this.settings.getProperty(e)}tryGetProperty(e,t){return this.settings.tryGetProperty(e,t)}toggleMenu(){this.settingsGUI&&this.settingsGUI.toggle(0)}disposeGui(){this.settingsGUI.dispose()}}},39729:(e,t,i)=>{"use strict";var n;i.d(t,{E:()=>n}),function(e){e[e.Immediate=0]="Immediate",e[e.NextFrame=1]="NextFrame",e[e.Duration=2]="Duration",e[e.Manual=3]="Manual"}(n||(n={}))},71194:(e,t,i)=>{"use strict";i.d(t,{KI:()=>n,AQ:()=>ChangeRecord,Z8:()=>CollectionMonitor});var n,s=i(14063),r=i(39729),o=i(84303);!function(e){e.added="added",e.removed="removed",e.updated="updated"}(n||(n={}));class ChangeRecord{constructor(e,t,i){this.index=e,this.action=t,this.diff=i}}class CollectionMonitor{constructor(e,t){if(this.changedHandlers=[],this.awaitingInvoke=!1,this.diffRecord=[],this.targetMonitors={},this.triggerChangeHandlers=this.invokeChangeHandlers.bind(this),this.config=e,this.updatePhaseSync=t,this.config.aggregationType===r.E.NextFrame){if(!t)throw Error("UpdatePhaseSync required for NextFrame aggregation")}else if(this.config.aggregationType===r.E.Duration)throw Error("Aggregation Type not implemented")}hasDiffRecord(){return this.diffRecord.length>0}clearDiffRecord(){this.diffRecord=[];for(const e in this.targetMonitors){const t=this.targetMonitors[e];t.hasDiffRecord()&&t.clearDiffRecord()}}onChanged(e){this.changedHandlers.push(e)}removeOnChanged(e){(0,s.b)(this.changedHandlers,e)}invokeCallbacks(e){if(this.changedHandlers.length>0)for(const t of this.changedHandlers)t(e)}invokeChangeHandlers(e){switch(this.config.aggregationType){case r.E.Immediate:this.invokeCallbacks(e);break;case r.E.NextFrame:this.awaitingInvoke||(this.awaitingInvoke=!0,this.updatePhaseSync.after(o.A.End).then((()=>{this.awaitingInvoke=!1,this.invokeCallbacks(e)})));break;case r.E.Manual:}}}},57361:(e,t,i)=>{"use strict";i.d(t,{c:()=>MapMonitor});var n=i(71194),s=i(57938),r=i(85861);class MapMonitor extends n.Z8{constructor(e,t,i){super(t,i),this.target=e;for(const n of e.keys){const r=e.get(n),o=new s.u(r,t,i);o.onChanged(this.triggerChangeHandlers),this.targetMonitors[n]=o}const o={onAdded:(e,o)=>{const a=new s.u(e,t,i);a.onChanged(this.triggerChangeHandlers),this.targetMonitors[o]=a;const l=this.diffRecord.findIndex((e=>e.index===o));-1!==l&&this.diffRecord.splice(l,1);const c=new n.AQ(o,n.KI.added,(0,r.p$)(e));-1===l&&this.diffRecord.push(c),this.triggerChangeHandlers(c)},onRemoved:(e,t)=>{delete this.targetMonitors[t];const i=this.diffRecord.findIndex((e=>e.index===t));-1!==i&&this.diffRecord.splice(i,1);const s=new n.AQ(t,n.KI.removed,(0,r.p$)(e));this.triggerChangeHandlers(s),-1===i&&this.diffRecord.push(s)}};this.target.onElementChanged(o)}commitChanges(){this.invokeCallbacks(this.getDiffRecord())}getDiffRecord(){const e=[];for(const t in this.targetMonitors){const i=this.targetMonitors[t];if(i.hasDiffRecord()){const s=i.getDiffRecord(),o=this.diffRecord.findIndex((e=>e.index===t));-1!==o?(0,r.TS)(this.diffRecord[o].diff,s):e.push(new n.AQ(t,n.KI.updated,s))}}return this.diffRecord.concat(e)}}},57938:(e,t,i)=>{"use strict";i.d(t,{u:()=>Monitor});var n=i(39729),s=i(85861),r=i(84303),o=i(14063);class Monitor{constructor(e,t,i){this.updatePhaseSync=i,this.target=e,this.clearDiffRecord(),this.target.onChanged((()=>{this.diffRecord=(0,s.br)(this.originalData,(0,s.p$)(this.target),t.shallow),this.handleAggregation()})),this.aggregationType=t.aggregationType,this.changedHandlers=[]}hasDiffRecord(){return Object.keys(this.diffRecord).length>0}getDiffRecord(){return this.diffRecord}clearDiffRecord(){this.originalData=(0,s.p$)(this.target),this.diffRecord={}}onChanged(e){this.changedHandlers.push(e)}removeOnChanged(e){(0,o.b)(this.changedHandlers,e)}commitChanges(){this.triggerChangeHandlers(this.diffRecord)}handleAggregation(){switch(this.aggregationType){case n.E.Immediate:this.triggerChangeHandlers(this.diffRecord);break;case n.E.NextFrame:if(!this.updatePhaseSync)throw new Error("handleAggregation() -> Next frame aggregation requested, but updatePhaseSync is null");this.nextFramePromise||(this.nextFramePromise=this.updatePhaseSync.after(r.A.Begin).then((()=>{this.triggerChangeHandlers(this.diffRecord)})).finally((()=>{this.nextFramePromise=void 0})));break;case n.E.Duration:throw new Error("AggregationType.Duration: Please implement me :)");case n.E.Manual:}}triggerChangeHandlers(e){if(this.changedHandlers.length>0)for(const t of this.changedHandlers)t(e)}}},66209:(e,t,i)=>{"use strict";i.d(t,{y:()=>Observable});var n=i(44283);class Observable{constructor(){this.isObservable=!0,this._dirtyObservable=!1,this._activeObservable=!0,this._observerNotifying=!1,this._changeObservers=new Set,this._parentObservables=new Set,this._childObservables=new Set,Object.defineProperties(this,{isObservable:{value:this.isObservable,writable:!1,enumerable:!1},_dirtyObservable:{value:this._dirtyObservable,enumerable:!1},_activeObservable:{value:this._activeObservable,enumerable:!1},_observerNotifying:{value:this._observerNotifying,enumerable:!1},_changeObservers:{value:this._changeObservers,writable:!1,enumerable:!1},_childObservables:{value:this._childObservables,writable:!1,enumerable:!1},_parentObservables:{value:this._parentObservables,writable:!1,enumerable:!1}})}onChanged(e){if(this._changeObservers.has(e))throw new Error("This observer function is already observing this Observable, and double subscriptions are not supported.");return(0,n.k1)((()=>this._changeObservers.add(e)),(()=>this.removeOnChanged(e)),!0)}removeOnChanged(e){this._changeObservers.delete(e)}notifyObservers(){if(this._dirtyObservable&&!this._observerNotifying&&this._activeObservable){this._observerNotifying=!0;for(const e of this._changeObservers)this.notifyObserver(e);this._dirtyObservable=!1,this._observerNotifying=!1}}notifyObserver(e){e(void 0)}notifyDown(){for(const e of this._childObservables)e.notifyDown();this.notifyObservers()}notifyUp(){for(const e of this._parentObservables)e.notifyUp();this.notifyObservers()}setDirty(e=!0){this.setDirtyUp(),e&&this.notifyUp()}setDirtyUp(){if(!this._dirtyObservable){this._dirtyObservable=!0;for(const e of this._parentObservables)e.setDirtyUp()}}addChildObservable(e){Observable.isObservable(e)&&(this._childObservables.add(e),e._parentObservables.add(this))}removeChildObservables(e){Observable.isObservable(e)&&(this._childObservables.delete(e),e._parentObservables.delete(this))}atomic(e){if(!this._activeObservable)return e();try{this.setActive(!1),e()}finally{this.setActive(!0)}}setActive(e){const t=this._activeObservable;this._activeObservable=e,!t&&e&&this.notifyObservers();for(const t of this._childObservables)t.setActive(e)}deepCopy(){throw Error("deepCopy is only implemented in subclasses of Observable")}static isObservable(e){return e&&e.isObservable}}},75256:(e,t,i)=>{"use strict";i.d(t,{d:()=>ObservableArray,C:()=>r});var n=i(66209),s=i(85861);class ObservableArray extends n.y{constructor(){super(),this.isObservableArray=!0,this.elements=[]}push(e){return this.elements.push(e),this.addChildObservable(e),this.setDirty(),this.length}concat(e){const t=this.elements.length;this.elements=this.elements.concat(e);for(let e=t;e<this.elements.length;e++)this.addChildObservable(this.elements[e]);return this.setDirty(),this.length}replace(e){for(const e of this.elements)this.removeChildObservables(e);return this.elements=[],this.concat(e)}remove(e){if(e<0||e>=this.length)throw new Error(`Index ${e} not in range of ObservableArray`);const[t]=this.elements.splice(e,1);this.removeChildObservables(t),this.setDirty()}update(e,t){const i=this.elements[e];i!==t&&(this.elements[e]=t,this.removeChildObservables(i),this.addChildObservable(t),this.setDirty())}get length(){return this.elements.length}set length(e){if(e<this.elements.length){for(let t=this.elements.length-1;t>=e;t--){const e=this.elements[t];this.removeChildObservables(e)}this.elements.length=e,this.setDirty()}}values(){return[...this.elements]}filter(e){return this.elements.filter(e)}find(e){return this.elements.find(e)}*[Symbol.iterator](){for(const e of this.elements)yield e}map(e){return this.elements.map(e)}forEach(e){this.elements.forEach(e)}get(e){return this.elements[e]}findIndex(e){return this.elements.findIndex(e)}indexOf(e){return this.elements.indexOf(e)}splice(e,t,...i){let n;if(i.length){n=this.elements.splice(e,t,...i);for(const e of i)this.addChildObservable(e)}else n=this.elements.splice(e,t);for(const e of n)this.removeChildObservables(e);return this.setDirty(),n}insert(e,t){if(e>this.elements.length)throw new Error(`Tried to insert at index ${e} in an array that's only ${this.elements.length} long`);e!==this.elements.length?(this.elements.splice(e,0,t),this.addChildObservable(t),this.setDirty()):this.push(t)}shift(){const e=this.elements.shift();return e&&(this.removeChildObservables(e),this.setDirty()),e}move(e,t){if(t>this.elements.length-1)throw Error("Index to move to is out of bounds");const i=this.elements[e];this.elements.splice(e,1),this.elements.splice(t,0,i),this.setDirty()}onElementChanged(e){let t=this.elements.slice();return this.onChanged((()=>{for(const i in t){const n=parseInt(i,10);e.onRemoved&&void 0===this.get(n)&&e.onRemoved(t[n],n)}for(const i in this.elements){const s=parseInt(i,10),r=this.get(s);void 0===t[s]?e.onAdded&&e.onAdded(r,s):(n.y.isObservable(r)&&r._dirtyObservable||r!==t[s])&&(e.onUpdated?e.onUpdated(r,s):e.onRemoved&&null===r&&e.onRemoved(t[s],s))}t=this.elements.slice()}))}deepCopy(){return this.map((e=>(0,s.p$)(e)))}}const r=e=>{const t=new ObservableArray;return e&&t.concat(e),t}},64781:(e,t,i)=>{"use strict";i.d(t,{v:()=>ObservableMap,q:()=>o});var n=i(66209),s=i(85861);function r(e){return(0,s.hj)(e)?""+e:e}class ObservableMap extends n.y{constructor(){super(),this.map={},this._keysSet=new Set,this._keysList=[]}get keys(){return this._keysList.slice()}get values(){return this._keysList.map((e=>this.get(e)))}entries(){const e=[];for(const t in this.map)e.push([t,this.map[t]]);return e}get length(){return this._keysList.length}*[Symbol.iterator](){for(const e of this._keysList)yield this.get(e)}get(e){return this.map[e]}has(e){return void 0!==this.map[e]}set(e,t){e=r(e);this.map[e]!==t&&(this.removeChildObservables(this.map[e]),this.addChildObservable(t),this.map[e]=t,this._keysSet.has(e)||(this._keysList.push(e),this._keysSet.add(e)),this.setDirty())}clear(){if(this.length>0){for(const e in this.map)this.removeChildObservables(this.map[e]);this.map={},this._keysSet.clear(),this._keysList=[],this.setDirty()}}delete(e){e=r(e),this.removeChildObservables(this.map[e]);const t=this.map.hasOwnProperty(e);return delete this.map[e],t&&(this._keysSet.delete(e),this._keysList.splice(this._keysList.indexOf(e),1),this.setDirty()),t}onElementChanged(e){let t=Object.assign({},this.map);return this.onChanged((()=>{for(const i in t)e.onRemoved&&!this.has(i)&&e.onRemoved(t[i],i);for(const i of this._keysList){const s=this.get(i);void 0===t[i]?e.onAdded&&e.onAdded(s,i):(n.y.isObservable(s)&&s._dirtyObservable||s!==t[i])&&(e.onUpdated&&null!==s?e.onUpdated(s,i):e.onRemoved&&null===s&&e.onRemoved(t[i],i))}t=Object.assign({},this.map)}))}deepCopy(){const e={};for(const t of this._keysList)e[t]=(0,s.p$)(this.map[t]);return e}}const o=(e={})=>{const t=new ObservableMap;for(const i in e)t.set(i,e[i]);return t}},23573:(e,t,i)=>{"use strict";i.d(t,{T:()=>ObservableObject});var n=i(66209),s=i(85861),r=i(98828),o=i(88512),a=i(44283);const l=new o.Z("ObservableObject"),c=1===(0,r.h)("debug",0);class ObservableObject extends n.y{constructor(){super(),this._propertyObservables={},this._valueCache={},this._dirtyKeys=new Set,Object.defineProperties(this,{_propertyObservables:{value:this._propertyObservables,writable:!1,enumerable:!1},_valueCache:{value:this._valueCache,writable:!1,enumerable:!1},_dirtyKeys:{value:this._dirtyKeys,writable:!1,enumerable:!1}}),c&&setTimeout((()=>{!function(e){const t={};for(const i in e)e.hasOwnProperty(i)&&(t[i]=e[i],e._valueCache[i]=e[i],Object.defineProperty(e,i,{get:()=>t[i],set:s=>{const r=e._valueCache[i];(r!==s||n.y.isObservable(r)&&r._dirtyObservable)&&d(e,i),t[i]=s},enumerable:!0}))}(this)}),1)}onPropertyChanged(e,t){if(this._propertyObservables[e]||(this._propertyObservables[e]=[]),-1!==this._propertyObservables[e].indexOf(t))throw new Error("This observer function is already observing this Observable, and double subscriptions are not supported.");return(0,a.k1)((()=>this._propertyObservables[e].push(t)),(()=>this.removeOnPropertyChanged(e,t)),!0,e)}removeOnPropertyChanged(e,t){const i=this._propertyObservables[e].indexOf(t);i>=0&&this._propertyObservables[e].splice(i,1)}commit(e=[]){for(const t of e)this._dirtyKeys.add(t);this.setDirtyUp(),this.notifyUp()}setDirtyUp(){for(const e in this){if(!this.hasOwnProperty(e))continue;const t=this._valueCache[e],i=this[e],s=typeof i,r="undefined"===s||"string"===s||"number"===s||"boolean"===s||null===i;if(this._propertyObservables[e]&&!r&&!n.y.isObservable(i))throw new Error(`Property ${e} has property listeners, but has a value that is not observable or a primitive!`);t!==i?(this.removeChildObservables(t),this.addChildObservable(i),this._valueCache[e]=i,this._dirtyKeys.add(e)):n.y.isObservable(t)&&t._dirtyObservable&&this._dirtyKeys.add(e)}super.setDirtyUp()}notifyObservers(){if(this._dirtyObservable&&!this._observerNotifying&&this._activeObservable){this._observerNotifying=!0;for(const e of this._dirtyKeys){for(const t of this._propertyObservables[e]||[])this.notifyPropertyObserver(t,e);c&&u(this,e)}this._observerNotifying=!1,this._dirtyKeys.clear()}super.notifyObservers()}notifyPropertyObserver(e,t){e(this._valueCache[t])}notifyObserver(e){e(this)}deepCopy(){const e={};for(const t in this)this.hasOwnProperty(t)&&(e[t]=(0,s.p$)(this[t]));return e}}const h=new Map;function d(e,t){h.has(e)||h.set(e,{});h.get(e)[t]=Error()}function u(e,t){if(h.has(e)){const i=h.get(e);i[t]&&delete i[t]}}if(c){const e=setInterval((()=>{(function(){for(const e of h.values())for(const t in e)return l.error(`ObservableObject property "${t}" was still dirty after one tick! Did you forget a .commit()?`),l.error("See stack trace of the property write below:"),l.error(e[t].stack),!0;return!1})()&&void 0!==e&&clearInterval(e)}),16)}},11321:(e,t,i)=>{"use strict";i.d(t,{$:()=>l});var n=i(66209),s=i(48715),r=i(85861);function o(e,t){const i=Object.getOwnPropertyNames(t);for(const n of i)void 0===e[n]&&("function"==typeof t[n]?Object.defineProperty(e,n,{value:t[n].bind(e)}):Object.defineProperty(e,n,{value:t[n],writable:!0}));null!==Object.getPrototypeOf(Object.getPrototypeOf(t))&&o(e,Object.getPrototypeOf(t))}var a=i(23573);const l=e=>{if(!e||0===Object.keys(e).length)throw new Error("createObservableProxy() only works on objects that has predefined keys. Did you mean createObservableMap or createObservableArray?");if(e instanceof a.T)throw new Error("Using ObservableProxy on an ObservableObject is a BUG!");if(e.isObservableProxy)return e;const t={},i=new n.y,l=Object.create(e);Object.defineProperties(l,{isObservableProxy:{value:!0},onPropertyChanged:{value:(e,i)=>t[e].onChanged(i)},removeOnPropertyChanged:{value:(e,i)=>t[e].removeOnChanged(i)},deepCopy:{value:()=>(0,r.p$)(e)}}),o(l,i);for(const i in e)if(e.hasOwnProperty(i)){const n=(0,s.Y)(e[i]);t[i]=n,l.addChildObservable(n),Object.defineProperty(l,i,{get:()=>e[i],set:n=>{e[i]=n,t[i].value=n},enumerable:!0})}return Object.seal(l),l}},48715:(e,t,i)=>{"use strict";i.d(t,{f:()=>ObservableValue,Y:()=>r});var n=i(66209),s=i(85861);class ObservableValue extends n.y{constructor(e){super(),this.value=e}notifyObserver(e){e(this.value)}get value(){return this._value}set value(e){this._value!==e&&(this.removeChildObservables(this._value),this.addChildObservable(e),this._value=e,this.setDirty())}deepCopy(){return(0,s.p$)(this._value)}}const r=e=>new ObservableValue(e)},61255:(e,t,i)=>{"use strict";i.d(t,{$:()=>PureObservable});class PureObservable{constructor(){this.observers=new Set}observe(e){this.observers.add(e);const t=this;return{renew(){t.observers.add(e)},cancel(){t.removeObserver(e)}}}removeObserver(e){this.observers.delete(e)}notify(){for(const e of this.observers)e.notify()}}},17490:(e,t,i)=>{"use strict";i.d(t,{V:()=>AggregateSubscription});class AggregateSubscription{constructor(...e){this.subs=e}renew(){for(const e of this.subs)e.renew()}cancel(){for(const e of this.subs)e.cancel()}}},44283:(e,t,i)=>{"use strict";i.d(t,{gm:()=>Catalog,ne:()=>DataCatalog,k1:()=>s});const n=new(i(88512).Z)("Subscription");class Catalog{constructor(e,t,i){this.watchedData=e,this.registerSubscription=t,this.unregisterSubscription=i}createSubscription(e,t){return new Subscription((()=>this.registerSubscription(e)),(()=>this.unregisterSubscription(e)),t)}getData(){return this.watchedData()}}class DataCatalog{constructor(e,t,i){this.watchedData=e,this.registerSubscription=t,this.unregisterSubscription=i}createSubscription(e,t){const i=()=>e(this.watchedData());return new Subscription((()=>this.registerSubscription(i)),(()=>this.unregisterSubscription(i)),t)}getData(){return this.watchedData()}}class Subscription{constructor(e,t,i=!1,n=""){this.startSubscription=e,this.endSubscription=t,this.id=n,this.isSubbed=!1,i&&this.renew()}renew(){this.isSubbed?n.debugWarn(`Duplicate subscription renew ${this.id}`):(this.startSubscription(),this.isSubbed=!0)}cancel(){this.isSubbed&&(this.endSubscription(),this.isSubbed=!1)}get active(){return this.isSubbed}}function s(e,t,i=!0,n=""){return new Subscription(e,t,i,n)}},85861:(e,t,i)=>{"use strict";i.d(t,{p$:()=>s,TS:()=>r,br:()=>o,NK:()=>a,hj:()=>l});const n=e=>"propertyObservers"===e||"changeObservers"===e||"isObservable"===e||"childChangeFunctions"===e||"isObservableProxy"===e||"diffRoot"===e||"elementChangedHandlers"===e||"knownKeysMap"===e||"knownKeysList"===e||"isVector2"===e||"isVector3"===e||"isQuaternion"===e||"onPropertyChanged"===e||"removeOnPropertyChanged"===e||"onChanged"===e||"target"===e,s=(e,t=[])=>{if(void 0!==e){if(e in t)return{};if(e instanceof Date)return new Date(e);if(null===e)return null;if(e.deepCopy)return e.deepCopy();if(e.isQuaternion)return{x:e.x,y:e.y,z:e.z,w:e.w};if("object"==typeof e){const i=Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};for(const r in e){if(n(r))continue;const o=e[r];o instanceof Date?i[r]=new Date(o):"function"!=typeof o&&(i[r]="object"==typeof o?s(o,t.concat(e)):o)}return i}return e}},r=(e,t)=>{for(const i in t){if("function"==typeof t[i])continue;if(n(i)&&!e.hasOwnProperty(i))continue;const o=t[i];if(e.hasOwnProperty(i)){const t=e[i];(null===t?null:typeof t)!==(null===o?null:typeof o)?e[i]=s(o):"object"==typeof t?t instanceof Date?e[i]=new Date(o):r(t,o):e[i]=o}else e[i]=s(o)}},o=(e,t,i=!1)=>{const n={};for(const s in e){const r=e[s],l=t[s];a(r,l)&&(void 0===r||void 0===l||typeof r!=typeof l||"object"!=typeof r?n[s]=l:Array.isArray(l)?a(r,l)&&(n[s]=l):n[s]=i?l:o(r,l))}for(const i in t)i in e||(n[i]=t[i]);return n},a=(e,t)=>{if(null===e||"object"!=typeof e)return e!==t;if(!t)return!0;for(const i in t)if(!(i in e))return!0;for(const i in e)if(a(e[i],t[i]))return!0;return!1};function l(e){return"number"==typeof e}},72067:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});const n={Octree:Symbol("Octree"),Raycaster:Symbol("Raycaster"),Navigation:Symbol("Navigation"),PanoPreload:Symbol("PanoPreload")};const s={load:function(e,t){let s;switch(e){case n.Octree:s=()=>Promise.all([i.e(79),i.e(316)]).then(i.bind(i,74135));break;case n.Raycaster:s=()=>Promise.all([i.e(79),i.e(316)]).then(i.bind(i,15250));break;case n.Navigation:s=()=>Promise.all([i.e(79),i.e(316)]).then(i.bind(i,84715));break;case n.PanoPreload:s=()=>Promise.all([i.e(79),i.e(316)]).then(i.bind(i,90477))}s&&s().then((e=>e.default(t)))},menus:n}},15881:(e,t,i)=>{"use strict";var n;i.d(t,{h:()=>n}),function(e){e.NOTE="note",e.COMMENT="comment",e.MATTERTAG="mattertag"}(n||(n={}))},87068:(e,t,i)=>{"use strict";i.d(t,{I:()=>Color});var n=i(2212);class Color{}Color.MP_BRAND=new n.Color("rgb(255, 49, 88)"),Color.MATTERTAG_BLUE=new n.Color("rgb(3, 104, 125)"),Color.WHITE=new n.Color("rgb(255, 255, 255)"),Color.BLACK=new n.Color("rgb(0, 0, 0)")},48277:(e,t,i)=>{"use strict";var n;i.d(t,{Z:()=>s}),function(e){e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_X=0]="GL_TEXTURE_CUBE_MAP_POSITIVE_X",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_X=1]="GL_TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_Y=2]="GL_TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y=3]="GL_TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_Z=4]="GL_TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z=5]="GL_TEXTURE_CUBE_MAP_NEGATIVE_Z"}(n||(n={}));const s=n},48358:(e,t,i)=>{"use strict";var n;i.d(t,{z:()=>n}),function(e){e[e.boundingSkybox=-100]="boundingSkybox",e[e.default=0]="default",e[e.ghostFloor=3]="ghostFloor",e[e.panoMarker=4]="panoMarker",e[e.reticule=5]="reticule",e[e.grid=5]="grid",e[e.pins360=6]="pins360",e[e.portals=9]="portals",e[e.rotators=10]="rotators",e[e.pins=14]="pins",e[e.pinSelectedHalo=15]="pinSelectedHalo",e[e.lines=20]="lines",e[e.endpoints=21]="endpoints",e[e.labels=22]="labels",e[e.colorOverlay=1e3]="colorOverlay"}(n||(n={}))},44574:(e,t,i)=>{"use strict";var n;i.d(t,{C:()=>n}),function(e){e.TEXT="text",e.LINK="link",e.HASH="hash",e.USER="user"}(n||(n={}))},12216:(e,t,i)=>{"use strict";i.d(t,{f:()=>Vectors,e:()=>n});var n,s=i(2212);class Vectors{}Vectors.UP=new s.Vector3(0,1,0),Vectors.DOWN=new s.Vector3(0,-1,0),Vectors.LEFT=new s.Vector3(-1,0,0),Vectors.RIGHT=new s.Vector3(1,0,0),Vectors.FORWARD=new s.Vector3(0,0,-1),Vectors.BACK=new s.Vector3(0,0,1),Vectors.ZERO=new s.Vector3(0,0,0),Vectors.UNIT=new s.Vector3(1,1,1),Vectors.HORIZONTAL_PLANE=new s.Vector3(1,0,1),function(e){e.NONE="NONE",e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT",e.FORWARD="FORWARD",e.BACK="BACK",e.ZERO="ZERO",e.UNIT="UNIT",e.HORIZONTAL_PLANE="HORIZONTAL_PLANE"}(n||(n={}))},31102:(e,t,i)=>{"use strict";i.d(t,{y:()=>BaseException});var n=i(61645);class BaseException extends Error{constructor(e,t){super(e instanceof Error?e.message:e),this.name="BaseException",t&&(this.code=t),e instanceof Error&&(this.originalError=e,(0,n.Ad)(e)&&(this.isMock=!0))}}},46963:(e,t,i)=>{"use strict";i.d(t,{n:()=>NotImplementedError});var n=i(31102);class NotImplementedError extends n.y{constructor(e="Not implemented"){super(e),this.name="NotImplemented"}}},1030:(e,t,i)=>{"use strict";i.d(t,{Z:()=>OutOfRangeException});var n=i(31102);class OutOfRangeException extends n.y{constructor(e="Out of range"){super(e),this.name="OutOfRangeException"}}},61645:(e,t,i)=>{"use strict";function n(e){return!!(e&&e instanceof Error&&e.code)}function s(e){return!!(e&&e instanceof Error&&e.originalError)}function r(e){return!!(e&&e instanceof Error&&e.isMock)}function o(e){const t=[];let i=e;for(;i;)n(i)&&t.push(i.code),i=s(i)?i.originalError:void 0;return t}i.d(t,{bh:()=>n,Ad:()=>r,UX:()=>o})},99398:(e,t,i)=>{"use strict";i.d(t,{S:()=>n});var n,s,r=i(84933);!function(e){e.sessionObjectExtract=function(e,t){return i=>t(i?i[e]:null)},e.sessionObjectMap=function(e,t,i){return n=>i(n?{[t]:n[e]}:null)},e.sessionCollectionMap=function(e,t){return i=>{if(i){const n={},s=i[e];if(!(s&&s instanceof Array))return t(null);for(const e of s){if(!e.sid){let t;do{t=(0,r.f)(11)}while(s.find((e=>e.sid===t)));e.sid=t}n[e.sid]=e}return t(n)}return t(null)}}}(n||(n={})),function(e){e.sessionObjectMap=function(e,t,i){return(n,s)=>{const r=i(n,s);return r?{[t]:r[e]}:null}}}(s||(s={}))},18630:(e,t,i)=>{"use strict";i.d(t,{j:()=>r,Z:()=>WorkshopSessionStore});var n=i(38330);const s=new(i(88512).Z)("session");var r;!function(e){e.WS3_Config="WS3_Config",e.WS3_Sweeps="WS3_Sweeps",e.WS3_Measurements="WS3_Measurements",e.Blurs="Blurs",e.Model="Model",e.FloorNames="FloorNames",e.Sweeps="Sweeps",e.Highlights="Highlights",e.Labels="Labels",e.Mattertags="Mattertags"}(r||(r={}));class WorkshopSessionStore extends n.yh{constructor(e,t){super(e),this.config=e,this.sessionKey=t}async create(e){throw Error("Not implemented")}async update(e,t){const{serialize:i}=this.config,r=i(e,t);if(!r)return void s.info("not updating",{data:e,diff:t,newData:r});this.config.cachedData||(this.config.cachedData={data:{}}),this.config.cachedData.data||(this.config.cachedData.data={}),this.config.cachedData.data[this.sessionKey]||(this.config.cachedData.data[this.sessionKey]={}),this.config.cachedData.data[this.sessionKey]=r;const o=Object.assign(Object.assign({},this.options),{body:this.config.cachedData.data[this.sessionKey]});return this.config.queue.request(this.config.httpMethod||n.w$.POST,`${this.config.path}/${this.sessionKey}`,o)}async delete(e){this.config.cachedData&&this.config.cachedData.data&&(this.config.cachedData.data[this.sessionKey]={});const t=Object.assign(Object.assign({},this.options),{responseType:""});return this.config.queue.delete(`${this.config.path}/${this.sessionKey}`,t)}}},92540:(e,t,i)=>{"use strict";i.d(t,{w:()=>ModelApiClient});var n=i(53204),s=i(70655),r=i(81707),o=i(80496);var a=i(71918),l=i(88512),c=i(90778),h=i(93863);var d=i(81063),u=i(32848);const p=new l.Z("model-api-client");class ModelApiClient{constructor(e={}){const t=e.baseUrl||window.location.origin,i=e.server||d.fH;this.graphUrl=e.url||`${t}${i}`,p.debug(`Initialized Model API client for ${this.graphUrl}`);const a=(0,n.createHttpLink)({uri:this.graphUrl}),l=(c=(e,{headers:t={}})=>((0,u.m)(this.graphUrl,t),{headers:t}),new r.i0((function(e,t){var i=(0,s._T)(e,[]);return new o.y$((function(n){var s;return Promise.resolve(i).then((function(t){return c(t,e.getContext())})).then(e.setContext).then((function(){s=t(e).subscribe({next:n.next.bind(n),error:n.error.bind(n),complete:n.complete.bind(n)})})).catch(n.error.bind(n)),function(){s&&s.unsubscribe()}}))})));var c;this.apollo=new n.fe({link:l.concat(a),cache:new n.h4})}async query(e,t,i={}){const n=Object.assign(Object.assign({errorPolicy:"all"},i),{query:e,variables:t,fetchPolicy:"no-cache"});return this.apollo.query(n).then((e=>{const{data:t,errors:i}=e;return{data:t,errors:i}})).catch((e=>{throw p.error(e),new h.Zb(e,this.getApolloErrorCode(e))}))}async mutate(e,t,i={}){const n=Object.assign(Object.assign({errorPolicy:"all"},i),{mutation:e,variables:t});return this.apollo.mutate(n).then((e=>{const{data:t,errors:i}=e;return{data:t,errors:i}})).catch((e=>{throw p.error(e),new h.w0(e,this.getApolloErrorCode(e))}))}async upload(e,t,i,n){const s={};let r=0;(0,a.yW)(i,((e,t,i)=>{if(e&&((n=e).filename&&n.blob&&n.blob instanceof Blob)){const n="file"+r++;s[n]=e,i[t]=`multipart:${n}`}var n}));const o=new FormData;for(const[e,t]of Object.entries(s))o.append(e,t.blob,t.filename);o.append("query",(0,c.S)(e)),o.append("operation",t),o.append("variables",JSON.stringify(i));const l=(0,u.m)(this.graphUrl,{});return this.uploadFormData(o,l,n).then((e=>{if(!ModelApiClient.isOk(e)){const t=ModelApiClient.getErrorCode(e)||"54200";throw new h.BR(ModelApiClient.getErrorMessage(e),t)}return e}))}getApolloErrorCode(e){var t;if(e instanceof n.cA){const i=null===(t=e.networkError)||void 0===t?void 0:t.statusCode;if(i)return`61${i}`}return"61000"}async uploadFormData(e,t,i){const n=new XMLHttpRequest;n.open("POST",this.graphUrl,!0),n.responseType="json",n.setRequestHeader("Accept","application/json"),i&&(n.upload.onprogress=i);for(const e in t)n.setRequestHeader(e,t[e]);return new Promise(((t,i)=>{n.onreadystatechange=()=>{4===n.readyState&&(200===n.status?t(n.response):0!==n.status&&i(new h.BR(`${n.status} ${n.statusText}`,`54${n.status}`)))},n.onerror=()=>{i(new h.BR("Network error","54002"))},n.send(e)}))}static isOk(e){return!(null==e?void 0:e.errors)||0===e.errors.length}static getErrorCode({errors:e}){var t;return(null==e?void 0:e.length)&&(null===(t=e[0].extensions)||void 0===t?void 0:t.code)||""}static getErrorMessage({errors:e}){let t="";return Array.isArray(e)&&e[0]&&(t=e[0].message||e[0].toString(),e.length>1&&(t+=` (+${e.length-1})`)),t}}ModelApiClient.version="2020.05.28"},93863:(e,t,i)=>{"use strict";i.d(t,{Zb:()=>MdsReadError,w0:()=>MdsWriteError,BR:()=>MdsUploadError});var n=i(31102);class MdsReadError extends n.y{constructor(e,t="62001"){super(e),this.name="MdsReadError",this.code=t}}class MdsWriteError extends n.y{constructor(e,t="63001"){super(e),this.name="MdsWriteError",this.code=t}}class MdsUploadError extends n.y{constructor(e,t="63002"){super(e),this.name="MdsUploadError",this.code=t}}},85004:(e,t,i)=>{"use strict";var n;i.d(t,{G:()=>n}),function(e){e.UPLOAD="upload",e.EXTERNAL="external"}(n||(n={}))},98649:(e,t,i)=>{"use strict";var n;i.d(t,{L:()=>n}),function(e){e.PHOTO="photo",e.VIDEO="video",e.RICH="rich"}(n||(n={}))},80161:(e,t,i)=>{"use strict";var n;i.d(t,{x:()=>n}),function(e){e.FULL="full",e.VIEWER="viewer",e.PUBLIC="public"}(n||(n={}))},16047:(e,t,i)=>{"use strict";var n;i.d(t,{Y:()=>n}),function(e){e.LEFT="left",e.RIGHT="right",e.AUTO="auto"}(n||(n={}))},936:(e,t,i)=>{"use strict";var n;i.d(t,{b:()=>n}),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(n||(n={}))},34031:(e,t,i)=>{"use strict";var n;i.d(t,{B:()=>n}),function(e){e.PHOTO2D="photo2D",e.EQUIRECTANGULAR="equirectangular"}(n||(n={}))},76875:(e,t,i)=>{"use strict";var n;i.d(t,{w:()=>n}),function(e){e.PANORAMA="panorama",e.FLOORPLAN="floorplan",e.DOLLHOUSE="dollhouse",e.MESH="mesh"}(n||(n={}))},81063:(e,t,i)=>{"use strict";i.d(t,{fH:()=>n,wO:()=>s,AR:()=>r});const n="/api/mp/models/graph",s="/api/mp/attachments/graph",r="features/mds_prefetch"},67838:(e,t,i)=>{"use strict";var n;i.d(t,{K:()=>n}),function(e){e.Segment="segment",e.Logging="logging",e.Matterport="mp"}(n||(n={}))},69669:(e,t,i)=>{"use strict";i.d(t,{H:()=>g});var n=i(8243),s=i(67838),r=i(88512);const o=new r.Z("segment");const a=new r.Z("log-analytics");var l=i(82702),c=i(31879);var h=i(98612),d=i(18654);const u=new r.Z("mp-analytics"),p="ajs_anonymous_id",m="sc_anonymous_id";const g={[s.K.Segment]:{class:class SegmentAnalyticsProvider{constructor(e){this.token=e,this.endpointType=s.K.Segment}init(e,t){return this.options=e,this.context=t,this.token?(window.analytics&&window.analytics.initialize&&(window.analytics=null),window.analytics||(0,n.SegmentBootstrap)(),window.analytics.load(this.token),new Promise(((e,t)=>{window.analytics.ready(e)}))):Promise.resolve()}identify(e){window.analytics.identify(e.id,{first_name:e.firstName,last_name:e.lastName,email:e.email})}track(e,t){r.Z.level>=3&&o.debug(e,t?JSON.stringify(t).replace('\\"','"'):t),t=Object.assign(t||{},this.options);try{window.analytics.track(e,t,this.context)}catch(t){o.error(`Failed to send data to segment for ${e}`)}}trackAsync(e,t){if(t=t||{},navigator.sendBeacon)try{navigator.sendBeacon("https://api.segment.io/v1/t",JSON.stringify({event:e,anonymousId:window.analytics.user().anonymousId(),properties:Object.assign({data:t},this.options),writeKey:this.token,sentAt:Date.now(),type:"track",context:this.context}))}catch(e){o.error("Failed to send async segment request")}}},key:"segment_key",url:null},[s.K.Logging]:{class:class LoggingAnalyticsProvider{init(e,t){return a.debug("logging analytics to console",{options:e,context:t}),Promise.resolve()}identify(e){a.debug("identify as",e)}track(e,t){a.debug({eventName:e,data:t})}trackAsync(e,t){a.debug({eventName:e,data:t})}},key:null,url:null},[s.K.Matterport]:{class:class MatterportAnalyticsProvider{constructor(e,t,i){this.token=e,this.url=t,this.queue=i,this.segmentStylePayload=(e,t,i)=>({timestamp:(0,c.U)(new Date),integrations:{},context:this.segmentStyleContext(i),properties:t,event:e,messageId:(0,l.D)(),anonymousId:this.anonymousId,type:"track",userId:this.user?this.user.id:null,sentAt:(0,c.U)(new Date)}),this.segmentStyleContext=e=>{const t={page:{path:window.location.pathname,referrer:(0,d.an)(),search:window.location.search,title:window.document.title,url:window.location.href},userAgent:navigator.userAgent,library:{name:"showcase",version:"1"},campaign:{}};return Object.assign(Object.assign({},e),t)};const n=(0,h.fp)(m);if(n)this.anonymousId=n;else{const e=function(e,t){const i=new RegExp(e+"=([^;]+)|$").exec(document.cookie);if(!i)return t;const n=i[1];return"boolean"==typeof t?"true"===n||"1"===n:"number"==typeof t?parseFloat(n):n}(p);this.anonymousId=e?e.replace(/%22/g,""):(0,l.D)(),(0,h.m8)(m,this.anonymousId)}this.headers={"X-API-Key":this.token,"Content-Type":"application/json",Accept:"application/json"}}init(e,t){return this.options=e,this.context=t,u.debug("init",{options:this.options,context:this.segmentStyleContext(this.context)}),Promise.resolve()}identify(e){u.debug("identify as",e),this.user=e}track(e,t){r.Z.level>=3&&u.debug(e,t?JSON.stringify(t).replace('\\"','"'):t),t=Object.assign(t||{},this.options);const i=this.segmentStylePayload(e,t,this.context);this.queue.post(this.url,{body:i,headers:this.headers})}trackAsync(e,t){if(t=Object.assign(t||{},this.options),navigator.sendBeacon)try{const i=this.segmentStylePayload(e,t,this.context);navigator.sendBeacon(`${this.url}?api_key=${this.token}`,JSON.stringify(i))}catch(e){u.error("Failed to sendBeacon analytics request")}}},key:"analytics_mp_key",url:"analytics_mp_url"}}},23847:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Analytics:()=>AnalyticsModule,default:()=>o});var n=i(69669),s=i(47724),r=i(10757);class AnalyticsModule extends s.Y{constructor(){super(...arguments),this.name="analytics",this.endpoints=[],this.loaded=!1,this.bufferedData=[],this.track=(e,t)=>this.loaded?(0,r.gw)(0).then((()=>{this.endpoints.forEach((i=>{i.track(e,t)}))})):(this.bufferedData.push({event:e,data:t}),Promise.resolve()),this.trackAsync=(e,t)=>{this.loaded?this.endpoints.forEach((i=>{i.trackAsync(e,t)})):this.bufferedData.push({event:e,data:t})}}async load(e,t,i,s,r){this.loaded=!1;for(const o of e){const{provider:e,token:a,url:l}=o;if(void 0===n.H[e])continue;const c=new(0,n.H[e].class)(a,l,t);await c.init(i,s),r&&r.loggedIn&&c.identify(r),this.endpoints.push(c),this.loaded=!0}return this.loaded&&this.flushBufferedData(),this.loaded}flushBufferedData(){for(const e of this.bufferedData)this.endpoints.forEach((t=>{t.track(e.event,e.data)}));this.bufferedData.length=0}}const o=AnalyticsModule},19980:(e,t,i)=>{"use strict";i.d(t,{A:()=>AnnotationsViewData});var n=i(32770),s=i(48715);class AnnotationsViewData extends n.V{constructor(){super(),this.name="annotations-view-data",this.listIndexObservable=(0,s.Y)(-1),this.searchBlockObservable=(0,s.Y)(null)}setListIndex(e){this.listIndexObservable.value=e}get listIndex(){return this.listIndexObservable.value}onListIndexChanged(e){return this.listIndexObservable.onChanged(e)}setSearchBlock(e){this.searchBlockObservable.value=e}get searchBlock(){return this.searchBlockObservable.value}onSearchBlockChanged(e){return this.searchBlockObservable.onChanged(e)}}},90662:(e,t,i)=>{"use strict";i.d(t,{R:()=>AnnotationSearchCommand,B:()=>CancelAnnotationSearchCommand});var n=i(17386);class AnnotationSearchCommand extends n.m{constructor(e){super(),this.payload={searchBlock:e}}}class CancelAnnotationSearchCommand extends n.m{constructor(){super()}}},28926:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AnnotationSearchCommand:()=>o.R,AnnotationSearchToggledMessage:()=>AnnotationSearchToggledMessage,AnnotationsViewData:()=>r.A,CancelAnnotationSearchCommand:()=>o.B,default:()=>a});var n=i(47724),s=i(91466);class AnnotationSearchToggledMessage extends s.v{constructor(e){super(),this.searching=e}}var r=i(19980),o=i(90662);class AnnotationsModule extends n.Y{constructor(){super(...arguments),this.name="annotations",this.cancelSearch=async()=>{this.viewData.searchBlock&&(this.viewData.setSearchBlock(null),this.engine.broadcast(new AnnotationSearchToggledMessage(!1)))},this.searchAnnotations=async e=>{const t=e.searchBlock;this.viewData.setSearchBlock(t),this.engine.broadcast(new AnnotationSearchToggledMessage(!0))}}async init(e,t){this.viewData=new r.A,this.engine=t,t.market.register(this,r.A,this.viewData),this.bindings.push(t.commandBinder.addBinding(o.R,this.searchAnnotations),t.commandBinder.addBinding(o.B,this.cancelSearch))}dispose(e){this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],this.cancelSearch(),super.dispose(e)}onUpdate(){}}const a=AnnotationsModule},99476:(e,t,i)=>{"use strict";var n;i.d(t,{X:()=>n}),function(e){e.ACCESS_TOKEN_REQUIRED="object.access.token.required",e.FORBIDDEN="spaces.public.access.password.forbidden",e.INVALID_PASSWORD="spaces.public.access.invalid_password",e.TOO_MANY_ATTEMPTS="spaces.public.access.too_many_attempts",e.UNAUTHORIZED="user.unauthorized"}(n||(n={}))},18349:(e,t,i)=>{"use strict";var n;i.d(t,{s:()=>n}),function(e){e.INVALID_CREDENTIALS="invalidcredentials",e.TOO_MANY_ATTEMPTS="toomanyattempts",e.UNKNOWN="unknown"}(n||(n={}))},69759:(e,t,i)=>{"use strict";i.d(t,{L:()=>MpPasswordAuthentication});var n=i(88512),s=i(18349),r=i(99476),o=i(32848);const a=new n.Z("mp-password-authentication");class MpPasswordAuthentication{constructor(e=window.location.origin){this.baseUrl=e,this.errorType=s.s.UNKNOWN}async authenticate(e,t){if(!e.match(/[a-zA-Z0-9]+/))return a.error(`Invalid Model ID ${e}`),!1;const i=`${this.baseUrl}/api/v2/models/${e}/public-access/`;return this.fetchToken(i,t).then((async e=>{let t={};return e&&(t=await e.json(),e.ok&&t.token)?(this.login(t.token),!0):(this.errorType=MpPasswordAuthentication.getErrorType(t.code),this.logout(),!1)}))}isAuthenticated(){return void 0!==MpPasswordAuthentication.token}login(e){MpPasswordAuthentication.token=e}logout(){MpPasswordAuthentication.token=void 0}getAuthorizationHeader(){return MpPasswordAuthentication.token?`Matterport-Object-Access ${MpPasswordAuthentication.token}`:""}async fetchToken(e,t){const i=JSON.stringify({password:t}),n={"Content-Type":"application/json"};return(0,o.m)(e,n),fetch(e,{method:"POST",cache:"no-cache",headers:n,body:i})}static getErrorType(e){switch(e){case r.X.TOO_MANY_ATTEMPTS:return s.s.TOO_MANY_ATTEMPTS;case r.X.INVALID_PASSWORD:return s.s.INVALID_CREDENTIALS}return s.s.UNKNOWN}}},89683:(e,t,i)=>{"use strict";i.d(t,{w:()=>MpSdkAuthentication});class MpSdkAuthentication{static setToken(e){MpSdkAuthentication.token="Bearer "+e}isAuthenticated(){return!!MpSdkAuthentication.token}authenticate(e){return!(!e||"string"!=typeof e)}getAuthorizationHeader(){return MpSdkAuthentication.token?MpSdkAuthentication.token:""}}},34369:(e,t,i)=>{"use strict";var n,s;i.d(t,{SL:()=>n,AB:()=>s,eE:()=>r,Qf:()=>o}),function(e){e.BASE="base",e.STANDARD="standard",e.HIGH="high",e.ULTRAHIGH="ultrahigh"}(n||(n={})),function(e){e[e.BASE=512]="BASE",e[e.STANDARD=1024]="STANDARD",e[e.HIGH=2048]="HIGH",e[e.ULTRAHIGH=4096]="ULTRAHIGH"}(s||(s={}));const r={[n.BASE]:s.BASE,[n.STANDARD]:s.STANDARD,[n.HIGH]:s.HIGH,[n.ULTRAHIGH]:s.ULTRAHIGH},o={[s.BASE]:n.BASE,[s.STANDARD]:n.STANDARD,[s.HIGH]:n.HIGH,[s.ULTRAHIGH]:n.ULTRAHIGH}},44110:(e,t,i)=>{"use strict";i.d(t,{m:()=>o});var n=i(48277),s=i(1030);const r={0:n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y,1:n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z,2:n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X,3:n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z,4:n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X,5:n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y},o=e=>{if(e<0||e>5)throw new s.Z("mapFaceToCubemapFace() -> face must be in the range [0, 5]");return r[e]}},3248:(e,t,i)=>{"use strict";i.d(t,{af:()=>PlayerOptionsData,gx:()=>n});var n,s=i(32770),r=i(23573),o=i(54243),a=i(51058),l=i(3506);class PlayerOptionsData extends s.V{constructor(e={}){super(),this.name="player-options",this.options=new PlayerOptions(e)}resetDefaultTourOptions(){this.options.fast_transitions=l.LI,this.options.transition_speed=l.p$,this.options.transition_time=l.rd,this.options.pan_speed=l.tu,this.options.dollhouse_pan_speed=l.nr,this.options.zoom_duration=l.we,this.options.pan_angle=l.Cj,this.options.pan_direction=l.y6,this.options.commit()}}class PlayerOptions extends r.T{constructor(e){super(),this.presented_by=!1,this.highlight_reel=!0,this.floor_plan=!0,this.tour_buttons=!0,this.labels=!0,this.labels_dh=!0,this.floor_select=!0,this.measurements=!0,this.measurements_saved=!0,this.dollhouse=!0,this.contact_email=!1,this.address=!1,this.contact_name=!1,this.model_summary=!1,this.contact_phone=!1,this.model_name=!1,this.external_url=!1,this.unit_type=a.M.IMPERIAL,this.background_color=o.z.default,this.fast_transitions=l.LI,this.transition_speed=l.p$,this.transition_time=l.rd,this.pan_speed=l.tu,this.dollhouse_pan_speed=l.nr,this.zoom_duration=l.we,this.pan_angle=l.Cj,this.pan_direction=l.y6,e&&this.copy(e)}copy(e){this.presented_by=!!e.presented_by,this.highlight_reel=!!e.highlight_reel,this.floor_plan=!!e.floor_plan,this.tour_buttons=!!e.tour_buttons,this.labels=!!e.labels,this.dollhouse=!!e.dollhouse,this.fast_transitions=!!e.fast_transitions,this.contact_email=!!e.contact_email,this.address=!!e.address,this.contact_name=!!e.contact_name,this.model_summary=!!e.model_summary,this.contact_phone=!!e.contact_phone,this.model_name=!!e.model_name,this.external_url=!!e.external_url,void 0!==e.measurements&&(this.measurements=e.measurements),void 0!==e.labels_dh&&(this.labels_dh=e.labels_dh),void 0!==e.floor_select&&(this.floor_select=e.floor_select),void 0!==e.measurements_saved&&(this.measurements_saved=e.measurements_saved),void 0!==e.unit_type&&(this.unit_type=e.unit_type),void 0!==e.background_color&&void 0!==o.z[e.background_color]&&(this.background_color=e.background_color),void 0!==e.transition_speed&&(this.transition_speed=e.transition_speed),void 0!==e.transition_time&&(this.transition_time=e.transition_time),void 0!==e.pan_speed&&(this.pan_speed=e.pan_speed),void 0!==e.dollhouse_pan_speed&&(this.dollhouse_pan_speed=e.dollhouse_pan_speed),void 0!==e.zoom_duration&&(this.zoom_duration=e.zoom_duration),void 0!==e.pan_angle&&(this.pan_angle=e.pan_angle),void 0!==e.pan_direction&&(this.pan_direction=e.pan_direction)}}!function(e){e.PresentedBy="presented_by",e.HighlightReel="highlight_reel",e.FloorPlan="floor_plan",e.TourButtons="tour_buttons",e.Labels="labels",e.LabelsDollhouse="labels_dh",e.Measurements="measurements",e.FloorSelect="floor_select",e.SavedMeasurements="measurements_saved",e.Dollhouse="dollhouse",e.InstantTransitions="fast_transitions",e.TransitionSpeed="transition_speed",e.TransitionTime="transition_time",e.PanSpeed="pan_speed",e.DollhousePanSpeed="dollhouse_pan_speed",e.ZoomDuration="zoom_duration",e.PanAngle="pan_angle",e.PanDirection="pan_direction",e.Units="unit_type",e.DetailsEmail="contact_email",e.DetailsAddress="address",e.DetailsName="contact_name",e.DetailsSummary="model_summary",e.DetailsPhone="contact_phone",e.DetailsModelName="model_name",e.DetailsExternalUrl="external_url",e.BackgroundColor="background_color"}(n||(n={}))},76463:(e,t,i)=>{"use strict";i.d(t,{Z:()=>SweepTextureLoader});var n=i(2212),s=i(88512),r=i(34369),o=i(10757);const a=new s.Z("api"),l={[r.SL.BASE]:256,[r.SL.STANDARD]:1024,[r.SL.HIGH]:2048,[r.SL.ULTRAHIGH]:4096};class SweepTextureLoader{constructor(e){this.urls=e,this.sweepCubeTextures={}}useTexture(e){const t=this.getTexture(e);if(!t)throw Error(`Texture for sweep ${e} not loaded before using`);return t}loadFace(e,t,i,s){return this.loadFaceImage(e,t,i,s).then((e=>{const t=new n.Texture(e);return t.needsUpdate=!0,t}))}load(e,t=r.SL.STANDARD){const i=this.sweepCubeTextures[e.id];if(i)return a.debug("Skipping load of pano, already loaded"),new Promise((function(e,t){e(i)}));const s=[2,4,0,5,1,3].map((i=>this.loadFaceImage(e,t,i))),o=Promise.all(s).then((t=>{const i=new n.CubeTexture(t);return i.flipY=!1,i.needsUpdate=!0,this.sweepCubeTextures[e.id]=i,i}));return o.catch((()=>{a.error(`Downloading cubemap for pano ${e.id} failed`)})),o}unload(e){const t=this.sweepCubeTextures[e];if(!t)throw Error(`Texture for sweep ${e} not loaded before unloading`);t.dispose(),this.sweepCubeTextures[e]=null}unloadAll(e){const t=(0,o.ow)(e);for(const e of Object.keys(this.sweepCubeTextures))this.sweepCubeTextures[e]&&!t[e]&&this.unload(e)}async loadFaceImage(e,t,i,n){const s=l[t],r=await e.getFaceUrl(t,i);return this.urls.getImageBitmap(r,s,s,n)}getTexture(e){return this.sweepCubeTextures[e]}}},54243:(e,t,i)=>{"use strict";i.d(t,{K:()=>s,z:()=>r});const n={bgPrimary:"#0F1011",bgSecondary:"#1e2023",gridPrimary:"#2d3035",gridSecondary:"#171a1c"},s={black:n,grey:{bgPrimary:"#c9cbcc",bgSecondary:"#9d9d9e",gridPrimary:"#c9cbcc",gridSecondary:"#b0b1b1"},white:{bgPrimary:"#fcfdff",bgSecondary:"#ced0d3",gridPrimary:"#fcfdff",gridSecondary:"#e2e3e5"},default:n};var r;!function(e){e.black="black",e.grey="grey",e.white="white",e.default="black"}(r||(r={}))},68655:(e,t,i)=>{"use strict";i.d(t,{GT:()=>UnauthorizedException,V2:()=>ForbiddenException,TR:()=>NotFoundException});var n=i(31102);class ApiException extends n.y{constructor(e="Api Exception"){super(e),this.name="ApiException"}}class UnauthorizedException extends ApiException{constructor(e="Unauthorized"){super(e),this.name="Unauthorized"}}class ForbiddenException extends ApiException{constructor(e="Forbidden"){super(e),this.name="Forbidden"}}class NotFoundException extends ApiException{constructor(e="Not Found"){super(e),this.name="NotFound"}}},14973:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(28883);async function s(e){return e.get("https://static.matterport.com/geoip/",{responseType:"json",priority:n.RequestPriority.LOW})}},35934:(e,t,i)=>{"use strict";i.d(t,{C:()=>r,P:()=>o});var n=i(43434);let s=null;const r=e=>{s=e},o=(e,t)=>(s&&(0,n.S)(e)&&(t["x-matterport-application-key"]=s),t)},54073:(e,t,i)=>{"use strict";i.d(t,{l:()=>r,I:()=>o});var n=i(43434);let s=null;const r=e=>{s=e},o=(e,t)=>(s&&(0,n.S)(e)&&(t["x-matterport-application-name"]=s),t)},97325:(e,t,i)=>{"use strict";i.d(t,{t:()=>r,X:()=>o});var n=i(43434);let s=null;const r=e=>{s=e},o=(e,t)=>(s&&(0,n.S)(e)&&(t["x-matterport-application-version"]=s),t)},32848:(e,t,i)=>{"use strict";i.d(t,{m:()=>u});var n=i(54073),s=i(97325),r=i(35934),o=i(69759),a=i(98828);class MpModelTokenAuthentication{constructor(){const e=(0,a.h)("auth","");this.authenticate(e)}isAuthenticated(){return!!MpModelTokenAuthentication.token}authenticate(e){return!(!e||"string"!=typeof e)&&(MpModelTokenAuthentication.token=e.replace(","," "),!0)}getAuthorizationHeader(){return MpModelTokenAuthentication.token?MpModelTokenAuthentication.token:""}}var l=i(89683);const c=[new MpModelTokenAuthentication,new l.w,new o.L];var h=i(43434);const d=[(e,t,i=c)=>{const n=i.map((e=>e.getAuthorizationHeader())).find(Boolean);return n&&(0,h.S)(e)&&(t.authorization=n),t},n.I,s.X,r.P],u=(e,t,i=d)=>(i.forEach((i=>i(e,t))),t)},43434:(e,t,i)=>{"use strict";i.d(t,{S:()=>r});const n=["matterport.com","matterportvr.cn","localhost"],s=["/api/"],r=e=>{let t;try{t=new URL(e.toLowerCase())}catch(e){return!1}const{hostname:i,pathname:r}=t,o=n.some((e=>i===e||i.endsWith(`.${e}`))),a=s.some((e=>r.startsWith(e)));return o&&a}},66542:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ApiClient});var n=i(88512),s=i(28883),r=i(99476),o=i(68655);class Organization{constructor(e){this.blurEnabled=!1,e&&Object.assign(this,e)}}var a,l,c=i(14973),h=i(98828);!function(e){e.USER="user",e.ADMIN="admin"}(a||(a={}));class User{constructor(e){this.loggedIn=!1,this.flags=new Set,this.memberships=[],e&&Object.assign(this,e)}getFlags(e=""){if(this.memberships){const e=(0,h.h)("organization","");for(const t of this.memberships)if(""===e||t.organizationId===e)for(const e of t.flags)this.flags.add(e)}const t=new Set;return this.flags.forEach((i=>{if(0===i.indexOf(e)){const n=i.replace(e,"");t.add(n)}})),t}hasFlag(e,t="showcase"){return this.getFlags().has(`${t}/${e}`)}isOrganizationAdmin(e){const t=this.getMembership(e);return!!(null==t?void 0:t.roles.includes(a.ADMIN))}getMembershipFlags(e){const t=this.getMembership(e);return t?t.flags:[]}getMembership(e){return this.memberships.find((t=>t.organizationId===e))}hasMembershipFlag(e,t){return this.getMembershipFlags(e).includes(t)}getMembershipFeature(e,t){const i=this.getMembership(e);return(null==i?void 0:i.features[t])||!1}hasMembership(e){return this.memberships.some((t=>t.organizationId===e))}}class Membership{constructor(e){this.features={},e&&Object.assign(this,e)}}!function(e){function t(e){return e.split(".").reduce(((e,t)=>{const i=parseInt(t,10);return isNaN(i)||e.push(i),e}),[])}function i(e,i){const n=t(e),s=t(i);for(let e=0;e<n.length;e++){if(e>=s.length)return 1;if(n[e]!==s[e])return n[e]>s[e]?1:-1}return s.length>n.length?-1:0}e.parse=t,e.gt=function(e,t){return 1===i(e,t)},e.lt=function(e,t){return-1===i(e,t)},e.eq=function(e,t){return 0===i(e,t)},e.compare=i}(l||(l={}));const d=new n.Z("user.serializers");function u(e,t="3.1.51.7-84-g0dcbe0591"){const i=[];for(let n of e){const e=n.match(/^.*\-(\d+(?:\.\d+)*)$/);if(e&&e[1]){if(n=n.replace(/-(\d+(?:\.\d+)*)$/,""),l.lt(t,e[1])){d.debug(`Dropping feature flag ${n}, version >= ${e[1]} required`);continue}d.debug(`Enabled versioned feature flag ${n}`)}i.push(n)}return i}var p=i(32848),m=i(60771);const g=new n.Z("api"),f=Object.freeze({cacheClearTimeout:6e4});class Api{constructor(e=new s.RequestQueue,t=new s.RequestQueue,i={},n=window.location.origin){this.apiQueue=e,this.storeQueue=t,this.prefetchedData=i,this.baseUrl=n,this._configCache={},this._userCache={},this._organizationCache={},setTimeout((()=>{this.prefetchedData={}}),f.cacheClearTimeout)}async init(e){const t=[this.getUser().then((e=>this.user=e))];e&&t.push(this.getConfigs(e)),await Promise.all(t)}getOnStoreQueue(e,t={}){return this.get(e,t,this.storeQueue)}get(e,t={},i=this.apiQueue){const{headers:n={},prefetchFrom:s}=t;return s&&this.prefetchedData[s]?Promise.resolve(this.prefetchedData[s]):(t.headers=(0,p.m)(e,n),this.apiQueue.get(e,t).then((e=>{if(null===e)throw Error("Data from get was null, possibly unparsable JSON");return e})))}getImage(e,t){return this.getOnStoreQueue(e,Object.assign(Object.assign({},t),{responseType:"image"}))}async getImageBitmap(e,t,i,n={}){if((0,m.OV)()){const s=-1!==e.indexOf("?"),r=e+(s?"&":"?")+"imgopt=1",o=await this.getOnStoreQueue(r,Object.assign(Object.assign({},n),{responseType:"blob"}));return createImageBitmap(o,0,0,t,i,{imageOrientation:n.flipY?"flipY":"none"})}return this.getImage(e,n)}async getConfigs(e,t){if(e=e.toLowerCase(),!t&&this._configCache[e])return this._configCache[e];const i=t?{responseType:"json"}:{responseType:"json",prefetchFrom:"config"};let n={};const s=this.baseUrl+`/api/v1/config/${e}`;try{n=await this.get(s,i)}catch(e){g.warn(`Failed to load config from ${s}, ignoring`)}return t||(this._configCache[e]=n),n||{}}async getAppKey(e,t,i){if(""===e||""===t)return null;const n=await this.getConfigs(e,i);return n.hasOwnProperty(t)?n[t]:null}async getGeoIpLocation(){return(0,c.Z)(this.apiQueue)}async modelIsAccessible(e){var t,i;const n=`${this.baseUrl}/api/mp/models/graph`,s={"Content-Type":"application/graphql"};(0,p.m)(n,s);const r=await fetch(n,{method:"POST",mode:"cors",headers:s,body:`{ model(id: "${e}") { id } }`}),a=await r.json();if((null===(i=null===(t=null==a?void 0:a.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.id)!==e)throw new o.V2("Access denied (403)")}async modelExists(e,t={ignorePrefetch:!1}){if(e.length>20)return Promise.resolve(!0);const{ignorePrefetch:i}=t;if(!i&&this.prefetchedData&&this.prefetchedData.model){const{model:t}=this.prefetchedData;if(!t.sid&&t.has_public_access_password)throw new o.GT("Model requires a password");return t.sid===e}const n=`${this.baseUrl}/api/v2/models/${e}/`,s={"Content-Type":"application/json"};(0,p.m)(n,s);return fetch(n,{method:"GET",headers:s}).then((async e=>{if(e.ok)return!0;const t=await e.json().catch((e=>({})));if(t&&t.code===r.X.ACCESS_TOKEN_REQUIRED)throw new o.GT("Access token required (401)");if(403===e.status)throw new o.V2("Access denied (403)");throw new o.TR("Model not found (404)")}))}async getOrganization(e){if(e in this._organizationCache)return this._organizationCache[e];const t=`${this.baseUrl}/api/v2/organizations/${e}`,i=await this.get(t,{responseType:"json"}).catch((e=>{g.error(e)}));let n=null;return i&&(n=new Organization({id:i.sid,name:i.company_name||"",blurEnabled:!!i.manual_blur})),this._organizationCache[e]=n,n}async getUser(e){if(e&&e in this._userCache)return this._userCache[e];const t=`${this.baseUrl}/api/v2/users/${e||"current"}`,i=function(e){if(!e)return new User;const t=(e.memberships||[]).map((t=>new Membership({userId:e.user_sid,organizationId:t.organization_sid,name:t.name,flags:u(t.flags||[]),roles:t.roles||[],features:t.features||{}})));return new User({id:e.user_sid,firstName:e.first_name,lastName:e.last_name,email:e.email,loggedIn:e.is_authenticated,flags:new Set(u(e.flags)),memberships:t})}(await this.get(t,{responseType:"json"}).catch((e=>{g.error(e)})));return i.id&&(this._userCache[i.id]=i),i}}var v=i(47724);class ApiClient extends v.Y{constructor(){super(...arguments),this.name="api-client"}async init(e,t){this.api=new Api(e.apiQueue,e.storeQueue,e.prefetchedData,e.baseUrl),await this.api.init(e.preloadConfig)}getApi(){return this.api}}},3506:(e,t,i)=>{"use strict";i.d(t,{gj:()=>r,LI:()=>o,p$:()=>a,rd:()=>l,tu:()=>c,nr:()=>h,we:()=>d,Cj:()=>u,y6:()=>p});var n=i(52599),s=i(77037);const r="TransitionType",o=!0,a=s.Mk,l=s.mL,c=s.pn,h=s.su,d=s._c,u=s.BA,p=n.kw.Auto},41596:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>AppContainerResizer});var n=i(47724),s=i(85917),r=i(60771),o=i(31102),a=i(57370),l=i(66157);class AppContainerResizeError extends o.y{}class AppContainerResizer extends n.Y{constructor(){super(...arguments),this.name="container-resizer",this.touchDevice=(0,r.Jm)(),this.timeout=0,this.keyboardFocused=!1,this.handleResize=e=>{this.keyboardFocused||(document.body.style.height=e.h+"px")},this.handleToolChange=e=>{!e.open&&this.keyboardFocused&&this.setKeyboardFocus(!1)},this.handleTextBoxFocus=e=>{this.setKeyboardFocus(e.focused)}}async init(e,t){if(!e.container)throw new AppContainerResizeError;this.appContainer=e.container,this.touchDevice&&(this.bindings.push((0,s.kp)(s.g_.RESIZE,this.handleResize),t.subscribe(a.S,this.handleTextBoxFocus),t.subscribe(l.Oj,this.handleToolChange)),this.handleResize((0,s.iv)()));for(const e of this.bindings)e.renew()}setKeyboardFocus(e){this.keyboardFocused=e,window.clearTimeout(this.timeout),this.keyboardFocused?(document.body.style.height="",this.timeout=window.setTimeout((()=>{document.documentElement.classList.add("keyboard-layout")}),300)):(document.documentElement.classList.remove("keyboard-layout"),this.appContainer.scrollTop=0)}}},57370:(e,t,i)=>{"use strict";i.d(t,{S:()=>TextBoxFocusMessage});var n=i(91466);class TextBoxFocusMessage extends n.v{constructor(e,t){super(),this.textElement=e,this.focused=t}}},86065:(e,t,i)=>{"use strict";i.d(t,{P:()=>Attachment});var n=i(23573),s=i(85004),r=i(74886);class Attachment extends n.T{constructor(e){super(),this.category=s.G.EXTERNAL,this.mediaType=r.DD.IMAGE,this.mimeType="",this.src="",this.height=0,this.width=0,e&&Object.assign(this,e)}copy(e){return this.id=e.id,this.src=e.src,this.url=e.url,this.thumbnailUrl=e.thumbnailUrl,this.height=e.height,this.width=e.width,this.created=e.created,this.category=e.category,this.mediaType=e.mediaType,this.assetId=e.assetId||"",this.assetType=e.assetType,this.filename=e.filename,this.bytes=e.bytes,this.mimeType=e.mimeType||"",this}}},22151:(e,t,i)=>{"use strict";i.d(t,{b:()=>AttachmentsData});var n=i(32770),s=i(64781),r=i(10757),o=i(15881),a=i(86065);class AttachmentsData extends n.V{constructor(){super(),this.name="media-attachments-data",this.mattertagAttachments=(0,s.q)(),this.pendingAttachments=(0,s.q)(),this.removedAttachments=(0,s.q)()}iteratePending(e){for(const t of this.pendingAttachments)e(t)}iterateRemoved(e){for(const t of this.removedAttachments)e(t)}iterateTagAttachments(e){for(const t of this.mattertagAttachments)e(t)}get pendings(){return this.pendingAttachments}get removals(){return this.removedAttachments}get tagAttachments(){return this.mattertagAttachments}getTagAttachment(e){return this.mattertagAttachments.get(e)}getPendingAttachment(e){return this.pendingAttachments.get(e)}getRemovedAttachment(e){return this.removedAttachments.get(e)}addPendingAttachment(e){this.pendingAttachments.set(e.id,e)}getTagAttachments(e){const t=[];return this.iterateTagAttachments((i=>{i.assetType===o.h.MATTERTAG&&i.assetId===e&&t.push(i)})),t}getPendingAttachmentsForAsset(e,t){const i=[];return this.iteratePending((n=>{n.assetType===t&&n.assetId===e&&i.push(n)})),i}getRemovedAttachmentsForAsset(e,t){const i=[];return this.iterateRemoved((n=>{n.assetType===t&&n.assetId===e&&i.push(n)})),i}markAttachmentForDelete(e){const t=new a.P(e);this.removedAttachments.set(t.id,t)}clearRemovedAttachments(){this.removedAttachments.clear()}removePendingAttachment(e){this.pendingAttachments.has(e)&&(this.pendingAttachments.delete(e),this.commit())}clearPendingAttachments(){this.pendingAttachments.clear()}addTagAttachment(e){this.mattertagAttachments.has(e.id)?this.mattertagAttachments.get(e.id).copy(e):this.mattertagAttachments.set(e.id,e)}getTempAttachmentId(){let e=(0,r.O1)(11);for(;this.getPendingAttachment(e)||this.getTagAttachment(e)||this.getRemovedAttachment(e);)e=(0,r.O1)(11);return e}}},96168:(e,t,i)=>{"use strict";i.d(t,{wu:()=>EmbedMediaCommand,st:()=>LoadEmbeddedMediaCommand,It:()=>UploadAttachmentsCommand,AS:()=>AddTagAttachmentCommand,iu:()=>ConfirmAttachmentChangesCommand,Ze:()=>CancelAttachmentChangesCommand,xW:()=>AttachmentViewerCommand,$T:()=>RemoveAttachmentCommand});var n=i(17386);class EmbedMediaCommand extends n.m{constructor(e,t,i){super(),this.id="EMBED_MEDIA",this.payload={assetId:e,assetType:t,src:i}}}class LoadEmbeddedMediaCommand extends n.m{constructor(e){super(),this.id="LOAD_ATTACHMENT_EMBED",this.payload={attachment:e}}}class UploadAttachmentsCommand extends n.m{constructor(e,t,i){super(),this.id="UPLOAD_ATTACHMENTS",this.payload={assetId:e,assetType:t,uploads:i}}}class AddTagAttachmentCommand extends n.m{constructor(e,t,i,n){super(),this.id="ADD_TAG_ATTACHMENT",this.payload={assetId:e,attachmentCategory:t,mediaType:i,src:n}}}class ConfirmAttachmentChangesCommand extends n.m{constructor(e,t,i,n){super(),this.id="CONFIRM_ATTACHMENT_CHANGES",this.payload={assetId:e,assetType:t,prevAssetId:i,prevAssetType:n}}}class CancelAttachmentChangesCommand extends n.m{constructor(){super(...arguments),this.id="CANCEL_ATTACHMENT_CHANGES"}}class AttachmentViewerCommand extends n.m{constructor(e,t,i){super(),this.payload={open:e,attachments:t,attachmentId:i}}}class RemoveAttachmentCommand extends n.m{constructor(e){super(),this.id="REMOVE_ATTACHMENT",this.payload={attachment:e}}}},74886:(e,t,i)=>{"use strict";var n,s,r;i.d(t,{kV:()=>n,_V:()=>s,DD:()=>r}),function(e){e.FILE_TOO_LARGE="oversize",e.EMPTY_FILE="empty",e.OVER_QUOTA="overQuota",e.UPLOAD_FAILED="failed"}(n||(n={})),function(e){e.EMBED_FAIL="embedFail",e.EMBED_SUCCESS="success"}(s||(s={})),function(e){e.IMAGE="image",e.PDF="pdf",e.VIDEO="video",e.RICH="rich",e.ZIP="zip",e.TEXT="text",e.AUDIO="audio",e.MODEL="model",e.APPLICATION="application"}(r||(r={}))},4305:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AddTagAttachmentCommand:()=>_.AS,Attachment:()=>a.P,AttachmentCategory:()=>l.G,AttachmentEmbedStatus:()=>c._V,AttachmentUploadDoneMessage:()=>h.RE,AttachmentUploadError:()=>c.kV,AttachmentUploadProgressMessage:()=>h.Vj,AttachmentViewerCommand:()=>_.xW,AttachmentsData:()=>T.b,AttachmentsStore:()=>AttachmentsStore,CancelAttachmentChangesCommand:()=>_.Ze,CloseAttachmentViewerMessage:()=>h.Rd,ConfirmAttachmentChangesCommand:()=>_.iu,EmbedMediaCommand:()=>_.wu,EmbeddingDoneMessage:()=>h.v8,ExternalAttachmentDeserializer:()=>m.d,ExternalAttachmentSerializer:()=>ExternalAttachmentSerializer,FileAttachmentDeserializer:()=>g.O,FileAttachmentStorage:()=>FileAttachmentStorage,FileUploadDeserializer:()=>FileUploadDeserializer,FileUploadSerializer:()=>FileUploadSerializer,LoadEmbeddedMediaCommand:()=>_.st,MediaType:()=>c.DD,RemoveAttachmentCommand:()=>_.$T,UploadAttachmentsCommand:()=>_.It,ViewAttachmentsMessage:()=>h.O,default:()=>P});var n=i(47724),s=i(88512),r=i(77680),o=i(15881),a=i(86065),l=i(85004),c=i(74886),h=i(28470),d=i(94474),u=i(71918),p=i(62679);class ExternalAttachmentSerializer{constructor(){this.getAttachmentDetails=e=>e.mediaType?{mediaType:(0,p.m)(e.mediaType),srcUrl:e.src,thumbnailUrl:e.src,width:e.width,height:e.height}:null,this.validate=e=>!!e&&void 0!==e.mediaType}serialize(e){const t=this.getAttachmentDetails(e);return t&&this.validate(t)?t:null}}var m=i(45631),g=i(78230),f=i(70129),v=i(98443);const y=new s.Z("AttachmentsStore");class AttachmentsStore extends d.u{constructor(e){super(e),this.embedSerializer=new ExternalAttachmentSerializer,this.embedDeserializer=new m.d,this.fileDeserializer=new g.O}create(e){if(0===e.length)return Promise.resolve(null);const t=e[0].assetId;if(e.find((e=>e.assetId!==t)))throw new Error("Cannot attach to different comments in one request");const i=this.getViewId(),n=[],s=[];return e.forEach((e=>{if(e.category===l.G.EXTERNAL){const t=this.embedSerializer.serialize(e);if(!t)throw y.error("Failure attaching external attachment:",e),new Error("Could not attach External Attachment");n.push(t)}else s.push(e.id)})),this.mutate(f.AddCommentAttachments,{modelId:i,commentId:t,externalAttachments:n,fileAttachments:s}).then((e=>{const t=[],i=(0,u.qw)(e,"data.addCommentAttachments.externalAttachments");if(i&&Array.isArray(i))for(const e of i){const i=this.embedDeserializer.deserialize(e);i&&t.push(i)}const n=(0,u.qw)(e,"data.addCommentAttachments.fileAttachments");if(n&&Array.isArray(n))for(const e of n){const i=this.fileDeserializer.deserialize(e);i&&t.push(i)}return t.reduce(((e,t)=>(e[t.id]=t,e)),{})}))}async delete(e,t){const i=this.getViewId(),n=(0,p.X3)(t);return Promise.all(e.map((e=>this.mutate(v.DeleteExternalAttachment,{modelId:i,attachmentId:e,parentType:n}))))}}var b=i(15585),S=i(31879);const E=new s.Z("file-upload-deserializer");class FileUploadDeserializer{deserialize(e){if(!e||!this.validate(e))return E.debug("Deserialized invalid file attachment data from MDS",e),null;const t=new a.P;return t.id=e.id,t.created=(0,S.p)(e.created),e.mimeType&&(t.mimeType=e.mimeType,t.mediaType=(0,p.id)(e.mimeType)),t.thumbnailUrl=new r.n(e.url||"",(0,S.p)(e.validUntil,null)),t.url=new r.n(e.url||"",(0,S.p)(e.validUntil,null)),t.filename=e.filename||"",t.bytes=e.bytes||0,t.category=l.G.UPLOAD,t.width=e.imageWidth||0,t.height=e.imageHeight||0,t}validate(e){return["id","created","url","filename","mimeType","validUntil"].every((t=>t in e))}}class FileUploadSerializer{constructor(){}serialize(e){return{filename:e.file.name,contents:{filename:e.file.name,blob:e.file}}}}const w=new s.Z("FileAttachmentStorage");class FileAttachmentStorage extends b.U{constructor(e){super(e),this.uploadDeserializer=new FileUploadDeserializer,this.uploadSerializer=new FileUploadSerializer}async create(e,t){const i=b.U.baseViewId,n=this.uploadSerializer.serialize(e);let s;try{s=await this.client.upload(v.UploadFileAttachmentToModel,"UploadFileAttachmentToModel",Object.assign(Object.assign({},n),{modelId:i,organizationId:this.config.organizationId}),t)}catch(t){return w.error(t),"file.upload.quota.exceeded"===t.code?e.error=c.kV.OVER_QUOTA:e.error=c.kV.UPLOAD_FAILED,e.progress=100,e}if(s.errors&&s.errors.length>0)w.error(s.errors),e.error=c.kV.UPLOAD_FAILED;else{const t=(0,u.qw)(s,"data.uploadFileAttachmentToModel")||null;if(t){const i=this.uploadDeserializer.deserialize(t);i?(w.info("upload successful!"),e.attachment=i):(w.error("cannot create attachment"),e.error=c.kV.UPLOAD_FAILED)}else w.error("upload failed!"),e.error=c.kV.UPLOAD_FAILED}return e.progress=100,e}async delete(e){const t=await this.client.mutate(v.DeleteFileAttachment,{id:e});return(0,u.qw)(t,"data.deleteFileAttachment")||!1}}var T=i(22151),_=i(96168),M=i(91735),x=i(75352);function A(e){switch(e){case x.ht.PHOTO:return c.DD.IMAGE;case x.ht.VIDEO:return c.DD.VIDEO;case x.ht.RICH:return c.DD.RICH;default:return}}function O(e){const{height:t,width:i,thumbnail_height:n,thumbnail_width:s,cache_age:o}=e,a=(void 0===t||void 0===i)&&(s&&n),l=e.type===x.ht.PHOTO?e.url:void 0,c=e.thumbnail_url||l,h=o?new Date(Date.now()+1e3*o):null;return{width:a?s:i,height:a?n:t,mediaType:A(e.type),url:new r.n(l||"",h),thumbnailUrl:new r.n(c||"",h)}}class AttachmentsModule extends n.Y{constructor(){super(...arguments),this.name="attachments-module",this.log=new s.Z(this.name),this.loadEmbeddedAttachment=async e=>this.getUpdatedEmbed(e.attachment),this.embedMedia=async e=>{let t,i=null;const n=await this.oEmbedConsumer.getOEmbedData(e.src);return n?(i=new a.P,i.id=this.attachmentsData.getTempAttachmentId(),i.assetType=e.assetType,i.assetId=e.assetId,i.src=e.src,i.category=l.G.EXTERNAL,Object.assign(i,O(n)),this.attachmentsData.addPendingAttachment(i),t=c._V.EMBED_SUCCESS):t=c._V.EMBED_FAIL,this.engine.broadcast(new h.v8(i,t,e.assetId,e.assetType)),i},this.addTagAttachment=async e=>{const{assetId:t,mediaType:i,src:n,attachmentCategory:s}=e,l=new a.P({id:this.attachmentsData.getTempAttachmentId(),created:new Date,assetId:t,mediaType:i,src:n,url:new r.n(n||"",null),thumbnailUrl:new r.n(n||"",null),category:s,assetType:o.h.MATTERTAG});this.attachmentsData.addTagAttachment(l)},this.uploadAttachments=async e=>{const{assetType:t,assetId:i,uploads:n}=e;n.forEach((e=>{this.uploadAttachment(e,i,t).then((e=>{e.attachment&&(e.attachment.assetId=e.assetId,e.attachment.assetType=t,this.attachmentsData.addPendingAttachment(e.attachment)),this.engine.broadcast(new h.RE(e))}))}))},this.onProgress=(e,t)=>{if(!e.lengthComputable)return;const i=Math.floor(e.loaded/e.total*100);this.engine.broadcast(new h.Vj(Object.assign(Object.assign({},t),{progress:i}),t.assetId,t.assetType))},this.removeAttachment=async e=>{const{attachment:t}=e,i=this.attachmentsData,n=i.getPendingAttachment(t.id);n?(n.category===l.G.UPLOAD&&await this.fileAttachmentStorage.delete(t.id),i.removePendingAttachment(t.id)):i.markAttachmentForDelete(t)},this.confirmAttachmentChanges=async e=>{const t=this.attachmentsData,{pendings:i,removals:n}=t,{assetId:s,assetType:r,prevAssetId:o,prevAssetType:a}=e,l=i.length>0||n.length>0;if(i.length>0){const e=o||s,n=a||r;t.iteratePending((t=>{(o||a)&&t.assetId===e&&t.assetType===n&&(t.assetId=s,t.assetType=r)})),await this.attachmentsStore.create(i.values),t.clearPendingAttachments()}return n.length>0&&await this.deleteAttachments(n.values,r),l},this.cancelAttachmentChanges=async()=>{const e=this.attachmentsData,{pendings:t,removals:i}=e;0===t.length&&0===i.length||(e.pendings.values.forEach((e=>{e.category===l.G.UPLOAD&&this.fileAttachmentStorage.delete(e.id)})),e.clearPendingAttachments(),e.clearRemovedAttachments())},this.deleteAttachments=async(e,t)=>{if(0===e.length)return;const i=[],n=[];this.attachmentsData.atomic((()=>{e.forEach((e=>{e.category===l.G.UPLOAD?i.push(e.id):n.push(e.id)}))})),await Promise.all(i.map((e=>this.fileAttachmentStorage.delete(e)))),n.length&&await this.attachmentsStore.delete(n,t)},this.handleAttachmentViewerCommand=async e=>{const{open:t,attachments:i,attachmentId:n}=e;t&&i&&n?this.openAttachmentViewer(i,n):this.closeAttachmentViewer()}}async init(e,t){this.engine=t;const{modelId:i,organizationId:n,apiConfig:s,queue:r}=e;this.attachmentsStore=new AttachmentsStore({readonly:!1,viewId:i}),this.fileAttachmentStorage=new FileAttachmentStorage({readonly:!1,viewId:i,organizationId:n});const o={embedlyKey:s.embedly_key,queue:r,instagramAppId:s.instagram_app_id,instagramClientToken:s.instagram_client_token};this.oEmbedConsumer=new x.a_(o),this.attachmentsData=new T.b,this.bindings.push(t.commandBinder.addBinding(_.It,this.uploadAttachments),t.commandBinder.addBinding(_.wu,this.embedMedia),t.commandBinder.addBinding(_.st,this.loadEmbeddedAttachment),t.commandBinder.addBinding(_.AS,this.addTagAttachment),t.commandBinder.addBinding(_.iu,this.confirmAttachmentChanges),t.commandBinder.addBinding(_.Ze,this.cancelAttachmentChanges),t.commandBinder.addBinding(_.$T,this.removeAttachment),t.commandBinder.addBinding(_.xW,this.handleAttachmentViewerCommand)),t.market.register(this,T.b,this.attachmentsData)}async getUpdatedEmbed(e){if(e.category===l.G.EXTERNAL)try{const t=await this.oEmbedConsumer.getOEmbedData(e.src);return Object.assign(e,O(t)),t}catch(e){this.log.warn(e),this.log.warn("Get embedded media failed")}return null}async uploadAttachment(e,t,i){const n=Object.assign(Object.assign({},e),{attachment:null,assetId:t,assetType:i}),s=e.file.size;return 0===s?(n.error=c.kV.EMPTY_FILE,Promise.resolve(n)):s>M.z6?(n.error=c.kV.FILE_TOO_LARGE,Promise.resolve(n)):this.fileAttachmentStorage.create(n,(e=>this.onProgress(e,n)))}openAttachmentViewer(e,t){this.viewerOpen=!0,this.engine.broadcast(new h.O(e,t))}closeAttachmentViewer(){this.viewerOpen&&(this.viewerOpen=!1,this.engine.broadcast(new h.Rd))}}const P=AttachmentsModule},28470:(e,t,i)=>{"use strict";i.d(t,{O:()=>ViewAttachmentsMessage,Rd:()=>CloseAttachmentViewerMessage,Vj:()=>AttachmentUploadProgressMessage,RE:()=>AttachmentUploadDoneMessage,v8:()=>EmbeddingDoneMessage});var n=i(91466);class ViewAttachmentsMessage extends n.v{constructor(e,t){super(),this.attachments=e,this.attachmentId=t}}class CloseAttachmentViewerMessage extends n.v{}class AttachmentUploadProgressMessage extends n.v{constructor(e,t,i){super(),this.uploadStatus=e,this.assetId=t,this.assetType=i}}class AttachmentUploadDoneMessage extends n.v{constructor(e){super(),this.upload=e}}class EmbeddingDoneMessage extends n.v{constructor(e,t,i,n){super(),this.attachment=e,this.status=t,this.assetId=i,this.assetType=n}}},91735:(e,t,i)=>{"use strict";i.d(t,{yk:()=>n,z6:()=>s,Aw:()=>r,t8:()=>o,m:()=>a,KI:()=>l,fn:()=>c,vH:()=>h,VB:()=>d,RW:()=>u});const n=25,s=524288e3,r=["image/gif","image/png","image/jpeg","image/webp","image/bmp"],o=["image/gif","image/png","image/jpeg","image/webp"],a=140,l=140,c=60,h=60,d=300,u=250},45631:(e,t,i)=>{"use strict";i.d(t,{d:()=>ExternalAttachmentDeserializer});var n=i(88512),s=i(77680),r=i(31879),o=i(62679),a=i(86065),l=i(85004);const c=new n.Z("external-attachment-deserializer");class ExternalAttachmentDeserializer{constructor(){}deserialize(e){if(!e||!this.validate(e))return c.debug("Deserialized invalid external attachment data from MDS",e),null;const t=new a.P;return t.id=e.id,t.created=(0,r.p)(e.created),t.src=e.url||"",t.thumbnailUrl=new s.n(e.thumbnailUrl||"",(0,r.p)(e.validUntil,null)),t.url=new s.n(e.url||"",(0,r.p)(e.validUntil,null)),e.mediaType&&(t.mediaType=(0,o.bY)(e.mediaType)),e.category?t.category=e.category:t.category=l.G.EXTERNAL,e.width&&(t.width=e.width),e.height&&(t.height=e.height),t.assetType=(0,o.xf)(e.parentDetails.type),t.assetId=e.parentDetails.parent.id,t}validate(e){if(!e)return!1;const t=["id","created","modified","mediaType","category","parentDetails"].filter((t=>!(t in e))),i=0===t.length;return i||c.debug("Attachment invalid:",{missingFields:t}),i}}},78230:(e,t,i)=>{"use strict";i.d(t,{O:()=>FileAttachmentDeserializer});var n=i(88512),s=i(31879),r=i(62679),o=i(86065),a=i(85004),l=i(77680);const c=new n.Z("file-attachment-deserializer");class FileAttachmentDeserializer{constructor(){}deserialize(e){if(!e||!this.validate(e))return c.debug("Deserialized invalid file attachment data from MDS",e),null;const t=new o.P;return t.id=e.id,t.created=(0,s.p)(e.created),e.mimeType&&(t.mimeType=e.mimeType,t.mediaType=(0,r.id)(e.mimeType)),t.category=a.G.UPLOAD,t.thumbnailUrl=new l.n(e.url||"",(0,s.p)(e.validUntil,null)),t.url=new l.n(e.url||"",(0,s.p)(e.validUntil,null)),t.filename=e.filename||"",t.bytes=e.bytes||0,t.width=e.imageWidth||0,t.height=e.imageHeight||0,t}validate(e){if(!e)return!1;return["id","created","url","mimeType","filename"].every((t=>t in e))}}},62679:(e,t,i)=>{"use strict";var n;i.d(t,{X3:()=>p,bY:()=>g,VV:()=>v,fy:()=>h,lV:()=>d,Uq:()=>c,m:()=>f,id:()=>m,xf:()=>u}),function(e){e.COMMENT="comment",e.MATTERTAG="mattertag"}(n||(n={}));var s,r=i(15881);!function(e){e.IMAGE="image",e.VIDEO="video",e.RICH="rich",e.ZIP="zip",e.PDF="pdf"}(s||(s={}));var o=i(85004),a=i(74886),l=i(91735);function c(e){return!(e.category!==o.G.UPLOAD||!e.mimeType)&&l.t8.includes(e.mimeType)}function h(e,t){return t?{width:l.VB,height:l.RW}:e?{width:l.fn,height:l.vH}:{width:l.m,height:l.KI}}function d(e){return e.category===o.G.EXTERNAL||!!e.mimeType&&l.Aw.includes(e.mimeType)}function u(e){switch(e){case n.COMMENT:return r.h.COMMENT;case n.MATTERTAG:return r.h.MATTERTAG;default:throw Error(`Unknown parent type ${e}`)}}function p(e){switch(e){case r.h.NOTE:case r.h.COMMENT:return n.COMMENT;case r.h.MATTERTAG:return n.MATTERTAG;default:throw Error(`Unknown asset type ${e}`)}}function m(e){return e.startsWith("image")?a.DD.IMAGE:e.startsWith("video")?a.DD.VIDEO:e.startsWith("audio")?a.DD.AUDIO:e.startsWith("model")?a.DD.MODEL:e.startsWith("text")?a.DD.TEXT:"application/pdf"===e?a.DD.PDF:a.DD.APPLICATION}function g(e){switch(e){case s.IMAGE:return a.DD.IMAGE;case s.PDF:return a.DD.PDF;case s.VIDEO:return a.DD.VIDEO;case s.RICH:return a.DD.RICH;case s.ZIP:return a.DD.ZIP;default:throw Error(`Unknown attachment media type ${e}`)}}function f(e){switch(e){case a.DD.IMAGE:return s.IMAGE;case a.DD.PDF:return s.PDF;case a.DD.VIDEO:return s.VIDEO;case a.DD.RICH:return s.RICH;case a.DD.ZIP:return s.ZIP;default:throw Error(`Unknown media type ${e}`)}}function v(e){if(!e)return"0";const t=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),3),i=["B","kB","MB","GB"][t];return`${Number((e/Math.pow(1e3,t)).toFixed(1))}${i}`}},59088:(e,t,i)=>{"use strict";i.d(t,{M_:()=>CameraData,rw:()=>u});var n=i(63560),s=i(32770),r=i(17131),o=i(2212);const a=(e,t)=>e&&t?e.equals(t):e===t;var l=i(69626),c=i(36371),h=i(23573),d=i(7170);class CameraPoseData extends h.T{constructor(e){super(),this.position=new o.Vector3,this.rotation=new o.Quaternion,this.focalDistance=-1,this.projection=(0,n.AN)(e)}aspect(){return this.projection.elements[5]/this.projection.elements[0]}clone(e=new CameraPoseData(this.aspect())){return e.position.copy(this.position),e.rotation.copy(this.rotation),e.focalDistance=this.focalDistance,e.projection.copy(this.projection),e}isOrtho(){return(0,l.Pp)(this.projection)}fovX(){return 2*Math.atan(1*this.aspect()/this.projection.elements[5])}fovY(){return 2*Math.atan(1/this.projection.elements[5])}}class CameraTransition extends h.T{constructor(){super(...arguments),this.startTime=0,this.duration=0,this.active=!1,this.type=null,this.progress=new r.z(0),this.blackoutProgress=new r.z(0),this.from={position:new o.Vector3,rotation:new o.Quaternion,projection:new c.M},this.to={position:new o.Vector3,rotation:new o.Quaternion,projection:new c.M},this.rotationDelay=0,this.rotationDuration=1,this.matrixDelay=0,this.matrixDuration=1,this.activeInternal=!1,this.promise=null}}const u=(e,t,i=!0)=>{t.position=p(e.position,t.position,i),t.rotation=p(e.rotation,t.rotation,i),t.projection=p(e.projection,t.projection,i),t.focalDistance=e.focalDistance},p=(e,t,i=!0)=>(e&&!t?t=e.clone():e&&t?t.copy(e):i&&(t=void 0),t);class CameraData extends s.V{constructor(e,t){super(),this._width=e,this._height=t,this.name="camera",this._baseProjection=new c.M,this._orthoMatrix=new c.M,this._lastOrthoZoom=1,this._perspectiveMatrix=new c.M,this.pose=new CameraPoseData(e/t),this.transition=new CameraTransition,this.setCameraDimensions(e,t),this._baseFovY=d.Ue*n.oR.fov}setCameraDimensions(e,t){if(void 0===e||void 0===t)return;this._width=e,this._height=t;const i=e/t,s=this.isOrtho()?(0,n.aH)(e,t,t/(2*this.orthoZoom()),this._orthoMatrix):this._perspectiveMatrix.makePerspectiveFov(d.MN*this.fovY(),i,n.oR.near,n.oR.far);if(this.pose.projection.copy(s),this.transition.active&&this.transition.to.projection)if((0,l.Pp)(this.transition.to.projection)){const i=(0,l.S3)(this.transition.to.projection);this.transition.to.projection.copy((0,n.aH)(e,t,t/(2*i)))}else{const e=2*d.MN*Math.atan(1/this.transition.to.projection.elements[5]);this.transition.to.projection.makePerspectiveFov(e,i,n.oR.near,n.oR.far)}this.pose.commit()}setBaseProjection(e){this._baseProjection=e}get width(){return this._width}get height(){return this._height}get baseFovY(){return this._baseFovY}aspect(){return this.pose.aspect()}fovY(){return this.pose.fovY()}fovX(){return this.pose.fovX()}isOrtho(){return this.pose.isOrtho()}baseZoom(){return this.pose.projection.elements[0]/2}defaultZoom(){return(0,l.Pp)(this._baseProjection)?(0,l.S3)(this._baseProjection):this.perspectiveZoom()}zoom(){return this.isOrtho()?this.orthoZoom():this.perspectiveZoom()}orthoZoom(){const e=(0,l.S3)(this.pose.projection);return isNaN(e)?this._lastOrthoZoom:(this._lastOrthoZoom=e,e)}perspectiveZoom(){return this.baseFovY/this.fovY()}copyTransition(e){this.transition.active=e.active,this.transition.activeInternal=e.activeInternal,this.transition.type=e.type,this.transition.startTime=e.startTime,this.transition.duration=e.duration,this.transition.rotationDelay=e.rotationDelay,this.transition.rotationDuration=e.rotationDuration,this.transition.matrixDelay=e.matrixDelay,this.transition.matrixDuration=e.matrixDuration,e.progress&&this.transition.progress.copy(e.progress),e.blackoutProgress&&this.transition.blackoutProgress.copy(e.blackoutProgress),e.from&&u(e.from,this.transition.from),e.to&&u(e.to,this.transition.to),this.transition.promise=e.promise}canTransition(){return!this.transition.active}clone(){const e=new CameraData(this.width,this.height);return e.copy(this),e}copy(e){this.pose.position.copy(e.pose.position),this.pose.rotation.copy(e.pose.rotation),this.pose.focalDistance=e.pose.focalDistance,this.pose.projection.copy(e.pose.projection),this.pose.commit(),this._baseFovY=e.baseFovY,this.copyTransition(e.transition),this.transition.commit(),this._width=e.width,this._height=e.height}shallowIsEqual(e){return this.pose.position.equals(e.pose.position)&&this.pose.rotation.equals(e.pose.rotation)&&this.pose.projection.equals(e.pose.projection)&&this.pose.focalDistance===e.pose.focalDistance&&this.baseFovY===e.baseFovY}isEqual(e){return this.shallowIsEqual(e)&&this.transitionIsEqual(e.transition)}transitionIsEqual(e){return this.transition.active===e.active&&this.transition.type===e.type&&this.transition.progress.equals(e.progress)&&this.transition.blackoutProgress.equals(e.blackoutProgress)&&this.transition.rotationDelay===e.rotationDelay&&this.transition.rotationDuration===e.rotationDuration&&this.transition.matrixDelay===e.matrixDelay&&this.transition.matrixDuration===e.matrixDuration&&this.transition.activeInternal===e.activeInternal&&a(this.transition.from.position,e.from.position)&&a(this.transition.from.rotation,e.from.rotation)&&a(this.transition.from.projection,e.from.projection)&&a(this.transition.to.position,e.to.position)&&a(this.transition.to.rotation,e.to.rotation)&&a(this.transition.to.projection,e.to.projection)&&this.transition.startTime===e.startTime&&this.transition.duration===e.duration}}},63560:(e,t,i)=>{"use strict";i.d(t,{oR:()=>s,AN:()=>r,aH:()=>o});var n=i(36371);const s={fov:75,near:.1,far:3e3},r=(e,t)=>(t||(t=new n.M),t.makePerspectiveFov(s.fov,e,s.near,s.far)),o=(e,t,i=1,r)=>{r||(r=new n.M);const o=e/2,a=t/2,l=r.makeOrthographic(-o,o,a,-a,s.near,s.far);return l.elements[0]*=i,l.elements[5]*=i,l}},77719:(e,t,i)=>{"use strict";i.r(t),i.d(t,{baseTransitionSpeedKey:()=>S,default:()=>CameraModule});var n=i(2212);var s=i(8482),r=i(69626),o=i(67790),a=i(47724),l=i(59088),c=i(91466);class CameraMoveMessage extends c.v{constructor(e,t){super(),this.from=t,this.to=e,this.timestamp=Date.now()}}class BeginCameraMoveMessage extends CameraMoveMessage{}class EndCameraMoveMessage extends CameraMoveMessage{}var h=i(64185),d=i(79437),u=i(10613),p=i(33874),m=i(40168),g=i(27408),f=i(76701),v=i(31278),y=i(17386);class ResetPitchCommand extends y.m{}const b={[v.n.Instant]:{blackoutTime:0,transitionTime:0},[v.n.FadeToBlack]:{blackoutTime:u.Z.camera.transitionBlackoutTime,transitionTime:2*u.Z.camera.transitionBlackoutTime},[v.n.Interpolate]:{blackoutTime:0,transitionTime:u.Z.camera.transitionFadeTime}},S="Transition time";class CameraModule extends a.Y{constructor(){super(...arguments),this.name="camera-data",this.eulerCache=new n.Euler,this.quaternionCache=new n.Quaternion}async init(e,t){this.engine=t,this.market=t.market,this.canvas=await t.market.waitForData(m.W),this.cameraData=new l.M_(this.canvas.width,this.canvas.height),this.market.register(this,l.M_,this.cameraData),this.baseTransitionTime=e.baseTransitionTime||u.Z.camera.baseTransitionTime,t.market.waitForData(p.e).then((e=>{e.onPropertyChanged(S,(e=>{this.baseTransitionTime=e}))})),t.commandBinder.addBinding(ResetPitchCommand,(async()=>this.resetPitch())),this.bindings.push(t.subscribe(o.a,(e=>this.cameraData.setCameraDimensions(e.width,e.height)))),this.transitionSpeed=e.transitionSpeed||u.Z.camera.transitionSpeed}getData(e=!0){return e?Object.freeze(this.cameraData.clone()):this.cameraData}onUpdate(e){}fromPose(){return{position:this.cameraData.pose.position.clone(),rotation:this.cameraData.pose.rotation.clone(),projection:this.cameraData.pose.projection.clone(),focalDistance:this.cameraData.pose.focalDistance}}updateCameraProjection(e){e&&(this.cameraData.pose.projection.copy(e),this.cameraData.pose.commit(),this.broadcastCameraMoved({projection:e}))}updateCameraFocus(e){this.cameraData.pose.focalDistance=e,this.cameraData.pose.commit()}updateCameraRotation(e){e&&(this.cameraData.pose.rotation.copy(e),this.cameraData.pose.commit(),this.broadcastCameraMoved({rotation:e}))}resetPitch(){this.eulerCache.setFromQuaternion(this.cameraData.pose.rotation,"YXZ"),this.eulerCache.x=0,this.eulerCache.z=0,this.quaternionCache.setFromEuler(this.eulerCache),this.updateCameraRotation(this.quaternionCache)}updateCameraPosition(e){e&&(this.cameraData.pose.position.copy(e),this.cameraData.pose.commit(),this.broadcastCameraMoved({position:e}))}broadcastCameraMoved(e){const t=this.fromPose(),i=Object.assign(Object.assign({},t),e);this.engine.broadcast(new CameraMoveMessage(i,t))}updateCameraPose(e){e.position&&this.updateCameraPosition(e.position),e.rotation&&this.updateCameraRotation(e.rotation)}canTransition(){return this.cameraData.canTransition()}moveTo(e){if(!this.canTransition())return h.Q.reject("Cannot move while the camera is already moving");const t=b[e.transitionType],i=e.pose.rotation,n=e.pose.position;let s=e.projection;e.pose.zoom&&(s&&(0,r.Pp)(s)||this.cameraData.isOrtho())&&(s=this.adjustProjectionZoom(s||this.cameraData.pose.projection.clone(),e.pose.zoom));const o=void 0!==e.blackoutTime?e.blackoutTime:t.blackoutTime,a=e.transitionType,l=e.transitionSpeedMultiplier?1/e.transitionSpeedMultiplier:1;let c=a===v.n.Instant?0:e.transitionTime;if(void 0===c)if(e.transitionType===v.n.Interpolate&&n){const e=n.distanceTo(this.cameraData.pose.position);c=this.baseTransitionTime+166*Math.log2(1+e)*this.transitionSpeed*l}else c=t.transitionTime;const d=this.fromPose();this.beginInternalTransition({transitionType:a,transitionTime:c,blackoutTime:o,pose:{position:n,rotation:i},projection:s,easing:e.easing,rotationDelay:e.rotationDelay||0,rotationDuration:e.rotationDuration||1,matrixDelay:e.matrixDelay||0,matrixDuration:e.matrixDuration||1,focalDistance:e.focalDistance||d.focalDistance});const u={position:e.pose.position?e.pose.position.clone():void 0,rotation:e.pose.rotation?e.pose.rotation.clone():void 0,projection:e.projection?e.projection.clone():void 0,focalDistance:e.focalDistance?e.focalDistance:void 0};this.engine.broadcast(new BeginCameraMoveMessage(u,d));const p=this.cameraData.transition.promise;if(!p)throw new Error("Expected promise to have been created.");const m=this.progressInternalTransition.bind(this),y=this.endInternalTransition.bind(this),S=this;return p.notify(0),this.engine.startGenerator((function*(){let t=16;for(t>=S.cameraData.transition.duration&&(p.notify(.5),yield new f.Jj);t<S.cameraData.transition.duration;){m(t,o);const e=(0,g.uZ)(t/S.cameraData.transition.duration,0,1);p.notify(e),yield new f.Jj,t=16+Date.now()-S.cameraData.transition.startTime}y(e.transitionType),S.cameraData.commit(),p.notify(1),p.resolve(),S.engine.broadcast(new EndCameraMoveMessage(u,d))})),p.promise()}async cancelTransition(){return this.cameraData.transition.active?new Promise((e=>{(0,l.rw)(this.cameraData.pose,this.cameraData.transition.to,!1);const t=Date.now()-this.cameraData.transition.startTime;this.cameraData.transition.duration=t,this.cameraData.transition.progress.stop(1),this.cameraData.pose.commit(),this.cameraData.transition.commit();const i=this.cameraData.transition.onPropertyChanged("active",(t=>{t||(i&&i.cancel(),e())}))})):Promise.resolve()}updateTransitionSpeed(e){if(this.cameraData.transition.active){const t=Date.now(),i=t-this.cameraData.transition.startTime,n=i/e,s=this.cameraData.transition.progress,r=(s.duration-i)/e+n;this.cameraData.transition.duration=r,this.cameraData.transition.startTime=t-n,s.modifyAnimation(s.value,s.endValue,r,s.easing,n),this.cameraData.transition.commit()}}beginExternalTransition(){this.cameraData.transition.activeInternal||(this.cameraData.transition.startTime=Date.now(),this.cameraData.transition.active=!0,this.cameraData.transition.promise=new h.Q,this.cameraData.transition.commit())}endExternalTransition(){var e;this.cameraData.transition.activeInternal||(this.cameraData.transition.active=!1,null===(e=this.cameraData.transition.promise)||void 0===e||e.resolve(),this.cameraData.transition.commit())}beginInternalTransition(e){const t=e.transitionTime||0;this.cameraData.transition.startTime=Date.now(),this.cameraData.transition.duration=t,this.cameraData.transition.active=!0,this.cameraData.transition.promise=new h.Q,this.cameraData.transition.activeInternal=!0,this.cameraData.transition.type=e.transitionType,this.cameraData.transition.progress.modifyAnimation(0,1,t,e.easing||d.to),this.cameraData.transition.rotationDelay=e.rotationDelay||0,this.cameraData.transition.rotationDuration=e.rotationDuration||1,this.cameraData.transition.matrixDelay=e.matrixDelay||0,this.cameraData.transition.matrixDuration=e.matrixDuration||1,e.transitionType===v.n.FadeToBlack&&this.cameraData.transition.blackoutProgress.modifyAnimation(0,1,e.blackoutTime),this.cameraData.transition.from.position=this.cameraData.pose.position.clone(),this.cameraData.transition.from.rotation=this.cameraData.pose.rotation.clone(),this.cameraData.transition.from.projection=this.cameraData.pose.projection.clone(),this.cameraData.transition.from.focalDistance=this.cameraData.pose.focalDistance,this.cameraData.transition.to.position=e.pose.position?e.pose.position.clone():void 0,this.cameraData.transition.to.rotation=e.pose.rotation?e.pose.rotation.clone():void 0,this.cameraData.transition.to.projection=e.projection?e.projection.clone():void 0,this.cameraData.transition.to.focalDistance=e.focalDistance?e.focalDistance:void 0,this.cameraData.transition.commit()}progressInternalTransition(e,t){if(this.cameraData.transition.active){if(this.cameraData.transition.progress.updateAbsolute(e),this.cameraData.transition.type===v.n.Interpolate){const e=this.cameraData.transition.from,t=this.cameraData.transition.to;if(t.position&&e.position&&this.cameraData.pose.position.copy(e.position).lerp(t.position,this.cameraData.transition.progress.value),t.focalDistance&&e.focalDistance&&(this.cameraData.pose.focalDistance=(0,s.t)(e.focalDistance,t.focalDistance,this.cameraData.transition.progress.value)),t.rotation&&e.rotation){const i=(0,d.e3)(this.cameraData.transition.progress.easing,this.cameraData.transition.progress.value,this.cameraData.transition.progress.elapsed,this.cameraData.transition.progress.duration*this.cameraData.transition.rotationDuration,this.cameraData.transition.rotationDelay);this.cameraData.pose.rotation.copy(e.rotation).slerp(t.rotation,i)}if(t.projection&&e.projection){const i=(0,d.e3)(d.w2,this.cameraData.transition.progress.value,this.cameraData.transition.progress.elapsed,this.cameraData.transition.progress.duration*this.cameraData.transition.matrixDuration,this.cameraData.transition.matrixDelay);!function(e,t,i,n){const s=n.elements,r=e.elements,o=t.elements;for(let e=0;e<16;e++)s[e]=r[e]*(1-i)+o[e]*i}(e.projection,t.projection,i,this.cameraData.pose.projection)}}else if(this.cameraData.transition.type===v.n.FadeToBlack){let i=0;const n=this.cameraData.transition.duration;e<=t?i=e:((0,l.rw)(this.cameraData.transition.to,this.cameraData.pose,!1),i=e>=n-t?n-e:t),this.cameraData.transition.blackoutProgress.updateAbsolute(i),this.cameraData.transition.progress.updateAbsolute(e<=t?0:n)}this.cameraData.pose.commit(),this.cameraData.transition.commit()}}endInternalTransition(e){(0,l.rw)(this.cameraData.transition.to,this.cameraData.pose,!1),this.cameraData.transition.type=null,this.cameraData.transition.active=!1,this.cameraData.transition.activeInternal=!1,this.cameraData.transition.progress.stop(1),e===v.n.FadeToBlack&&this.cameraData.transition.blackoutProgress.stop(0),this.cameraData.pose.commit(),this.cameraData.transition.commit()}adjustProjectionZoom(e,t){const i=1/t;return e.elements[0]=i/this.canvas.aspectRatio,e.elements[5]=i,e}setBaseProjection(e){this.cameraData.setBaseProjection(e)}}},31278:(e,t,i)=>{"use strict";var n;i.d(t,{n:()=>n}),function(e){e[e.Instant=0]="Instant",e[e.FadeToBlack=1]="FadeToBlack",e[e.Interpolate=2]="Interpolate"}(n||(n={}))},10613:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o,y:()=>a});var n=i(26059),s=i(31278),r=i(98828);const o=Object.freeze({camera:{transitionBlackoutTime:300,transitionFadeTime:800,baseTransitionTime:r.h("btt",200),transitionSpeed:r.h("tsp",3)}}),a={[n.s.Desktop]:s.n.Interpolate,[n.s.Mobile]:s.n.Interpolate,[n.s.VrOrientOnly]:s.n.FadeToBlack,[n.s.VrWithController]:s.n.FadeToBlack,[n.s.VrWithTrackedController]:s.n.FadeToBlack}},27687:(e,t,i)=>{"use strict";i.d(t,{q9:()=>r,bD:()=>o,D_:()=>a,z5:()=>c,st:()=>h,Kh:()=>d,fi:()=>u});var n=i(2212),s=i(12216);const r=(()=>{const e=new n.Matrix4,t=new n.Matrix4;return(i,s,r,o)=>(r=r||new n.Vector2,o=o||new n.Vector3,l(i.pose,t),e.copy(t),e.invert(),o.set(s.x,s.y,s.z).applyMatrix4(e).applyMatrix4(i.pose.projection.asThreeMatrix4()),u(i.width,i.height,o,r),{screenPosition:r,ndcPosition:o})})(),o=(()=>{const e=new n.Vector3,t=new n.Vector2;return(i,n,s,r,o,l)=>(e.copy(a(i,n,s,l)),u(r,o,e,t),t)})(),a=(()=>{const e=new n.Matrix4,t=new n.Matrix4,i=new n.Vector3;return(n,r,o,a)=>(e.compose(r,o,s.f.UNIT),t.copy(e),t.invert(),i.copy(n).applyMatrix4(t).applyMatrix4(a),i)})(),l=(e,t)=>(t=t||new n.Matrix4).compose(e.position,e.rotation,s.f.UNIT),c=(e,t,i,s,r)=>((r=r||new n.Vector2).x=e/i*2-1,r.y=-t/s*2+1,r),h=(e,t,i=.5,s)=>((s=s||new n.Vector3).x=t.x,s.y=t.y,s.z=i,d(e.pose,s)),d=(()=>{const e=new n.Matrix4,t=new n.Matrix4;return(i,s,r)=>((r=r||new n.Vector3).copy(s),t.copy(i.projection.asThreeMatrix4()),t.invert(),l(i,e),r.applyMatrix4(t).applyMatrix4(e))})(),u=(e,t,i,s)=>((s=s||new n.Vector2).set((i.x+1)*e/2,(1-i.y)*t/2),s)},18469:(e,t,i)=>{"use strict";i.d(t,{O:()=>CameraStartData,B:()=>CameraStartPose});var n=i(94329),s=i(32770);class CameraStartData extends s.V{constructor(e,t,i){super(),this.name="cam-start",this.icon=e,this.thumb=t,this.modified=new Date(0),this.pose=new CameraStartPose,i&&this.pose.copy(i)}copy(e){return this.icon=e.icon,this.thumb=e.thumb,this.modified=e.modified||new Date,this.pose.copy(e.pose),this}get hasCameraPose(){return this.pose&&this.pose.camera&&void 0!==this.pose.camera.position}}class CameraStartPose{constructor(e=n.Ey.Panorama,t,i,s,r,o){this.mode=e,this.camera={position:t||void 0,rotation:i||void 0,zoom:s||void 0},this.pano=r||{uuid:void 0},this.floorVisibility=o||void 0}copy(e){return this.camera.position=r(e.camera.position,this.camera.position),this.camera.rotation=r(e.camera.rotation,this.camera.rotation),this.camera.zoom=e.camera.zoom,this.pano.uuid=e.pano.uuid?e.pano.uuid.slice():void 0,this.mode=e.mode,this.floorVisibility=e.floorVisibility?e.floorVisibility.slice():void 0,this}}const r=(e,t)=>e&&t?t.copy(e):e&&!t?e.clone():void 0},73272:(e,t,i)=>{"use strict";i.d(t,{K:()=>NavigationUrl});var n=i(2212),s=i(94329),r=i(60771),o=i(88512),a=i(19674),l=i(44382);const c=new o.Z("navurl");class InvalidViewmodeError extends Error{constructor(e,t){super(`view mode ${e} is invalid${t?` when ${t}`:""}`)}}class NavigationUrl{static encodeVector3(e,t=2){const{x:i,y:n,z:s}=e;return NavigationUrl.packFloats([i,n,s],t)}static decodeVector3(e){const t=NavigationUrl.unpackFloats(e,3);return t?new n.Vector3(...t):null}static encodeQuaternion(e,t=2){return NavigationUrl.packFloats([e.x,e.y,e.z,e.w],t)}static decodeQuaternion(e){const t=NavigationUrl.unpackFloats(e,4);return t&&!(0,l.mB)(t)?new n.Quaternion(...t):null}static encodeEuler(e,t=2){return NavigationUrl.packFloats([e.x,e.y,e.z],t)}static decodeEuler(e){const t=NavigationUrl.unpackFloats(e,3);return t?new n.Euler(t[0],t[1],t[2],"XYZ"):void 0}static packFloats(e,t=2){let i=e.map((e=>{const i=parseFloat(e.toFixed(t)).toString().replace(/^(\-)?0+.(\d+)/,"$1.$2");return"0"===i?"":i})).join(",");return i=i.replace(/,+$/,""),i}static unpackFloats(e,t=0){const i=e.split(",").map((e=>""===e?0:parseFloat(e)));if(!i||i.includes(NaN))return[];for(;i.length<t;)i.push(0);return i}static getQueryString(e,t=!0){const i=NavigationUrl.serialize(e,t);return Object.keys(i).map((e=>e+"="+i[e])).join("&")}static serialize(e,t=!0){const i=NavigationUrl.removeNavigationKeys(r.AO());try{if(t){const t=NavigationUrl.getShortPose(e);Object.assign(i,t)}else{const t=NavigationUrl.getStartPose(e),n=encodeURIComponent(JSON.stringify(t));Object.assign(i,{start:n})}}catch(e){c.debug(e)}return i}static deserialize(e){const t=r.AO(e);try{return"start"in t?NavigationUrl.parseStartObject(t.start):NavigationUrl.parseShortUrl(t)}catch(e){c.debug(e)}return null}static removeNavigationKeys(e){const t=Object.assign({},e);for(const e of["start","sm","sp","sq","sr","ss","sf","sz"])delete t[e];return t}static parseShortUrl(e){const{sm:t,sp:i,sq:r,sr:o,ss:l,sf:h,sz:d}=e,u=NavigationUrl.parseViewmode(t),p=NavigationUrl.decodeEuler(o||"")||new n.Euler(0,0,0),m=NavigationUrl.decodeQuaternion(r||"")||new n.Quaternion(0,0,0,1),g=i?NavigationUrl.decodeVector3(i):void 0,f=l?parseInt(l,10)-1:void 0,v=h?NavigationUrl.unpackFloats(h,4):void 0,y=d?parseFloat(d):void 0;if(u===s.Ey.Panorama&&void 0===f)throw new InvalidViewmodeError(u,"sweep index not defined");if(u!==s.Ey.Panorama&&!g)throw new InvalidViewmodeError(u,"position is falsy");let b=r?m:(new n.Quaternion).setFromEuler(p);u===s.Ey.Panorama&&(b=(0,a.Z)(b));const S={mode:u,quaternion:b,position:g||void 0,sweepIndex:f,floorVisibility:v,zoom:y};return c.debug("Parsed short URL pose data:",S),S}static parseStartObject(e){const t=JSON.parse(decodeURIComponent(e));if(!t.camera_quaternion)throw Error("Start override is missing camera_quaternion");if(!t.camera_position)throw Error("Start override is missing camera_position");const i=NavigationUrl.parseViewmode(t.camera_mode),s=(new n.Quaternion).copy(t.camera_quaternion),r={mode:i,panoId:t.scan_id,position:(new n.Vector3).copy(t.camera_position),quaternion:s,zoom:t.ortho_zoom,floorVisibility:t.floor_visibility};return c.debug("Parsed &start URL pose data:",r),r}static getShortPose({cameraData:e,viewmodeData:t,floorsViewData:i,sweepData:r}){const o=(new n.Euler).setFromQuaternion(e.pose.rotation,"XYZ"),a=r.currentSweepIndex,l={};if(t.currentMode===s.Ey.Panorama)o.z=0,l.sr=NavigationUrl.encodeEuler(o),void 0!==a&&(l.ss=a+1);else{l.sm=NavigationUrl.validateViewmode(t.currentMode),l.sr=NavigationUrl.encodeEuler(o),l.sp=NavigationUrl.encodeVector3(e.pose.position);const n=i.getFloorsVisibility();n.length&&i.totalFloors>1&&(l.sf=n)}return t.currentMode===s.Ey.Floorplan&&(l.sz=parseFloat(e.zoom().toFixed(2))),l.sq=NavigationUrl.encodeQuaternion(e.pose.rotation),c.debug(`Short URL params for current location ${JSON.stringify(l)}`),delete l.sq,l}static getStartPose({cameraData:e,viewmodeData:t,floorsViewData:i,sweepData:n}){const r={x:0,y:0,z:0,w:1};r.x=e.pose.rotation.x,r.y=e.pose.rotation.y,r.z=e.pose.rotation.z,r.w=e.pose.rotation.w;const o={x:0,y:0,z:0};o.x=e.pose.position.x,o.y=e.pose.position.y,o.z=e.pose.position.z;const a={camera_mode:NavigationUrl.validateViewmode(t.currentMode),camera_position:o,camera_quaternion:r};return t.currentMode===s.Ey.Panorama?a.scan_id=n.currentSweep:a.floor_visibility=i.getFloorsVisibility(),t.currentMode===s.Ey.Floorplan&&(a.ortho_zoom=e.zoom()),a}static parseViewmode(e){let t=NavigationUrl.DEFAULT_VIEW_MODE;return void 0!==e&&(t=parseInt(e,10)),NavigationUrl.validateViewmode(t)}static validateViewmode(e){if(null===e||!NavigationUrl.VALID_URL_VIEW_MODES.includes(e))throw new InvalidViewmodeError(e);return e}}NavigationUrl.DEFAULT_VIEW_MODE=s.Ey.Panorama,NavigationUrl.VALID_URL_VIEW_MODES=[s.Ey.Panorama,s.Ey.Dollhouse,s.Ey.Floorplan,s.Ey.Outdoor]},56365:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CameraStartModule});var n=i(79956),s=i(18469),r=i(47724),o=i(73272),a=i(94329),l=i(91466);class StartLocationSetMessage extends l.v{constructor(e){super(),this.is360=e}}var c=i(88512),h=i(75892),d=i(19674),u=i(26587),p=i(38420),m=i(50988),g=i(94474),f=i(12935);class MdsCameraStartPatchSerializer{serialize(e){return{image:e.sid}}}var v=i(91985);const y=new c.Z("mds-camera-start-store");class MdsCameraStartStore extends g.u{constructor(){super(...arguments),this.deserializer=new f.f,this.serializer=new MdsCameraStartPatchSerializer}async update(e){const t=this.getViewId(),i=this.serializer.serialize(e);if(0===Object.keys(i).length)throw new Error("No data to update?");return this.mutate(v.PatchModel,{modelId:t,patch:i}).then((e=>{y.debug(e)}))}}var b=i(17386);class SetCameraStartCommand extends b.m{constructor(e){super(),this.payload={snapshotSid:e}}}SetCameraStartCommand.id="SET_CAMERA_START";var S=i(80121),E=i(38330),w=i(31879),T=i(77680);const _=e=>{if(!e)return null;const t=new s.O;if(!e.icon)return null;t.modified=(0,w.p)(e&&e.modified),t.icon=e.icon||void 0,t.pose={};const i=250,n=Math.ceil(140.625),r=e.image?`${e.image}&width=${i}&height=${n}&fit=crop&imgopt=1`:void 0;return t.thumb=r?new T.n(r,null):void 0,t},M=(e,t)=>{const i=t&&"icon"in t?t:e;return{modified:(0,w.U)(i.modified),icon:i.icon}};var x=i(18630),A=i(99398);var O=i(66097),P=i(14063);class MarketMonitor{constructor(e,t){this.hasChanges=!1,this.changedHandlers=[],e.waitForData(t).then((e=>{this.target=e,e.onChanged((()=>{this.hasChanges=!0,this.triggerChangeHandlers(this.target)}))}))}hasDiffRecord(){return this.hasChanges}getDiffRecord(){return this.target}clearDiffRecord(){this.hasChanges=!1}commitChanges(){this.triggerChangeHandlers(this.getDiffRecord())}onChanged(e){this.changedHandlers.push(e)}removeOnChanged(e){(0,P.b)(this.changedHandlers,e)}triggerChangeHandlers(e){if(this.changedHandlers.length>0)for(const t of this.changedHandlers)t(e)}}var D=i(8445);const C=new c.Z("camera-start");class CameraStartModule extends r.Y{constructor(){super(...arguments),this.name="camera-start",this.store=null}async init(e,t){var i;this.engine=t,[this.storage,this.sweepData,this.modelData,this.snapshotsData]=await Promise.all([t.getModule(u.F),t.market.waitForData(h.Z),t.market.waitForData(D.T),t.market.waitForData(n.P)]),this.store=this.getStore(e);let r=this.modelData.model.image;if(!e.readonly&&this.store instanceof O.N){const e=await this.store.read();e&&e.icon&&(r=e.icon)}const a=o.K.deserialize();if(a){const e=this.parseNavigationPose(a);this.validStartPano(e)?(this.startingPose=new s.B,this.startingPose.copy(e),C.debug("Starting Camera Pose",this.startingPose)):C.error("Invalid start pose",e)}this.bindings.push(this.engine.commandBinder.addBinding(SetCameraStartCommand,(async e=>this.updateStartLocationFromSnapshot(e.snapshotSid))),this.storage.onSave((()=>this.save()),{dataType:p.g.START_LOCATION}),this.storage.onRevert((()=>this.revert()),{dataType:p.g.START_LOCATION}));const l=r||void 0,c=this.getIconThumbnail(l),d=this.getIconStartPose(l)||this.getStartFallback();if(null===(i=null==d?void 0:d.pano)||void 0===i?void 0:i.uuid){const e=this.sweepData.getSweep(d.pano.uuid);e&&!e.enabled&&(C.warn(`Enabled hidden start sweep ${d.pano.uuid}`),e.enabled=!0,e.commit())}this.data=new s.O(l,c,d),t.market.register(this,s.O,this.data)}getStore(e){const{modelId:t,baseUrl:i,readonly:n,storageProvider:r,queue:o}=e;if(C.info(`Loading camera start from ${r}`),r===p.Xq.MDS)return new MdsCameraStartStore({readonly:n});const a=function(e){const{modelId:t,readonly:i}=e,n=e.baseUrl||"",s=e.queue,r={data:null},o=`${n}/api/v1/player/models/${t}`;if(i){const e=new E.gh({queue:s,path:o,deserialize:_,cachedData:r});return new S.nM({publishStores:[e]})}const a=new E.yh({queue:s,path:o,httpMethod:E.w$.PATCH,deserialize:_,serialize:M}),l=`${n}/api/v1/jsonstore/model/workshopSession/${t}`,c=new x.Z({queue:s,path:l,cachedData:{data:null},httpMethod:E.w$.PATCH,deserialize:A.S.sessionObjectExtract(x.j.Model,_),serialize:M},x.j.Model);return new S.nM({publishStores:[a],editStore:c,editStoreKey:S.aw.START_LOCATION})}({modelId:t,baseUrl:i,readonly:n,queue:o});if(!n){const e=new MarketMonitor(this.engine.market,s.O);a.addMonitor(e)}return new O.N(a,{dataType:p.g.START_LOCATION,readonly:n,engine:this.engine})}getStartingPose(){return this.startingPose||this.data.pose}parseNavigationPose(e){const{mode:t,quaternion:i,position:n,floorVisibility:s,sweepIndex:r,zoom:o}=e;let{panoId:a}=e;if(a&&!this.sweepData.containsSweep(a)){const e=this.sweepData.getSweepByUuid(a);e&&(a=e.id)}if(!a&&void 0!==r){const e=this.sweepData.getSweepByIndex(r);e?a=e.id:C.debug(`Failed to load sweep index ${r}`)}return{mode:t,camera:{position:n,rotation:i,zoom:o},pano:{uuid:a},floorVisibility:s}}async updateStartLocationFromSnapshot(e){const t=this.snapshotsData.get(e),i=this.buildCameraStart(t),n=new s.O(t.sid,t.thumbnailUrl,i);this.data.copy(n),this.data.commit(),this.engine.broadcast(new StartLocationSetMessage(t.is360)),await this.engine.commandBinder.issueCommand(new m.VQ({dataTypes:[p.g.START_LOCATION]}))}async save(){const e=this.data.icon;if(!e||!this.store)return void C.warn("Unable to save start location");if(this.store instanceof O.N)return;const t=this.snapshotsData.get(e);return this.store.update(t)}async revert(){if(this.store instanceof O.N)return this.store.revert()}buildCameraStart(e){const t={mode:e.metadata.cameraMode,camera:{position:e.metadata.cameraPosition,rotation:e.metadata.cameraQuaternion,zoom:e.metadata.orthoZoom},pano:{}};return t.mode===a.Ey.Panorama&&(t.pano={uuid:e.metadata.scanId}),t.floorVisibility=e.metadata.floorVisibility,t}defaultCameraStart(e){return{mode:a.Ey.Panorama,camera:{position:e.position,rotation:(0,d.Z)(e.rotation),zoom:0},pano:{uuid:e.id}}}validStartPano(e){return!!e&&(e.mode!==a.Ey.Panorama||!!e.pano.uuid&&this.sweepData.containsSweep(e.pano.uuid))}getStartFallback(){const e=this.sweepData.getFirstAlignedSweep()||this.sweepData.getFirstSweep();if(void 0!==e)return this.defaultCameraStart(e)}getIconStartPose(e){let t=null;return e&&e in this.snapshotsData.collection&&(t=(new s.B).copy(this.buildCameraStart(this.snapshotsData.get(e)))),this.validStartPano(t)||(t=null),t}getIconThumbnail(e){if(e&&e in this.snapshotsData.collection)return this.snapshotsData.get(e).thumbnailUrl}}},37554:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CanvasExtModule});var n=i(51198),s=i(67790),r=i(47724),o=i(40168),a=i(8430),l=i(46228),c=i(2782);class CanvasExtModule extends r.Y{constructor(){super(...arguments),this.name="canvas-ext"}async init(e,t){this._canvas=e.canvas,this.msgBus=t.msgBus,this.canvasBounds=this._canvas.getBoundingClientRect(),this.bindings.push(t.commandBinder.addBinding(a.M,(async function(){})),t.commandBinder.addBinding(l.L,(async function(){})),t.commandBinder.addBinding(c.n,(async function(){}))),this.data=new o.W(this.canvasBounds.width,this.canvasBounds.height),t.market.register(this,o.W,this.data)}get element(){return this._canvas}get width(){return this.canvasBounds.width}get height(){return this.canvasBounds.height}get x(){return this.canvasBounds.left}get y(){return this.canvasBounds.top}onUpdate(){this.canvasBounds=this._canvas.getBoundingClientRect();const e=this.data.width!==this.width||this.data.height!==this.height,t=this.data.x!==this.x||this.data.y!==this.y;e&&(this.data.width=this.width,this.data.height=this.height,this.data.commit(),this.msgBus.broadcast(new s.a(this.width,this.height))),t&&(this.data.x=this.x,this.data.y=this.y,this.data.commit(),this.msgBus.broadcast(new n.k(this.x,this.y)))}}},36016:(e,t,i)=>{"use strict";i.d(t,{lb:()=>s,hf:()=>r});var n=i(8430);const s=(e=200)=>({resizeDimensions:[{property:n.P.width,setDimension:e=>e.width,duration:e},{property:n.P.height,setDimension:e=>e.height,duration:e},{property:n.P.top,setDimension:()=>0,duration:e},{property:n.P.left,setDimension:()=>0,duration:e}]}),r=(e,t,i=200)=>{const s=[];return void 0!==e&&s.push({property:n.P.width,setDimension:t=>t.width+e,duration:i}),void 0!==t&&s.push({property:n.P.height,setDimension:e=>e.height+t,duration:i}),{resizeDimensions:s}}},2782:(e,t,i)=>{"use strict";i.d(t,{n:()=>BlurCanvasCommand});var n=i(17386);class BlurCanvasCommand extends n.m{constructor(e,t){super(),this.name="blur-canvas",this.payload={duration:e,pixelBlur:t}}}},8430:(e,t,i)=>{"use strict";i.d(t,{P:()=>n,M:()=>ResizeCanvasCommand});var n,s=i(17386);!function(e){e.left="left",e.top="top",e.width="width",e.height="height"}(n||(n={}));class ResizeCanvasCommand extends s.m{constructor(e){super(),this.name="resize-canvas",this.payload=Object.assign({},e)}}},46228:(e,t,i)=>{"use strict";i.d(t,{L:()=>ScreenToCanvasPointCommand});var n=i(17386);class ScreenToCanvasPointCommand extends n.m{constructor(e){super(),this.name="screen-to-canvas-point",this.payload=Object.assign({},e)}}},40168:(e,t,i)=>{"use strict";i.d(t,{W:()=>CanvasData});var n=i(32770);class CanvasData extends n.V{constructor(e,t){super(),this.name="canvas",this.x=0,this.y=0,this.width=e||0,this.height=t||0;const i=this.width/this.height;this.aspectRatio=isFinite(i)?i:1}}},86718:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CanvasModule});var n=i(47724),s=i(40168),r=i(67790),o=i(51198),a=i(8430),l=i(64185),c=i(46228),h=i(10757),d=i(2782),u=i(85917),p=i(31102);class CanvasMountError extends p.y{}const m={[a.P.width]:"width",[a.P.height]:"height",[a.P.top]:"top",[a.P.left]:"left"};class CanvasModule extends n.Y{constructor(){super(...arguments),this.name="canvas",this.getNewX=()=>0,this.getNewY=()=>0,this.getNewWidth=e=>e.width,this.getNewHeight=e=>e.height,this.activeTransitions=[],this.activeTransitionMap={left:null,top:null,width:null,height:null},this.onResize=e=>{e.propertyName in a.P&&(this.resolveActiveTransition(e.propertyName),this._canvas.style.transitionDuration=this.stringifyTransitionDurations())},this.onWindowResize=()=>{this.transitionDurations.left=this.transitionDurations.top=this.transitionDurations.width=this.transitionDurations.height="0s",this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition(),this.activeTransitions.forEach(this.resolveActiveTransition.bind(this)),this._canvas.style.transitionDuration=this.stringifyTransitionDurations()},this.resizeCanvas=async e=>{if(e.resizeDimensions)return this.activeTransitions.forEach(this.resolveActiveTransition.bind(this)),e.resizeDimensions.forEach((e=>{const{property:t,setDimension:i,duration:n=0}=e,s=m[t],r=this._canvas.style[s];switch(t){case a.P.height:this.setHeight(i,n);break;case a.P.width:this.setWidth(i,n);break;case a.P.top:this.setY(i,n);break;case a.P.left:this.setX(i,n)}if(this._canvas.style[s]!==r&&n>0){const e=new l.Q;e.then((()=>{clearTimeout(i)}));const i=setTimeout((()=>{this.resolveActiveTransition(t)}),n+500);this.activeTransitionMap[t]=e,this.activeTransitions.push(t)}})),this.hasActiveTransitions()||(this.canvasBounds=this._canvas.getBoundingClientRect()),this.getTransitionPromise()}}async init(e,t){if(this.engine=t,!e.container)throw new CanvasMountError;this.container=e.container,this.container.appendChild(e.canvas),this.containerBounds=this.container.getBoundingClientRect(),this._canvas=e.canvas,this._canvas.setAttribute("tabindex","-1"),this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.style.top="0",this.transitionDurations={left:"0s",top:"0s",width:"0s",height:"0s",filter:"0.4s"},this._canvas.style.transitionProperty=Object.keys(this.transitionDurations).join(","),this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.updateTransitions(),this.bindings.push((0,u.kp)(u.g_.RESIZE,this.onWindowResize),t.commandBinder.addBinding(a.M,this.resizeCanvas),this.makeTransitionEndSubscription(),t.commandBinder.addBinding(c.L,(async e=>this.screenToCanvasPoint(e.x,e.y))),t.commandBinder.addBinding(d.n,this.blur.bind(this)));for(const e of this.bindings)e.renew();this.canvasBounds=this._canvas.getBoundingClientRect(),this.containerBounds=this.container.getBoundingClientRect(),this.data=new s.W(this.canvasBounds.width,this.canvasBounds.height),t.market.register(this,s.W,this.data)}makeTransitionEndSubscription(){let e=!1;return{renew:()=>{e||(this.element.addEventListener("transitionend",this.onResize),e=!0)},cancel:()=>{e&&(this.element.removeEventListener("transitionend",this.onResize),e=!1)}}}dispose(e){super.dispose(e)}get element(){return this._canvas}get width(){return this.canvasBounds.width}get height(){return this.canvasBounds.height}get x(){return this.canvasBounds.left}get y(){return this.canvasBounds.top}onUpdate(){const e=this.container.getBoundingClientRect(),t=this.containerHasChanged(e);t&&(this.containerBounds=e,this.updateTransitions()),(t||this.hasActiveTransitions())&&(this.canvasBounds=this._canvas.getBoundingClientRect());const i=this.data.width!==this.width||this.data.height!==this.height,n=this.data.x!==this.x||this.data.y!==this.y;i&&(this.data.width=this.width,this.data.height=this.height,this.data.commit(),this.engine.broadcast(new r.a(this.width,this.height))),n&&(this.data.x=this.x,this.data.y=this.y,this.data.commit(),this.engine.broadcast(new o.k(this.x-this.containerBounds.left,this.y-this.containerBounds.top)))}containerHasChanged(e){return e.left!==this.containerBounds.left||e.top!==this.containerBounds.top||e.width!==this.containerBounds.width||e.height!==this.containerBounds.height}setX(e,t=0){this.getNewX="number"==typeof e?()=>e:e,this.transitionDurations.left=`${t}ms`,this.updateTransitions()}setY(e,t=0){this.getNewY="number"==typeof e?()=>e:e,this.transitionDurations.top=`${t}ms`,this.updateTransitions()}setWidth(e,t=0){this.getNewWidth="number"==typeof e?()=>e:e,this.transitionDurations.width=`${t}ms`,this.updateTransitions()}setHeight(e,t=0){this.getNewHeight="number"==typeof e?()=>e:e,this.transitionDurations.height=`${t}ms`,this.updateTransitions()}screenToCanvasPoint(e,t){return{x:e-this.x,y:t-this.y}}async blur(e){this.transitionDurations.filter=`${e.duration}ms`,this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this._canvas.style.filter=`blur(${e.pixelBlur}px)`,await(0,h.gw)(e.duration),0===e.pixelBlur&&(this._canvas.style.filter="")}getTransitionPromise(){return Promise.all(this.activeTransitions.map((e=>this.activeTransitionMap[e])).filter((e=>!!e)))}updateTransitions(){this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition()}applySize(){this._canvas.style.width=`${this.getNewWidth(this.containerBounds)}px`,this._canvas.style.height=`${this.getNewHeight(this.containerBounds)}px`}applyPosition(){this._canvas.style.left=`${this.getNewX(this.containerBounds)}px`,this._canvas.style.top=`${this.getNewY(this.containerBounds)}px`}stringifyTransitionDurations(){return Object.keys(this.transitionDurations).map((e=>this.transitionDurations[e])).join(",")}resolveActiveTransition(e){const t=this.activeTransitions.indexOf(e);-1!==t&&this.activeTransitions.splice(t,1);const i=this.activeTransitionMap[e];i&&i.resolve(),this.activeTransitionMap[e]=null,this.transitionDurations[e]="0s"}hasActiveTransitions(){return this.activeTransitions.length>0}}},16785:(e,t,i)=>{"use strict";i.d(t,{Z:()=>CommonControls});class CommonControls{}},13988:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CommonControlsModule});var n=i(47724),s=i(35597);class CommonControlsModule extends n.Y{constructor(){super(...arguments),this.name="common-controls"}async init(e,t){this.modeControls={},t.market.waitForData(s.O).then((e=>this.viewmodeData=e))}startRotateTransition(e,t,i=!0){return this.checkControlsForAction((n=>n.startRotateTransition(e,t,i)))}startZoomTransition(e,t,i=!0){return this.checkControlsForAction((n=>n.startZoomTransition(e,t,i)))}startTranslateTransition(e,t,i=!0){return this.checkControlsForAction((n=>n.startTranslateTransition(e,t,i)))}stop(){return this.checkControlsForAction((e=>(e.stop(),Promise.resolve())))}checkControlsForAction(e){if(this.viewmodeData&&null!==this.viewmodeData.currentMode){if(this.modeControls[this.viewmodeData.currentMode]){return e(this.modeControls[this.viewmodeData.currentMode].controls)}}return Promise.reject("checkControlsForAction() -> Current view mode is null")}addControls(e,t,i=!1){this.modeControls[e]&&!i||(this.modeControls[e]={mode:e,controls:t})}}},63739:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CurrentPanoMarker});var n=i(47724),s=i(736),r=i(2212),o=i(48358);class MarkerRenderer{constructor(e,t,i,n){this.scene=e,this.sweepData=i,this.material=new r.MeshBasicMaterial({transparent:!0,map:t,depthWrite:!1}),this.mesh=new r.Mesh(MarkerRenderer.planeGeometry,this.material),this.mesh.name="CurrentPanoMarker",this.mesh.renderOrder=o.z.panoMarker,this.mesh.layers.mask=n.mask,this.mesh.lookAt(this.mesh.position.clone().setY(1))}init(){}dispose(){this.material.map&&this.material.map.dispose(),this.mesh.geometry.dispose()}render(){const e=this.sweepData.currentAlignedSweepObject;e&&this.move(e.floorPosition)}activate(){this.scene.add(this.mesh)}deactivate(){this.scene.remove(this.mesh)}move(e){this.mesh.position.copy(e).setY(e.y+MarkerRenderer.floorOffset)}}MarkerRenderer.floorOffset=.01,MarkerRenderer.planeGeometry=new r.PlaneGeometry(.5,.5);var a=i(66223),l=i(35597),c=i(75892),h=i(99612),d=i(17386);class TogglePanoMarkerCommand extends d.m{constructor(e){super(),this.id="TOGGLE_PANO_MARKER",this.payload={enabled:e}}}var u=i(94329),p=i(33874),m=i(73710);class CurrentPanoMarker extends n.Y{constructor(){super(...arguments),this.name="current-pano-marker",this.state={markerEnabled:!1,transitionPromise:null}}async init(e,t){const i=(0,a.p)(h),n=(await t.getModuleBySymbol(s.y.WEBGL_RENDERER)).getScene(),r=t.claimRenderLayer(this.name),[o,d,u]=await Promise.all([t.market.waitForData(p.e),t.market.waitForData(c.Z),t.market.waitForData(l.O)]);this.engine=t,this.settingsData=o,this.sweepData=d,this.viewmodeData=u,this.markerRenderer=new MarkerRenderer(n,i,d,r),this.bindings.push(t.commandBinder.addBinding(TogglePanoMarkerCommand,(async({enabled:e})=>this.setCommandOverride(e))),this.viewmodeData.makeModeChangeSubscription((()=>this.updateMarker())),this.sweepData.makeSweepChangeSubscription((()=>this.updateMarker())),this.settingsData.onPropertyChanged(m.o,(()=>this.updateMarker()))),this.updateMarker()}setCommandOverride(e){this.state.commandOverride=e,this.updateMarker()}async updateMarker(){const{commandOverride:e}=this.state,t=this.viewmodeData.currentMode,i=this.sweepData.currentAlignedSweepObject,n=!1===this.settingsData.tryGetProperty(m.o,!0)||!1===e||t===u.Ey.Panorama||t===u.Ey.Transition;return this.toggleMarker(!!i&&!n)}async toggleMarker(e){const{markerEnabled:t,transitionPromise:i}=this.state;if(i&&await i,t===e)return;const n=e?this.enableMarker():this.disableMarker();return this.state.transitionPromise=n.finally((()=>{this.state.markerEnabled=e,this.state.transitionPromise=null})),this.state.transitionPromise}async enableMarker(){return this.engine.addComponent(this,this.markerRenderer)}async disableMarker(){return this.engine.removeComponent(this,this.markerRenderer)}}},73710:(e,t,i)=>{"use strict";i.d(t,{o:()=>n});const n="features/current_sweep_indicator"},56241:(e,t,i)=>{"use strict";i.d(t,{y:()=>DisableCursorMeshCommand});var n=i(17386);class DisableCursorMeshCommand extends n.m{constructor(e){super(),this.payload={disable:e}}}},67394:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CursorController});var n=i(47724),s=i(68113),r=i(94329),o=i(35597),a=i(69941),l=i(19047),c=i(75892),h=i(56241),d=i(33874),u=i(55461);class CursorController extends n.Y{constructor(){super(...arguments),this.name="cursor-controller",this.visibilityRules=[],this.disabled=!1}async init(e,t){this.cursorMesh=await t.getModule(s.default),this.visibilityRules.push((()=>{const e=t.market.tryGetData(o.O);return!!e&&e.closestMode===r.Ey.Panorama}),(()=>{const e=t.market.tryGetData(c.Z);return!!e&&!e.isSweepUnaligned(e.currentSweep)}),(()=>{const e=t.market.tryGetData(a.k3);return!!e&&!e.isTourActive()}),(()=>{const e=t.market.tryGetData(l.Z);return!!e&&!e.isMobile()}),(()=>{const e=t.market.tryGetData(d.e);return!!e&&e.tryGetProperty(u.b,!0)})),this.bindings.push(t.commandBinder.addBinding(h.y,(async e=>{this.disabled=e.disable})))}onUpdate(){this.updateCursorVisibility()}addVisibilityRule(e){this.visibilityRules.push(e)}removeVisibilityRule(e){const t=this.visibilityRules.indexOf(e);-1!==t&&this.visibilityRules.splice(t,1)}updateCursorVisibility(){const e=!this.disabled&&this.visibilityRules.reduce(((e,t)=>e&&t()),!0);this.cursorMesh.setVisible(e)}}},55461:(e,t,i)=>{"use strict";i.d(t,{b:()=>n});const n="features/cursor"},63781:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CursorDataModule});var n=i(47724),s=i(2212),r=i(8482),o=i(69927),a=i(49340),l=i(88512),c=i(44019),h=i(736);const d=new l.Z("cursor-data");class CursorDataModule extends n.Y{constructor(){super(...arguments),this.name="cursor-data",this.cursorState=new o.Y,this.position=new s.Vector2,this.timeToFade=0,this.onPointerMove=()=>{if(null!==this.raycasterData.hit&&this.raycasterData.pointerNdcPosition.distanceToSquared(this.position)>CursorDataModule.movementThreshold){this.position.copy(this.raycasterData.pointerNdcPosition),this.timeToFade=CursorDataModule.fadeOutDelay;const e=(0,r.t)(0,CursorDataModule.fadeInDuration,1-this.cursorState.opacity.value);this.cursorState.opacity.modifyAnimation(this.cursorState.opacity.value,1,e),this.cursorState.commit()}}}async init(e,t){this.input=await t.getModuleBySymbol(h.y.INPUT),this.raycasterData=await t.market.waitForData(c.P),t.market.register(this,o.Y,this.cursorState),this.bindings.push(this.input.registerHandler(a.mE,this.onPointerMove)),CursorDataModule.fadeInDuration>CursorDataModule.fadeOutDelay&&d.warn("fadeInDuration should be less than fadeOutDelay!")}onUpdate(e){let t=!1;this.timeToFade>0&&(this.timeToFade-=e,this.timeToFade<=0&&(t=!0)),this.cursorState.opacity.tick(e),this.cursorState.commit(),t&&this.cursorState.opacity.modifyAnimation(1,0,CursorDataModule.fadeOutDuration)}dispose(e){super.dispose(e)}}CursorDataModule.fadeOutDelay=700,CursorDataModule.fadeOutDuration=700,CursorDataModule.fadeInDuration=300,CursorDataModule.movementThreshold=.003},69927:(e,t,i)=>{"use strict";i.d(t,{Y:()=>CursorData});var n=i(17131),s=i(32770);class CursorData extends s.V{constructor(){super(),this.name="cursor",this.opacity=new n.z(0)}}},71682:(e,t,i)=>{"use strict";var n;i.d(t,{L:()=>n}),function(e){e[e.Reticle=0]="Reticle",e[e.GridPlane=1]="GridPlane"}(n||(n={}))},68113:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CursorMesh});var n=i(47724),s=i(736),r=i(2212),o=i(69927),a=i(44019),l=i(84561),c=i(12216),h=i(66223),d=i(71682),u=i(408),p=i(48358);class Cursor{constructor(e,t=l.o.ALL){this.scene=e,this.layer=t,this.supportsMobile=!1,this.style=d.L.Reticle,this.defaultTexture=(0,h.p)(u),this.bindings=[],this.onOpacityUpdate=e=>{this.material.opacity=e.opacity.value},this.onPositionUpdate=e=>{if(e.hit&&e.hit.face){const t=e.hit.point.clone(),i=e.hit.face.normal;this.container.position.copy(t).addScaledVector(i,.01),this.container.quaternion.setFromUnitVectors(c.f.FORWARD,i)}},this.container=new r.Group,this.container.name="cursor";const i=new r.PlaneGeometry(.4,.4);this.material=new r.MeshBasicMaterial({side:r.DoubleSide,transparent:!0,depthTest:!0,depthWrite:!1,map:this.defaultTexture});const n=new r.Mesh(i,this.material);this.container.add(n),n.renderOrder=p.z.reticule,n.layers.mask=this.layer.mask}init(){}render(){}dispose(){this.material.map&&this.material.map.dispose(),this.container.children.forEach((e=>{if(e.isMesh){e.geometry.dispose();const t=e.material;t.dispose(),t.map&&t.map.dispose()}}))}async activate(e){const t=await e.market.waitForData(o.Y),i=await e.market.waitForData(a.P);this.bindings.push(t.onChanged(this.onOpacityUpdate),i.onChanged(this.onPositionUpdate)),this.scene.add(this.container)}deactivate(){for(const e of this.bindings)e.cancel();this.bindings.length=0,this.scene.remove(this.container)}setVisible(e){this.container.visible=e}}class CursorMesh extends n.Y{constructor(){super(...arguments),this.name="cursor-mesh",this.setVisible=e=>{this.cursor&&this.cursor.setVisible(e)}}async init(e,t){const i=(await t.getModuleBySymbol(s.y.WEBGL_RENDERER)).getScene(),n=t.claimRenderLayer(this.name);this.cursor=new Cursor(i,n),t.addComponent(this,this.cursor)}get container(){return this.cursor.container}}},55130:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>DollhouseControls});var n=i(47724),s=i(736),r=i(12216),o=i(13988),a=i(81040),l=i(51869),c=i(88727),h=i(81507),d=i(88216),u=i(76870),p=i(68576),m=i(35597),g=i(94329),f=i(60771),v=i(27408),y=i(7170),b=i(19674),S=i(2212),E=i(63560),w=i(14735),T=i(67027),_=i(17399),M=i(68524),x=i(16785),A=i(64185),O=i(31278);const P=1e3/60,D=80*y.Ue,C=0*y.Ue,I=Math.PI/1e3,L=M.Z.epsilon;class CameraControls extends x.Z{constructor(e,t,i,n=!1){super(),this.cameraPoseProxy=e,this.cameraCheck=t,this.tempOrientation=new S.Quaternion,this.tempAxis=new S.Vector3,this.nextPosition=new S.Vector3,this.nextOrientation=new S.Quaternion,this.currentOrientation=new S.Quaternion,this.currentPosition=new S.Vector3,this.positionDelta=new S.Vector3,this.angularAccel=new S.Vector2,this.angularVelocity=new S.Vector2,this.linearAccel=new S.Vector2,this.linearVelocity=new S.Vector2,this.zoomAccel=0,this.zoomVelocity=0,this.cameraOrientation=new S.Euler,this.aimTarget=new S.Vector3,this.poseController=null,this.currentPhiLowerLimit=C,this.currentPhiUpperLimit=D,this.checkBounds=n,this._maxZoomDistance=Math.max(30,1.5*i.getSize(new S.Vector3).length()),this.transition={active:!1,startTime:0,elapsed:0,duration:0,angularVelocity:new S.Vector2,linearVelocity:new S.Vector2,zoomVelocity:0,easeOut:!1}}onAccessGranted(e){this.poseController=e}onAccessRevoked(e){this.stop()}get maxZoomDistance(){return this._maxZoomDistance}setOrbitalAcceleration(e,t=!1){this.transition.active||(t&&this.haltVelocity(e,this.angularVelocity),this.angularAccel.x=void 0!==e.x?e.x:this.angularAccel.x,this.angularAccel.y=void 0!==e.y?e.y:this.angularAccel.y)}setPanAcceleration(e,t=!1){this.transition.active||(t&&this.haltVelocity(e,this.linearVelocity),this.linearAccel.x=void 0!==e.x?e.x:this.linearAccel.x,this.linearAccel.y=void 0!==e.y?e.y:this.linearAccel.y)}setZoomAcceleration(e){this.transition.active||(this.zoomAccel=e)}async setPhiLimits(e,t,i){this.currentPhiLowerLimit=e,this.currentPhiUpperLimit=t;const n=this.cameraPoseProxy.pose;this.cameraOrientation.setFromQuaternion(n.rotation,"YXZ");const s=-this.cameraOrientation.x,r=(0,v.uZ)(0,this.currentPhiLowerLimit-s,this.currentPhiUpperLimit-s);Math.abs(r)>L&&i&&await this.orbit(new S.Vector2,!0)}haltVelocity(e,t){e.x&&t.x&&Math.sign(e.x)!==Math.sign(t.x)&&(t.x=0),e.y&&t.y&&Math.sign(e.y)!==Math.sign(t.y)&&(t.y=0)}startTransition(e,t,i,n,s){if(null===this.poseController)return A.Q.reject("Unable to start transition, since controller is unavailable.");const r=new A.Q;return this.transition.active=!0,this.transition.duration=e,this.transition.elapsed=0,this.transition.startTime=Date.now(),this.transition.deferred=r,this.transition.angularVelocity.copy(t),this.transition.linearVelocity.copy(i),this.transition.zoomVelocity=n,this.transition.easeOut=s,this.angularAccel.set(0,0),this.linearAccel.set(0,0),this.zoomAccel=0,this.angularVelocity.copy(t),this.linearVelocity.copy(i),this.zoomVelocity=n,this.poseController.beginExternalTransition(),r.promise()}stopTransition(){this.transition.active&&(this.poseController&&this.poseController.endExternalTransition(),this.transition.active=!1),this.transition.deferred&&(this.transition.deferred.resolve(),this.transition.deferred=void 0)}updateTransition(e,t,i,n){let s=1,r=e/P;if(this.transition.elapsed+=e,this.transition.elapsed>=this.transition.duration){s=(this.transition.duration-(this.transition.elapsed-e))/e,r=1}t&&(this.angularVelocity.copy(this.transition.angularVelocity).multiplyScalar(s*r),this.orbit(this.angularVelocity)),i&&(this.linearVelocity.copy(this.transition.linearVelocity).multiplyScalar(s*r),this.pan(this.linearVelocity)),n&&(this.zoomVelocity=this.transition.zoomVelocity*s*r,this.zoom(this.zoomVelocity)),this.transition.elapsed>=this.transition.duration&&(this.stop(this.transition.easeOut),this.transition.active=!1)}updateDefault(e,t,i,n){const s=e/P;t&&(this.angularVelocity.addScaledVector(this.angularAccel,s),this.orbit(this.angularVelocity),this.angularVelocity.multiplyScalar(Math.pow(.92,s))),i&&(this.linearVelocity.addScaledVector(this.linearAccel,s),this.pan(this.linearVelocity),this.linearVelocity.multiplyScalar(Math.pow(.92,s))),n&&(this.zoomVelocity+=this.zoomAccel*s,this.zoom(this.zoomVelocity),this.zoomVelocity*=Math.pow(.84,s))}startRotateTransition(e,t,i){return t.x*=-1,this.startTransition(e,t.clone().multiplyScalar(P),new S.Vector2,0,i).nativePromise()}startTranslateTransition(e,t,i=!0){return this.startTransition(e,new S.Vector2,t.clone().multiplyScalar(P),0,i).nativePromise()}startZoomTransition(e,t,i){return this.startTransition(e,new S.Vector2(0,0),new S.Vector2(0,0),t,i).nativePromise()}update(e){const t=this.angularAccel.length()>L||this.angularVelocity.length()>L,i=this.linearAccel.length()>L||this.linearVelocity.length()>L,n=Math.abs(this.zoomAccel)>L||Math.abs(this.zoomVelocity)>L;this.transition.active?this.updateTransition(e,t,i,n):this.updateDefault(e,t,i,n)}stopMomentum(){this.transition.active||(this.angularVelocity.set(0,0),this.linearVelocity.set(0,0),this.zoomVelocity=0)}stopAcceleration(){this.transition.active||(this.setOrbitalAcceleration({x:0,y:0}),this.setPanAcceleration({x:0,y:0}),this.setZoomAcceleration(0))}stop(e=!1){this.stopTransition(),this.stopAcceleration(),e||this.stopMomentum()}pan(e){if(!this.poseController)return;const t=this.cameraPoseProxy.pose;this.positionDelta.x=e.x,this.positionDelta.z=e.y,this.nextPosition.copy(t.position).add(this.positionDelta),this.checkBounds&&!this.cameraCheck(this.nextPosition,t.rotation,t.focalDistance)||(this.currentPosition.copy(this.nextPosition),this.poseController.updateCameraPosition(this.currentPosition))}orbit(e,t=!1){if(!this.poseController)return;const i=this.cameraPoseProxy.pose;this.cameraOrientation.setFromQuaternion(i.rotation,"YXZ");const n=-this.cameraOrientation.x,s=(0,v.uZ)(e.y,this.currentPhiLowerLimit-n,this.currentPhiUpperLimit-n);if(this.aimTarget.copy(r.f.FORWARD).applyQuaternion(i.rotation),this.aimTarget.setLength(i.focalDistance),this.aimTarget.addVectors(i.position,this.aimTarget),this.tempAxis.copy(r.f.RIGHT),this.tempOrientation.setFromAxisAngle(this.tempAxis.applyQuaternion(i.rotation),-s),this.nextPosition.copy(i.position).sub(this.aimTarget).applyQuaternion(this.tempOrientation),this.nextOrientation.copy(i.rotation).premultiply(this.tempOrientation),this.tempOrientation.setFromAxisAngle(r.f.UP,e.x),this.nextPosition.applyQuaternion(this.tempOrientation),this.nextOrientation.premultiply(this.tempOrientation),this.nextPosition=this.nextPosition.add(this.aimTarget),this.nextOrientation.normalize(),!this.checkBounds||this.cameraCheck(i.position,this.nextOrientation,i.focalDistance)){if(this.currentPosition.copy(this.nextPosition),this.currentOrientation.copy(this.nextOrientation),t)return this.poseController.moveTo({transitionType:O.n.Interpolate,pose:{position:this.currentPosition.clone(),rotation:this.currentOrientation.clone()},transitionTime:500});i.rotation.equals(this.currentOrientation)||(this.poseController.updateCameraPosition(this.currentPosition),this.poseController.updateCameraRotation(this.currentOrientation))}}zoom(e){if(!this.poseController)return;const t=this.cameraPoseProxy.pose,i=this.maxZoomDistance-2,n=t.focalDistance,s=(0,v.uZ)(e*i+n,2,this.maxZoomDistance)-n,o=t.focalDistance+s;this.nextPosition.copy(t.position).add(r.f.FORWARD.clone().applyQuaternion(t.rotation).setLength(-s)),this.checkBounds&&!this.cameraCheck(this.nextPosition,t.rotation,o)||(this.currentPosition.copy(this.nextPosition),this.poseController.updateCameraPosition(this.currentPosition),this.poseController.updateCameraFocus(o))}}var R=i(27687);class CameraTouchControls{constructor(e,t,i){this.poseProxy=e,this.cameraCheck=t,this.raycaster=i,this.movingCamera=!1,this.smoothedTouch0=new S.Vector2,this.smoothedTouch1=new S.Vector2,this.origTouchAxis=new S.Vector2,this.origCenterPt=new S.Vector2,this.plane=new S.Plane(r.f.UP.clone(),0),this.originalPinchLength=0,this.pointersMoved=(()=>{const e=new S.Vector2,t=new S.Vector3,i=new S.Vector3,n=new S.Vector2,s=new S.Vector3;return o=>{if(!this.poseController)return;this.smoothedTouch0.lerp(o[0].position,.2),this.smoothedTouch1.lerp(o[1].position,.2),n.copy(this.smoothedTouch1).sub(this.smoothedTouch0).normalize();const a=this.origTouchAxis.angle()-n.angle();t.copy(this.initialPose.position);const l=new S.Vector3(-this.intersectionPt.x,0,-this.intersectionPt.z);t.add(l),t.applyAxisAngle(r.f.UP,a),l.negate(),t.add(l);const c=(new S.Quaternion).copy(this.initialPose.rotation),h=(new S.Quaternion).setFromAxisAngle(r.f.UP,a);c.premultiply(h);const d=this.smoothedTouch0.clone().lerp(this.smoothedTouch1,.5),u=new S.Vector3;if(i.copy(r.f.FORWARD).applyQuaternion(c),this.castFrom(d.x,i.y<-.01?d.y:this.origCenterPt.y,u),isNaN(u.x))return void(this.movingCamera=!1);u.x-=this.intersectionPt.x,u.z-=this.intersectionPt.z,u.negate(),u.applyAxisAngle(r.f.UP,a);const p=1-1/(e.subVectors(this.smoothedTouch0,this.smoothedTouch1).length()/this.originalPinchLength),m=t.add(u).lerp(this.intersectionPt,p).clone(),g=s.subVectors(m,this.intersectionPt).length();this.cameraCheck(m,c,g)&&this.poseController&&(this.poseController.updateCameraPosition(m),this.poseController.updateCameraRotation(c),this.poseController.updateCameraFocus(g))}})(),this.initMove=(()=>{const e=new S.Vector2,t=new S.Ray,i=new S.Vector3;return n=>{const s=n[0].position,o=n[1].position;this.smoothedTouch0.copy(s),this.smoothedTouch1.copy(o),this.originalPinchLength=e.subVectors(s,o).length(),this.origTouchAxis.copy(o).sub(s).normalize(),this.origCenterPt.copy(s).lerp(o,.5);const{pose:a}=this.poseProxy;this.initialPose=a.clone();const l=new S.Vector3,c=new S.Vector3;(0,R.Kh)(this.initialPose,l.set(this.origCenterPt.x,this.origCenterPt.y,-1),l),(0,R.Kh)(this.initialPose,c.set(this.origCenterPt.x,this.origCenterPt.y,1),c),c.sub(l).normalize();const h=this.raycaster.picking.pick(l,c);h||(t.set(l,c),t.at(a.focalDistance,i)),this.intersectionPt=h?h.point:i,this.plane.set(r.f.UP.clone(),0),this.plane.translate(new S.Vector3(0,this.intersectionPt.y,0))}})(),this.castFrom=(()=>{const e=new S.Ray,t=new S.Vector3,i=new S.Vector3;return(n,s,r)=>{(0,R.Kh)(this.initialPose,t.set(n,s,-1),t),(0,R.Kh)(this.initialPose,i.set(n,s,1),i),i.sub(t).normalize(),e.set(t,i),e.intersectPlane(this.plane,r)&&!r.equals(t)||(r.x=NaN),r.y=0}})()}rawPointerUpdate(e){const t=this.movingCamera;this.movingCamera=2===e.pointers.length&&!!this.poseController,this.movingCamera&&(t?this.pointersMoved(e.pointers):this.initMove(e.pointers))}onAccessGranted(e){this.poseController=e}onAccessRevoked(e){this.poseController=void 0,this.movingCamera=!1}}var N,k=i(17386);class SetDollhouseVerticalLimits extends k.m{constructor(e){super(),this.payload=e,this.id="DOLLHOUSE_VERTICAL_LIMITS"}}!function(e){e[e.NONE=u.r3.NONE]="NONE",e[e.ROTATE=u.r3.PRIMARY]="ROTATE",e[e.PAN=u.r3.SECONDARY]="PAN",e[e.ZOOM=u.r3.MIDDLE]="ZOOM"}(N||(N={}));class DollhouseControls extends n.Y{constructor(){super(...arguments),this.name="dollhouse-controls",this.controlState=N.NONE,this.movementKeys=new S.Vector2,this.adjustedBounds=new S.Box3,this.didDrag=!1,this.resetControlState=()=>{this.controlState=N.NONE},this.convertDeltaToLocal=(()=>{const e=new S.Vector3,t=new S.Vector3;return i=>{const n=i.x||0,s=i.y||0,o=2*n*this.cameraPoseProxy.pose.focalDistance,a=2*s*this.cameraPoseProxy.pose.focalDistance/this.cameraPoseProxy.pose.aspect();return e.copy(r.f.RIGHT).applyQuaternion(this.cameraPoseProxy.pose.rotation).setY(0).setLength(o),t.copy(r.f.FORWARD).applyQuaternion(this.cameraPoseProxy.pose.rotation),e.add(t.setY(0).setLength(a)),e}})(),this.cameraCheck=(()=>{function e(e){return e.x>=1||e.x<=-1||e.y>=1||e.y<=-1||e.z<=-1||e.z>=1}const t=[];for(let e=0;e<8;e++)t.push(new S.Vector3);const i=new S.Matrix4,n=new S.Matrix4,s=new S.Box3;return(o,a,l)=>{if(l<2)return!1;if(!(0,b.cb)(o,a,this.cameraPoseProxy.pose.projection,this.adjustedBounds))return!1;(0,b.jB)(this.meshData.bounds,t),i.compose(o,a,r.f.UNIT),i.invert(),n.copy(this.cameraPoseProxy.pose.projection.asThreeMatrix4()),s.makeEmpty();let c=!1;for(let e=0;e<8;e++)t[e].applyMatrix4(i),t[e].z=(0,v.uZ)(t[e].z,-E.oR.far,-E.oR.near),t[e].applyMatrix4(n),s.expandByPoint(t[e]);c=e(s.min)||e(s.max),s.min.clampScalar(-1,1),s.max.clampScalar(-1,1);return(s.max.x-s.min.x)*(s.max.y-s.min.y)>(c?.5:.1)}})()}async init(e,t){this.cameraPoseProxy=e.cameraPoseProxy,[this.viewmodeData,this.meshData,this.commonControlsModule]=await Promise.all([t.market.waitForData(m.O),t.market.waitForData(T._),t.getModule(o.default)]),this.bindings.push(t.subscribe(p.Z,(e=>{this.controls.stop(),this.resetControlState()}))),t.commandBinder.addBinding(SetDollhouseVerticalLimits,(async e=>this.controls.setPhiLimits(void 0!==e.phiLowerLimitDegrees?e.phiLowerLimitDegrees*y.Ue:C,void 0!==e.phiUpperLimitDegrees?e.phiUpperLimitDegrees*y.Ue:D,this.validateViewmode())));const i=await t.getModuleBySymbol(s.y.INPUT);this.modelSize=Math.max(this.meshData.size.length(),1),this.setupBounds(),this.controls=new CameraControls(this.cameraPoseProxy,this.cameraCheck,this.meshData.bounds,!0),this.commonControlsModule.addControls(g.Ey.Dollhouse,this.controls);const n=await t.getModule(_.default);this.cameraTouchControls=new CameraTouchControls(this.cameraPoseProxy,this.cameraCheck,n),this.bindings.push(i.registerHandler(a.a,(e=>{this.validateViewmode()&&this.onScrollWheel(e)}))),this.bindings.push(i.registerHandler(l.E0,(e=>{this.validateViewmode()&&(this.didDrag=!1,this.onDragBegin(e.buttons))}))),this.bindings.push(i.registerHandler(l._R,(e=>{this.validateViewmode()&&(e.timeSinceLastMove<100&&this.didDrag&&(this.onDrag(e.delta),this.controls.update(P),this.controls.stopAcceleration()),this.onDragEnd(e.delta,e.buttons))}))),this.bindings.push(i.registerHandler(l._t,(e=>{this.validateViewmode()&&(this.didDrag=!0,this.onDrag(e.delta),this.controls.update(P),this.controls.stop())}))),this.bindings.push(i.registerHandler(w.h,(e=>{this.validateViewmode()&&this.cameraTouchControls.rawPointerUpdate(e)}))),this.bindings.push(i.registerHandler(c.e,(e=>{this.validateViewmode()&&e.state!==d.M.PRESSED&&this.onKey(e.key,e.state)}))),this.cameraPoseProxy.newSession(this)}onUpdate(e){this.validateViewmode()&&this.controls.update(e)}onAccessGranted(e){this.controls.onAccessGranted(e),this.cameraTouchControls.onAccessGranted(e)}onAccessRevoked(e){this.controls.onAccessRevoked(e),this.cameraTouchControls.onAccessRevoked(e)}onScrollWheel(e){if(0!==e.delta.y){const t=1/this.cameraPoseProxy.pose.focalDistance*2,i=this.modelSize;this.controls.setZoomAcceleration(.1*e.delta.y/(t*i*500)),this.controls.update(P),this.controls.setZoomAcceleration(0)}}onDragBegin(e){if(this.controlState===N.NONE){const t=e;this.controlState=t}this.controls.stop()}onDrag(e){switch(this.controlState){case N.ROTATE:this.controls.setOrbitalAcceleration({x:-Math.PI*e.x,y:-Math.PI*e.y});break;case N.PAN:const t=this.convertDeltaToLocal(e);this.controls.setPanAcceleration({x:-t.x,y:-t.z});break;case N.ZOOM:0!==e.y&&this.controls.setZoomAcceleration(-e.y)}}onDragEnd(e,t){t&this.controlState||(this.controlState=N.NONE,(0,f.tq)()&&this.controls.stop())}onKey(e,t){const i=t===d.M.DOWN;let n=!1;switch(e){case h.R.LEFTARROW:case h.R.J:this.controls.setOrbitalAcceleration({x:i?I:0},!0);break;case h.R.RIGHTARROW:case h.R.L:this.controls.setOrbitalAcceleration({x:i?-I:0},!0);break;case h.R.UPARROW:case h.R.I:this.controls.setOrbitalAcceleration({y:i?-I:0},!0);break;case h.R.DOWNARROW:case h.R.K:this.controls.setOrbitalAcceleration({y:i?I:0},!0);break;case h.R.W:this.movementKeys.y=i?1:0,n=!0;break;case h.R.S:this.movementKeys.y=i?-1:0,n=!0;break;case h.R.D:this.movementKeys.x=i?1:0,n=!0;break;case h.R.A:this.movementKeys.x=i?-1:0,n=!0}if(n){const e=this.convertDeltaToLocal(this.movementKeys).setLength(.02);this.controls.setPanAcceleration({x:e.x,y:e.z})}}validateViewmode(){return this.viewmodeData.currentMode===g.Ey.Dollhouse}setupBounds(){function e(e,t){return Math.sign(e+t)===Math.sign(e)?e+t:0}this.adjustedBounds.copy(this.meshData.bounds);this.adjustedBounds.min.x=e(this.adjustedBounds.min.x,4),this.adjustedBounds.min.y=e(this.adjustedBounds.min.y,4),this.adjustedBounds.min.z=e(this.adjustedBounds.min.z,4),this.adjustedBounds.max.x=e(this.adjustedBounds.max.x,-4),this.adjustedBounds.max.y=e(this.adjustedBounds.max.y,-4),this.adjustedBounds.max.z=e(this.adjustedBounds.max.z,-4);const t=new S.Vector3;this.adjustedBounds.getSize(t),this.adjustedBounds.setFromCenterAndSize(this.meshData.center,t)}}},76541:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Fatcaster});var n=i(47724),s=i(736),r=i(37606),o=i(17399),a=i(2212),l=i(12216);class Fatcaster extends n.Y{constructor(){super(...arguments),this.name="fat-caster",this.rayAssembly=new Array(Fatcaster.rayCount),this.rayPlaneOrientation=new a.Quaternion,this.rayVisuals=[]}async init(e,t){this.config={debug:!!e.debug},this.raycaster=await t.getModule(o.default);for(let e=0;e<Fatcaster.rayCount;++e)this.rayAssembly[e]=new a.Ray;if(e.debug){const e=(await t.getModuleBySymbol(s.y.WEBGL_RENDERER)).getScene();for(let t=0;t<Fatcaster.rayCount;++t){this.rayVisuals[t]=new a.ArrowHelper(new a.Vector3,new a.Vector3);const i=this.rayVisuals[t];i.remove(i.cone),i.setLength(1e3),e.add(this.rayVisuals[t])}}}async dispose(e){const t=(await e.getModuleBySymbol(s.y.WEBGL_RENDERER)).getScene();for(const e of this.rayVisuals)t.remove(e)}get ray(){return this.raycaster.pointer.pointerRay.clone()}cast(e,t,i=r.a.Filter.AVERAGE){const n=this.ray;return this.updateRayAssembly(n.origin,n.direction,e),this.castRays(t,i)}castRays(e,t){const i=[];let n=null;for(const t of this.rayAssembly){const s=this.raycaster.picking.pick(t.origin,t.direction,e);s&&(t===this.rayAssembly[0]&&(n=s),s.point.add(this.rayAssembly[0].origin).sub(t.origin),i.push(s))}return t(i,n,this.rayAssembly)}updateRayAssembly(e,t,i){for(const e of this.rayAssembly)e.direction.copy(t);if(this.rayPlaneOrientation.setFromUnitVectors(l.f.FORWARD,t),this.rayAssembly[0].origin.copy(e),this.rayAssembly[1].origin.copy(l.f.RIGHT).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[2].origin.copy(l.f.UP).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[3].origin.copy(l.f.LEFT).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[4].origin.copy(l.f.DOWN).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[5].origin.copy(l.f.UP).add(l.f.RIGHT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[6].origin.copy(l.f.UP).add(l.f.LEFT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[7].origin.copy(l.f.DOWN).add(l.f.RIGHT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[8].origin.copy(l.f.DOWN).add(l.f.LEFT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.config.debug)for(let e=0;e<this.rayVisuals.length;++e){const i=this.rayVisuals[e];i.setDirection(t),i.position.copy(this.rayAssembly[e].origin)}}}Fatcaster.rayCount=9},37606:(e,t,i)=>{"use strict";i.d(t,{a:()=>n});var n,s=i(2212);!function(e){let t;!function(e){const t=e=>{for(const t of e)if(t.face)return{point:t.point,object:t.object,distance:t.distance,face:t.face};return null},i=(e,t)=>e.distance-t.distance;e.CENTER_FIRST=(e,i)=>i&&i.face?{point:i.point,normal:i.face.normal,object:i.object,distance:i.distance,face:i.face}:t(e),e.CLOSEST=e=>t(e.sort(i)),e.AVERAGE=e=>{if(0===e.length)return null;const t={point:new s.Vector3,face:{a:0,b:1,c:2,normal:new s.Vector3,materialIndex:0},distance:0,object:e[0].object};for(const i of e)t.face&&i.face&&(t.point.add(i.point),t.face.normal.add(i.face.normal));return t.point.divideScalar(e.length),t.face&&t.face.normal.divideScalar(e.length).normalize(),t};e.CENTER_GROUP=t=>(i,s,r)=>{if(s){const n=[s];for(let e=1;e<i.length&&e<3;++e){const o=i[e];if(o.face){const i=Math.abs(r[e].direction.dot(o.face.normal));s.point.distanceTo(o.point)*i<=t&&n.push(o)}}if(n.length>=3){const t=e.AVERAGE(n,null,r);if(t&&t.face&&s.face)return t.face.normal=s.face.normal,t}}const o=n(i,r,t);return o?e.AVERAGE(o,null,r):e.CENTER_FIRST(i,s,r)};const n=(e,t,n)=>{const s=e.slice().sort(i),r=[s[0]];let o;for(o=1;o<s.length&&r.length<3;++o){const e=s[o];if(e.face){const i=Math.abs(t[o].direction.dot(e.face.normal));r[0].point.distanceTo(e.point)*i>n&&(r.length=0),r.push(e)}}return r.length<3?null:r}}(t=e.Filter||(e.Filter={}))}(n||(n={}))},49924:(e,t,i)=>{"use strict";i.d(t,{Z:()=>GetFloorIntersectCommand});var n=i(17386);class GetFloorIntersectCommand extends n.m{constructor(e){super(),this.payload=Object.assign({},e)}}},14880:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GetFloorIntersectCommand:()=>n.Z,default:()=>b});var n=i(49924),s=i(84303),r=i(47724),o=i(736),a=i(59088),l=i(27687),c=i(26627),h=i(35597),d=i(94329),u=i(17399),p=i(51245),m=i(36123),g=i(76863),f=i(69626),v=i(2212),y=i(12216);class FloorCaster extends r.Y{constructor(){super(...arguments),this.name="floor-caster",this.cameraPosition=new v.Vector3,this.forwardPosition=new v.Vector3,this.targetPlane=new v.Plane}async init(e,t){this.engine=t,[this.renderer,this.cameraData,this.viewmodeData,this.raycaster,this.floorsData]=await Promise.all([t.getModuleBySymbol(o.y.WEBGL_RENDERER),t.market.waitForData(a.M_),t.market.waitForData(h.O),t.getModule(u.default),t.market.waitForData(c.i)]),t.commandBinder.addBinding(n.Z,(e=>this.castToFloor(e.screenPosition,e.height,e.includeHiddenFloors)))}async castToFloor(e,t,i=!0){await this.engine.after(s.A.End);const n=this.renderer.getScene().camera,r=(0,l.z5)(e.x,e.y,this.cameraData.width,this.cameraData.height);let o,a=null;this.cameraPosition.set(r.x,r.y,-1).unproject(n),this.forwardPosition.set(r.x,r.y,1).unproject(n);const c=this.raycaster.picking.cast(this.cameraPosition,this.forwardPosition.clone().sub(this.cameraPosition).normalize(),i?g.T0:g.Pv)[0];if(c&&c.object instanceof m.S&&(a=c&&c.point||null,p.$4.hasFloorId(c.object)?o=this.floorsData.getFloor(c.object.floorId):a&&(o=this.floorsData.getClosestFloorAtHeight(a.y))),void 0!==t){this.cameraPosition.copy(this.cameraData.pose.position);const e=(0,l.st)(this.cameraData,r);if(this.viewmodeData.currentMode!==d.Ey.Floorplan){const i=(0,f.n0)(this.cameraPosition,e);this.targetPlane.set(y.f.DOWN,t),a=(0,f.Fe)(this.cameraPosition,i,this.targetPlane)||null}else e.y=t,a=e}const h=o?o.index:-1;return{position:a,floor:h,floorIndex:h}}}const b=FloorCaster},45862:(e,t,i)=>{"use strict";i.d(t,{SI:()=>s,O8:()=>r,YW:()=>o,Gu:()=>a,bC:()=>l,JU:()=>c,Ct:()=>h,Tm:()=>d,TD:()=>u,mP:()=>p,jX:()=>m,N4:()=>g});var n=i(60771);const s=1e3/60,r=.05,o=Math.PI/2/1e3,a=.1/60,l=.02,c=25,h=3,d=3,u=.16,p=(0,n.V5)()?45:(0,n.Kr)()?20:35,m=.01,g=2},25706:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>FloorplanControls});var n=i(47724),s=i(2212),r=i(36371),o=i(12216),a=i(45862),l=i(68524),c=i(19674),h=i(69626),d=i(16785),u=i(64185);class CameraControls extends d.Z{constructor(e,t,i,n=!1){super(),this.cameraModule=e,this.targetProjection=new r.M,this.currentOrientation=new s.Quaternion,this.currentPosition=new s.Vector3,this.positionDelta=new s.Vector3,this.angularAccel=0,this.angularVelocity=0,this.linearAccel=new s.Vector2,this.linearVelocity=new s.Vector2,this.zoomAccel=0,this.zoomVelocity=0,this.scale=1,this.maxZoom=0,this.minZoom=a.Tm,this.checkBounds=n,this.bounds=t.clone(),this.boundsCenter=i.clone(),this.setupBounds(),this.transition={active:!1,startTime:0,elapsed:0,duration:0,angularVelocity:0,linearVelocity:new s.Vector2,zoomVelocity:0,easeOut:!1}}start(){this.scale=1,this.maxZoom=this.cameraModule.getData(!1).defaultZoom()*a.Ct}setRollAcceleration(e,t=!1){this.transition.active||(t&&e&&this.angularVelocity&&Math.sign(e)!==Math.sign(this.angularVelocity)&&(this.angularVelocity=0),this.angularAccel=e)}setPanAcceleration(e,t=!1){this.transition.active||(t&&this.haltVelocity(e,this.linearVelocity),this.linearAccel.x=void 0!==e.x?e.x:this.linearAccel.x,this.linearAccel.y=void 0!==e.y?e.y:this.linearAccel.y)}setZoomAcceleration(e){this.transition.active||(this.zoomAccel=e)}haltVelocity(e,t){e.x&&t.x&&Math.sign(e.x)!==Math.sign(t.x)&&(t.x=0),e.y&&t.y&&Math.sign(e.y)!==Math.sign(t.y)&&(t.y=0)}startRotateTransition(e,t,i){return this.startTransition(e,t.x*a.SI,new s.Vector2,0,i).nativePromise()}startTranslateTransition(e,t,i=!0){return this.startTransition(e,0,t.clone().multiplyScalar(a.SI),0,i).nativePromise()}startZoomTransition(e,t,i){return this.startTransition(e,0,new s.Vector2(0,0),t,i).nativePromise()}startTransition(e,t,i,n,s){const r=new u.Q;return this.transition.active=!0,this.transition.duration=e,this.transition.elapsed=0,this.transition.startTime=Date.now(),this.transition.deferred=r,this.transition.angularVelocity=t,this.transition.linearVelocity.copy(i),this.transition.zoomVelocity=n,this.transition.easeOut=s,this.angularAccel=0,this.linearAccel.set(0,0),this.zoomAccel=0,this.angularVelocity=t,this.linearVelocity.copy(i),this.zoomVelocity=n,this.cameraModule.beginExternalTransition(),r.promise()}stopTransition(){this.transition.active&&(this.cameraModule.endExternalTransition(),this.transition.active=!1),this.transition.deferred&&(this.transition.deferred.resolve(),this.transition.deferred=void 0)}updateTransition(e,t,i,n){let s=1,r=e/a.SI;if(this.transition.elapsed+=e,this.transition.elapsed>=this.transition.duration){s=(this.transition.duration-(this.transition.elapsed-e))/e,r=1}t&&(this.angularVelocity=this.transition.angularVelocity*r*s,this.roll(this.angularVelocity)),i&&(this.linearVelocity.copy(this.transition.linearVelocity).multiplyScalar(s*r),this.pan(this.linearVelocity)),n&&(this.zoomVelocity=this.transition.zoomVelocity*s*r,this.zoom(this.zoomVelocity)),this.transition.elapsed>=this.transition.duration&&(this.stop(this.transition.easeOut),this.transition.active=!1)}updateDefault(e,t,i,n){const s=e/a.SI;t&&(this.angularVelocity=this.angularVelocity+this.angularAccel*s,this.roll(this.angularVelocity),this.angularVelocity*=Math.pow(1-a.O8,s)),i&&(this.linearVelocity.addScaledVector(this.linearAccel,s),this.pan(this.linearVelocity),this.linearVelocity.multiplyScalar(Math.pow(1-a.O8,s))),n&&(this.zoomVelocity=this.zoomVelocity+this.zoomAccel*s,this.zoom(this.zoomVelocity),this.zoomVelocity*=Math.pow(1-a.TD,s))}update(e){const t=Math.abs(this.angularAccel)>l.Z.epsilon||Math.abs(this.angularVelocity)>l.Z.epsilon,i=this.linearAccel.length()>l.Z.epsilon||this.linearVelocity.length()>l.Z.epsilon,n=Math.abs(this.zoomAccel)>l.Z.epsilon||Math.abs(this.zoomVelocity)>l.Z.epsilon;this.transition.active?this.updateTransition(e,t,i,n):this.updateDefault(e,t,i,n)}stopMomentum(){this.transition.active||(this.angularVelocity=0,this.linearVelocity.set(0,0),this.zoomVelocity=0)}stopAcceleration(){this.transition.active||(this.setPanAcceleration({x:0,y:0}),this.setRollAcceleration(0),this.setZoomAcceleration(0))}stop(e=!1){this.stopTransition(),this.stopAcceleration(),e||this.stopMomentum()}pan(e){const t=this.cameraModule.getData(!1);this.positionDelta.x=e.x,this.positionDelta.z=e.y,this.currentPosition.copy(t.pose.position).add(this.positionDelta),this.checkBounds&&!this.insideBounds(this.currentPosition,t.pose.rotation,t.pose.projection)||this.cameraModule.updateCameraPosition(this.currentPosition)}roll(e){const t=this.cameraModule.getData(!1);this.currentOrientation.setFromAxisAngle(o.f.FORWARD,e),this.currentOrientation.multiplyQuaternions(t.pose.rotation,this.currentOrientation),this.currentOrientation.normalize(),this.checkBounds&&!this.insideBounds(t.pose.position,this.currentOrientation,t.pose.projection)||t.pose.rotation.equals(this.currentOrientation)||this.cameraModule.updateCameraRotation(this.currentOrientation)}zoom(e){const t=this.cameraModule.getData(!1);this.targetProjection.copy(t.pose.projection);const i=this.scale*(1-e);if(Math.abs(i-this.scale)>l.Z.epsilon){this.targetProjection.elements[0]*=i/this.scale,this.targetProjection.elements[5]*=i/this.scale;const n=(0,h.S3)(this.targetProjection);if(e<0&&n<=this.minZoom||e>0&&n>=this.maxZoom)return;if(this.checkBounds&&!this.insideBounds(t.pose.position,t.pose.rotation,this.targetProjection))return;this.scale=i,this.cameraModule.updateCameraProjection(this.targetProjection.clone())}}setupBounds(){this.bounds.min.x=this.adjustBound(this.bounds.min.x,2),this.bounds.min.y=this.adjustBound(this.bounds.min.y,2),this.bounds.min.z=this.adjustBound(this.bounds.min.z,2),this.bounds.max.x=this.adjustBound(this.bounds.max.x,-2),this.bounds.max.y=this.adjustBound(this.bounds.max.y,-2),this.bounds.max.z=this.adjustBound(this.bounds.max.z,-2),this.worldBounds=(new s.Box3).setFromCenterAndSize(this.boundsCenter,new s.Vector3(this.bounds.max.x-this.bounds.min.x,this.bounds.max.y-this.bounds.min.y,this.bounds.max.z-this.bounds.min.z))}insideBounds(e,t,i){return!!(0,c.cb)(e,t,i,this.worldBounds)}adjustBound(e,t){return Math.sign(e+t)===Math.sign(e)?e+t:0}}var p,m=i(77719),g=i(35597),f=i(76870),v=i(81507),y=i(88216),b=i(94329),S=i(68576),E=i(88814),w=i(81040),T=i(51869),_=i(38022),M=i(63757),x=i(88727),A=i(13988),O=i(67027),P=i(59088),D=i(736);!function(e){e[e.NONE=f.r3.NONE]="NONE",e[e.PAN=f.r3.PRIMARY]="PAN",e[e.ROTATE=f.r3.SECONDARY]="ROTATE",e[e.ZOOM=f.r3.MIDDLE]="ZOOM"}(p||(p={}));class FloorplanControls extends n.Y{constructor(){super(...arguments),this.name="floorplan-controls",this.controlState=p.NONE,this.controlsEngaged=!1,this.movementKeys=new s.Vector2,this.resetControlState=()=>{this.controlState=p.NONE}}async init(e,t){const[i,n,s,r,o]=await Promise.all([t.market.waitForData(O._),t.getModule(m.default),t.getModule(A.default),t.market.waitForData(P.M_),t.market.waitForData(g.O)]);this.cameraModule=n,this.cameraData=r,this.viewmodeData=o,this.modelSize=Math.max(i.size.length(),1),this.commonControlsModule=s,this.controls=new CameraControls(this.cameraModule,i.bounds,i.center,!0),this.commonControlsModule.addControls(b.Ey.Floorplan,this.controls),t.getModuleBySymbol(D.y.INPUT).then((e=>{this.bindings.push(e.registerHandler(w.a,(e=>{this.validateViewmode()&&this.onScrollWheel(e)}))),this.bindings.push(e.registerHandler(T.E0,(e=>{this.validateViewmode()&&this.onDragBegin(e.buttons)}))),this.bindings.push(e.registerHandler(T._t,(e=>{this.validateViewmode()&&(this.controlsEngaged=!0,this.onDrag(e.delta),this.controls.update(a.SI),this.controls.stop())}))),this.bindings.push(e.registerHandler(T._R,(e=>{this.validateViewmode()&&this.controlsEngaged&&(e.timeSinceLastMove<100&&(this.onDrag(e.delta),this.controls.update(a.SI),this.controls.stopAcceleration()),this.onDragEnd(e.delta,e.buttons),this.controlsEngaged=!1)}))),this.bindings.push(e.registerHandler(_.G,(e=>{this.validateViewmode()&&(this.controls.setZoomAcceleration(-e.pinchDelta*a.N4),this.controls.update(a.SI),this.controls.stop())}))),this.bindings.push(e.registerHandler(_.i,this.resetControlState)),this.bindings.push(e.registerHandler(M.D,(e=>{this.validateViewmode()&&(this.controls.setRollAcceleration(e.rotateDelta),this.controls.update(a.SI),this.controls.stop())}))),this.bindings.push(e.registerHandler(M.u,this.resetControlState)),this.bindings.push(e.registerHandler(x.e,(e=>{this.validateViewmode()&&e.state!==y.M.PRESSED&&this.onKey(e)})))})),this.bindings.push(t.subscribe(S.Z,(e=>{this.controls.stop(),this.resetControlState()}))),this.bindings.push(t.subscribe(E.Z,(e=>{e.toMode===b.Ey.Floorplan&&this.controls.start()})))}onUpdate(e){this.validateViewmode()&&this.controls.update(e)}onScrollWheel(e){if(0!==e.delta.y){const t=(0,c.et)(this.modelSize,1,1500,2,.125);this.controls.setZoomAcceleration(e.delta.y*a.jX/(t*a.mP)),this.controls.update(a.SI),this.controls.setZoomAcceleration(0)}}onDragBegin(e){if(this.controlState===p.NONE){const t=e;this.controlState=t}this.controls.stop()}onDrag(e){switch(this.controlState){case p.ROTATE:this.controls.setRollAcceleration(e.x*Math.PI);break;case p.PAN:const t=this.convertDeltaToLocal(e);this.controls.setPanAcceleration({x:-t.x,y:-t.z});break;case p.ZOOM:0!==e.y&&this.controls.setZoomAcceleration(-e.y)}}onDragEnd(e,t){t&this.controlState||(this.controlState=p.NONE)}onKey(e){const{key:t,state:i,modifiers:n}=e,s=i===y.M.DOWN;let r=!1;switch(t){case v.R.LEFTARROW:case v.R.J:this.controls.setRollAcceleration(s?a.YW:0,!0);break;case v.R.RIGHTARROW:case v.R.L:this.controls.setRollAcceleration(s?-a.YW:0,!0);break;case v.R.A:this.movementKeys.x=s?-1:0,r=!0;break;case v.R.D:this.movementKeys.x=s?1:0,r=!0;break;case v.R.W:this.movementKeys.y=s?1:0,r=!0;break;case v.R.S:this.movementKeys.y=s?-1:0,r=!0;break;case v.R.K:this.controls.setZoomAcceleration(s?a.Gu:0);break;case v.R.DOWNARROW:n.shiftKey||this.controls.setZoomAcceleration(s?a.Gu:0);break;case v.R.I:this.controls.setZoomAcceleration(s?-a.Gu:0);break;case v.R.UPARROW:n.shiftKey||this.controls.setZoomAcceleration(s?-a.Gu:0)}if(r){const e=this.convertDeltaToLocal(this.movementKeys).setLength(a.bC);this.controls.setPanAcceleration({x:e.x,y:e.z})}}validateViewmode(){return this.viewmodeData.currentMode===b.Ey.Floorplan}convertDeltaToLocal(e){const t=e.x||0,i=e.y||0,n=t/this.cameraData.pose.projection.elements[0],r=i/this.cameraData.pose.projection.elements[5],o=new s.Vector3;return o.set(n,r,0),o.applyQuaternion(this.cameraData.pose.rotation),o}}},76896:(e,t,i)=>{"use strict";i.d(t,{P:()=>EndMoveToFloorMessage});var n=i(91466);class EndMoveToFloorMessage extends n.v{constructor(e,t){super(),this.floorId=e,this.floorName=t}}},99487:(e,t,i)=>{"use strict";i.d(t,{O:()=>Floor});var n=i(2212);class OrderList{constructor(){this.list=[]}insort(e){const t=this.binarySearch(e);let i=t.index;if(!t.success)for(;this.compare(e,this.list[i])>=0&&i<this.list.length;)i++;for(let e=this.list.length;e>i;e--)this.list[e]=this.list[e-1];this.list[i]=e}removeIndex(e){if(e>this.list.length)throw Error("OrderList.removeIndex() -> Invalid index: "+e);this.list.splice(e,1)}getElement(e){if(e>=0&&e<this.list.length)return this.list[e];throw new Error("OrderList.getElement() -> Invalid index: "+e)}get length(){return this.list.length}find(e){const t=this.binarySearch(e);return t.success?t.index:-1}compare(e,t){return void 0===t?1:"number"==typeof e?e===t?0:e<t?-1:1:e.compare(t)}binarySearch(e){let t=0,i=this.list.length-1,n=-1,s=null,r=0;for(;t<=i;){if(n=Math.floor((t+i)/2),s=this.list[n],r=this.compare(e,s),0===r)return{success:!0,index:n};r<0?i=n-1:t=n+1}return{success:!1,index:n}}}var s=i(85861),r=i(23573);class Floor extends r.T{constructor(e={}){super(),this.name="",this.center=new n.Vector3,this.boundingBox=new n.Box3,this.size=new n.Vector3,this.runtimeOnly=!1,this.sweepHeights=new OrderList,this.sweepFloorHeights=new OrderList,this.medianSweepHeight=()=>this.sweepHeights.length>0?this.sweepHeights.getElement(Math.floor(this.sweepHeights.length/2)):this.center.y,this.minSweepFloorHeight=()=>this.sweepFloorHeights.length>0?this.sweepFloorHeights.getElement(0):this.boundingBox.min.y,Object.assign(this,e)}setBounds(e){this.boundingBox.copy(e),this.boundingBox.getSize(this.size),this.boundingBox.getCenter(this.center)}addSweep(e){this.sweepHeights.insort(e.position.y),this.sweepFloorHeights.insort(e.floorPosition.y)}get bottom(){return this.minSweepFloorHeight()}get top(){return this.sweepFloorHeights.length>0?this.sweepFloorHeights.getElement(this.sweepFloorHeights.length-1):this.boundingBox.max.y}deepCopy(){return(0,s.p$)({id:this.id,meshGroup:this.meshGroup,index:this.index,name:this.name,center:this.center,boundingBox:this.boundingBox,size:this.size,medianSweepHeight:this.medianSweepHeight(),bottom:this.bottom})}}},90454:(e,t,i)=>{"use strict";i.d(t,{S:()=>StartMoveToFloorMessage});var n=i(91466);class StartMoveToFloorMessage extends n.v{constructor(e,t){super(),this.from=e,this.to=t}}},74003:(e,t,i)=>{"use strict";i.d(t,{M:()=>SweepFloorOverrideMessage});var n=i(91466);class SweepFloorOverrideMessage extends n.v{constructor(e,t,i){super(),this.sweep=e,this.from=t,this.to=i}}},26627:(e,t,i)=>{"use strict";i.d(t,{i:()=>FloorsData});var n=i(32770),s=i(99487),r=i(44283),o=i(64781),a=i(53149);class FloorsData extends n.V{constructor(e){super(),this.name="floors",this.floors=(0,o.q)(e)}onNameChange(e){let t=[];return(0,r.k1)((()=>{this.getOrderedValues().forEach(((i,n)=>{t.push(i.onPropertyChanged("name",e))}))}),(()=>{t.forEach((e=>e.cancel())),t=[]}),!0)}getFloor(e){if(!this.floors.has(e))throw new a.H;return this.floors.get(e)}hasFloor(e){return this.floors.has(e)}getFloorAtIndex(e){return this.floors.values.find((t=>t.index===e))}getFloorByMeshGroup(e){return this.floors.values.find((t=>t.meshGroup===e))}mapMeshesToFloors(e){const t=new Map;for(const t of e){const{meshGroup:e,boundingBox:i}=t;let n=this.getFloorByMeshGroup(e);const r=(null==n?void 0:n.id)||String(e);n||(n=new s.O({id:r,meshGroup:e,index:e,runtimeOnly:!0}),this.floors.set(n.id,n)),n.setBounds(i)}return this.getOrderedValues().forEach(((e,i)=>{e.index=i,t.set(e.meshGroup,e.id)})),t}getFloorCount(){return this.floors.length}getCollection(){return this.floors}iterate(e){return this.getOrderedValues().forEach(e)}getTopFloor(){const e=this.getOrderedValues();if(!e.length)throw new a.H("Cannot get top floor, model has no floors");return e[e.length-1]}getBottomFloor(){const e=this.getOrderedValues();if(!e.length)throw new a.H("Cannot get bottom floor, model has no floors");return e[0]}getFloorAtHeight(e,t=!1){const i=this.getOrderedValues();t&&i.reverse();for(const t of i){const i=t.boundingBox;if(i.min.y<=e&&e<=i.max.y)return t}const n=this.getBottomFloor();return e<n.boundingBox.min.y?n:this.getTopFloor()}getClosestFloorAtHeight(e){let t,i=1/0;for(const n of this.floors){const s=Math.abs(n.medianSweepHeight()-e);i>s&&(i=s,t=n)}return t}rename(e,t){if(!this.floors.has(e))return;const i=this.floors.get(e);i.name=t,i.commit()}getOrderedValues(){return this.floors.values.sort(((e,t)=>e.index-t.index))}}},53149:(e,t,i)=>{"use strict";i.d(t,{H:()=>InvalidFloorException});var n=i(31102);class InvalidFloorException extends n.y{constructor(e="Invalid Floor"){super(e),this.name="InvalidFloorException"}}},66225:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>FloorDataModule});var n=i(2212),s=i(66097),r=i(47724),o=i(39729),a=i(71194),l=i(57361),c=i(26627),h=i(67027),d=i(26587),u=i(50988),p=i(38420),m=i(75892),g=i(35026),f=i(88512),v=i(81047),y=i(94474),b=i(99487);const S=new f.Z("mds-floor-deserializer");class MdsFloorDeserializer{deserialize(e){if(!e||!this.validate(e))return S.debug("Deserialized invalid floor data from MDS",e),null;const t=e.label||"",i=e.dimensions||{},{areaFloor:n}=i;return new b.O({id:e.id,index:e.sequence,meshGroup:e.meshId,name:t,areaFloor:n||-1})}validate(e){return["id","sequence","meshId"].every((t=>t in e))}}class MdsFloorPatchSerializer{serialize(e){return{label:e.name}}}class MdsFloorStore extends y.u{constructor(){super(...arguments),this.deserializer=new MdsFloorDeserializer,this.prefetchKey="data.model.floors"}async read(e={}){const t={modelId:this.getViewId()};return this.query(v.GetFloors,t,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.floors;if(!n||!Array.isArray(n))return null;return n.reduce(((e,t)=>{const i=this.deserializer.deserialize(t);return i&&(e[t.id]=i),e}),{})}))}async update(e,t){const i=this.getViewId(),n=(new MdsFloorPatchSerializer).serialize(t);if(!n)throw new Error("Could not update Floor");return this.mutate(v.PatchFloor,{modelId:i,floorId:e,data:n})}}var E=i(38330),w=i(80121),T=i(99398),_=i(18630),M=i(53149),x=i(85861);const A=e=>e.replace(/,/gi," ").trim(),O=e=>{if(!e||!e.floors)return null;const t={};return e.floors.split(",").forEach(((e,i)=>{const n=e.trim();(n||""===n)&&(t[i]=new b.O({id:String(i),name:n,meshGroup:i,index:i}))})),t},P=(e,t)=>{const i=(0,x.p$)(e);(0,x.TS)(i,t);const n=[];for(const e in i){const t=i[e];if(!t)continue;const s=A(t.name||""),r=parseInt(e,10);if(isNaN(r))throw new M.H(`Can't save non-numeric floor ID ${r}`);n[r]=s}return{floors:n.join(",")}};var D=i(74003);const C=new f.Z("floors-data");class FloorDataModule extends r.Y{constructor(){super(...arguments),this.name="floors"}async init(e,t){const{readonly:i}=e;this.engine=t,this.store=this.configureStorage(e);const[n,r,a,g]=await Promise.all([this.store.read(),t.market.waitForData(h._),t.market.waitForData(m.Z),t.getModule(d.F)]),f=a.getSweepList();this.data=new c.i(n||{});const v=this.data.mapMeshesToFloors([...r.meshGroups.floors]);if(r.setMeshIds({floorIdMap:v}),this.mapSweepsToFloors(f),t.market.register(this,c.i,this.data),this.fixupSweepsWithoutFloorData(f),!1===i){const e=this.data.getCollection();this.monitor=new l.c(e,{aggregationType:o.E.NextFrame},t),this.monitor.onChanged((()=>this.engine.commandBinder.issueCommand(new u.VQ({dataTypes:[p.g.FLOORS]})))),this.store instanceof s.N&&this.store.addMonitor(this.monitor),this.bindings.push(g.onSave((()=>this.save()),{dataType:p.g.FLOORS}),g.onRevert((()=>this.revert()),{dataType:p.g.FLOORS}))}}configureStorage(e){const{modelId:t,baseUrl:i,queue:n}=e,r=e.storageProvider||p.Xq.JSONSTORE,o=!("readonly"in e)||!!e.readonly;if(C.info(`Loading floors from ${r}`),r===p.Xq.MDS)return new MdsFloorStore({readonly:o,baseUrl:i});const a=function(e){const{modelId:t,readonly:i}=e,n=e.baseUrl||"",s=e.queue,r={data:null},o=`${n}/api/v1/player/models/${t}`;if(i){const e=new E.gh({queue:s,path:o,deserialize:O,cachedData:r});return new w.iY({publishStores:[e]})}const a=new E.yh({queue:s,path:o,httpMethod:E.w$.PATCH,deserialize:O,serialize:P}),l=`${n}/api/v1/jsonstore/model/workshopSession/${t}`,c=new _.Z({queue:s,path:l,cachedData:{data:null},deserialize:T.S.sessionObjectExtract(_.j.FloorNames,O),serialize:P},_.j.FloorNames);return new w.iY({publishStores:[a],editStore:c,editStoreKey:w.aw.FLOOR_NAMES})}({modelId:t,baseUrl:i,readonly:o,queue:n});return new s.N(a,{dataType:p.g.FLOORS,readonly:o,engine:this.engine})}onUpdate(){}mapSweepsToFloors(e){e.forEach((e=>{if(e.alignmentType===g.z9.ALIGNED){let t;t=e.floorId&&this.data.hasFloor(e.floorId)?this.data.getFloor(e.floorId):this.data.getClosestFloorAtHeight(e.position.y),t&&t.addSweep(e)}}))}fixupSweepsWithoutFloorData(e){const t=new n.Vector3;for(const i of e)if(null===i.floorId||!this.data.hasFloor(i.floorId)){t.setY(i.position.y);const e=this.data.getFloorAtHeight(i.position.y);(null==e?void 0:e.id)&&e.id!==i.floorId&&(C.debug(`Setting ${i.alignmentType} sweep ${i.id} from floor ${i.floorId} to ${e.id}`),this.engine.broadcast(new D.M(i,i.floorId,i.floorId)),i.floorId=e.id)}}getFloorMins(){const e=[];return this.data.iterate((t=>{e.push(t.bottom)})),e}async save(){const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=[];for(const i of e){const e=i.index;if(!e)throw new M.H(`Invalid floor '${i.index}'`);i.action===a.KI.updated&&t.push(this.store.update(e,i.diff))}return Promise.all(t)}async revert(){if(this.store instanceof s.N)return this.store.revert()}}},27326:(e,t,i)=>{"use strict";i.d(t,{c:()=>FloorsViewData});var n=i(17131),s=i(32770),r=i(13789),o=i(48715),a=i(35026),l=i(23573);class FloorState extends l.T{constructor(){super(...arguments),this.hidden=!1,this.navigable=!0,this.hasEnabledAlignedSweeps=!1,this.hasEnabledUnalignedSweeps=!1}}var c=i(64781),h=i(75256),d=i(21479);class FloorsStateHelper{constructor(e,t,i,n,s){this.floors=e,this.viewmodeData=t,this.sweepData=i,this.applicationData=n,this.currentFloorObservable=s,this.bindings=[],this.states=new c.v,this._navigableFloorIds=new h.d,this.hasEnabledAlignedSweeps=!1,this.updateFloorSweepData=()=>{const e=this.sweepData;this.isEditMode()||(this.states.values.forEach((e=>{e.hasEnabledAlignedSweeps=!1,e.hasEnabledUnalignedSweeps=!1})),e.iterate((e=>{if(null!==e.floorId){let t=this.getState(e.floorId);t||(t=this.initializeFloorState(e.floorId)),e.alignmentType===a.z9.ALIGNED?t.hasEnabledAlignedSweeps||(t.hasEnabledAlignedSweeps=e.enabled):t.hasEnabledUnalignedSweeps||(t.hasEnabledUnalignedSweeps=e.enabled),t.commit(),this.hasEnabledAlignedSweeps||(this.hasEnabledAlignedSweeps=e.enabled)}}))),this.updateNavigable()},this.updateHidden=()=>{const e=!this.currentFloorId,t=this.isViewingAlignedPano();this.states.keys.forEach((i=>{const n=!!i&&i===this.currentFloorId,s=this.getState(i);s.hidden=!(e||n||t),s.commit()}))},this.updateNavigable=()=>{const e=this.isEditMode(),t=this.isViewingAlignedPano();this.states.keys.forEach((i=>{const n=this.getState(i);n.navigable=!!e||(t?n.hasEnabledAlignedSweeps:n.hasEnabledAlignedSweeps||n.hasEnabledUnalignedSweeps),n.commit()}));const i=[];this.floors.iterate((e=>{this.getState(e.id).navigable&&i.push(e.id)})),this._navigableFloorIds.replace(i)},this.bindings.push(t.makeModeChangeSubscription(this.updateHidden),i.makeSweepChangeSubscription(this.updateHidden),s.onChanged(this.updateHidden),t.makeModeChangeSubscription(this.updateNavigable),i.makeSweepChangeSubscription(this.updateNavigable),n.onPropertyChanged("application",this.updateFloorSweepData)),this.initializeFloorStates(),this.updateFloorSweepData(),this.updateHidden()}getState(e){return this.states.get(e)}get navigableFloorIds(){return this._navigableFloorIds.values()}onNavigableFloorIdsChanged(e){return this._navigableFloorIds.onChanged(e)}isViewingAlignedPano(){return this.viewmodeData.isPano()&&void 0!==this.sweepData.currentAlignedSweepObject}isEditMode(){return this.applicationData.application===d.Mx.WORKSHOP}get currentFloorId(){return this.currentFloorObservable.value?this.currentFloorObservable.value.id:null}initializeFloorStates(){this.floors.iterate((e=>this.initializeFloorState(e.id)))}initializeFloorState(e){const t=new FloorState;return this.states.set(e,t),t}}function u(e,t){return e}const p={floorChangesEnabled:()=>!0,roomNavFeatureEnabled:()=>!0};class FloorsViewData extends s.V{constructor(e,t,i,s,r,a){super(),this.name="floors-view",this.floorSelectable=!1,this.currentFloorObservable=new o.f(null),this._observableFloorsSelectMode=new o.f(!1),this._observableRoomSelectMode=new o.f(!1),this._showFloorSelection=new o.f(!1),this.getFloorMin=e=>{const t=e||(this.currentFloorId||this.bottomFloorId);return this.floors.getFloor(t).bottom},this.isHidden=e=>this.stateHelper.getState(e).hidden,this.isNavigable=e=>this.stateHelper.getState(e).navigable,this.getHighestVisibleFloor=()=>this.currentFloor?this.currentFloor:this.floors.getTopFloor(),this.getHighestVisibleFloorId=()=>this.getHighestVisibleFloor().id,this.updateViewData=()=>{this.floors.iterate((e=>{this.derivedData[e.id]={id:e.id,index:e.index,name:this.getFloorName(e.id)}})),this.commit()},this.getViewData=e=>{if(!this.derivedData[e]){const t=this.floors.getFloor(e);this.derivedData[e]={id:t.id,index:t.index,name:this.getFloorName(t.id)}}return this.derivedData[e]},this.getAllViewData=()=>{const e=[];return this.floors.iterate((t=>{e.push(this.getViewData(t.id))})),e},this.getFloor=e=>this.floors.getFloor(e),this.floors=e,this.config=null!=a?a:p,this.localize=null!=r?r:u,this.derivedData={},this._transition={from:null,to:null,progress:new n.z(0),promise:Promise.resolve()},this.stateHelper=new FloorsStateHelper(e,t,i,s,this.currentFloorObservable),this.updateViewData()}isCurrentOrAllFloors(e){return!e||!this.currentFloorId||e===this.currentFloorId}makeFloorChangeSubscription(e){return this.currentFloorObservable.onChanged(e)}get currentFloor(){return this.currentFloorObservable.value}get currentFloorId(){var e;return(null===(e=this.currentFloorObservable.value)||void 0===e?void 0:e.id)||null}get bottomFloorId(){return this.floors.getBottomFloor().id}get topFloorId(){return this.floors.getTopFloor().id}get nearestFloor(){let e;return e=this.transitionActive?this.transition.progress.value>.5?this.transition.to:this.transition.from:this.currentFloorId,e?this.floors.getFloor(e):void 0}get transitionActive(){return this.transition.progress.active}get transition(){return this._transition}transitionToFloorInstant(e){this.currentFloorObservable.value=e?this.floors.getFloor(e):null,this.commit()}transitionToFloor(e,t,i,n){const s=this._transition.progress;s.modifyAnimation(0,1,i),this._transition={from:e,to:t,progress:s,promise:n},this.commit(),n.then((()=>{this.transitionToFloorInstant(t)}))}get totalFloors(){return this.floorsEnabled?this.floors.getFloorCount():1}hasEnabledAlignedSweeps(e){return null!==e?this.stateHelper.getState(e).hasEnabledAlignedSweeps:this.stateHelper.hasEnabledAlignedSweeps}getNavigableFloorIds(){return this.stateHelper.navigableFloorIds}onNavigableFloorIdsChanged(e){return this.stateHelper.onNavigableFloorIdsChanged(e)}getFloorIdMap(){const e={};return this.iterate((t=>{e[t.id]={id:t.id,name:t.name,items:[]}})),e}iterate(e){this.floors.iterate((t=>{const i=this.getViewData(t.id);i&&e(i)}))}getFloorNames(){const e=[];return this.floorsEnabled?(this.floors.iterate((t=>{e[t.index]=this.getFloorName(t.id)})),e):e}getFloorName(e){if(!e)return this.localize(r.Z.FLOOR_ALL);const t=this.floors.getFloor(e);return void 0!==t.name&&""!==t.name?t.name:this.getDefaultFloorName(e)}getDefaultFloorName(e){const t=this.floors.getFloor(e);return this.localize(r.Z.SHOWCASE.FLOORS.DEFAULT_NAME,t.index+1)}getFloorsVisibility(){if(this.currentFloorId){const e=[];return this.floors.iterate((t=>{e[t.index]=t.id===this.currentFloorId?1:0})),e}return[]}get floorsEnabled(){return this.config.floorChangesEnabled()}get floorSelectModeEnabled(){return this.config.roomNavFeatureEnabled()}get floorSelectModeActive(){return this._observableFloorsSelectMode.value}set floorSelectModeActive(e){const t=e&&this.floorsEnabled&&this.floorSelectModeEnabled;t!==this._observableFloorsSelectMode.value&&(this._observableFloorsSelectMode.value=t,this.commit())}onFloorSelectModeChange(e){return this._observableFloorsSelectMode.onChanged(e)}get showFloorSelection(){return this._showFloorSelection.value}set showFloorSelection(e){(e&&this.floorSelectModeEnabled)!==this._showFloorSelection.value&&(this._showFloorSelection.value=e&&this.floorSelectModeEnabled,this.commit())}onShowFloorSelectionChanged(e){return this._showFloorSelection.onChanged(e)}get roomSelectModeActive(){return this._observableRoomSelectMode.value}set roomSelectModeActive(e){const t=e&&this.floorSelectModeEnabled||!this.floorSelectModeEnabled;t!==this._observableRoomSelectMode.value&&(this._observableRoomSelectMode.value=t,this.commit())}onRoomSelectModeChange(e){return this._observableRoomSelectMode.onChanged(e)}}},2725:(e,t,i)=>{"use strict";i.d(t,{Vw:()=>MoveToFloorCommand,h9:()=>MoveToFloorIndexCommand,EU:()=>ShowAllFloorsCommand});var n=i(17386);class MoveToFloorCommand extends n.m{constructor(e,t=!1,i,n){super(),this.id="MOVETO_FLOOR",this.payload={floorId:e,suppressCameraMovement:t,transitionTime:i,focusPoint:n}}}class MoveToFloorIndexCommand extends n.m{constructor(e,t=!1,i,n){super(),this.id="MOVETO_FLOOR_NUMBER",this.payload={floorIndex:e,suppressCameraMovement:t,transitionTime:i,focusPoint:n}}}class ShowAllFloorsCommand extends n.m{constructor(e){super(),this.id="SHOW_ALL_FLOORS",this.payload=e}}},84285:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>FloorsViewDataModule});var n=i(47724),s=i(88512),r=i(77719),o=i(41452),a=i(88727),l=i(94610),c=i(81507),h=i(88216),d=i(75892),u=i(35597),p=i(59088),m=i(67027),g=i(76896),f=i(85895),v=i(68576),y=i(44019),b=i(94329),S=i(69941),E=i(21479),w=i(8150),T=i(26627),_=i(27408),M=i(2388),x=i(51245);class FloorsRenderer{constructor(e,t,i,n,s,r,o){this.getAngleModifier=e,this.pose=t,this.floorsViewData=i,this.viewmodeData=n,this.raycasterData=s,this.meshData=r,this.touchDevice=o,this.getDiscardDistance=e=>{if(e){return 4+(this.pose.focalDistance*M.xx.DISCARD_FOCAL_MULTI||0)}return 0}}activate(){}init(){}dispose(){}deactivate(){const{floorOpacity:e,roomFadeDist:t}=this.meshData.meshGroupVisuals;for(const e of this.meshData.meshGroups.rooms.keys())t.set(e,0);for(const t of this.meshData.meshGroups.floors.values())e.set(t.meshGroup,0)}beforeRender(){const e=this.floorsViewData.nearestFloor,t=this.floorsViewData.transition.progress.active,i=!(!e||this.viewmodeData.isPano()),n=M.xx.FADE_OPAQUE;let s=n,r=n;const o=this.getAngleModifier();i&&(this.floorsViewData.floorSelectModeEnabled&&this.viewmodeData.isDollhouse()?(s=n*o*M.xx.FADE_IN_VALUE,r=s*M.xx.FADE_BELOW_MULT+M.xx.FADE_BELOW_START):(s=M.xx.FADE_ABOVE,r=M.xx.FADE_BELOW));for(const{meshGroup:e}of this.meshData.meshGroups.floors){const i=this.floorsViewData.floors.getFloorByMeshGroup(e);let o=n;const a=this.isBelowSelectedFloor(i)?r:s;let l=(0,_.uZ)(a+M.xx.FADE_IN_HOVER_BOOST_VALUE,0,1);this.floorsViewData.roomSelectModeActive&&(l=a),o=this.isHoveredFloor(null==i?void 0:i.id)&&!t&&a>0?l:a,o=this.isFloorTransitioningOut(i)?a:o,o=this.isSelectedFloor(null==i?void 0:i.id)||this.isFloorTransitioningIn(i)?n:o,o=this.clampForViewmodeTransitions(o),this.meshData.meshGroupVisuals.floorOpacity.set(e,o)}const a=!(!e||!this.viewmodeData.isDollhouse());for(const[e,t]of this.meshData.meshGroups.roomsByFloor.entries())for(const i of t){const t=this.getDiscardDistance(a&&i>e);this.meshData.meshGroupVisuals.roomFadeDist.set(i,t)}}render(){}clampForViewmodeTransitions(e){if(this.viewmodeData.currentMode===b.Ey.Transition){const{to:t}=this.viewmodeData.transition;if(t===b.Ey.Panorama)return Math.max(1-this.meshData.meshTextureOpacity.value,e)}return e}isHoveredFloor(e){if(void 0!==e&&this.raycasterData.hit&&this.viewmodeData.isDollhouse()&&!this.touchDevice&&this.floorsViewData.isNavigable(e)){const t=this.raycasterData.hit.object;if(x.$4.hasFloorId(t))return e===t.floorId}return!1}isSelectedFloor(e){const t=this.floorsViewData.nearestFloor;return!t||!(!e||t.id!==e)}isBelowSelectedFloor(e){const t=this.floorsViewData.nearestFloor;return!!(e&&t&&t.index>e.index)}isFloorTransitioningIn(e){return!(!e||!this.floorsViewData.transition.progress.active||this.floorsViewData.transition.to&&this.floorsViewData.transition.to!==e.id)}isFloorTransitioningOut(e){return!(!e||!this.floorsViewData.transition.progress.active||this.floorsViewData.transition.from&&this.floorsViewData.transition.from!==e.id&&this.floorsViewData.transition.to===e.id)}}var A=i(64185),O=i(90454),P=i(76701),D=i(31278),C=i(29422),I=i(2212),L=i(12216),R=i(69626),N=i(51263),k=i(57051),B=i(53149),F=i(95586);class FloorsNavigation{constructor(e,t,i,n,s,r,o,a,l){this.engine=e,this.floorsData=t,this.floorsViewData=i,this.sweepData=n,this.cameraData=s,this.cameraModule=r,this.viewmodeData=o,this.updateCurrentFloor=a,this.meshData=l,this.FLOOR_TRANSITION_TIME=500,this.moveFloorUp=(e=!1,t)=>{const i=this.floorsViewData.currentFloorId,n=this.floorsViewData.getNavigableFloorIds(),s=i?n.indexOf(i):-1;let r=n[s+1];return void 0===r&&(r=this.viewmodeData.isPano()?n[n.length-1]:n[0]),this.moveToFloor(r,e,t)},this.moveFloorDown=(e=!1,t)=>{const i=this.floorsViewData.currentFloorId,n=this.floorsViewData.getNavigableFloorIds(),s=i?n.indexOf(i):n.length;let r=n[s-1];return void 0===r&&(r=this.viewmodeData.isPano()?n[0]:n[n.length-1]),this.moveToFloor(r,e,t)},this.moveToFloor=(e,t=!1,i,n)=>{const s=this.floorsViewData.currentFloorId,r=s===e,o=this.floorsViewData.totalFloors<2&&!e,a=e?this.floorsViewData.floors.getFloor(e):null;if(r||o||!this.floorsViewData.floorsEnabled)return this.updateCurrentFloor(e),A.Q.resolve();if(a&&!this.canMoveToFloor(a,t))return A.Q.reject(new B.H("Invalid floor ID"));this.engine.broadcast(new O.S(s,e)),void 0===i&&(i=this.FLOOR_TRANSITION_TIME);const l=new A.Q;let c;this.floorsViewData.transitionToFloor(s,e,i,l.nativePromise()),this.floorsViewData.commit();let h,d=n;if(this.viewmodeData.isPano()){const t=e=>e=>this.floorsViewData.isCurrentOrAllFloors(e.floorId),i=!!e?N.nK:t,s=[(0,N._T)(),(0,N._k)(),i(e)],r=[(0,k.l0)(n||this.cameraData.pose.position)],o=this.sweepData.sortByScore(s,r).shift();o&&(d=o.sweep.position,c=o.sweep.id)}else null!==e&&this.engine.commandBinder.issueCommand(new F.aK);h=t?Promise.resolve():this.getCameraTransition(e,i,c,d);const u=this,p=A.Q.all([l,h]);return this.engine.startGenerator((function*(){let e=Date.now();for(;u.floorsViewData.transition.progress.active;){yield new P.Jj;const t=Date.now(),i=t-e;u.floorsViewData.transition.progress.tick(i),u.floorsViewData.commit(),e=t}u.updateCurrentFloor(u.floorsViewData.transition.to),l.resolve()})),p}}moveToFloorIndex(e,t=!1,i,n){let s=null;if(-1!==e){const t=this.floorsViewData.floors.getFloorAtIndex(e);if(!t)return A.Q.reject(new B.H(`Invalid floor index ${e}`));s=t.id}return this.moveToFloor(s,t,i,n)}canMoveToFloor(e,t=!1){if(!e)return!1;const i=this.floorsViewData.transition.progress.active,n=this.cameraData.canTransition()||t,s=e.index<=this.floorsViewData.totalFloors-1,r=e.index>=-1;return!i&&n&&s&&r}getCameraTransition(e,t,i,n){if(this.viewmodeData.currentMode===b.Ey.Dollhouse||this.viewmodeData.currentMode===b.Ey.Floorplan){const i=this.getPoseForFloor(e,n);return this.cameraModule.moveTo({transitionType:D.n.Interpolate,pose:i.pose,focalDistance:i.focalDistance,transitionTime:t}).nativePromise()}return this.viewmodeData.currentMode===b.Ey.Panorama&&i?this.engine.commandBinder.issueCommand(new C.ju({transition:D.n.Interpolate,sweep:i})):Promise.resolve()}getPoseForFloor(e,t){const{position:i,rotation:n}=this.cameraData.pose,s=e?this.floorsData.getFloor(e):null,r=s?s.medianSweepHeight():this.meshData.center.y,o=s?s.center:this.meshData.center;o.setY(r);const a=L.f.FORWARD.clone().applyQuaternion(n),l=i.clone();let c,h;if(t){const e=i.clone().addScaledVector(a,this.cameraData.pose.focalDistance),n=(new I.Vector3).set(0,i.y,0),s=(new I.Vector3).set(0,e.y,0),o=n.distanceTo(s);l.setY(r+o);const d=e.clone().setY(t.y);h=d.distanceTo(l),this.viewmodeData.isDollhouse()&&(c=(0,R.n0)(l,d))}else{const e=(s?s.size.y:U)/2+U*-a.y;l.setY(r+e),h=l.distanceTo(o)}return{focalDistance:h,pose:{position:l,rotation:c}}}}const U=8;var V=i(27326),H=i(2725),G=i(79437),z=i(19674),W=i(7170);class FloorsSelectModeHelper{constructor(e,t,i){this.floorsViewData=e,this.viewmodeData=t,this.pose=i,this.vectors={lookDir:new I.Vector3,flattenedLookDir:new I.Vector3},this.getAngleModifier=this.getAngleModifier.bind(this)}update(){const e=this.getAngleModifier(),t=1===this.floorsViewData.totalFloors,i=!!this.floorsViewData.nearestFloor,n=!this.viewmodeData.isPano()&&!this.viewmodeData.transitionActive();this.floorsViewData.roomSelectModeActive=n&&(t||i&&e<1||this.viewmodeData.isFloorplan()),this.floorsViewData.floorSelectModeActive=n&&1===e&&!t,this.floorsViewData.showFloorSelection=!this.viewmodeData.transitionActive()&&(this.viewmodeData.isDollhouse()||this.viewmodeData.isFloorplan())&&i&&!t,this.floorsViewData.floorSelectable=this.floorsViewData.floorSelectModeEnabled&&this.viewmodeData.currentMode===b.Ey.Dollhouse}getAngleModifier(){const e=this.vectors.lookDir.copy(L.f.FORWARD).applyQuaternion(this.pose.rotation),t=this.vectors.flattenedLookDir.copy(e).setY(0),i=e.angleTo(t)*W.MN,n=M.xx.FADE_IN_START_ANGLE,s=M.xx.FADE_IN_END_ANGLE,r=1-(0,z.dS)(i,n,s,0,1);return(0,G.FG)(r,0,1,1)}}var j=i(60771),K=i(17490),q=i(24764),Z=i(4901),Y=i(14092),$=i(33874),Q=i(73844),X=i(88814),J=i(3248),ee=i(736);const te=new s.Z("floors-view-data");class FloorsViewDataModule extends n.Y{constructor(){super(...arguments),this.name="floors-viewdata",this.onEndMoveToSweepMessage=e=>{const t=this.sweepData.getSweep(e.toSweep);t&&this.updateCurrentFloor(t.floorId)},this.onMoveToFloorCommand=async e=>this.floorNavigation.moveToFloor(e.floorId,e.suppressCameraMovement,e.transitionTime,e.focusPoint),this.onMoveToFloorIndexCommand=async e=>this.floorNavigation.moveToFloorIndex(e.floorIndex,e.suppressCameraMovement,e.transitionTime,e.focusPoint),this.onShowAllFloorsCommand=async e=>{const t="boolean"==typeof e.moveCamera&&!e.moveCamera;await this.engine.commandBinder.issueCommand(new H.Vw(null,t))},this.applicationChanged=()=>{this.floorsViewData.updateViewData()},this.updateCurrentFloor=e=>{this.config.allowFloorChanges&&this.floorsViewData.currentFloorId!==e&&(this.floorsViewData.transitionToFloorInstant(e),this.engine.broadcast(new g.P(e,this.floorsViewData.getFloorName(e))))},this.updateFloorSelectMode=()=>{var e;null===(e=this.floorsSelectModeHelper)||void 0===e||e.update()},this.floorSelectFeatureEnabledCheck=()=>{const e=this.settingsData.tryGetProperty(Q.ws,!0),t=this.settingsData.tryGetProperty(J.gx.FloorSelect,!0),i=this.applicationData.application===E.Mx.WORKSHOP;this.toggleFloors(i||e&&t)}}async init(e,t){this.engine=t,this.config=e,[this.floorsData,this.settingsData,this.applicationData,this.sweepData,this.viewmodeData]=await Promise.all([t.market.waitForData(T.i),t.market.waitForData($.e),t.market.waitForData(E.pu),t.market.waitForData(d.Z),t.market.waitForData(u.O)]);const i=await t.getModule(o.default),n={floorChangesEnabled:()=>this.config.allowFloorChanges,roomNavFeatureEnabled:()=>this.settingsData.tryGetProperty(Q.Q5,!1)};if(this.floorsViewData=new V.c(this.floorsData,this.viewmodeData,this.sweepData,this.applicationData,i.t.bind(i),n),this.floorSelectFeatureEnabledCheck(),t.market.register(this,V.c,this.floorsViewData),[this.cameraData,this.input,this.raycasterData]=await Promise.all([t.market.waitForData(p.M_),t.getModuleBySymbol(ee.y.INPUT),t.market.waitForData(y.P)]),this.config.allowFloorChanges&&this.viewmodeData.currentMode===b.Ey.Panorama&&this.sweepData.currentSweepObject){const e=this.sweepData.currentSweepObject.floorId;e&&(te.debug(`Set initial floor to ${e} from current sweep`),this.updateCurrentFloor(e))}const[s,a]=await Promise.all([t.getModule(r.default),t.market.waitForData(m._)]);this.floorNavigation=new FloorsNavigation(t,this.floorsData,this.floorsViewData,this.sweepData,this.cameraData,s,this.viewmodeData,this.updateCurrentFloor,a),this.floorsSelectModeHelper=new FloorsSelectModeHelper(this.floorsViewData,this.viewmodeData,this.cameraData.pose);const l=new FloorsRenderer(this.floorsSelectModeHelper.getAngleModifier,this.cameraData.pose,this.floorsViewData,this.viewmodeData,this.raycasterData,a,(0,j.Jm)());t.addComponent(this,l),this.settingsData.tryGetProperty(Q.Q5,!1)&&this.config.allowFloorChanges&&this.registerFloorHoverCursorEffect(),this.bindings.push(this.registerKeys(),t.subscribe(w.bS,this.applicationChanged),this.floorsData.onChanged(this.floorsViewData.updateViewData),t.subscribe(f.Z,this.onEndMoveToSweepMessage),t.subscribe(v.Z,function(e,t,i){let n=!1;return s=>{const r=e.tryGetData(S.k3);if(!r||r&&r.isTourActive())return;s.toMode===b.Ey.Panorama&&(n=null!==i.currentFloorId);const o=s.fromMode===b.Ey.Panorama,a=s.toMode===b.Ey.Floorplan,l=s.toMode===b.Ey.Dollhouse;if(!o||!l&&!a)return;const c=n||a?i.currentFloorId:null;t(new H.Vw(c,!0,0))}}(t.market,t.commandBinder.issueCommand,this.floorsViewData)),t.commandBinder.addBinding(H.Vw,this.onMoveToFloorCommand),t.commandBinder.addBinding(H.h9,this.onMoveToFloorIndexCommand),t.commandBinder.addBinding(H.EU,this.onShowAllFloorsCommand),t.subscribe(X.Z,this.updateFloorSelectMode),this.cameraData.pose.onChanged(this.updateFloorSelectMode),this.floorsViewData.onChanged(this.updateFloorSelectMode),this.settingsData.onPropertyChanged(Q.ws,this.floorSelectFeatureEnabledCheck),this.settingsData.onPropertyChanged(J.gx.FloorSelect,this.floorSelectFeatureEnabledCheck),this.applicationData.onPropertyChanged("application",this.floorSelectFeatureEnabledCheck)),this.updateFloorSelectMode()}onUpdate(){}toggleFloors(e){e||null===this.floorsViewData.currentFloorId||this.updateCurrentFloor(null),this.config.allowFloorChanges=e,this.updateFloorSelectMode()}registerKeys(){return this.input.registerHandler(a.e,(async e=>{if(!this.cameraData.canTransition())return;const t=e.modifiers.shiftKey;if(e.state===h.M.PRESSED)switch(e.key){case c.R.UPARROW:t&&this.floorNavigation.moveFloorUp();break;case c.R.DOWNARROW:t&&this.floorNavigation.moveFloorDown();break;case c.R.R:this.floorNavigation.moveFloorUp();break;case c.R.F:this.floorNavigation.moveFloorDown();break;case c.R.Y:this.floorNavigation.moveToFloor(null)}}))}registerFloorHoverCursorEffect(){const e=q.s.is((e=>x.$4.isRoomMesh(e)&&e.raycastEnabled&&this.floorsViewData.floorSelectable)),t=new K.V(this.input.registerMeshHandler(l.z,e,(e=>{this.engine.commandBinder.issueCommand(new Z.u(Y.C.FINGER))})),this.input.registerMeshHandler(l.A,e,(e=>{this.engine.commandBinder.issueCommand(new Z.u(Y.C.DEFAULT))})));t.cancel();const i=(()=>{let e=!1;return()=>{const i=this.floorsViewData.floorSelectModeEnabled;i!==e&&(e=i,e?t.renew():(t.cancel(),this.engine.commandBinder.issueCommand(new Z.u(Y.C.DEFAULT))))}})();i(),this.bindings.push(this.viewmodeData.onChanged(i),this.floorsViewData.onFloorSelectModeChange(i),this.floorsViewData.makeFloorChangeSubscription(i),t)}}},73844:(e,t,i)=>{"use strict";i.d(t,{Q5:()=>n,ws:()=>s,u_:()=>r,gu:()=>o});const n="features/roomnav",s="features/floorselect",r="features/current_floor_indicator",o="features/floor_name_overlay"},89046:(e,t,i)=>{"use strict";i.d(t,{Bz:()=>ToggleModalCommand,rE:()=>CloseModalCommand,Mn:()=>ToggleIconToolbarCommand});var n=i(17386);class ToggleModalCommand extends n.m{constructor(e,t){super(),this.payload={modal:e,open:t}}}ToggleModalCommand.id="TOGGLE_MODAL";class CloseModalCommand extends n.m{constructor(){super()}}CloseModalCommand.id="CLOSE_MODAL";class ToggleIconToolbarCommand extends n.m{constructor(e){super(),this.payload={open:e}}}ToggleIconToolbarCommand.id="TOGGLE_ICON_TOOLBAR"},49080:(e,t,i)=>{"use strict";var n;i.d(t,{P:()=>n}),function(e){e.TERMS="terms",e.VR_SELECT="vrSelect",e.MATTERTAG_PHOTO="mattertag",e.MATTERTAG_EMBED="mattertagEmbLink",e.HELP="help",e.CTA="cta",e.MEASUREMENT_HELP="measurementModeHelp",e.SHARE="share",e.ATTACHMENT="attachmentViewer",e.ADD_FROM_PHOTOS="add_from_photos",e.HIGHLIGHT_EDITOR="highlight_editor",e.REVERT_CHANGES="revert_unpublished_modal",e.HLR_SETTINGS="hlr_settings",e.NOTES_INTRO="notes_intro",e.RATING_THANK_YOU="rating_thank_you"}(n||(n={}))},24033:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Gui});var n=i(26605),s=i(47724),r=i(736),o=i(41452),a=i(17386);class GuiErrorCommand extends a.m{constructor(e,t){super(),this.id="DEFAULT_ERROR",this.payload={messagePhraseKey:e,options:t}}}var l=i(94184),c=i(91466);class AlertNotificationMessage extends c.v{constructor(e){super(),this.open=e}}var h=i(19806);const d=new(i(88512).Z)("alert-notification");var u;!function(e){e.INFO="info",e.SUCCESS="success",e.WARNING="warning",e.ERROR="error"}(u||(u={}));class AlertNotification extends n.Component{constructor(e){super(e),this.throttledMessages=new Map,this.onClose=()=>{clearTimeout(this.alertTimer),this.setState({open:!1})},this.state={open:!1}}componentDidMount(){this.update()}componentWillUnmount(){this.state.open&&this.props.messageBus.broadcast(new AlertNotificationMessage(!1))}componentWillReceiveProps(e){this.update(e)}componentDidUpdate(e,t){this.state.open!==t.open&&this.props.messageBus.broadcast(new AlertNotificationMessage(this.state.open))}update(e=this.props){const{show:t,timeout:i,message:n,throttle:s,type:r}=e,{analytics:o}=this.context;if(t){if(s>0){if(this.throttledMessages.has(n)&&this.throttledMessages.get(n)>Date.now())return void d.debug(`Suppressed alert dialog due to message throttling: ${n}`);this.throttledMessages.set(n,Date.now()+1e3*s)}clearTimeout(this.alertTimer),this.setState({open:!0}),i>0&&(this.alertTimer=window.setTimeout(this.onClose,1e3*i)),o&&o.track("alert_gui",{alert_action:"show",alert_type:r,alert_message:n})}}render(){const{title:e,message:t,type:i}=this.props,{open:s}=this.state,r={active:s,[`notification-${i}`]:!0};return(0,n.h)("aside",{class:l("alert-notification",r)},(0,n.h)("div",{class:"notification-body"},e&&(0,n.h)("h3",{class:"notification-title"},e),(0,n.h)("p",{class:"notification-text"},t)),(0,n.h)(h.P,{buttonStyle:h.A.LIGHT,onClose:this.onClose,hideTooltip:!0}))}}AlertNotification.defaultProps={type:u.INFO,show:!1,timeout:10,throttle:0};var p=i(61645);class ErrorBar extends n.Component{constructor(e){super(e),this.bindings=[],this.state={guiError:!1,errorMessagePhraseKey:""}}componentDidMount(){const{commandBinder:e}=this.props;this.bindings.push(e.addBinding(GuiErrorCommand,(async e=>{this.showErrorMessage(e.messagePhraseKey,e.options)})))}componentWillUnmount(){this.bindings.forEach((e=>e.cancel())),this.bindings.length=0}componentDidUpdate(e,t){const{guiError:i}=this.state;i&&this.setState({guiError:!1})}getChildContext(){return{analytics:this.props.analytics,commandBinder:this.props.commandBinder,locale:this.props.locale,messageBus:this.props.messageBus,market:this.props.market}}showErrorMessage(e,t){this.setState({guiError:!0,errorMessagePhraseKey:e,errorOptions:t})}render(){const{messageBus:e,locale:t}=this.props,{guiError:i,errorMessagePhraseKey:s,errorOptions:r}=this.state;let o=s&&t.t(s);const{error:a}=r||{};return a&&(0,p.bh)(a)&&(o=`${o} (${a.code})`),(0,n.h)(AlertNotification,Object.assign({messageBus:e,show:i,message:o},r))}}var m=i(33874),g=i(81347);class Gui extends s.Y{constructor(){super(...arguments),this.name="gui",this.workshopApp=!1,this.onAppReadyChanged=(e,t)=>{this.workshopApp&&(t&&e?this.mainDiv.classList.add("edit-mode"):this.mainDiv.classList.remove("edit-mode"))}}async init(e,t){this.workshopApp=e.workshopApp,this.mainDiv=e.mainDiv,this.container=e.container,this.queue=e.queue,this.engine=t,this.messageBus=t,this.market=t.market,this.commandBinder=t.commandBinder;const i=t.getModule(o.default),n=t.getModuleBySymbol(r.y.SHOWCASE_ANALYTICS),s=t.market.waitForData(g.m),a=t.market.waitForData(m.e);this.mainArgs=await Promise.all([i,n,a,s]),this.preactRenderer=new PreactRenderer,t.addComponent(this,this.preactRenderer),this.loadErrorBar(this.mainArgs)}dispose(e){e.removeComponent(this,this.preactRenderer),this.bindings.forEach((e=>{e.cancel()})),this.bindings=[]}async loadUi(e){let t=[];return t=t.concat(this.mainArgs),t=t.concat([this.mainDiv,this.engine,this.messageBus,this.market,this.commandBinder,this.onAppReadyChanged,this.queue]),e.apply(this,t)}loadErrorBar(e){((e,t,i,s,r,o,a)=>{const l=document.createElement("div");l.className="error-bar",s.insertBefore(l,s.firstElementChild),(0,n.render)((0,n.h)(ErrorBar,{messageBus:e,commandBinder:t,market:i,analytics:r,settings:o,locale:a}),l)})(this.engine,this.commandBinder,this.market,this.container,e[1],e[2],e[0])}}class PreactRenderer{render(){(0,n.rerender)()}init(){}dispose(){}activate(e){}deactivate(e){}}},84842:(e,t,i)=>{"use strict";i.d(t,{nV:()=>ModalToggledMessage,nZ:()=>PopupMenuOpenedMessage,Z_:()=>LoadIndicatorMessage,bN:()=>LoadIndicatorSuppressMessage});var n=i(91466);class ModalToggledMessage extends n.v{constructor(e,t){super(),this.modal=e,this.open=t}}class PopupMenuOpenedMessage extends n.v{constructor(e){super(),this.id=e}}class LoadIndicatorMessage extends n.v{constructor(e){super(),this.isOpen=e}}class LoadIndicatorSuppressMessage extends n.v{constructor(e){super(),this.suppress=e}}},33746:(e,t,i)=>{"use strict";i.d(t,{lZ:()=>n,ig:()=>s,oO:()=>c});var n,s,r=i(26605),o=i(2116),a=i(94184),l=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e.UP="up",e.DOWN="down",e.LEFT="left",e.RIGHT="right",e.UP_LEFT="up-left",e.UP_RIGHT="up-right",e.DOWN_LEFT="down-left",e.DOWN_RIGHT="down-right"}(n||(n={})),function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large",e.XLARGE="xlarge",e.FIT="fit"}(s||(s={}));let c=class DataBalloon extends r.Component{constructor(){super(),this.onClick=e=>{this.props.showOnClick&&this.setState((e=>({persist:!e.persist}))),void 0!==this.props.tooltipTimeout&&window.setTimeout((()=>{this.setState({tooltipEnabled:!1})}),this.props.tooltipTimeout)},this.onMouseEnter=e=>{this.enableTooltip(),this.adjustBalloonPosIfNeeded(e)},this.enableTooltip=()=>{this.setState({tooltipEnabled:!0})},this.state={currentPosition:null,tooltipEnabled:!0,persist:!1}}render(){const{children:e,position:t,content:i,className:n,tooltipWidth:s}=this.props,{currentPosition:o,tooltipEnabled:l,persist:c}=this.state;return(0,r.h)("div",{type:"button","data-balloon":i,"data-balloon-pos":o||t,"data-balloon-width":s,"data-balloon-persist":c||void 0,class:a("data-balloon",n,{disabled:!l}),onClick:this.onClick,onTouchStart:this.enableTooltip,onMouseEnter:this.onMouseEnter},e)}adjustBalloonPosIfNeeded(e){const{currentPosition:t}=this.state;if(null===t){const t=e.target,{position:i}=this.props;let s=i;if(i!==n.LEFT&&i!==n.RIGHT){const e=window.getComputedStyle(t,":after"),r=e.width?parseInt(e.width,10):0;if(r>0){const e=t.getBoundingClientRect(),o=(r-e.width)/2,a=i===n.UP||i===n.UP_RIGHT||i===n.UP_LEFT;e.left-o<=0?s=a?n.UP_RIGHT:n.DOWN_RIGHT:(i===n.UP_LEFT||i===n.DOWN_LEFT)&&e.left-r<=0?s=a?n.UP:n.DOWN:e.right+o>=window.innerWidth?s=a?n.UP_LEFT:n.DOWN_LEFT:(i===n.UP_RIGHT||i===n.DOWN_RIGHT)&&e.right+r>=window.innerWidth&&(s=a?n.UP:n.DOWN)}}this.setState({currentPosition:s})}}};c=l([o.Z],c)},36114:(e,t,i)=>{"use strict";i.d(t,{D:()=>s,h:()=>p});var n,s,r=i(26605),o=i(94184),a=i.n(o),l=i(2116),c=i(60771),h=i(33746),d=i(47210),u=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e[e.CLEAR=0]="CLEAR",e[e.PLAIN=1]="PLAIN",e[e.OVERLAY=2]="OVERLAY",e[e.PRIMARY=3]="PRIMARY",e[e.SOCIAL=4]="SOCIAL",e[e.TOOLBAR=5]="TOOLBAR"}(s||(s={}));let p=n=class IconButton extends r.Component{constructor(e){super(e),this.onClick=e=>{const t=this.props.buttonState;t!==d.BN.BUSY&&t!==d.BN.DISABLED&&this.props.onClick&&this.props.onClick(e)},this.onMouseDown=e=>{const{onMouseDown:t,onClick:i,buttonState:s}=this.props;if(t)t(e);else if(n.iMobile&&i&&s!==d.BN.BUSY&&s!==d.BN.DISABLED){const t=document.activeElement;t&&e.cancelable&&(t.blur(),e.preventDefault())}}}render(){const{id:e,dataValue:t,tooltipMsg:i,tooltipPosition:n,tooltipPreformatted:o,tooltipWidth:l,tooltipPersist:c,buttonState:u,buttonStyle:p,buttonSize:m,className:g,children:f,iconClass:v,ariaLabel:y,onClick:b,onMouseUp:S}=this.props,E=u===d.BN.DISABLED,w=u===d.BN.BUSY,T=u===d.BN.DECORATIVE,_=!E&&!w&&!T,M=i?n||h.lZ.DOWN:void 0,x=i?!!o:void 0,A={"button-small":m===d.qE.SMALL,"button-large":m===d.qE.LARGE,"button-disabled":E,"button-dimmed":u===d.BN.DIMMED,"button-active":u===d.BN.ACTIVE,"button-busy":w,"button-interactive":_,"icon-button-primary":p===s.PRIMARY,"icon-button-overlay":p===s.OVERLAY,"icon-button-plain":p===s.PLAIN,"icon-button-social":p===s.SOCIAL,"icon-button-toolbar":p===s.TOOLBAR};return(0,r.h)("div",{id:e,role:"button","aria-label":y||i,"aria-disabled":E,"data-value":t,"data-balloon":i,"data-balloon-pos":M,"data-balloon-width":l,"data-balloon-pre":x,"data-balloon-persist":c,class:a()("icon-button",A,g),onClick:b?this.onClick:void 0,onMouseUp:S,onMouseDown:this.onMouseDown},v&&(0,r.h)("span",{class:`icon ${v}`}),f)}};p.iMobile=(0,c.s)()||(0,c._1)(),p=n=u([l.Z],p)},47210:(e,t,i)=>{"use strict";i.d(t,{BN:()=>s,qE:()=>r,ZJ:()=>o,zx:()=>p});var n,s,r,o,a=i(26605),l=i(94184),c=i.n(l),h=i(2116),d=i(60771),u=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e.ENABLED="enabled",e.DISABLED="disabled",e.DECORATIVE="decorative",e.DIMMED="dimmed",e.ACTIVE="active",e.BUSY="busy"}(s||(s={})),function(e){e[e.STANDARD=0]="STANDARD",e[e.MINI=1]="MINI",e[e.SMALL=2]="SMALL",e[e.LARGE=3]="LARGE"}(r||(r={})),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.SECONDARY=1]="SECONDARY",e[e.TERTIARY=2]="TERTIARY",e[e.OUTLINE=3]="OUTLINE",e[e.OVERLAY=4]="OVERLAY",e[e.LIGHT=5]="LIGHT",e[e.SECONDARY_LIGHT=6]="SECONDARY_LIGHT",e[e.CLEAR=7]="CLEAR",e[e.TOOLBAR=8]="TOOLBAR",e[e.PLAIN=9]="PLAIN"}(o||(o={}));let p=n=class Button extends a.Component{constructor(e){super(e),this.handlingClick=!1,this.mouseupTimeout=0,this.onMouseDown=e=>{if(this.handlingClick=!1,this.props.onMouseDown)this.props.onMouseDown(e);else if(n.iMobile&&this.props.onClick){const t=document.activeElement;t&&e.cancelable&&(this.handlingClick=!0,e.preventDefault(),e.stopImmediatePropagation(),t.blur(),window.addEventListener("mouseup",(t=>{this.handlingClick&&(this.handleClick(e),window.clearTimeout(this.mouseupTimeout))}),{once:!0}),this.mouseupTimeout=window.setTimeout((()=>{this.handlingClick=!1}),300))}},this.onClick=e=>{this.handlingClick||this.handleClick(e)}}handleClick(e){const{buttonState:t,onClickArgs:i=[]}=this.props,n=t===s.DISABLED,r=t===s.BUSY,o=t===s.DECORATIVE;!this.props.onClick||n||r||o?e.stopPropagation():this.props.onClick(e,...i)}render(){const{ariaLabel:e,buttonSize:t,buttonState:i,buttonStyle:n,children:l,className:h,dataValue:d,id:u,multiline:p,onMouseEnter:m,onMouseLeave:g,tooltipMsg:f,tooltipPosition:v,tooltipPreformatted:y}=this.props,b=i===s.DISABLED,S=i===s.BUSY,E=i===s.DECORATIVE,w=n===o.SECONDARY||n===o.SECONDARY_LIGHT,T=n===o.TERTIARY,_=n===o.LIGHT||n===o.SECONDARY_LIGHT,M={"button-small":t===r.SMALL,"button-large":t===r.LARGE,"button-mini":t===r.MINI,"button-secondary":w,"button-tertiary":T,"button-outline":n===o.OUTLINE,"button-light":_,"button-primary":n===o.PRIMARY,"button-overlay":n===o.OVERLAY,"button-clear":n===o.CLEAR,"button-plain":n===o.PLAIN,"button-toolbar":n===o.TOOLBAR,"button-active":i===s.ACTIVE,"button-dimmed":i===s.DIMMED,"button-busy":S,"button-disabled":b,"button-decorative":E,"button-multiline":p};return(0,a.h)("div",{id:u,type:"button",role:"button","aria-label":e||f,"aria-disabled":b,class:c()("button",M,h),"data-value":d,onClick:this.onClick,onMouseEnter:m,onMouseLeave:g,onMouseDown:this.onMouseDown,"data-balloon":f||null,"data-balloon-pre":!!y,"data-balloon-pos":v||null},l)}};p.iMobile=(0,d.s)()||(0,d._1)(),p=n=u([h.Z],p)},19806:(e,t,i)=>{"use strict";i.d(t,{A:()=>h,P:()=>CloseButton});var n=i(26605),s=i(94184),r=i.n(s),o=i(36114),a=i(33746),l=i(13789);const{CLOSE_BUTTON_TOOLTIP_MESSAGE:c}=l.Z.REUSABLES;var h;!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.LIGHT=1]="LIGHT",e[e.SHADOW=2]="SHADOW",e[e.OVERLAY=3]="OVERLAY",e[e.TOOLBAR=4]="TOOLBAR"}(h||(h={}));class CloseButton extends n.Component{constructor(e){super(e)}getIconButtonStyle(){switch(this.props.buttonStyle){case h.LIGHT:case h.SHADOW:return o.D.CLEAR;case h.OVERLAY:return o.D.OVERLAY;case h.TOOLBAR:return o.D.TOOLBAR;default:return o.D.PLAIN}}render(){const{locale:e}=this.context,{buttonStyle:t,onClose:i,hideTooltip:s}=this.props,l=s?void 0:e.t(c),d=s?e.t(c):void 0,u=r()("close-button",{"close-button-shadow":t===h.SHADOW,"close-button-light":t===h.LIGHT});return(0,n.h)(o.h,{className:u,ariaLabel:d,iconClass:"icon-close",buttonStyle:this.getIconButtonStyle(),tooltipMsg:l,tooltipPosition:a.lZ.DOWN,onClick:i})}}},86010:(e,t,i)=>{"use strict";i.d(t,{o:()=>n,v:()=>TextParser});var n,s=i(44574);!function(e){e.TEXT="",e.LINK="link-url",e.HASH="link-hashtag",e.USER="link-user"}(n||(n={}));class TextParser{constructor(e){this.serialize=e=>{const t=[],i=[].slice.call(e.childNodes);for(const e of i)switch(e.nodeName){case"#text":t.push(this.serializeText(e));break;case"A":t.push(this.serializeAnchor(e));break;case"P":case"DIV":t.push(this.serializeElement(e,!0));break;case"SPAN":t.push(this.serializeElement(e,!1));break;case"BR":t.push(this.serializeBreak(e));break;default:t.push(this.serialize(e))}return t.join("")},this.deserialize=(e,t,i)=>{const n=this.parse(e).map((e=>this.createNode(e,t,i)));return this.markers?this.parseMarkers(n):n},this.serializeHTMLToMarkdown=e=>{const t=document.createElement("div");t.innerHTML=e;const i=this.serialize(t);return t.remove(),i},this.serializeText=e=>{let t=this.sanitizeText(e.textContent||"");if(this.links){const e=new RegExp(/https?:\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?/gi),i=document.createElement("a");t=t.replace(e,(e=>(i.href=e,`[${e}](${i.href})`))),i.remove()}return this.hashtags&&(t=t.replace(/(#\w*)/,(e=>`[${e}]`))),t.replace(/\<\s*br\s*\/?>/gi,"\n")},this.serializeAnchor=e=>{const t=e.dataset.blocktype,i=this.sanitizeText(e.innerText||"");let n=i;switch(t){case s.C.HASH:n=`[${i}]`;break;case s.C.USER:if(this.users){let t=e.dataset.id||"",i=e.dataset.value||"";if(!t&&!i&&(i="@"===n[0]?n.substr(1):n,i)){const e=this.users.getUserInfoByEmail(i);e&&(t=e.id)}(t||this.validateEmail(i))&&(n=`[@${t}](${i})`)}break;case s.C.LINK:const t=e.dataset.value||e.href;t&&(n=`[${i}](${t})`);break;default:e.href&&(n=`[${i}](${e.href})`)}return n},this.serializeElement=(e,t)=>{let i=t?"\n":" ";return e.childNodes.length>0&&(i+=this.serialize(e)),i},this.serializeBreak=e=>"\n",this.validateEmail=(()=>{const e=/\S+@\S+\.\S+/,t=document.createElement("input");return t.type="email",t.required=!0,i=>(t.value=i,"function"==typeof t.checkValidity?t.checkValidity():e.test(i))})();const{links:t,hashtags:i,users:n,markers:r}=e;this.links=t||!1,this.hashtags=i||!1,this.users=n,this.markers=r}parseMarkers(e){if(!this.markers)return e;const[t,i]=this.markers;let n=!1;const s=new RegExp(t+"|"+i);for(let t=0;t<e.length;t++){const i=e[t],{nodeType:r,textContent:o}=i,a=3===r;if(!o)continue;a?e.splice(t,1):i.textContent=null;const l=o.split(s);l.forEach(((s,r)=>{if(""!==s){let r;if(n){const e=document.createElement("span");e.setAttribute("data-blocktype","marker"),r=e,r.textContent=s}else r=document.createTextNode(s);a?e.splice(t++,0,r):i.appendChild(r)}r<l.length-1&&(n=!n)})),a&&t--}return e}createNode(e,t,i){switch(e.blockType){case s.C.USER:const r=document.createElement(i?"a":"span");if(r.setAttribute("data-blocktype",e.blockType),i){const t=r;t.className=`link-annotation ${n.USER}`,t.removeAttribute("href"),i&&(t.onclick=i);const s=e.id||"",o=e.value||"";s&&t.setAttribute("data-id",s),o&&t.setAttribute("data-value",o)}return r.textContent=`${e.text}`,r;case s.C.HASH:const o=document.createElement(i?"a":"span");if(o.setAttribute("data-blocktype",e.blockType),i){const e=o;e.className=`link-annotation ${n.HASH}`,e.removeAttribute("href"),i&&(e.onclick=i)}return o.textContent=`${e.text}`,o;case s.C.LINK:if(e.value){const s=document.createElement(i||t?"a":"span");if(s.setAttribute("data-blocktype",e.blockType),s.setAttribute("data-value",e.value),i||t){const r=s;t&&(r.href=`${e.value}`),r.target="_blank",r.className=`link-annotation ${n.LINK}`,i&&(r.onclick=i)}return s.textContent=`${e.text}`,s}}return document.createTextNode(""+e.text)}parse(e){const t=[];if(!e)return[];const i=e.split("[").map(((e,t)=>0===t?e:"["+e));let n=0;for(;n<i.length;){const e=this.parseIntoBlocks(i[n],t);e&&i.splice(n+1,0,e),n++}return t}getPlainText(e){return this.parse(e).map((e=>e.text)).join("")}searchMarkdown(e,t){let i=-1,n=0,s=0;const r=this.parse(e).map((e=>{let r;return this.matchTextBlock(e,t)?(s++,-1===i&&(i=n),r=e.markdown):r=e.text,n+=e.text.length,r}));return-1===i?null:{markdown:r.join(""),matchIndex:i,textLength:n,numMatches:s}}getUserMentions(e){return this.parse(e).filter((e=>e.blockType===s.C.USER&&e.value)).map((e=>e.value||""))}matchTextBlock(e,t){if(e.blockType===t.blockType)if(e.blockType===s.C.USER){if(e.id===t.id)return!0;if(e.value===t.value)return!0}else if(e.blockType===s.C.HASH)return e.text===t.text;return!1}getHTMLWithoutSelection(e,t){let i=!1,n="",s=!1,r="";return e.childNodes.forEach((e=>{const o=e instanceof HTMLElement?e.outerHTML:e.nodeValue;o&&(i&&s&&(r+=o),e===t.startContainer&&(n+=o.slice(0,t.startOffset),i=!0),e===t.endContainer&&(r+=o.slice(t.endOffset,o.length),s=!0),i||s||(n+=o))})),[n,r]}parseIntoBlocks(e,t){if(this.users){const i=this.getUserBlock(e);if(i)return t.push(i),e.slice(i.markdown.length)}if(this.links){const i=this.getLinkBlock(e);if(i&&i.value&&-1===i.value.indexOf("javascript:"))return t.push(i),e.slice(i.markdown.length)}if(this.hashtags){const i=this.getHashBlock(e);if(i)return t.push(i),e.slice(i.markdown.length)}const i=this.getTextBlock(e);return i&&t.push(i),null}getTextBlock(e){return 0===e.length?null:{blockType:s.C.TEXT,text:e,markdown:e}}getHashBlock(e){const t=e.match(TextParser.hashRegex);return!t||t.length<2?null:{blockType:s.C.HASH,markdown:t[0],text:t[1]}}getUserBlock(e){if(!this.users)return null;const t=e.match(TextParser.userRegex);if(!t||t.length<3)return null;let i=t[1].substr(1),n=t[2];const r=n?this.users.getUserInfoByEmail(n):this.users.getUserInfoById(i),o=r?r.name:"";return i=r?r.id:i,n=r?r.email:n,{blockType:s.C.USER,markdown:t[0],id:i,value:n,text:`@${o||n}`}}getLinkBlock(e){const t=e.match(TextParser.linkRegEx);if(!t)return null;const i=t[2];let n=1,r=0;for(;r<i.length&&("("===i[r]?n++:")"===i[r]&&n--,0!==n);)r++;const o=i.length-r;let a=this.conditionallyEncode(t[2].substring(0,r));return-1===a.indexOf("://")&&(a="http://"+a),{blockType:s.C.LINK,markdown:t[0].substring(0,t[0].length-o),text:t[1],value:a}}conditionallyEncode(e){return this.needsEncoding(e)?encodeURI(e):e}needsEncoding(e){if(e.match(/([#\s\{\}\"\']|[^\x00-\x7F]|%[^0-9a-fA-F]{2})+/g))return!0;let t=e;try{t=decodeURI(e)}catch(e){}return!1}sanitizeText(e){return e.replace(/\]\(/g,"]&zwnj;(").replace(/[\u200B]/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"')}}TextParser.hashRegex=/\[(#(\w|-)*)\]/,TextParser.userRegex=/\[(@\w*)\]\(([^\)\(\[\]]*)\)/,TextParser.linkRegEx=/\[([^\]]*)\]\((.*)\)/},67799:(e,t,i)=>{"use strict";i.d(t,{OR:()=>n,LH:()=>s,c9:()=>r,_U:()=>o,g:()=>a,El:()=>l});const n=()=>window.innerWidth>767,s=375,r=55,o=70,a=500,l=750},70179:(e,t,i)=>{"use strict";i.d(t,{Z:()=>Animation});var n=i(79437);class Animation{constructor(e){this.isAnimating=!0,this.duration=e.duration,this.startValue=e.startValue,this.changeValue=e.endValue-this.startValue,this.easingFunction=e.easingFunction||n.to}getUpdatedValue(){this.startTime||(this.startTime=Date.now());const e=Date.now()-this.startTime;return e>this.duration&&(this.isAnimating=!1),this.easingFunction(Math.min(e,this.duration),this.startValue,this.changeValue,this.duration)}}},94610:(e,t,i)=>{"use strict";i.d(t,{z:()=>HoverEvent,A:()=>UnhoverEvent});var n=i(15614);class HoverEvent extends n.G{constructor(){super(...arguments),this.type="hover"}}class UnhoverEvent extends n.G{constructor(){super(...arguments),this.type="unhover"}}},15614:(e,t,i)=>{"use strict";i.d(t,{G:()=>InputEvent});class InputEvent{constructor(){this.eventType="input"}}},35003:(e,t,i)=>{"use strict";i.d(t,{T:()=>ClickCancelEvent,R:()=>ClickEvent});var n=i(28134);class ClickCancelEvent extends n.C{constructor(e,t){super(),this.position=e,this.buttons=t}}class ClickEvent extends n.C{constructor(e,t){super(),this.position=e,this.button=t}}},51869:(e,t,i)=>{"use strict";i.d(t,{E0:()=>DragBeginEvent,_t:()=>DragEvent,_R:()=>DragEndEvent,u4:()=>DragGestureStartEvent,Zv:()=>DragGestureEndEvent});var n=i(28134);class DragBeginEvent extends n.C{constructor(e,t){super(),this.position=e,this.buttons=t}}class DragEvent extends n.C{constructor(e,t,i,n){super(),this.position=e,this.clientPosition=n,this.delta=t,this.buttons=i}}class DragEndEvent extends n.C{constructor(e,t,i,n,s){super(),this.position=e,this.delta=t,this.buttons=i,this.timeSinceLastMove=n,this.fullDelta=s}}class DragGestureStartEvent extends n.C{constructor(e,t){super(),this.position=e,this.pointer=t}}class DragGestureEndEvent extends n.C{constructor(e,t){super(),this.position=e,this.fullDelta=t}}},28134:(e,t,i)=>{"use strict";i.d(t,{C:()=>GestureEvent});var n=i(15614);class GestureEvent extends n.G{}},33665:(e,t,i)=>{"use strict";i.d(t,{DG:()=>LongPressMoveEvent,PC:()=>LongPressProgressEvent,Vh:()=>LongPressStartEvent,$b:()=>LongPressSuccessEvent,pt:()=>LongPressEndEvent});var n=i(28134);class LongPressMoveEvent extends n.C{constructor(e,t,i,n){super(),this.position=e,this.clientPosition=t,this.delta=i,this.buttons=n}}class LongPressProgressEvent extends n.C{constructor(e,t,i,n,s){super(),this.position=e,this.clientPosition=t,this.delta=i,this.buttons=n,this.progress=s}}class LongPressStartEvent extends n.C{constructor(e,t,i){super(),this.position=e,this.clientPosition=t,this.buttons=i}}class LongPressSuccessEvent extends n.C{constructor(e,t){super(),this.position=e,this.clientPosition=t}}class LongPressEndEvent extends n.C{constructor(e,t,i){super(),this.position=e,this.clientPosition=t,this.cancelled=i}}},77417:(e,t,i)=>{"use strict";i.d(t,{d:()=>MultiSwipeEvent,h:()=>MultiSwipeEndEvent});var n=i(28134);class MultiSwipeEvent extends n.C{constructor(e,t,i){super(),this.pointerCount=e,this.position=Object.assign({},t),this.delta=Object.assign({},i)}}class MultiSwipeEndEvent extends n.C{constructor(e,t,i,n){super(),this.pointerCount=e,this.position=Object.assign({},t),this.delta=Object.assign({},i),this.timeSinceLastMove=n}}},38022:(e,t,i)=>{"use strict";i.d(t,{G:()=>PinchEvent,i:()=>PinchEndEvent});var n=i(28134);class PinchEvent extends n.C{constructor(e){super(),this.pinchDelta=e}}class PinchEndEvent extends n.C{constructor(e,t){super(),this.pinchDelta=e,this.timeSinceLastMove=t}}},14735:(e,t,i)=>{"use strict";i.d(t,{h:()=>RawPointersEvent});var n=i(28134);class RawPointersEvent extends n.C{constructor(e){super(),this.pointers=e}}},63757:(e,t,i)=>{"use strict";i.d(t,{D:()=>RotateEvent,u:()=>RotateEndEvent});var n=i(28134);class RotateEvent extends n.C{constructor(e){super(),this.rotateDelta=e}}class RotateEndEvent extends n.C{constructor(e,t){super(),this.rotateDelta=e,this.timeSinceLastMove=t}}},81040:(e,t,i)=>{"use strict";i.d(t,{a:()=>ScrollEvent});var n=i(28134);class ScrollEvent extends n.C{constructor(e,t){super(),this.position=e,this.delta=t}}},48221:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>InputIni});var n=i(47724),s=i(90933),r=i(74002),o=i(76870),a=i(49340),l=i(36169),c=i(10757),h=i(60771);class InputPointer{constructor(e,t,i,n){if(this.config=e,this.canvasData=i,this.handledTouchesAsPointer=0,this.lastTouchEnd=0,this.activeButtons=o.r3.NONE,this.preventDoubleTap=e=>{e.cancelable&&e.timeStamp-this.lastTouchEnd<=InputPointer.doubleTapThreshold&&e.preventDefault(),this.lastTouchEnd=e.timeStamp},this.preventMultiTouchGesture=e=>{const t=e.touches&&e.touches.length>1,i="scale"in e&&1!==e.scale;(t||i)&&e.cancelable&&e.preventDefault()},this.onEventCallback=n,window.PointerEvent||(t.addEventListener("mousedown",(e=>this.onMouseDown(e))),t.addEventListener("mouseup",(e=>this.onMouseUp(e))),t.addEventListener("mousemove",(e=>this.onMouseMove(e))),t.addEventListener("mouseenter",(e=>this.onMouseEnter(e)))),t.addEventListener("contextmenu",(e=>e.preventDefault())),t.addEventListener("touchstart",(e=>this.onTouchStart(e))),t.addEventListener("touchend",(e=>this.onTouchEnd(e))),t.addEventListener("touchmove",(e=>this.onTouchMove(e))),t.addEventListener("touchcancel",(e=>this.onTouchEnd(e))),t.addEventListener("pointerdown",(e=>this.onPointerDown(e))),t.addEventListener("pointerup",(e=>this.onPointerUp(e))),t.addEventListener("pointermove",(e=>this.onPointerMove(e))),t.addEventListener("pointercancel",(e=>this.onPointerUp(e))),t.addEventListener("pointerenter",(e=>this.onMouseEnter(e))),(0,h.s)()||(0,h._1)()){const e=!!l.h&&{passive:!1};document.addEventListener("touchmove",this.preventMultiTouchGesture,e),document.addEventListener("touchend",this.preventDoubleTap,e)}}onMouseDown(e){e.currentTarget.focus(),this.tryPreventDefault(e),this.activeButtons|=1<<e.button;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(this.getPointerId(e),t,i,e.button,!0,a._A.MOUSE))}onMouseUp(e){this.tryPreventDefault(e),this.activeButtons&=~(1<<e.button);const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(this.getPointerId(e),t,i,e.button,!1,a._A.MOUSE))}onMouseMove(e){this.tryPreventDefault(e);const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.mE(this.getPointerId(e),t,i,this.activeButtons,a._A.MOUSE))}onMouseEnter(e){const t=(0,c.lY)(e.buttons,o.MP.MIDDLE,o.MP.SECONDARY),i=(this.activeButtons^t)&~t;for(let t=o.MP.PRIMARY;t<o.MP.COUNT;++t){const n=(0,o.AF)(t);if(n&&(i&n)>0){const{ndc:i,client:n}=this.getPointerPosition(e);this.onEventCallback(new a.er(this.getPointerId(e),i,n,t,!1,a._A.MOUSE))}}this.activeButtons=t}onTouchStart(e){if(e.currentTarget.focus(),e.cancelable&&e.preventDefault(),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:n,client:s}=this.getTouchPosition(i);this.onEventCallback(new a.er(i.identifier,n,s,o.MP.PRIMARY,!0,a._A.TOUCH))}}onTouchEnd(e){if(e.cancelable&&e.preventDefault(),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:n,client:s}=this.getTouchPosition(i);this.onEventCallback(new a.er(i.identifier,n,s,o.MP.PRIMARY,!1,a._A.TOUCH))}}onTouchMove(e){if(e.cancelable&&e.preventDefault(),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:n,client:s}=this.getTouchPosition(i),r=new a.mE(i.identifier,n,s,o.r3.PRIMARY,a._A.TOUCH);this.onEventCallback(r)}}onPointerDown(e){switch(this.tryPreventDefault(e),e.pointerType){case a._A.MOUSE:this.onMouseDown(e);break;case a._A.GAMEPAD:case a._A.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(e.pointerId,t,i,o.MP.PRIMARY,!0,e.pointerType))}}onPointerUp(e){switch(this.tryPreventDefault(e),e.pointerType){case a._A.MOUSE:this.onMouseUp(e);break;case a._A.GAMEPAD:case a._A.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(e.pointerId,t,i,o.MP.PRIMARY,!1,e.pointerType))}}onPointerMove(e){switch(this.tryPreventDefault(e),e.pointerType){case a._A.MOUSE:-1!==e.button?this.activeButtons<e.buttons?this.onMouseDown(e):this.activeButtons>e.buttons&&this.onMouseUp(e):this.onMouseMove(e);break;case a._A.GAMEPAD:case a._A.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.mE(e.pointerId,t,i,o.r3.PRIMARY,e.pointerType))}}getPointerId(e){return(0,r.bX)(e)?e.pointerId:0}getPointerPosition(e){return{ndc:this.normalizePosition(e.clientX,e.clientY),client:{x:e.clientX-this.canvasData.x,y:e.clientY-this.canvasData.y}}}getTouchPosition(e){return{ndc:this.normalizePosition(e.clientX,e.clientY),client:{x:e.clientX-this.canvasData.x,y:e.clientY-this.canvasData.y}}}normalizePosition(e,t){return{x:2*(e-this.canvasData.x)/this.canvasData.width-1,y:-2*(t-this.canvasData.y)/this.canvasData.height+1}}tryPreventDefault(e){this.config.pointerPreventDefault&&e.cancelable&&e.preventDefault()}}InputPointer.doubleTapThreshold=300;var d,u=i(81507),p=i(88216),m=i(88727);!function(e){e[e.SEMICOLON=59]="SEMICOLON",e[e.PLUSEQUALS=61]="PLUSEQUALS",e[e.DASHUNDERSCORE=173]="DASHUNDERSCORE"}(d||(d={}));class InputKey{constructor(e){this.keysDown={},this.onEventCallback=e,this.bindHandlers()}bindHandlers(){if(window&&window.document){const e=window.document;window.addEventListener("blur",(()=>{Object.keys(this.keysDown).forEach((e=>this.keysDown[e]=!1))})),e.addEventListener("keydown",(e=>{if(!e.ctrlKey&&!e.metaKey){e.preventDefault();const t=this.translateFirefoxKeys(e.which||e.keyCode);this.keysDown[t]=!0,this.onEventCallback(new m.e(t,p.M.DOWN,e))}})),e.addEventListener("keyup",(e=>{if(!e.ctrlKey&&!e.metaKey){e.preventDefault();const t=this.translateFirefoxKeys(e.which||e.keyCode);this.keysDown[t]&&this.onEventCallback(new m.e(t,p.M.PRESSED,e)),this.keysDown[t]=!1,this.onEventCallback(new m.e(t,p.M.UP,e))}}))}}translateFirefoxKeys(e){switch(e){case d.SEMICOLON:return u.R.SEMICOLON;case d.PLUSEQUALS:return u.R.PLUSEQUALS;case d.DASHUNDERSCORE:return u.R.DASHUNDERSCORE}return e}}var g,f=i(2212);!function(e){e[e.WAITING=0]="WAITING",e[e.WAITINGTOEXCEEDTHRESHOLD=1]="WAITINGTOEXCEEDTHRESHOLD",e[e.GESTURING=2]="GESTURING"}(g||(g={}));var v=i(35003);class ClickGesturer{constructor(e=.04,t=300){this.startPosition=new f.Vector2,this.pointerDelta=new f.Vector2,this.activeButtons=o.r3.NONE,this.state=g.WAITING,this.dragLimit=e,this.holdLimit=t}start(e){if(this.state===g.WAITING&&this.startPosition.copy(e.position),0==(e.buttons&e.buttons-1))this.startTime=Date.now(),this.activeButtons=e.buttons,this.state=g.WAITINGTOEXCEEDTHRESHOLD;else if(this.activeButtons)return this.state=g.GESTURING,new v.T(e.position,this.activeButtons)}stop(){let e;return this.state===g.WAITINGTOEXCEEDTHRESHOLD&&Date.now()-this.startTime<this.holdLimit&&(e=new v.R(this.startPosition.add(this.pointerDelta),(0,o.L2)(this.activeButtons)),this.pointerDelta.set(0,0)),this.state=g.WAITING,e}onMove(e){if(this.state===g.WAITINGTOEXCEEDTHRESHOLD&&(this.pointerDelta.copy(e.position).sub(this.startPosition),this.pointerDelta.length()>this.dragLimit))return this.state=g.GESTURING,new v.T(e.position,e.buttons)}compareState(e){return e===this.state}}var y=i(51869);class DragGesturer{constructor(e,t=.04){this.onEventCallback=e,this.startPosition=new f.Vector2,this.previousPosition=new f.Vector2,this.pointerDelta=new f.Vector2,this.lastPointerMove=Date.now(),this.state=g.WAITING,this.threshold=t}start(e){return this.state===g.WAITING&&(this.startPosition.copy(e.position),this.previousPosition.copy(this.startPosition),this.state=g.WAITINGTOEXCEEDTHRESHOLD),new y.E0(e.position,e.buttons)}stop(){const e=(new f.Vector2).copy(this.previousPosition).sub(this.startPosition);this.state===g.GESTURING&&this.onEventCallback(new y.Zv(this.startPosition,e)),this.state===g.WAITING&&this.pointerDelta.set(0,0),this.state=g.WAITING;const t=Date.now()-this.lastPointerMove;return new y._R(this.previousPosition,this.pointerDelta,o.r3.NONE,t,e)}onMove(e){let t;return this.state===g.WAITINGTOEXCEEDTHRESHOLD&&(this.pointerDelta.copy(e.position).sub(this.startPosition),this.pointerDelta.length()>this.threshold&&(this.state=g.GESTURING,this.onEventCallback(new y.u4(this.startPosition,e)))),this.state===g.GESTURING&&(this.pointerDelta.copy(e.position).sub(this.previousPosition),this.pointerDelta.length()>0&&(t=new y._t(this.previousPosition,this.pointerDelta,e.buttons,e.clientPosition))),this.previousPosition.copy(e.position),this.lastPointerMove=Date.now(),t}compareState(e){return e===this.state}compareStartPoint(e){return e.equals(this.startPosition)}compareDelta(e){return e.equals(this.pointerDelta)}}var b=i(38022);class PointerMovement{constructor(e=new f.Vector2,t=new f.Vector2,i=0){this.lastPosition=e,this.velocity=t,this.samePositionTicks=i}start(e){this.lastPosition.copy(e),this.velocity.set(0,0),this.samePositionTicks=0}update(e){if(this.lastPosition.distanceTo(e)<=.01){if(this.samePositionTicks++,this.samePositionTicks<2)return}else this.samePositionTicks=0;this.velocity.copy(this.lastPosition).sub(e),this.lastPosition.copy(e)}stationary(){return this.samePositionTicks>=2||this.velocity.length()<.01}}const S=2*Math.SQRT2;class PinchGesturer{constructor(e=.04){this.threshold=e,this.startDistance=0,this.previousDistance=0,this.pointerDelta=new f.Vector2,this.lastPointerMove=Date.now(),this.pinchDelta=0,this.state=g.WAITING,this.pointerMovement1=new PointerMovement,this.pointerMovement2=new PointerMovement}start(e,t){this.state===g.WAITING&&(this.restart(e,t),this.pointerMovement1.start(e.position),this.pointerMovement2.start(t.position))}stop(){this.state=g.WAITING;const e=Date.now()-this.lastPointerMove;return new b.i(this.pinchDelta,e)}onMove(e,t){this.pointerMovement1.update(e.position),this.pointerMovement2.update(t.position);if(!(this.pointerMovement1.stationary()||this.pointerMovement2.stationary()||this.pointerMovement1.velocity.dot(this.pointerMovement2.velocity)<0))return void this.restart(e,t);this.pointerDelta.copy(e.position).sub(t.position);const i=this.pointerDelta.length()/S;if(this.state===g.WAITINGTOEXCEEDTHRESHOLD){const e=i-this.startDistance;Math.abs(e)>this.threshold&&(this.state=g.GESTURING)}let n;if(this.state===g.GESTURING){const e=i-this.previousDistance;Math.abs(e)>0&&(this.pinchDelta=e,n=new b.G(e))}return this.previousDistance=i,this.lastPointerMove=Date.now(),n}restart(e,t){this.state=g.WAITINGTOEXCEEDTHRESHOLD,this.startDistance=e.position.distanceTo(t.position)/S,this.previousDistance=this.startDistance}}var E=i(27408),w=i(63757);class RotateGesturer{constructor(e=.1){this.startPointerDelta=new f.Vector2,this.previousPointerDelta=new f.Vector2,this.pointerDelta=new f.Vector2,this.lastPointerMove=Date.now(),this.angleWithDirection=0,this.state=g.WAITING,this.threshold=e}start(e,t){this.state===g.WAITING&&(this.state=g.WAITINGTOEXCEEDTHRESHOLD,this.startPointerDelta.copy(e.position).sub(t.position).normalize(),this.pointerDelta.copy(this.startPointerDelta),this.previousPointerDelta.copy(this.pointerDelta))}stop(){this.state=g.WAITING;const e=Date.now()-this.lastPointerMove;return new w.u(this.angleWithDirection,e)}onMove(e,t){if(this.pointerDelta.copy(e.position).sub(t.position).normalize(),this.state===g.WAITINGTOEXCEEDTHRESHOLD){Math.acos((0,E.uZ)(this.pointerDelta.dot(this.startPointerDelta),-1,1))>this.threshold&&(this.state=g.GESTURING)}let i;if(this.state===g.GESTURING){const e=Math.acos((0,E.uZ)(this.pointerDelta.dot(this.previousPointerDelta),-1,1));if(e>0){const t=this.previousPointerDelta.x*this.pointerDelta.y-this.previousPointerDelta.y*this.pointerDelta.x;this.angleWithDirection=t>=0?e:-e,i=new w.D(this.angleWithDirection)}}return this.previousPointerDelta.copy(this.pointerDelta),this.lastPointerMove=Date.now(),i}compareState(e){return e===this.state}}var T=i(14624),_=i(77417);class MultiSwipeGesturer{constructor(e=.04){this.startEpicenter=new f.Vector2,this.previousEpicenter=new f.Vector2,this.deltaEpicenter=new f.Vector2,this.currentEpicenter=new f.Vector2,this.pointerCount=0,this.lastPointerMove=Date.now(),this.state=g.WAITING,this.pointerMovements=[],this.threshold=e}start(e){this.state===g.WAITING&&(this.restart(e),this.pointerMovements=e.map((e=>new PointerMovement)),e.forEach(((e,t)=>{this.pointerMovements[t].start(e.position)})))}stop(){this.state=g.WAITING;const e=this.pointerCount;this.pointerCount=0;const t=Date.now()-this.lastPointerMove;return new _.h(e,this.currentEpicenter,this.deltaEpicenter,t)}onMove(e){(0,T.V)(this.getPointerPositions(e),this.currentEpicenter),e.forEach(((e,t)=>{this.pointerMovements[t].update(e.position)}));if(this.pointerMovements.find((e=>e.stationary())))return void this.restart(e);const t=this.pointerMovements[0].velocity;if(this.pointerMovements.find((e=>t.dot(e.velocity)<0)))return void this.restart(e);if(this.state===g.WAITINGTOEXCEEDTHRESHOLD){this.currentEpicenter.distanceTo(this.startEpicenter)>this.threshold&&(this.state=g.GESTURING)}let i;return this.state===g.GESTURING&&(this.deltaEpicenter.copy(this.currentEpicenter).sub(this.previousEpicenter),i=new _.d(e.length,this.currentEpicenter,this.deltaEpicenter)),this.previousEpicenter.copy(this.currentEpicenter),this.lastPointerMove=Date.now(),i}getPointerPositions(e){return e.map((e=>e.position))}restart(e){(0,T.V)(this.getPointerPositions(e),this.startEpicenter),this.previousEpicenter.copy(this.startEpicenter),this.currentEpicenter.copy(this.previousEpicenter),this.state=g.WAITINGTOEXCEEDTHRESHOLD,this.pointerCount=e.length}}var M=i(81040),x=i(33665);const A=new(i(88512).Z)("longpress");var O;!function(e){e[e.IDLE=0]="IDLE",e[e.WAITING=1]="WAITING",e[e.STARTED=2]="STARTED",e[e.SUCCESSFUL=3]="SUCCESSFUL"}(O||(O={}));class LongPressGesturer{constructor(e,t=500){this.onEventCallback=e,this.state=O.IDLE,this.ndcStartPosition=new f.Vector2,this.pointerDelta=new f.Vector2,this.ndcPosition=new f.Vector2,this.clientPosition=new f.Vector2,this.pressConfirmThreshold=this.pressStartThreshold=Math.max(t,1e-4)}start(e){this.state!==O.IDLE&&this.stop(),this.state===O.IDLE&&0==(e.buttons&e.buttons-1)&&(this.ndcStartPosition.copy(e.position),this.state=O.WAITING,this.buttons=e.buttons,this.pointerDelta.set(0,0),this.ndcPosition.copy(e.position),this.clientPosition.copy(e.clientPosition),this.holdTimeout=window.setTimeout((()=>{this.state=O.STARTED,A.debug("STARTED"),this.startTime=Date.now(),this.progress(0),this.onEventCallback(new x.Vh(e.position,e.clientPosition,e.buttons)),this.successTimeout=window.setTimeout((()=>{A.debug("SUCCESSFUL"),this.state=O.SUCCESSFUL,this.progress(1),this.onEventCallback(new x.$b(this.ndcPosition,this.clientPosition))}),this.pressConfirmThreshold)}),this.pressStartThreshold))}stop(){const e=this.state;if(this.state=O.IDLE,window.clearTimeout(this.holdTimeout),window.clearTimeout(this.successTimeout),e>O.WAITING){A.debug("DONE, cancelled:",e<O.SUCCESSFUL);const t=e<O.SUCCESSFUL;this.onEventCallback(new x.pt(this.ndcPosition,this.clientPosition,t))}}onMove(e){const t=this.state===O.STARTED||this.state===O.WAITING,i=this.state===O.STARTED||this.state===O.SUCCESSFUL;(t||i)&&(this.ndcPosition.copy(e.position),this.clientPosition.copy(e.clientPosition),this.pointerDelta.copy(this.ndcPosition).sub(this.ndcStartPosition)),t&&this.pointerDelta.length()>.1?this.stop():i&&this.onEventCallback(new x.DG(this.ndcPosition,this.clientPosition,this.pointerDelta,this.buttons))}tick(){if(this.state===O.STARTED){const e=1-(this.pressStartThreshold-(Date.now()-this.startTime))/this.pressStartThreshold;this.progress(Math.min(1,e))}}progress(e){this.onEventCallback(new x.PC(this.ndcPosition,this.clientPosition,this.pointerDelta,this.buttons,e))}}var P=i(14735),D=i(24930);class InputDebugMenu{constructor(){this.displayTouches=!1,this.touches=new Map}async init(e){const[t]=await Promise.all([e.getModule(D.default)]);t.registerMenuButton({header:"Input",buttonName:"Toggle pointer visualization",callback:()=>{this.displayTouches=!this.displayTouches}})}addPointer(e,t){this.displayTouches&&(this.touches.set(e,this.createPointer(t)),this.movePointer(e,t))}removePointer(e){const t=this.touches.get(e);t&&(document.body.removeChild(t),this.touches.delete(e))}movePointer(e,t){const i=this.touches.get(e);i&&(i.style.left=t.x-25+"px",i.style.top=t.y-25+"px")}createPointer(e){const t=document.createElement("div");return t.style.position="fixed",t.style.backgroundColor="#aa11aa",t.style.width="50px",t.style.height="50px",t.style.zIndex="99999",t.style.pointerEvents="none",t.style.touchAction="none",t.style.borderRadius="50px",document.body.appendChild(t),t}}var C,I=i(736);!function(e){e[e.NONE=0]="NONE",e[e.CLICK_DRAG_LONGPRESS=1]="CLICK_DRAG_LONGPRESS",e[e.PINCH_ROTATE=2]="PINCH_ROTATE",e[e.MULTI_SWIPE_ONLY=3]="MULTI_SWIPE_ONLY"}(C||(C={}));class InputGesture{constructor(){this.activeGesture=C.NONE,this.pointers=[],this.couldBeClick=!1}async init(e,t,i){this.onEventCallback=t,this.clicker=new ClickGesturer(e.dragThreshold),this.longPress=new LongPressGesturer(t,e.holdThreshold),this.dragger=new DragGesturer(t,e.dragThreshold),this.pincher=new PinchGesturer(e.pinchThreshold),this.rotater=new RotateGesturer(e.rotateThreshold),this.multiswiper=new MultiSwipeGesturer(e.dragThreshold);const n=await i.getModuleBySymbol(I.y.CANVAS);e.disableWheel||this.bindWheelHandlers(n.element),this.inputDebug=new InputDebugMenu,this.inputDebug.init(i)}get activePointers(){return this.pointers.length}onPointerChange(e){this.isMoveEvent(e)?this.onPointerMove(e):this.onPointerButton(e)}isMoveEvent(e){return!e.hasOwnProperty("down")}onPointerMove(e){this.movePointer(e.id,e.position,e.clientPosition,e.buttons),this.inputDebug.movePointer(e.id,e.clientPosition)}onPointerButton(e){e.down?(this.addPointer(e.id,e.position,e.clientPosition,e.button),this.inputDebug.addPointer(e.id,e.clientPosition)):(this.removePointer(e.id,e.button),this.inputDebug.removePointer(e.id))}bindWheelHandlers(e){e.addEventListener("wheel",(e=>{e.preventDefault(),this.onEventCallback(new M.a({x:e.clientX,y:e.clientY},{x:this.normalizeWheelDelta(e.deltaMode,e.deltaX),y:this.normalizeWheelDelta(e.deltaMode,e.deltaY)}))}))}normalizeWheelDelta(e,t){if(e===WheelEvent.DOM_DELTA_LINE){return.7*t*t*t+13*t}return t}addPointer(e,t,i,n){const s=(0,o.AF)(n);if(!s)return;const r=this.getPointer(e);r&&0==(r.buttons&s)?(r.buttons|=s,r.activeButtons++):this.pointers.push({id:e,position:new f.Vector2(t.x,t.y),clientPosition:new f.Vector2(i.x,i.y),buttons:s,activeButtons:1}),this.toggleGestures()}removePointer(e,t){const i=(0,o.AF)(t);if(!i)return;const n=this.getPointerIndex(e);if(-1!==n){const e=this.pointers[n];0!=(e.buttons&i)&&(e.buttons&=~i,e.activeButtons--),e.activeButtons||this.pointers.splice(n,1),this.toggleGestures()}}movePointer(e,t,i,n){const s=this.getPointer(e);if(s)switch(s.position.copy(t),s.clientPosition.copy(i),s.buttons!==n?this.updateOffscreenPointer(s,n):this.onEventCallback(new P.h(this.pointers)),this.activeGesture){case C.CLICK_DRAG_LONGPRESS:const e=this.clicker.onMove(s);e&&this.onEventCallback(e);const t=this.dragger.onMove(s);t&&this.onEventCallback(t),this.longPress.onMove(s);break;case C.PINCH_ROTATE:const i=this.pincher.onMove(this.pointers[0],this.pointers[1]),n=this.rotater.onMove(this.pointers[0],this.pointers[1]);i&&this.onEventCallback(i),n&&this.onEventCallback(n);case C.MULTI_SWIPE_ONLY:const r=this.multiswiper.onMove(this.pointers);r&&this.onEventCallback(r)}}getPointer(e){const t=this.getPointerIndex(e);if(-1!==t)return this.pointers[t]}toggleGestures(){this.onEventCallback(new P.h(this.pointers));const e=this.activeGesture;if(this.activeGesture=this.pointers.length,e===C.CLICK_DRAG_LONGPRESS&&this.activeGesture===C.NONE&&this.couldBeClick){const e=this.clicker.stop();e&&this.onEventCallback(e)}if(this.couldBeClick=e===C.NONE&&this.activeGesture===C.CLICK_DRAG_LONGPRESS,this.activeGesture===C.CLICK_DRAG_LONGPRESS){const e=this.clicker.start(this.pointers[0]);e&&this.onEventCallback(e);const t=this.dragger.start(this.pointers[0]);t&&this.onEventCallback(t),this.longPress.start(this.pointers[0])}else if(e===C.CLICK_DRAG_LONGPRESS){const e=this.dragger.stop();this.longPress.stop(),this.onEventCallback(e)}this.activeGesture===C.PINCH_ROTATE?(this.pincher.start(this.pointers[0],this.pointers[1]),this.rotater.start(this.pointers[0],this.pointers[1]),this.multiswiper.start(this.pointers)):e===C.PINCH_ROTATE&&(this.onEventCallback(this.pincher.stop()),this.onEventCallback(this.rotater.stop()),this.onEventCallback(this.multiswiper.stop())),this.activeGesture===C.MULTI_SWIPE_ONLY?this.multiswiper.start(this.pointers):e===C.MULTI_SWIPE_ONLY&&this.onEventCallback(this.multiswiper.stop())}getPointerIndex(e){for(let t=0;t<this.pointers.length;t++){if(this.pointers[t].id===e)return t}return-1}updateOffscreenPointer(e,t){if(e.buttons=t,0===t){const t=this.getPointerIndex(e.id);this.pointers.splice(t,1),this.toggleGestures()}}tick(){this.longPress.tick()}}var L=i(38493),R=i(94610),N=i(40168),k=i(17399);class InputSubscription{constructor(e,t,i){this._renew=e,this._cancel=t,this.active=i}renew(){this.active()||this._renew()}cancel(){this.active()&&this._cancel()}}class InputIni extends n.Y{constructor(){super(...arguments),this.name="input-ini",this.fallbackHandlerMap={},this.meshHandlerMap={},this.priorityHandlerMap={},this.unfilteredHandlerMap={},this.captureHandlerMap={},this.gesturing=!1,this.gestureCapture=new L.Z((e=>e.object.id)),this.activeIntersections=new L.Z((e=>e.object.id)),this.eventTypeLookup=new s.cj,this.meshTypeLookup=new s.cj,this.hoveredMesh={object:null,instanceId:void 0,index:void 0},this.registerUnfilteredHandler=(e,t)=>{this.insertHandler(e,this.unfilteredHandlerMap,t);const i=this.eventTypeLookup.getKeyByType(e);return new InputSubscription((()=>this.registerUnfilteredHandler(e,t)),(()=>this.unregisterUnfilteredHandler(e,t)),(()=>-1!==this.unfilteredHandlerMap[i].indexOf(t)))},this.registerMesh=(e,t)=>{this.raycaster.targets.addTarget(e,t)},this.unregisterMesh=e=>{this.raycaster.targets.removeTarget(e)},this.onPointerEvent=e=>{const t=!e.hasOwnProperty("down"),i=!t&&e.down,n=!i&&!t;if(t||i){this.raycaster.pointer.updatePointer(e.position),this.activeIntersections.clear();for(const e of this.raycaster.pointer.cast())this.activeIntersections.add(e);if(!this.gesturing){this.gestureCapture.clear();for(const e of this.activeIntersections)this.gestureCapture.add(e);this.updateHoveredMesh()}i&&(this.gesturing=!0),this.onEvent(e)}this.inputGesture.onPointerChange(e),n&&this.onEvent(e),0===this.inputGesture.activePointers&&(this.activeIntersections.clear(),this.gestureCapture.clear(),this.gesturing&&this.updateHoveredMesh(),this.gesturing=!1)},this.onEvent=e=>{const t=this.eventTypeLookup.getKeyByInstance(e),i=this.captureHandlerMap[t];if(i&&i.length>0){for(const t of i)t(e);return void(i.length=0)}const n=this.unfilteredHandlerMap[t];if(n)for(const t of n)t(e);const s=this.iterateMeshCallbacks(e,this.gesturing?this.gestureCapture:this.activeIntersections),r=this.fallbackHandlerMap[t];if(!s&&r)for(const t of r)t(e)}}async init(e,t){const i={disableWheel:!!e.disableWheel},n=await t.getModuleBySymbol(I.y.CANVAS),s=await t.market.waitForData(N.W);this.raycaster=await t.getModule(k.default),new InputPointer({pointerPreventDefault:e.pointerPreventDefault},n.element,s,this.onPointerEvent),new InputKey(this.onEvent),this.inputGesture=new InputGesture,this.inputGesture.init(i,this.onEvent,t)}registerHandler(e,t){this.insertHandler(e,this.fallbackHandlerMap,t);const i=this.eventTypeLookup.getKeyByType(e,!0);return new InputSubscription((()=>this.registerHandler(e,t)),(()=>this.unregisterHandler(e,t)),(()=>-1!==this.fallbackHandlerMap[i].indexOf(t)))}unregisterHandler(e,t){this.removeHandler(e,this.fallbackHandlerMap,t)}registerMeshHandler(e,t,i){return this._registerMeshHandler(e,{comparator:t,callback:i})}_registerMeshHandler(e,t){const i=this.eventTypeLookup.getKeyByType(e,!0);this.meshHandlerMap[i]||(this.meshHandlerMap[i]=[]);const n=this.meshHandlerMap[i];return n.push(t),new InputSubscription((()=>this._registerMeshHandler(e,t)),(()=>this.unregisterMeshHandler(e,t)),(()=>-1!==n.indexOf(t)))}unregisterMeshHandler(e,t){const i=this.eventTypeLookup.getKeyByType(e,!0);if(this.meshHandlerMap[i]){const e=this.meshHandlerMap[i],n=e.indexOf(t);n>-1&&e.splice(n,1)}}registerPriorityHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e,!0),r=this.meshTypeLookup.getKeyByType(t,!0);this.priorityHandlerMap[n]||(this.priorityHandlerMap[n]={});const o=this.priorityHandlerMap[n];if(o[r]){const i=(0,s.z$)(e),n=(0,s.z$)(t);throw Error(`${i} already has a priority handler registered for mesh type: ${n}`)}return o[r]=i,new InputSubscription((()=>this.registerPriorityHandler(e,t,i)),(()=>this.unregisterPriorityHandler(e,t,i)),(()=>void 0!==o[r]))}unregisterPriorityHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e),s=this.priorityHandlerMap[n];if(s){const e=this.meshTypeLookup.getKeyByType(t),n=s[e];n&&i===n&&delete s[e]}}unregisterUnfilteredHandler(e,t){this.removeHandler(e,this.unfilteredHandlerMap,t)}captureNext(e,t){return this.insertHandler(e,this.captureHandlerMap,t),t}removeCaptureHandler(e,t){this.removeHandler(e,this.captureHandlerMap,t)}updateHoveredMesh(){const e=this.activeIntersections.getByIndex(0),t=e&&e.object===this.hoveredMesh.object&&e.instanceId===this.hoveredMesh.instanceId&&e.index===this.hoveredMesh.index;let i=!1;if(this.hoveredMesh.object&&(void 0===e||!t)){const t=this.getMeshHandler(R.A,(0,s.oL)(this.hoveredMesh.object),this.priorityHandlerMap);if(t&&(i=t(new R.A,this.hoveredMesh.object,e)||!1),!i){const t=this.meshHandlerMap[this.eventTypeLookup.getKeyByType(R.A)];if(t)for(const i of t)i.comparator.compare(this.hoveredMesh.object)&&i.callback(new R.A,this.hoveredMesh.object,e)}}let n=!1;if(e&&!t){const t=this.getMeshHandler(R.z,(0,s.oL)(e.object),this.priorityHandlerMap);if(t&&(n=t(new R.z,e.object,e)||!1),!n){const t=this.meshHandlerMap[this.eventTypeLookup.getKeyByType(R.z)];if(t)for(const i of t)i.comparator.compare(e.object)&&i.callback(new R.z,e.object,e)}}this.hoveredMesh.object=e&&e.object||null,this.hoveredMesh.instanceId=null==e?void 0:e.instanceId,this.hoveredMesh.index=null==e?void 0:e.index}iterateMeshCallbacks(e,t){let i=!1;const n=this.eventTypeLookup.getKeyByInstance(e);for(const s of t){if(i)break;const t=s.object,r=this.activeIntersections.get(t.id)||s;for(const o in this.priorityHandlerMap[n])if(s.object instanceof this.meshTypeLookup.getTypeByKey(o)){const s=this.priorityHandlerMap[n]&&this.priorityHandlerMap[n][o];if(s&&(i=!0,s(e,t,r)))return!0}const o=this.meshHandlerMap[n];if(o)for(const n of o)if(n.comparator.compare(t)){const s=n.callback(e,t,r);(s||void 0===s)&&(i=!0)}}return i}insertHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e,!0);t[n]||(t[n]=[]),t[n].push(i)}removeHandler(e,t,i){const n=t[this.eventTypeLookup.getKeyByType(e)];if(n)for(let e=0;e<n.length;e++)if(n[e]===i){n.splice(e,1);break}}getMeshHandler(e,t,i){const n=i[this.eventTypeLookup.getKeyByType(e)];if(n){return n[this.meshTypeLookup.getKeyByType(t)]}return null}onUpdate(){this.inputGesture.tick()}}},88727:(e,t,i)=>{"use strict";i.d(t,{e:()=>KeyEvent});var n=i(15614);class KeyEvent extends n.G{constructor(e,t,i){super(),this.key=e,this.state=t,this.modifiers=i}}},88216:(e,t,i)=>{"use strict";var n;i.d(t,{M:()=>n}),function(e){e[e.DOWN=0]="DOWN",e[e.PRESSED=1]="PRESSED",e[e.UP=2]="UP"}(n||(n={}))},81507:(e,t,i)=>{"use strict";var n;i.d(t,{R:()=>n}),function(e){e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.RETURN=13]="RETURN",e[e.SHIFT=16]="SHIFT",e[e.CONTROL=17]="CONTROL",e[e.ALT=18]="ALT",e[e.ESCAPE=27]="ESCAPE",e[e.SPACE=32]="SPACE",e[e.HASH=35]="HASH",e[e.LEFTARROW=37]="LEFTARROW",e[e.UPARROW=38]="UPARROW",e[e.RIGHTARROW=39]="RIGHTARROW",e[e.DOWNARROW=40]="DOWNARROW",e[e.DELETE=46]="DELETE",e[e.ZERO=48]="ZERO",e[e.ONE=49]="ONE",e[e.TWO=50]="TWO",e[e.THREE=51]="THREE",e[e.FOUR=52]="FOUR",e[e.FIVE=53]="FIVE",e[e.SIX=54]="SIX",e[e.SEVEN=55]="SEVEN",e[e.EIGHT=56]="EIGHT",e[e.NINE=57]="NINE",e[e.AT=64]="AT",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.SEMICOLON=186]="SEMICOLON",e[e.PLUSEQUALS=187]="PLUSEQUALS",e[e.DASHUNDERSCORE=189]="DASHUNDERSCORE",e[e.OPENBRACKET=219]="OPENBRACKET"}(n||(n={}))},76870:(e,t,i)=>{"use strict";var n,s;i.d(t,{MP:()=>n,r3:()=>s,AF:()=>r,L2:()=>o}),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.MIDDLE=1]="MIDDLE",e[e.SECONDARY=2]="SECONDARY",e[e.BACK=3]="BACK",e[e.FORWARD=4]="FORWARD",e[e.COUNT=5]="COUNT"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.PRIMARY=1]="PRIMARY",e[e.SECONDARY=4]="SECONDARY",e[e.MIDDLE=2]="MIDDLE",e[e.BACK=8]="BACK",e[e.FORWARD=16]="FORWARD",e[e.ALL=31]="ALL"}(s||(s={}));const r=e=>{const t=s[n[e]];return"number"==typeof t?t:void 0},o=e=>{const t=n[s[e]];return"number"==typeof t?t:void 0}},49340:(e,t,i)=>{"use strict";i.d(t,{_A:()=>n,er:()=>PointerButtonEvent,mE:()=>PointerMoveEvent});var n,s=i(15614);class PointerEvent extends s.G{}!function(e){e.MOUSE="mouse",e.TOUCH="touch",e.PEN="pen",e.GAMEPAD="gamepad"}(n||(n={}));class PointerButtonEvent extends PointerEvent{constructor(e,t,i,n,s,r){super(),this.id=e,this.position=t,this.clientPosition=i,this.button=n,this.down=s,this.device=r}}class PointerMoveEvent extends PointerEvent{constructor(e,t,i,n,s){super(),this.id=e,this.position=t,this.clientPosition=i,this.buttons=n,this.device=s}}},26059:(e,t,i)=>{"use strict";var n,s;i.d(t,{s:()=>n,f:()=>s}),function(e){e.Desktop="desktop",e.Mobile="mobile",e.VrOrientOnly="xr.orientonly",e.VrWithController="xr.controller",e.VrWithTrackedController="xr.trackedcontroller"}(n||(n={})),function(e){e.None="interaction.none",e.Direct="interaction.direct",e.Key="interaction.key",e.Gui="interaction.gui",e.Mouse="interaction.mouse",e.Touch="interaction.touch",e.Pen="interaction.pen",e.XRController="interaction.xr.controller",e.XRGaze="interaction.xr.gaze",e.XRScreen="interaction.xr.screen"}(s||(s={}))},19047:(e,t,i)=>{"use strict";i.d(t,{Z:()=>InteractionmodeData});var n=i(32770),s=i(26059);class InteractionmodeData extends n.V{constructor(){super(...arguments),this.name="interaction",this._source=InteractionmodeData.defaultSource,this._mode=InteractionmodeData.defaultMode}static get defaultMode(){return s.s.Desktop}static get defaultSource(){return s.f.None}get mode(){return this._mode}get source(){return this._source}updateSource(e){this._source=e}updateMode(e){this._mode=e}hasController(e=this.mode){return e===s.s.VrWithController||e===s.s.VrWithTrackedController}isVR(e=this.mode){return e===s.s.VrOrientOnly||e===s.s.VrWithController||e===s.s.VrWithTrackedController}isMobile(e=this.mode){return e===s.s.Mobile}}},94625:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>InteractionModeModule});var n=i(47724),s=i(736),r=i(49340),o=i(88727),a=i(19047),l=i(26059),c=i(46114),h=i(60771);class InteractionModeModule extends n.Y{constructor(){super(...arguments),this.name="interactionmode",this.onPointerButtonEvent=e=>{let t=this.data.source;switch(e.device){case r._A.TOUCH:t=l.f.Touch;break;case r._A.MOUSE:t=l.f.Mouse;break;case r._A.PEN:t=l.f.Pen;break;case r._A.GAMEPAD:this.renderer.xr.enabled&&this.renderer.xr.isPresenting&&(t=l.f.XRController);break;default:this.log.debug("source:",e.device,e)}this.updateSource(t)},this.onKeyEvent=()=>{this.updateSource(l.f.Key)}}async init(e,t){this.engine=t,this.data=new a.Z,this.mobileBrowser=(0,h.tq)();const i=await t.getModuleBySymbol(s.y.WEBGL_RENDERER);this.renderer=i.threeRenderer,this.updateMode(this.getInteractionMode(),this.data.mode),this.engine.market.register(this,a.Z,this.data),t.getModuleBySymbol(s.y.INPUT).then((e=>{this.bindings.push(e.registerHandler(r.er,this.onPointerButtonEvent),e.registerHandler(o.e,this.onKeyEvent))}))}onUpdate(e){const t=this.getInteractionMode();this.updateMode(t,this.data.mode)}getInteractionMode(){if(this.renderer.xr.enabled&&this.renderer.xr.isPresenting){const e=this.renderer.xr.getSession();if(null!==e&&e.inputSources.length>0)switch(e.inputSources[0].targetRayMode){case"gaze":case"screen":return l.s.VrOrientOnly;case"tracked-pointer":return l.s.VrWithTrackedController}return l.s.VrOrientOnly}return this.mobileBrowser?l.s.Mobile:l.s.Desktop}updateMode(e,t){e!==this.data.mode&&(this.data.updateMode(e),this.data.commit(),this.engine.broadcast(new c.m(this.data.mode,t)))}updateSource(e){e!==this.data.source&&(this.data.updateSource(e),this.data.commit(),this.engine.broadcast(new c.a(this.data.source)))}}},46114:(e,t,i)=>{"use strict";i.d(t,{m:()=>InteractionModeChangeMessage,a:()=>InteractionSourceChangeMessage});var n=i(91466);class InteractionModeChangeMessage extends n.v{constructor(e,t){super(),this.mode=e,this.fromMode=t}}class InteractionSourceChangeMessage extends n.v{constructor(e){super(),this.source=e}}},74371:(e,t,i)=>{"use strict";i.d(t,{D:()=>LabelData});var n=i(32770),s=i(64781),r=i(10757);const o=new(i(88512).Z)("label-data");class LabelData extends n.V{constructor(e){super(),this.name="label",this.has=e=>this.map.has(e),this.getLabel=e=>this.map.get(e),this.map=(0,s.q)(e||{})}getCount(){return this.map.length}add(e){let t=e.sid;return this.map.has(t)&&o.warn("Label already tracked:",{sid:t,label:e,existing:this.getLabel(t)}),t=t||this.generateSid(),e.sid=t,e.commit(),this.map.set(e.sid,e),t}generateSid(){let e="";for(;!e||this.map.has(e);)e=(0,r.O1)(11);return e}remove(e){return!!this.map.has(e)&&(this.map.delete(e),!0)}clear(){for(const e of this.map.keys)this.map.delete(e)}getCollection(){return this.map}iterate(e){for(const t of this.map.keys)e(this.map.get(t),t)}isEqual(e){if(this.map.length!==e.map.length)return!1;for(const t of this.map){const i=e.map.get(t.sid);if(!i||!LabelData.labelsAreEqual(t,i))return!1}return!0}static labelsAreEqual(e,t){return e.floorId===t.floorId&&e.roomId===t.roomId&&e.position.x===t.position.x&&e.position.y===t.position.y&&e.position.z===t.position.z&&e.sid===t.sid&&e.text===t.text&&e.floorId===t.floorId&&e.roomId===t.roomId&&e.visible===t.visible}getLabelsForRoom(e){const t=[];return this.iterate((i=>{i.roomId===e&&t.push(i)})),t}}},32470:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>LabelDataModule});var n=i(88512),s=i(47724),r=i(736),o=i(38420),a=i(26587),l=i(50988),c=i(96781),h=i(66097),d=i(57361),u=i(71194),p=i(39729),m=i(74371),g=i(38330),f=i(80121),v=i(99398),y=i(18630),b=i(19674),S=i(23573),E=i(2212);class Label extends S.T{constructor(){super(...arguments),this.position=new E.Vector3,this.floorId="",this.sid="",this.text="",this.visible=!1,this.roomId="",this.created=new Date,this.modified=new Date,this.version="3.1"}copy(e){return this.floorId=e.floorId,this.sid=e.sid,this.text=e.text,this.visible=e.visible,this.roomId=e.roomId,this.created=e.created,this.modified=e.modified,this.position.copy(e.position),this.version=e.version,this.commit(),this}}var w=i(85861),T=i(31879);const _=new n.Z("label-serialization"),M=e=>{if(!e)return null;const t={};if(e)for(const i of Object.keys(e)){const n=e[i];try{if(!n||!n.version||isNaN(Number.parseFloat(n.version))||Number.parseFloat(n.version)<3)continue;const e=new Label;e.copy({floorId:"number"==typeof n.floorId?String(n.floorId):"",position:(0,b.gj)(n.position),sid:n.sid,text:n.text||"",visible:n.visible,roomId:n.roomId,created:(0,T.p)(n.created),modified:(0,T.p)(n.modified),version:n.version}),t[n.sid]=e}catch(e){_.warn("Error parsing label data; not adding label: ",n)}}return t},x=(e,t)=>{const i={},n=(0,w.p$)(e);(0,w.TS)(n,t);for(const e of Object.keys(n)){const t=n[e];if(!t)continue;const s=parseInt(t.floorId,10);if(isNaN(s))throw new Error(`Failed to serialize unsupported floor ID '${t.floorId}'`);i[t.sid]={floorId:s,position:t.position,sid:t.sid,text:t.text,visible:t.visible,roomId:t.roomId,created:(0,T.U)(t.created),modified:(0,T.U)(t.modified),version:t.version},i[t.sid].position=(0,b.gj)(t.position)}return i},A=(e,t)=>{const i=[],n=(0,w.p$)(e);(0,w.TS)(n,t);for(const e of Object.keys(n)){const t=n[e];if(!t)continue;const s=parseInt(t.floorId,10);if(isNaN(s))throw new Error(`Failed to serialize unsupported floor ID '${t.floorId}'`);i.push({floorId:s,position:(0,b.gj)(t.position),sid:t.sid,text:t.text,visible:t.visible,roomId:t.roomId,created:(0,T.U)(t.created),modified:(0,T.U)(t.modified),version:t.version})}return i};var O=i(94474),P=i(71918),D=i(44382);const C=new n.Z("mds-label-serialize");class MdsLabelCreateSerializer{constructor(){this.validate=e=>{if(!e)return!1;const t=["enabled","floorId","label","position"].filter((t=>!(t in e))),i=0===t.length,n=!!e.floorId&&"string"==typeof e.floorId,s=!!e.position&&(0,D.uU)(e.position),r=i&&n&&s;return r||C.debug("Label invalid:",{missingFields:t,validPosition:s}),r}}serialize(e){const t=I(e);return this.validate(t)?t:null}}class MdsLabelUpdateSerializer{constructor(){this.validate=e=>{if(!e)return!1;const t=["enabled","label","position","floorId","roomId"];return Object.keys(e).every((e=>t.includes(e)))}}serialize(e){const t=I(e);return t&&this.validate(t)?t:null}}const I=e=>{const t={};return void 0!==e.visible&&(t.enabled=e.visible),void 0!==e.text&&(t.label=e.text),void 0!==e.position&&(0,D.uU)(e.position)&&(t.position=b.ep.toVisionVector(e.position)),void 0!==e.floorId&&""!==e.floorId&&(t.floorId=e.floorId),void 0!==e.roomId&&""!==e.roomId&&(t.roomId=e.roomId),Object.keys(t).length>0?t:null},L=new n.Z("mds-label-deserializer");class MdsLabelDeserializer{constructor(){this.validate=e=>{if(!e)return!1;const t=["id","created","modified","enabled","floor","label","position"].filter((t=>!(t in e))),i=0===t.length,n=!(!e.floor||!e.floor.id),s=!!e.position&&(0,D.uU)(e.position);return i&&n&&s||L.debug("Label invalid:",{missingFields:t,validFloor:n,validPosition:s}),i&&n&&s}}deserialize(e){if(!e||!this.validate(e))return L.debug("Deserialized invalid Label data from MDS",e),null;const t=new Label;return t.sid=e.id,t.floorId=e.floor.id,t.text=e.label,t.visible=!!e.enabled,t.created=(0,T.p)(e.created),t.modified=(0,T.p)(e.modified),t.position=b.ep.fromVisionVector(e.position),e.room&&e.room.id&&(t.roomId=e.room.id),t}}var R=i(95162),N=i(53204),k=i(90778);const B=new n.Z("MdsLabelStore");class MdsLabelStore extends O.u{constructor(e){super(e),this.prefetchKey="data.model.labels",this.deserializer=new MdsLabelDeserializer,this.updateSerializer=new MdsLabelUpdateSerializer,this.createSerializer=new MdsLabelCreateSerializer}async read(e){const{includeDisabled:t=!1}=this.config,i={modelId:this.getViewId(),includeDisabled:t};return this.query(R.GetLabels,i,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.labels;if(!n||!Array.isArray(n))return null;const s=[];for(const e of n){const t=this.deserializer.deserialize(e);t&&s.push(t)}return s.reduce(((e,t)=>(e[t.sid]=t,e)),{})}))}async create(e){const t=this.getViewId();return Promise.all(e.map((e=>{const i=this.createSerializer.serialize(e);if(!i)throw B.error("Failure saving label:",e.sid,e),new Error("Could not save Label");return this.mutate(R.AddLabel,{modelId:t,labelId:e.sid,data:i}).then((t=>{const i=(0,P.qw)(t,"data.addLabel"),n=(new Label).copy(e);return n.sid=i.id,n.commit(),B.debug(Object.assign({type:"addLabel"},t)),n}))})))}async update(e){if(!e||0===e.length)return;const t=this.getViewId();let i="";const n={};n.modelId=t;let s="";for(const t of e){const e=t.sid,r=this.updateSerializer.serialize(t);if(!r)throw B.error("Failure updating label:",e,t),new Error("Could not update Label");i+=`, $patch${e}: LabelPatch!`,n[`patch${e}`]=r,s+=`patch${e}:\n        patchLabel(modelId: $modelId, labelId: "${e}", patch: $patch${e}) {\n          ...LabelDetails\n        }\n      `}const r=N.Ps`
      mutation labelUpdate($modelId: ID! ${i}) {
        ${s}
      }

      ${(0,k.S)(R.LabelDetails)}
    `;return this.mutate(r,n).then((e=>{B.debug(Object.assign({type:"patchLabel"},e))}))}async delete(e){if(!e||0===e.length)return;const t=this.getViewId();let i="";for(const t of e){if(!t||t&&!t.sid)throw B.error("Failure deleting label:",t),new Error("Could not update Label");i+=`delete${t.sid}: deleteLabel(modelId: $modelId, labelId: "${t.sid}") `}const n=N.Ps`
      mutation batchDeleteLabel($modelId: ID!) {
        ${i}
      }
    `;return this.mutate(n,{modelId:t}).then((()=>{}))}}var F=i(98828),U=i(76236),V=i(93673);const H=new n.Z("label-data");class LabelDataModule extends s.Y{constructor(){super(...arguments),this.name="label-data",this.monitor=null}async init(e,t){this.config=Object.assign(Object.assign({},e),{readonly:!("readonly"in e)||!!e.readonly,storageProvider:e.storageProvider||o.Xq.JSONSTORE}),this.engine=t,this.market=t.market,this.store=this.configureStorage();const i=await this.store.read()||{},n=await t.getModule(a.F),s=await t.getModuleBySymbol(r.y.MESH_QUERY);for(const e of Object.values(i))s.inferMeshIdsFromPoint(e,e.position);this.labelData=t.market.tryGetData(m.D)||new m.D(i),this.market.register(this,m.D,this.labelData),this.config.readonly||this.configureSaving(this.store,this.labelData),this.bindings.push(n.onSave((()=>this.saveDiff()),{dataType:o.g.LABELS}),n.onRevert((()=>this.revert()),{dataType:o.g.LABELS}),n.onPublish((()=>this.onAfterPublish()),{dataType:o.g.LABELS,phase:o.Q.AFTER})),this.configureTrash()}configureStorage(){const{modelId:e,baseUrl:t,queue:i,readonly:n}=this.config;if(H.info(`Loading Labels from ${this.config.storageProvider}`),this.config.storageProvider===o.Xq.MDS)return new MdsLabelStore({readonly:n,includeDisabled:!n,baseUrl:t});const s=function(e){const{modelId:t,readonly:i}=e,n=e.baseUrl||"",s=e.queue,r=M,o=x,a=`${n}/api/v1/jsonstore/model/Labels/${t}`;if(i){const e=new g.gh({queue:s,path:a,deserialize:r});return new f.iY({publishStores:[e]})}const l=new g.MU({queue:s,path:a,batchUpdate:!0,deserialize:r,serialize:o}),c=`${n}/api/v1/jsonstore/model/workshopSession/${t}`,h=new y.Z({queue:s,path:c,cachedData:{data:null},deserialize:v.S.sessionCollectionMap(y.j.Labels,r),serialize:A},y.j.Labels);return new f.iY({publishStores:[l],legacyEditStore:h,editStoreKey:f.aw.LABELS})}({modelId:e,baseUrl:t,readonly:n,queue:i});return new h.N(s,{dataType:o.g.LABELS,readonly:n,engine:this.engine})}configureSaving(e,t){this.monitor=new d.c(t.getCollection(),{aggregationType:p.E.Manual,shallow:!0},this.engine),this.store instanceof h.N&&e.addMonitor(this.monitor)}async save(){return this.engine.commandBinder.issueCommand(new l.VQ({dataTypes:[o.g.LABELS]}))}getDiffRecord(){var e;return(null===(e=this.monitor)||void 0===e?void 0:e.getDiffRecord())||[]}async saveDiff(){if(!this.store||!this.monitor)return void H.warn("Labels changes will NOT be saved");if(this.monitor.commitChanges(),this.store instanceof h.N)return;const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=e,i=t.filter((e=>e.action===u.KI.removed)).map((e=>({sid:e.index}))),n=t.filter((e=>e.action===u.KI.added)).map((e=>this.labelData.getLabel(e.index))),s=t.filter((e=>e.action===u.KI.updated)).map((e=>Object.assign({sid:e.index},e.diff)));return Promise.all([this.store.delete(i),this.store.create(n),this.store.update(s)]).then((()=>{}))}async revert(){if(this.store instanceof h.N)return this.store.revert()}onUpdate(e){}async onAfterPublish(){this.verifyDataIntegrity()}async verifyDataIntegrity(){if(!(this.store instanceof MdsLabelStore))return;const e="data-integrity"===(0,F.h)("error",""),t=this.labelData.getCount(),i=await this.store.read().catch((e=>{H.debug("Label integrity check failed",e)}))||{},n=Object.keys(i).length;(n!==t||e)&&this.engine.broadcast(new c.Qq(`Unexpected label count after publish (${n}/${t})`,o.g.LABELS,e))}async configureTrash(){const{readonly:e,storageProvider:t}=this.config;if(e||t!==o.Xq.MDS)return;const{commandBinder:i}=this.engine,n=o.g.LABELS,s=new MdsLabelDeserializer,r={objectType:n,create:e=>new U.F({label:e.label||"Label",objectId:e.id,objectType:n,created:new Date,value:e}),restore:e=>{const t=s.deserialize(e.value);t&&this.labelData.add(t)}},a=await i.issueCommandWhenBound(new V.B(r));this.bindings.push(a)}}},23502:(e,t,i)=>{"use strict";i.d(t,{Nj:()=>n,Mr:()=>s});const n="features/labels",s="features/3d_labels_visble"},39300:(e,t,i)=>{"use strict";i.r(t),i.d(t,{USER_LABELS:()=>E,default:()=>X});var n=i(47724),s=i(736),r=i(74371),o=i(59088),a=i(27326),l=i(24151),c=i(67027),h=i(75892),d=i(86488),u=i(33874),p=i(48358),m=i(78959),g=i(42530),f=i(2212);const v={ColorDefault:16777215,ColorHovered:i(87068).I.MP_BRAND.getHex(),ColorInvalid:16750933};class LabelTextMesh extends m.${use(e){this.userData.sid=e.data.sid,this.collider.data=e.data,this.collider.name=e.data.text,this.collider.labelMesh=e}}class LabelTextBackgroundMesh extends f.Mesh{constructor(){super(...arguments),this.hitTest=(()=>{const e=new f.Matrix4,t=new f.Ray,i=new f.Plane(new f.Vector3(0,0,-1)),n=new f.Vector3;return(s,r)=>{if(e.copy(this.matrixWorld).invert(),t.copy(s.ray).applyMatrix4(e),t.intersectPlane(i,n)){const e=this.scale.x/this.scale.y;let t=.5;e<1.5&&(t=1/e),Math.abs(n.x)<=t&&Math.abs(n.y)<=.75&&(n.applyMatrix4(this.matrixWorld),r.push({distance:s.ray.origin.distanceTo(n),point:n.clone(),object:this}))}}})()}labelVisible(){return!(!this.labelMesh||!this.labelMesh.labelVisible())}getId(){if(!this.data)throw new Error("LabelInputCollider used before configure");return this.data.sid}raycast(e,t){if(!this.labelVisible())return;if(this.material.depthTest)return void this.hitTest(e,t);const i=this.material.depthTest?t:[];this.hitTest(e,i),i.length>0&&(i[0].distance/=1e4,t.push(i[0]))}}class LabelPartMaker{constructor(e){this.makeLabel=()=>{const e=new LabelTextMesh(Object.assign({},this.textStyle));return e.scaleType=m.N.WORLD,e.setRenderOrder(p.z.labels),e.setRenderLayer(this.layer),e.opacity=0,e},this.textStyle=g.u.makeConfig({color:"white",background:!e,backgroundAsCollider:!0,backgroundColliderType:LabelTextBackgroundMesh,backgroundColor:"#222",backgroundOpacity:1,outline:e,outlineWidth:8,backgroundBorderHeight:26,backgroundBorderWidth:20,wordWrapWidth:void 0,disableDepth:!0})}setRenderLayer(e){this.layer=e}}var y=i(64781),b=i(17131),S=i(98828);const E={LABEL_SIZE:0,FADE_DURATION:200,ANCHOR_2D_COLLAPSE_RADIUS:20,ANCHOR_MAX_RADIUS:.09,ANCHOR_MIN_RADIUS:.04,ANCHOR_OPACITY:1,LINE_OPACITY:.4,ANCHOR_OPACITY_COLLAPSE:0,LABEL_OPACITY_COLLAPSE:0,SCREEN_FILTER_WIDTH_FACTOR:0,SHOW_ANCHOR:1===(0,S.h)("anchor",0),DEBUG:-1!==(0,S.h)("debug","").indexOf("labels")};var w=i(10757);class LabelMesh extends f.Object3D{constructor(e){super(),this.text=e,this.maxOpacity=1,this.labelAnim=new b.z(0),this.filtered=!1,this.hidden=!1,this.selectState={active:!1,on:()=>{},off:()=>{}},this.validState={active:!0,on:()=>{const e=this.hoverState.active?v.ColorHovered:v.ColorDefault;this.text.setColorHex(e)},off:()=>{this.text.setColorHex(v.ColorInvalid)}},this.hoverState={active:!1,on:()=>{this.validState.active&&this.text.setColorHex(v.ColorHovered)},off:()=>{this.validState.active&&this.text.setColorHex(v.ColorDefault)}},this.add(e)}use(e){this.data=e,this.userData.sid=e.sid,this.userData.data=e,this.text.use(this),this.labelUpdate(e.position,new f.Quaternion,"")}getId(){return this.data.sid}labelVisible(){return!this.filtered&&!this.hidden}updatePose(e,t){return this.labelUpdate(e,t,this.data.text),this}setMaxOpacity(e){this.maxOpacity=e,this.toggleLabel(this.labelVisible())}async free(){this.labelAnim.value>0&&(this.toggleLabel(!1),await(0,w.gw)(E.FADE_DURATION))}tickAnimations(e){return this.animateLabelOpacity(.5*e),this}toggleLabel(e){this.hidden=!e,this.updateOpacity()}isHidden(){return this.hidden}toggleFiltered(e){e!==this.filtered&&(this.filtered=e,this.updateOpacity())}updateOpacity(){const e=this.labelVisible()?this.maxOpacity:0;this.labelAnim.endValue!==e&&this.labelAnim.modifyAnimation(this.labelAnim.value,e,E.FADE_DURATION)}animateLabelOpacity(e){const t=this.labelAnim.tick(e);Math.min(t,this.maxOpacity)!==this.text.opacity&&(this.text.opacity=t)}labelUpdate(e,t,i){this.text.position.copy(e),this.text.quaternion.copy(t),this.text.text=i}billboard(e,t,i,n,s,r,o){this.text.scaleBillboard(e,t,i,n,s,r,o)}}var T=i(88512);const _=new T.Z("label-spawner");class LabelSpawner{constructor(e,t){this.map=e,this.maker=t,this.container=new f.Object3D,this.pool=[],this.bindings=[],this.meshesMap=(0,y.q)(),this.container.name="RoomLabels";const i=e.keys;for(const t of i){const i=e.get(t);this.add(i,t)}this.bindings.push(e.onElementChanged({onAdded:(e,t)=>{this.add(e,t),_.debug("LabelMesh: added:",t)},onRemoved:(e,t)=>{_.debug("LabelMesh: removing:",t);const i=this.meshesMap.get(t);i&&this.free(i)}}))}subscribe(e){return this.meshesMap.onElementChanged(e)}get(e){return this.meshesMap.get(e)}free(e){const t=e.getId(),i=this.meshesMap.get(t);return i.free().then((()=>{this.meshesMap.delete(t),this.container.remove(i),this.pool.push(i),_.debug("LabelMesh: removed:",i)}))}add(e,t){const i=this.get(t);if(i)return i;const n=this.pool.shift();if(void 0!==n)return n.use(e),this.container.add(n),this.meshesMap.set(t,n),n;{const i=new LabelMesh(this.maker.makeLabel());return i.use(e),this.container.add(i),this.meshesMap.set(t,i),i}}dispose(){for(const e of this.meshesMap.values)this.free(e);this.bindings.forEach((e=>e.cancel()))}}var M=i(19674);class LabelRenderer{constructor(e,t,i,n){this.meshes=e,this.cameraData=i,this.screenFilter=n,this.dirty=!0,this.bindings=[],this.pendingMesh=null,this.setDirty=()=>{this.dirty=!0},this.bindings.push(i.onChanged(this.setDirty),t.onChanged(this.setDirty));for(const e of this.meshes.values)e.text.onGeomUpdate(this.setDirty);this.meshes.onElementChanged({onAdded:e=>e.text.onGeomUpdate(this.setDirty)})}dispose(){this.bindings.forEach((e=>e.cancel())),this.bindings.length=0}setPendingMeshId(e){if((!this.pendingMesh||this.pendingMesh.getId()!==e)&&(this.pendingMesh&&(this.pendingMesh.data.removeOnChanged(this.setDirty),this.pendingMesh=null),e)){const t=this.meshes.get(e);t.data.onChanged(this.setDirty),this.pendingMesh=t}}beforeRender(){if(!this.dirty)return;this.dirty=!1;const{position:e,rotation:t,projection:i}=this.cameraData.pose,{height:n}=this.cameraData,s=this.cameraData.zoom(),r=this.cameraData.aspect(),o=(0,M.dS)(64-E.LABEL_SIZE,0,64,.02,.1);for(const a of this.meshes.values)a.isHidden()||(a.updatePose(a.data.position,t),a.billboard(e,t,i,s,n,r,o));this.screenFilter.update();for(const e of this.meshes.values)e.isHidden()||e.toggleFiltered(!this.screenFilter.visible(e.data.sid))}render(e){for(const t of this.meshes)t.tickAnimations(e)}deactivate(){}init(){}activate(){}}var x=i(82582),A=i.n(x),O=i(27687);class Label2DFiltering{constructor(e,t,i){this.meshes=e,this.cameraData=t,this.enabled=i,this.tree=new(A()),this.visibleMap={},this._screenPosition=new f.Vector2,this._ndcPosition=new f.Vector3,this._cornerWorldPosition=new f.Vector3,this._cornerScreenPosition=new f.Vector2,this._selectedId=null,this.update=()=>{this.enabled()?(this.visibleMap={},this.updatePositions()):Object.keys(this.visibleMap).length&&(this.visibleMap={})}}visible(e){if(!(e in this.visibleMap))return!1;return e in this.visibleMap}setSelectedMeshId(e){this._selectedId=e}updatePositions(){this.tree.clear(),this.meshes().filter((e=>!e.isHidden())).map((e=>{(0,O.q9)(this.cameraData,e.text.position,this._screenPosition,this._ndcPosition);const{width:t,height:i}=e.text.textGeometry.layout;this._cornerWorldPosition.set(.5*t,-.5*i,0),e.text.updateMatrixWorld(),this._cornerWorldPosition.applyMatrix4(e.text.matrixWorld),(0,O.q9)(this.cameraData,this._cornerWorldPosition,this._cornerScreenPosition);const n=e.getId()!==this._selectedId?this._ndcPosition.z:-999;return this.describeBbox(e.text,this._screenPosition,this._cornerScreenPosition,n)})).sort(((e,t)=>e.depth-t.depth)).forEach((e=>{this.tree.collides(e)||(this.tree.insert(e),this.visibleMap[e.id]=e)}))}describeBbox(e,t,i,n){i.sub(t);const s=i.x,r=i.y;return{id:e.userData.sid,depth:n,minX:t.x-s,minY:t.y-r,maxX:t.x+s,maxY:t.y+r}}}var P=i(21479),D=i(3248),C=i(73844),I=i(23502),L=i(69617),R=i(4141),N=i(79553),k=i(35597),B=i(69808);class LabelVisibilityRules{constructor(e){this.meshes=e,this.initialized=!1,this.searchResultsData=null,this.pendingMeshId=null,this.dirty=!0,this.bindings=[],this.focusedGroup=null,this.updateFocusedGroup=e=>{this.focusedGroup=e.results.filter((e=>e.type===R.B.LABEL)).map((e=>e.id))},this.featureEnabled=()=>{if(!this.initialized)return!1;const e=this.appData.phase===P.nh.PLAYING,t=this.settingsData.tryGetProperty(C.Q5,!1),i=this.settingsData.tryGetProperty(I.Nj,!1),n=this.appData.application===P.Mx.WORKSHOP,s=this.settingsData.tryGetProperty(D.gx.Labels,!1)||n;return e&&i&&s&&(t||n)},this.visibleByTool=()=>!!this.initialized&&(null===this.toolsData.activeToolName||this.toolsData.activeToolName===N.w1.LABELS||this.toolsData.activeToolName===N.w1.PHOTOS||this.toolsData.activeToolName===N.w1.SEARCH),this.visibleByViewmode=()=>{const e=this.settingsData.tryGetProperty(C.Q5,!1),t=this.settingsData.tryGetProperty(D.gx.LabelsDollhouse,!1)||e&&this.toolsData.activeToolName===N.w1.LABELS,i=this.viewmodeData.isDollhouse()&&t&&e;return this.viewmodeData.isFloorplan()&&(this.appData.application===P.Mx.WORKSHOP&&this.visibleByTool()||e&&this.settingsData.tryGetProperty(D.gx.Labels,!1))||i},this.hiddenByTransition=()=>this.viewmodeData.transitionActive()||this.floorsViewData.transitionActive,this.visibleByFloor=e=>{const t=this.settingsData.tryGetProperty(C.Q5,!1),i=this.toolsData.activeToolName===N.w1.LABELS;if(t&&!i){const{roomSelectModeActive:e,floorSelectModeActive:t}=this.floorsViewData;if(!e)return!1;if(t)return!1}return this.viewmodeData.isFloorplan()?this.floorsViewData.currentFloor?this.floorsViewData.isCurrentOrAllFloors(e):this.floorsViewData.topFloorId===e:this.floorsViewData.isCurrentOrAllFloors(e)},this.setDirty=()=>{this.dirty=!0,this.dirtyCb&&this.dirtyCb()}}async init(e){[this.viewmodeData,this.floorsViewData,this.settingsData,this.toolsData,this.appData]=await Promise.all([e.waitForData(k.O),e.waitForData(a.c),e.waitForData(u.e),e.waitForData(l.t),e.waitForData(P.pu)]);const t=await e.waitForData(r.D);[this.viewmodeData,this.floorsViewData,this.settingsData,this.toolsData,this.appData,t].forEach((e=>this.bindings.push(e.onChanged(this.setDirty)))),this.meshes.onChanged(this.setDirty);this.settingsData.tryGetProperty(B.B,!1)&&(this.searchResultsData=await e.waitForData(L.r),this.bindings.push(this.searchResultsData.onChanged(this.setDirty),this.searchResultsData.onChanged(this.updateFocusedGroup))),this.setDirty(),this.initialized=!0}dispose(){this.bindings.forEach((e=>e.cancel())),this.bindings.length=0}visibleByFocusedGroup(e){var t;return!this.searchResultsData||!this.searchResultsData.getQuery()||!!(null===(t=this.focusedGroup)||void 0===t?void 0:t.includes(e))}onUpdate(){if(!this.initialized||!this.dirty)return;this.dirty=!1;const e=this.featureEnabled(),t=!this.hiddenByTransition(),i=this.visibleByTool(),n=e&&t&&i&&this.visibleByViewmode();this.settingsData.setProperty(I.Mr,n);for(const e of this.meshes.values){const t=n&&(this.visibleByFloor(e.data.floorId)||e.data.sid===this.pendingMeshId)&&e.data.visible&&(!this.searchResultsData||this.visibleByFocusedGroup(e.data.sid));e.toggleLabel(t)}}setPendingMeshId(e){this.pendingMeshId=e,this.dirty=!0}setDirtyCallback(e){this.dirtyCb=e}}var F=i(3805),U=i(31278),V=i(24764),H=i(35003),G=i(94610),z=i(44283),W=i(17490),j=i(4901),K=i(14092),q=i(60771);class LabelRendererInput{constructor(e,t,i,n,s,r){this.labelRenderer=e,this.issueCommand=t,this.input=i,this.floorsViewData=n,this.toolsData=s,this.roomNavigationPose=r,this.inputBindings=[],this.appStateBindings=[],this.raycasterRegistrationBindings=[],this.active=!0,this.enabled=!0,this.refresh=()=>{this.shouldBeInteractive!==this.active&&(this.inputBindings.forEach((e=>this.shouldBeInteractive?e.renew():e.cancel())),this.raycasterRegistrationBindings.forEach((e=>this.shouldBeInteractive?e.renew():e.cancel())),this.active=this.shouldBeInteractive)},this.refreshColliders=()=>{for(const e of this.labelRenderer.labelMeshIterator())this.shouldBeInteractive?this.input.registerMesh(e.text.collider,!1):this.input.unregisterMesh(e.text.collider)},this.clearColliders=()=>{for(const e of this.labelRenderer.labelMeshIterator())this.input.unregisterMesh(e.text.collider)},this.inputBindings.push(...this.setupInputBindings()),this.raycasterRegistrationBindings.push(...this.setupRaycasterBindings());const o=this.toolsData.onToolChanged(this.refresh),a=this.floorsViewData.makeFloorChangeSubscription(this.refresh),l=this.floorsViewData.onRoomSelectModeChange(this.refresh);this.appStateBindings.push(o,a,l),this.refresh()}toggleInput(e){this.enabled!==e&&(this.enabled=e,this.appStateBindings.forEach((t=>e?t.renew():t.cancel())),this.refresh())}get shouldBeInteractive(){return this.enabled&&null===this.toolsData.activeToolName&&this.floorsViewData.roomSelectModeActive}setupRaycasterBindings(){return[(0,z.k1)((()=>this.refreshColliders()),(()=>this.clearColliders()),!0,"toggleLabelMeshInput"),this.labelRenderer.subscribe({onAdded:e=>this.input.registerMesh(e.text.collider,!1),onRemoved:e=>this.input.unregisterMesh(e.text.collider)})]}setupInputBindings(){const e=V.s.is((e=>e instanceof LabelTextBackgroundMesh&&e.labelVisible())),t=this.input.registerMeshHandler(H.R,e,((e,t)=>{const i=this.labelRenderer.getLabelMesh(t.getId());if(i){const e=i.data.roomId,t=this.roomNavigationPose.getPoseForRoom(e,i.data.position);t&&this.issueCommand(new F._i(F.BD.INSIDE,U.n.Interpolate,t))}}));if((0,q.Jm)())return[t];let i=null;return[new W.V(this.input.registerMeshHandler(G.z,e,((e,t)=>{const n=this.labelRenderer.getLabelMesh(t.getId());n&&(n.hoverState.active=!0,n.hoverState.on(),i=n,this.issueCommand(new j.u(K.C.FINGER)))})),this.input.registerMeshHandler(G.A,V.s.isType(LabelTextBackgroundMesh),((e,t)=>{i&&this.issueCommand(new j.u(K.C.DEFAULT));const n=this.labelRenderer.getLabelMesh(t.getId());n&&(n.hoverState.active=!1,n.hoverState.off()),i=null})),(0,z.k1)((()=>{}),(()=>{i&&(i.hoverState.active=!1,i.hoverState.off(),this.issueCommand(new j.u(K.C.DEFAULT)),i=null)}),!0,"labelHoverClear")),t]}}var Z=i(12216),Y=i(94329);const $=new T.Z("room-with-a-view");class RoomNavigationPose{constructor(e,t,i){this.sweepData=e,this.roomData=t,this.meshData=i}getPoseForRoom(e,t){const i=this.bestViewForRoom(e,t);if(i){return{rotation:i.rotation,sweepID:i.sweepID,viewmode:Y.Ey.Panorama}}return null}bestViewForRoom(e,t){const i=this.sweepData.filter((t=>t.roomId===e&&t.enabled));if(0===i.length)return $.debug("no sweeps in selected room",{roomId:e,scansInRoom:i}),null;let n=1;const s=this.roomData.get(e),r=this.meshData.meshGroups.rooms.get(s.meshSubgroup),o=(null==r?void 0:r.boundingBox.getSize(new f.Vector3).length())||1/0;t&&o>10&&(n=.2);const a=i.sort(((i,s)=>{let r=0,o=0;t&&(r=i.position.distanceTo(t),o=s.position.distanceTo(t));const a=i.neighbours.map((e=>this.sweepData.getSweep(e))).filter((t=>t.roomId===e)).length,l=s.neighbours.map((e=>this.sweepData.getSweep(e))).filter((t=>t.roomId===e)).length;return 1*n*(l-a)-3*(o-r)})),l=a[0];if(!l)return $.debug("no start sweep",{roomId:e,scansInRoom:i,connectedness:a}),null;const c=l.neighbours.map((e=>this.sweepData.getSweep(e))).sort(((t,i)=>{let n=l.position.distanceTo(t.position),s=l.position.distanceTo(i.position);return t.roomId===e&&(n*=1e3),i.roomId===e&&(s*=1e3),s-n})).map((e=>({sweep:e,dist:l.position.distanceTo(e.position),rm:e.roomId}))),h=c[0];$.warn({roomId:e,roomSize:o,scoring:a,byDistance:c,scansInRoom:i});const d=new f.Quaternion;if(1===i.length&&void 0!==h){const e=(new f.Matrix4).setPosition(l.position);e.lookAt(h.sweep.position,l.position,Z.f.UP),d.setFromRotationMatrix(e)}else{const e=(new f.Matrix4).setPosition(l.position);e.lookAt(l.position,h.sweep.position,Z.f.UP),d.setFromRotationMatrix(e)}return{sweepID:l.id,rotation:d}}}var Q=i(25643);class LabelRendererModule extends n.Y{constructor(){super(...arguments),this.name="user-labels",this.labelMeshIterator=()=>this.spawner.meshesMap.values,this.checkForRTL=(()=>{const e=/[\u0591-\u07FF]/;let t;return(i,n)=>{if(!n.tryGetProperty(C.Q5,!1))return;const s=i=>{n.tryGetProperty(C.Q5,!1)&&e.test(i.text)&&(this.broadcast(new Q.V),n.setProperty(C.Q5,!1),t&&t.cancel())};i.getCollection().entries().forEach((e=>s(e[1]))),n.tryGetProperty(C.Q5,!1)&&(t=i.getCollection().onElementChanged({onAdded:s,onUpdated:s}),this.bindings.push(t))}})()}async init(e,t){const[i,n,p,m,g,f,v,y,b,S]=await Promise.all([t.market.waitForData(r.D),t.market.waitForData(o.M_),t.market.waitForData(a.c),t.market.waitForData(l.t),t.market.waitForData(h.Z),t.market.waitForData(d.Z),t.market.waitForData(c._),t.getModuleBySymbol(s.y.WEBGL_RENDERER),t.getModuleBySymbol(s.y.INPUT),t.market.waitForData(u.e)]),E=y.getScene();this.broadcast=t.broadcast,this.checkForRTL(i,S);const w=new LabelPartMaker(S.tryGetProperty(C.Q5,!1));w.setRenderLayer(t.claimRenderLayer("labels")),this.spawner=new LabelSpawner(i.getCollection(),w),E.add(this.spawner.container),this.visibilityRules=new LabelVisibilityRules(this.spawner.meshesMap),this.visibilityRules.init(t.market);this.labelFilter=new Label2DFiltering(this.labelMeshIterator,n,(()=>this.visibilityRules.featureEnabled()&&this.visibilityRules.visibleByTool())),this.labelRenderer=new LabelRenderer(this.spawner.meshesMap,i.getCollection(),n,this.labelFilter),t.addComponent(this,this.labelRenderer),this.visibilityRules.setDirtyCallback(this.labelRenderer.setDirty);const T=new RoomNavigationPose(g,f,v);this.labelNavInput=new LabelRendererInput(this,t.commandBinder.issueCommand,b,p,m,T),this.toggleInput(!0)}dispose(e){super.dispose(e),this.visibilityRules.dispose()}getLabelMesh(e){return e&&this.spawner.get(e)||null}addLabelMesh(e,t){return this.spawner.add(e,t)}freeLabelMesh(e){e&&this.spawner.free(e)}setPendingMeshId(e){this.visibilityRules.setPendingMeshId(e),this.labelRenderer.setPendingMeshId(e)}setSelectedMeshId(e){this.labelFilter.setSelectedMeshId(e)}toggleInput(e){this.labelNavInput.toggleInput(e)}subscribe(e){return this.spawner.subscribe(e)}onUpdate(){this.visibilityRules&&this.visibilityRules.onUpdate()}}const X=LabelRendererModule},25643:(e,t,i)=>{"use strict";i.d(t,{V:()=>RTLDisabledRoomnavMessage});var n=i(91466);class RTLDisabledRoomnavMessage extends n.v{}},23275:(e,t,i)=>{"use strict";i.d(t,{c:()=>LineSegment});var n=i(2212),s=i(78475);class Line extends n.Mesh{constructor(e,t){super(),this.type="Line",this.part=s.B.line,this.computeLineDistances=(()=>{const e=new n.Vector3,t=new n.Vector3;return()=>{const i=this.geometry,s=i.attributes.instanceStart,r=i.attributes.instanceEnd,o=new Float32Array(2*s.data.count);for(let i=0,n=0,a=s.data.count;i<a;i++,n+=2)e.fromBufferAttribute(s,i),t.fromBufferAttribute(r,i),o[n]=0===n?0:o[n-1],o[n+1]=o[n]+e.distanceTo(t);return this.instanceDistanceBuffer?(this.instanceDistanceBuffer.set(o,0),this.instanceDistanceBuffer.needsUpdate=!0):(this.instanceDistanceBuffer=new n.InstancedInterleavedBuffer(o,2,1),i.setAttribute("instanceDistanceStart",new n.InterleavedBufferAttribute(this.instanceDistanceBuffer,1,0,!1)),i.setAttribute("instanceDistanceEnd",new n.InterleavedBufferAttribute(this.instanceDistanceBuffer,1,1,!1))),this}})(),this.geometry=e,this.material=t}copy(e){throw Error("not implemented")}}class LineSegmentsGeometry extends n.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new n.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new n.Float32BufferAttribute([0,1,.5,1,0,.5,.5,.5,0,0,.5,0,0,1,.5,1],2))}applyMatrix(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),i.applyMatrix4(e),this.positionBuffer.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;return e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e)),t&&(this.positionBuffer?(this.positionBuffer.set(t,0),this.positionBuffer.needsUpdate=!0):(this.positionBuffer=new n.InstancedInterleavedBuffer(t,6,1),this.setAttribute("instanceStart",new n.InterleavedBufferAttribute(this.positionBuffer,3,0,!1)),this.setAttribute("instanceEnd",new n.InterleavedBufferAttribute(this.positionBuffer,3,3,!1))),this.computeBoundingBox(),this.computeBoundingSphere()),this}setColors(e){let t;return e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e)),t&&(this.colorBuffer?(this.colorBuffer.set(t,0),this.colorBuffer.needsUpdate=!0):(this.colorBuffer=new n.InstancedInterleavedBuffer(t,6,1),this.setAttribute("instanceColorStart",new n.InterleavedBufferAttribute(this.colorBuffer,3,0,!1)),this.setAttribute("instanceColorEnd",new n.InterleavedBufferAttribute(this.colorBuffer,3,3,!1)))),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new n.WireframeGeometry(e.geometry)),this}fromLineSegements(e){const t=e.geometry;return t instanceof n.BufferGeometry&&this.setPositions(t.position.array),this}computeBoundingBox(){this.boundingBox||(this.boundingBox=new n.Box3),this.box||(this.box=new n.Box3);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),this.box.setFromBufferAttribute(t),this.boundingBox.union(this.box))}computeBoundingSphere(){this.tempVector||(this.tempVector=new n.Vector3),this.boundingSphere||(this.boundingSphere=new n.Sphere),this.boundingBox||this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let n=0;for(let s=0,r=e.count;s<r;s++)this.tempVector.fromBufferAttribute(e,s),n=Math.max(n,i.distanceToSquared(this.tempVector)),this.tempVector.fromBufferAttribute(t,s),n=Math.max(n,i.distanceToSquared(this.tempVector));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}class LineGeometry extends LineSegmentsGeometry{constructor(){super(),this.type="LineGeometry",this.isLineGeometry=!0}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return LineSegmentsGeometry.prototype.setPositions.call(this,i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return LineSegmentsGeometry.prototype.setColors.call(this,i),this}fromLine(e){throw new Error("LineGeometry.fromLine not converted to TS yet")}copy(e){return this}}var r=i(69626),o=i(37342);class LineEndpoint extends n.Mesh{constructor(e,t,i=o.V9.endpointSelected,n=o.V9.endpointDefault){super(e,t),this.selectedSize=i,this.defaultSize=n,this.currentSize=o.V9.endpointDefault,this.currentSize=this.defaultSize,this.scale.set(o.Ey,o.Ey,o.Ey)}dispose(){this.material.dispose(),this.geometry.dispose()}billboardScale(e,t,i){const n=(0,r.mY)(t,e,this.position,i,.5),s=Math.max(Math.min(1/n*this.currentSize,o.g4),o.Ey);this.scale.set(s,s,s)}updateSelected(e){this.currentSize=e?this.selectedSize:this.defaultSize}}var a=i(48358);class LineSegment{constructor(e,t,i,o,l){this.lineMaterial=i,this.options=o,this.endpointMaterial=l,this.startPosition=new n.Vector3,this.endPosition=new n.Vector3,this.endpoints=!1,this.isVisible=!0,this.meshToLinePartMap={},this.opacity=e=>(this.endpointMaterial&&this.endpointMaterial.setOpacity(e),this.lineMesh.material.setOpacity(e),this),this.updatePositions=(e,t)=>(this.startPosition.copy(e),this.endPosition.copy(t),this.options.beforeUpdatePositions&&(e=this.options.beforeUpdatePositions(e),t=this.options.beforeUpdatePositions(t)),this.lineMesh.geometry.setPositions([e.x,e.y,e.z,t.x,t.y,t.z]),this.endpoints&&(this.endMesh.position.copy(t),this.startMesh.position.copy(e),this.lastBillboardOptions&&this.updateBillboard(this.lastBillboardOptions)),this.lineMesh.material.dashed&&this.lineMesh.computeLineDistances(),this),this.updateBillboard=e=>{if(this.endpoints&&(e.rotation&&(this.endMesh.quaternion.copy(e.rotation),this.startMesh.quaternion.copy(e.rotation)),e.position&&e.projection&&!(0,r.s1)(e.projection))){const t=this.lineMesh.material.resolution.y;this.endMesh.billboardScale(e.position,e.projection,t),this.startMesh.billboardScale(e.position,e.projection,t)}return this.lastBillboardOptions=e,this},this.updateSelected=e=>(this.lineMesh.material.updateSelected(e),this.endpoints&&(this.endMesh.material.updateHovered(e),this.endMesh.updateSelected(e),this.startMesh.updateSelected(e)),this),this.setRenderLayer=e=>{this.children.forEach((t=>t.layers.mask=e.mask))},this.setRenderOrder=e=>{this.children.forEach((t=>t.renderOrder=e))},this.updateResolution=(e,t)=>(this.lineMesh.material.resolution.set(e,t),this),this.hide=()=>{this.options.onHide&&this.options.onHide(),this.isVisible=!1},this.show=()=>{this.options.onShow&&this.options.onShow(),this.isVisible=!0},this.toggle=e=>(e?this.show():this.hide(),this),this.dispose=()=>{this.options.onHide&&this.options.onHide(),this.lineMesh.geometry.dispose(),this.lineMesh.material.dispose(),this.endMesh&&this.endMesh.dispose(),this.startMesh&&this.startMesh.dispose(),this.meshToLinePartMap={}},this.overrideLineMaterial=e=>{this.lineMesh.material=e},this.restoreLineMaterial=()=>{this.lineMesh.material=this.lineMaterial},this.startPosition.copy(e),this.endPosition.copy(t),this.lineMesh=new Line(new LineGeometry,i),this.lineMesh.matrixAutoUpdate=!1,this.lineMesh.part=s.B.line,this.lineMesh.renderOrder=a.z.lines,this.meshToLinePartMap[s.B.line]=this.lineMesh,l&&(this.endpoints=!0,this.endMesh=new LineEndpoint(new n.PlaneBufferGeometry(1,1),l),this.endMesh.part=s.B.end,this.endMesh.renderOrder=a.z.endpoints,this.meshToLinePartMap[s.B.end]=this.endMesh,this.startMesh=new LineEndpoint(new n.PlaneBufferGeometry(1,1),l),this.startMesh.part=s.B.start,this.startMesh.renderOrder=a.z.endpoints,this.meshToLinePartMap[s.B.start]=this.startMesh),this.updatePositions(this.startPosition,this.endPosition),this.updateSelected(!1)}get currentOpacity(){return this.lineMesh.material.getOpacity()}getMesh(e){return this.meshToLinePartMap[e]}get children(){return Object.keys(this.meshToLinePartMap).map((e=>this.meshToLinePartMap[e]))}get visible(){return this.isVisible}}},78475:(e,t,i)=>{"use strict";var n;i.d(t,{B:()=>n}),function(e){e.line="line",e.start="start",e.end="end"}(n||(n={}))},26589:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Lines});var n,s=i(47724),r=i(736),o=i(2212),a=i(23275),l=i(66223),c=i(91975),h=i(40886),d=i(71370),u=i(88296);!function(e){e[e.LINE_DEFAULT=0]="LINE_DEFAULT",e[e.LINE_HOVER=1]="LINE_HOVER",e[e.END_DEFAULT=2]="END_DEFAULT",e[e.END_HOVER=3]="END_HOVER"}(n||(n={}));class LineTextures{constructor(){const e=(0,l.p)(c),t=(0,l.p)(h),i=(0,l.p)(d),s=(0,l.p)(u);this.textures={[n.LINE_DEFAULT]:i,[n.LINE_HOVER]:s,[n.END_DEFAULT]:e,[n.END_HOVER]:t},i.minFilter=o.LinearFilter,s.minFilter=o.LinearFilter,e.minFilter=o.LinearFilter,t.minFilter=o.LinearFilter}get(e){return this.textures[e]}dispose(){for(const e in this.textures){const t=Number(e);this.get(t).dispose()}}}var p=i(31090),m=i(69383),g=i(20855);const f={endpoint:{uniforms:{opacity:{type:"f",value:1},color:{type:"c",value:new o.Color},bg:{type:"t",value:null}},vertexShader:(0,g.m)(m,i(79826)),fragmentShader:(0,g.m)(p,i(2209))},line:{uniforms:o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.fog,{linewidth:{value:4},resolution:{value:new o.Vector2(0,0)},dashScale:{value:1},dashSize:{value:.025},gapSize:{value:.05},mask:{value:null}}]),vertexShader:i(63862),fragmentShader:i(64116)}};var v=i(37342);class LineMaterial extends o.ShaderMaterial{constructor(e,t,i,n=v.V9.lineSelected){super(),this.parameters=e,this.hoverTexture=t,this.defaultTexture=i,this.selectedWidth=n,this.type="LineMaterial",this.isLineMaterial=!0,this.defaultWidth=v.V9.lineDefault,this.setValues({uniforms:o.UniformsUtils.clone(f.line.uniforms),vertexShader:f.line.vertexShader,fragmentShader:f.line.fragmentShader,transparent:!0,depthWrite:!1,depthTest:!0,opacity:1}),this.setValues(e),i&&(this.mask=i),this.defaultWidth=e&&e.linewidth?e.linewidth:v.V9.lineDefault}updateSelected(e){const t=e?this.hoverTexture:this.defaultTexture;t&&this.mask!==t&&(this.mask=t,e?this.setLinewidth(this.selectedWidth):this.setLinewidth(this.defaultWidth))}setLinewidth(e){this.uniforms.linewidth||(this.uniforms=o.UniformsUtils.clone(f.line.uniforms)),this.getLinewidth()!==e&&(this.uniforms.linewidth.value=e)}getLinewidth(){return this.uniforms.linewidth.value}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}getOpacity(){return this.uniforms.opacity.value}setOpacity(e){this.uniforms||(this.uniforms=o.UniformsUtils.clone(f.line.uniforms)),this.getOpacity()!==e&&(this.uniforms.opacity.value=e)}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}set dashed(e){e?this.defines.USE_DASH="":delete this.defines.USE_DASH,this.needsUpdate=!0}get dashed(){return"USE_DASH"in this.defines}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value=e}set mask(e){this.uniforms.mask.value!==e&&(e?this.defines.USE_MASK="":delete this.defines.USE_MASK,this.uniforms.mask.value=e,this.needsUpdate=!0)}get mask(){return this.uniforms.mask.value}copy(e){return o.ShaderMaterial.prototype.copy.call(this,e),this.parameters=e.parameters,this.color.copy(e.color),this.defaultWidth=e.defaultWidth,this.setLinewidth(e.getLinewidth()),this.resolution.copy(e.resolution),this.defaultTexture=e.defaultTexture,this.hoverTexture=e.hoverTexture,this.mask=e.mask,this.setOpacity(e.getOpacity()),this.dashed=e.dashed,this.dashScale=e.dashScale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}class LineEndpointMaterial extends o.RawShaderMaterial{constructor(e,t,i){const n=o.UniformsUtils.clone(f.endpoint.uniforms);super({fragmentShader:f.endpoint.fragmentShader,vertexShader:f.endpoint.vertexShader,uniforms:n,name:"LineEndpointMaterial",transparent:!0,depthWrite:!1,depthTest:!0}),this.color=e,this.defaultTex=t,this.hoverTex=i,this.uniforms.bg.value=t,this.uniforms.color.value.copy(this.color)}clone(){return new LineEndpointMaterial(this.color,this.defaultTex,this.hoverTex).copy(this)}setOpacity(e){this.uniforms&&e!==this.uniforms.opacity.value&&(this.uniforms.opacity.value=e)}getOpacity(){return this.uniforms.opacity.value}updateHovered(e){const t=e?this.hoverTex:this.defaultTex;this.uniforms.bg.value!==t&&(this.uniforms.bg.value=t)}}var y=i(59088),b=i(67627),S=i(40168);class Lines extends s.Y{constructor(){super(...arguments),this.name="lines",this.makeLineMaterial=(e,t,i={},n,s)=>Lines.makeLineMaterial(e,t,i,n,s),this.makeEndpointMaterial=(e,t,i)=>Lines.makeEndpointMaterial(e,t,i),this.onCanvasChange=e=>{for(const t of this.segments)t.updateResolution(e.width,e.height)}}static get textures(){return Lines._textures||(Lines._textures=new LineTextures),Lines._textures}async init(e,t){Lines._textures||(Lines._textures=new LineTextures);const i=await t.getModuleBySymbol(r.y.WEBGL_RENDERER);this.scene=i.getScene(),this.canvas=await t.market.waitForData(S.W),this.cameraData=await t.market.waitForData(y.M_),this.bindings.push(this.canvas.onChanged(this.onCanvasChange)),this.cameraPosition=new o.Vector3,this.segments=[]}onUpdate(){this.cameraPosition.copy(this.cameraData.pose.position)}dispose(e){super.dispose(e),this.segments.forEach((e=>e.dispose()))}makeLine(e,t,i,n,s=(()=>!1)){const r=s()?v.iV.OFFSET_TOWARDS_CAMERA:0,o=s()?e=>this.cameraPosition.clone().sub(e).setLength(r).add(e):e=>e,l=new a.c(e,t,i,{beforeUpdatePositions:o,onShow:()=>l.children.forEach((e=>this.scene.addChild(b.a.Root,e))),onHide:()=>l.children.forEach((e=>this.scene.removeChild(b.a.Root,e)))},n);return l.updateResolution(this.canvas.width,this.canvas.height),l.opacity(1),l.show(),l.updatePositions(e,t),this.segments.push(l),l}}Lines.makeLineMaterial=(e,t,i={},s,r)=>{const a=r||Lines.textures.get(n.LINE_HOVER),l=s||Lines.textures.get(n.LINE_DEFAULT),c=new o.Vector2(window.innerWidth,window.innerHeight);return t?new LineMaterial(Object.assign({color:new o.Color(e),resolution:c},i),a,l):new LineMaterial(Object.assign({color:new o.Color(e)},i))},Lines.makeEndpointMaterial=(e,t,i)=>{const s=i||Lines.textures.get(n.END_HOVER),r=t||Lines.textures.get(n.END_DEFAULT);return new LineEndpointMaterial(new o.Color(e),r,s)}},37342:(e,t,i)=>{"use strict";i.d(t,{iV:()=>n,V9:()=>s,Ey:()=>r,g4:()=>o});const n={FADE_DURATION:300,LABEL_HIDDEN_OPACITY:.15,DEPTH_WRITE_THRESHOD:.15,ALIGN_LABELS:!1,LABEL_SIZING:.14,LABEL_NDC_SCALEFACTOR:.5,LABEL_ASPECT_SCALEFACTOR:.035,OFFSET_TOWARDS_CAMERA:.25,HIDE_LABELS:!1},s={dottedLineDefault:2,lineDefault:6,lineSelected:6,endpointDefault:2.5,endpointSelected:3.75},r=.01,o=5},13789:(e,t,i)=>{"use strict";var n;i.d(t,{Z:()=>s}),function(e){e.LOADING="LOADING",e.PRESENTED_BY_CAPS="PRESENTED_BY_CAPS",e.EXPLORE_3D_SPACE="EXPLORE_3D_SPACE",e.POWERED_BY="POWERED_BY",e.SC_LOCKOUT_MESSAGE="SC_LOCKOUT_MESSAGE",e.SC_LOCKOUT_TITLE="SC_LOCKOUT_TITLE",e.SC_PASSWORD_TITLE="SC_PASSWORD_TITLE",e.SC_PASSWORD_INVALID="SC_PASSWORD_INVALID",e.SC_PASSWORD_PLACEHOLDER="SC_PASSWORD_PLACEHOLDER",e.SC_PASSWORD_SUBMIT="SC_PASSWORD_SUBMIT",e.VIEW_INSIDE="VIEW_INSIDE",e.VIEW_INSIDE_MESH="VIEW_INSIDE_MESH",e.VIEW_DOLLHOUSE="VIEW_DOLLHOUSE",e.VIEW_FLOORPLAN="VIEW_FLOORPLAN",e.VIEW_FULLSCREEN="VIEW_FULLSCREEN",e.EXIT_FULLSCREEN="EXIT_FULLSCREEN",e.OPEN_HIGHLIGHTS="OPEN_HIGHLIGHTS",e.CLOSE_HIGHLIGHTS="CLOSE_HIGHLIGHTS",e.PAUSE="PAUSE",e.SOCIAL_SHARING="SOCIAL_SHARING",e.VIEW_IN_VR="VIEW_IN_VR",e.FLOOR_NAME="FLOOR_NAME",e.FLOOR_ALL="FLOOR_ALL",e.PRESENTED_BY="PRESENTED_BY",e.MORE="MORE",e.LESS="LESS",e.LEARN_MORE="LEARN_MORE",e.FEEDBACK="FEEDBACK",e.TERMS="TERMS",e.HELP="HELP",e.ALT_MATTERPORT_LOGO="ALT_MATTERPORT_LOGO",e.TERMS_FAIL="TERMS_FAIL",e.HELP_NAVIGATION_TAB="HELP_NAVIGATION_TAB",e.HELP_MORE_HELP_TAB="HELP_MORE_HELP_TAB",e.HELP_DESKTOP_360_2A="HELP_DESKTOP_360_2A",e.HELP_DESKTOP_360_2B="HELP_DESKTOP_360_2B",e.HELP_DESKTOP_DOLLHOUSE_1A="HELP_DESKTOP_DOLLHOUSE_1A",e.HELP_DESKTOP_DOLLHOUSE_1B="HELP_DESKTOP_DOLLHOUSE_1B",e.HELP_DESKTOP_DOLLHOUSE_2A="HELP_DESKTOP_DOLLHOUSE_2A",e.HELP_DESKTOP_DOLLHOUSE_3A="HELP_DESKTOP_DOLLHOUSE_3A",e.HELP_DESKTOP_FLOORPLAN_1A="HELP_DESKTOP_FLOORPLAN_1A",e.HELP_DESKTOP_FLOORPLAN_2A="HELP_DESKTOP_FLOORPLAN_2A",e.HELP_DESKTOP_FLOORPLAN_2B="HELP_DESKTOP_FLOORPLAN_2B",e.HELP_DESKTOP_FLOORPLAN_3A="HELP_DESKTOP_FLOORPLAN_3A",e.HELP_DESKTOP_FLOORPLAN_3B="HELP_DESKTOP_FLOORPLAN_3B",e.HELP_DESKTOP_MORE_360_B="HELP_DESKTOP_MORE_360_B",e.HELP_DESKTOP_MORE_DOLLHOUSE_B="HELP_DESKTOP_MORE_DOLLHOUSE_B",e.HELP_DESKTOP_MORE_FLOORS_B="HELP_DESKTOP_MORE_FLOORS_B",e.HELP_DESKTOP_MORE_FULLSCREEN_B="HELP_DESKTOP_MORE_FULLSCREEN_B",e.HELP_DESKTOP_MORE_HLR_B="HELP_DESKTOP_MORE_HLR_B",e.HELP_DESKTOP_MORE_INSIDE_B="HELP_DESKTOP_MORE_INSIDE_B",e.HELP_DESKTOP_MORE_MATTERTAG_B="HELP_DESKTOP_MORE_MATTERTAG_B",e.HELP_DESKTOP_MORE_TOUR_B="HELP_DESKTOP_MORE_TOUR_B",e.HELP_DESKTOP_MORE_VR_B="HELP_DESKTOP_MORE_VR_B",e.HELP_DESKTOP_MORE_ZOOM_B="HELP_DESKTOP_MORE_ZOOM_B",e.HELP_DESKTOP_PANORAMA_1A="HELP_DESKTOP_PANORAMA_1A",e.HELP_DESKTOP_PANORAMA_1B="HELP_DESKTOP_PANORAMA_1B",e.HELP_DESKTOP_PANORAMA_2A="HELP_DESKTOP_PANORAMA_2A",e.HELP_DESKTOP_PANORAMA_2B="HELP_DESKTOP_PANORAMA_2B",e.HELP_DESKTOP_PANORAMA_3A="HELP_DESKTOP_PANORAMA_3A",e.HELP_DESKTOP_PANORAMA_3B="HELP_DESKTOP_PANORAMA_3B",e.HELP_MOBILE_3="HELP_MOBILE_3",e.HELP_MOBILE_360_2="HELP_MOBILE_360_2",e.HELP_MOBILE_DOLLHOUSE_1="HELP_MOBILE_DOLLHOUSE_1",e.HELP_MOBILE_DOLLHOUSE_2="HELP_MOBILE_DOLLHOUSE_2",e.HELP_MOBILE_FLOORPLAN_1="HELP_MOBILE_FLOORPLAN_1",e.HELP_MOBILE_FLOORPLAN_2="HELP_MOBILE_FLOORPLAN_2",e.HELP_MOBILE_MORE_360_B="HELP_MOBILE_MORE_360_B",e.HELP_MOBILE_MORE_DOLLHOUSE_B="HELP_MOBILE_MORE_DOLLHOUSE_B",e.HELP_MOBILE_MORE_INSIDE_B="HELP_MOBILE_MORE_INSIDE_B",e.HELP_MOBILE_MORE_MATTERTAG_B="HELP_MOBILE_MORE_MATTERTAG_B",e.HELP_MOBILE_MORE_VR_B="HELP_MOBILE_MORE_VR_B",e.HELP_MOBILE_PANORAMA_1="HELP_MOBILE_PANORAMA_1",e.HELP_MOBILE_PANORAMA_2="HELP_MOBILE_PANORAMA_2",e.HELP_MORE_360_A="HELP_MORE_360_A",e.HELP_MORE_DOLLHOUSE_A="HELP_MORE_DOLLHOUSE_A",e.HELP_MORE_FLOORS_A="HELP_MORE_FLOORS_A",e.HELP_MORE_FLOORPLAN_A="HELP_MORE_FLOORPLAN_A",e.HELP_MORE_FULLSCREEN_A="HELP_MORE_FULLSCREEN_A",e.HELP_MORE_HLR_A="HELP_MORE_HLR_A",e.HELP_MORE_INSIDE_A="HELP_MORE_INSIDE_A",e.HELP_MORE_MATTERTAG_A="HELP_MORE_MATTERTAG_A",e.HELP_MORE_TOUR_A="HELP_MORE_TOUR_A",e.HELP_MORE_VR_A="HELP_MORE_VR_A",e.HELP_MORE_ZOOM_A="HELP_MORE_ZOOM_A",e.VR_APP_INSTRUCT="VR_APP_INSTRUCT",e.VR_APP_RECCOMMENDED="VR_APP_RECCOMMENDED",e.VR_ENTER="VR_ENTER",e.VR_LEARN_MORE_CAPS="VR_LEARN_MORE_CAPS",e.VR_QUEST="VR_QUEST",e.VR_RECOMMENDED="VR_RECOMMENDED",e.VR_SUPPORTS="VR_SUPPORTS",e.VR_VIEW_SPACE="VR_VIEW_SPACE",e.ERROR_WEBGL_UNSUPPORTED_PROBLEM="ERROR_WEBGL_UNSUPPORTED_PROBLEM",e.ERROR_BROWSER_SOLUTION="ERROR_BROWSER_SOLUTION",e.ERROR_BROWSER_EXPLANATION="ERROR_BROWSER_EXPLANATION",e.ERROR_LOADING_FAILED_PROBLEM="ERROR_LOADING_FAILED_PROBLEM",e.ERROR_LOADING_FAILED_ACTIONS="ERROR_LOADING_FAILED_ACTIONS",e.ERROR_GENERIC_PROBLEM="ERROR_GENERIC_PROBLEM",e.ERROR_GENERIC_SOLUTION="ERROR_GENERIC_SOLUTION",e.ERROR_GENERIC_ACTIONS="ERROR_GENERIC_ACTIONS",e.ERROR_GENERIC_ACTIONS_MOBILE="ERROR_GENERIC_ACTIONS_MOBILE",e.DESKTOP_SHORT_CTA="DESKTOP_SHORT_CTA",e.MOBILE_SHORT_CTA="MOBILE_SHORT_CTA",e.ROTATE="ROTATE",e.MOVE="MOVE",e.PLAY="PLAY",e.INSIDE="INSIDE",e.ZOOM="ZOOM",e.MEASUREMENT="MEASUREMENT",e.MEASUREMENT_START_ADDING="MEASUREMENT_START_ADDING",e.MEASUREMENT_CONTINUOUS_LINES="MEASUREMENT_CONTINUOUS_LINES",e.MEASUREMENT_SNAPPING="MEASUREMENT_SNAPPING",e.MEASUREMENT_UNITS="MEASUREMENT_UNITS",e.MEASUREMENT_IMPERIAL="MEASUREMENT_IMPERIAL",e.MEASUREMENT_METRIC="MEASUREMENT_METRIC",e.MEASUREMENT_SETTINGS="MEASUREMENT_SETTINGS",e.MEASUREMENT_HELP_CLICK_ANYWHERE="MEASUREMENT_HELP_CLICK_ANYWHERE",e.MEASUREMENT_HELP_ESCAPE="MEASUREMENT_HELP_ESCAPE",e.MEASUREMENT_HELP_PRESS_START="MEASUREMENT_HELP_PRESS_START",e.MEASUREMENT_HELP_DRAG_EDIT="MEASUREMENT_HELP_DRAG_EDIT",e.MEASUREMENT_HELP_PRESS_END="MEASUREMENT_HELP_PRESS_END",e.MEASUREMENT_MODE="MEASUREMENT_MODE",e.MEASUREMENT_HELP_MODAL_SUB_HEADER="MEASUREMENT_HELP_MODAL_SUB_HEADER",e.MEASUREMENT_HELP_MODAL_BODY_1="MEASUREMENT_HELP_MODAL_BODY_1",e.MEASUREMENT_HELP_MODAL_BODY_2="MEASUREMENT_HELP_MODAL_BODY_2",e.MEASUREMENT_NUDGE_TITLE="MEASUREMENT_NUDGE_TITLE",e.MEASUREMENT_NUDGE_MESSAGE="MEASUREMENT_NUDGE_MESSAGE",e.NOTES_MODE="NOTES_MODE",e.NOTES_NUDGE_TITLE="NOTES_NUDGE_TITLE",e.NOTES_NUDGE_MESSAGE="NOTES_NUDGE_MESSAGE",e.ON="ON",e.OFF="OFF",e.CLOSE="CLOSE",e.COPY="COPY",e.COPY_URL="COPY_URL",e.SHARE="SHARE",e.SHARE_COPIED="SHARE_COPIED",e.SHARE_CURRENT_LOCATION="SHARE_CURRENT_LOCATION",e.SHARE_DEFAULT_LOCATION="SHARE_DEFAULT_LOCATION",e.SHARE_ERROR_SWEEP_DISABLED="SHARE_ERROR_SWEEP_DISABLED",e.SHARE_EXPLORE="SHARE_EXPLORE",e.SHARE_LINK_TO_LOCATION="SHARE_LINK_TO_LOCATION",e.SHARE_AT="SHARE_AT",e.SHARE_WITH="SHARE_WITH",e.SHARE_3D="SHARE_3D",e.SHARE_MODAL_TITLE="SHARE_MODAL_TITLE",e.SHARED_TITLE="SHARED_TITLE",e.SHARED_MESSAGE="SHARED_MESSAGE",e.SHARED_MESSAGE_HASHTAG="SHARED_MESSAGE_HASHTAG"}(n||(n={})),function(e){let t,i,n,s,r;!function(e){e.CLOSE_BUTTON_TOOLTIP_MESSAGE="REUSABLES.CLOSE_BUTTON_TOOLTIP_MESSAGE",e.HELP_BUTTON_TOOLTIP_MESSAGE="REUSABLES.HELP_BUTTON_TOOLTIP_MESSAGE",e.EMOJI_ALT_DISAPPOINTED="REUSABLES.EMOJI_ALT_DISAPPOINTED",e.EMOJI_ALT_UNSATISFIED="REUSABLES.EMOJI_ALT_UNSATISFIED",e.EMOJI_ALT_NEUTRAL="REUSABLES.EMOJI_ALT_NEUTRAL",e.EMOJI_ALT_SATISFIED="REUSABLES.EMOJI_ALT_SATISFIED",e.EMOJI_ALT_HAPPY="REUSABLES.EMOJI_ALT_HAPPY"}(t=e.REUSABLES||(e.REUSABLES={})),function(e){let t,i,n,s,r;!function(e){e.DEFAULT_NAME="SHOWCASE.FLOORS.DEFAULT_NAME"}(t=e.FLOORS||(e.FLOORS={})),function(e){e.ALT_GESTURE_DRAG="SHOWCASE.HELP.ALT_GESTURE_DRAG",e.ALT_GESTURE_DRAGTWOFINGER="SHOWCASE.HELP.ALT_GESTURE_DRAGTWOFINGER",e.ALT_GESTURE_POSITION="SHOWCASE.HELP.ALT_GESTURE_POSITION",e.ALT_GESTURE_PINCH="SHOWCASE.HELP.ALT_GESTURE_PINCH",e.ALT_GESTURE_PLAY="SHOWCASE.HELP.ALT_GESTURE_PLAY",e.ALT_GESTURE_POSITIONTWOFINGER="SHOWCASE.HELP.ALT_GESTURE_POSITIONTWOFINGER",e.ALT_GESTURE_TAP="SHOWCASE.HELP.ALT_GESTURE_TAP",e.ALT_GESTURE_TAPINSIDE="SHOWCASE.HELP.ALT_GESTURE_TAPINSIDE",e.ALT_KEYBOARD_ALL="SHOWCASE.HELP.ALT_KEYBOARD_ALL",e.ALT_KEYBOARD_INSIDE="SHOWCASE.HELP.ALT_KEYBOARD_INSIDE",e.ALT_KEYBOARD_LEFTRIGHT="SHOWCASE.HELP.ALT_KEYBOARD_LEFTRIGHT",e.ALT_KEYBOARD_UPDOWN="SHOWCASE.HELP.ALT_KEYBOARD_UPDOWN",e.ALT_KEYBOARD_ZOOM="SHOWCASE.HELP.ALT_KEYBOARD_ZOOM",e.ALT_MOUSE_CLICK="SHOWCASE.HELP.ALT_MOUSE_CLICK",e.ALT_MOUSE_CLICKINSIDE="SHOWCASE.HELP.ALT_MOUSE_CLICKINSIDE",e.ALT_MOUSE_DRAGLEFT="SHOWCASE.HELP.ALT_MOUSE_DRAGLEFT",e.ALT_MOUSE_DRAGRIGHT="SHOWCASE.HELP.ALT_MOUSE_DRAGRIGHT",e.ALT_MOUSE_PLAY="SHOWCASE.HELP.ALT_MOUSE_PLAY",e.ALT_MOUSE_POSITIONLEFT="SHOWCASE.HELP.ALT_MOUSE_POSITIONLEFT",e.ALT_MOUSE_POSITIONRIGHT="SHOWCASE.HELP.ALT_MOUSE_POSITIONRIGHT",e.ALT_MOUSE_ZOOM="SHOWCASE.HELP.ALT_MOUSE_ZOOM"}(i=e.HELP||(e.HELP={})),function(e){e.EDIT_LIST_ITEM_OPTION_CTA="SHOWCASE.NOTES.EDIT_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="SHOWCASE.NOTES.DELETE_LIST_ITEM_OPTION_CTA"}(n=e.NOTES||(e.NOTES={})),function(e){e.TYPE="SHOWCASE.TAGS.TYPE",e.NUM_TYPE="SHOWCASE.TAGS.NUM_TYPE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="SHOWCASE.TAGS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="SHOWCASE.TAGS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.EDIT_LIST_ITEM_OPTION_CTA="SHOWCASE.TAGS.EDIT_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="SHOWCASE.TAGS.DELETE_LIST_ITEM_OPTION_CTA",e.MULTI_FLOOR_EMPTY_MESSAGE="SHOWCASE.TAGS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="SHOWCASE.TAGS.SINGLE_FLOOR_EMPTY_MESSAGE",e.EMPTY_LIST_MESSAGE="SHOWCASE.TAGS.EMPTY_LIST_MESSAGE"}(s=e.TAGS||(e.TAGS={})),function(e){e.CLEAR_SEARCH="SHOWCASE.SEARCH.CLEAR_SEARCH",e.GROUP_FLOOR="SHOWCASE.SEARCH.GROUP_FLOOR",e.GROUP_TYPE="SHOWCASE.SEARCH.GROUP_TYPE",e.GROUP_BY="SHOWCASE.SEARCH.GROUP_BY",e.ITEMS="SHOWCASE.SEARCH.ITEMS",e.EMPTY_LIST_MESSAGE="SHOWCASE.SEARCH.EMPTY_LIST_MESSAGE"}(r=e.SEARCH||(e.SEARCH={}))}(i=e.SHOWCASE||(e.SHOWCASE={})),function(e){e.BLUR="TOOLS.BLUR",e.BLUR_HELP_MESSAGE="TOOLS.BLUR_HELP_MESSAGE",e.HLR="TOOLS.HLR",e.HLR_HELP_MESSAGE="TOOLS.HLR_HELP_MESSAGE",e.LABELS="TOOLS.LABELS",e.LABELS_HELP_MESSAGE="TOOLS.LABELS_HELP_MESSAGE",e.MATTERTAGS="TOOLS.MATTERTAGS",e.MATTERTAGS_HELP_MESSAGE="TOOLS.MATTERTAGS_HELP_MESSAGE",e.MEASUREMENTS="TOOLS.MEASUREMENTS",e.MEASUREMENTS_HELP_MESSAGE="TOOLS.MEASUREMENTS_HELP_MESSAGE",e.NOTES="TOOLS.NOTES",e.PHOTOS="TOOLS.PHOTOS",e.PHOTOS_HELP_MESSAGE="TOOLS.PHOTOS_HELP_MESSAGE",e.SCANS_3D="TOOLS.SCANS_3D",e.SCANS_3D_HELP_MESSAGE="TOOLS.SCANS_3D_HELP_MESSAGE",e.SETTINGS_PANEL="TOOLS.SETTINGS_PANEL",e.START_LOCATION="TOOLS.START_LOCATION",e.START_LOCATION_HELP_MESSAGE="TOOLS.START_LOCATION_HELP_MESSAGE",e.TAGS="TOOLS.TAGS",e.VIEW_360="TOOLS.VIEW_360",e.VIEW_360_HELP_MESSAGE="TOOLS.VIEW_360_HELP_MESSAGE",e.VR_PATH="TOOLS.VR_PATH",e.VR_PATH_HELP_MESSAGE="TOOLS.VR_PATH_HELP_MESSAGE",e.SEARCH="TOOLS.SEARCH"}(n=e.TOOLS||(e.TOOLS={})),function(e){e.INVITE_USER="USERS.INVITE_USER",e.INVITE_USER_FAILED="USERS.INVITE_USER_FAILED",e.INVITE_VIEWER_BUTTON="USERS.INVITE_VIEWER_BUTTON",e.INVITE_EDITOR_BUTTON="USERS.INVITE_EDITOR_BUTTON",e.INVITE_USERS="USERS.INVITE_USERS",e.INVITE_USERS_FAILED="USERS.INVITE_USERS_FAILED",e.INVITE_VIEWERS_BUTTON="USERS.INVITE_VIEWERS_BUTTON",e.INVITE_EDITORS_BUTTON="USERS.INVITE_EDITORS_BUTTON",e.INVITE_VISIBLE_MSG="USERS.INVITE_VISIBLE_MSG",e.UNKNOWN_USER="USERS.UNKNOWN_USER",e.UNKNOWN_USERS="USERS.UNKNOWN_USERS"}(s=e.USERS||(e.USERS={})),function(e){let t,i,n,s,r,o,a,l,c,h,d,u,p,m,g,f,v,y;!function(e){e.DELETE_SELECTED_CTA="WORKSHOP.ACCORDION.DELETE_SELECTED_CTA",e.SELECT_ALL_CTA="WORKSHOP.ACCORDION.SELECT_ALL_CTA",e.ENTER_SELECT_MODE_CTA="WORKSHOP.ACCORDION.ENTER_SELECT_MODE_CTA",e.EXIT_SELECT_MODE_CTA="WORKSHOP.ACCORDION.EXIT_SELECT_MODE_CTA",e.DELETE_FOOTER_CTA="WORKSHOP.ACCORDION.DELETE_FOOTER_CTA",e.TOGGLE_VISIBILITY_FOOTER_CTA="WORKSHOP.ACCORDION.TOGGLE_VISIBILITY_FOOTER_CTA",e.BATCH_DELETE_MODAL_TITLE="WORKSHOP.ACCORDION.BATCH_DELETE_MODAL_TITLE",e.BATCH_DELETE_MODAL_MESSAGE="WORKSHOP.ACCORDION.BATCH_DELETE_MODAL_MESSAGE",e.RENAME_HEADER_OPTION_CTA="WORKSHOP.ACCORDION.RENAME_HEADER_OPTION_CTA"}(t=e.ACCORDION||(e.ACCORDION={})),function(e){e.CHANGES_SAVED_MESSAGE="WORKSHOP.APP_SWITCH.CHANGES_SAVED_MESSAGE",e.EDIT_CTA="WORKSHOP.APP_SWITCH.EDIT_CTA",e.UNSUPPORTED_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.UNSUPPORTED_TOOLTIP_MESSAGE",e.UNSUPPORTED_TOOLTIP_TITLE="WORKSHOP.APP_SWITCH.UNSUPPORTED_TOOLTIP_TITLE",e.PUBLIC_PUBLISH_TOOLTIP_TITLE="WORKSHOP.APP_SWITCH.PUBLIC_PUBLISH_TOOLTIP_TITLE",e.PRIVATE_PUBLISH_TOOLTIP_TITLE="WORKSHOP.APP_SWITCH.PRIVATE_PUBLISH_TOOLTIP_TITLE",e.PUBLIC_PUBLISH_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.PUBLIC_PUBLISH_TOOLTIP_MESSAGE",e.PRIVATE_PUBLISH_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.PRIVATE_PUBLISH_TOOLTIP_MESSAGE",e.PUBLISH_CHANGES_CTA="WORKSHOP.APP_SWITCH.PUBLISH_CHANGES_CTA",e.PUBLISHING_CHANGES_CTA="WORKSHOP.APP_SWITCH.PUBLISHING_CHANGES_CTA",e.REVERT_CHANGES_MODAL_TITLE="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_TITLE",e.REVERT_CHANGES_MODAL_HEADER="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_HEADER",e.REVERT_CHANGES_MODAL_EXPLANATION="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_EXPLANATION",e.REVERT_CHANGES_MODAL_WARNING="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_WARNING",e.REVERT_CHANGES_MODAL_LEARN_MORE_CTA="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_LEARN_MORE_CTA",e.REVERT_CHANGES_MODAL_CANCEL_CTA="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_CANCEL_CTA",e.REVERT_CHANGES_MODAL_REVERT_CTA="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_REVERT_CTA",e.FLOORS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.FLOORS_CHECKBOX_LABEL",e.MEASUREMENTS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.MEASUREMENTS_CHECKBOX_LABEL",e.MATTERTAGS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.MATTERTAGS_CHECKBOX_LABEL",e.LABELS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.LABELS_CHECKBOX_LABEL",e.HIGHLIGHTS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.HIGHLIGHTS_CHECKBOX_LABEL",e.START_LOCATION_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.START_LOCATION_CHECKBOX_LABEL",e.SETTINGS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.SETTINGS_CHECKBOX_LABEL",e.SWEEPS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.SWEEPS_CHECKBOX_LABEL",e.BLURS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.BLURS_CHECKBOX_LABEL",e.NO_UNPUBLISHED_CHANGES_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.NO_UNPUBLISHED_CHANGES_CHECKBOX_LABEL",e.EXIT_EDIT_MODE_CTA="WORKSHOP.APP_SWITCH.EXIT_EDIT_MODE_CTA",e.EXIT_EDIT_MODE_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.EXIT_EDIT_MODE_TOOLTIP_MESSAGE",e.DISCARD_CHANGES_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.DISCARD_CHANGES_TOOLTIP_MESSAGE",e.PREVIEW_CHANGES_CTA="WORKSHOP.APP_SWITCH.PREVIEW_CHANGES_CTA",e.TIMESTAMP_UNPUBLISHED_CHANGES="WORKSHOP.APP_SWITCH.TIMESTAMP_UNPUBLISHED_CHANGES",e.TIMESTAMP_GREATER_THAN_ONE_MONTH="WORKSHOP.APP_SWITCH.TIMESTAMP_GREATER_THAN_ONE_MONTH",e.TIMESTAMP_DAY="WORKSHOP.APP_SWITCH.TIMESTAMP_DAY",e.TIMESTAMP_HOUR="WORKSHOP.APP_SWITCH.TIMESTAMP_HOUR",e.TIMESTAMP_MINUTE="WORKSHOP.APP_SWITCH.TIMESTAMP_MINUTE",e.TIMESTAMP_LESS_THAN_ONE_MINUTE="WORKSHOP.APP_SWITCH.TIMESTAMP_LESS_THAN_ONE_MINUTE",e.TIMESTAMP_LAST_PUBLISHED_MESSAGE="WORKSHOP.APP_SWITCH.TIMESTAMP_LAST_PUBLISHED_MESSAGE",e.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE",e.UNABLE_TO_PUBLISH_CHANGES_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNABLE_TO_PUBLISH_CHANGES_ERROR_MESSAGE",e.UNABLE_TO_REVERT_CHANGES_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNABLE_TO_REVERT_CHANGES_ERROR_MESSAGE",e.UNAUTHORIZED_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNAUTHORIZED_ERROR_MESSAGE"}(i=e.APP_SWITCH||(e.APP_SWITCH={})),function(e){e.TYPE="WORKSHOP.BLURS.TYPE",e.NUM_TYPE="WORKSHOP.BLURS.NUM_TYPE",e.APPLY_BLURS_CTA="WORKSHOP.BLURS.APPLY_BLURS_CTA",e.OVERLAY_MESSAGE="WORKSHOP.BLURS.OVERLAY_MESSAGE",e.CREATE_TOOLTIP_TITLE="WORKSHOP.BLURS.CREATE_TOOLTIP_TITLE",e.CREATE_TOOLTIP_MESSAGE="WORKSHOP.BLURS.CREATE_TOOLTIP_MESSAGE",e.BRUSH_TOOLTIP_TITLE="WORKSHOP.BLURS.BRUSH_TOOLTIP_TITLE",e.BRUSH_TOOLTIP_MESSAGE="WORKSHOP.BLURS.BRUSH_TOOLTIP_MESSAGE",e.DELETE_BLUR_CTA="WORKSHOP.BLURS.DELETE_BLUR_CTA",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.BLURS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.BLURS.SINGLE_FLOOR_EMPTY_MESSAGE",e.OTHER_GROUP_LABEL="WORKSHOP.BLURS.OTHER_GROUP_LABEL",e.DEFAULT_BLUR_NAME="WORKSHOP.BLURS.DEFAULT_BLUR_NAME",e.DEFAULT_ALERT_TITLE="WORKSHOP.BLURS.DEFAULT_ALERT_TITLE",e.DEFAULT_ALERT_CONFIRMATION="WORKSHOP.BLURS.DEFAULT_ALERT_CONFIRMATION",e.ALREADY_PROCESSING_ALERT_MESSAGE="WORKSHOP.BLURS.ALREADY_PROCESSING_ALERT_MESSAGE",e.ALREADY_PROCESSING_ALERT_TITLE="WORKSHOP.BLURS.ALREADY_PROCESSING_ALERT_TITLE",e.BLUR_STATUS_PROCESSING="WORKSHOP.BLURS.BLUR_STATUS_PROCESSING",e.BLUR_STATUS_SUGGESTED="WORKSHOP.BLURS.BLUR_STATUS_SUGGESTED",e.BLUR_STATUS_APPLIED="WORKSHOP.BLURS.BLUR_STATUS_APPLIED",e.BLUR_STATUS_FAILED="WORKSHOP.BLURS.BLUR_STATUS_FAILED",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.BLURS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.BLURS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.APPLY_MODAL_TITLE="WORKSHOP.BLURS.APPLY_MODAL_TITLE",e.APPLY_MODAL_MESSAGE="WORKSHOP.BLURS.APPLY_MODAL_MESSAGE",e.APPLY_MODAL_WARNING="WORKSHOP.BLURS.APPLY_MODAL_WARNING",e.APPLY_MODAL_CONFIRM="WORKSHOP.BLURS.APPLY_MODAL_CONFIRM",e.APPLY_MODAL_RETRY="WORKSHOP.BLURS.APPLY_MODAL_RETRY",e.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE="WORKSHOP.BLURS.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE",e.UNABLE_TO_APPLY_BLURS_ERROR_MESSAGE="WORKSHOP.BLURS.UNABLE_TO_APPLY_BLURS_ERROR_MESSAGE",e.UNAUTHORIZED_ERROR_MESSAGE="WORKSHOP.BLURS.UNAUTHORIZED_ERROR_MESSAGE"}(n=e.BLURS||(e.BLURS={})),function(e){e.HELP_LINK="WORKSHOP.EDIT_BAR.HELP_LINK",e.BETA_TAG="WORKSHOP.EDIT_BAR.BETA_TAG",e.COLLAPSE_LIST_TOOLTIP_MESSAGE="WORKSHOP.EDIT_BAR.COLLAPSE_LIST_TOOLTIP_MESSAGE",e.EXPAND_LIST_TOOLTIP_MESSAGE="WORKSHOP.EDIT_BAR.EXPAND_LIST_TOOLTIP_MESSAGE"}(s=e.EDIT_BAR||(e.EDIT_BAR={})),function(e){e.APPLY_CTA="WORKSHOP.EMBED.APPLY_CTA",e.HELP_CTA="WORKSHOP.EMBED.HELP_CTA",e.ERROR_MESSAGE="WORKSHOP.EMBED.ERROR_MESSAGE",e.LOADING_MESSAGE="WORKSHOP.EMBED.LOADING_MESSAGE",e.INVALID_URL_MESSAGE="WORKSHOP.EMBED.INVALID_URL_MESSAGE",e.SUPPORTED_FORMATS_MESSAGE="WORKSHOP.EMBED.SUPPORTED_FORMATS_MESSAGE",e.MEDIA_LINK_LABEL="WORKSHOP.EMBED.MEDIA_LINK_LABEL",e.PROVIDER_NOT_SUPPORTED_MESSAGE="WORKSHOP.EMBED.PROVIDER_NOT_SUPPORTED_MESSAGE",e.LINK_TYPE_NOT_SUPPORTED_MESSAGE="WORKSHOP.EMBED.LINK_TYPE_NOT_SUPPORTED_MESSAGE"}(r=e.EMBED||(e.EMBED={})),function(e){e.TYPE="WORKSHOP.HLR.TYPE",e.NUM_TYPE="WORKSHOP.HLR.NUM_TYPE",e.ADD_HIGHLIGHT_CTA="WORKSHOP.HLR.ADD_HIGHLIGHT_CTA",e.ADD_HIGHLIGHT_DISABLED_CTA="WORKSHOP.HLR.ADD_HIGHLIGHT_DISABLED_CTA",e.ADD_FROM_PHOTOS_TOOLTIP_MESSAGE="WORKSHOP.HLR.ADD_FROM_PHOTOS_TOOLTIP_MESSAGE",e.SCAN_NOT_HIDDEN_TOOLTIP_TITLE="WORKSHOP.HLR.SCAN_NOT_HIDDEN_TOOLTIP_TITLE",e.SCAN_GENERIC_HIDDEN_TOOLTIP_TITLE="WORKSHOP.HLR.SCAN_GENERIC_HIDDEN_TOOLTIP_TITLE",e.SCAN_NUMBER_HIDDEN_TOOLTIP_TITLE="WORKSHOP.HLR.SCAN_NUMBER_HIDDEN_TOOLTIP_TITLE",e.ADD_HIGHLIGHT_INSTRUCTIONS="WORKSHOP.HLR.ADD_HIGHLIGHT_INSTRUCTIONS",e.DISMISS_TOOLTIP_CTA="WORKSHOP.HLR.DISMISS_TOOLTIP_CTA",e.TOAST_ERROR_MESSAGE="WORKSHOP.HLR.TOAST_ERROR_MESSAGE",e.TOAST_ERROR_CTA="WORKSHOP.HLR.TOAST_ERROR_CTA",e.CLEAR_HLR_MODAL_TITLE="WORKSHOP.HLR.CLEAR_HLR_MODAL_TITLE",e.CLEAR_HLR_MODAL_MESSAGE="WORKSHOP.HLR.CLEAR_HLR_MODAL_MESSAGE",e.DELETE_HIGHLIGHT_TOOLTIP_MESSAGE="WORKSHOP.HLR.DELETE_HIGHLIGHT_TOOLTIP_MESSAGE",e.REMOVE_HIGHLIGHT_TOOLTIP_MESSAGE="WORKSHOP.HLR.REMOVE_HIGHLIGHT_TOOLTIP_MESSAGE",e.EDIT_HIGHLIGHT_TOOLTIP_MESSAGE="WORKSHOP.HLR.EDIT_HIGHLIGHT_TOOLTIP_MESSAGE",e.TRANSITION_SETTING_SLIDESHOW="WORKSHOP.HLR.TRANSITION_SETTING_SLIDESHOW",e.TRANSITION_SETTING_WALKTHROUGH="WORKSHOP.HLR.TRANSITION_SETTING_WALKTHROUGH",e.EDIT_SETTINGS_TOOLTIP_MESSAGE="WORKSHOP.HLR.EDIT_SETTINGS_TOOLTIP_MESSAGE",e.CLEAR_REEL_CTA="WORKSHOP.HLR.CLEAR_REEL_CTA",e.PAN_DIRECTION_SETTING_AUTO="WORKSHOP.HLR.PAN_DIRECTION_SETTING_AUTO",e.PAN_DIRECTION_SETTING_LABEL="WORKSHOP.HLR.PAN_DIRECTION_SETTING_LABEL",e.PAN_DIRECTION_SETTING_LEFT="WORKSHOP.HLR.PAN_DIRECTION_SETTING_LEFT",e.PAN_DIRECTION_SETTING_RIGHT="WORKSHOP.HLR.PAN_DIRECTION_SETTING_RIGHT",e.ROTATION_ANGLE_SETTING_LABEL="WORKSHOP.HLR.ROTATION_ANGLE_SETTING_LABEL",e.ROTATION_SPEED_SETTING_LABEL="WORKSHOP.HLR.ROTATION_SPEED_SETTING_LABEL",e.DOLLHOUSE_ROTATION_SPEED_SETTING_LABEL="WORKSHOP.HLR.DOLLHOUSE_ROTATION_SPEED_SETTING_LABEL",e.SPEED_SETTING_FAST="WORKSHOP.HLR.SPEED_SETTING_FAST",e.SPEED_SETTING_MEDIUM="WORKSHOP.HLR.SPEED_SETTING_MEDIUM",e.SPEED_SETTING_SLOW="WORKSHOP.HLR.SPEED_SETTING_SLOW",e.SLIDESHOW_SPEED_SETTING_LABEL="WORKSHOP.HLR.SLIDESHOW_SPEED_SETTING_LABEL",e.WALKTHROUGH_SPEED_SETTING_LABEL="WORKSHOP.HLR.WALKTHROUGH_SPEED_SETTING_LABEL",e.ZOOM_SPEED_SETTING_LABEL="WORKSHOP.HLR.ZOOM_SPEED_SETTING_LABEL",e.TRANSITION_SETTING_LABEL="WORKSHOP.HLR.TRANSITION_SETTING_LABEL",e.INDIVIDUAL_TRANSITION_SETTING_LABEL="WORKSHOP.HLR.INDIVIDUAL_TRANSITION_SETTING_LABEL",e.INDIVIDUAL_PAN_DIRECTION_SETTING_LABEL="WORKSHOP.HLR.INDIVIDUAL_PAN_DIRECTION_SETTING_LABEL",e.SETTINGS_MODAL_TITLE="WORKSHOP.HLR.SETTINGS_MODAL_TITLE",e.PANNING_SETTINGS_TAB_TITLE="WORKSHOP.HLR.PANNING_SETTINGS_TAB_TITLE",e.TRANSITION_SETTINGS_TAB_TITLE="WORKSHOP.HLR.TRANSITION_SETTINGS_TAB_TITLE",e.CLOSE_SETTINGS_CTA="WORKSHOP.HLR.CLOSE_SETTINGS_CTA",e.PREVIEW_SETTINGS_CTA="WORKSHOP.HLR.PREVIEW_SETTINGS_CTA",e.RESTORE_DEFAULTS_CTA="WORKSHOP.HLR.RESTORE_DEFAULTS_CTA",e.TRANSITION_IS_360_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_IS_360_DISABLED_MESSAGE",e.TRANSITION_AFTER_360_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_AFTER_360_DISABLED_MESSAGE",e.TRANSITION_SAME_SWEEP_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_SAME_SWEEP_DISABLED_MESSAGE",e.TRANSITION_NO_ROTATION_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_NO_ROTATION_DISABLED_MESSAGE",e.TRANSITION_EDITOR_TITLE="WORKSHOP.HLR.TRANSITION_EDITOR_TITLE",e.HIGHLIGHT_CAPTION_HINT="WORKSHOP.HLR.HIGHLIGHT_CAPTION_HINT",e.HIGHLIGHT_CAPTION_PLACEHOLDER="WORKSHOP.HLR.HIGHLIGHT_CAPTION_PLACEHOLDER",e.APPLY_TO_ALL_CTA="WORKSHOP.HLR.APPLY_TO_ALL_CTA"}(o=e.HLR||(e.HLR={})),function(e){e.TYPE="WORKSHOP.LABELS.TYPE",e.NUM_TYPE="WORKSHOP.LABELS.NUM_TYPE",e.EDIT_TEXT_CANCEL_CTA="WORKSHOP.LABELS.EDIT_TEXT_CANCEL_CTA",e.EDIT_TEXT_DONE_CTA="WORKSHOP.LABELS.EDIT_TEXT_DONE_CTA",e.INPUT_PLACEHOLDER="WORKSHOP.LABELS.INPUT_PLACEHOLDER",e.MOBILE_OVERLAY_MESSAGE="WORKSHOP.LABELS.MOBILE_OVERLAY_MESSAGE",e.ADD_LABEL_TOOLTIP_MESSAGE="WORKSHOP.LABELS.ADD_LABEL_TOOLTIP_MESSAGE",e.RENAME_LIST_ITEM_OPTION_CTA="WORKSHOP.LABELS.RENAME_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="WORKSHOP.LABELS.DELETE_LIST_ITEM_OPTION_CTA",e.LIST_ITEM_INPUT_PLACEHOLDER="WORKSHOP.LABELS.LIST_ITEM_INPUT_PLACEHOLDER",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.LABELS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.LABELS.SINGLE_FLOOR_EMPTY_MESSAGE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.LABELS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.LABELS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.EDIT_LABEL="WORKSHOP.LABELS.EDIT_LABEL"}(a=e.LABELS||(e.LABELS={})),function(e){e.KITCHEN="WORKSHOP.LABEL_SUGGESTIONS.KITCHEN",e.PRIMARY_BEDROOM="WORKSHOP.LABEL_SUGGESTIONS.PRIMARY_BEDROOM",e.BEDROOM="WORKSHOP.LABEL_SUGGESTIONS.BEDROOM",e.PRIMARY_BATHROOM="WORKSHOP.LABEL_SUGGESTIONS.PRIMARY_BATHROOM",e.BATHROOM="WORKSHOP.LABEL_SUGGESTIONS.BATHROOM",e.LIVING_ROOM="WORKSHOP.LABEL_SUGGESTIONS.LIVING_ROOM",e.FAMILY_ROOM="WORKSHOP.LABEL_SUGGESTIONS.FAMILY_ROOM",e.DINING_ROOM="WORKSHOP.LABEL_SUGGESTIONS.DINING_ROOM",e.PATIO="WORKSHOP.LABEL_SUGGESTIONS.PATIO",e.BALCONY="WORKSHOP.LABEL_SUGGESTIONS.BALCONY",e.BACKYARD="WORKSHOP.LABEL_SUGGESTIONS.BACKYARD",e.FRONT_YARD="WORKSHOP.LABEL_SUGGESTIONS.FRONT_YARD",e.HALLWAY="WORKSHOP.LABEL_SUGGESTIONS.HALLWAY",e.LAUNDRY="WORKSHOP.LABEL_SUGGESTIONS.LAUNDRY",e.PANTRY="WORKSHOP.LABEL_SUGGESTIONS.PANTRY",e.CLOSET="WORKSHOP.LABEL_SUGGESTIONS.CLOSET",e.GARAGE="WORKSHOP.LABEL_SUGGESTIONS.GARAGE",e.DRIVEWAY="WORKSHOP.LABEL_SUGGESTIONS.DRIVEWAY",e.BASEMENT="WORKSHOP.LABEL_SUGGESTIONS.BASEMENT",e.FACADE="WORKSHOP.LABEL_SUGGESTIONS.FACADE",e.GARDEN="WORKSHOP.LABEL_SUGGESTIONS.GARDEN",e.LOBBY="WORKSHOP.LABEL_SUGGESTIONS.LOBBY",e.OFFICE="WORKSHOP.LABEL_SUGGESTIONS.OFFICE",e.POOL="WORKSHOP.LABEL_SUGGESTIONS.POOL",e.UNFURNISHED="WORKSHOP.LABEL_SUGGESTIONS.UNFURNISHED",e.STAIRWAY="WORKSHOP.LABEL_SUGGESTIONS.STAIRWAY",e.ELEVATOR="WORKSHOP.LABEL_SUGGESTIONS.ELEVATOR",e.ESCALATOR="WORKSHOP.LABEL_SUGGESTIONS.ESCALATOR",e.STUDY="WORKSHOP.LABEL_SUGGESTIONS.STUDY",e.SPA="WORKSHOP.LABEL_SUGGESTIONS.SPA",e.RECEPTION="WORKSHOP.LABEL_SUGGESTIONS.RECEPTION",e.MEETING_ROOM="WORKSHOP.LABEL_SUGGESTIONS.MEETING_ROOM",e.STORAGE="WORKSHOP.LABEL_SUGGESTIONS.STORAGE",e.BREAK_ROOM="WORKSHOP.LABEL_SUGGESTIONS.BREAK_ROOM",e.LUNCH_ROOM="WORKSHOP.LABEL_SUGGESTIONS.LUNCH_ROOM",e.CONFERENCE_ROOM="WORKSHOP.LABEL_SUGGESTIONS.CONFERENCE_ROOM"}(l=e.LABEL_SUGGESTIONS||(e.LABEL_SUGGESTIONS={})),function(e){e.TYPE="WORKSHOP.MATTERTAGS.TYPE",e.NUM_TYPE="WORKSHOP.MATTERTAGS.NUM_TYPE",e.EDIT_BILLBOARD_CANCEL_CTA="WORKSHOP.MATTERTAGS.EDIT_BILLBOARD_CANCEL_CTA",e.EDIT_BILLBOARD_DONE_CTA="WORKSHOP.MATTERTAGS.EDIT_BILLBOARD_DONE_CTA",e.LINK_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.LINK_TOOLTIP_MESSAGE",e.LINK_DISABLED_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.LINK_DISABLED_TOOLTIP_MESSAGE",e.LINK_EDITOR_APPLY_CTA="WORKSHOP.MATTERTAGS.LINK_EDITOR_APPLY_CTA",e.LINK_EDITOR_INVALID_TIP="WORKSHOP.MATTERTAGS.LINK_EDITOR_INVALID_TIP",e.LINK_EDITOR_PREVIEW_TIP="WORKSHOP.MATTERTAGS.LINK_EDITOR_PREVIEW_TIP",e.LINK_EDITOR_REMOVE_TIP="WORKSHOP.MATTERTAGS.LINK_EDITOR_REMOVE_TIP",e.LINK_EDITOR_TEXT_LABEL="WORKSHOP.MATTERTAGS.LINK_EDITOR_TEXT_LABEL",e.LINK_EDITOR_TIP_TEXT="WORKSHOP.MATTERTAGS.LINK_EDITOR_TIP_TEXT",e.LINK_EDITOR_URL_LABEL="WORKSHOP.MATTERTAGS.LINK_EDITOR_URL_LABEL",e.COLOR_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.COLOR_TOOLTIP_MESSAGE",e.STEM_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.STEM_TOOLTIP_MESSAGE",e.MEDIA_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_TOOLTIP_MESSAGE",e.HIDE_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.HIDE_TOOLTIP_MESSAGE",e.SHOW_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.SHOW_TOOLTIP_MESSAGE",e.TITLE_PLACEHOLDER="WORKSHOP.MATTERTAGS.TITLE_PLACEHOLDER",e.DESCRIPTION_PLACEHOLDER="WORKSHOP.MATTERTAGS.DESCRIPTION_PLACEHOLDER",e.STEM_SLIDER_RESET_CTA="WORKSHOP.MATTERTAGS.STEM_SLIDER_RESET_CTA",e.SHOW_STEM_LABEL="WORKSHOP.MATTERTAGS.SHOW_STEM_LABEL",e.MEDIA_LINK_LABEL="WORKSHOP.MATTERTAGS.MEDIA_LINK_LABEL",e.MEDIA_LINK_SUPPORTED_FORMATS_LINK="WORKSHOP.MATTERTAGS.MEDIA_LINK_SUPPORTED_FORMATS_LINK",e.MEDIA_LINK_APPLY_CTA="WORKSHOP.MATTERTAGS.MEDIA_LINK_APPLY_CTA",e.MEDIA_LINK_ERROR_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_LINK_ERROR_MESSAGE",e.MEDIA_LINK_HELP_LINK="WORKSHOP.MATTERTAGS.MEDIA_LINK_HELP_LINK",e.MEDIA_LINK_LOADING_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_LINK_LOADING_MESSAGE",e.MEDIA_LINK_INVALID_URL_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_LINK_INVALID_URL_MESSAGE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.DEFAULT_LIST_ITEM_TEXT="WORKSHOP.MATTERTAGS.DEFAULT_LIST_ITEM_TEXT",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.MATTERTAGS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.MATTERTAGS.SINGLE_FLOOR_EMPTY_MESSAGE",e.EDIT_LIST_ITEM_OPTION_CTA="WORKSHOP.MATTERTAGS.EDIT_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="WORKSHOP.MATTERTAGS.DELETE_LIST_ITEM_OPTION_CTA",e.ADD_MATTERTAG_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.ADD_MATTERTAG_TOOLTIP_MESSAGE",e.MOBILE_OVERLAY_MESSAGE="WORKSHOP.MATTERTAGS.MOBILE_OVERLAY_MESSAGE",e.DELETE_MATTERTAGS_MODAL_TITLE="WORKSHOP.MATTERTAGS.DELETE_MATTERTAGS_MODAL_TITLE",e.DELETE_MATTERTAGS_MODAL_MESSAGE="WORKSHOP.MATTERTAGS.DELETE_MATTERTAGS_MODAL_MESSAGE",e.DISCARD_MATTERTAG_MODAL_TITLE="WORKSHOP.MATTERTAGS.DISCARD_MATTERTAG_MODAL_TITLE",e.DISCARD_MATTERTAG_MODAL_MESSAGE="WORKSHOP.MATTERTAGS.DISCARD_MATTERTAG_MODAL_MESSAGE"}(c=e.MATTERTAGS||(e.MATTERTAGS={})),function(e){e.TYPE="WORKSHOP.MEASUREMENTS.TYPE",e.NUM_TYPE="WORKSHOP.MEASUREMENTS.NUM_TYPE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MEASUREMENTS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MEASUREMENTS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.OTHER_GROUP_LABEL="WORKSHOP.MEASUREMENTS.OTHER_GROUP_LABEL",e.RENAME_LIST_ITEM_OPTION_CTA="WORKSHOP.MEASUREMENTS.RENAME_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="WORKSHOP.MEASUREMENTS.DELETE_LIST_ITEM_OPTION_CTA",e.LIST_ITEM_INPUT_PLACEHOLDER="WORKSHOP.MEASUREMENTS.LIST_ITEM_INPUT_PLACEHOLDER",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.MEASUREMENTS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.MEASUREMENTS.SINGLE_FLOOR_EMPTY_MESSAGE"}(h=e.MEASUREMENTS||(e.MEASUREMENTS={})),function(e){e.ERROR_TITLE="WORKSHOP.MODAL.ERROR_TITLE",e.SAVING_ERROR_TITLE="WORKSHOP.MODAL.SAVING_ERROR_TITLE",e.SAVING_ERROR_MESSAGE="WORKSHOP.MODAL.SAVING_ERROR_MESSAGE",e.NO="WORKSHOP.MODAL.NO",e.YES="WORKSHOP.MODAL.YES",e.CANCEL="WORKSHOP.MODAL.CANCEL",e.OK="WORKSHOP.MODAL.OK",e.DISCARD="WORKSHOP.MODAL.DISCARD",e.SAVE="WORKSHOP.MODAL.SAVE"}(d=e.MODAL||(e.MODAL={})),function(e){e.HAPPINESS_TITLE="WORKSHOP.MODEL_RATING.HAPPINESS_TITLE",e.HAPPINESS_BODY="WORKSHOP.MODEL_RATING.HAPPINESS_BODY",e.QUALITY_ISSUES_TITLE="WORKSHOP.MODEL_RATING.QUALITY_ISSUES_TITLE",e.QUALITY_ISSUES_LIGHTING="WORKSHOP.MODEL_RATING.QUALITY_ISSUES_LIGHTING",e.QUALITY_ISSUES_3D_MESH="WORKSHOP.MODEL_RATING.QUALITY_ISSUES_3D_MESH",e.QUALITY_ISSUES_COLORING="WORKSHOP.MODEL_RATING.QUALITY_ISSUES_COLORING",e.QUALITY_ISSUES_IMAGE_QUALITY="WORKSHOP.MODEL_RATING.QUALITY_ISSUES_IMAGE_QUALITY",e.NAVIGATION_ISSUES_TITLE="WORKSHOP.MODEL_RATING.NAVIGATION_ISSUES_TITLE",e.NAVIGATION_ISSUES_BLOCKED_DOORWAYS="WORKSHOP.MODEL_RATING.NAVIGATION_ISSUES_BLOCKED_DOORWAYS",e.NAVIGATION_ISSUES_OBSTRUCTIONS="WORKSHOP.MODEL_RATING.NAVIGATION_ISSUES_OBSTRUCTIONS",e.NAVIGATION_ISSUES_MISALIGNED_SCANS="WORKSHOP.MODEL_RATING.NAVIGATION_ISSUES_MISALIGNED_SCANS",e.NAVIGATION_ISSUES_FLOOR_SEPARATION="WORKSHOP.MODEL_RATING.NAVIGATION_ISSUES_FLOOR_SEPARATION",e.NAVIGATION_ISSUES_DISAPPEARING_FLOORS="WORKSHOP.MODEL_RATING.NAVIGATION_ISSUES_DISAPPEARING_FLOORS",e.FEEDBACK_TITLE="WORKSHOP.MODEL_RATING.FEEDBACK_TITLE",e.FEEDBACK_LABEL="WORKSHOP.MODEL_RATING.FEEDBACK_LABEL",e.THANK_YOU_HEADING="WORKSHOP.MODEL_RATING.THANK_YOU_HEADING",e.THANK_YOU_BODY="WORKSHOP.MODEL_RATING.THANK_YOU_BODY",e.THANK_YOU_CTA="WORKSHOP.MODEL_RATING.THANK_YOU_CTA",e.THANK_YOU_CTA_LINK_TEXT="WORKSHOP.MODEL_RATING.THANK_YOU_CTA_LINK_TEXT",e.SAVE="WORKSHOP.MODEL_RATING.SAVE",e.NEXT="WORKSHOP.MODEL_RATING.NEXT",e.PROGRESS="WORKSHOP.MODEL_RATING.PROGRESS"}(u=e.MODEL_RATING||(e.MODEL_RATING={})),function(e){e.TYPE="WORKSHOP.PHOTOS.TYPE",e.NUM_TYPE="WORKSHOP.PHOTOS.NUM_TYPE",e.ADD_PHOTOS_CTA="WORKSHOP.PHOTOS.ADD_PHOTOS_CTA",e.ADDING_PHOTOS_CTA="WORKSHOP.PHOTOS.ADDING_PHOTOS_CTA",e.MODAL_TITLE="WORKSHOP.PHOTOS.MODAL_TITLE",e.NUM_SELECTED="WORKSHOP.PHOTOS.NUM_SELECTED",e.SELECT_ALL_CTA="WORKSHOP.PHOTOS.SELECT_ALL_CTA",e.UNSELECT_ALL_CTA="WORKSHOP.PHOTOS.UNSELECT_ALL_CTA",e.SAVING_TOAST_MESSAGE="WORKSHOP.PHOTOS.SAVING_TOAST_MESSAGE",e.SAVED_TOAST_MESSAGE="WORKSHOP.PHOTOS.SAVED_TOAST_MESSAGE",e.SAVED_TOAST_CTA="WORKSHOP.PHOTOS.SAVED_TOAST_CTA",e.ERROR_MODAL_TITLE="WORKSHOP.PHOTOS.ERROR_MODAL_TITLE",e.ERROR_MODAL_MESSAGE="WORKSHOP.PHOTOS.ERROR_MODAL_MESSAGE",e.CAMERA_PITCH_RESET_MESSAGE="WORKSHOP.PHOTOS.CAMERA_PITCH_RESET_MESSAGE",e.ZOOM_RESET_MESSAGE="WORKSHOP.PHOTOS.ZOOM_RESET_MESSAGE",e.ZOOM_IN_MESSAGE="WORKSHOP.PHOTOS.ZOOM_IN_MESSAGE",e.ZOOM_OUT_MESSAGE="WORKSHOP.PHOTOS.ZOOM_OUT_MESSAGE",e.CANNOT_SAVE_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CANNOT_SAVE_TOOLTIP_MESSAGE",e.CANNOT_SAVE_SCAN_NUMBER_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CANNOT_SAVE_SCAN_NUMBER_TOOLTIP_MESSAGE",e.CANNOT_SAVE_TOOLTIP_TITLE="WORKSHOP.PHOTOS.CANNOT_SAVE_TOOLTIP_TITLE",e.CANNOT_SAVE_TOOLTIP_CTA="WORKSHOP.PHOTOS.CANNOT_SAVE_TOOLTIP_CTA",e.CAN_TAKE_2D_PHOTO_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CAN_TAKE_2D_PHOTO_TOOLTIP_MESSAGE",e.CAN_TAKE_360_PHOTO_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CAN_TAKE_360_PHOTO_TOOLTIP_MESSAGE",e.CANNOT_TAKE_360_PHOTO_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CANNOT_TAKE_360_PHOTO_TOOLTIP_MESSAGE",e.PANO_CTA="WORKSHOP.PHOTOS.PANO_CTA",e.SETTINGS_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.SETTINGS_TOOLTIP_MESSAGE",e.ASSETS_SETTING_LABEL="WORKSHOP.PHOTOS.ASSETS_SETTING_LABEL",e.SHOW_GRID_SETTING_LABEL="WORKSHOP.PHOTOS.SHOW_GRID_SETTING_LABEL",e.SNAPSHOT_ERROR_TOAST_MESSAGE="WORKSHOP.PHOTOS.SNAPSHOT_ERROR_TOAST_MESSAGE",e.SNAPSHOT_ERROR_TOAST_CTA="WORKSHOP.PHOTOS.SNAPSHOT_ERROR_TOAST_CTA"}(p=e.PHOTOS||(e.PHOTOS={})),function(e){e.TYPE="WORKSHOP.SCANS.TYPE",e.NUM_TYPE="WORKSHOP.SCANS.NUM_TYPE",e.BATCH_SHOW_CTA="WORKSHOP.SCANS.BATCH_SHOW_CTA",e.BATCH_HIDE_CTA="WORKSHOP.SCANS.BATCH_HIDE_CTA",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.LIST_ITEM_TEXT="WORKSHOP.SCANS.LIST_ITEM_TEXT",e.FLOOR_EMPTY_MESSAGE="WORKSHOP.SCANS.FLOOR_EMPTY_MESSAGE",e.NO_HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.NO_HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.HLR_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.HLR_LIST_ITEM_TOOLTIP_MESSAGE",e.START_LOCATION_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.START_LOCATION_LIST_ITEM_TOOLTIP_MESSAGE",e.OVERLAY_HIDE_CTA="WORKSHOP.SCANS.OVERLAY_HIDE_CTA",e.OVERLAY_SHOW_CTA="WORKSHOP.SCANS.OVERLAY_SHOW_CTA",e.OVERLAY_HIDE_SCAN_CTA="WORKSHOP.SCANS.OVERLAY_HIDE_SCAN_CTA",e.OVERLAY_SHOW_SCAN_CTA="WORKSHOP.SCANS.OVERLAY_SHOW_SCAN_CTA",e.OVERLAY_PANORAMA_INFO="WORKSHOP.SCANS.OVERLAY_PANORAMA_INFO",e.OVERLAY_INFO="WORKSHOP.SCANS.OVERLAY_INFO",e.START_LOCATION_TOOLTIP_TITLE="WORKSHOP.SCANS.START_LOCATION_TOOLTIP_TITLE",e.START_LOCATION_TOOLTIP_MESSAGE="WORKSHOP.SCANS.START_LOCATION_TOOLTIP_MESSAGE",e.START_LOCATION_TOOLTIP_CTA="WORKSHOP.SCANS.START_LOCATION_TOOLTIP_CTA",e.REMOVE_HLR_MODAL_TITLE="WORKSHOP.SCANS.REMOVE_HLR_MODAL_TITLE",e.REMOVE_HLR_MODAL_MESSAGE="WORKSHOP.SCANS.REMOVE_HLR_MODAL_MESSAGE",e.REMOVE_HLR_MODAL_BATCH_MESSAGE="WORKSHOP.SCANS.REMOVE_HLR_MODAL_BATCH_MESSAGE",e.REMOVE_HLR_MODAL_WARNING="WORKSHOP.SCANS.REMOVE_HLR_MODAL_WARNING",e.REMOVE_SCANS_FROM_HLR_MODAL_TITLE="WORKSHOP.SCANS.REMOVE_SCANS_FROM_HLR_MODAL_TITLE",e.REMOVE_SCAN_FROM_HLR_MODAL_MESSAGE="WORKSHOP.SCANS.REMOVE_SCAN_FROM_HLR_MODAL_MESSAGE",e.REMOVE_BATCH_FROM_HLR_MODAL_SCANS_MESSAGE="WORKSHOP.SCANS.REMOVE_BATCH_FROM_HLR_MODAL_SCANS_MESSAGE",e.REMOVE_BATCH_FROM_HLR_MODAL_HIGHLIGHTS_MESSAGE="WORKSHOP.SCANS.REMOVE_BATCH_FROM_HLR_MODAL_HIGHLIGHTS_MESSAGE"}(m=e.SCANS||(e.SCANS={})),function(e){e.NAV_OPTION_PRESENTATION="WORKSHOP.SETTINGS.NAV_OPTION_PRESENTATION",e.NAV_OPTION_TOUR_HLR="WORKSHOP.SETTINGS.NAV_OPTION_TOUR_HLR",e.NAV_OPTION_UNITS="WORKSHOP.SETTINGS.NAV_OPTION_UNITS",e.NAV_OPTION_ADVANCED="WORKSHOP.SETTINGS.NAV_OPTION_ADVANCED",e.SHOW_LABELS_IN_DOLLHOUSE_OPTION="WORKSHOP.SETTINGS.SHOW_LABELS_IN_DOLLHOUSE_OPTION",e.HIDE_LABELS_IN_DOLLHOUSE_OPTION="WORKSHOP.SETTINGS.HIDE_LABELS_IN_DOLLHOUSE_OPTION",e.SHOW_SAVED_MEASUREMENTS_OPTION="WORKSHOP.SETTINGS.SHOW_SAVED_MEASUREMENTS_OPTION",e.HIDE_SAVED_MEASUREMENTS_OPTION="WORKSHOP.SETTINGS.HIDE_SAVED_MEASUREMENTS_OPTION",e.UNITS_HEADER="WORKSHOP.SETTINGS.UNITS_HEADER",e.UNITS_SUBHEADER="WORKSHOP.SETTINGS.UNITS_SUBHEADER",e.UNITS_IMPERIAL_CTA="WORKSHOP.SETTINGS.UNITS_IMPERIAL_CTA",e.UNITS_METRIC_CTA="WORKSHOP.SETTINGS.UNITS_METRIC_CTA",e.TOUR_AND_HLR_HEADER="WORKSHOP.SETTINGS.TOUR_AND_HLR_HEADER",e.TOUR_OPTION_LABEL="WORKSHOP.SETTINGS.TOUR_OPTION_LABEL",e.TOUR_OPTION_MESSAGE="WORKSHOP.SETTINGS.TOUR_OPTION_MESSAGE",e.HLR_OPTION_LABEL="WORKSHOP.SETTINGS.HLR_OPTION_LABEL",e.HLR_OPTION_MESSAGE="WORKSHOP.SETTINGS.HLR_OPTION_MESSAGE",e.ADVANCED_HEADER="WORKSHOP.SETTINGS.ADVANCED_HEADER",e.ADVANCED_DOLLHOUSE_LABEL="WORKSHOP.SETTINGS.ADVANCED_DOLLHOUSE_LABEL",e.ADVANCED_DOLLHOUSE_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_DOLLHOUSE_MESSAGE",e.ADVANCED_FLOORPLAN_LABEL="WORKSHOP.SETTINGS.ADVANCED_FLOORPLAN_LABEL",e.ADVANCED_FLOORPLAN_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_FLOORPLAN_MESSAGE",e.ADVANCED_ROOM_LABELS_LABEL="WORKSHOP.SETTINGS.ADVANCED_ROOM_LABELS_LABEL",e.ADVANCED_ROOM_LABELS_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_ROOM_LABELS_MESSAGE",e.ADVANCED_FLOOR_SELECTION_LABEL="WORKSHOP.SETTINGS.ADVANCED_FLOOR_SELECTION_LABEL",e.ADVANCED_FLOOR_SELECTION_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_FLOOR_SELECTION_MESSAGE",e.ADVANCED_MEASUREMENT_MODE_LABEL="WORKSHOP.SETTINGS.ADVANCED_MEASUREMENT_MODE_LABEL",e.ADVANCED_MEASUREMENT_MODE_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_MEASUREMENT_MODE_MESSAGE",e.ADVANCED_ROOM_LABELS_MENU_LABEL="WORKSHOP.SETTINGS.ADVANCED_ROOM_LABELS_MENU_LABEL",e.ADVANCED_MEASUREMENT_MODE_MENU_LABEL="WORKSHOP.SETTINGS.ADVANCED_MEASUREMENT_MODE_MENU_LABEL",e.PRESENTATION_HEADER="WORKSHOP.SETTINGS.PRESENTATION_HEADER",e.PRESENTATION_INFORMATION_HEADER="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_HEADER",e.PRESENTATION_INFORMATION_EVERYTHING_LABEL="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_EVERYTHING_LABEL",e.PRESENTATION_INFORMATION_EVERYTHING_MESSAGE="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_EVERYTHING_MESSAGE",e.PRESENTATION_INFORMATION_COMPACT_LABEL="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_COMPACT_LABEL",e.PRESENTATION_INFORMATION_COMPACT_MESSAGE="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_COMPACT_MESSAGE",e.PRESENTATION_INFORMATION_NONE_LABEL="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_NONE_LABEL",e.PRESENTATION_BACKGROUND_HEADER="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_HEADER",e.PRESENTATION_BACKGROUND_SUBHEADER="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_SUBHEADER",e.PRESENTATION_BACKGROUND_BLACK_LABEL="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_BLACK_LABEL",e.PRESENTATION_BACKGROUND_GREY_LABEL="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_GREY_LABEL",e.PRESENTATION_BACKGROUND_WHITE_LABEL="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_WHITE_LABEL"}(g=e.SETTINGS||(e.SETTINGS={})),function(e){e.ENABLED_TOOLTIP_TITLE="WORKSHOP.START_LOCATION.ENABLED_TOOLTIP_TITLE",e.DISABLED_TOOLTIP_TITLE="WORKSHOP.START_LOCATION.DISABLED_TOOLTIP_TITLE",e.HIDDEN_SWEEP_MESSAGE="WORKSHOP.START_LOCATION.HIDDEN_SWEEP_MESSAGE",e.UNPLACED_360_MESSAGE="WORKSHOP.START_LOCATION.UNPLACED_360_MESSAGE",e.ENABLED_MESSAGE="WORKSHOP.START_LOCATION.ENABLED_MESSAGE",e.TOOLTIP_CTA="WORKSHOP.START_LOCATION.TOOLTIP_CTA",e.SET_NEW_LOCATION_CTA="WORKSHOP.START_LOCATION.SET_NEW_LOCATION_CTA",e.SETTING_NEW_LOCATION_CTA="WORKSHOP.START_LOCATION.SETTING_NEW_LOCATION_CTA",e.THUMBNAIL_PREVIEW_CTA="WORKSHOP.START_LOCATION.THUMBNAIL_PREVIEW_CTA"}(f=e.START_LOCATION||(e.START_LOCATION={})),function(e){e.NUM_TYPE="WORKSHOP.VIEWS_360.NUM_TYPE",e.START_LOCATION_REMOVAL_MESSAGE="WORKSHOP.VIEWS_360.START_LOCATION_REMOVAL_MESSAGE",e.START_LOCATION_MARKER_MESSAGE="WORKSHOP.VIEWS_360.START_LOCATION_MARKER_MESSAGE",e.DEFAULT_NAME="WORKSHOP.VIEWS_360.DEFAULT_NAME",e.OVERLAY_MESSAGE="WORKSHOP.VIEWS_360.OVERLAY_MESSAGE",e.OVERLAY_INFO_MISSING_SWEEP="WORKSHOP.VIEWS_360.OVERLAY_INFO_MISSING_SWEEP",e.OVERLAY_INFO_CURRENT_SWEEP="WORKSHOP.VIEWS_360.OVERLAY_INFO_CURRENT_SWEEP",e.OVERLAY_INFO_SELECTED_SWEEP="WORKSHOP.VIEWS_360.OVERLAY_INFO_SELECTED_SWEEP",e.ROTATE_TOOLTIP_TITLE="WORKSHOP.VIEWS_360.ROTATE_TOOLTIP_TITLE",e.ROTATE_TOOLTIP_MESSAGE="WORKSHOP.VIEWS_360.ROTATE_TOOLTIP_MESSAGE",e.ROTATE_TOOLTIP_CTA="WORKSHOP.VIEWS_360.ROTATE_TOOLTIP_CTA",e.UNPLACED_CARD_MESSAGE="WORKSHOP.VIEWS_360.UNPLACED_CARD_MESSAGE",e.RENAME_ITEM_OPTION_CTA="WORKSHOP.VIEWS_360.RENAME_ITEM_OPTION_CTA",e.REMOVE_ITEM_OPTION_CTA="WORKSHOP.VIEWS_360.REMOVE_ITEM_OPTION_CTA",e.NO_VIEWS_MESSAGE="WORKSHOP.VIEWS_360.NO_VIEWS_MESSAGE"}(v=e.VIEWS_360||(e.VIEWS_360={})),function(e){e.TOAST_MESSAGE="WORKSHOP.VR.TOAST_MESSAGE",e.TOAST_CTA="WORKSHOP.VR.TOAST_CTA"}(y=e.VR||(e.VR={}))}(r=e.WORKSHOP||(e.WORKSHOP={}))}(n||(n={}));const s=n},51058:(e,t,i)=>{"use strict";var n;function s(e){return e.match(/us|mm|lr$/i)?n.IMPERIAL:n.METRIC}i.d(t,{M:()=>n,z:()=>s}),function(e){e.IMPERIAL="imperial",e.METRIC="metric"}(n||(n={}))},7677:(e,t,i)=>{"use strict";i.d(t,{i:()=>s,y:()=>r});var n=i(3184);function s(e){if(!e)return n.k$;if(r(e))return e;const t=e.toLocaleLowerCase();if(t in n.Xy)return n.Xy[t];const[i]=t.split("-");return i in n.Xy?n.Xy[i]:(n.E7.find((e=>e.startsWith(t))),n.k$)}function r(e){return n.E7.includes(e)}},41452:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>LocaleModule});var n=i(47724),s=i(88512),r=i(54078),o=i(3184);async function a(e,t){const i=function(e){return e===o.k$?"./locale/strings.json":`./locale/messages/strings_${e}.json`}(e),n=await t.get(i);return JSON.parse(n)}var l=i(24930),c=i(60771),h=i(98828),d=i(7677);const u=new s.Z("Locale");class LocaleModule extends n.Y{constructor(){super(...arguments),this.name="locale"}async init(e,t){this._languageCode=function(){const e=(0,h.h)("lang",(0,c.ht)());return(0,d.i)(e)}();const i=this._languageCode.substr(0,2);this.polyglot=new r({locale:i,interpolation:{prefix:"%{",suffix:"}"},onMissingKey:e=>(u.warn("Missing phrase key:"+e),LocaleModule.missingPrefix+e)});const n=await async function(e,t){const i=await a(e,t);if(e===o.k$)return i;const n=await a(o.k$,t);return Object.assign(Object.assign({},n),i)}(this._languageCode,e.queue);this.polyglot.extend(n),this.registerSettings(t)}t(e,t){return this.polyglot.t(e,t)}get languageCode(){return this._languageCode}async registerSettings(e){(await e.getModule(l.default)).registerSetting("Locale",o.Zs,this.languageCode,!1)}}LocaleModule.missingPrefix="FIX-"},3184:(e,t,i)=>{"use strict";i.d(t,{E7:()=>n,k$:()=>s,Xy:()=>r,Zs:()=>o});const n=["en-US","es","fr","de","ru","ja","zh-CN","zh-TW","ko","nl","it","pt"],s="en-US",r=Object.assign(Object.assign({},n.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.toLowerCase()]:t})),{})),{en:"en-US",zh:"zh-CN",cn:"zh-CN",jp:"ja"}),o="language_code"},2640:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>LoginRedirect});var n=i(26605),s=i(47724),r=i(41452),o=i(64185),a=i(94184),l=i(92759),c=i(47210);class LoginRedirectUi extends n.Component{constructor(e){super(e),this.signup=()=>{window.top.location.href=this.props.registerUrl}}render(){const{loginUrl:e,backgroundUrl:t}=this.props,i=t||l;return(0,n.h)("div",{class:"login-redirect-screen",style:`background-image: url(${i})`},(0,n.h)("div",{class:a("login-redirect",{skrim:!!t})},(0,n.h)("div",{class:"login-redirect-body"},(0,n.h)("h1",{class:"login-redirect-title"},"You have been invited to this space, create an account to join the conversation."),(0,n.h)("div",{class:"login-redirect-create"},(0,n.h)(c.zx,{buttonSize:c.qE.LARGE,buttonStyle:c.ZJ.LIGHT,onClick:this.signup},"Create an Account")),(0,n.h)("div",{class:"login-redirect-link"},"Already have an account?",(0,n.h)("a",{class:"link",href:e},"Sign in")))))}}class LoginRedirect extends s.Y{constructor(){super(...arguments),this.name="login-redirect",this.authenticated=!1}async init(e,t){this.config=e,this.engine=t}async loadUi(){const{container:e,loginUrl:t,registerUrl:i}=this.config,s=await this.engine.getModule(r.default),a=encodeURIComponent(window.top.location.href),l=(0,n.h)(LoginRedirectUi,{locale:s,backgroundUrl:this.getBackground(),loginUrl:`${t}?target=${a}`,registerUrl:`${i}?target=${a}`});return this.ref=(0,n.render)(l,e),new o.Q}async unloadUi(){const{container:e}=this.config;if(this.ref&&e)return(0,n.render)(null,e,this.ref)}getBackground(){const{baseUrl:e,modelId:t}=this.config;if(!t||!e)return;const i=window.devicePixelRatio||1;return`${e}/api/v1/player/models/${t}/thumb?width=${Math.max(window.innerWidth,400)}&dpr=${i}&disable=upscale`}}},90756:(e,t,i)=>{"use strict";var n;i.d(t,{U:()=>n}),function(e){e[e.NAVIGATION=0]="NAVIGATION",e[e.MODEL=1]="MODEL",e[e.EXT_LINK=2]="EXT_LINK"}(n||(n={}));n.NAVIGATION,n.MODEL,n.EXT_LINK},34986:(e,t,i)=>{"use strict";var n;i.d(t,{z:()=>n}),function(e){e.text="text",e.link="link",e.photo="photo",e.video="video",e.rich="rich",e.none="none",e.error="error"}(n||(n={})),function(e){e.parse=t=>null!==t&&t in e?e[t]:e.none}(n||(n={}))},51153:(e,t,i)=>{"use strict";i.d(t,{V:()=>n,s:()=>MattertagDataAnalytics});var n,s=i(40698),r=i(58626),o=i(46610),a=i(34986);!function(e){e.OVERLAY="overlay",e.HOVER="hover",e.OPEN="open"}(n||(n={}));class MattertagDataAnalytics{constructor(){this.handlers=[{msgType:o.QY,func:(e,t,i)=>{const n=i.tryGetData(s.n),o=i.tryGetData(r.P5);if(!n||!o)return;const l=n.getTagCount(),c=o.getVisitedTags().length,h=o.getViewedTagCount(),d=n.getTag(t.sid);d&&e.track("tag_opened",{tag_count:l,tag_id:t.sid,tags_visited:c,tag_view_count:h,has_media:d.mediaType!==a.z.none})}},{msgType:o.dJ,func:(e,t,i)=>{const n=i.tryGetData(s.n),o=i.tryGetData(r.P5);if(!n||!o)return;const a=n.getTagCount(),l=o.getVisitedTags().length,c=o.getViewedTagCount(),h=n.getTag(t.sid);if(h){const i={mattertag_sid:t.sid,mattertag_view:t.view,mattertag_media:h.mediaType,mattertags_count:a,mattertags_total_views:c,mattertags_visited:l};e.track("mattertag_view",i)}}}]}}},41663:(e,t,i)=>{"use strict";i.d(t,{cH:()=>GetDiscPositionsCommand,Fz:()=>AddMattertagCommand,Gn:()=>RemoveMattertagCommand,Ek:()=>EditMattertagCommand});var n=i(17386);class GetDiscPositionsCommand extends n.m{constructor(e){super(),this.id="MATTERTAG_DISC_POSITIONS",this.payload={tags:e}}}class AddMattertagCommand extends n.m{constructor(e,t,i){super(),this.id="ADD_MATTERTAG",this.payload=Object.assign(Object.assign(Object.assign({},e),t),i)}}class RemoveMattertagCommand extends n.m{constructor(e){super(),this.id="DELETE_MATTERTAG",this.payload={sid:e}}}class EditMattertagCommand extends n.m{constructor(e,t,i,n){super(),this.payload={sid:e,options:Object.assign(Object.assign(Object.assign({},t),i),n)}}}},40698:(e,t,i)=>{"use strict";i.d(t,{n:()=>MattertagsData});var n=i(32770),s=i(64781);class MattertagsData extends n.V{constructor(e){if(super(),this.name="tag",this.mattertags=(0,s.q)(),e)for(const t of e)this.mattertags.set(t.sid,t);this.commit()}clear(){for(const e of this.mattertags)this.removeTag(e.sid)}clone(){return(new MattertagsData).copy(this)}copy(e){return MattertagsData.copyTagCollection(this,e),this}static copyTagCollection(e,t){const i=e.mattertags,n=t.mattertags;for(const t of i.keys)n.has(t)||e.removeTag(t);for(const t of n)e.addTag(t)}get collection(){return this.mattertags}addTag(e){this.mattertags.has(e.sid)?this.mattertags.get(e.sid).copy(e):this.mattertags.set(e.sid,e.clone())}removeTag(e){return this.mattertags.delete(e)}getTag(e){return this.mattertags.get(e)}getTagList(){return this.mattertags.keys}getTagCount(){return this.mattertags.length}iterate(e){for(const t of this.mattertags)e(t)}*[Symbol.iterator](){for(const e of this.mattertags)yield e}}},86122:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>MattertagDataModule});var n=i(47724),s=i(2212),r=i(87068),o=i(34986),a=i(48711),l=i(23573);class Mattertag extends l.T{constructor(){super(...arguments),this.sid="",this.created=new Date,this.modified=new Date,this.enabled=!0,this.label="",this.description="",this.parsedDescription=[],this.anchorPosition=new s.Vector3,this.anchorNormal=new s.Vector3(0,1,0),this.stemVector=new s.Vector3(0,0,(0,a._F)(1)),this.stemHeight=(0,a._F)(1),this.stemVisible=!0,this.color=r.I.MATTERTAG_BLUE.clone(),this.mediaType=o.z.none,this.mediaSrc="",this.widgetFrame=null}copy(e){this.anchorNormal.copy(e.anchorNormal),this.anchorPosition.copy(e.anchorPosition),this.color.copy(e.color),this.created.setTime(e.created.getTime()),this.description=e.description,this.enabled=e.enabled,this.floorId=e.floorId,this.roomId=e.roomId,this.label=e.label,this.mediaType=e.mediaType,this.mediaSrc=e.mediaSrc,this.modified.setTime(e.modified.getTime()),this.sid=e.sid,this.stemVector.copy(e.stemVector),this.stemHeight=e.stemHeight,this.stemVisible=e.stemVisible,this.parsedDescription=[];for(const t of e.parsedDescription)this.parsedDescription.push({link:t.link&&{label:t.link.label.slice(),url:t.link.url.slice(),type:t.link.type,navigationData:t.link.navigationData&&{floorVisibility:t.link.navigationData.floorVisibility,mode:t.link.navigationData.mode,sweepIndex:t.link.navigationData.sweepIndex,panoId:t.link.navigationData.panoId,position:t.link.navigationData.position&&t.link.navigationData.position.clone(),quaternion:t.link.navigationData.quaternion.clone(),zoom:t.link.navigationData.zoom}},text:t.text,type:t.type});return this.copyWidgetFrame(e.widgetFrame),this.commit(),this}clone(){return(new Mattertag).copy(this)}copyWidgetFrame(e){e?this.widgetFrame?(!function(e,t,...i){for(const n of i)e[n]=t[n]}(this.widgetFrame.size,e.size,"width","height"),this.widgetFrame.frame=e.frame):this.widgetFrame=Object.assign({},e):this.widgetFrame=null}}var c=i(10757),h=i(26587),d=i(38420),u=i(96781),p=i(66097),m=i(71194),g=i(57361),f=i(39729),v=i(88512),y=i(41663),b=i(40698),S=i(90756),E=i(73272);class DescriptionParser{constructor(e){this.modelSID=e.model,this.capabilites={links:{enable:e.supportLinks,keepLabels:e.keepLinkLabels}}}parse(e){const t=[];if(!e)return[];return e.split("[").map((function(e,t){return 0===t?e:"["+e})).forEach((e=>{const i=this.findLink(e);i?-1===i.url.indexOf("javascript:")&&(this.addLinkChunk(t,i),this.addTextChunk(t,e.slice(i.markdown.length))):this.addTextChunk(t,e)})),t}findLink(e){const t=e.match(/\[([^\]]*)\]\((.*)\)/);if(!t)return null;const i=t[2];let n=1,s=0;for(;s<i.length&&("("===i[s]?n++:")"===i[s]&&n--,0!==n);)s++;const r=i.length-s;return{markdown:t[0].substring(0,t[0].length-r),label:t[1],url:this.conditionallyEncode(t[2].substring(0,s))}}conditionallyEncode(e){return this.needsEncoding(e)?encodeURI(e):e}needsEncoding(e){if(e.match(/([#\s\{\}\"\']|[^\x00-\x7F]|%[^0-9a-fA-F]{2})+/g))return!0;let t=e;try{t=decodeURI(e)}catch(e){}return!1}addTextChunk(e,t){0!==t.length&&e.push({type:o.z.text,text:t})}addLinkChunk(e,t){if(!this.capabilites.links.enable)return void(this.capabilites.links.keepLabels&&this.addTextChunk(e,t.label));const i={label:t.label,url:t.url,type:S.U.EXT_LINK};-1===i.url.indexOf("://")&&(i.url="http://"+i.url);const n=-1!==i.url.indexOf("matterport.com/show"),s=-1!==i.url.indexOf(window.location.host+"/show");if(n||s){const e=-1!==i.url.indexOf(this.modelSID),t=E.K.deserialize(i.url);e&&t?(i.type=S.U.NAVIGATION,i.navigationData=t):(i.type=S.U.MODEL,i.url+="&play=1")}e.push({type:o.z.link,link:i})}}var w=i(53204);class ListSerializer{constructor(e){this.config=e}serialize(e){const{serializer:t}=this.config;if(!e||!Array.isArray(e)||!t)return null;const i=[];for(const n of e){const e=t.serialize(n);e&&i.push(e)}return i}deserialize(e){const{deserializer:t}=this.config;if(!e||!Array.isArray(e)||!t)return null;const i=[];for(const n of e){const e=t.deserialize(n);e&&i.push(e)}return i}}var T=i(94474),_=i(71918),M=i(44382);const x=new v.Z("mds-mattertag-serializer");class MdsMattertagCreateSerializer{constructor(e,t){this.updateSerializer=e,this.mediaSerializer=t}serialize(e){const t=this.mediaSerializer.serialize(e),i=this.updateSerializer.serialize(e),n=null!==t?Object.assign(Object.assign({},t),i):i;return this.validate(n)?n:null}validate(e){if(!e)return!1;const t=["label","description","mediaUrl"].some((t=>t in e)),i=["floorId","enabled","anchorPosition"].filter((t=>!(t in e))),n=0===i.length,s=!!e.anchorPosition&&(0,M.uU)(e.anchorPosition),r=n&&t&&s;return r||x.debug("Invalid MattertagDetails:",{missingFields:i,validPosition:s}),r}}var A=i(98649),O=i(31879),P=i(19674);const D=new v.Z("mds-mattertag-serializer");class MdsMattertagDeserializer{deserialize(e){if(!e||!this.validate(e))return D.debug("Deserialized invalid Mattertag data from MDS",e),null;const t=e.anchorPosition?P.ep.fromVisionVector(e.anchorPosition):void 0,i=e.stemNormal?P.ep.fromVisionVector(e.stemNormal):void 0,n=new Mattertag;if(n.sid=e.id,n.label=e.label||"",n.description=e.description||"",n.enabled=!!e.enabled,e.color&&(n.color=new s.Color(e.color)),n.created=(0,O.p)(e.created),n.modified=(0,O.p)(e.modified),e.floor&&e.floor.id&&(n.floorId=e.floor.id),e.room&&e.room.id&&(n.roomId=e.room.id),t&&(n.anchorPosition=t),e.media&&(n.mediaSrc=e.media),e.mediaType&&(n.mediaType=this.getTagDescriptionChunkType(e.mediaType)),void 0!==e.stemLength&&(n.stemHeight=e.stemLength),i&&i instanceof s.Vector3){const t=i.clone().setLength(n.stemHeight);n.anchorNormal=i,n.stemVector=t,n.stemVisible=!!e.stemEnabled}else n.stemVector=new s.Vector3(0,0,0),n.stemVisible=!!e.stemEnabled;return n}validate(e){if(!e)return!1;return["id","created","modified","enabled"].every((t=>t in e))}getTagDescriptionChunkType(e){const t={[A.L.VIDEO]:o.z.video,[A.L.PHOTO]:o.z.photo,[A.L.RICH]:o.z.rich};return e in t?t[e]:o.z.none}}class MdsMattertagMediaRemoveSerializer{serialize(e){return this.validate(e)?{sid:e.sid}:null}validate(e){const t=null!==e&&!!e.mediaType&&e.mediaType===o.z.none;return null!==e&&!!e.sid&&t}}const C=new v.Z("mds-mattertag-serializer");class MdsMattertagMediaUpdateSerializer{serialize(e){const t=this.extractMedia(e);return this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["mediaUrl","mediaType"].every((t=>t in e)),i=void 0!==e.mediaType&&["rich","photo","video"].includes(e.mediaType),n=t&&i;return n||C.debug("invalid media",e,{hasRequiredFields:t,hasValidMediaType:i}),n}extractMedia(e){const t={};return e.mediaSrc&&(t.mediaUrl=e.mediaSrc),e.mediaType&&e.mediaType in I&&(t.mediaType=e.mediaType),t.mediaUrl&&t.mediaType?t:null}}const I={[o.z.photo]:[A.L.PHOTO],[o.z.rich]:[A.L.RICH],[o.z.video]:[A.L.VIDEO]};var L=i(55356);const R=new v.Z("mds-mattertag-serializer");class MdsMattertagUpdateSerializer{serialize(e){if(!e)return null;const t={};return void 0!==e.enabled&&(t.enabled=e.enabled),void 0!==e.stemVisible&&(t.stemEnabled=e.stemVisible),void 0!==e.label&&(t.label=e.label),void 0!==e.description&&(t.description=e.description),void 0!==e.color&&(0,L.D5)(e.color)&&(t.color=(0,L.Ex)(e.color)),void 0!==e.anchorPosition&&(0,M.uU)(e.anchorPosition)&&(t.anchorPosition=P.ep.toVisionVector(e.anchorPosition)),void 0!==e.anchorNormal&&(0,M.uU)(e.anchorNormal)&&(t.stemNormal=P.ep.toVisionVector(e.anchorNormal)),void 0!==e.stemHeight&&(t.stemLength=e.stemHeight),e.floorId&&(t.floorId=e.floorId),e.roomId&&(t.roomId=e.roomId),t&&this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["floorId","roomId","color","label","description","enabled","stemEnabled","stemLength","stemNormal","stemDirection","anchorPosition"],i=Object.keys(e).length>0,n=Object.keys(e).every((e=>t.includes(e))),s=n&&i;return s||R.debug("Invalid MattertagPatch:",{hasContents:i,hasValidFields:n,data:e}),s}}var N=i(6850);const k=new v.Z("MdsMattertagStore");class MdsMattertagStore extends T.u{constructor(e){super(e),this.prefetchKey="data.model.mattertags",this.patchSerializer=new MdsMattertagUpdateSerializer,this.mediaUpdateSerializer=new MdsMattertagMediaUpdateSerializer,this.mediaRemovalSerializer=new MdsMattertagMediaRemoveSerializer,this.createSerializer=new MdsMattertagCreateSerializer(this.patchSerializer,this.mediaUpdateSerializer);const t=new MdsMattertagDeserializer;this.deserializer=new ListSerializer({deserializer:t})}async read(e){const{includeDisabled:t=!1}=this.config,i={modelId:this.getViewId(),includeDisabled:t};return this.query(N.GetMattertags,i,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.mattertags;if(!n||!Array.isArray(n))return null;return(this.deserializer.deserialize(n)||[]).reduce(((e,t)=>(e[t.sid]=t,e)),{})}))}async create(e){const t=this.getViewId();return Promise.all(e.map((e=>{const i=this.createSerializer.serialize(e);if(!i)throw k.error("Failure saving tag:",e.sid,e),new Error("Could not save Mattertag");return this.mutate(N.AddMattertag,{modelId:t,mattertagId:e.sid,data:i}).then((t=>{const i=(0,_.qw)(t,"data.addMattertag"),n=(new Mattertag).copy(e);return n.sid=i.id,n.commit(),n}))})))}async update(e){if(!e||0===e.length)return;const t=this.getViewId();let i="";const n={};n.modelId=t;let s="";for(const t of e){const e=t.sid,r=this.mediaUpdateSerializer.serialize(t),o=this.mediaRemovalSerializer.serialize(t),a=this.patchSerializer.serialize(t);if(!a&&!r&&!o)return void k.debug(`Nothing to update for tag ${e}`,t);a&&(i+=`, $patch${e}: MattertagPatch!`,n[`patch${e}`]=a),n[`mediaType${e}`]=r&&r.mediaType,n[`mediaUrl${e}`]=r&&r.mediaUrl;s+=`\n        update${e}:\n        ${a?`patchMattertag(\n            modelId: $modelId,\n            mattertagId: "${e}",\n            patch: $patch${e}) {\n              id\n            }`:""}\n        ${o?`removeMattertagMedia(\n            modelId: $modelId,\n            mattertagId: "${e}") {\n              id\n            }`:""}\n        ${r?`updateMattertagMediaUrl(\n            modelId: $modelId,\n            mattertagId: "${e}",\n            type: ${r&&r.mediaType},\n            url: "${r&&r.mediaUrl}") {\n              id\n            }`:""}\n      `}const r=w.Ps`
      mutation tagUpdate($modelId: ID! ${i}) {
        ${s}
      }
    `;return this.mutate(r,n).then((()=>{}))}async delete(e){if(!e||0===e.length)return;const t=this.getViewId();let i="";for(const t of e){if(!t||t&&!t.sid)throw new Error("MattertagStore.delete failed");i+=`delete${t.sid}: deleteMattertag(modelId: $modelId, mattertagId: "${t.sid}") `}const n=w.Ps`
      mutation batchDeleteMattertag($modelId: ID!) {
        ${i}
      }
    `;return this.mutate(n,{modelId:t}).then((()=>{}))}}var B,F=i(87324),U=i(85861);!function(e){e.LINK="link",e.PHOTO="photo",e.VIDEO="video",e.RICH="rich"}(B||(B={}));const V=new v.Z("mattertags"),H=e=>{var t;if(!e)return null;const i={};for(const n in e){const r=e[n];try{const e=new Mattertag;e.sid=r.sid,e.created=(0,O.p)(r.created),e.modified=(0,O.p)(r.modified),e.enabled=r.enabled,e.label=r.label||"",e.description=r.description||"",e.anchorPosition=new s.Vector3(r.position.x,r.position.y,r.position.z),(0,M.mB)(r.normal)?V.debug("Ignored empty Mattertag normal",r.normal):e.anchorNormal=new s.Vector3(r.normal.x,r.normal.y,r.normal.z),(null===(t=r.stem)||void 0===t?void 0:t.direction)?e.stemVector=new s.Vector3(r.stem.direction.x,r.stem.direction.y,r.stem.direction.z):(e.stemVector=e.anchorNormal.clone().setLength((0,a._F)(1)),V.debug(`Ignored missing stem direction for ${r.sid}`)),e.stemHeight=e.stemVector.length(),e.stemVisible=void 0===r.stem.enabled||r.stem.enabled,e.floorId="number"==typeof r.floor?String(r.floor):"",e.color=r.color?new s.Color(r.color):new s.Color("#03687d"),r.media?(e.mediaType=o.z.parse(r.media.type),e.mediaSrc=r.media.src):(e.mediaType=o.z.none,e.mediaSrc=""),i[n]=e}catch(e){V.error("Failed to parse tag: "+r.sid,e)}}return i},G=e=>{const t=parseInt(e.floorId,10);if(isNaN(t))throw new Error(`Failed to serialize unsupported floor ID '${e.floorId}'`);const i={sid:e.sid,created:(0,O.U)(e.created),modified:(0,O.U)(e.modified),enabled:e.enabled,label:e.label,description:e.description,color:(0,F.Ex)(e.color),position:(0,F.m)(e.anchorPosition),normal:(0,F.m)(e.anchorNormal),floor:t,stem:{direction:(0,F.m)(e.stemVector),enabled:void 0===e.stemVisible||e.stemVisible}};var n;return n=e.mediaType,Object.values(B).includes(n)&&(i.media={type:e.mediaType,src:e.mediaSrc}),i},z=(e,t)=>{const i={},n=(0,U.p$)(e);(0,U.TS)(n,t);for(const e of Object.keys(n)){const t=n[e];t&&(i[t.sid]=G(t))}return i},W=(e,t)=>{const i=[],n=(0,U.p$)(e);(0,U.TS)(n,t);for(const e of Object.keys(n)){const t=n[e];t&&i.push(G(t))}return i};var j=i(38330),K=i(80121),q=i(18630),Z=i(99398);var Y=i(59088),$=i(27687),Q=i(98828),X=i(736),J=i(76236),ee=i(93673);const te=new v.Z("mattertag-data");class MattertagDataModule extends n.Y{constructor(){super(...arguments),this.name="mattertag-data",this.monitor=null,this.getDiscPositions=(()=>{const e=[],t={},i={},n=new s.Vector3;return async r=>(e.length=0,r.tags.forEach((r=>{const o=this.data.getTag(r);o&&(i[r]||(i[r]=new s.Vector3),i[r].copy(o.anchorPosition).add(o.stemVector),t[r]||(t[r]=new s.Vector2),(0,$.q9)(this.cameraData,i[r],t[r],n),e.push({sid:r,screen:n.z>1?null:t[r],world:i[r]}))})),e)})(),this.addTag=async e=>{const t=new Mattertag;let i=(0,c.O1)(11);for(;this.data.getTag(i);)i=(0,c.O1)(11);return t.sid=i,this._editTag(t,e),this.data.addTag(t),i},this.editTag=async e=>{const t=this.data.getTag(e.sid);t&&this._editTag(t,e.options)},this._editTag=(e,t)=>{void 0!==t.color&&e.color.copy(t.color),void 0!==t.enabled&&(e.enabled=t.enabled),void 0!==t.stemHeight&&(e.stemHeight=t.stemHeight,e.stemVector.copy(e.anchorNormal).setLength(t.stemHeight)),void 0!==t.stemVisible&&(e.stemVisible=t.stemVisible),void 0!==t.label&&(e.label=t.label.slice()),void 0!==t.description&&(e.description=t.description,e.parsedDescription=this.descParser.parse(e.description)),void 0!==t.floorId&&(e.floorId=t.floorId),void 0!==t.mediaType&&(e.mediaType=t.mediaType),void 0!==t.mediaSrc&&(e.mediaSrc=t.mediaSrc.slice()),void 0!==t.normal&&(e.anchorNormal.copy(t.normal).normalize(),e.stemVector.copy(t.normal).setLength(e.stemHeight)),void 0!==t.position&&e.anchorPosition.copy(t.position),e.modified=new Date,e.commit()},this.removeTag=async e=>{if(void 0!==this.data.getTag(e.sid)&&this.data.removeTag(e.sid))return e.sid}}async init(e,t){this.engine=t,this.config=e,this.descParser=new DescriptionParser({model:e.modelId,supportLinks:!0,keepLinkLabels:!0}),this.store=this.configureStorage(e);const i=await this.store.read()||{};this.meshQueryModule=await t.getModuleBySymbol(X.y.MESH_QUERY),this.cameraData=await t.market.waitForData(Y.M_);const n=await t.getModule(h.F);this.data=t.market.tryGetData(b.n)||new b.n,this.initializeTagData(i,t.market,e.parserOptions),this.monitor=this.configureMonitor(e,this.store,this.data),this.bindings.push(t.commandBinder.addBinding(y.cH,this.getDiscPositions),t.commandBinder.addBinding(y.Fz,this.addTag),t.commandBinder.addBinding(y.Ek,this.editTag),t.commandBinder.addBinding(y.Gn,this.removeTag),n.onSave((()=>this.save()),{dataType:d.g.MATTERTAGS}),n.onRevert((()=>this.revert()),{dataType:d.g.MATTERTAGS}),n.onPublish((()=>this.onAfterPublish()),{dataType:d.g.MATTERTAGS,phase:d.Q.AFTER})),this.configureTrash()}async revert(){if(this.store instanceof p.N)return this.store.revert()}async save(){if(this.monitor&&this.monitor.commitChanges(),this.store instanceof p.N)return;if(!this.store||!this.monitor)return void te.warn("Mattertags changes will NOT be saved");const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=e,i=t.filter((e=>e.action===m.KI.removed)).map((e=>({sid:e.index}))),n=t.filter((e=>e.action===m.KI.added)).map((e=>this.data.getTag(e.index))),s=t.filter((e=>e.action===m.KI.updated)).map((e=>{const t=Object.assign({sid:e.index},e.diff);return"mediaSrc"in t&&(t.mediaType=this.data.getTag(e.index).mediaType),t}));return Promise.all([this.store.delete(i),this.store.create(n),this.store.update(s)]).then((()=>{}))}clearDiffRecord(){this.monitor&&this.monitor.clearDiffRecord()}configureStorage(e){const{modelId:t,baseUrl:i,queue:n,storageProvider:s,readonly:r}=e;if(te.info(`Loading Mattertags from ${s}`),s===d.Xq.MDS)return new MdsMattertagStore({readonly:r,includeDisabled:!r,baseUrl:i});const o=function(e){const{modelId:t,readonly:i,serialize:n,deserialize:s}=e,r=e.baseUrl||"",o=e.queue;if(!n||!s)throw new Error("Mattertag sync requires serializer and deserializer");const a=`${r}/api/v1/jsonstore/model/mattertags/${t}`;if(i){const e=new j.gh({queue:o,path:a,deserialize:s});return new K.iY({publishStores:[e]})}const l=new j.MU({queue:o,path:a,batchUpdate:!0,deserialize:s,serialize:n}),c=`${r}/api/v1/jsonstore/model/workshopSession/${t}`,h=new q.Z({queue:o,path:c,cachedData:{data:null},deserialize:Z.S.sessionCollectionMap(q.j.Mattertags,s),serialize:W},q.j.Mattertags);return new K.iY({publishStores:[l],legacyEditStore:h,editStoreKey:K.aw.MATTERTAGS})}({modelId:t,readonly:r,baseUrl:i,serialize:z,deserialize:H,queue:n});return new p.N(o,{dataType:d.g.MATTERTAGS,readonly:r,engine:this.engine})}configureMonitor(e,t,i){const{readonly:n}=e;if(!n){const e=new g.c(i.collection,{aggregationType:f.E.Manual,shallow:!0});return t instanceof p.N&&t.addMonitor(e),e}return null}initializeTagData(e,t,i){const n=i?new DescriptionParser(i):this.descParser;for(const t in e){const i=e[t];i.parsedDescription=n.parse(e[t].description),this.meshQueryModule.inferMeshIdsFromPoint(i,i.anchorPosition),this.data.addTag(i)}t.register(this,b.n,this.data)}async onAfterPublish(){this.verifyDataIntegrity()}async verifyDataIntegrity(){if(!(this.store instanceof MdsMattertagStore))return;const e="data-integrity"===(0,Q.h)("error",""),t=this.data.getTagCount(),i=await this.store.read().catch((e=>{te.debug("Mattertag integrity check failed",e)}))||{},n=Object.keys(i).length;(n!==t||e)&&this.engine.broadcast(new u.Qq(`Unexpected tag count after publish (${n}/${t})`,d.g.MATTERTAGS,e))}async configureTrash(){const{readonly:e,storageProvider:t}=this.config,{commandBinder:i}=this.engine;if(e||t!==d.Xq.MDS)return;const n=d.g.MATTERTAGS,s=new MdsMattertagDeserializer,r={objectType:n,create:e=>new J.F({label:e.label||(0,c.aS)(e.description||"",100)||"Mattertag",objectId:e.id,objectType:n,created:new Date,value:e}),restore:e=>{const t=s.deserialize(e.value);t&&this.data.addTag(t)}},o=await i.issueCommandWhenBound(new ee.B(r));this.bindings.push(o)}}},46610:(e,t,i)=>{"use strict";i.d(t,{QY:()=>MattertagNavigatedMessage,Ik:()=>MattertagLinkOpenedMessage,dJ:()=>MattertagViewedMessage});var n=i(91466);class MattertagNavigatedMessage extends n.v{constructor(e){super(),this.sid=e}}class MattertagLinkOpenedMessage extends n.v{constructor(e,t){super(),this.url=e,this.embed=t}}class MattertagViewedMessage extends n.v{constructor(e,t){super(),this.sid=e,this.view=t}}},44060:(e,t,i)=>{"use strict";i.d(t,{r:()=>n,l:()=>s});const n="features/mattertags",s="embedlyKey"},92895:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>MattertagMeshModule});var n=i(47724),s=i(33874),r=i(40698),o=i(42835),a=i(41591),l=i(39504),c=i(44060),h=i(58626),d=i(66223),u=i(64366),p=i(78947);class MattertagMeshModule extends n.Y{constructor(){super(...arguments),this.name="mattertag-mesh",this.visibilityDirty=!0,this.unanchoredTagOpacity=1,this.anchoredTagOpacity=1,this.addNewTagMesh=(e,t)=>{this.settings.tryGetProperty(l.R,!1)||this.pinRenderer.updatePin(e.sid,o.Er.MATTERTAG,Object.assign(Object.assign({},e),{stemNormal:e.stemVector,stemLength:e.stemHeight,stemEnabled:e.stemVisible,color:`#${e.color.getHexString()}`}),this.backgroundTexture,this.maskTexture)},this.removeTagMesh=(e,t)=>{this.pinRenderer.removePin(e.sid)},this.updateTagMesh=(e,t)=>{this.addNewTagMesh(e,e.sid)},this.initializeTagVisibility=()=>{if(this.settings.tryGetProperty(l.R,!1))return;const e=this.settings.tryGetProperty(c.r,!0);this.pinRenderer.setPinOpacityByType(o.Er.MATTERTAG,e?1:0),e&&this.mattertagData.iterate((e=>{this.pinRenderer.setPinVisible(e.sid,e.enabled)}))},this.updateTagVisibilty=()=>{if(this.settings.tryGetProperty(l.R,!1))return;this.settings.tryGetProperty(c.r,!1)?this.fadePinsToState():this.pinRenderer.fadePinOpacityByType(o.Er.MATTERTAG,0)},this.selectedTagChanged=()=>{if(!this.settings.tryGetProperty(l.R,!1)){if(this.mattertagViewData.selectedTag&&!this.mattertagViewData.navigating){const e=this.mattertagData.getTag(this.mattertagViewData.selectedTag);this.pinRenderer.showSelectedMesh(o.Er.MATTERTAG,e.sid)}this.mattertagViewData.selectedTag||this.pinRenderer.hideSelectedMesh()}}}async init(e,t){const[i,n,o,l]=await Promise.all([t.market.waitForData(r.n),t.getModule(a.default),t.market.waitForData(s.e),t.market.waitForData(h.P5)]);this.settings=o,this.mattertagData=i,this.mattertagViewData=l,this.pinRenderer=n.pinRenderer;const m=()=>{this.visibilityDirty=!0};this.bindings.push(this.mattertagData.collection.onElementChanged({onAdded:this.addNewTagMesh,onRemoved:this.removeTagMesh,onUpdated:this.updateTagMesh}),this.mattertagViewData.onToolStateChanged(m),this.settings.onPropertyChanged(c.r,m),this.mattertagData.onChanged(m),this.mattertagViewData.onSelectedTagChanged(this.selectedTagChanged),this.mattertagViewData.onNavigatingTagChanged(this.selectedTagChanged)),this.backgroundTexture=(0,d.p)(u),this.maskTexture=(0,d.p)(p),this.mattertagData.iterate((e=>{this.addNewTagMesh(e,e.sid)})),this.initializeTagVisibility()}dispose(e){this.pinRenderer.removePinsByType(o.Er.MATTERTAG),this.backgroundTexture.dispose(),this.maskTexture.dispose(),super.dispose(e)}onUpdate(e){this.visibilityDirty&&(this.visibilityDirty=!1,this.updateTagVisibilty())}showAnchorMesh(e){this.pinRenderer.showAnchorMesh(o.Er.MATTERTAG,e.sid,Object.assign(Object.assign({},e),{stemNormal:e.stemVector,stemLength:e.stemHeight})),this.unanchoredTagOpacity=.5,this.anchoredTagOpacity=1,this.anchorTagId=e.sid,this.fadePinsToState()}hideAnchorMesh(){this.unanchoredTagOpacity=1,this.anchoredTagOpacity=1,this.anchorTagId=void 0,this.pinRenderer.hideAnchorMesh(),this.fadePinsToState()}resetPinOpacity(){this.fadePinsToState()}changeDiscOpacity(e,t){this.pinRenderer.setPinOpacity(e,t)}setTagVisibility(e){this.pinRenderer.setPinTypeVisible(o.Er.MATTERTAG,e)}setTagVisible(e,t){this.pinRenderer.setPinVisible(e,t)}setOverrideMaterial(e,t,i){this.pinRenderer.setPinRenderOverrides(e,t,i)}fadePinsToState(){const{selectedTag:e}=this.mattertagViewData;this.mattertagData.iterate((t=>{const i=t.enabled||e===t.sid;this.pinRenderer.setPinVisible(t.sid,i);const n=t.sid===this.anchorTagId?this.anchoredTagOpacity:this.unanchoredTagOpacity;this.pinRenderer.fadePinOpacity(t.sid,i?n:0)}))}}},60225:(e,t,i)=>{"use strict";i.d(t,{c:()=>MattertagNavigateToLinkCommand,Y:()=>NavigateToMattertagCommand});var n=i(17386);class MattertagNavigateToLinkCommand extends n.m{constructor(e){super(),this.id="MATTERTAG_NAV_LINK",this.payload={chunk:e}}}class NavigateToMattertagCommand extends n.m{constructor(e,t,i=!1){super(),this.id="MATTERTAG_NAVIGATE",this.payload={sid:e,transition:t,navigateToDisabled:i}}}},58626:(e,t,i)=>{"use strict";i.d(t,{Pg:()=>n,rI:()=>s,P5:()=>MattertagsViewData,ZJ:()=>BillboardData});var n,s,r=i(32770),o=i(75256),a=i(48715),l=i(64781),c=i(23573);!function(e){e.UP="Up",e.DOWN="Down",e.LEFT="Left",e.LEFT_UP="LeftUp",e.LEFT_DOWN="LeftDown",e.RIGHT="Right",e.RIGHT_UP="RightUp",e.RIGHT_DOWN="RightDown"}(n||(n={})),function(e){e.CLOSED="closed",e.IDLE="idle",e.DISABLED="disabled",e.CREATING="creating",e.PRESSING="pressing",e.PLACING="placing",e.PLACED="placed",e.EDITING="editing"}(s||(s={}));class MattertagsViewData extends r.V{constructor(e){super(),this.mattertags=e,this.name="tag-view",this.visitedTags=new o.d,this.navigatingTag=(0,a.Y)(null),this.toolStateObservable=(0,a.Y)(s.CLOSED),this.openTagObservable=(0,a.Y)(null),this.selectedTagObservable=(0,a.Y)(null),this.uncommittedTagObservable=(0,a.Y)(null),this.progressObservable=new a.f(-1),this.screenPositionObservable=new a.f(null),this.viewedTags=0,this.creatingNewMattertag=!1,this.tagCapabilities={},this.getViewData=e=>{const t=this.mattertags.getTag(e),i=this.derivedData[e];return t&&!i&&this.makeViewData&&(this.derivedData[e]=this.makeViewData(t)),this.derivedData[e]},this.derivedData={},this.activeBillboards=(0,l.q)()}setViewDataFactory(e){this.makeViewData=e}openBillboard(e){this.openTag&&this.openTag!==e&&this.closeBillboard(this.openTag),this.openTag!==e&&this.setOpenTag(e)}hideBillboard(e){this.openTag===e&&this.setOpenTag(null)}closeBillboard(e){this.openTag===e&&this.setOpenTag(null),this.selectedTag===e&&this.setSelectedTag(null)}closeOpenBillboard(){this.openTag&&this.closeBillboard(this.openTag)}setTagCapabilities(e,t){const i=this.tagCapabilities[e]||{};i.opening=t.opening,i.navigating=t.navigating,this.tagCapabilities[e]=i,this.openTag!==e||this.tagCapabilities.opening||this.closeBillboard(e)}getTagCount(){return this.mattertags.collection.length}get navigating(){return this.navigatingTag.value}setNavigatingTag(e){this.navigatingTag.value=e}onNavigatingTagChanged(e){return this.navigatingTag.onChanged(e)}setSelectedTag(e){this.selectedTagObservable.value=e}get selectedTag(){return this.selectedTagObservable.value}onSelectedTagChanged(e){return this.selectedTagObservable.onChanged(e)}setUncommittedTag(e){this.uncommittedTagObservable.value=e}get uncommittedTag(){return this.uncommittedTagObservable.value}onUncommittedChanged(e){return this.uncommittedTagObservable.onChanged(e)}setProgress(e){this.progressObservable.value=e}get progress(){return this.progressObservable.value}onProgressChanged(e){return this.progressObservable.onChanged(e)}get screenPosition(){return this.screenPositionObservable.value}setScreenPosition(e){this.screenPositionObservable.value=e}onScreenPositionChanged(e){return this.screenPositionObservable.onChanged(e)}setToolState(e){switch(e){case s.CREATING:this.creatingNewMattertag=!0;break;case s.IDLE:case s.CLOSED:this.creatingNewMattertag=!1}this.toolStateObservable.value=e}get toolState(){return this.toolStateObservable.value}onToolStateChanged(e){return this.toolStateObservable.onChanged(e)}get openTag(){return this.openTagObservable.value}setOpenTag(e){this.openTagObservable.value=e}onOpenTagChanged(e){return this.openTagObservable.onChanged(e)}isCreatingNewMattertag(){return this.creatingNewMattertag}visitTag(e){this.viewedTags++,-1===this.visitedTags.indexOf(e)&&this.visitedTags.push(e)}getViewedTagCount(){return this.viewedTags}getVisitedTags(){return this.visitedTags.values()}setNavigatingPosition(e){this.navigatingPosition=e}getNavigatingPosition(){return this.navigatingPosition}}class BillboardData extends c.T{constructor(e){super(),this.sid=e,this.closing=!1,this.position=null,this.distance=0,this.timeoutId=0}}},87738:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>MattertagViewDataModule});var n=i(2212),s=i(47724),r=i(40698),o=i(41663),a=i(59088),l=i(46610),c=i(29397),h=i(68576),d=i(8150),u=i(31278),p=i(75892),m=i(51153),g=i(21479),f=i(94329),v=i(44060),y=i(39504),b=i(33874),S=i(60225),E=i(29422),w=i(88512),T=i(3805),_=i(58626),M=i(12216),x=i(42835),A=i(41591),O=i(48470);const P=new w.Z("mattertag-viewdata-module");class MattertagViewDataModule extends s.Y{constructor(){super(...arguments),this.name="mattertags-viewdata",this.distance=new n.Vector3,this.cameraPosition=new n.Vector3,this.hoverTimeout=0,this.updateViewData=()=>{this.data.iterate((e=>{this.viewData.derivedData[e.sid]=this.makeViewDataForMattertag(e)})),this.viewData.commit()},this.makeViewDataForMattertag=e=>{const t=this.viewData.activeBillboards.get(e.sid),i=this.viewData.selectedTag===e.sid,n=t?t.position:null,s=t?t.distance:0;return{position:n,selected:i,located:!(!n||!s),closeTheTag:!t||t.closing||!(i||!this.viewData.selectedTag),navigating:!(!this.viewData.navigating||this.viewData.navigating!==e.sid),navigatingPosition:i?this.viewData.getNavigatingPosition():void 0,positioned:!1,distance:s,stemHeight:e.stemHeight,visible:e.enabled,color:`#${e.color.getHexString()}`,onTagDirectionChanged:this.onTagDirectionChanged}},this.onCameraUpdate=e=>{this.viewData.activeBillboards.keys.length>0&&(this.cameraPosition.copy(e.pose.position),this.updateActiveBillboards(this.viewData.activeBillboards.keys),this.viewData.commit())},this.updateBillboardData=(e,t)=>{const i=this.viewData.activeBillboards.get(e);i&&(Object.assign(i,t),i.commit())},this.addActiveBillboard=e=>{this.viewData.activeBillboards.has(e)||this.viewData.activeBillboards.set(e,new _.ZJ(e))},this.removeFromActiveBillboards=e=>{this.viewData.activeBillboards.has(e)&&this.viewData.activeBillboards.delete(e)},this.handleOpenBillboardChanged=()=>{const e=this.viewData.openTag;this.viewData.activeBillboards.atomic((()=>{e&&(this.viewData.activeBillboards.get(e)?(window.clearTimeout(this.viewData.activeBillboards.get(e).timeoutId),this.updateBillboardData(e,{timeoutId:0,closing:!1})):this.addActiveBillboard(e),this.updateActiveBillboards([e]));for(const t of this.viewData.activeBillboards.keys){if(t===e)return;this.updateBillboardData(t,{closing:!0,direction:void 0,timeoutId:window.setTimeout((()=>{this.removeFromActiveBillboards(t)}),1e3)})}}))},this.updateActiveBillboards=async e=>{try{await this.engine.commandBinder.issueCommand(new o.cH(e)).then((e=>{for(const t of e)this.updateBillboardData(t.sid,{distance:this.distance.copy(this.cameraPosition).distanceToSquared(t.world),position:t.screen})}))}catch(e){P.error(`Could not get Disc Positions for tags - ${e}`)}},this.onSweepChosen=e=>{this.viewData.setNavigatingPosition(e)},this.onDiscHoverChange=e=>{if(this.settings.tryGetProperty(y.R,!1))return;if(e.pinType!==x.Er.MATTERTAG)return;const t=this.viewData.toolState;if(t!==_.rI.CLOSED&&this.viewData.selectedTag)return;const i=this.data.getTag(e.id);if(i&&i.enabled)if(clearTimeout(this.hoverTimeout),e.hovering)t!==_.rI.EDITING&&(this.hoverTimeout=window.setTimeout((()=>this.discHoverChange(e.id,e.hovering)),125));else{if(e.id===this.viewData.selectedTag)return;this.discHoverChange(e.id,!1)}},this.onDiscClicked=e=>{if(this.settings.tryGetProperty(y.R,!1))return;const t=this.viewData.toolState;e.pinType===x.Er.MATTERTAG&&t===_.rI.CLOSED&&(e.id===this.viewData.selectedTag?this.closeBillboard(e.id):(this.viewData.setSelectedTag(e.id),this.navigateToTag(e.id,u.n.Interpolate)))},this.onSweepExit=e=>{e.toSweep&&e.fromSweep!==e.toSweep&&(this.viewData.isCreatingNewMattertag()||this.viewData.closeOpenBillboard())},this.onAppChange=e=>{this.currentApp=e.application,this.viewData.closeOpenBillboard(),this.viewData.setSelectedTag(null)},this.onViewmodeChange=e=>{null===this.viewData.navigating&&e.fromMode===f.Ey.Panorama&&this.viewData.closeOpenBillboard()},this.onNavigationLinkClicked=async e=>{if(e.chunk.link&&e.chunk.link.navigationData){const t={2:T.BD.DOLLHOUSE,3:T.BD.FLOORPLAN},{sweepIndex:i,quaternion:n,mode:s}=e.chunk.link.navigationData;let{panoId:r,position:o}=e.chunk.link.navigationData;if(!r&&void 0!==i){const e=this.sweepData.getSweepByIndex(i);e&&(r=e.id)}if(r)this.engine.commandBinder.issueCommand(new E.ju({sweep:r,rotation:n,transition:u.n.FadeToBlack}));else{if(!(s in t))throw new Error("Unknown navigation link pose: "+JSON.stringify(e.chunk.link.navigationData));this.engine.commandBinder.issueCommand(new T._i(t[s],u.n.Interpolate,{rotation:n,position:o}))}}},this.onTagDirectionChanged=(e,t)=>{this.updateBillboardData(e,{direction:t})}}async init(e,t){this.engine=t;const[i,n,s,o,l]=await Promise.all([t.market.waitForData(r.n),t.market.waitForData(p.Z),t.market.waitForData(b.e),t.market.waitForData(a.M_),t.getModule(A.default)]);this.data=i,this.sweepData=n,this.settings=s,this.cameraData=o,this.pinRenderer=l.pinRenderer,this.viewData=t.market.tryGetData(_.P5)||new _.P5(this.data),t.market.register(this,_.P5,this.viewData),this.viewData.setViewDataFactory(this.makeViewDataForMattertag),this.updateViewData(),this.settings.onPropertyChanged(v.r,(e=>{0!==e&&this.viewData.closeOpenBillboard()})),this.bindings.push(t.subscribe(O.tP,this.onDiscHoverChange),t.subscribe(O.F7,this.onDiscClicked),t.subscribe(c.Z,this.onSweepExit),t.subscribe(h.Z,this.onViewmodeChange),t.subscribe(d.bS,this.onAppChange),this.cameraData.onChanged(this.onCameraUpdate),this.data.onChanged(this.updateViewData),this.viewData.onOpenTagChanged(this.handleOpenBillboardChanged),this.viewData.activeBillboards.onChanged(this.updateViewData)),this.engine.commandBinder.addBinding(S.c,this.onNavigationLinkClicked),this.engine.commandBinder.addBinding(S.Y,(async e=>this.navigateToTag(e.sid,e.transition,e.navigateToDisabled)))}openBillboard(e){const t=this.viewData.tagCapabilities[e];t&&!t.opening||this.viewData.openBillboard(e)}closeBillboard(e){this.viewData.closeBillboard(e)}async navigateToTag(e,t,i=!1){if(this.settings.tryGetProperty(y.R,!1))return;const n=this.data.getTag(e);if(!n)throw new Error("No tag with that sid was found");if(!n.enabled&&!i)throw new Error("Cannot navigate to a disabled mattertag");const s=this.viewData.tagCapabilities[e];if(s&&!s.navigating)return;this.viewData.setNavigatingTag(e);const r=this.viewData.activeBillboards.get(e),o=r&&r.direction,{anchorPosition:a,stemVector:l,stemHeight:c}=n,h=this.tagDirectionToOrientationAdjust(o),d={anchorPosition:a,stemNormal:l,stemLength:c};return this.engine.commandBinder.issueCommand(new E.OR({pinPosition:d,transition:t,orientationAdjust:h,onSweepChosen:this.onSweepChosen})).then((()=>{this.viewData.setSelectedTag(e),this.onTagVisited(e),this.openBillboard(e),this.viewData.setNavigatingTag(null),this.viewData.setNavigatingPosition(void 0)})).catch((e=>{P.debug(e),this.viewData.setNavigatingTag(null),this.viewData.setNavigatingPosition(void 0)}))}onTagVisited(e){this.viewData.visitTag(e),this.engine.broadcast(new l.dJ(e,m.V.OPEN)),this.engine.broadcast(new l.QY(e))}discHoverChange(e,t){if(this.settings.tryGetProperty(y.R,!1))return;if(!this.data.getTag(e))return;const i=this.viewData.openTag===e;t&&!i?(this.currentApp===g.Mx.SHOWCASE&&this.engine.broadcast(new l.dJ(e,m.V.HOVER)),this.openBillboard(e),this.pinRenderer.setPinColorVariant(e,x.K_.HIGHLIGHTED)):!t&&i&&(this.closeBillboard(e),this.pinRenderer.setPinColorVariant(e,x.K_.DEFAULT)),this.viewData.commit()}tagDirectionToOrientationAdjust(e,t=new n.Quaternion){const i=.25;let s=0,r=0;if(e){switch(e){case _.Pg.RIGHT:case _.Pg.RIGHT_DOWN:case _.Pg.RIGHT_UP:s=-.25;break;case _.Pg.LEFT:case _.Pg.LEFT_DOWN:case _.Pg.LEFT_UP:s=i}switch(e){case _.Pg.UP:case _.Pg.LEFT_UP:case _.Pg.RIGHT_UP:r=i;break;case _.Pg.DOWN:case _.Pg.LEFT_DOWN:case _.Pg.RIGHT_DOWN:s=-.25}}else s=-.25,r=-.25;return t.setFromAxisAngle(M.f.RIGHT,r),t.multiply((new n.Quaternion).setFromAxisAngle(M.f.UP,s)),t}}},14275:(e,t,i)=>{"use strict";i.d(t,{h:()=>Grouper,Z:()=>Group});var n=i(60039),s=i(85861),r=i(84933);class Grouper{constructor(e){this.contents=e,this.groupInfo=[],this.groupIndices=[],this.groupInfoMap={},this.groupIndicesMap={}}startGroup(e){const t=0===this.groupCount,i=this.contents.length!==this.groupIndices[this.groupCount-1];if(t||i){let t=e.sid;if(!t)for(t=(0,r.f)();this.groupInfoMap.hasOwnProperty(t);)t=(0,r.f)();const i=Object.assign(Object.assign({},e),{sid:t});this.groupInfo.push(i),this.groupInfoMap[t]=i,this.groupIndices.push(this.contents.length),this.groupIndicesMap[this.contents.length]=!0}return this.groupIndices.length-1}reset(){this.contents.atomic((()=>{for(let e=this.contents.length-1;e>=0;--e)this.removeFromIdx(e);this.groupIndices=[],this.groupInfo=[],this.groupIndicesMap={}}))}isStartIndex(e){return!!this.groupIndicesMap[e]}*groups(){for(let e=0;e<this.groupCount;++e)yield this.getGroup(e)}*[Symbol.iterator](){for(const e of this.contents)yield e}getGroupStartIndex(e){return this.groupIndices[e]}getGroup(e){const t=this.groupIndices[e],i=this.groupIndices[e+1],n=isNaN(i)?this.contents.length-1:i-1;return new Group(e,this.contents,t,n,Object.assign({},this.groupInfo[e]))}getGroupById(e){for(let t=0;t<this.groupInfo.length;t++)if(e===this.groupInfo[t].sid)return this.getGroup(t)}indexOfGroup(e){for(let t=0;t<this.groupInfo.length;t++)if(e(this.groupInfo[t]))return t;return-1}updateGroupInfo(e,t){const i=this.groupInfo[e].sid;delete this.groupInfoMap[i];const n=Object.assign({sid:i},t);this.groupInfo.splice(e,1,n),this.groupInfoMap[i]=n}get groupCount(){return this.groupIndices.length}get length(){return this.contents.length}get(e){return this.contents.get(e)}push(e){if(0===this.groupCount)throw Error("Grouper: Error pushing points when we have no groups!");return this.contents.push(e.clone()),this.contents.length}pop(){return this.removeFromIdx(this.contents.length-1)}removeFromIdx(e){if(e<this.contents.length&&e>=0&&this.contents.length>=0){const t=this.contents.get(e);return this.contents.remove(e),this.removeEmptyGroups(),t}}removeEmptyGroups(){this.contents.length<=this.groupIndices[this.groupCount-1]&&this.removeGroup(this.groupCount-1)}groupFromPointIndex(e){if(0>e||e>=this.length)return-1;let t=this.groupCount-1;for(;e<this.groupIndices[t];)--t;return t}removeGroup(e){if(e>this.groupCount||e<0)return;const t=this.getGroup(e);if(0===t.count)return;const i=this.groupIndices[e];this.groupIndices.splice(e,1),this.groupInfo.splice(e,1),delete this.groupInfoMap[t.info.sid],delete this.groupIndicesMap[i];for(let i=e;i<this.groupCount;++i){const e=this.groupIndices[i],n=e-t.count;this.groupIndices[i]=n,delete this.groupIndicesMap[e],this.groupIndicesMap[n]=!0}this.contents.splice(t.startIndex,t.count)}update(e,t){this.contents.update(e,t.clone())}copy(e){return this.contents.atomic((()=>{this.reset();for(const t of e){this.startGroup(t.info);for(const e of t)this.push(e)}})),this}toString(){return`Grouper: { groupCount: ${this.groupCount}, length: ${this.length}, groups: [${[...this.groups()].map((e=>`${e}`))}]}`}}class Group{constructor(e,t,i,n,s){this.index=e,this.grouper=t,this.startIndex=i,this.endIndex=n,this.data=s}*[Symbol.iterator](){for(let e=0;e<this.count;++e)yield this.get(e)}get(e){if(!this.has(e))throw RangeError(`Out of range error ${e} / ${this.count-1}`);return this.grouper.get(this.startIndex+e)}has(e){return e>=0&&this.startIndex+e<=this.endIndex}get count(){return this.endIndex-this.startIndex+1}get info(){return this.data}get isClosed(){const e=this.grouper.get(this.startIndex),t=this.grouper.get(this.endIndex);return this.count>2&&e.distanceTo(t)<=n.NZ}get length(){let e=0,t=null;for(let i=0;i<this.count;i++)t&&(e+=this.get(i).distanceTo(t)),t=this.get(i);return e}hasLength(){const e=this.grouper.get(this.startIndex),t=this.grouper.get(this.endIndex);return e&&t&&(this.isClosed||e.distanceTo(t)>n.NZ)}clone(){const e=[],t={get:t=>e[t],contents:e};for(let e=0;e<this.count;e++)t.contents.push(this.get(e));return new Group(this.index,t,0,t.contents.length-1,Object.assign({},this.data))}describe(e=this.endIndex){return`GroupSegment${this.index}/${this.startIndex}/${e}}`}equals(e){if(this.count!==e.count||this.index!==e.index)return!1;if((0,s.NK)(this.info,e.info))return!1;for(let t=0;t<this.count;++t)if(!this.get(t).equals(e.get(t)))return!1;return!0}}},38003:(e,t,i)=>{"use strict";i.d(t,{X:()=>MeasurementModeData});var n=i(32770),s=i(60725),r=i(48715),o=i(44283);class MeasurementModeData extends n.V{constructor(){super(...arguments),this.name="measure-mode",this._groups=[],this._groupMap={},this.onDataChangedCallbacks=new Set,this._editingGroupId=null,this._creatingGroupId=null,this.phaseObservable=(0,r.Y)(s.au.CLOSED),this.selectedGroupIndexObservable=new r.f(-1),this.pressProgressObservable=new r.f(-1),this.pointPositionObservable=new r.f(null)}modeActive(){return this.phase!==s.au.CLOSED}*groups(){for(const e of this._groups)yield e}get selectedGroupSid(){const e=this.selectedGroupInfo;return e&&e.info.sid?e.info.sid:null}get selectedGroupInfo(){return-1===this.selectedGroupIndex?null:this.getGroupInfo(this.selectedGroupIndex)}get phase(){return this.phaseObservable.value}get creatingGroupId(){return this._creatingGroupId}set creatingGroupId(e){this._creatingGroupId=e}get editingGroupId(){return this._editingGroupId}set editingGroupId(e){this._editingGroupId=e}setPhase(e){this.phase!==e&&(this.phaseObservable.value=e)}onPhaseChanged(e){return this.phaseObservable.onChanged(e)}notifyDataChanged(){this.onDataChangedCallbacks.forEach((e=>e()))}onDataChanged(e){return(0,o.k1)((()=>this.onDataChangedCallbacks.add(e)),(()=>this.onDataChangedCallbacks.delete(e)),!0)}get groupCount(){return this._groups.length}get selectedGroupIndex(){return this.selectedGroupIndexObservable.value}setSelectedGroupIndex(e){this.selectedGroupIndexObservable.value=e}onSelectedGroupIndexChanged(e){return this.selectedGroupIndexObservable.onChanged(e)}get pointPosition(){return this.pointPositionObservable.value}setPointPosition(e){this.pointPositionObservable.value=e}onPointPositionChanged(e){return this.pointPositionObservable.onChanged(e)}setPressProgress(e){this.pressProgressObservable.value=e}get pressProgress(){return this.pressProgressObservable.value}onPressProgressChanged(e){return this.pressProgressObservable.onChanged(e)}getGroupInfo(e){return e<0||e>=this._groups.length?null:this._groups[e]}getGroupInfoBySid(e){return e?this._groupMap[e]:null}repopulate(e){this.clear();for(const t of e){const e=t.clone();this._groups.push(e),this._groupMap[t.info.sid]=e}(this.editingGroupId||this.creatingGroupId)&&this.notifyDataChanged()}clear(){this._groups=[],this._groupMap={}}}},60725:(e,t,i)=>{"use strict";var n;i.d(t,{au:()=>n,Pj:()=>s,Ph:()=>r,q8:()=>o,WN:()=>a}),function(e){e[e.CLOSED=0]="CLOSED",e[e.IDLE=1]="IDLE",e[e.EDITING=2]="EDITING",e[e.CREATING=3]="CREATING",e[e.POINT_PLACED=4]="POINT_PLACED",e[e.CREATING_NEXT_POINT=5]="CREATING_NEXT_POINT",e[e.CONFIRMING_POINT=6]="CONFIRMING_POINT"}(n||(n={}));const s={mobile:{[n.POINT_PLACED]:!0,[n.EDITING]:!0},desktop:{[n.CREATING]:!0,[n.CREATING_NEXT_POINT]:!0,[n.EDITING]:!0}},r={mobile:{[n.CREATING_NEXT_POINT]:!0,[n.POINT_PLACED]:!0,[n.EDITING]:!0},desktop:{[n.CREATING]:!0,[n.CREATING_NEXT_POINT]:!0,[n.EDITING]:!0}},o={[n.IDLE]:!0,[n.EDITING]:!0},a={[n.IDLE]:!0,[n.EDITING]:!0}},26881:(e,t,i)=>{"use strict";i.d(t,{d:()=>MeasurementContentsReplace});var n=i(17386);class MeasurementContentsReplace extends n.m{constructor(e){super(),this.payload=e}}},58878:(e,t,i)=>{"use strict";i.d(t,{Ev:()=>MeasurementDeleteSelectedCommand,Tn:()=>MeasurementDeleteCommand,JM:()=>MeasurementListDeletionCommand});var n=i(17386);class MeasurementDeleteSelectedCommand extends n.m{}class MeasurementDeleteCommand extends n.m{constructor(e){super(),this.payload={index:e}}}class MeasurementListDeletionCommand extends n.m{constructor(...e){super(),this.payload={sids:e}}}},40688:(e,t,i)=>{"use strict";i.d(t,{O:()=>MeasurementModeToggle});var n=i(17386);class MeasurementModeToggle extends n.m{constructor(e,t){super(),this.payload={on:e,dimWhileActive:void 0!==t?t:e}}}},62518:(e,t,i)=>{"use strict";i.d(t,{c:()=>MeasurementNewline});var n=i(17386);class MeasurementNewline extends n.m{}},52247:(e,t,i)=>{"use strict";i.d(t,{R:()=>MeasurementRenameCommand});var n=i(17386);class MeasurementRenameCommand extends n.m{constructor(e,t=""){super(),this.id="RENAME_MEASUREMENT",this.payload={sid:e,text:t}}}},39712:(e,t,i)=>{"use strict";i.d(t,{v:()=>MeasurementSelect,t:()=>MeasurementSelectById});var n=i(17386);class MeasurementSelect extends n.m{constructor(e){super(),this.payload=e}}class MeasurementSelectById extends n.m{constructor(e){super(),this.payload={sid:e}}}},41911:(e,t,i)=>{"use strict";i.d(t,{B:()=>MeasurementStop});var n=i(17386);class MeasurementStop extends n.m{}},13341:(e,t,i)=>{"use strict";i.d(t,{W:()=>MeasurementVisibilityCommand});var n=i(17386);class MeasurementVisibilityCommand extends n.m{constructor(e,...t){super(),this.id="VISIBILITY_MEASUREMENT",this.payload={sids:t,visible:e}}}},21244:(e,t,i)=>{"use strict";i.d(t,{rf:()=>MeasurementSegmentCreatedMessage,u6:()=>MeasurementCreatedMessage,ff:()=>MeasurementCreationCancelledMessage,ty:()=>MeasurementTitleAddedMessage,mM:()=>MeasurementTitleChangedMessage,$Z:()=>MeasurementDeletedMessage,av:()=>MeasurementUpdatedMessage,$n:()=>MeasurementModeToggledMessage});var n=i(91466);class MeasurementSegmentCreatedMessage extends n.v{constructor(e){super(),this.data=e}}class MeasurementCreatedMessage extends n.v{constructor(e){super(),this.data=e}}class MeasurementCreationCancelledMessage extends n.v{}class MeasurementTitleAddedMessage extends n.v{constructor(e,t){super(),this.sid=e,this.text=t}}class MeasurementTitleChangedMessage extends n.v{constructor(e,t,i){super(),this.sid=e,this.oldText=t,this.newText=i}}class MeasurementDeletedMessage extends n.v{constructor(e){super(),this.data=e}}class MeasurementUpdatedMessage extends n.v{constructor(e){super(),this.data=e}}class MeasurementModeToggledMessage extends n.v{constructor(e,t,i){super(),this.opened=e,this.viewmode=t,this.count=i}}},60039:(e,t,i)=>{"use strict";i.d(t,{yV:()=>s,NZ:()=>r,E0:()=>o,ox:()=>a,X7:()=>l,xh:()=>c,Oq:()=>h,Hn:()=>d,Ql:()=>u});var n=i(13188);const s=.01,r=.001,o=!0,a={highResThreshold:1081,desktopSize:192,desktopSizeHighRes:320,mobileSize:128},l={smoothness:.4,perspective:{fov:40,thresholdClose:1,thresholdFar:8,offsetClose:.25,offsetFar:.5,scale:1},ortho:{fov:5,thresholdClose:5,thresholdFar:20,offsetClose:15,offsetFar:30,scale:4}},c={desktop:n.l1.Edges,floorplan:n.l1.Axes,mobile:n.l1.Edges,alt:n.l1.Free,shift:n.l1.PlanarAxes,shiftAlt:n.l1.EdgesAndPlanarAxes,disabled:n.l1.Free},h={mobile:.15,desktop:.1},d={SCALE:.1,SCALE_NDC:.5,SCALE_ASPECT:.035,SCALE_DISTANCE:.025},u="measurements"},81122:(e,t,i)=>{"use strict";var n;i.d(t,{T:()=>n}),function(e){e[e.FloorplanOnly=0]="FloorplanOnly",e[e.ThreeD=1]="ThreeD"}(n||(n={}))},50294:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>MeasurementDataModule});var n=i(66097),s=i(47724),r=i(26587),o=i(38420),a=i(2212),l=i(81122),c=i(23573);class Measurement extends c.T{constructor(){super(...arguments),this.type=l.T.FloorplanOnly,this.sid="",this.visible=!1,this.version="3.2",this.created=new Date,this.modified=new Date,this.start_position=new a.Vector3,this.end_position=new a.Vector3,this.text="",this.group=-1,this.groupOrder=-1}copy(e){return this.type=e.type,this.sid=e.sid,this.text=e.text,this.visible=e.visible,this.created=e.created,this.modified=e.modified,this.floorId=e.floorId,this.start_position.copy(e.start_position),this.end_position.copy(e.end_position),this.group=e.group,this.groupOrder=e.groupOrder,this.roomId=e.roomId,this.commit(),this}}Measurement.RAYCASTER_GROUP="measurements";var h=i(736),d=i(88512),u=i(26881),p=i(14275),m=i(75256);const g=new d.Z("measure->group"),f=(e,t)=>{if(t?(t.pointGroups.reset(),t.lookup.idToGroup={},t.lookup.groupToIds={},t.lookup.groupCount=0):t={pointGroups:new p.h((0,m.C)([])),lookup:{idToGroup:{},groupToIds:{},groupCount:0}},e.length>0){e.sort(((e,t)=>100*(e.group+1)+e.groupOrder-(100*(t.group+1)+t.groupOrder)));for(const i of e){const e=0===t.pointGroups.groupCount||i.group>=t.pointGroups.groupCount;v(i,t.pointGroups,e,t.lookup)}d.Z.level>=4&&(g.debug("sorce",e.slice().map((e=>`${e.sid},${e.group},${e.groupOrder}`))),g.debug(t.pointGroups.toString()))}return t},v=(e,t,i,n)=>{if(i){const{floorId:i,roomId:s,text:r,type:o,sid:a,visible:l,created:c,modified:h}=e,d={floorId:i,roomId:s,text:r,type:o,sid:a,visible:l,created:c,modified:h};t.startGroup(d),t.push(e.start_position),n.groupCount++}const s=t.groupCount-1;t.push(e.end_position),n.idToGroup[e.sid]=s,n.groupToIds[s]||(n.groupToIds[s]=[]),n.groupToIds[s].push(e.sid)};var y=i(80121),b=i(38330),S=i(99398),E=i(18630),w=i(19674),T=i(85861),_=i(31879);const M=new d.Z("measurement-serialization"),x=e=>{if(!e)return null;const t={};try{if(e)for(const i of Object.keys(e)){const n=e[i];if(!n||!n.version||isNaN(Number.parseFloat(n.version))||Number.parseFloat(n.version)<3)continue;const s="type"in n?n.type:l.T.FloorplanOnly,r=new Measurement,o=void 0!==n.floor&&-1!==n.floor?String(n.floor):"",a=n.room?String(n.room):null;t[n.sid]=r.copy({start_position:(0,w.gj)(n.start_position),end_position:(0,w.gj)(n.end_position),type:s,sid:n.sid,text:n.text||"",visible:n.visible,floorId:o,created:(0,_.p)(n.created),modified:(0,_.p)(n.modified),version:r.version,roomId:a,group:void 0!==n.group?n.group:-1,groupOrder:void 0!==n.groupOrder?n.groupOrder:-1})}}catch(e){return M.debug("Error parsing measurement data;",e),null}return t},A=(e,t)=>{const i={},n=(0,T.p$)(e);(0,T.TS)(n,t);for(const e of Object.keys(n)){const t=n[e];if(!t)continue;i[t.sid]={type:t.type,start_position:(0,w.gj)(t.start_position),end_position:(0,w.gj)(t.end_position),sid:t.sid,text:t.text,visible:t.visible,created:(0,_.U)(t.created),modified:(0,_.U)(t.modified),version:"3.2",group:t.group,groupOrder:t.groupOrder};const s=parseInt(t.floorId,10);isNaN(s)||(i[t.sid].floor=s);const r=parseInt(t.roomId||"",10);isNaN(r)||(i[t.sid].room=r)}return i};function O(e){const{modelId:t,readonly:i}=e,n=e.baseUrl||"",s=e.queue,r=x,o=(e,t)=>{const i=(0,T.p$)(e);(0,T.TS)(i,t);const n={};for(const e of Object.keys(i)){const t=i[e];void 0!==a&&t.type!==a||(n[e]=t)}return A(n,{})};var a;const l=`${n}/api/v1/jsonstore/model/measurements/${t}`;if(i){const e=new b.gh({queue:s,path:l,deserialize:r});return new y.iY({publishStores:[e]})}const c=new b.MU({queue:s,path:l,batchUpdate:!0,deserialize:r,serialize:o}),h=`${n}/api/v1/jsonstore/model/workshopSession/${t}`,d=new E.Z({queue:s,path:h,cachedData:{data:null},deserialize:S.S.sessionObjectExtract(E.j.WS3_Measurements,r),serialize:o},E.j.WS3_Measurements);return new y.iY({publishStores:[c],legacyEditStore:d,editStoreKey:y.aw.MEASUREMENTS})}var P=i(64781),D=i(38003),C=i(84933),I=i(57361),L=i(39729),R=i(21479),N=i(3248);const k=new d.Z("MeasurementData");class MeasurementDataModule extends s.Y{constructor(){super(...arguments),this.name="measurements-data",this.idLookup=new Map,this.tryInferMeshIds=e=>{for(const t in e){const i=e[t];i.type!==l.T.ThreeD&&i.type!==l.T.FloorplanOnly||this.meshQueryModule.inferMeshIdsFromPoint(i,i.start_position)}},this.tryInferGroups=e=>{const t=Object.keys(e);if(t.every((t=>void 0!==e[t].group&&-1!==e[t].group)))return;let i=0,n=0,s=0;const r={},o={},a=new Set,l=e=>`${e.x.toFixed(5)},${e.y.toFixed(5)},${e.z.toFixed(5)}`;for(const c of t){const t=e[c],h=l(t.start_position),d=l(t.end_position);a.has(h)?(n=r[h],s=e[o[h]].groupOrder+1):a.has(d)?(n=r[d],s=e[o[d]].groupOrder+1):(n=i++,s=0),a.has(h)||a.add(h),a.has(d)||a.add(d),r[h]=n,r[d]=n,o[h]=t.sid,o[d]=t.sid,t.group=n,t.groupOrder=s,t.commit()}}}async init(e,t){this.engine=t;const{readonly:i}=e,n=[this.tryInferMeshIds,this.tryInferGroups,this.updateIdLookup.bind(this)],[s,a,l,c,d]=await Promise.all([t.getModuleBySymbol(h.y.MESH_QUERY),t.getModule(r.F),t.market.waitForData(N.af),t.market.waitForData(D.X),t.market.waitForData(R.pu)]);this.config=e,this.meshQueryModule=s,this.measurementModeData=c,this.applicationData=d;const u=l.options.measurements&&l.options.measurements_saved;if(i&&!u)return;this.store=this.configureStorage(this.config);const p=await this.store.read()||{};if(n.forEach((e=>e(p))),this.measurementMap=(0,P.q)(p),!i){const e=new I.c(this.measurementMap,{aggregationType:L.E.NextFrame},t);this.store.addMonitor(e),this.bindings.push(d.onPropertyChanged("application",(()=>this.onApplicationChanged())),a.onSave((()=>this.save()),{dataType:o.g.MEASUREMENTS}),a.onRevert((()=>this.revert()),{dataType:o.g.MEASUREMENTS}))}this.onApplicationChanged()}configureStorage(e){const{modelId:t,baseUrl:i,queue:s,readonly:r}=e;k.info(`Loading Measurements from ${o.Xq.JSONSTORE}`);const a=O({modelId:t,readonly:r,baseUrl:i,queue:s});return new n.N(a,{dataType:o.g.MEASUREMENTS,readonly:r,engine:this.engine})}onApplicationChanged(){const e=this.measurementMap.values.map((e=>(new Measurement).copy(e)));this.engine.commandBinder.issueCommand(new u.d({points:f(e).pointGroups}))}async save(){this.applicationData.application===R.Mx.WORKSHOP&&this.updateMeasurementsFromGroups()}async revert(){this.store instanceof n.N&&await this.store.revert()}updateMeasurementsFromGroups(){const e=new Set(this.measurementMap.keys),t=new Set;for(const e of this.measurementModeData.groups())for(let i=0;i<e.count;i++){const n=e.get(i),s=e.has(i+1)&&e.get(i+1);if(!s)continue;const r=this.idLookup.get(e.info.sid);let o;o=r&&i in r?r[i]:0===i?e.info.sid:(0,C.f)(),t.add(o);const a=(new Measurement).copy({sid:o,start_position:n,end_position:s,floorId:e.info.floorId,roomId:e.info.roomId,group:e.index,groupOrder:i,text:e.info.text,visible:e.info.visible,version:"3.2",type:e.info.type,created:e.info.created,modified:e.info.modified});this.measurementMap.has(o)?this.measurementMap.get(o).copy(a):(k.debug(`Added Measurement ${o} in group ${e.index} (${i})`),this.measurementMap.set(o,a))}for(const i of e)t.has(i)||(k.debug(`Removed Measurement ${i}`),this.measurementMap.delete(i));this.updateIdLookup(this.measurementMap.values)}updateIdLookup(e){const t=Object.values(e).reduce(((e,t)=>(0===t.groupOrder&&(e[t.group]=t.sid),e)),{}),i=Object.values(e).sort(((e,t)=>e.group-t.group||e.groupOrder-t.groupOrder)),n=new Map;for(const e of i){const i=t[e.group];if(void 0===i){k.warn(`Group ${e.group} started with unexpected index ${e.groupOrder}`);continue}const s=n.get(i)||[];s.push(e.sid),n.set(i,s)}this.idLookup=n}onUpdate(e){}}},30060:(e,t,i)=>{"use strict";i.d(t,{b:()=>n});const n="features/measurements-nudge"},58014:(e,t,i)=>{"use strict";i.d(t,{Z:()=>ModelDataLoadedMessage});var n=i(91466);class ModelDataLoadedMessage extends n.v{constructor(e,t,i){super(),this.urls=e,this.sid=t,this.vrSupported=i}}},8445:(e,t,i)=>{"use strict";i.d(t,{T:()=>ModelData});var n=i(32770);class ModelData extends n.V{constructor(e){super(),this.name="model",this.model=e}}},44218:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ModelDataModule});var n=i(47724),s=i(24930),r=i(48602),o=i(38420),a=i(66542),l=i(28883),c=i(68524),h=i(88512),d=i(65006);const u=new h.Z("modelurls");class UrlContainerV3{constructor(){this.version=3,this.baseUrl="",this.expires=0}validate(e){return e.templates&&e.catalog_file&&(!e.expires||1e3*e.expires>Date.now())}update(e){if(!e.templates)throw new Error("No templates found.");return this.baseUrl=e.templates[0],e.expires?this.expires=1e3*e.expires:this.expires=Date.now()+c.Z.signedUrlDefaultExpireTime,Promise.resolve()}get(e){return this.baseUrl&&this.baseUrl.replace("{{filename}}",e)}}class UrlContainerNoop{constructor(){this.version=3,this.baseUrl="",this.expires=0}validate(e){return!0}update(e){return Promise.resolve()}get(e){if(!e.startsWith("http://")&&!e.startsWith("https://"))throw new Error("Tried getting relative model url with no signed urls configured.");return e}}class ModelUrls{constructor(e,t){this.api=e,this.endpoint=t,this.urlContainer=null,this.previousRefreshPromise=null,this.containerClasses=[UrlContainerNoop],t?(this.containerClasses=[UrlContainerV3],this.endpoint=t+"?type=3"):this.urlContainer=new UrlContainerNoop}needsRefresh(){if(null===this.endpoint)return!1;const e=this.urlContainer?this.urlContainer.expires:Date.now();return Date.now()+c.Z.signedUrlRefreshBuffer>e}refresh(){if(!this.needsRefresh())return Promise.resolve();if(!this.previousRefreshPromise){u.debug("Refreshing urls...");const e=this;this.previousRefreshPromise=this._refresh().then((function(){u.debug("Refreshed"),e.previousRefreshPromise=null}),(function(t){u.error("Failed url refresh, urls might go stale soon",t),e.previousRefreshPromise=null}))}return this.previousRefreshPromise}async _refresh(e=!0){const t=this.endpoint?await this.api.get(this.endpoint,{responseType:"json",prefetchFrom:e?"files":void 0,priority:l.RequestPriority.HIGHEST}):null;if(this.urlContainer&&this.urlContainer.validate(t))return this.urlContainer.update(t);for(const e of this.containerClasses){const i=new e;if(i.validate(t))return u.info("Using urls version "+i.version),this.urlContainer=i,this.urlContainer.update(t)}if(e)return this._refresh(!1);throw new Error("missing-urls")}async getSignedUrl(e){if(await this.refresh(),!this.urlContainer)throw new Error("Tried to use ModelUrls.get before urlContainer is established.");const t=this.urlContainer.get(e);if(!t)throw new Error(`Could not get signed URL for path ${e}`);return t}getSignedUrlSync(e){if(this.refresh(),!this.urlContainer)throw new Error("Tried to use ModelUrls.get before urlContainer is established.");const t=this.urlContainer.get(e);if(!t)throw new Error(`Could not get signed URL for path ${e}`);return t}async getFile(e,t,i){const n=e.match(/^https?:/)?e:(0,d.bf)(await this.getSignedUrl(e),i);return this.api.getOnStoreQueue(n,t)}async getImage(e,t,i){const n=e.match(/^https?:/)?e:(0,d.bf)(await this.getSignedUrl(e),i);return this.api.getImage(n,t)}async getImageBitmap(e,t,i,n,s){const r=e.match(/^https?:/)?e:await this.getSignedUrl(e),o=(0,d.bf)(r,s);return this.api.getImageBitmap(o,t,i,n)}}var p,m=i(77680),g=i(8445),f=i(58014),v=i(91985),y=i(94474);!function(e){e.AVAILABLE="available",e.LOCKED="locked",e.UNAVAILABLE="unavailable"}(p||(p={}));var b=i(31879),S=i(71918);class Model{constructor(){this.lastPublished=null}refresh(e){for(const t in this.textures)e.textures[t]&&this.textures[t].refreshFrom(e.textures[t]);this.meshUrls.forEach(((t,i)=>{const n=e.meshUrls[i]&&e.meshUrls[i].url;t.url&&n&&t.url.refreshFrom(n)}))}}const E=new h.Z("mds-snapshot-serializer");class MdsModelDeserializer{deserialize(e){var t;if(!e||!this.validate(e))return E.debug("Deserialized invalid model data from MDS",e),null;const i=e.publication||{},n=i.contact||{},s=e.options,r=new Model;r.sid=e.id,r.organizationId=e.organization||null,r.image=e.image?e.image.id:"",r.details={sid:e.id,name:e.name||"",presentedBy:i.presentedBy||"",summary:i.summary||"",formattedAddress:i.address||"",contact:{email:n.email||"",name:n.name||"",phone:n.phoneNumber||"",formattedPhone:n.phoneNumber||""},externalUrl:i.externalUrl||""},r.options={urlBranding:null===(t=s.urlBrandingEnabled)||void 0===t||t,socialSharing:!!s.socialSharingEnabled,isPublic:!!i.published,isVR:!!s.vrEnabled},i.lastPublished&&(r.lastPublished=(0,b.p)(i.lastPublished,null));const o=e.assets.textures.filter((e=>"high"===e.quality))[0],a=e.assets.textures.filter((e=>"low"===e.quality))[0];r.textures={},o&&(r.textures.high=new m.n(o,(0,b.p)(o.validUntil,null))),a&&(r.textures.low=new m.n(a,(0,b.p)(a.validUntil,null)));const l=this.getDamFileUrls(e);if(!l)throw new Error(`No .dam file found for model ${e.id}`);return r.meshUrls=l,r}validate(e){return["id","assets","publication"].every((t=>t in e))}getDamFileUrls(e){return((0,S.qw)(e,"assets.meshes")||[]).reduce(((e,t)=>{if(t.status===p.AVAILABLE){const i={url:new m.n(t.url,(0,b.p)(t.validUntil,null)),suffix:t.resolution?`_${t.resolution}`:"",extension:t.format||""};"50k"===t.resolution?e.unshift(i):e.push(i)}return e}),[])}}class MdsModelStore extends y.u{constructor(){super(...arguments),this.serializer=new MdsModelDeserializer,this.prefetchKey="data.model"}async read(e){const t={modelId:this.getViewId()};return this.query(v.GetModelDetails,t,e).then((e=>{var t;return this.serializer.deserialize(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)}))}async refresh(){return this.refreshPromise||(this.refreshPromise=this.read({fetchPolicy:"no-cache"}).finally((()=>{this.refreshPromise=void 0}))),this.refreshPromise}}var w=i(46963),T=i(85823),_=i(80693),M=i(38330);class MpWebModelDeserializer{deserialize(e){var t;const i=new Model;return i.sid=e.sid,i.uuid=e.job.uuid,i.image=e.icon||"",i.organizationId=null===(t=e.owner)||void 0===t?void 0:t.group_sid,i.details={sid:e.sid,name:e.name,presentedBy:e.presented_by,summary:e.summary,formattedAddress:this.formatAddress(e.address),contact:{email:e.contact_email,name:e.contact_name,phone:e.contact_phone,formattedPhone:e.formatted_contact_phone},externalUrl:e.external_url},i.options={urlBranding:!0,socialSharing:!!e.enable_social_sharing,isPublic:!!e.is_public,isVR:!!e.is_vr},i}formatAddress(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return""}if(!(e&&(e.address_1||e.address_2||e.city||e.state||e.zip)))return"";const t=[];return e.address_1&&t.push(e.address_1),e.address_2&&t.push(e.address_2),e.city&&(t.length>0&&t.push(", "),t.push(e.city)),e.state&&(t.length>0&&t.push(", "),t.push(e.state)),e.zip&&(t.length>0&&t.push(", "),t.push(e.zip)),t.join("")}}class MpWebModelStore extends T.n{constructor(e){super(e),this.deserializer=new MpWebModelDeserializer}async read(){const{modelId:e}=this.config,t=`/api/v1/player/models/${e}/`;let i;return i=_.t.model?_.t.model:await this.request(M.w$.GET,t),this.deserializer.deserialize(i)}async refresh(){throw new w.n("Model refresh not implemented")}}var x=i(98828),A=i(25138);const O=new h.Z("model-data");class ModelDataModule extends n.Y{constructor(){super(...arguments),this.name="model-data"}async init(e,t){this.engine=t;const{modelId:i,baseUrl:n}=e;this.store=this.getStore(e);const[s,l]=await Promise.all([this.store.read(),t.getModule(a.default)]);if(!s)throw Error("Could not fetch model data");(0,m.s)(s,(async()=>{const e=await this.store.refresh();s.refresh(e)})),this.model=s;const c=new g.T(this.model);t.market.register(this,g.T,c),this.registerSettings(c),t.market.waitForData(r.Q).then((e=>{s.lastPublished&&(e.lastPublished=s.lastPublished.getTime())}));const h=l.getApi(),d=e.storageProvider===o.Xq.JSONSTORE?`${n}/api/player/models/${i}/files`:null;this.signedUrls=new ModelUrls(h,d),this.signedUrls.meshUrls=this.model.meshUrls,t.broadcast(new f.Z(this.signedUrls,this.model.sid,this.model.vrSupported))}async registerSettings(e){const t=await this.engine.getModule(s.default),i="Model Options",{urlBranding:n=!0,socialSharing:r,isPublic:o,isVR:a}=e.model.options||{};t.registerSetting(i,A.Yo,r),t.registerSetting(i,"is_public",o),t.registerSetting(i,"is_vr",a);const l=!n||!!(0,x.h)("brand",!0),c=n?(0,x.h)("mls","0"):"0",h=n?(0,x.h)("title","1"):"1";t.registerSetting(i,A.Zz,"0"!==h&&"2"!==c),t.registerSetting(i,A.DU,"0"!==h&&"2"!==h),t.registerSetting(i,A.L,l),t.registerSetting(i,A.sX,"1"===c||"2"===c)}getSignedUrls(){return this.signedUrls}getStore(e){if(this.store)return this.store;const{modelId:t,baseUrl:i,queue:n}=e,s=e.storageProvider||o.Xq.JSONSTORE,r=!("readonly"in e)||!!e.readonly;return O.info(`Loading model details from ${s}`),s===o.Xq.MDS?new MdsModelStore({readonly:r,baseUrl:i}):new MpWebModelStore({readonly:!0,modelId:t,baseUrl:i,queue:n})}}},25138:(e,t,i)=>{"use strict";i.d(t,{Yo:()=>n,L:()=>s,sX:()=>r,DU:()=>o,Zz:()=>a});const n="social_sharing",s="branding_enabled",r="presentation_mls_mode",o="presentation_title",a="presentation_about"},75351:(e,t,i)=>{"use strict";var n;i.d(t,{S:()=>n}),function(e){e[e.Standard=0]="Standard",e[e.Depth=1]="Depth",e[e.Transparent=2]="Transparent",e[e.Wireframe=3]="Wireframe"}(n||(n={}))},36123:(e,t,i)=>{"use strict";i.d(t,{S:()=>ModelColliderTarget});var n=i(2212);class ModelColliderTarget extends n.Mesh{constructor(){super(...arguments),this.raycastEnabled=!0}}},21922:(e,t,i)=>{"use strict";i.d(t,{g:()=>RoomMesh});var n=i(2212),s=i(84561),r=i(74384),o=i(36123),a=i(48358),l=i(2388);class RoomMesh extends o.S{constructor(e,t,i=s.o.ALL){super(),this.material=[],this._opacity=1,this._chunks=[],this.size=new n.Vector3,this.center=new n.Vector3,this.built=!1,this.layers.mask=i.mask,this.name=`RoomMesh:${e}-${t}`,this.meshGroup=e,this.meshSubgroup=t,this.floorId=String(e),this.roomId=String(t),this.renderOrder=a.z.default}dispose(){this.reset()}reset(){this._chunks.length=0,this.geometry.dispose(),this.built=!1}addChunk(e){-1===this._chunks.indexOf(e)&&this._chunks.push(e)}getChunk(e){return this._chunks[e]}build(){if(this.built)throw new Error("build() should only be called once");if(!this._chunks.length)return;const e=(0,r.q)(this._chunks.map((e=>e.geometry)));e.clearGroups();let t=0;this._chunks.forEach(((i,n)=>{i.geometry&&i.geometry.index&&(e.addGroup(t,i.geometry.index.count,n),t+=i.geometry.index.count,i.geometry.dispose(),i.geometry=e,i.onMaterialUpdate=e=>{this.material[n]=e},i.onOpacityUpdate=e=>{this.opacity=e})})),this.geometry=e,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.material=this._chunks.map((e=>e.material)),this.size=this.boundingBox.getSize(this.size),this.center=this.boundingBox.getCenter(this.center),this.built=!0}get boundingBox(){return(0,r.A)(this.geometry)}set opacity(e){e!==this.opacity&&(this._opacity=e,this.raycastEnabled=e>l.xx.FADE_CLICKABLE_THRESHOLD,this.renderOrder=e<l.xx.FADE_OPAQUE?a.z.ghostFloor:a.z.default)}get opacity(){return this._opacity}get chunks(){return this._chunks}}},80301:(e,t,i)=>{"use strict";var n;i.d(t,{l:()=>n}),function(e){e[e.NONE=0]="NONE",e[e.RAYCAST=1]="RAYCAST"}(n||(n={}))},59167:(e,t,i)=>{"use strict";i.d(t,{n:()=>MeshPreviewSetPositonCommand});var n=i(17386);class MeshPreviewSetPositonCommand extends n.m{constructor(e,t,i){super(),this.id="MESH_PREVIEW_POSITION",this.payload={enabled:e,previewCirclePosition:t,size:i}}}},91670:(e,t,i)=>{"use strict";i.d(t,{U:()=>SetChunkRenderModeCommand});var n=i(17386),s=i(75351);class SetChunkRenderModeCommand extends n.m{constructor(e){super(),this.id="SET_CHUNK_RENDER_MODE",this.payload={mode:e}}}SetChunkRenderModeCommand.modes=s.S},25923:(e,t,i)=>{"use strict";i.d(t,{g:()=>SetMeshOpacityCommand});var n=i(17386);class SetMeshOpacityCommand extends n.m{constructor(e){super(),this.id="SET_MESH_OPACITY",this.payload={value:e}}}},67027:(e,t,i)=>{"use strict";i.d(t,{_:()=>MeshData});var n=i(32770),s=i(2212),r=i(17131),o=i(44283);const a=[-5,-5,-5,5,5,5];class MeshData extends n.V{constructor(e,t=a){super(),this.name="mesh-data",this.bounds=new s.Box3,this.center=new s.Vector3,this.size=new s.Vector3,this._meshGroups={floors:new Set,floorIds:{},rooms:new Map,roomIds:{},roomsByFloor:new Map},this.meshGroupVisuals={floorOpacity:new Map,roomFadeDist:new Map,roomClippingBoxes:new Map},this.meshIdCallbacks=new Set,this.meshSubGroupsFromPoint=e=>{const t=[];for(const[i,n]of this.meshGroups.rooms)n.boundingBox.containsPoint(e)&&t.push(i);return t},this.meshTextureOpacity=new r.z(e),this.bounds.setFromArray(t),this.bounds.getCenter(this.center),this.bounds.getSize(this.size)}get meshGroups(){return this._meshGroups}onMeshIdsUpdated(e){return(0,o.k1)((()=>this.meshIdCallbacks.add(e)),(()=>this.meshIdCallbacks.delete(e)),!0)}setMeshIds(e){var t,i;null===(t=e.roomIdMap)||void 0===t||t.forEach(((e,t)=>{this.meshGroups.roomIds[t]=e})),null===(i=e.floorIdMap)||void 0===i||i.forEach(((e,t)=>{this.meshGroups.floorIds[t]=e}));for(const e of this.meshIdCallbacks.values())e(this)}}},17916:(e,t,i)=>{"use strict";var n;i.d(t,{V:()=>n}),function(e){e[e.Min=0]="Min",e[e.Standard=1]="Standard",e[e.High=2]="High",e[e.Detail=3]="Detail"}(n||(n={}))},57937:(e,t,i)=>{"use strict";var n;i.d(t,{o:()=>n}),function(e){e.DAM="dam",e.TILE="tile"}(n||(n={}))},76863:(e,t,i)=>{"use strict";i.d(t,{T0:()=>r,Pv:()=>o,Nr:()=>a});var n=i(36123);const s=e=>e instanceof n.S,r=e=>s(e),o=e=>s(e)&&e.raycastEnabled&&e.visible,a=e=>{let t=e.visible;t&&e.traverseAncestors((e=>{t&&(t=e.visible)}));return!r(e)&&t||o(e)}},22377:(e,t,i)=>{"use strict";var n;i.d(t,{h:()=>n}),function(e){e.PanoTexture="PANO_TEXTURE",e.PanoTextureTransition="PANO_TEXTURE_TRANSITION",e.MeshTexture="MESH_TEXTURE",e.ColorOverlay="COLOR_OVERLAY",e.MeshPreviewSphere="MESH_PREVIEW_SPHERE",e.Wireframe="WIREFRAME",e.FlatShading="FLAT_SHADING",e.PanoOverlay="PANO_OVERLAY",e.PanoOverlayTransition="PANO_OVERLAY_TRANSITION"}(n||(n={}))},51245:(e,t,i)=>{"use strict";i.d(t,{$4:()=>o});var n=i(21922);const s=e=>!!e&&e instanceof n.g,r=e=>"object"==typeof e&&!!e&&"floorId"in e&&!!e.floorId,o={hasFloorId:r,hasRoomId:e=>r(e)&&"roomId"in e&&!!e.roomId,isRoomMesh:s,matchesFloorId:e=>t=>r(t)&&t.floorId===e,isVisibleRoomMesh:e=>s(e)&&e.raycastEnabled&&e.visible}},93331:(e,t,i)=>{"use strict";i.d(t,{Z:()=>ModelLoadProgressMessage});var n=i(91466);class ModelLoadProgressMessage extends n.v{constructor(e,t){super(),this.loaded=e,this.total=t}}},2388:(e,t,i)=>{"use strict";i.d(t,{ZP:()=>s,AN:()=>r,Lp:()=>o,xx:()=>a});var n=i(98828);const s={flipDownload:(0,n.h)("flipDownload",!0),flipUpload:(0,n.h)("flipUpload",!0),debugLOD:(0,n.h)("debuglod",!1),debugRttQuality:(0,n.h)("debugQuality",!1),debugRttScores:(0,n.h)("debugScores",!1),debugRttClear:(0,n.h)("debuglodrtt",!1),debugPauseTexStream:(0,n.h)("debugPauseStreaming",!1),highQualityDam:(0,n.h)("highqdam",!1)},r="features/mesh-rendering",o="wireframeEnabled",a={FADE_OPAQUE:1,FADE_ABOVE:.024,FADE_BELOW:.1,FADE_CLICKABLE_THRESHOLD:.025,FADE_IN_VALUE:.08,FADE_DEPTH_WRITE_THRESHOLD:(0,n.h)("chunkDepthWrite",.5),FADE_IN_END_ANGLE:45,FADE_IN_START_ANGLE:22,FADE_IN_HOVER_BOOST_VALUE:.2,FADE_BELOW_START:0,FADE_BELOW_MULT:1,DISCARD_FOCAL_MULTI:.125}},56247:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i(20855),s=i(2212),r=i(31090),o=i(69383),a=i(22377);const l={cube:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:(0,n.m)(o,i(54124)),fragmentShader:(0,n.m)(r,i(59253))},blurCube:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1},dir:{type:"v2",value:new s.Vector2(0,0)}},vertexShader:(0,n.m)(o,i(25247)),fragmentShader:(0,n.m)(r,i(84294))},modelChunk:{uniforms:{[a.h.MeshTexture]:{map:{type:"t",value:null},meshOpacity:{type:"f",value:0},opacity:{type:"f",value:1},transparentDiscardDist:{type:"f",value:0}},[a.h.PanoTexture]:{pano0Map:{type:"t",value:null},pano0Position:{type:"v3",value:new s.Vector3},pano0Matrix1:{type:"m4",value:new s.Matrix4},pano0Matrix2:{type:"m4",value:new s.Matrix4},panoOpacity:{type:"f",value:1}},[a.h.PanoTextureTransition]:{progress:{type:"f",value:0},pano1Map:{type:"t",value:null},pano1Position:{type:"v3",value:new s.Vector3},pano1Matrix1:{type:"m4",value:new s.Matrix4},pano1Matrix2:{type:"m4",value:new s.Matrix4}},[a.h.PanoOverlay]:{overlay0Map:{type:"t",value:null},overlay0Matrix:{type:"m4",value:new s.Matrix4}},[a.h.PanoOverlayTransition]:{overlay1Map:{type:"t",value:null},overlay1Matrix:{type:"m4",value:new s.Matrix4}},[a.h.ColorOverlay]:{colorOverlay:{type:"v4",value:null}},[a.h.MeshPreviewSphere]:{meshPreviewCenter:{type:"v3",value:null},meshPreviewSize:{type:"f",value:.3}},[a.h.Wireframe]:{time:{type:"f",value:0},fill:{type:"c",value:new s.Color(16711680)},stroke:{type:"c",value:new s.Color(16777215)},dualStroke:{type:"b",value:!1},fillEnabled:{type:"b",value:!1},insideAltColor:{type:"b",value:!1},thickness:{type:"f",value:.1},secondThickness:{type:"f",value:.1},dashEnabled:{type:"b",value:!1},dashRepeats:{type:"f",value:10},dashOverlap:{type:"b",value:!1},dashLength:{type:"f",value:.1,range:[0,1]},dashAnimate:{type:"b",value:!1},squeeze:{type:"b",value:!1},squeezeMin:{type:"f",value:.1},squeezeMax:{type:"f",value:1},wireframeOpacity:{type:"f",value:1,range:[0,1]}}},vertexShader:(0,n.m)(o,i(57971)),fragmentShader:(0,n.m)(r,i(40933))},modelOutside:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1},colorOverlay:{type:"v4",value:new s.Vector4(0,0,0,0)}},vertexShader:(0,n.m)(o,i(10982)),fragmentShader:(0,n.m)(r,i(96432))},depth:{uniforms:{opacity:{type:"f",value:1},maxDistance:{type:"f",value:20}},vertexShader:(0,n.m)(o,i(27409)),fragmentShader:(0,n.m)(r,i(24074))}}},40324:(e,t,i)=>{"use strict";i.d(t,{S7:()=>a,Pm:()=>h,lT:()=>d,q6:()=>u,t3:()=>p,Oc:()=>m,Bl:()=>g,RQ:()=>f});var n=i(98828),s=i(2212),r=i(17916),o=i(57937);Number((0,n.h)("chunkTileSize",512));var a;!function(e){e[e.LOW=1]="LOW",e[e.MEDIUM=2]="MEDIUM",e[e.HIGH=3]="HIGH",e[e.ULTRA=4]="ULTRA"}(a||(a={}));const l={[a.LOW]:{debugColor:new s.Vector4(1,0,0,.5),textureSize:256,tileSize:256,assetType:"low",assetSize:512,texelSize:.096},[a.MEDIUM]:{debugColor:new s.Vector4(1,1,0,.5),textureSize:512,tileSize:512,assetType:"low",assetSize:512,texelSize:.048},[a.HIGH]:{debugColor:new s.Vector4(0,1,0,.5),textureSize:1024,tileSize:512,assetType:"high",assetSize:2048,texelSize:.024},[a.ULTRA]:{debugColor:new s.Vector4(0,1,1,.5),textureSize:2048,tileSize:512,assetType:"high",assetSize:2048,texelSize:.012}},c=[a.LOW,a.MEDIUM,a.HIGH,a.ULTRA],h=e=>{for(const t in l)if(l[t].textureSize===e)return parseInt(t,10);throw new Error(`Not a valid texture size: ${e}`)},d=(e=o.o.DAM)=>l,u=(e=o.o.DAM,t=r.V.Min)=>c[0],p=(e=o.o.DAM,t=r.V.Detail)=>c[c.length-1],m=(e=o.o.DAM,t=0)=>c,g=(e,t,i)=>{const n=m(t,i);let s=n[0];const r=n[n.length-1],o=n.indexOf(e);return o+1===n.length?r:(-1!==o&&(s=n[o+1%n.length]),s)};function f(e,t,i){const n=m(t,i),s=d(t),r=u(t,i);let o=p(t,i);for(let t=n.length-1;t>=0;t--)e>s[n[t]].texelSize&&o>r&&(o=n[t]);return o}},98811:(e,t,i)=>{"use strict";i.d(t,{P:()=>ModelRatingViewData});var n=i(32770),s=i(48715);class ModelRatingViewData extends n.V{constructor(){super(),this.name="model-rating-view-data",this.isDialogVisible=new s.f(!1),this.setDialogVisible=e=>{this.isDialogVisible.value=void 0!==e?e:!this.isDialogVisible.value}}onDialogVisibleChanged(e){return this.isDialogVisible.onChanged(e)}getIsDialogVisible(){return this.isDialogVisible.value}}},43229:(e,t,i)=>{"use strict";i.d(t,{m:()=>ToggleModelRatingDialogCommand,M:()=>SubmitModelRatingCommand});var n=i(17386);class ToggleModelRatingDialogCommand extends n.m{constructor(e){super(),this.payload={toVisible:e}}}ToggleModelRatingDialogCommand.id="TOGGLE_MODEL_RATING_DIALOG";class SubmitModelRatingCommand extends n.m{constructor(e,t=!1){super(),this.payload={rating:e,didFinish:t}}}SubmitModelRatingCommand.id="SUBMIT_MODEL_RATING"},62627:(e,t,i)=>{"use strict";i.d(t,{E:()=>ModelRatedMessage});var n=i(91466);class ModelRatedMessage extends n.v{constructor(e){super(),this.rating=e}}},87220:(e,t,i)=>{"use strict";i.d(t,{i:()=>n});const n="features/model-rating-dialog"},4901:(e,t,i)=>{"use strict";i.d(t,{u:()=>SetMouseCursorCommand});var n=i(17386);class SetMouseCursorCommand extends n.m{constructor(e=null){super(),this.id="SET_MOUSE_CURSOR",this.payload={cursor:e}}}},14092:(e,t,i)=>{"use strict";var n;i.d(t,{C:()=>n}),function(e){e.NONE="none",e.DEFAULT="default",e.MOVE="move",e.MOVE_LF="col-resize",e.MOVE_UD="row-resize",e.XHAIR="crosshair",e.PLUS="cell",e.QUESTION="help",e.NOPE="not-allowed",e.FINGER="pointer",e.TEXT="text",e.TEXT_VERT="vertical-text",e.ZOOM_IN="zoom-in",e.ZOOM_OUT="zoom-in",e.GRAB="grab",e.GRABBING="grabbing",e.ARROW_R="e-resize",e.ARROW_L="w-resize",e.ARROW_U="n-resize",e.ARROW_D="s-resize",e.ARROW_UR="ne-resize",e.ARROW_UL="nw-resize",e.ARROW_DR="se-resize",e.ARROW_DL="sw-resize",e.ARROW_LR="ew-resize",e.ARROW_UD="ns-resize",e.ARROW_URDL="nesw-resize",e.ARROW_ULDR="nwse-resize"}(n||(n={}))},79355:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Cursor:()=>s.C,SetMouseCursorCommand:()=>r.u,default:()=>MouseCursor});var n=i(47724),s=i(14092),r=i(4901);class MouseCursor extends n.Y{constructor(){super(...arguments),this.name="mouse-cursor",this.activeCursor=null}async init(e,t){this.config=Object.assign({classPrefix:"cursor"},e),this.bindings.push(t.commandBinder.addBinding(r.u,(async e=>this.changeCursor(e.cursor))))}changeCursor(e){const{container:t,classPrefix:i}=this.config;e!==this.activeCursor&&(this.activeCursor&&t.classList.remove(`${i}-${this.activeCursor}`),e&&t.classList.add(`${i}-${e}`),this.activeCursor=e)}}},29422:(e,t,i)=>{"use strict";i.d(t,{ZK:()=>LockNavigationCommand,Lp:()=>UnlockNavigationCommand,Np:()=>NavigateToBox,zs:()=>FocusOnPointInsideCommand,OR:()=>FocusOnPinInsideCommand,ju:()=>NavigateToSweepCommand,Cs:()=>NavigateToLabelCommand});var n=i(17386);class LockNavigationCommand extends n.m{constructor(){super(),this.id="LOCK_NAVIGATION"}}class UnlockNavigationCommand extends n.m{constructor(){super(),this.id="UNLOCK_NAVIGATION"}}class NavigateToBox extends n.m{constructor(e){super(),this.payload=e,this.id="NAVIGATE_TO_BOX"}}class FocusOnPointInsideCommand extends n.m{constructor(e){super(),this.payload=e,this.id="FOCUS_ON_POINT_INSIDE"}}class FocusOnPinInsideCommand extends n.m{constructor(e){super(),this.payload=e,this.id="FOCUS_ON_PIN_INSIDE"}}class NavigateToSweepCommand extends n.m{constructor(e){super(),this.id="MOVE_TO_SWEEP",this.payload=Object.assign({},e)}}class NavigateToLabelCommand extends n.m{constructor(e){super(),this.payload=e,this.id="NAVIGATE_TO_LABEL"}}},29539:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Navigation});var n=i(47724),s=i(33874),r=i(736),o=i(72067),a=i(98828),l=i(59088),c=i(31278),h=i(10613),d=i(19047),u=i(29422),p=i(31102);class NavigationException extends p.y{constructor(e){super(e),this.name="NavigationException"}}const m={Locked:"Cannot move while navigation is locked",InsideOnly:"Cannot navigate between panos when not in Panorama mode",InvalidSweep:"Not at a valid sweep",InTransition:"Cannot move while in a transition",NoDestinationFound:"Cannot move in that direction"};var g=i(35003),f=i(94610),v=i(24764),y=i(25269),b=i(2212),S=i(2725),E=i(76863),w=i(82088),T=i(95586),_=i(4901),M=i(14092),x=i(79553),A=i(73844);class NavigationInputFocus{constructor(e,t,i,n,s,r,o,a,l,c){this.canStartTransition=e,this.commandBinder=t,this.input=i,this.floorsViewData=n,this.navigation=s,this.navigationDollhouse=r,this.sweepData=o,this.cameraModule=a,this.toolsData=l,this.settingsData=c,this.bindings=[],this.cancelTransition=!1,this.didSetCursor=!1,this.targetFloorId=null,this.targetHitPoint=new b.Vector3,this.toggleInput=e=>{this.bindings.forEach((t=>e?t.renew():t.cancel()))},this.onRoomClick=(e,t,i)=>{if(this.shouldIgnore())return;if(!this.canStartTransition())return;if(!i||!i.point)return;const n=this.floorsViewData.floors.getFloorByMeshGroup(t.meshGroup);if(!n)return;if(!this.floorsViewData.isNavigable(n.id))return this.onBackgroundClick();if(this.cancelTransition)return;return 1!==this.floorsViewData.totalFloors&&n.id!==this.floorsViewData.currentFloorId?(this.targetFloorId||(this.targetFloorId=n.id,this.targetHitPoint.copy(i.point)),!1):this.floorsViewData.roomSelectModeActive||this.floorsViewData.floorSelectModeActive?(this.cancelTransition=!0,this.cameraModule.cancelTransition().then((()=>this.navigation.navigateToPanoNearIntersection(i))).then((()=>{this.cancelTransition=!1})),void this.commandBinder.issueCommand(new _.u(M.C.DEFAULT))):void(this.floorsViewData.floorSelectModeActive?this.cancelTransition=!1:this.navigationDollhouse.navigateToPoint(i.point).then((()=>{this.cancelTransition||this.setFocusSweep(i),this.cancelTransition=!1})))},this.onBackgroundClick=()=>{if(!this.shouldIgnore()&&this.canStartTransition()&&!this.cancelTransition){if(this.targetFloorId)return!1;this.cancelTransition=!0,this.cameraModule.cancelTransition().then((()=>this.commandBinder.issueCommand(new S.Vw(null,!1)))).then((()=>{this.cancelTransition=!1}))}},this.onBackgroundHover=()=>{this.shouldIgnore()||null!==this.floorsViewData.currentFloorId&&this.toolsData.activeToolName!==x.w1.LABELS&&(this.didSetCursor=!0,this.commandBinder.issueCommand(new _.u(M.C.FINGER)))},this.onBackgroundUnhover=()=>{this.shouldIgnore()||this.didSetCursor&&(this.commandBinder.issueCommand(new _.u(M.C.DEFAULT)),this.didSetCursor=!1)},this.onFloorChange=()=>{this.shouldIgnore()||null===this.floorsViewData.currentFloorId&&this.commandBinder.issueCommand(new _.u(M.C.DEFAULT))},this.clearFloorChange=()=>{this.targetFloorId=null},this.changeFloorIfNeeded=async()=>{this.targetFloorId&&(await this.commandBinder.issueCommand(new S.Vw(this.targetFloorId,!1,void 0,this.targetHitPoint)),this.targetFloorId=null)},this.bindings.push(this.input.registerMeshHandler(g.R,v.s.is(E.Pv),this.onRoomClick),this.input.registerUnfilteredHandler(g.R,this.clearFloorChange),this.input.registerHandler(g.R,this.changeFloorIfNeeded),this.input.registerMeshHandler(g.R,v.s.isType(y.i),this.onBackgroundClick),this.input.registerMeshHandler(f.z,v.s.isType(y.i),this.onBackgroundHover),this.input.registerMeshHandler(f.A,v.s.isType(y.i),this.onBackgroundUnhover),this.floorsViewData.makeFloorChangeSubscription(this.onFloorChange))}async setFocusSweep(e){if(!this.canStartTransition())return;if(this.cancelTransition)return;const t=(0,w.bG)(this.sweepData,!1,e);t.length>0&&t[0].sweep&&await this.commandBinder.issueCommand(new T.aK(t[0].sweep.id))}shouldIgnore(){return!this.settingsData.tryGetProperty(A.Q5,!1)}}var O=i(12216),P=i(81507),D=i(81040),C=i(88727),I=i(88216),L=i(36123),R=i(76870),N=i(88512);const k=new N.Z("nav-input");class NavigationInputInside{constructor(e,t,i){this.navigation=e,this.inputIni=t,this.insideNav=[],this.insideVrNav=[],this.toggleInput=e=>{this.insideNav.forEach((t=>e?t.renew():t.cancel()))},this.toggleVrInput=e=>{this.insideVrNav.forEach((t=>e?t.renew():t.cancel()))},this.registerInsideClickHandlers=e=>[e.registerMeshHandler(g.R,v.s.is(E.Pv),((e,t,i)=>this.tryExecuteAction(((e,t)=>V(e)&&B(t)),((e,t)=>B(t)&&this.navigation.navigateTowardsIntersection(t)),e,i))),e.registerMeshHandler(g.R,v.s.isType(y.i),((e,t,i)=>this.tryExecuteAction(((e,t)=>V(e)&&B(t)),((e,t)=>B(t)&&this.navigation.navigateTowardsIntersection(t)),e,i)))],this.registerVrClickHandlers=e=>[e.registerMeshHandler(g.R,v.s.isInstanceOf(L.S),((e,t,i)=>this.tryExecuteAction(((e,t)=>V(e)&&B(t)),((e,t)=>B(t)&&this.navigation.navigateToPanoNearIntersection(t)),e,i)))],this.registerWheelInput=e=>[e.registerHandler(D.a,(e=>this.tryExecuteAction((e=>!0),(e=>{if(e instanceof D.a){const t=new b.Vector3(0,0,Math.sign(e.delta.y));return!!this.navigation.navigateInLocalDirection(t)}return!1}),e)))],this.hotkeys=e=>[e.registerHandler(C.e,(e=>this.tryExecuteAction((e=>(F(e)||U(e))&&e.key in NavigationInputInside.hotkeyDirections),(e=>{if(F(e)){this.continuousMovementHotkey=e.key;const t=NavigationInputInside.hotkeyDirections[e.key];this.navigation.setContinuousNavigationLocalDirection(t)}else U(e)&&e.key===this.continuousMovementHotkey&&this.navigation.setContinuousNavigationLocalDirection();return!1}),e)))],this.tryExecuteAction=(e,t,i,n)=>{let s=!1;try{this.navigation.isNavigationInputAllowed()&&e(i,n)&&(s=t(i,n))}catch(e){if(!(e instanceof NavigationException))throw k.warn(e),e;k.debug(e)}return s},this.insideVrNav.push(...this.registerVrClickHandlers(this.inputIni)),this.insideNav.push(...this.registerInsideClickHandlers(this.inputIni),...this.hotkeys(this.inputIni)),i&&this.insideNav.push(...this.registerWheelInput(this.inputIni))}get bindings(){return[...this.insideNav,...this.insideVrNav]}}function B(e){return void 0!==e&&void 0!==e.point}function F(e){return e instanceof C.e&&e.state===I.M.DOWN}function U(e){return e instanceof C.e&&e.state===I.M.UP}function V(e){return e instanceof g.R&&e.button===R.MP.PRIMARY}NavigationInputInside.hotkeyDirections={[P.R.W]:O.f.FORWARD,[P.R.A]:O.f.LEFT,[P.R.S]:O.f.BACK,[P.R.D]:O.f.RIGHT,[P.R.UPARROW]:O.f.FORWARD,[P.R.DOWNARROW]:O.f.BACK};const H=new N.Z("nav-input");class NavigationInputOutside{constructor(e,t,i){this.navigation=e,this.input=t,this.settings=i,this.bindings=[],this.toggleInput=e=>{H.debug("toggling dollhouse input",e),this.bindings.forEach((t=>e?t.renew():t.cancel()))},this.bindings.push(...this.registerEnterPanoHandler())}registerEnterPanoHandler(){return[this.input.registerMeshHandler(g.R,v.s.isInstanceOf(L.S),((e,t,i)=>!this.settings.tryGetProperty(A.Q5,!1)&&(!!this.navigation.isNavigationInputAllowed()&&(e.button===R.MP.PRIMARY&&void 0!==i&&this.navigation.navigateToPanoNearIntersection(i)))))]}}var G=i(75892),z=i(3805),W=i(35597),j=i(94329),K=i(3506),q=i(77719),Z=i(27326),Y=i(17399),$=i(56656),Q=i(24151),X=i(93263),J=i(7170),ee=i(69626),te=i(39455),ie=i(64185);class NavigationDollhouse{constructor(e,t,i){this.canStartTransition=e,this.pose=t,this.cameraModule=i,this.navigateToPoint=async e=>{if(!this.canStartTransition())return;const t=this.pose.focalDistance,i=(0,ee.fd)(this.pose.rotation,e,t);await this.cameraModule.cancelTransition(),await this.cameraModule.moveTo({pose:{position:i},transitionType:c.n.Interpolate,focalDistance:t,transitionTime:te.E.TRANSITION_TIME_DH})},this.navigateToBox=e=>{if(!this.canStartTransition())return ie.Q.resolve();const{position:t,rotation:i,focalDistance:n}=this.getPoseForBox(e);return this.cameraModule.moveTo({pose:{position:t,rotation:i},transitionType:c.n.Interpolate,focalDistance:n,transitionTime:te.E.TRANSITION_TIME_DH})},this.getPoseForBox=e=>{const t=e.getCenter(new b.Vector3),i=e.getSize(new b.Vector3),n=i.z>i.x;let s=this.pose.rotation;s=n?s.angleTo(ne.LANDSCAPE_LEFT)>s.angleTo(ne.LANDSCAPE_RIGHT)?ne.LANDSCAPE_LEFT:ne.LANDSCAPE_RIGHT:s.angleTo(ne.PORTRAIT_RIGHT)>s.angleTo(ne.PORTRAIT_LEFT)?ne.PORTRAIT_LEFT:ne.PORTRAIT_RIGHT;const r=-85*J.Ue,o=2*Math.atan(1/this.pose.projection.elements[5]),a=(0,ee.YN)(t,s,r,e,1.2*o,this.pose.aspect()),l=t.distanceTo(a.position);return{position:a.position,rotation:a.rotation,focalDistance:l}}}}const ne={LANDSCAPE_LEFT:(new b.Quaternion).setFromAxisAngle(O.f.UP,45*J.Ue),LANDSCAPE_RIGHT:(new b.Quaternion).setFromAxisAngle(O.f.UP,-45*J.Ue),PORTRAIT_LEFT:(new b.Quaternion).setFromAxisAngle(O.f.UP,25*J.Ue),PORTRAIT_RIGHT:(new b.Quaternion).setFromAxisAngle(O.f.UP,-25*J.Ue)};var se=i(51263),re=i(57051),oe=i(19674),ae=i(27687),le=i(45870);const ce=!0,he=8,de=.1,ue=25,pe=500;class NavigationPoint{constructor(e,t,i,n,s){this.engine=e,this.cameraData=t,this.sweepData=i,this.viewmodeModule=n,this.raycaster=s,this.tryNavigateToPoint=async(e,t,i,n)=>{const s=[],r=[];if(s.push(se._T()),s.push(se._k()),t===c.n.Interpolate&&this.viewmodeModule.currentMode===j.Ey.Panorama&&this.sweepData.currentSweep){const t=.5,i=this.sweepData.currentSweep,n=this.sweepData.getSweep(i),o=n.position.clone().sub(e).normalize();s.push(se.pI(e,o,t)),s.push(se.T3(n)),r.push(re.o7(e,o))}s.push(this.withinLatitudeFilter(e)),s.push(this.notTooCloseFilter(e)),s.push(this.notTooFarFilter(e));r.push(re.Dv(e,-2));const o=this.sweepData.sortByScore(s,r),a=new b.Vector3;let l=null,h=!1,d=null;for(const s of o)if(this.sweepCanSeeNote(e,s.sweep)){if(d=s.sweep,t===c.n.Interpolate){a.copy(e).sub(d.position).normalize(),h=!0;const s=this.getSweepToPointRotation(d.position,e,n),r=this.cameraData.pose.projection.asThreeMatrix4(),{width:o,height:p}=this.cameraData,m=(0,ae.bD)(e,d.position,s,o,p,r);i&&i(m),l=this.viewmodeModule.currentMode!==j.Ey.Panorama?this.viewmodeModule.switchToMode(j.Ey.Panorama,t,{rotation:s,sweepID:d.id}):this.commandBinder.issueCommand(new u.ju({transition:t||c.n.Interpolate,sweep:d.id,rotation:s}))}break}return!(!d||!h&&t===c.n.Interpolate)&&(l||(l=this.engine.commandBinder.issueCommand(new u.ju({transition:t,transitionTime:pe,sweep:d.id,rotation:this.getSweepToPointRotation(d.position,e,n)}))),l&&await l,!0)},this.getSweepToPointRotation=(e,t,i)=>{const n=(0,ee.n0)(e,t);return i&&n.multiply(i),(0,oe.Z)(n)},this.notTooCloseFilter=e=>t=>Math.abs(t.position.x-e.x)>de||Math.abs(t.position.z-e.z)>de,this.notTooFarFilter=e=>t=>{if(!ce){return t.position.distanceTo(e)>he}return!0},this.withinLatitudeFilter=e=>t=>{const i=(new b.Vector3).copy(e).sub(t.position),n=-Math.atan(i.y/Math.sqrt(i.x*i.x+i.z*i.z)),s=(0,J.Id)(ue);return le.zf-s<n&&n<le.uQ+s},this.commandBinder=e.commandBinder}async focusPin(e,t,i,n){const{anchorPosition:s,stemNormal:r,stemLength:o}=e,a=s.clone().add(r.clone().setLength(o));return this.focusPoint(a,t,i,n)}async focusPoint(e,t,i,n){if(this.cameraData.canTransition()&&this.sweepData.canTransition()&&!await this.tryNavigateToPoint(e,t,i,n)){if(t!==c.n.Interpolate)return this.goToNearestSweep(e,t,i,n);try{await this.commandBinder.issueCommand(new z._i(z.BD.DOLLHOUSE,c.n.Interpolate))}catch(s){await this.goToNearestSweep(e,t,i,n)}await this.tryNavigateToPoint(e,t,i,n)||await this.goToNearestSweep(e,t,i,n)}}async goToNearestSweep(e,t,i,n){const s=e,r=this.sweepData.getClosestSweep(s,!0);if(!r)throw new Error("Cannot find sweep closest to Mattertag disc");const o=this.getSweepToPointRotation(r.position,s,n),a=this.cameraData.pose.projection.asThreeMatrix4(),{width:l,height:h}=this.cameraData,d=(0,ae.bD)(s,r.position,o,l,h,a);i&&i(d),await this.commandBinder.issueCommand(new u.ju({sweep:r.id,rotation:o,transition:t||c.n.Interpolate}))}sweepCanSeeNote(e,t){const i=(new b.Vector3).copy(e).sub(t.position),n=i.length();i.normalize();let s=this.raycaster.picking.pick(t.position,i,E.Pv);return(!s||s.distance>n)&&(s=this.raycaster.picking.pick(e,i.negate(),E.Pv)),!s||n<=s.distance}}var me=i(76701),ge=i(23573);class DynamicNumber extends ge.T{constructor(e=1,t=0){super(),this._slowdown=!0,this._initialSpeed=0,this._speed=0,this._acceleration=1,this._maxSpeed=1,this._minSpeed=.05,this._startValue=0,this._value=0,this._endValue=e,this._delay=t}get active(){return this._active}get currentValue(){return this._value}get endValue(){return this._endValue}get speed(){return this._speed}get isSlowingDown(){return this._isSlowingDown}get maxSpeed(){return this._maxSpeed}get acceleration(){return this._acceleration}getProgressPercent(){return(this._value-this._startValue)/(this._endValue-this._startValue)}onComplete(e){return this._onComplete=e,this}setStartValue(e){return this._startValue=e,this}setCurrentValue(e){return this._value=e,this}setEndValue(e){return this._endValue=e,this}setInitialSpeed(e){return this._initialSpeed=e,this}setMaxSpeed(e){return this._maxSpeed=e,this}activate(e){return this._active=e,this}setAccel(e){return this._acceleration=e,this}start(){this._active=!0,this._value=this._startValue,this._speed=this._initialSpeed}setSlowdown(e){return this._slowdown=e,this}tick(e){if(!this._active||e<=0)return;if(this._delay>0)return void(this._delay-=e);e>33&&(e=33);const t=.001*e,i=this._value,n=this._speed*t,s=(0,oe.r_)(i,this.endValue,n),r=this._endValue-i<=this.getSlowdownDistance(),o=this._slowdown&&r,a=o?this._minSpeed:this._maxSpeed,l=this.acceleration*t;return this._speed=(0,oe.r_)(this._speed,a,l),this._isSlowingDown=o,this._value=s,s===this.endValue?(this.activate(!1),this.commit(),void(this._onComplete&&this._onComplete())):void 0}getSlowdownDistance(){const e=this.speed,t=this._acceleration,i=e/(0===t?1e-5:t);return this.speed*i+.5*t*i*i}stop(e){this._active=!1,this._endValue=e,this.commit()}}const fe=new N.Z("walk");class NavigationWalking{constructor(e,t,i,n,s,r){this.cameraPose=e,this.sweepTransition=t,this.sweepControl=i,this.cameraControl=n,this.generators=s,this.navigation=r,this.active=!1,this.path=[],this.lastQueueTime=0,this.repeatedQueueDelayMS=150,this.positionTracker=(new DynamicNumber).setAccel(15).setMaxSpeed(5)}get isActive(){return this.active}get targetSweep(){return this.nextSweep}setContinuousMovementDirection(e){this.continuousMovementDirection=e,!this.active&&e&&this.navigation.navigateInLocalDirection(e)}stop(){this.path.length=0,this.cameraControl.endExternalTransition(),this.startingSweep=void 0,this.nextSweep=void 0,this.active=!1,this.generator&&(this.generators.stopGenerator(this.generator),this.generator=null)}appendNode(e,t){if(!this.canQueueSweeps(e))return Promise.resolve();if(!e)return Promise.resolve();if(this.path.push(e),this.lastQueueTime=Date.now(),!this.active){this.startingSweep=t;const{generator:e,deferred:i}=this.createTransition();this.generators.startGenerator(e),this.generator=e,this.activePromise=i.nativePromise().then((()=>{this.activePromise=null}))}return this.activePromise?this.activePromise:Promise.resolve()}canQueueSweeps(e){if(e&&this.path.indexOf(e)>=0)return!1;return!(this.path.length>=2)&&!(this.active&&Date.now()-this.lastQueueTime<this.repeatedQueueDelayMS)}attemptContinuousNavigation(){try{this.continuousMovementDirection&&this.navigation.navigateInLocalDirection(this.continuousMovementDirection)}catch(e){if(!(e instanceof NavigationException))throw fe.warn(e),e;fe.debug(e)}}createTransition(){const e=this,t=new ie.Q;return{generator:function*(){e.active=!0;let i=Date.now();e.cameraControl.beginExternalTransition();const n=(new b.Vector3).copy(e.cameraPose.position),s=new b.Vector3,r=new b.Vector3,o=e.positionTracker;for(;e.path.length>0;){const t=e.nextSweep?e.nextSweep.id:e.startingSweep,a=e.path.shift();if(!a){e.nextSweep=void 0;break}e.nextSweep=a,n.copy(e.cameraPose.position);const l=n.distanceTo(a.position);for(o.setStartValue(0).setEndValue(l).setInitialSpeed(o.speed).activate(!0),r.subVectors(a.position,n),r.normalize(),yield new me.M8(e.sweepControl.activateSweepUnsafe({sweepId:a.id})),e.sweepControl.beginSweepTransition({sweepId:a.id,internalProgress:!1,prevSweepId:t}),o.start();o.active;){const t=Date.now()-i,l=0===e.path.length;let c=!1,h=!1;if(!l){const t=e.path[0];c=o.endValue-o.currentValue+a.position.distanceTo(t.position)<o.getSlowdownDistance();const i=s.subVectors(t.position,a.position);i.normalize();r.dot(i)<.3&&(h=!0)}o.setSlowdown(l||c||h),o.tick(t);const d=o.getProgressPercent();e.cameraControl.updateCameraPosition(s.lerpVectors(n,a.position,d)),e.sweepTransition.progress.modifyAnimation(d,1,0),i=Date.now(),e.continuousMovementDirection&&e.canQueueSweeps()&&o.isSlowingDown&&e.attemptContinuousNavigation(),o.active&&(yield new me.Jj)}e.sweepControl.endSweepTransition({sweepId:a.id,prevSweepId:t})}t.resolve(),e.stop()},deferred:t}}}var ve=i(79437),ye=i(3248);class NavigationLabel{constructor(e,t,i,n,s,r,o){this.engine=e,this.settingsData=t,this.cameraData=i,this.cameraModule=n,this.viewmodeData=s,this.floorsViewData=r,this.toolsData=o}async enforceLabelEditorFriendlyViewmode(e){var t;let i=this.settingsData.tryGetProperty(A.Q5,!1)&&this.viewmodeData.isDollhouse();this.toolsData.activeToolName!==x.w1.LABELS&&(i&=this.settingsData.tryGetProperty(ye.gx.LabelsDollhouse,!0));let n=!0;if(await(null===(t=this.cameraData.transition.promise)||void 0===t?void 0:t.nativePromise()),!this.viewmodeData.isFloorplan()&&!i)try{await this.engine.commandBinder.issueCommand(new z._i(z.BD.FLOORPLAN,c.n.Interpolate))}catch(e){n=!1}return(e&&e!==this.floorsViewData.currentFloorId||null===this.floorsViewData.currentFloorId)&&await this.engine.commandBinder.issueCommand(new S.Vw(e||this.floorsViewData.getHighestVisibleFloorId())),n}async navigateToLabel(e){const t=await this.enforceLabelEditorFriendlyViewmode(e.floorId);return this.viewmodeData.isFloorplan()?await this.panToLabelFloorplan(e.position):this.viewmodeData.isDollhouse()&&await this.panToLabelDollhouse(e.position),t}async panToLabelDollhouse(e){this.cameraModule.canTransition()||await this.cameraModule.cancelTransition();const t=new b.Box3;t.setFromCenterAndSize(new b.Vector3(0,1,0).add(e),new b.Vector3(4,4,4)),await this.engine.commandBinder.issueCommand(new u.Np({box:t}))}async panToLabelFloorplan(e){this.cameraModule.canTransition()||await this.cameraModule.cancelTransition();const t=new b.Plane,i=new b.Vector3(0,0,1).applyQuaternion(this.cameraData.pose.rotation),n=e;t.setFromNormalAndCoplanarPoint(i,n);const s=(0,ee.Fe)(this.cameraData.pose.position,this.cameraData.pose.rotation,t);if(!s)return;const r=(new b.Vector3).copy(n).sub(s),o=(new b.Vector3).copy(this.cameraData.pose.position).add(r);await this.cameraModule.moveTo({transitionType:c.n.Interpolate,pose:{position:o},transitionTime:1e3,easing:ve.hl})}}const be=new N.Z("navigation");class Navigation extends n.Y{constructor(){super(...arguments),this.name="navigation",this.navigationEnabled=!0,this.inputOutside=[],this.navigationRules=[()=>!0],this.addNavigationRule=e=>{-1===this.navigationRules.indexOf(e)&&this.navigationRules.push(e)},this.removeNavigationRule=e=>{const t=this.navigationRules.indexOf(e);-1!==t&&this.navigationRules.splice(t,1)},this.isNavigationInputAllowed=()=>{const e=this.navigationRules.reduce(((e,t)=>e&&t()),!0);return!(!this.navigationEnabled||!e)||(be.debug("Cannot move while navigation is locked",{blockedByRules:!e,blockedByCommand:!this.navigationEnabled}),!1)}}async init(e,t){this.commandBinder=t.commandBinder,this.bindings.push(this.commandBinder.addBinding(u.ZK,(async()=>this.lockNavigation())),this.commandBinder.addBinding(u.Lp,(async()=>this.unlockNavigation())),this.commandBinder.addBinding(u.Np,(async e=>this.navigateToBox(e.box))),this.commandBinder.addBinding(u.zs,(async e=>{const{focusPosition:t,transition:i,orientationAdjust:n,onSweepChosen:s}=e;return this.navigationPoint.focusPoint(t,i,s,n)})),this.commandBinder.addBinding(u.OR,(async e=>{const{pinPosition:t,transition:i,orientationAdjust:n,onSweepChosen:s}=e;return this.navigationPoint.focusPin(t,i,s,n)})),this.commandBinder.addBinding(u.ju,(e=>this.navigateToSweep(e.sweep,e.rotation,e.transition,e.transitionTime,e.transitionSpeedMultiplier))),this.commandBinder.addBinding(u.Cs,(async({position:e,floorId:t,viewmodeOnly:i})=>i?this.navigationLabel.enforceLabelEditorFriendlyViewmode():!(!e||!t)&&this.navigationLabel.navigateToLabel({position:e,floorId:t})))),[this.settingsData,this.sweepData,this.sweepModule,this.viewmodeData,this.viewmodeModule,this.cameraData,this.cameraModule,this.interactionmodeData]=await Promise.all([t.market.waitForData(s.e),t.market.waitForData(G.Z),t.getModule($.default),t.market.waitForData(W.O),t.getModule(X.default),t.market.waitForData(l.M_),t.getModule(q.default),t.market.waitForData(d.Z)]);const[i,n,c]=await Promise.all([t.getModule(Y.default),t.market.waitForData(Q.t),t.market.waitForData(Z.c)]);this.navigationPoint=new NavigationPoint(t,this.cameraData,this.sweepData,this.viewmodeModule,i),this.navigationLabel=new NavigationLabel(t,this.settingsData,this.cameraData,this.cameraModule,this.viewmodeData,c,n);const h=await t.getModuleBySymbol(r.y.INPUT);this.inputOutside.push(new NavigationInputOutside(this,h,this.settingsData));const p=()=>this.isNavigationInputAllowed()&&this.viewmodeData.canStartTransition()&&!c.transitionActive&&this.sweepData.canTransition(),m=()=>p()&&(this.viewmodeData.isDollhouse()||this.viewmodeData.isFloorplan());this.navigationDollhouse=new NavigationDollhouse(m,this.cameraData.pose,this.cameraModule),this.inputOutside.push(new NavigationInputFocus(m,t.commandBinder,h,c,this,this.navigationDollhouse,this.sweepData,this.cameraModule,n,this.settingsData)),this.inputInside=new NavigationInputInside(this,h,!!e.enableWheel),this.inputOutside.forEach((e=>this.bindings.push(...e.bindings))),this.bindings.push(...this.inputInside.bindings),this.updateInputBindings(),this.bindings.push(this.viewmodeData.makeModeChangeSubscription((()=>{this.viewmodeData.currentMode!==j.Ey.Transition&&this.updateInputBindings()}))),this.navigationWalk=new NavigationWalking(this.cameraData.pose,this.sweepData.transition,this.sweepModule,this.cameraModule,t,this),(0,a.h)("debug","")&&o.Z.load(o.Z.menus.Navigation,t)}updateInputBindings(){const e=this.interactionmodeData.isVR(),t=this.viewmodeData.isPano();this.inputInside.toggleInput(t&&!e),this.inputInside.toggleVrInput(t&&e),this.inputOutside.forEach((e=>e.toggleInput(!t)))}navigateInLocalDirection(e){const t=this.cameraData.pose.rotation;return this.navigateInDirection(e.clone().applyQuaternion(t))}setContinuousNavigationLocalDirection(e){this.navigationWalk.setContinuousMovementDirection(e)}navigateTowardsIntersection(e){return!!this.navigateInDirection(e.point.clone().sub(this.cameraData.pose.position))}navigateToPanoNearIntersection(e){const t=(0,w.bG)(this.sweepData,this.viewmodeData.isPano(),e),i=t.length>0?t[0].sweep:this.sweepData.getClosestSweep(e.point,!0),n=h.y[this.interactionmodeData.mode];if(this.viewmodeData.isPano()&&i)return this.navigateToSweep(i.id,void 0,n),!0;if(this.viewmodeData.canSwitchViewMode(j.Ey.Panorama)){const e=i?i.id:void 0;return this.commandBinder.issueCommand(new z._i(z.BD.INSIDE,n,{sweepID:e})),!0}return!1}navigateInDirection(e){if(!this.viewmodeData.isPano())throw new NavigationException(m.InsideOnly);if(!this.sweepData.currentSweep)throw new NavigationException(m.InvalidSweep);const t=h.y[this.interactionmodeData.mode],i=(0,w.Tq)(this.sweepData,e,this.navigationWalk.isActive?.65:void 0,this.navigationWalk.isActive?this.navigationWalk.targetSweep:void 0);if(i.length>0&&i[0].sweep)return this.navigateToSweep(i[0].sweep.id,void 0,t);throw new NavigationException(m.NoDestinationFound)}async navigateToBox(e){return this.navigationDollhouse.navigateToBox(e)}lockNavigation(){this.navigationEnabled=!1,be.debug("Navigation input locked")}unlockNavigation(){this.navigationEnabled=!0,be.debug("Navigation input unlocked")}async navigateToSweep(e,t,i,n,s){const r=this.settingsData.tryGetProperty(K.gj,c.n.Interpolate);let o;void 0===i&&(i=r);const a=this.sweepData.currentSweep;if(i===c.n.Interpolate){const t=!a||this.sweepData.isSweepAligned(a),n=this.sweepData.isSweepAligned(e),s=a!==e,r=!t||!n,o=this.viewmodeData.currentMode===j.Ey.Panorama;s&&r&&o&&(i=c.n.FadeToBlack)}if(this.viewmodeData.currentMode!==j.Ey.Panorama)o=this.viewmodeModule.switchToMode(j.Ey.Panorama,i,{sweepID:e,rotation:t});else{const r=void 0===t&&void 0===n&&void 0===s,a=this.cameraData.canTransition()&&this.sweepData.canTransition();if(i===c.n.Interpolate&&this.sweepData.currentSweep!==e&&r&&(a||this.navigationWalk.isActive)){const t=this.sweepData.getSweep(e);o=this.navigationWalk.appendNode(t,this.sweepData.currentSweep)}else{if(!a)return this.sweepData.currentSweep;o=this.sweepModule.moveToSweep({transitionType:i,sweepId:e,rotation:t,transitionTime:n,transitionSpeedMultiplier:s})}}return await o,this.sweepData.currentSweep}}},39455:(e,t,i)=>{"use strict";i.d(t,{E:()=>n});const n={longerTransitionMaxDist:10,TRANSITION_TIME_DH:650}},82088:(e,t,i)=>{"use strict";i.d(t,{Tq:()=>a,bG:()=>c});var n=i(51245),s=i(51263),r=i(57051),o=i(39455);const a=(e,t,i,n,...s)=>l({sweepData:e,direction:t,directionFactor:i,sourceSweep:n,ignoreSweeps:s}),l=e=>{const{sweepData:t,direction:i,sourceSweep:n,ignoreSweeps:o,directionFactor:a}=e;if(!t.currentSweepObject)return[];const l=n||t.currentSweepObject,c=[s.ff(l),s._k(),s.vO(l),s.pI(l.position,i,a)];for(const e of o)c.push(s.ff(e));const h=[r.o7(l.position,i),r.TE(l.position)],d=t.getSweepNeighbours(l);return t.sortByScore(c,h,d)},c=(e,t,i)=>{const a=[s._k(),s._T()],l=[r.Dv(i.point)],c=e.currentSweepObject;t&&c&&a.push(s.ff(c),s.SF(c.position,o.E.longerTransitionMaxDist),s.vO(c)),i.face&&a.push(s.D5(i.point,i.face.normal)),n.$4.hasFloorId(i.object)&&l.push(r.Bv(i.object.floorId));const h=e.sortByScore(a,l);if(0===h.length){const t=e.getClosestSweep(i.point,!0);h.push({sweep:t,score:0})}return h}},39950:(e,t,i)=>{"use strict";i.d(t,{c:()=>HashtagData});var n=i(32770),s=i(75256);class HashtagData extends n.V{constructor(){super(...arguments),this.name="hashtag-data",this.hashtags=(0,s.C)([])}addHashtags(e){this.atomic((()=>{e.forEach((e=>{this.addHashtag(e)}))})),this.commit()}addHashtag(e){const t=e.trim().toLowerCase();-1===this.hashtags.map((e=>e.trim().toLowerCase())).indexOf(t)&&this.hashtags.push(e)}getHashtags(){return this.hashtags.values()}}},8752:(e,t,i)=>{"use strict";var n;i.d(t,{U:()=>n}),function(e){e.CLOSED="closed",e.IDLE="idle",e.CREATING="creating",e.OPENING="opening",e.OPEN="open",e.EDITING="editing"}(n||(n={}))},92824:(e,t,i)=>{"use strict";i.d(t,{X:()=>NotesViewData});var n=i(32770),s=i(48715),r=i(75256),o=i(44574),a=i(15881),l=i(8752),c=i(84834);class NotesViewData extends n.V{constructor(e,t,i,n){super(),this.data=e,this.textParser=t,this.backgroundTexture=i,this.maskTexture=n,this.name="notes-view-data",this.notes=(0,r.C)([]),this.annotationViews=(0,r.C)([]),this.creatingNewNote=!1,this.openNoteViewObservable=(0,s.Y)(null),this.listIndexObservable=(0,s.Y)(-1),this.activeAnnotationObservable=(0,s.Y)(null),this.notesPhaseObservable=(0,s.Y)(l.U.CLOSED),this.notesFilterObservable=(0,s.Y)(c.$.OPEN),this.updateViewData(null)}getNotesList(){return this.notes}onNotesChanged(e){return this.notes.onChanged(e)}getNoteView(e){const t=this.notes.findIndex((t=>t.id===e));return-1!==t?this.notes.get(t):null}getTextParser(){return this.textParser}getComment(e,t){const i=this.getNote(e);return(null==i?void 0:i.comments.find((e=>e.id===t)))||null}getAttachment(e,t,i){var n;const s=(null===(n=this.getNote(e))||void 0===n?void 0:n.comments.find((e=>e.id===t)))||null;return(null==s?void 0:s.attachments.find((e=>e.id===i)))||null}updateViewData(e){const t=[];this.data.iterate((e=>{var i;const n=this.createNoteView(e);t.push(n),(null===(i=this.openNoteView)||void 0===i?void 0:i.id)===n.id&&this.setOpenNoteView(n)})),this.notes.replace(t);const i=this.getFilteredNotes(),n=e?this.getAnnotationSearchResults(i,e):this.getNoteAnnotations(i);this.annotationViews.replace(n.sort(((e,t)=>t.createdTime-e.createdTime)))}createNoteView(e){return Object.assign(Object.assign({},e),{backgroundTexture:this.backgroundTexture,maskTexture:this.maskTexture})}getAnnotationViewList(){return this.annotationViews}getFilteredNotes(){const e=this.notesFilter===c.$.ALL,t=this.notesFilter===c.$.RESOLVED,i=[];return this.notes.forEach((n=>{(e||n.resolved===t)&&i.push(n)})),i}getNoteAnnotations(e){return e.map((e=>{const t=e.comments.get(0);if(!t)throw new Error("No root comment in a note");return{id:e.id,text:t.text,user:e.user,color:e.color,createdTime:e.lastCommentMs,assetType:a.h.NOTE,numAttachments:t.attachments.length,numComments:e.comments.length}}))}getAnnotationSearchResults(e,t){const i=[];return e.forEach((e=>{e.comments.forEach((n=>{const{text:s,user:r}=n;let l=this.getSearchSnippet(s,t);null===l&&t.blockType===o.C.USER&&t.id===r.id&&(l=this.textParser.getPlainText(s)),null!==l&&i.push({id:n.id,text:l,user:n.user,color:e.color,createdTime:n.created.getTime(),assetType:a.h.COMMENT,numAttachments:n.attachments.length,numComments:0,assetId:e.id})}))})),i}getCommentUserMentions(e,t){const i=[];return this.textParser.getUserMentions(e).forEach((e=>{const n=t[e];n&&i.push(n)})),i}getSearchSnippet(e,t){const i=this.textParser.searchMarkdown(e,t);if(!i)return null;const{textLength:n,numMatches:s,matchIndex:r,markdown:o}=i;let a=o,l=r;if(n>20&&l>0){if(1===s){const e=Math.floor((20-t.text.length)/2);e>0&&l>e&&(l-=e)}a=`...${a.substr(l)}`,a.length<20&&(l-=20-a.length,l>0&&(a=`...${o.substr(l)}`))}return a}getNote(e){const t=this.notes.findIndex((t=>t.id===e));return this.notes.get(t)}getNoteAttachments(e){const t=[],i=this.getNote(e);return i&&i.comments.forEach((e=>{t.push(...e.attachments)})),t}get isNewNote(){return this.creatingNewNote}setCreatingNote(e){this.creatingNewNote=e}getPendingNote(){return this.creatingNewNote&&this.openNoteView?this.openNoteView:null}setNotesPhase(e){this.notesPhaseObservable.value=e}get notesPhase(){return this.notesPhaseObservable.value}onNotesPhaseChanged(e){return this.notesPhaseObservable.onChanged(e)}setNotesFilter(e){this.notesFilterObservable.value=e}get notesFilter(){return this.notesFilterObservable.value}onNotesFilterChanged(e){return this.notesFilterObservable.onChanged(e)}setActiveAnnotation(e){this.activeAnnotationObservable.value=e}get activeAnnotation(){return this.activeAnnotationObservable.value}onActiveAnnotationChanged(e){return this.activeAnnotationObservable.onChanged(e)}setListIndex(e){this.listIndexObservable.value=e}get listIndex(){return this.listIndexObservable.value}onListIndexChanged(e){return this.listIndexObservable.onChanged(e)}setOpenNoteView(e){this.openNoteViewObservable.value=e}get openNoteView(){return this.openNoteViewObservable.value}onOpenNoteViewChanged(e){return this.openNoteViewObservable.onChanged(e)}resetOpenNoteView(){const e=this.openNoteView;if(e){const t=this.data.getNoteProperties(e.id);t&&this.updateOpenNoteView(t)}}updateOpenNoteView(e){const t=this.openNoteView;t&&Object.assign(t,e)}}},2904:(e,t,i)=>{"use strict";i.d(t,{yK:()=>NotesModeToggleCommand,yC:()=>PreviewNoteCommand,dR:()=>OpenNoteCommand,xy:()=>OpenStartingNoteCommand,VI:()=>StartNewNoteCommand,FB:()=>SaveNewNoteCommand,gc:()=>CancelNewNoteCommand,_N:()=>CloseNoteCommand,kd:()=>SaveNoteChangesCommand,oH:()=>CancelCommentChangesCommand,df:()=>ToggleNoteToolEditorCommand,oE:()=>SaveNoteAppearanceCommand,yp:()=>ResolveNoteCommand,sG:()=>DeleteNoteCommand,uT:()=>OpenAnnotationViewCommand,cS:()=>EditAnnotationCommand,Df:()=>AddCommentCommand,Uw:()=>UpdateCommentCommand,mH:()=>DeleteCommentCommand});var n=i(17386);class NotesModeToggleCommand extends n.m{constructor(e){super(),this.payload={opened:e}}}class PreviewNoteCommand extends n.m{constructor(e){super(),this.payload={noteId:e}}}class OpenNoteCommand extends n.m{constructor(e,t,i,n=-1){super(),this.payload={noteId:e,transition:t,attachmentId:i,listIndex:n}}}class OpenStartingNoteCommand extends n.m{constructor(){super()}}class StartNewNoteCommand extends n.m{constructor(){super()}}class SaveNewNoteCommand extends n.m{constructor(e){super(),this.payload={text:e}}}class CancelNewNoteCommand extends n.m{constructor(){super()}}class CloseNoteCommand extends n.m{constructor(){super()}}class SaveNoteChangesCommand extends n.m{constructor(e,t){super(),this.payload={noteId:e,text:t}}}class CancelCommentChangesCommand extends n.m{}class ToggleNoteToolEditorCommand extends n.m{constructor(e){super(),this.payload={opened:e}}}class SaveNoteAppearanceCommand extends n.m{constructor(e,t){super(),this.payload={noteId:e,properties:t}}}class ResolveNoteCommand extends n.m{constructor(e,t){super(),this.payload={noteId:e,resolved:t}}}class DeleteNoteCommand extends n.m{constructor(e){super(),this.payload={noteId:e}}}class OpenAnnotationViewCommand extends n.m{constructor(e,t,i){super(),this.payload={id:e,assetType:t,editText:i}}}class EditAnnotationCommand extends n.m{constructor(e){super(),this.payload={id:e}}}class AddCommentCommand extends n.m{constructor(e,t,i){super(),this.payload={noteId:e,text:t,replyId:i}}}class UpdateCommentCommand extends n.m{constructor(e,t,i){super(),this.payload={noteId:e,commentId:t,text:i}}}class DeleteCommentCommand extends n.m{constructor(e,t){super(),this.payload={noteId:e,commentId:t}}}},84834:(e,t,i)=>{"use strict";var n,s;i.d(t,{$:()=>n,Y:()=>s}),function(e){e.OPEN="open",e.RESOLVED="resolved",e.ALL="all"}(n||(n={})),function(e){e.DEFAULT="default",e.HIGHLIGHTED="highlighted",e.DIMMED="dimmed"}(s||(s={}))},70273:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AddCommentCommand:()=>te.Df,CancelCommentChangesCommand:()=>te.oH,CancelNewNoteCommand:()=>te.gc,CloseNoteCommand:()=>te._N,Comment:()=>Comment,DeleteCommentCommand:()=>te.mH,DeleteNoteCommand:()=>te.sG,EditAnnotationCommand:()=>te.cS,HashtagData:()=>ee.c,Note:()=>Note,NoteColorVariant:()=>W.Y,NoteMissingMessage:()=>ie.pn,NoteResolutionChangeMessage:()=>ie.hY,NotesData:()=>NotesData,NotesFilter:()=>W.$,NotesModeOpenedMessage:()=>ie.Ey,NotesModeToggleCommand:()=>te.yK,NotesPhase:()=>z.U,NotesViewData:()=>J.X,OpenAnnotationViewCommand:()=>te.uT,OpenNoteCommand:()=>te.dR,OpenStartingNoteCommand:()=>te.xy,PreviewNoteCommand:()=>te.yC,ResolveNoteCommand:()=>te.yp,SaveNewNoteCommand:()=>te.FB,SaveNoteAppearanceCommand:()=>te.oE,SaveNoteChangesCommand:()=>te.kd,StartNewNoteCommand:()=>te.VI,ToggleNoteToolEditorCommand:()=>te.df,UpdateCommentCommand:()=>te.Uw,default:()=>ve});var n=i(47724),s=i(44283),r=i(88512),o=i(60771),a=i(66223),l=i(28636),c=i(27314),h=i(10757),d=i(31278),u=i(86010),p=i(44574),m=i(79553),g=i(92532),f=i(66157),v=i(24151),y=i(89046),b=i(88454),S=i(15881),E=i(81347),w=i(61481),T=i(7683),_=i(21479),M=i(8150),x=i(75892),A=i(35597),O=i(33874),P=i(19047),D=i(26627),C=i(27326),I=i(51764),L=i(46114),R=i(29422),N=i(41591),k=i(42835),B=i(48470),F=i(38321),U=i(90662),V=i(19980),H=i(96168),G=i(62679),z=i(8752),W=i(84834),j=i(2212),K=i(23573),q=i(75256),Z=i(49747),Y=i(87182);class Note extends K.T{constructor(e){super(),this.id="",this.color=Y.Rn,this.anchorPosition=new j.Vector3,this.stemNormal=new j.Vector3,this.stemLength=Y.ZP.stem.length,this.stemEnabled=!0,this.created=new Date,this.modified=new Date,this.lastCommentMs=(new Date).getTime(),this.resolved=!1,this.user=(0,Z.Q)(""),this.comments=(0,q.C)([]),e&&Object.assign(this,e)}copy(e){return this.id=e.id,this.user=e.user,this.resolved=e.resolved,this.color=e.color,this.floorId=e.floorId,this.roomId=e.roomId,this.anchorPosition.copy(e.anchorPosition),this.stemNormal.copy(e.stemNormal),this.stemLength=e.stemLength,this.stemEnabled=e.stemEnabled,this.created.setTime(e.created.getTime()),this.modified.setTime(e.modified.getTime()),this.lastCommentMs=e.lastCommentMs,this.comments=e.comments,this.commit(),this}getComment(e){return this.comments.find((t=>t.id===e))||null}updateComment(e){const t=this.comments.findIndex((t=>t.id===e.id));-1!==t&&(e.assetId=this.id,this.comments.update(t,e))}}var $=i(32770),Q=i(64781);class NotesData extends $.V{constructor(e){super(),this.name="notes-data",this.notes=(0,Q.q)(e)}iterate(e){for(const t of this.notes)e(t)}addNote(e){this.notes.has(e.id)?this.notes.get(e.id).copy(e):this.notes.set(e.id,e)}updateNote(e,t){if(this.notes.has(e)){const i=this.notes.get(e);let n=!1;void 0!==t.resolved&&t.resolved!==i.resolved&&(i.resolved=t.resolved,n=!0),void 0!==t.color&&t.color!==i.color&&(i.color=t.color,n=!0),void 0!==t.anchorPosition&&t.anchorPosition!==i.anchorPosition&&(i.anchorPosition=t.anchorPosition,n=!0),void 0!==t.stemNormal&&t.stemNormal!==i.stemNormal&&(i.stemNormal=t.stemNormal,n=!0),void 0!==t.stemLength&&t.stemLength!==i.stemLength&&(i.stemLength=t.stemLength,n=!0),void 0!==t.stemEnabled&&t.stemEnabled!==i.stemEnabled&&(i.stemEnabled=t.stemEnabled,n=!0),void 0!==t.floorId&&t.floorId!==i.floorId&&(i.floorId=t.floorId,n=!0),void 0!==t.roomId&&t.roomId!==i.roomId&&(i.roomId=t.roomId,n=!0),n&&i.commit()}}removeNote(e){this.notes.has(e)&&(this.notes.delete(e),this.commit())}getNote(e){return this.notes.get(e)}getNoteProperties(e){const t=this.notes.get(e);if(!t)return null;return Object.assign({},t)}get collection(){return this.notes}}var X,J=i(92824),ee=i(39950),te=i(2904),ie=i(76495),ne=i(94474),se=i(71918),re=i(45631),oe=i(78230);!function(e){e.RESOLVED="resolved",e.OPEN="open"}(X||(X={}));var ae=i(44382),le=i(19674);const ce=new r.Z("mds-note-serialize");class MdsNoteCreateSerializer{constructor(){this.getNoteDetails=(e,t)=>{const i={enabled:!0,floorId:"",roomId:""};void 0!==e.floorId&&""!==e.floorId&&(i.floorId=e.floorId),void 0!==e.roomId&&""!==e.roomId&&(i.roomId=e.roomId),void 0!==e.color&&""!==e.color&&(i.color=e.color),void 0!==e.stemEnabled&&(i.stemEnabled=e.stemEnabled),void 0!==e.stemLength&&(i.stemLength=e.stemLength),void 0!==e.anchorPosition&&(0,ae.uU)(e.anchorPosition)&&(i.anchorPosition=le.ep.toVisionVector(e.anchorPosition)),void 0!==e.stemNormal&&(0,ae.uU)(e.stemNormal)&&(i.stemNormal=le.ep.toVisionVector(e.stemNormal)),void 0!==e.resolved&&(i.resolution=e.resolved?X.RESOLVED:X.OPEN);const n={text:t};return i.comment=n,Object.keys(i).length>0?i:null},this.validate=e=>{if(!e)return!1;const t=["floorId","roomId","enabled"].filter((t=>!(t in e))),i=0===t.length,n=!!e.floorId&&"string"==typeof e.floorId,s=!!e.anchorPosition&&(0,ae.uU)(e.anchorPosition),r=i&&n&&s;return r||ce.debug("Note invalid:",{missingFields:t,validPosition:s}),r}}serialize(e,t){const i=this.getNoteDetails(e,t);return this.validate(i)?i:null}}class MdsNotePatchSerializer{constructor(){this.getNotePatch=e=>{if(!e)return null;const t={};return void 0!==e.floorId&&""!==e.floorId&&(t.floorId=e.floorId),void 0!==e.roomId&&""!==e.roomId&&(t.roomId=e.roomId),void 0!==e.color&&""!==e.color&&(t.color=e.color),void 0!==e.stemEnabled&&(t.stemEnabled=e.stemEnabled),void 0!==e.stemLength&&(t.stemLength=e.stemLength),void 0!==e.anchorPosition&&(0,ae.uU)(e.anchorPosition)&&(t.anchorPosition=le.ep.toVisionVector(e.anchorPosition)),void 0!==e.stemNormal&&(0,ae.uU)(e.stemNormal)&&(t.stemNormal=le.ep.toVisionVector(e.stemNormal.normalize())),Object.keys(t).length>0?t:null},this.validate=e=>{if(!e)return!1;const t=["floorId","roomId","color","anchorPosition","stemNormal","stemLength","stemEnabled","stemNormal","enabled"];return Object.keys(e).every((e=>t.includes(e)))}}serialize(e){const t=this.getNotePatch(e);return t&&this.validate(t)?t:null}}var he=i(31879);const de=new r.Z("mds-note-deserializer");class MdsNoteDeserializer{constructor(e,t){this.commentDeserializer=e,this.userData=t,this.validate=e=>{if(!e)return!1;const t=["id","created","modified","floor","resolution"].filter((t=>!(t in e))),i=0===t.length,n=!(!e.floor||!e.floor.id);return i&&n||de.debug("Note invalid:",{missingFields:t,validFloor:n}),i&&n}}deserialize(e){if(!e||!this.validate(e))return de.debug("Deserialized invalid Note data from MDS",e),null;const t=new Note;t.id=e.id,t.floorId=e.floor.id,e.room&&e.room.id&&(t.roomId=e.room.id),t.resolved=e.resolution===X.RESOLVED,t.created=(0,he.p)(e.created),t.modified=(0,he.p)(e.modified),t.user=this.userData.loadContributor(e.createdBy),t.lastCommentMs=(0,he.p)(e.lastCommentAt).getTime();const i=this.deserializeComments(e);if(!(i.length>0))return de.error("Note without a comment:",t.id),null;t.comments.replace(i),e.color&&(t.color=e.color);const n=e.anchorPosition?le.ep.fromVisionVector(e.anchorPosition):void 0;n&&(t.anchorPosition=n),void 0!==e.stemLength&&(t.stemLength=e.stemLength);const s=e.stemNormal?le.ep.fromVisionVector(e.stemNormal):void 0;return s?(t.stemNormal=s,t.stemEnabled=!!e.stemEnabled):(t.stemNormal=new j.Vector3(0,0,0),t.stemEnabled=!!e.stemEnabled),t}deserializeComments(e){const t=(0,se.qw)(e,"comments.results")||[],i=[];return t.forEach((t=>{const n=this.commentDeserializer.deserialize(t);n&&(n.assetId=e.id,n.assetType=S.h.NOTE,i.push(n))})),i}}class MdsCommentSerializer{constructor(){this.validate=e=>!!e}serialize(e){if(void 0===e.text)return null;const t={text:e.text};return t&&this.validate(t)?t:null}}class Comment extends K.T{constructor(e){super(),this.id="",this.assetId="",this.assetType=S.h.NOTE,this.text="",this.user=(0,Z.Q)(""),this.created=new Date,this.modified=new Date,this.edited=!1,this.attachments=(0,q.C)([]),e&&Object.assign(this,e)}copy(e){return this.id=e.id,this.user=e.user,this.assetId=e.assetId,this.assetType=e.assetType,this.created.setTime(e.created.getTime()),this.modified.setTime(e.modified.getTime()),this.text=e.text,this.edited=e.edited,this.attachments=e.attachments,this.commit(),this}}const ue=new r.Z("mds-comment-deserializer");class MdsCommentDeserializer{constructor(e,t,i){this.fileDeserializer=e,this.embedDeserializer=t,this.userData=i}deserialize(e){if(!e||!this.validate(e))return ue.debug("Deserialized invalid Comment data from MDS",e),null;const t=new Comment;t.id=e.id,t.created=(0,he.p)(e.created),t.modified=(0,he.p)(e.modified),e.text&&(t.text=e.text),t.edited=e.edited,t.user=this.userData.loadContributor(e.createdBy);const i=this.deserializeExternalAttachments(e),n=this.deserializeFileAttachments(e),s=i.concat(n).sort(((e,t)=>e.created.getTime()-t.created.getTime()));return s.length>0&&t.attachments.replace(s),t}deserializeExternalAttachments(e){const t=(0,se.qw)(e,"externalAttachments")||[],i=[];return t.forEach((t=>{const n=this.embedDeserializer.deserialize(t);n&&(n.assetId=e.id,n.assetType=S.h.COMMENT,i.push(n))})),i}deserializeFileAttachments(e){const t=(0,se.qw)(e,"fileAttachments")||[],i=[];return t.forEach((t=>{const n=this.fileDeserializer.deserialize(t);n&&(n.assetId=e.id,n.assetType=S.h.COMMENT,i.push(n))})),i}validate(e){if(!e)return!1;const t=["id","created","modified","edited","createdBy"].filter((t=>!(t in e))),i=0===t.length;return i||ue.debug("Comment invalid:",{missingFields:t}),i}}var pe=i(11764),me=i(70129);const ge=new r.Z("MdsNoteStore");class MdsNoteStore extends ne.u{constructor(e,t){super(e),this.userData=t,this.prefetchKey="data.model.notes",this.embedDeserializer=new re.d,this.fileDeserializer=new oe.O,this.commentDeserializer=new MdsCommentDeserializer(this.fileDeserializer,this.embedDeserializer,this.userData),this.deserializer=new MdsNoteDeserializer(this.commentDeserializer,this.userData),this.createSerializer=new MdsNoteCreateSerializer,this.patchSerializer=new MdsNotePatchSerializer,this.commentSerializer=new MdsCommentSerializer}read(e){const t={modelId:this.getViewId()};return this.query(pe.GetNotes,t,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.notes;if(!n||!Array.isArray(n))return{};const s=[];for(const e of n){const t=this.deserializer.deserialize(e);t&&s.push(t)}return s.reduce(((e,t)=>(e[t.id]=t,e)),{})}))}async readNote(e,t){const i={modelId:this.getViewId(),ids:[e]};return this.query(pe.GetNotes,i,t).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.notes;return n&&Array.isArray(n)&&1===n.length?this.deserializer.deserialize(n[0]):null}))}async create(e,t){const i=this.getViewId(),n=this.createSerializer.serialize(e,t);if(!n)throw ge.error("Failure creating note:",e.id,e),new Error("Could not create Note");return this.mutate(pe.AddNote,{modelId:i,data:n}).then((e=>this.deserializer.deserialize((0,se.qw)(e,"data.addNote"))))}async update(e){const t=this.getViewId(),i=e.id,n=this.patchSerializer.serialize(e);if(!n)throw ge.error("Failure updating note:",i),new Error("Could not update Note");return this.mutate(pe.PatchNote,{modelId:t,noteId:i,data:n})}async updateResolution(e,t){const i=this.getViewId(),n=t?pe.ResolveNote:pe.ReopenNote,s=t?"data.resolveNote":"data.reopenNote";return this.mutate(n,{modelId:i,noteId:e}).then((e=>(0,se.qw)(e,s)))}async delete(e){const t=this.getViewId();return Promise.all(e.map((e=>{if(!e||e&&!e.id)throw new Error("MdsNoteStore.delete failed");return this.mutate(pe.DeleteNote,{modelId:t,noteId:e.id})})))}async createComment(e,t){const i=this.getViewId(),n=this.commentSerializer.serialize(t);if(!n)throw ge.error("Failure creating comment:",t),new Error("Could not create Comment");return this.mutate(pe.AddNoteComment,{modelId:i,noteId:e,data:n}).then((e=>this.commentDeserializer.deserialize((0,se.qw)(e,"data.addNoteComment"))))}async updateComment(e){const t=this.getViewId(),i=e.id,n=this.commentSerializer.serialize(e);if(!n)throw ge.error("Failure updating comment:",i),new Error("Could not update Comment");return this.mutate(me.PatchComment,{modelId:t,commentId:i,data:n}).then((e=>(ge.debug(Object.assign({type:"PatchComment"},e)),this.commentDeserializer.deserialize((0,se.qw)(e,"data.patchComment")))))}async deleteComment(e){const t=this.getViewId();if(!e||e&&!e.id)throw new Error("MdsNoteStore.deleteComment failed");return this.mutate(me.DeleteComment,{modelId:t,commentId:e.id})}}const fe=new r.Z("notes-module");class NotesModule extends n.Y{constructor(){super(...arguments),this.name="notes",this.startingNote=null,this.activated=!1,this.registered=!1,this.activeBindings=[],this.refreshPromise=null,this.pollOnNotes=()=>{let e;return(0,s.k1)((()=>{clearInterval(e),e=window.setInterval((()=>{this.refreshNotes()}),1e3*Y.GR)}),(()=>{window.clearInterval(e)}),!0)},this.updatePerSettings=()=>{const e=this.settingsData.tryGetProperty(Y.Mp,!1),t=!this.in360View(),i=!this.interactionmodeData.isVR(),n=t&&i&&e,s=n?this.getFilteredNoteIds(!1):[];this.pinRenderer.fadePinOpacityByType(k.Er.NOTE,n?1:0,s)},this.userOpenedNotesMode=()=>{this.toolsData.setToolAccess(m.X$.TOOL)},this.toggleNotesMode=async e=>{e.opened?this.activateTool():this.deactivateTool()},this.togglePinAssetEditor=async e=>{this.viewData.setActiveAnnotation(null),e.opened?this.changeNotesPhase(z.U.EDITING):this.viewData.notesPhase===z.U.EDITING&&this.changeNotesPhase(z.U.OPEN)},this.openStartingNote=async()=>{if(this.startingNote){const e=this.viewData,t=e.getNoteView(this.startingNote);(null==t?void 0:t.resolved)&&e.setNotesFilter(W.$.ALL),this.startingNote=null,await this.engine.commandBinder.issueCommand(new g.tT(m.w1.NOTES,!0)),await(0,h.gw)(500),t?this.openNote(t.id,d.n.FadeToBlack,(0,o.AO)().comment):this.engine.broadcast(new ie.pn)}},this.onAppChange=()=>{this.deactivateTool(),this.updatePerSettings()},this.onNotesPhaseChanged=()=>{let e=!0;const t=this.toolsData.toolPanelLayout===m.wS.BOTTOM_PANEL;switch(this.viewData.notesPhase){case z.U.EDITING:case z.U.CREATING:e=!1;break;case z.U.OPENING:case z.U.OPEN:e=!t}this.engine.broadcast(new f.ps(e))},this.changeNotesPhase=e=>{e!==this.viewData.notesPhase&&this.viewData.setNotesPhase(e)},this.onCloseNote=async()=>{this.closeNote()},this.pinAddCancelled=e=>{e.pinType===k.Er.NOTE&&this.cancelNoteCreation()},this.onCancelNewNote=async()=>{this.cancelNoteCreation()},this.cancelNoteCreation=()=>{const e=this.viewData;this.userData.isCommenter()&&(this.engine.broadcast(new B.w0(k.Er.NOTE)),this.engine.broadcast(new f.Ur),this.cancelAttachmentChanges(),e.setActiveAnnotation(null),e.setOpenNoteView(null),e.setCreatingNote(!1),this.changeNotesPhase(z.U.IDLE))},this.noteWasAdded=(e,t)=>{this.updateNotePin(e)},this.noteWasUpdated=(e,t)=>{this.updateNotePin(e)},this.updateNotes=()=>{this.activated&&(this.parseNotes(),this.updateNoteViewData()),this.displayNotes()},this.onNoteFilterChanged=()=>{this.viewData.setOpenNoteView(null),this.updateNoteViewData(),this.updateNoteVisibility()},this.onSearchBlockChanged=()=>{this.closeNote(),this.updateNoteViewData()},this.onViewModeOrFloorChanged=()=>{this.updatePerSettings()},this.onOpenNoteViewChanged=()=>{const e=this.viewData.openNoteView;e&&this.updateNotePin(e)},this.startNoteCreation=async()=>{if(!this.userData.isCommenter())return;const e=this.viewData;let t=(0,h.O1)(11);for(;this.notesData.getNote(t);)t=(0,h.O1)(11);const i=new Note;i.user=this.userData.getCurrentUser(),i.id=t,i.floorId=this.floorsViewData.getHighestVisibleFloor().id;const n=e.createNoteView(i);e.setCreatingNote(!0),this.changeNotesPhase(z.U.CREATING),e.setOpenNoteView(n),this.engine.broadcast(new B.nO(n,k.Er.NOTE)),this.engine.commandBinder.issueCommand(new U.B)},this.saveNewNote=async e=>{if(!this.userData.isCommenter())return;const{text:t}=e,i=this.viewData,n=i.getPendingNote();if(n){const e=await this.store.create(n,t);if(!e)return void fe.error("MDS Note saved failed");const s=e.comments.get(0);if(!s)throw new Error("No root comment in the new note");const r=await this.confirmAttachmentChanges(s.id,S.h.COMMENT,n.id,S.h.NOTE);this.notesData.addNote(e),r&&await this.refreshNote(e.id),this.parseMarkdown(t),this.pinRenderer.removePin(n.id),i.setOpenNoteView(i.getNoteView(e.id));const o=i.openNoteView;o&&this.engine.broadcast(new B.sD(o,k.Er.NOTE,this.userData.isCommenter())),i.setActiveAnnotation(null),i.setCreatingNote(!1),this.updateNoteViewData(),i.setListIndex(this.getListIndex(e.id,S.h.NOTE))}else fe.debug("No pending note")},this.pinMoved=e=>{const t=this.viewData.openNoteView;if(t&&e.pinType===k.Er.NOTE&&e.id===t.id){this.notesData.getNote(e.id)?(this.notesData.updateNote(e.id,e.pinPos),this.store.update(Object.assign({id:e.id},e.pinPos))):fe.debug("Cannot move a non-existent note")}},this.pinPlaced=e=>{const t=this.viewData.openNoteView;t&&e.pinType===k.Er.NOTE&&e.id===t.id&&(this.viewData.updateOpenNoteView(e.pinPos),this.changeNotesPhase(z.U.OPEN),this.viewData.setActiveAnnotation(t.id),this.engine.broadcast(new f.ZL(S.h.NOTE,t.id)))},this.pinDeselected=e=>{const{openNoteView:t,notesPhase:i,activeAnnotation:n}=this.viewData;t&&e.pinType===k.Er.NOTE&&e.id===t.id&&(i!==z.U.OPEN||n||this.closeNote())},this.openAnnotationView=async e=>{const t=this.viewData,i=t.getAnnotationViewList().values(),n=i.findIndex((t=>t.id===e.id&&t.assetType===e.assetType));if(-1===n)return void fe.debug("annotationId not in list");const s=i[n];if(!s)return void fe.debug("Cannot open non-existent list annotation");const r=s.assetType===S.h.COMMENT,o=r&&s.assetId?s.assetId:s.id,a=r?s.id:void 0,l=this.toolsData.toolPanelLayout===m.wS.SIDE_PANEL?d.n.FadeToBlack:d.n.Instant;t.setActiveAnnotation(e.editText?s.id:null),this.openNote(o,l,a,void 0,n,e.editText)},this.onEditAnnotation=async e=>{this.viewData.setActiveAnnotation(e.id)},this.previewNote=async e=>{let t=this.viewData.getNoteView(e.noteId);t||this.activated||(this.updateNoteViewData(),t=this.viewData.getNoteView(e.noteId)),t&&this.engine.commandBinder.issueCommand(new F._l(t,k.Er.NOTE))},this.onOpenNote=async e=>this.openNote(e.noteId,e.transition,void 0,e.attachmentId,e.listIndex),this.deleteNote=async e=>{const t=e.noteId,i=this.notesData.getNote(t);if(i){this.engine.commandBinder.issueCommand(new y.rE),this.store.delete([i]),this.notesData.removeNote(t),this.engine.broadcast(new B.VZ(t,k.Er.NOTE));const e=this.viewData.openNoteView;e&&e.id===t&&this.closeNote()}else fe.debug("Cannot delete a non-existent note")},this.onResolveNoteCommand=async e=>{const{noteId:t,resolved:i}=e;i?this.resolveNote(t):this.reopenNote(t)},this.onSaveNoteChanges=async e=>{const{noteId:t,text:i}=e,n=this.notesData.getNote(t);if(n){const e=n.comments.get(0);if(e)return this.updateNoteComment(t,e.id,i);fe.warn("no root comment")}else fe.debug("Cannot update a non-existent note")},this.cancelCommentChanges=async e=>{this.cancelAttachmentChanges(),this.viewData.setActiveAnnotation(null)},this.saveNoteAppearance=async e=>{const t=this.notesData,i=this.viewData,n=t.getNote(e.noteId);if(n){const s=e.properties;if(Object.keys(s)){i.updateOpenNoteView(s);const e=i.openNoteView;e&&this.engine.broadcast(new B.KR(e,k.Er.NOTE)),t.updateNote(n.id,s),this.store.update(Object.assign({id:n.id},s))}}else fe.debug("Cannot update a non-existent note")},this.addComment=async e=>{const{noteId:t,text:i,replyId:n}=e,s=this.notesData.getNote(t);if(s){s.resolved&&(this.viewData.setNotesFilter(W.$.ALL),this.reopenNote(s.id));const e=await this.store.createComment(t,{text:i});return e?(this.viewData.setActiveAnnotation(null),await this.confirmAttachmentChanges(e.id,S.h.COMMENT,n),this.parseMarkdown(i).then((()=>{this.refreshNote(s.id)})),this.refreshNotes(),e):(fe.error("Cannot create MDS comment"),null)}return fe.debug("Cannot add a comment to a non-existent note"),null},this.onUpdateComment=async e=>{const{noteId:t,commentId:i,text:n}=e;return this.updateNoteComment(t,i,n)},this.deleteComment=async e=>{const{commentId:t,noteId:i}=e,n=this.notesData.getNote(i);if(n){const e=n.getComment(t);e&&await this.store.deleteComment(e),this.refreshNotes()}else fe.debug("Cannot delete a comment in a non-existent note")}}async init(e,t){const[i,n,s]=await Promise.all([t.market.waitForData(O.e),t.market.waitForData(P.Z),t.market.waitForData(E.m)]);if(!s.isLoggedIn()||n.isVR()||!i.tryGetProperty(Y.IA,!1))return;this.engine=t,this.config=e,this.startingNote=e.startingNote||null,this.interactionmodeData=n,this.userData=s,this.settingsData=i;const[r]=await Promise.all([t.getModule(N.default)]);this.pinRenderer=r.pinRenderer;const[o,h,d,p,m,g,f]=await Promise.all([t.market.waitForData(_.pu),t.market.waitForData(v.t),t.market.waitForData(x.Z),t.market.waitForData(A.O),t.market.waitForData(D.i),t.market.waitForData(C.c),t.market.waitForData(V.A)]);this.appData=o,this.toolsData=h,this.sweepData=d,this.viewmodeData=p,this.floorsViewData=g,this.annotationsViewData=f,this.store=this.getStore(m);const y=await this.store.read();this.notesData=new NotesData(y||{}),t.market.register(this,NotesData,this.notesData),this.textParser=new u.v({links:!0,hashtags:!0,users:this.userData}),this.maskTexture=(0,a.p)(c),this.backgroundTexture=(0,a.p)(l),this.viewData=new J.X(this.notesData,this.textParser,this.backgroundTexture,this.maskTexture),this.hashtagData=new ee.c,t.market.register(this,ee.c,this.hashtagData),this.bindings.push(i.onPropertyChanged(Y.Mp,this.updatePerSettings),t.commandBinder.addBinding(te.yK,this.toggleNotesMode),t.commandBinder.addBinding(te.dR,this.onOpenNote),t.commandBinder.addBinding(te.yC,this.previewNote),t.commandBinder.addBinding(te.xy,this.openStartingNote),t.subscribe(M.bS,this.onAppChange),p.makeModeChangeSubscription(this.onViewModeOrFloorChanged),g.makeFloorChangeSubscription(this.onViewModeOrFloorChanged),t.subscribe(I.Z,this.updatePerSettings),t.subscribe(L.m,this.updatePerSettings),t.subscribe(ie.Ey,this.userOpenedNotesMode),this.pollOnNotes()),t.market.register(this,J.X,this.viewData),this.updatePerSettings(),this.displayNotes(),this.parseNotes()}dispose(e){this.deactivateTool(),this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],this.activeBindings=[],this.pinRenderer.removePinsByType(k.Er.NOTE),this.maskTexture.dispose(),this.backgroundTexture.dispose(),super.dispose(e)}onUpdate(){}async refreshNotes(){var e;if(this.refreshPromise)return;const t=this.viewData,{isNewNote:i,notesPhase:n}=t;if(i||n===z.U.EDITING)return;this.refreshPromise=this.store.read().finally((()=>{this.refreshPromise=null}));const s=await this.refreshPromise,r=Object.values(s),o=null===(e=t.openNoteView)||void 0===e?void 0:e.id,{collection:a}=this.notesData;this.notesData.atomic((()=>{const e=a.keys.filter((e=>!s[e]));e.length&&e.forEach((e=>{e===o&&(fe.debug("Open note was deleted"),t.setOpenNoteView(null),t.setActiveAnnotation(null)),a.delete(e)})),r.length&&r.forEach((e=>{this.notesData.addNote(e)}))}))}async refreshNote(e){if(this.refreshPromise)return;const t=await this.store.readNote(e);t&&(this.notesData.addNote(t),this.updateNotePin(t))}activateTool(){this.activated||(this.config.workshop&&(this.appData.application===_.Mx.WORKSHOP&&this.engine.commandBinder.issueCommand(new y.Mn(!1)),this.engine.commandBinder.issueCommand(new b.KW(!1))),this.userData.isCommenter()&&this.engine.commandBinder.issueCommand(new F.EP(!0)),this.changeNotesPhase(z.U.IDLE),this.updateNoteViewData(),this.registered?this.activeBindings.forEach((e=>{e.renew()})):this.registerHandlers(),this.activated=!0)}deactivateTool(){if(!this.activated)return;const{isNewNote:e,openNoteView:t}=this.viewData;e?this.cancelNoteCreation():t&&this.closeNote(),this.annotationsViewData.setSearchBlock(null),this.changeNotesPhase(z.U.CLOSED),this.engine.commandBinder.issueCommand(new F.EP(!1)),this.config.workshop&&(this.appData.application===_.Mx.WORKSHOP&&this.engine.commandBinder.issueCommand(new y.Mn(!0)),this.engine.commandBinder.issueCommand(new b.KW(!0))),this.activeBindings.forEach((e=>{e.cancel()})),this.activated=!1}getStore(e){const{modelId:t,baseUrl:i,readonly:n}=this.config;return new MdsNoteStore({readonly:n,includeDisabled:!0,baseUrl:i,viewId:t},this.userData)}registerHandlers(){const e=this.engine.commandBinder;this.activeBindings.push(this.engine.subscribe(B.b0,this.pinPlaced),this.engine.subscribe(B.bV,this.pinMoved),this.engine.subscribe(B.hu,this.pinAddCancelled),this.engine.subscribe(B.Fe,this.pinDeselected),e.addBinding(te.VI,this.startNoteCreation),e.addBinding(te.FB,this.saveNewNote),e.addBinding(te.gc,this.onCancelNewNote),e.addBinding(te._N,this.onCloseNote),e.addBinding(te.kd,this.onSaveNoteChanges),e.addBinding(te.oH,this.cancelCommentChanges),e.addBinding(te.uT,this.openAnnotationView),e.addBinding(te.cS,this.onEditAnnotation),e.addBinding(te.sG,this.deleteNote),e.addBinding(te.yp,this.onResolveNoteCommand),e.addBinding(te.Df,this.addComment),e.addBinding(te.Uw,this.onUpdateComment),e.addBinding(te.mH,this.deleteComment),e.addBinding(te.oE,this.saveNoteAppearance),e.addBinding(te.df,this.togglePinAssetEditor),this.annotationsViewData.onSearchBlockChanged(this.onSearchBlockChanged),this.viewData.onNotesFilterChanged(this.onNoteFilterChanged),this.viewData.onOpenNoteViewChanged(this.onOpenNoteViewChanged),this.viewData.onNotesPhaseChanged(this.onNotesPhaseChanged),this.notesData.onChanged(this.updateNotes),this.notesData.collection.onElementChanged({onAdded:this.noteWasAdded,onUpdated:this.noteWasUpdated})),this.registered=!0}async parseNotes(){const e=[],t=[];return this.notesData.iterate((i=>{i.comments.forEach((i=>{const n=this.getUserMentionsAndHashtags(i.text);n.emails.forEach((t=>{e.push({email:t,userStatus:w.J.MENTIONED})})),t.push(...n.hashtags)}))})),this.hashtagData.addHashtags(t),this.engine.commandBinder.issueCommand(new T.Vu(e))}async parseMarkdown(e){const t=[],i=this.getUserMentionsAndHashtags(e);return i.emails.forEach((e=>{t.push({email:e,userStatus:w.J.MENTIONED})})),this.hashtagData.addHashtags(i.hashtags),this.engine.commandBinder.issueCommand(new T.Vu(t))}getUserMentionsAndHashtags(e){const t=[],i=[];for(const n of this.textParser.parse(e))n.blockType===p.C.USER&&n.value?t.push(n.value):n.blockType===p.C.HASH&&i.push(n.text);return{emails:t,hashtags:i}}in360View(){const e=this.sweepData.currentSweep?this.sweepData.currentSweep:"";return this.viewmodeData.isPano()&&this.sweepData.isSweepUnaligned(e)}closeNote(){var e;const t=null===(e=this.viewData.openNoteView)||void 0===e?void 0:e.id;this.viewData.setActiveAnnotation(null),this.viewData.setOpenNoteView(null),this.changeNotesPhase(z.U.IDLE),t&&(this.cancelAttachmentChanges(),this.engine.commandBinder.issueCommand(new H.xW(!1)),this.engine.broadcast(new B.A(t,k.Er.NOTE)),this.engine.broadcast(new f.Ur)),this.updateNoteVisibility()}updateNoteViewData(){this.viewData.updateViewData(this.annotationsViewData.searchBlock)}getFilteredNoteIds(e){const t=[];return this.notesData.iterate((i=>{this.getNoteVisibility(i)===e&&t.push(i.id)})),t}getNoteVisibility(e){const{notesFilter:t,openNoteView:i}=this.viewData,{id:n,resolved:s}=e;return i&&i.id===n||t===W.$.ALL||s&&t===W.$.RESOLVED||!s&&t===W.$.OPEN}updateNoteVisibility(){this.notesData.iterate((e=>{this.pinRenderer.setPinVisible(e.id,this.getNoteVisibility(e))}))}displayNotes(){this.notesData.iterate((e=>this.updateNotePin(e)))}updateNotePin(e){const t=this.getNoteVisibility(e);this.pinRenderer.updatePin(e.id,k.Er.NOTE,e,this.backgroundTexture,this.maskTexture,t)}async confirmAttachmentChanges(e,t,i,n){return this.engine.commandBinder.issueCommand(new H.iu(e,t,i,n))}async cancelAttachmentChanges(){return this.engine.commandBinder.issueCommand(new H.Ze)}async openNote(e,t,i,n,s=-1,r=!1){const{toolsData:o,viewData:a,engine:l,activated:c,userData:h,pinRenderer:u}=this;c?-1!==s&&o.toolAccess===m.X$.TOOL&&o.setToolAccess(m.X$.LIST):(await l.commandBinder.issueCommand(new g.tT(m.w1.NOTES,!0)),o.setToolAccess(m.X$.SCENE));const p=a.getNoteView(e);if(p){const o=a.openNoteView,c=!!o&&o.id===e;if(!c){const n=null!==t?t:d.n.Instant;a.setOpenNoteView(p),l.broadcast(new B.sD(p,k.Er.NOTE,h.isCommenter())),this.changeNotesPhase(z.U.OPENING),null!==n&&(u.hideSelectedMesh(),await l.commandBinder.issueCommand(new R.OR({pinPosition:p,transition:n})),u.showSelectedMesh(k.Er.NOTE,p.id)),this.changeNotesPhase(z.U.OPEN),r?a.setActiveAnnotation(i||e):a.setActiveAnnotation(null)}if(i||!c){const e=i||p.comments.get(0).id;l.broadcast(new f.ZL(S.h.COMMENT,e))}let m=s;-1===m&&(m=this.getListIndex(p.id,S.h.NOTE)),this.viewData.setListIndex(m);const g=a.getNoteAttachments(p.id),v=n?g.find((e=>e.id===n)):void 0;if(n&&!r&&v&&(0,G.lV)(v)){const e=g.filter((e=>(0,G.lV)(e)));l.commandBinder.issueCommand(new H.xW(!0,e,n))}else l.commandBinder.issueCommand(new y.rE)}else fe.debug("Cannot open a non-existent note")}getListIndex(e,t){return this.viewData.getAnnotationViewList().values().findIndex((i=>i.assetType===t&&i.id===e))}async resolveNote(e){const t=this.notesData.getNote(e);if(t){if(t.resolved)return;this.closeNote(),await(0,h.gw)(350),this.engine.broadcast(new ie.hY(e,!0));await this.store.updateResolution(e,!0)?this.notesData.updateNote(e,{resolved:!0}):fe.error("Resolving note failed")}else fe.debug("Cannot resolve a non-existent note")}reopenNote(e){const t=this.notesData.getNote(e);if(t){if(!t.resolved)return;this.viewData.updateOpenNoteView({resolved:!1}),this.notesData.updateNote(e,{resolved:!1}),this.store.updateResolution(e,!1)}else fe.debug("Cannot reopen a non-existent note")}async updateNoteComment(e,t,i){const n=this.notesData.getNote(e);if(n){const s=n.getComment(t);if(s)if(s.user.id===this.userData.getCurrentUserId()){const r=await this.confirmAttachmentChanges(t,S.h.COMMENT);if(i!==s.text){const e=await this.store.updateComment({id:t,text:i});e&&n.updateComment(e),this.parseMarkdown(i)}(r||i!==s.text)&&(await this.refreshNote(n.id),n.resolved&&(this.viewData.setNotesFilter(W.$.ALL),this.reopenNote(e))),this.viewData.setActiveAnnotation(null)}else fe.debug("Cannot update another user's comment");else fe.debug("Cannot update a non-existent comment")}else fe.debug("Cannot update a comment in a non-existent note")}}const ve=NotesModule},76495:(e,t,i)=>{"use strict";i.d(t,{Ey:()=>NotesModeOpenedMessage,pn:()=>NoteMissingMessage,hY:()=>NoteResolutionChangeMessage});var n=i(91466);class NotesModeOpenedMessage extends n.v{}class NoteMissingMessage extends n.v{}class NoteResolutionChangeMessage extends n.v{constructor(e,t){super(),this.id=e,this.resolved=t}}},87182:(e,t,i)=>{"use strict";i.d(t,{IA:()=>n,Mp:()=>s,pE:()=>r,uE:()=>o,GR:()=>a,E8:()=>l,TM:()=>c,Ko:()=>h,Rn:()=>d,ZP:()=>u});const n="features/notes-mode",s="features/notes",r="features/notes-nudge",o="spaces.notes",a=30,l=15,c=500,h=500,d="#5c7fff",u=Object.freeze({noteMesh:{scale:{nearBound:1.5,farBound:4.8,maxSize:80,minSize:40,baseViewportSize:800,responsiveness:100}},colors:["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#5c7fff","#03a9f4","#417505","#00bcd4","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"],stem:{length:.23,width:1,opacity:1,transparent:!1,color:"white",alphaTest:.05},anchor:{size:.1},navigation:{anyDistance:!0,visibleDistance:8,cameraClearance:.1,tiltTolerance:25}})},45870:(e,t,i)=>{"use strict";i.d(t,{SI:()=>s,uQ:()=>r,zf:()=>o,O8:()=>a,WI:()=>l});var n=i(7170);const s=1e3/60,r=(0,n.Id)(70),o=-r,a=.05,l=.1/60},62881:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>PanoramaControls,lookAccelerationKey:()=>_});var n=i(47724),s=i(2212),r=i(12216),o=i(45870),a=i(68524),l=i(27408),c=i(16785),h=i(64185);class CameraControls extends c.Z{constructor(e){super(),this.lookVelocity=new s.Vector2,this.lookAccel=new s.Vector2,this.tempAxis=new s.Vector3,this.tempOrientation=new s.Quaternion,this.currentOrientation=new s.Quaternion,this.tempEuler=new s.Euler,this.cameraModule=e,this.transition={active:!1,startTime:0,elapsed:0,duration:0,velocity:new s.Vector2,easeOut:!1}}setLookAcceleration(e,t=!1){this.transition.active||(t&&(e.x&&this.lookVelocity.x&&Math.sign(e.x)!==Math.sign(this.lookVelocity.x)&&(this.lookVelocity.x=0),e.y&&this.lookVelocity.y&&Math.sign(e.y)!==Math.sign(this.lookVelocity.y)&&(this.lookVelocity.y=0)),this.lookAccel.x=void 0!==e.x?e.x:this.lookAccel.x,this.lookAccel.y=void 0!==e.y?e.y:this.lookAccel.y)}startTransition(e,t,i){const n=new h.Q;return this.transition.active=!0,this.transition.duration=e,this.transition.elapsed=0,this.transition.startTime=Date.now(),this.transition.deferred=n,this.transition.velocity.copy(t),this.transition.easeOut=i,this.lookAccel.set(0,0),this.lookVelocity.copy(t),this.cameraModule.beginExternalTransition(),n.promise()}stopTransition(){this.transition.active&&(this.cameraModule.endExternalTransition(),this.transition.active=!1),this.transition.deferred&&(this.transition.deferred.resolve(),this.transition.deferred=void 0)}updateTransition(e){const t=e/o.SI;if(this.lookVelocity.copy(this.transition.velocity),this.transition.elapsed+=e,this.transition.elapsed>=this.transition.duration){const t=this.transition.duration-(this.transition.elapsed-e);this.lookVelocity.multiplyScalar(t/e)}else this.lookVelocity.multiplyScalar(t)}updateCameraParameters(){const e=this.cameraModule.getData(!1);this.tempEuler.setFromQuaternion(e.pose.rotation,"YXZ");const t=this.tempEuler.x,i=(0,l.uZ)(this.lookVelocity.y,o.zf-t,o.uQ-t);this.tempAxis.copy(r.f.RIGHT),this.tempOrientation.setFromAxisAngle(this.tempAxis.applyQuaternion(e.pose.rotation),i),this.currentOrientation.copy(e.pose.rotation).premultiply(this.tempOrientation),this.tempOrientation.setFromAxisAngle(r.f.UP,this.lookVelocity.x),this.currentOrientation.premultiply(this.tempOrientation),e.pose.rotation.equals(this.currentOrientation)||(this.tempOrientation.copy(this.currentOrientation).normalize(),this.cameraModule.updateCameraRotation(this.tempOrientation))}update(e){const t=this.cameraModule.getData(!1),i=e/o.SI;t.pose.rotation.equals(this.currentOrientation)||this.currentOrientation.copy(t.pose.rotation),this.transition.active?(this.updateTransition(e),this.updateCameraParameters(),this.transition.elapsed>=this.transition.duration&&(this.stop(this.transition.easeOut),this.transition.active=!1)):(this.lookAccel.length()>a.Z.epsilon||this.lookVelocity.length()>a.Z.epsilon)&&(this.lookVelocity.addScaledVector(this.lookAccel,i),this.updateCameraParameters(),this.lookVelocity.multiplyScalar(Math.pow(1-o.O8,i)))}stop(e=!1){this.stopTransition(),this.lookAccel.set(0,0),e||this.lookVelocity.set(0,0)}startRotateTransition(e,t,i){const n=this.cameraModule.getData(!1);return n.transition&&n.transition.activeInternal&&n.transition.to.rotation&&(n.transition.to.rotation=void 0),this.startTransition(e,t.clone().multiplyScalar(o.SI),i).nativePromise()}startTranslateTransition(e,t,i=!0){throw new Error("Panning isn't supported in Panorama Controls")}startZoomTransition(e,t,i){throw new Error("Zooming isn't supported in Panorama Controls")}}var d=i(77719),u=i(35597),p=i(19047),m=i(94329),g=i(76870),f=i(81507),v=i(88216),y=i(68576),b=i(51869),S=i(88727),E=i(13988),w=i(33874),T=i(736);const _="Rotation speed";class PanoramaControls extends n.Y{constructor(){super(...arguments),this.name="panorama-controls",this.controlsEngaged=!1,this.lookAccelerationSpeed=o.WI,this.calcRotationAngle=(()=>{const e=new s.Matrix4,t=new s.Vector3,i=new s.Vector3;return(n,r,o)=>{const a=n.getData(!1);e.copy(a.pose.projection.asThreeMatrix4()),e.invert(),t.set(r.x-o.x,r.y-o.y,-1).applyMatrix4(e),i.set(r.x,r.y,-1).applyMatrix4(e);const l=Math.sqrt(t.x*t.x+t.z*t.z),c=Math.sqrt(i.x*i.x+i.z*i.z),h=Math.atan2(t.y,l),d=Math.atan2(i.y,c)-h;t.y=0,i.y=0,t.normalize(),i.normalize();const u=Math.acos(t.dot(i));let p=0;return isNaN(u)||(p=u,o.x>0&&(p*=-1)),new s.Vector2(-p,-d)}})()}async init(e,t){const i=await t.getModule(d.default);this.controls=new CameraControls(i);(await t.getModule(E.default)).addControls(m.Ey.Panorama,this.controls),this.market=t.market,this.bindings.push(t.subscribe(y.Z,(e=>{this.controls.stop()}))),t.getModuleBySymbol(T.y.INPUT).then((e=>{e.registerHandler(b.E0,(e=>{this.validateViewmode()&&this.controls.stop()})),e.registerHandler(b._t,(e=>{this.validateViewmode()&&e.buttons&g.r3.PRIMARY&&(this.controlsEngaged=!0,this.onDrag(i,e.position,e.delta),this.controls.update(o.SI),this.controls.stop())})),e.registerHandler(b._R,(e=>{this.validateViewmode()&&this.controlsEngaged&&(e.timeSinceLastMove<100&&!(e.buttons&g.r3.PRIMARY)&&(this.onDrag(i,e.position,e.delta),this.controls.update(o.SI),this.controls.setLookAcceleration({x:0,y:0})),this.controlsEngaged=!1)})),e.registerHandler(S.e,(e=>{this.validateViewmode()&&this.onKey(e.key,e.state)}))}))}onUpdate(e){this.validateViewmode()&&this.controls.update(e)}onDrag(e,t,i){this.controls.setLookAcceleration(this.calcRotationAngle(e,t,i))}onKey(e,t){let i=null;const n=this.market.tryGetData(w.e);n&&(i=n.tryGetProperty(_,null)),this.lookAccelerationSpeed=i?i*(Math.PI/180)/60:this.lookAccelerationSpeed;const s=t===v.M.DOWN;switch(e){case f.R.LEFTARROW:case f.R.J:this.controls.setLookAcceleration({x:s?this.lookAccelerationSpeed:0},!0);break;case f.R.RIGHTARROW:case f.R.L:this.controls.setLookAcceleration({x:s?-this.lookAccelerationSpeed:0},!0);break;case f.R.K:this.controls.setLookAcceleration({y:s?-this.lookAccelerationSpeed:0},!0);break;case f.R.I:this.controls.setLookAcceleration({y:s?this.lookAccelerationSpeed:0},!0)}}validateViewmode(){const e=this.market.tryGetData(u.O),t=this.market.tryGetData(p.Z);return!e||!t||e.isPano()&&!t.isVR()}}},61709:(e,t,i)=>{"use strict";i.d(t,{z:()=>InstancedPinHeads});var n=i(48358),s=i(88512),r=i(2212),o=i(4299),a=i(79386);const l=new s.Z("InstancedPinHeads");class InstancedPinHeads extends r.InstancedMesh{constructor(e,t,i,s){const l=new r.PlaneBufferGeometry(a.l,a.l),c=new Float32Array(e),h=new r.InstancedBufferAttribute(c,1);l.setAttribute("instanceAlpha",h);super(l,s&&i?new o.Vp(t,i):new o.m0(t,!0),e),this.maxCount=e,this.opacityArray=c,this.opacityAttrib=h,this.setColorAt(0,new r.Color),this.renderedPins=[],this.renderOrder=n.z.pins}update(e){let t=0;this.renderedPins.length=0;for(const i of e)i.visible&&(t>=this.maxCount?l.error("Instance count is too small!"):(this.setMatrixAt(t,i.pinHeadMatrix),this.setColorAt(t,i.pinColor),this.opacityArray[t]=i.opacity*i.opacityAnimation.value,t++,this.renderedPins.push(i)));this.count=t,this.visible=this.count>0,this.instanceMatrix.needsUpdate=!0,this.opacityAttrib.needsUpdate=!0,this.instanceColor?this.instanceColor.needsUpdate=!0:l.error("Instance color should be defined")}}},40554:(e,t,i)=>{"use strict";i.d(t,{$:()=>PinHeadMesh});var n=i(68524),s=i(48358),r=i(2212),o=i(49487),a=i(27408),l=i(79386);class PinHeadMesh extends r.Mesh{constructor(e,t,i,n){super(t,i),this.geomScale=new r.Vector3(1,1,1),this.userData.sid=e,this.worldPosition=new r.Vector3,this.cameraPosition=new r.Vector3,this.layers.mask=n.mask,this.renderOrder=s.z.pins,this.scale.set(.01,.01,.01)}dispose(){this.material.dispose(),this.geometry.dispose()}updatePosition(e){this.position.copy(e.stemNormal).setLength(Math.max(e.stemLength,.01))}update(e,t,i){const s=l.Z.pinHeadMesh.scale;this.getWorldPosition(this.worldPosition);const c=e.getWorldPosition(this.cameraPosition).distanceTo(this.worldPosition);this.quaternion.copy(e.quaternion);const h=s.maxSize-(s.maxSize-s.minSize)*(0,o.C)(c,s.nearBound,s.farBound),d=this.worldPosition.clone().project(e),u=new r.Vector3(i.width/2,i.height/2,1).multiply(d),p=new r.Vector3(h/2,0,0).add(u),m=new r.Vector3(2/i.width,2/i.height,1).multiply(p).clone().unproject(e).clone().distanceTo(this.worldPosition)*(1+s.responsiveness/100*(t-1)),g=(0,a.uZ)(m,n.Z.epsilon,m);this.scale.set(g*this.geomScale.x,g*this.geomScale.y,g*this.geomScale.z)}}},4299:(e,t,i)=>{"use strict";i.d(t,{Vp:()=>InstancedPinHeadMaterial,uW:()=>InstancedPinStemMaterial,m0:()=>PinHeadCustomMaterial,Nv:()=>PinHeadMaterial,Dx:()=>PinSelectedMaterial,l0:()=>PinStemMaterial});var n=i(20855),s=i(2212),r=i(79386),o=i(31090),a=i(69383);const l={pinHead:{uniforms:{alpha:{type:"f",value:1},color:{type:"c",value:new s.Color},bg:{type:"t",value:null},mask:{type:"t",value:null}},vertexShader:(0,n.m)(a,i(34086)),fragmentShader:(0,n.m)(o,i(36888))},pinStem:{uniforms:{pinHeadMatrix:{value:new s.Matrix4},resolution:{value:new s.Vector2},alpha:{value:1}},vertexShader:(0,n.m)(a,i(18934)),fragmentShader:(0,n.m)(o,i(7532))},pinSelected:{vertexShader:(0,n.m)(a,i(18144)),fragmentShader:(0,n.m)(o,i(81713))}};var c=i(79826),h=i(64715);class PinHeadMaterial extends s.RawShaderMaterial{constructor(e,t,i,n){const r=s.UniformsUtils.clone(l.pinHead.uniforms);r.bg.value=t,r.mask.value=i,r.color.value.copy(e),r.alpha.value=n,super({fragmentShader:l.pinHead.fragmentShader,vertexShader:l.pinHead.vertexShader,uniforms:r,name:"PinHeadMaterial",transparent:!0})}}class PinStemMaterial extends s.RawShaderMaterial{constructor(){const e=s.UniformsUtils.clone(l.pinStem.uniforms);super({fragmentShader:l.pinStem.fragmentShader,vertexShader:l.pinStem.vertexShader,uniforms:e,name:"PinStemMaterial",linewidth:r.Z.stem.width,opacity:r.Z.stem.opacity,transparent:r.Z.stem.transparent,alphaTest:r.Z.stem.opacity*r.Z.stem.alphaTest})}}class InstancedPinStemMaterial extends s.RawShaderMaterial{constructor(){const e=s.UniformsUtils.clone(l.pinStem.uniforms);super({defines:{INSTANCED:!0},fragmentShader:l.pinStem.fragmentShader,vertexShader:l.pinStem.vertexShader,uniforms:e,name:"InstancedPinStemMaterial",linewidth:r.Z.stem.width,opacity:r.Z.stem.opacity,transparent:r.Z.stem.transparent,alphaTest:r.Z.stem.opacity*r.Z.stem.alphaTest})}}class InstancedPinHeadMaterial extends s.RawShaderMaterial{constructor(e,t){const i=s.UniformsUtils.clone(l.pinHead.uniforms);i.bg.value=e,i.mask.value=t,super({defines:{INSTANCED:!0},fragmentShader:l.pinHead.fragmentShader,vertexShader:l.pinHead.vertexShader,uniforms:i,name:"InstancedPinHeadMaterial",transparent:!0})}}class PinHeadCustomMaterial extends s.RawShaderMaterial{constructor(e,t){super({defines:{INSTANCED:t},vertexShader:(0,n.m)(a,c),fragmentShader:(0,n.m)(o,h),uniforms:{alpha:{value:1},tDiffuse:{value:e}},name:"InstancedPinHeadCustomMaterial",transparent:!0})}}class PinSelectedMaterial extends s.RawShaderMaterial{constructor(){super({depthTest:!0,depthWrite:!1,transparent:!0,side:s.DoubleSide,vertexShader:l.pinSelected.vertexShader,fragmentShader:l.pinSelected.fragmentShader})}}},32025:(e,t,i)=>{"use strict";i.d(t,{B:()=>PinsViewData});var n=i(32770),s=i(48715),r=i(42835);class PinsViewData extends n.V{constructor(){super(),this.name="pins-view-data",this.creatingPin=!1,this.pinStateObservable=(0,s.Y)(r.tS.IDLE),this.openPinObservable=(0,s.Y)(null),this.editableObservable=(0,s.Y)(!0),this.previewPinObservable=(0,s.Y)(null),this.progressObservable=(0,s.Y)(-1),this.screenPositionObservable=(0,s.Y)(null),this.canPlaceObservable=(0,s.Y)(!0),this.canAddObservable=(0,s.Y)(!0)}get creatingNewPin(){return this.creatingPin}updateOpenPin(e){const t=this.openPin;if(t){const i=Object.assign(Object.assign({},t),e);this.setOpenPin(i)}}setOpenPin(e){this.openPinObservable.value=e}get openPin(){return this.openPinObservable.value}onOpenPinChanged(e){return this.openPinObservable.onChanged(e)}setPreviewPin(e){this.previewPinObservable.value=e}get previewPin(){return this.previewPinObservable.value}onPreviewPinChanged(e){return this.previewPinObservable.onChanged(e)}setPinState(e){switch(e){case r.tS.IDLE:case r.tS.OPEN:case r.tS.PREVIEWING:this.creatingPin=!1;break;case r.tS.CREATING:this.creatingPin=!0}this.pinStateObservable.value=e}get pinState(){return this.pinStateObservable.value}onPinStateChanged(e){return this.pinStateObservable.onChanged(e)}setProgress(e){this.progressObservable.value=e}get progress(){return this.progressObservable.value}onProgressChanged(e){const t=this.progressObservable.onChanged(e);return t.renew(),t}get screenPosition(){return this.screenPositionObservable.value}setScreenPosition(e){this.screenPositionObservable.value=e}onScreenPositionChanged(e){return this.screenPositionObservable.onChanged(e)}get isPinEditable(){return this.editableObservable.value}setEditablePin(e){this.editableObservable.value=e}get canAdd(){return this.canAddObservable.value}setCanAdd(e){this.canAddObservable.value=e}onCanAddChanged(e){return this.canAddObservable.onChanged(e)}get canPlace(){return this.canPlaceObservable.value}setCanPlace(e){this.canPlaceObservable.value=e}onCanPlaceChanged(e){return this.canPlaceObservable.onChanged(e)}}},38321:(e,t,i)=>{"use strict";i.d(t,{EP:()=>EnablePinEditingCommand,_l:()=>PreviewPinCommand,Ar:()=>SelectPinCommand,$b:()=>OpenPinCommand,fe:()=>AdjustPinStemLengthCommand,G3:()=>ClickAwayFromPinCommand,ip:()=>PlacePinCommand,I$:()=>MovePinCommand,tT:()=>CancelNewPinCommand});var n=i(17386),s=i(31278);class EnablePinEditingCommand extends n.m{constructor(e){super(),this.payload={enabled:e}}}class PreviewPinCommand extends n.m{constructor(e,t){super(),this.payload={pin:e,pinType:t}}}class SelectPinCommand extends n.m{constructor(e,t,i=s.n.Instant){super(),this.payload={id:e,pinType:t,transition:i}}}class OpenPinCommand extends n.m{constructor(e,t,i,n,s=-1){super(),this.payload={id:e,pinType:t,transition:i,attachmentId:n,listIndex:s}}}class AdjustPinStemLengthCommand extends n.m{constructor(e,t,i){super(),this.payload={id:e,pinType:t,stemLength:i}}}class ClickAwayFromPinCommand extends n.m{constructor(){super()}}class PlacePinCommand extends n.m{constructor(){super()}}class MovePinCommand extends n.m{constructor(e,t){super(),this.payload={id:e,pos:t}}}class CancelNewPinCommand extends n.m{constructor(){super()}}},42835:(e,t,i)=>{"use strict";var n,s,r,o;i.d(t,{Er:()=>n,K_:()=>s,tS:()=>r,Od:()=>o}),function(e){e.MATTERTAG="mattertag",e.NOTE="note"}(n||(n={})),function(e){e.DEFAULT="default",e.HIGHLIGHTED="highlighted",e.DIMMED="dimmed"}(s||(s={})),function(e){e.IDLE="idle",e.CREATING="creating",e.PRESSING="pressing",e.PLACING="placing",e.PLACED="placed",e.PREVIEWING="previewing",e.SELECTED="selected",e.OPEN="open",e.EDITING="editing"}(r||(r={})),function(e){e.UP="up",e.UP_LEFT="up-left",e.UP_RIGHT="up-right",e.DOWN="down",e.DOWN_LEFT="down-left",e.DOWN_RIGHT="down-right",e.LEFT="left",e.RIGHT="right"}(o||(o={}))},41591:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AdjustPinStemLengthCommand:()=>Q.fe,CancelNewPinCommand:()=>Q.tT,ClickAwayFromPinCommand:()=>Q.G3,EnablePinEditingCommand:()=>Q.EP,FocusPinAnnotationMessage:()=>X.nY,MovePinCommand:()=>Q.I$,OpenPinCommand:()=>Q.$b,PinAddCancelledMessage:()=>X.hu,PinAnchorMesh:()=>PinAnchorMesh,PinClickedMessage:()=>X.F7,PinClosedMessage:()=>X.A,PinColorVariant:()=>j.K_,PinDeletedMessage:()=>X.VZ,PinDeselectMessage:()=>X.Fe,PinDiscardedMessage:()=>X.w0,PinEditor:()=>PinEditor,PinHeadMesh:()=>K.$,PinHoverChangeMessage:()=>X.tP,PinMovedMessage:()=>X.bV,PinOpenedMessage:()=>X.sD,PinPlacedMessage:()=>X.b0,PinPreviewDirection:()=>j.Od,PinRenderer:()=>PinRenderer,PinSelectedMessage:()=>X.Q4,PinStartCreatingMessage:()=>X.nO,PinState:()=>j.tS,PinType:()=>j.Er,PinUpdatedMessage:()=>X.KR,PinsViewData:()=>M.B,PlacePinCommand:()=>Q.ip,PreviewPinCommand:()=>Q._l,SelectPinCommand:()=>Q.Ar,default:()=>be});var n=i(2212),s=i(47724),r=i(736),o=i(17399),a=i(27687),l=i(31278),c=i(60771),h=i(21479),d=i(40168),u=i(27326),p=i(19047),m=i(59088),g=i(75892),f=i(35597),v=i(94329),y=i(51764),b=i(88814),S=i(35015),E=i(8150),w=i(66157),T=i(65049),_=i(2904),M=i(32025),x=i(17490),A=i(51245),O=i(76541),P=i(37606),D=i(36123),C=i(14092);var I=i(4901),L=i(25269),R=i(88512),N=i(24764),k=i(76863),B=i(76870),F=i(49340),U=i(51869),V=i(33665),H=i(35003),G=i(88727),z=i(88216),W=i(81507),j=i(42835),K=i(40554),q=i(48358),Z=i(66223),Y=i(30749),$=i(79386);class PinAnchorMesh extends n.Mesh{constructor(e){super(new n.PlaneBufferGeometry($.Z.anchor.size,$.Z.anchor.size),new n.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,map:PinAnchorMesh.getTexture(),side:n.DoubleSide})),this.visible=!1,this.layers.mask=e.mask,this.renderOrder=q.z.pins}static getTexture(){return PinAnchorMesh.anchorTexture||(PinAnchorMesh.anchorTexture=(0,Z.p)(Y)),PinAnchorMesh.anchorTexture}}var Q=i(38321),X=i(48470),J=i(26627),ee=i(95586),te=i(29422),ie=i(59167),ne=i(56241);class PinEditor{constructor(e,t,i,s){this.viewData=e,this.engine=t,this.input=i,this.pinRenderer=s,this.bindings=[],this.externalBehaviorsBlocked=!1,this.touchDevice=(0,c.Jm)(),this.longPressCreateThreshold=500,this.ndcPoint=new n.Vector3,this.movingPin=!1,this.anchored=!1,this.inAnchorClick=!1,this.log=new R.Z("note-editor"),this.stopEventPropagation=()=>!0,this.updateMeshPreviewSphere=async(e,t)=>{this.engine.commandBinder.issueCommand(new ie.n(e,t))},this.startPinCreation=()=>{this.creatingHandlers.renew(),this.touchDevice||this.engine.commandBinder.issueCommand(new I.u(C.C.XHAIR)),this.engine.commandBinder.issueCommand(new ee.ZD)},this.endPinCreation=()=>{this.draggingHandlers.cancel(),this.creatingHandlers.cancel(),this.clearLongPressTimeout(),this.allowExternalBehaviors(!0),this.engine.commandBinder.issueCommand(new I.u(C.C.DEFAULT)),this.engine.commandBinder.issueCommand(new ee.zd)},this.onOpenPinChanged=()=>{this.updateAnchorMesh()},this.onPinStateUpdated=()=>{const e=this.viewData.pinState;switch(this.updateAnchorMesh(),e){case j.tS.PLACING:this.draggingHandlers.renew();break;case j.tS.IDLE:this.allowExternalBehaviors(!0)}},this.updateAnchorMesh=()=>{const{openPin:e,pinState:t}=this.viewData;e?t===j.tS.SELECTED?this.selectedHandlers.renew():[j.tS.PLACING,j.tS.PLACED,j.tS.EDITING].includes(t)&&(this.pinRenderer.showAnchorMesh(e.pinType,e.id,e),this.anchored=!0,this.selectedHandlers.renew()):(this.selectedHandlers.cancel(),this.anchored&&(this.removePinAnchorMesh(),this.pinRenderer.hideSelectedMesh(),this.updateMeshPreviewSphere(!1)))},this.clearLongPressTimeout=()=>{this.longPressStart=0,-1!==this.longPressTimeout&&window.clearTimeout(this.longPressTimeout),this.longPressTimeout=-1},this.placePin=()=>{const e=this.viewData;e.pinState===j.tS.PLACING&&(e.setPinState(j.tS.PLACED),this.engine.commandBinder.issueCommand(new I.u(C.C.DEFAULT)),this.engine.commandBinder.issueCommand(new Q.ip),this.engine.broadcast(new X.nY),this.updateMeshPreviewSphere(!1))},this.onDragEvent=e=>{e.buttons!==B.r3.PRIMARY&&(this.touchDevice||this.viewData.openPin)||this.positionPin(e)},this.onDragEnd=e=>{const{openPin:t,creatingNewPin:i,pinState:n}=this.viewData;if((!i||this.touchDevice||n!==j.tS.PLACING)&&t&&!i){const e={anchorPosition:t.anchorPosition,stemNormal:t.stemNormal,floorId:t.floorId,roomId:t.roomId,stemLength:t.stemLength,stemEnabled:t.stemEnabled,color:t.color};this.engine.commandBinder.issueCommand(new Q.I$(t.id,e)),this.updateMeshPreviewSphere(!1)}},this.positionPin=(()=>{const e=new n.Vector3;return async t=>{if(this.touchDevice&&t.buttons!==B.r3.PRIMARY)return!1;const i=this.viewData,n=i.pinState;if(n===j.tS.CREATING)this.engine.commandBinder.issueCommand(new ne.y(!0));else if(n!==j.tS.PLACING&&!this.movingPin)return!1;const s=i.openPin;if(!s)return!1;this.saveScreenPosition(t.position.x,t.position.y);const r=this.getModelIntersection();if(r&&r.face){this.engine.commandBinder.issueCommand(new I.u(C.C.XHAIR)),i.setCanPlace(!0);const t=((e,t)=>A.$4.hasFloorId(t.object)?t.object.floorId:e.getClosestFloorAtHeight(t.point.y).id)(this.floorsData,r);if(null===t)return!1;const o=A.$4.hasRoomId(r.object)?r.object.roomId:void 0;return e.copy(s.stemNormal).setLength(s.stemLength),this.updateMeshPreviewSphere(!0,s.anchorPosition),i.updateOpenPin({anchorPosition:s.anchorPosition.copy(r.point),stemNormal:s.stemNormal.copy(r.face.normal).normalize(),floorId:t,roomId:o}),n===j.tS.CREATING&&i.setPinState(j.tS.PLACING),!0}return this.engine.commandBinder.issueCommand(new I.u(C.C.NOPE)),i.setCanPlace(!1),!1}})(),this.allowExternalBehaviors=async e=>{e||this.externalBehaviorsBlocked?e&&this.externalBehaviorsBlocked&&(this.dragInterceptor.cancel(),this.engine.commandBinder.issueCommand(new te.Lp),this.externalBehaviorsBlocked=!1):(this.dragInterceptor.renew(),this.engine.commandBinder.issueCommand(new te.ZK),this.externalBehaviorsBlocked=!0)},this.getModelIntersection=()=>{const e=.5*$.Z.anchor.size;return this.fatcaster.cast(e,k.Nr,P.a.Filter.CENTER_GROUP(e))},this.onPointerButton=e=>{e.down||this.viewData.pinState!==j.tS.PLACED||(this.allowExternalBehaviors(!0),this.engine.commandBinder.issueCommand(new ne.y(!1)))},this.onAnchorSelect=e=>{const t=this.viewData;if(!t.openPin||e.button!==B.MP.PRIMARY)return;t.pinState===j.tS.EDITING&&(e.down?(this.movingPin=!0,this.allowExternalBehaviors(!1),this.draggingHandlers.renew(),this.engine.commandBinder.issueCommand(new I.u(C.C.GRABBING)),this.engine.commandBinder.issueCommand(new ne.y(!0)),this.inAnchorClick=!0):(this.doneMovingPin(),this.inAnchorClick=!1))},this.doneMovingPin=()=>{this.viewData.openPin&&this.movingPin&&(this.draggingHandlers.cancel(),this.engine.commandBinder.issueCommand(new I.u(null)),this.engine.commandBinder.issueCommand(new ne.y(!1)),this.movingPin=!1,this.allowExternalBehaviors(!0),this.updateMeshPreviewSphere(!1))},this.onClickElsewhere=e=>{const{openPin:t,pinState:i}=this.viewData;if(!(i===j.tS.CREATING&&t||this.inAnchorClick))return t&&(this.movingPin?this.doneMovingPin():this.engine.commandBinder.issueCommand(new Q.G3)),!0},this.onLongPressStart=async e=>{if(e.buttons!==B.r3.PRIMARY)return;const t=this.viewData;t.pinState===j.tS.CREATING&&(this.longPressStart=Date.now(),t.setPinState(j.tS.PRESSING),this.allowExternalBehaviors(!1),this.saveScreenPosition(e.position.x,e.position.y),this.longPressTimeout=window.setTimeout((async()=>{t.setPinState(j.tS.PLACING);await this.positionPin(e)||(t.setPinState(j.tS.CREATING),t.setCanPlace(!1)),this.longPressTimeout=-1}),this.longPressCreateThreshold))},this.onLongPressEnd=()=>{const e=this.viewData.pinState;e===j.tS.PRESSING?(this.log.debug("Did not press long enough"),this.endPinCreation()):e===j.tS.PLACING&&this.placePin()},this.onPointerEvent=e=>{const t=this.viewData.pinState;t!==j.tS.PLACING&&t!==j.tS.CREATING||this.positionPin(e)},this.onClickToPlacePin=()=>{this.placePin()},this.onKeyEvent=e=>{if(e.state===z.M.PRESSED)switch(e.key){case W.R.ESCAPE:this.viewData.creatingNewPin&&this.engine.commandBinder.issueCommand(new Q.tT)}},Promise.all([t.market.waitForData(m.M_),t.market.waitForData(J.i),t.getModule(O.default)]).then((([e,t,i])=>{this.cameraData=e,this.floorsData=t,this.fatcaster=i,this.registerHandlers()}))}dispose(){this.removePinAnchorMesh(),this.updateMeshPreviewSphere(!1),this.dragInterceptor.cancel(),this.creatingHandlers.cancel(),this.draggingHandlers.cancel(),this.selectedHandlers.cancel(),this.bindings.forEach((e=>{e.cancel()}))}update(){const e=this.viewData;if(this.touchDevice&&e.pinState===j.tS.PRESSING){const t=Math.min(1,(Date.now()-this.longPressStart)/this.longPressCreateThreshold);e.setProgress(t)}}registerHandlers(){const e=this.input;this.bindings.push(this.viewData.onPinStateChanged(this.onPinStateUpdated),this.viewData.onOpenPinChanged(this.onOpenPinChanged),e.registerPriorityHandler(F.er,K.$,this.stopEventPropagation)),this.dragInterceptor=new x.V(e.registerPriorityHandler(U._t,D.S,(()=>!0)),e.registerPriorityHandler(U._t,L.i,(()=>!0))),this.dragInterceptor.cancel(),this.draggingHandlers=new x.V(e.registerUnfilteredHandler(U._t,this.onDragEvent),e.registerUnfilteredHandler(U._R,this.onDragEnd)),this.draggingHandlers.cancel(),this.touchDevice?(this.creatingHandlers=new x.V(e.registerHandler(F.er,this.onPointerButton),e.registerUnfilteredHandler(V.Vh,this.onLongPressStart),e.registerUnfilteredHandler(V.pt,this.onLongPressEnd)),this.selectedHandlers=new x.V(e.registerMeshHandler(F.er,N.s.isType(PinAnchorMesh),this.onAnchorSelect),e.registerPriorityHandler(H.R,D.S,this.onClickElsewhere),e.registerPriorityHandler(H.R,L.i,this.onClickElsewhere))):(this.creatingHandlers=new x.V(e.registerHandler(G.e,this.onKeyEvent),e.registerHandler(F.er,this.onPointerButton),e.registerUnfilteredHandler(H.R,this.onClickToPlacePin),e.registerHandler(F.mE,this.onPointerEvent)),this.selectedHandlers=new x.V(e.registerMeshHandler(F.er,N.s.isType(PinAnchorMesh),this.onAnchorSelect),e.registerPriorityHandler(H.R,D.S,this.onClickElsewhere),e.registerPriorityHandler(H.R,L.i,this.onClickElsewhere))),this.creatingHandlers.cancel(),this.selectedHandlers.cancel()}removePinAnchorMesh(){this.pinRenderer.hideAnchorMesh(),this.anchored=!1}saveScreenPosition(e,t){this.ndcPoint.set(e,t,0);const i=(0,a.fi)(this.cameraData.width,this.cameraData.height,this.ndcPoint);this.viewData.setScreenPosition(i)}}var se=i(94610),re=i(70179),oe=i(21922),ae=i(79437),le=i(4299);class PinSelectedMesh extends n.Mesh{constructor(e){super(new n.PlaneBufferGeometry($.Z.anchor.size,$.Z.anchor.size),new le.Dx),this.visible=!1,this.layers.mask=e.mask,this.renderOrder=q.z.pinSelectedHalo}}class PinRenderer{constructor(e,t,i,s){this.input=e,this.layer=t,this.commandBinder=i,this.raycaster=s,this.container=new n.Object3D,this.floorIdToContainer=new Map,this.hexColorToColor=new Map,this.bindings=[],this.anchor=null,this.selected=null,this.haloEasing=(0,ae.tf)(.5,.52,0,1.98),this.pinsWithOverrideTexture=new Set,this.updateAnchorPosition=(()=>{const e=new n.Vector3,t=new n.Vector3,i=new n.Vector3;return n=>{const s=this.anchorMesh;if(!s)return;const r=this.raycaster.picking;e.copy(n.stemNormal).normalize(),t.copy(e).multiplyScalar(.2).add(n.anchorPosition),i.copy(e).multiplyScalar(-1);const o=r.pick(t,i,(e=>e instanceof oe.g));if(o){const e=Math.min(.2,o.distance);s.position.copy(t).add(i.multiplyScalar(.999*e))}else s.position.copy(t).add(i.multiplyScalar(.999*n.stemLength));s.lookAt(t)}})(),this.onAnchorHover=()=>{this.commandBinder.issueCommand(new I.u(C.C.GRAB)),this.commandBinder.issueCommand(new ne.y(!0))},this.onAnchorUnhover=()=>{this.commandBinder.issueCommand(new I.u(null)),this.commandBinder.issueCommand(new ne.y(!1))}}init(){this.container.name="PinContainer",this.container.layers.mask=this.layer.mask,this.anchorMesh=new PinAnchorMesh(this.layer),this.anchorMesh.name="Anchor Mesh",this.container.add(this.anchorMesh),this.selectedMesh=new PinSelectedMesh(this.layer),this.selectedMesh.name="Selected Mesh",this.container.add(this.selectedMesh)}dispose(){this.container.parent&&this.container.parent.remove(this.container);for(const e of[this.anchorMesh,this.selectedMesh])e&&e.parent&&e.parent.remove(e)}activate(e){this.bindings.length>0||this.bindings.push(this.input.registerMeshHandler(se.z,N.s.isType(PinAnchorMesh),this.onAnchorHover),this.input.registerMeshHandler(se.A,N.s.isType(PinAnchorMesh),this.onAnchorUnhover))}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings.length=0}render(e){if(!this.selected)return;const{animation:t,hideWhenDoneAnimating:i}=this.selected,s=this.selectedMesh;if(s&&s.visible&&t){const e=this.pinHeadTransform(this.selected.id),r=new n.Vector3,o=new n.Quaternion,a=new n.Vector3;e.decompose(r,o,a),a.multiplyScalar(t.getUpdatedValue()),i&&!t.isAnimating?(s.visible=!1,this.selected=null):(s.position.copy(r),s.quaternion.copy(o),s.scale.copy(a))}}updatePin(e,t,i,n,s,r){this.anchorMesh&&this.anchorMesh.visible&&this.anchor&&this.anchor.pinType===t&&this.anchor.id===e&&this.updateAnchorPosition(i)}removePin(e){this.selected&&this.selected.id===e&&this.clearSelected()}removePinsByType(e){this.removePinsByPredicate((t=>t===e))}removePinsByPredicate(e){}setPinVisible(e,t){}setPinColorVariant(e,t){}setPinColorVariants(e,t){}setPinColorVariantByType(e,t,i){}setPinOpacity(e,t){}setPinOpacityByType(e,t,i){}fadePinOpacity(e,t){}fadePinOpacityByType(e,t,i=[]){}setPinRenderOverrides(e,t,i){t?(this.pinsWithOverrideTexture.add(e),this.selected&&this.selected.id===e&&this.clearSelected()):this.pinsWithOverrideTexture.delete(e)}setFloorsHidden(e){this.floorIdToContainer.forEach(((t,i)=>{t.visible=!e(i)}))}setPinTypeVisible(e,t){this.floorIdToContainer.forEach((i=>{i.userData.typeContainers[e].visible=t}))}showAnchorMesh(e,t,i){this.anchor={pinType:e,id:t},this.anchorMesh&&!this.anchorMesh.visible&&(this.anchorMesh.visible=!0,this.input.registerMesh(this.anchorMesh,!1)),this.updateAnchorPosition(i)}hideAnchorMesh(){this.anchorMesh&&this.anchorMesh.visible&&(this.anchorMesh.visible=!1,this.input.unregisterMesh(this.anchorMesh))}showSelectedMesh(e,t){const i=this.selected&&this.selected.pinType===e&&this.selected.id===t;this.selected&&i||this.pinsWithOverrideTexture.has(t)||(this.selected={pinType:e,id:t,hideWhenDoneAnimating:!1,animation:new re.Z({startValue:10,endValue:14,duration:300,easingFunction:this.haloEasing})},this.selectedMesh.visible=!0)}hideSelectedMesh(){this.selected&&(this.selected.animation=new re.Z({startValue:14,endValue:10,duration:300}),this.selected.hideWhenDoneAnimating=!0)}getFloorContainer(e){let t=this.floorIdToContainer.get(e);if(t)return t;t=new n.Object3D,t.name="Floor "+e,t.userData.typeContainers={},t.layers.mask=this.layer.mask;for(const e of Object.values(j.Er)){const i=new n.Object3D;i.name=e,i.layers.mask=this.layer.mask,t.add(i),t.userData.typeContainers[e]=i}return this.container.add(t),this.floorIdToContainer.set(e,t),t.userData.floorId=e,t}getColor(e){let t=this.hexColorToColor.get(e);if(t)return t;const i=new n.Color(e),s={h:0,s:0,l:0};i.getHSL(s);return t={baseColor:i,hoverColor:(new n.Color).setHSL(s.h,s.s,.8*s.l),dimmedColor:(new n.Color).setHSL(s.h,.5*s.s,s.l)},this.hexColorToColor.set(e,t),t}getViewportScale(e){return Math.sqrt(Math.min(e.width,e.height)/$.Z.pinHeadMesh.scale.baseViewportSize)}clearSelected(){this.selectedMesh.visible=!1,this.selected=null}}class PinStemMesh extends n.Line{constructor(e,t,i,s,r){const o=new n.BufferGeometry,a=new Float32Array(6);a[0]=a[1]=a[2]=0,a[3]=e.x,a[4]=e.y,a[5]=e.z,o.setAttribute("position",new n.BufferAttribute(a,3));const l=new le.l0;super(o,l),this.geometry=o,this.layers.mask=i.mask,this.visible=t,this.vector=e.clone(),this.onBeforeRender=(e,t,i,n,o)=>{const a=o;a.uniforms.pinHeadMatrix.value.copy(s.matrixWorld),a.uniforms.resolution.value.set(r.width,r.height),a.uniformsNeedUpdate=!0},this.pinStemMaterial=l}dispose(){this.geometry.dispose()}updatePosition(e){this.vector.copy(e.stemNormal).setLength(Math.max(e.stemLength,.01));const t=this.geometry.getAttribute("position");t.setXYZ(1,this.vector.x,this.vector.y,this.vector.z),t.needsUpdate=!0}}function ce(e,t){switch(t){case j.K_.DEFAULT:return e.baseColor;case j.K_.DIMMED:return e.dimmedColor;case j.K_.HIGHLIGHTED:return e.hoverColor}}var he=i(17131);class PinMeshGroup extends n.Object3D{constructor(e,t,i,s,r,o,a,l){super(),this.pinId=e,this.pinType=t,this.pinColor=s,this.stemVector=new n.Vector3,this.stemEnabled=!0,this.currentColorVariant=j.K_.DEFAULT,this.baseOpacity=1,PinMeshGroup.pinHeadGeometry||(PinMeshGroup.pinHeadGeometry=new n.PlaneBufferGeometry($.l,$.l));const c=(new n.Color).copy(s.baseColor);this.pinHeadMeshMaterial=new le.Nv(c,a,l,1),this.pinHeadMesh=new K.$(e,PinMeshGroup.pinHeadGeometry,this.pinHeadMeshMaterial,r),this.add(this.pinHeadMesh),this.stemMesh=new PinStemMesh(i.stemNormal,i.stemEnabled,r,this.pinHeadMesh,o),this.add(this.stemMesh),this.updateMeshPosition(i),this.opacityAnimation=new he.z(1)}dispose(){this.remove(this.pinHeadMesh),this.pinHeadMesh.material.dispose(),this.pinHeadMesh.dispose(),this.remove(this.stemMesh),this.stemMesh.dispose()}static disposeAll(){PinMeshGroup.pinHeadGeometry.dispose()}updateFromPin(e,t,i,n){this.position.copy(e.anchorPosition),this.pinHeadMesh.updatePosition(e),this.stemVector.copy(e.stemNormal).setLength(e.stemLength),this.stemEnabled=e.stemEnabled,this.stemMesh.updatePosition(e),this.stemMesh.visible=e.stemEnabled,t!==this.pinColor&&(this.pinColor=t,this.setColorVariant(this.currentColorVariant));const s=this.pinHeadMeshMaterial.uniforms;s.bg.value===i&&s.mask.value===n||(s.bg.value=i,s.mask.value=n,this.pinHeadMeshMaterial.uniformsNeedUpdate=!0)}setColorVariant(e){const t=ce(this.pinColor,e);this.pinHeadMeshMaterial.uniforms.color.value.copy(t),this.currentColorVariant=e}setOpacity(e){this.baseOpacity=e,this.updateOpacity()}fadeOpacity(e){e>0&&(this.visible=!0),this.opacityAnimation.modifyAnimation(this.opacityAnimation.value,e,300).onComplete((()=>{e<=0&&(this.visible=!1)}))}setVisibility(e,t){this.visible=e,this.pinHeadMesh.visible=e,this.stemMesh.visible=e&&t}setStemEnabled(e){this.stemMesh.visible=this.visible&&e}updateMeshPosition(e){this.position.copy(e.anchorPosition),this.pinHeadMesh.updatePosition(e),this.stemMesh.updatePosition(e)}update(e,t,i,n){this.pinHeadMesh.update(t,i,n);const s=this.opacityAnimation.active;this.opacityAnimation.tick(e),s&&this.updateOpacity()}setRenderOverrides(e,t){this.pinHeadMesh.material=e?new le.m0(e,!1):this.pinHeadMeshMaterial,t?this.pinHeadMesh.geomScale.copy(t):this.pinHeadMesh.geomScale.set(1,1,1),this.setOpacity(this.pinHeadMeshMaterial.opacity)}updateOpacity(){const e=this.opacityAnimation.value*this.baseOpacity;if(this.pinHeadMeshMaterial.opacity=e,this.pinHeadMeshMaterial.uniforms.alpha.value=e,this.pinHeadMesh.material!==this.pinHeadMeshMaterial){this.pinHeadMesh.material.opacity=e;const t=this.pinHeadMesh.material;t&&t.uniforms&&t.uniforms.alpha&&(t.uniforms.alpha.value=e)}this.stemMesh.pinStemMaterial.uniforms.alpha.value=e}}class NonInstancedPinRenderer extends PinRenderer{constructor(e,t,i,n,s,r){super(e,n,s,r),this.camera=t,this.canvasData=i,this.idToMesh=new Map}dispose(){super.dispose(),this.removePinsByPredicate((()=>!0)),PinMeshGroup.disposeAll()}activate(e){this.bindings.length>0||(super.activate(e),this.bindings.push(this.input.registerPriorityHandler(H.R,K.$,((t,i)=>{const n=i.parent;return e.broadcast(new X.F7(n.pinId,n.pinType)),!0}))),(0,c.Jm)()||(this.bindings.push(this.input.registerMeshHandler(se.z,N.s.isType(K.$),((t,i)=>{const n=i.parent;e.broadcast(new X.tP(n.pinId,!0,n.pinType)),e.commandBinder.issueCommand(new I.u(C.C.FINGER)),e.commandBinder.issueCommand(new ne.y(!0))}))),this.bindings.push(this.input.registerMeshHandler(se.A,N.s.isType(K.$),((t,i)=>{const n=i.parent;e.broadcast(new X.tP(n.pinId,!1,n.pinType)),e.commandBinder.issueCommand(new I.u(null)),e.commandBinder.issueCommand(new ne.y(!1))})))))}render(e){const t=this.getViewportScale(this.canvasData);this.idToMesh.forEach((i=>{i.update(e,this.camera,t,this.canvasData)})),super.render(e)}updatePin(e,t,i,n,s,r){var o,a;super.updatePin(e,t,i,n,s,r);const l=this.getColor(i.color);let c=this.idToMesh.get(e);c||(c=new PinMeshGroup(e,t,i,l,this.layer,this.canvasData,n,s),this.idToMesh.set(e,c),this.input.registerMesh(c.pinHeadMesh,!1)),void 0!==r&&(c.visible=r),c.updateFromPin(i,l,n,s);const h=i.floorId;c.parent&&(null===(o=c.parent)||void 0===o?void 0:o.userData.floorId)===h||(c.parent&&(null===(a=c.parent)||void 0===a||a.remove(c)),this.getFloorContainer(h).userData.typeContainers[t].add(c))}removePin(e){var t;super.removePin(e);const i=this.idToMesh.get(e);i&&(this.idToMesh.delete(e),null===(t=i.parent)||void 0===t||t.remove(i),this.input.unregisterMesh(i.pinHeadMesh),i.dispose())}removePinsByPredicate(e){this.idToMesh.forEach(((t,i)=>{e(t.pinType)&&this.removePin(i)}))}setPinVisible(e,t){const i=this.idToMesh.get(e);i&&(i.visible=t)}setPinColorVariant(e,t){const i=this.idToMesh.get(e);i&&i.setColorVariant(t)}setPinColorVariants(e,t){this.idToMesh.forEach((i=>{i.pinId!==t&&i.setColorVariant(e)}))}setPinColorVariantByType(e,t,i){this.idToMesh.forEach((n=>{n.pinType===e&&n.pinId!==i&&n.setColorVariant(t)}))}setPinOpacity(e,t){const i=this.idToMesh.get(e);i&&i.setOpacity(t)}fadePinOpacity(e,t){const i=this.idToMesh.get(e);i&&i.fadeOpacity(t)}setPinOpacityByType(e,t,i){this.idToMesh.forEach((n=>{n.pinType===e&&n.pinId!==i&&n.setOpacity(t)}))}fadePinOpacityByType(e,t,i=[]){this.idToMesh.forEach((n=>{n.pinType!==e||i.includes(n.pinId)||n.fadeOpacity(t)}))}setPinRenderOverrides(e,t,i){super.setPinRenderOverrides(e,t,i);const n=this.idToMesh.get(e);n&&n.setRenderOverrides(t,i)}pinHeadTransform(e){const t=this.idToMesh.get(e);return t?t.pinHeadMesh.matrixWorld:new n.Matrix4}}var de=i(49487),ue=i(27408),pe=i(68524),me=i(12216),ge=i(61709);const fe=new le.uW,ve=new R.Z("InstancedPinHeads");class InstancedPinLines extends n.InstancedMesh{constructor(e){const t=new n.BufferGeometry,i=new Float32Array(6);i[0]=i[1]=i[2]=0,i[3]=1,i[4]=1,i[5]=1,t.setAttribute("position",new n.BufferAttribute(i,3));const s=new Float32Array(3*e),r=new n.InstancedBufferAttribute(s,3);t.setAttribute("stemVector",r);const o=new Float32Array(e),a=new n.InstancedBufferAttribute(o,1);t.setAttribute("instanceAlpha",a);const l=[],c=[];for(let i=0;i<4;i++){const s=new Float32Array(4*e),r=new n.InstancedBufferAttribute(s,4);t.setAttribute(`pinHeadMatrixCol${i}`,r),l.push(s),c.push(r)}super(t,fe,e),this.maxCount=e,this.stemVectorArray=s,this.stemVectorAttrib=r,this.pinHeadMatrixArray=l,this.pinHeadMatrixAttrib=c,this.opacityArray=o,this.opacityAttrib=a,this.renderOrder=q.z.lines,this.posMatrix=new n.Matrix4,this.isLine=!0,this.isMesh=!1}update(e,t){let i=0;for(const t of e){if(!t.visible||!t.stemEnabled||t.stemLength<.001)continue;if(i>=this.maxCount){ve.error("Instance count is too small!");continue}this.posMatrix.setPosition(t.anchorPosition),this.setMatrixAt(i,this.posMatrix),this.opacityArray[i]=t.opacity*t.opacityAnimation.value;const e=3*i;t.pinHeadObjPosition.toArray(this.stemVectorArray,e);let n=0;for(let e=0;e<4;e++)for(let s=0;s<4;s++)this.pinHeadMatrixArray[e][s+4*i]=t.pinHeadMatrix.elements[n++];i++}this.count=i,this.visible=this.count>0,this.instanceMatrix.needsUpdate=!0,this.stemVectorAttrib.needsUpdate=!0;for(const e of this.pinHeadMatrixAttrib)e.needsUpdate=!0;this.opacityAttrib.needsUpdate=!0,fe.uniforms.resolution.value.set(t.width,t.height),fe.uniformsNeedUpdate=!0}}const ye=new R.Z("InstancedPinRenderer");class InstancedPinRenderer extends PinRenderer{constructor(e,t,i,s,r,o){super(e,s,r,o),this.camera=t,this.canvasData=i,this.pins=new Map,this.idToPin=new Map,this.keyToRenderObjs=new Map,this.updatePinHeadMatrix=(()=>{const e=new n.Vector3,t=new n.Vector3,i=new n.Vector3,s=new n.Vector3,r=new n.Vector3,o=new n.Vector3,a=new n.Vector3;return n=>{const l=$.Z.pinHeadMesh.scale,c=this.getViewportScale(this.canvasData),h=1+l.responsiveness/100*(c-1);this.camera.getWorldPosition(o);const d=this.camera.quaternion,u=this.canvasData;for(const c of n){a.copy(c.pinHeadObjPosition).add(c.anchorPosition);const n=o.distanceTo(a),p=l.maxSize-(l.maxSize-l.minSize)*(0,de.C)(n,l.nearBound,l.farBound);t.copy(a).project(this.camera),i.set(u.width/2,u.height/2,1).multiply(t),s.set(p/2,0,0).add(i),r.set(2/u.width,2/u.height,1).multiply(s);const m=r.unproject(this.camera).distanceTo(a)*h,g=(0,ue.uZ)(m,pe.Z.epsilon,m),f=c.geomScale||me.f.UNIT;e.set(g*f.x,g*f.y,g*f.z),c.pinHeadMatrix.compose(a,d,e)}}})()}dispose(){super.dispose()}activate(e){this.bindings.length>0||(super.activate(e),this.bindings.push(this.input.registerPriorityHandler(H.R,ge.z,((t,i,n)=>{if(!n||void 0===n.instanceId)return!0;const s=i.renderedPins[n.instanceId];return e.broadcast(new X.F7(s.id,s.pinType)),!0}))),(0,c.Jm)()||(this.bindings.push(this.input.registerMeshHandler(se.z,N.s.isType(ge.z),((t,i,n)=>{if(!n||void 0===n.instanceId)return;const s=i.renderedPins[n.instanceId];this.lastHoverId=s.id,this.lastHoverType=s.pinType,e.broadcast(new X.tP(s.id,!0,s.pinType)),e.commandBinder.issueCommand(new I.u(C.C.FINGER)),e.commandBinder.issueCommand(new ne.y(!0))}))),this.bindings.push(this.input.registerMeshHandler(se.A,N.s.isType(ge.z),(()=>{e.broadcast(new X.tP(this.lastHoverId,!1,this.lastHoverType)),e.commandBinder.issueCommand(new I.u(null)),e.commandBinder.issueCommand(new ne.y(!1))})))))}render(e){for(const t of this.pins.values()){const i=Array.from(t.values());if(0===i.length)continue;const n=this.keyFromPin(i[0]),s=this.keyToRenderObjs.get(n);if(!s){ye.error("Expecting renderObjs for this key.",this.keyToRenderObjs,this.keyFromPin(i[0]));continue}let{lines:r,pinHeads:o}=s;if(i.forEach((t=>t.opacityAnimation.tick(e))),this.updatePinHeadMatrix(i),r.maxCount<i.length){const e=r.parent;if(!e){ye.error("Expecting a parent.");continue}e.remove(r),r.dispose(),e.remove(o),this.input.unregisterMesh(o);const{backgroundTexture:t,maskTexture:n,overrideTexture:a}=i[0];o.dispose(),Object.assign(s,this.createInstances(e,s.id,i.length+16,t,n,a)),r=s.lines,o=s.pinHeads}r.update(i,this.canvasData),o.update(i)}super.render(e)}updatePin(e,t,i,s,r,o){var a;super.updatePin(e,t,i,s,r,o);let l=this.idToPin.get(e);const c=i.floorId,h=this.getColor(i.color).baseColor,d=`${c}_${t}_${(null===(a=null==l?void 0:l.overrideTexture)||void 0===a?void 0:a.uuid)||s.uuid}`;if(!l){l=Object.assign(Object.assign({id:e},i),{visible:!0,opacity:1,pinType:t,opacityAnimation:new he.z(1),backgroundTexture:s,maskTexture:r,pinHeadMatrix:new n.Matrix4,pinHeadObjPosition:new n.Vector3,pinColor:h,colorVariant:j.K_.DEFAULT,overrideTexture:null,geomScale:null}),this.idToPin.set(e,l);let o=this.pins.get(d);o||(o=new Map,this.pins.set(d,o)),o.set(e,l),this.createRenderObjsForPin(l)}const u=this.keyFromPin(l);Object.assign(l,i,{pinType:t,textureId:s.uuid}),this.changePinHeadGroupIfNeeded(u,d,l),l.pinHeadObjPosition.copy(l.stemNormal).setLength(l.stemLength),l.pinColor=ce(this.getColor(l.color),l.colorVariant),void 0!==o&&this.setPinVisible(e,o)}removePin(e){super.removePin(e);const t=this.idToPin.get(e);if(!t)return;this.idToPin.delete(e);const i=this.keyFromPin(t),n=this.pins.get(i);n&&(n.delete(e),this.cleanupRenderObjIfNeeded(i))}removePinsByPredicate(e){this.idToPin.forEach(((t,i)=>{e(t.pinType)&&this.removePin(i)}))}setPinVisible(e,t){const i=this.idToPin.get(e);i?i.visible=t:ye.error("setPinVisible on a pin that doesn't exist.",e)}setPinColorVariant(e,t){const i=this.idToPin.get(e);i?(i.colorVariant=t,i.pinColor=ce(this.getColor(i.color),t)):ye.error("setPinColorVariant on a pin that doesn't exist.")}setPinColorVariants(e,t){this.idToPin.forEach(((i,n)=>{n!==t&&this.setPinColorVariant(n,e)}))}setPinColorVariantByType(e,t,i){this.idToPin.forEach(((n,s)=>{n.pinType===e&&s!==i&&this.setPinColorVariant(s,t)}))}setPinOpacity(e,t){const i=this.idToPin.get(e);i?i.opacity=t:ye.error("setPinOpacity on a pin that doesn't exist.")}fadePinOpacity(e,t){const i=this.idToPin.get(e);i?(t>0&&this.setPinVisible(e,!0),i.opacityAnimation.modifyAnimation(i.opacityAnimation.value,t,300).onComplete((()=>{t<=0&&this.setPinVisible(e,!1)}))):ye.error("setPinVisible on a pin that doesn't exist.",e)}setPinOpacityByType(e,t,i){this.idToPin.forEach(((n,s)=>{n.pinType===e&&s!==i&&this.setPinOpacity(s,t)}))}fadePinOpacityByType(e,t,i=[]){this.idToPin.forEach(((n,s)=>{n.pinType!==e||i.includes(s)||this.fadePinOpacity(s,t)}))}setPinRenderOverrides(e,t,i){super.setPinRenderOverrides(e,t,i);const n=this.idToPin.get(e);if(!n)return void ye.error("setPinRenderOverrides on a pin that doesn't exist.");const s=this.keyFromPin(n);if(!this.keyToRenderObjs.get(s))return void ye.error("Expecting renderObjs while setting override material");n.overrideTexture=t,n.geomScale=i;const r=this.keyFromPin(n);this.changePinHeadGroupIfNeeded(s,r,n)}pinHeadTransform(e){const t=this.idToPin.get(e);return t?t.pinHeadMatrix:(ye.error("pinHeadTransform on a pin that doesn't exist."),new n.Matrix4)}keyFromPin(e){return`${e.floorId}_${e.pinType}_${e.overrideTexture?e.overrideTexture.uuid:e.backgroundTexture.uuid}`}createRenderObjsForPin(e){const{backgroundTexture:t,maskTexture:i,overrideTexture:n}=e,s=this.keyFromPin(e);if(this.keyToRenderObjs.get(s))return;const r=this.getFloorContainer(e.floorId).userData.typeContainers[e.pinType];r.userData||(r.userData={});const o=e.overrideTexture?e.overrideTexture.uuid:e.backgroundTexture.uuid;if(!r.userData[o]){const e=this.createInstances(r,o,16,t,i,n);r.userData[o]=e,this.keyToRenderObjs.set(s,e)}}createInstances(e,t,i,n,s,r){const o=new InstancedPinLines(i);o.layers.mask=this.layer.mask,e.add(o);const a=new ge.z(i,r||n,r?null:s,!r);return a.layers.mask=this.layer.mask,e.add(a),this.input.registerMesh(a,!1),{lines:o,pinHeads:a,id:t}}changePinHeadGroupIfNeeded(e,t,i){if(e!==t){let n=this.pins.get(t);n||(n=new Map,this.pins.set(t,n)),n.set(i.id,i),this.createRenderObjsForPin(i);const s=this.pins.get(e);s&&(null==s||s.delete(i.id),this.cleanupRenderObjIfNeeded(e))}}cleanupRenderObjIfNeeded(e){const t=this.pins.get(e),i=this.keyToRenderObjs.get(e);if(t&&0===t.size&&i){const t=i.lines.parent;if(this.input.unregisterMesh(i.pinHeads),this.pins.delete(e),this.keyToRenderObjs.delete(e),!t)return void ye.error("Expecting pinTypeObj!");t.userData[i.id]=void 0,t.remove(i.lines),t.remove(i.pinHeads)}}}class PinsModule extends s.Y{constructor(){super(...arguments),this.name="pins",this.editActivated=!1,this.editBindings=[],this.touchDevice=(0,c.Jm)(),this.worldPosition=new n.Vector3,this.visibilityChanged=()=>{const e=!this.in360View(),t=!this.interactionmodeData.isVR();this.pinRenderer.container.visible=e&&t;const{floorsViewData:i}=this,n=this.viewmode===v.Ey.Dollhouse||this.viewmode===v.Ey.Floorplan,s=i.transition.progress.active?()=>!0:i.isHidden;this.pinRenderer.setFloorsHidden(n?s:()=>!1)},this.viewmodeChanged=e=>{this.viewmode=e.toMode,this.visibilityChanged()},this.onEnablePinEditing=async e=>{e.enabled?this.enableEditing():this.disableEditing()},this.applicationChanged=e=>{this.pinEditor&&(e.application,h.Mx.WORKSHOP)},this.updateRenderedPin=()=>{const{pinState:e,creatingNewPin:t,openPin:i,previewPin:n}=this.viewData;if(!t||[j.tS.PLACING,j.tS.PLACED,j.tS.EDITING].includes(e)){this.editActivated&&this.pinEditor.updateAnchorMesh();const e=n||i;if(e){const{id:t,pinType:i,backgroundTexture:n,maskTexture:s}=e;this.pinRenderer.updatePin(t,i,e,n,s),this.pinRenderer.setPinColorVariant(t,j.K_.HIGHLIGHTED),this.pinRenderer.setPinColorVariants(j.K_.DEFAULT,t)}else this.pinRenderer.setPinColorVariants(j.K_.DEFAULT)}},this.onPinUpdated=e=>{const t=Object.assign(Object.assign({},e.pin),{pinType:e.pinType});this.viewData.updateOpenPin(t),this.saveScreenPosition(t)},this.onPinSelected=e=>{const t=Object.assign(Object.assign({},e.pin),{pinType:e.pinType}),i=this.viewData;i.setPinState(j.tS.SELECTED),i.setOpenPin(t),this.saveScreenPosition(t)},this.onPinClosed=e=>{const{pinType:t,id:i}=e,{openPin:n,previewPin:s}=this.viewData,r=i===(null==n?void 0:n.id)?n:i===(null==s?void 0:s.id)?s:null;r&&r.pinType===t&&r.id===i&&(this.resetState(),r.id===(null==n?void 0:n.id)?this.viewData.setOpenPin(null):r.id===(null==s?void 0:s.id)&&this.viewData.setPreviewPin(null))},this.onPinOpened=e=>{const t=this.viewData,i=Object.assign(Object.assign({},e.pin),{pinType:e.pinType});t.setEditablePin(e.editable),t.setPinState(e.editable?j.tS.EDITING:j.tS.OPEN),t.setOpenPin(i),this.saveScreenPosition(i)},this.onStartPinCreation=e=>{const t=this.viewData,i=Object.assign(Object.assign({},e.pin),{pinType:e.pinType});t.setEditablePin(!0),t.setPinState(j.tS.CREATING),t.setOpenPin(i),this.pinEditor.startPinCreation()},this.onPreviewPinAnnotation=async e=>{const t=this.viewData,i=Object.assign(Object.assign({},e.pin),{pinType:e.pinType});t.pinState===j.tS.SELECTED&&t.setOpenPin(null),t.setPinState(j.tS.PREVIEWING),t.setPreviewPin(i),this.saveScreenPosition(i)},this.onOpenPin=async e=>{if(e.pinType!==j.Er.MATTERTAG||this.tagsEnabled)return this.openPin(e.id,e.pinType,e.transition,e.attachmentId,e.listIndex)},this.onSelectPin=async e=>{(e.pinType!==j.Er.MATTERTAG||this.tagsEnabled)&&this.selectPin(e.id,e.pinType,e.transition)},this.onPreviewStemLength=async e=>{const{openPin:t,isPinEditable:i}=this.viewData;i&&t&&t.id===e.id?this.viewData.updateOpenPin({stemLength:e.stemLength}):this.log.debug("Cannot preview stem length, not open for edit")},this.saveScreenPosition=(()=>{const e=new n.Vector3;return t=>{const i=this.viewData;e.copy(t.stemNormal).setLength(t.stemLength),this.worldPosition.copy(t.anchorPosition).add(e);const n=(0,a.q9)(this.cameraData,this.worldPosition);i.setScreenPosition(n.screenPosition)}})(),this.onCameraUpdate=()=>{const{creatingNewPin:e,previewPin:t,openPin:i}=this.viewData;!e&&t?this.saveScreenPosition(t):i&&this.saveScreenPosition(i)},this.onAssetOpened=e=>{this.viewData.setPreviewPin(null)},this.onToolToggled=e=>{e.open||this.resetState()},this.handleSweepChange=()=>this.handleSweepAndViewModeChange(),this.handleViewModeChange=()=>this.handleSweepAndViewModeChange(),this.cancelAndReset=()=>{const{creatingNewPin:e,openPin:t}=this.viewData;e&&t&&(this.pinRenderer.removePin(t.id),this.engine.broadcast(new X.hu(t.id,t.pinType))),this.viewData.setOpenPin(null),this.resetState()},this.resetState=()=>{const e=this.viewData;e.setEditablePin(!1),e.setCanPlace(!0),e.setScreenPosition(null),e.setPinState(j.tS.IDLE),e.setCanAdd(!this.in360View()),this.pinRenderer.hideSelectedMesh()},this.cancelPinCreation=async()=>{this.cancelAndReset()},this.onPinDeleted=e=>{const{pinType:t}=e;if(t===j.Er.MATTERTAG&&!this.tagsEnabled)return;this.pinRenderer.removePin(e.id);const{openPin:i}=this.viewData;(null==i?void 0:i.id)===e.id&&(null==i?void 0:i.pinType)===e.pinType&&this.cancelAndReset()},this.onPinClicked=e=>{const{pinType:t,id:i}=e;if(t!==j.Er.MATTERTAG||this.tagsEnabled)if(t===j.Er.MATTERTAG)this.selectPin(i,t,l.n.Interpolate);else{const{openPin:e}=this.viewData,n=i===(null==e?void 0:e.id)&&t===(null==e?void 0:e.pinType);e&&this.deselectPin(e),n||this.openPin(i,t,l.n.Interpolate)}},this.onHoverChanged=e=>{const{pinType:t,id:i,hovering:n}=e;if(t===j.Er.MATTERTAG&&!this.tagsEnabled)return;const{creatingNewPin:s,pinState:r,previewPin:o,openPin:a,isPinEditable:l}=this.viewData;if(!s)if(n){if(a){if(a.id===i&&a.pinType===t)return;r===j.tS.SELECTED&&(this.viewData.setOpenPin(null),this.pinRenderer.hideSelectedMesh())}t===j.Er.MATTERTAG?this.engine.commandBinder.issueCommand(new T.X8(i)):t===j.Er.NOTE&&this.engine.commandBinder.issueCommand(new _.yC(i)),this.pinRenderer.setPinColorVariantByType(t,j.K_.DEFAULT,null==o?void 0:o.id),this.pinRenderer.setPinColorVariant(i,j.K_.HIGHLIGHTED)}else{const e=r===j.tS.PREVIEWING;o&&e&&(this.pinRenderer.setPinColorVariant(o.id,j.K_.DEFAULT),this.viewData.setPinState(a?l?j.tS.EDITING:j.tS.OPEN:j.tS.IDLE),this.viewData.setPreviewPin(null))}},this.clickOffPin=async()=>{const{openPin:e}=this.viewData;e&&this.deselectPin(e)},this.movePin=async e=>{const{openPin:t,isPinEditable:i}=this.viewData;i&&(t&&t.id===e.id?(this.viewData.updateOpenPin(e.pos),this.engine.broadcast(new X.bV(t.id,t.pinType,e.pos))):this.log.debug("Cannot move the pin, not open for edit"))},this.placePin=async e=>{const{openPin:t,isPinEditable:i,canPlace:n}=this.viewData;i&&(t&&n?(this.viewData.setPinState(j.tS.EDITING),this.engine.broadcast(new X.b0(t.id,t.pinType,t))):(this.log.debug("Cannot place pin because there is no open pin"),this.cancelAndReset()))}}async init(e,t){this.engine=t,this.tagsEnabled=e.newTagsEnabled;const[i,n,s,a,l]=await Promise.all([t.getModuleBySymbol(r.y.INPUT),t.getModuleBySymbol(r.y.WEBGL_RENDERER),t.market.waitForData(d.W),t.market.waitForData(h.pu),t.getModule(o.default)]);this.input=i;const c=t.claimRenderLayer(this.name);this.pinRenderer=n.supportsInstancing()?new InstancedPinRenderer(i,n.getCamera(),s,c,t.commandBinder,l):new NonInstancedPinRenderer(i,n.getCamera(),s,c,t.commandBinder,l),n.getScene().add(this.pinRenderer.container),t.addComponent(this,this.pinRenderer),[this.floorsViewData,this.viewmodeData,this.interactionmodeData,this.sweepData,this.cameraData]=await Promise.all([t.market.waitForData(u.c),t.market.waitForData(f.O),t.market.waitForData(p.Z),t.market.waitForData(g.Z),t.market.waitForData(m.M_)]),this.viewData=new M.B,this.pinEditor=new PinEditor(this.viewData,this.engine,this.input,this.pinRenderer),this.floorsViewData.iterate((e=>this.pinRenderer.getFloorContainer(e.id))),this.viewmode=this.viewmodeData.currentMode,this.bindings.push(t.commandBinder.addBinding(Q.EP,this.onEnablePinEditing),t.commandBinder.addBinding(Q.$b,this.onOpenPin),t.commandBinder.addBinding(Q.Ar,this.onSelectPin),t.commandBinder.addBinding(Q.G3,this.clickOffPin),this.interactionmodeData.onChanged(this.visibilityChanged),this.floorsViewData.onChanged(this.visibilityChanged),this.viewmodeData.makeModeChangeSubscription(this.visibilityChanged),t.subscribe(y.Z,this.visibilityChanged),t.subscribe(S.a,this.viewmodeChanged),t.subscribe(b.Z,this.viewmodeChanged),t.subscribe(X.F7,this.onPinClicked),t.subscribe(X.sD,this.onPinOpened),t.subscribe(X.Q4,this.onPinSelected),t.subscribe(X.KR,this.onPinUpdated),t.subscribe(X.A,this.onPinClosed),t.subscribe(w.ZL,this.onAssetOpened),t.subscribe(w.Oj,this.onToolToggled),t.subscribe(E.bS,this.applicationChanged),this.viewData.onPinStateChanged(this.updateRenderedPin),this.viewData.onOpenPinChanged(this.updateRenderedPin),this.viewData.onPreviewPinChanged(this.updateRenderedPin)),this.touchDevice||this.bindings.push(t.commandBinder.addBinding(Q._l,this.onPreviewPinAnnotation),t.subscribe(X.tP,this.onHoverChanged),this.cameraData.onChanged(this.onCameraUpdate));let v=a.application;this.bindings.push(a.onPropertyChanged("application",(e=>{e!==v&&(this.visibilityChanged(),v=e)}))),this.visibilityChanged(),t.market.register(this,M.B,this.viewData)}dispose(e){this.disableEditing(),this.viewData.setPinState(j.tS.IDLE),this.pinEditor.dispose(),this.pinRenderer.dispose(),this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],this.editBindings=[],super.dispose(e)}onUpdate(){this.pinEditor.update()}in360View(){const e=this.sweepData.currentSweep?this.sweepData.currentSweep:"";return this.viewmodeData.isPano()&&this.sweepData.isSweepUnaligned(e)}enableEditing(){if(!this.editActivated){if(0===this.editBindings.length){const e=this.engine,t=e.commandBinder;this.editBindings.push(e.subscribe(X.nO,this.onStartPinCreation),e.subscribe(X.w0,this.cancelAndReset),e.subscribe(X.VZ,this.onPinDeleted),t.addBinding(Q.fe,this.onPreviewStemLength),t.addBinding(Q.ip,this.placePin),t.addBinding(Q.tT,this.cancelPinCreation),t.addBinding(Q.I$,this.movePin),this.sweepData.makeSweepChangeSubscription(this.handleSweepChange),e.subscribe(b.Z,this.handleViewModeChange))}else this.editBindings.forEach((e=>{e.renew()}));this.handleSweepAndViewModeChange(),this.editActivated=!0}}disableEditing(){this.editActivated&&(this.cancelAndReset(),this.viewData.setPinState(j.tS.IDLE),this.editBindings.forEach((e=>{e.cancel()})),this.editActivated=!1)}handleSweepAndViewModeChange(){const e=this.viewData,t=!this.in360View();e.creatingNewPin&&!t?this.cancelAndReset():e.setCanAdd(t)}selectPin(e,t,i){if(t===j.Er.MATTERTAG){const{openPin:n}=this.viewData;e===(null==n?void 0:n.id)&&t===(null==n?void 0:n.pinType)||this.engine.commandBinder.issueCommand(new T.YC(e,i||void 0))}}async openPin(e,t,i,n,s=-1){return this.viewData.creatingNewPin&&await this.engine.commandBinder.issueCommand(new Q.tT),t===j.Er.NOTE?this.engine.commandBinder.issueCommand(new _.dR(e,i,n,s)):t===j.Er.MATTERTAG?this.engine.commandBinder.issueCommand(new T.lt(e,i,n,s)):void 0}deselectPin(e){this.engine.broadcast(new X.Fe(e.id,e.pinType))}}const be=PinsModule},48470:(e,t,i)=>{"use strict";i.d(t,{tP:()=>PinHoverChangeMessage,F7:()=>PinClickedMessage,b0:()=>PinPlacedMessage,bV:()=>PinMovedMessage,Fe:()=>PinDeselectMessage,hu:()=>PinAddCancelledMessage,w0:()=>PinDiscardedMessage,nO:()=>PinStartCreatingMessage,sD:()=>PinOpenedMessage,Q4:()=>PinSelectedMessage,KR:()=>PinUpdatedMessage,A:()=>PinClosedMessage,VZ:()=>PinDeletedMessage,nY:()=>FocusPinAnnotationMessage});var n=i(91466);class PinHoverChangeMessage extends n.v{constructor(e,t,i){super(),this.id=e,this.hovering=t,this.pinType=i}}class PinClickedMessage extends n.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class PinPlacedMessage extends n.v{constructor(e,t,i){super(),this.id=e,this.pinType=t,this.pinPos=i}}class PinMovedMessage extends n.v{constructor(e,t,i){super(),this.id=e,this.pinType=t,this.pinPos=i}}class PinDeselectMessage extends n.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class PinAddCancelledMessage extends n.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class PinDiscardedMessage extends n.v{constructor(e){super(),this.pinType=e}}class PinStartCreatingMessage extends n.v{constructor(e,t){super(),this.pin=e,this.pinType=t}}class PinOpenedMessage extends n.v{constructor(e,t,i){super(),this.pin=e,this.pinType=t,this.editable=i}}class PinSelectedMessage extends n.v{constructor(e,t){super(),this.pin=e,this.pinType=t}}class PinUpdatedMessage extends n.v{constructor(e,t){super(),this.pin=e,this.pinType=t}}class PinClosedMessage extends n.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class PinDeletedMessage extends n.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class FocusPinAnnotationMessage extends n.v{}},79386:(e,t,i)=>{"use strict";i.d(t,{l:()=>n,Z:()=>s});const n=1,s=Object.freeze({anchor:{size:.1},stem:{length:.23,width:1,opacity:1,transparent:!0,color:"white",alphaTest:.05},pinHeadMesh:{scale:{nearBound:1.5,farBound:4.8,maxSize:80,minSize:40,baseViewportSize:800,responsiveness:100}}})},70384:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>PreRendererModule});var n,s=i(47724),r=i(736),o=i(75892),a=i(909),l=i(48280),c=i(10757);!function(e){e[e.None=0]="None",e[e.Queued=1]="Queued",e[e.Rendering=2]="Rendering",e[e.Rendered=3]="Rendered"}(n||(n={}));class PreRenderer{constructor(e){this.statusMap={},this.active=[],this.queued=[],this.panoRenderer=e,this.disablePreRendering()}init(){}dispose(){}activate(e){}deactivate(e){this.disablePreRendering()}enablePreRendering(){this.enabled=!0}disablePreRendering(){this.enabled=!1}render(){}beforeRender(){this.enabled&&this.processQueued()}tryPreRender(e){return this.getPreRenderState(e)===n.None&&(this.queued.push(e),this.statusMap[e]=n.Queued,!0)}getPreRenderState(e){const t=this.statusMap[e];return void 0!==t?t:n.None}processQueued(){let e=0;for(const t of Object.keys(this.statusMap))this.statusMap[t]===n.Rendering&&e++;if(0===e&&this.queued.length>0){const e=this.queued.shift();if(e){this.active.push(e),this.statusMap[e]=n.Rendering;this.panoRenderer.activateSweep(e).then((()=>{this.onRendered(e)}))}}}cleanup(e=[]){const t=(0,c.ow)(e),i=[];for(const e of this.queued)t[e]?i.push(e):this.statusMap[e]=n.None;this.queued.length=0,this.queued.push.apply(this.queued,i);const s=[];for(const e of this.active)t[e]?s.push(e):this.statusMap[e]=n.None;this.active.length=0,this.active.push.apply(this.active,s)}onRendered(e){this.statusMap[e]=n.Rendered}}var h=i(98828);const d=Object.freeze({prerender:{preRenderTourPanos:h.h("pre",1)}});class PreRendererModule extends s.Y{constructor(){super(...arguments),this.name="prerenderer-module",this.lastPrerendered=null}async init(e,t){if(d.prerender.preRenderTourPanos||e.preRenderTourPanos){this.sweepData=await t.market.waitForData(o.Z);const e=await t.getModuleBySymbol(r.y.SWEEP_PANO);this.panoRenderer=e.getRenderer(),this.preRenderer=new PreRenderer(this.panoRenderer),t.addComponent(this,this.preRenderer),this.bindings.push(t.subscribe(a.Z,(e=>{this.preRenderer.enablePreRendering(),this.lastPrerendered=null,e.sweepIds&&e.sweepIds.length>=3&&(this.lastPrerendered=e.sweepIds[2],this.preRenderer.tryPreRender(this.lastPrerendered)),this.cleanup(this.sweepData),this.currentRestrictedSweeps=e.sweepIds}))),this.bindings.push(t.subscribe(l.Z,(e=>{this.preRenderer.disablePreRendering(),this.cleanup(this.sweepData,!0),this.currentRestrictedSweeps=null})))}}getCurrentSweeps(){return this.currentRestrictedSweeps||[]}cleanup(e,t=!1){const i=[];e.transition.active?(e.transition.from&&i.push(e.transition.from),e.transition.to&&i.push(e.transition.to)):e.currentSweep&&i.push(e.currentSweep),this.lastPrerendered&&i.push(this.lastPrerendered),t&&this.panoRenderer.freeAllTextures(i),this.preRenderer.cleanup(i)}}},44019:(e,t,i)=>{"use strict";i.d(t,{P:()=>RaycasterData,E:()=>RaycastHit});var n=i(2212),s=i(32770);class RaycasterData extends s.V{constructor(){super(...arguments),this.name="pointer",this.hit=null,this.hits=[],this.pointerNdcPosition=new n.Vector2,this.pointerScreenPosition=new n.Vector2,this.pointerOrigin=new n.Vector3,this.pointerDirection=new n.Vector3,this.pointerRay=new n.Ray}}class RaycastHit{constructor(e,t,i,n){this.point=e,this.normal=t,this.object=i,this.intersection=n,this.face={normal:t}}}},17399:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>RaycasterModule});var n=i(47724),s=i(736),r=i(72067),o=i(2212),a=i(19674),l=i(74384);const c=new o.Matrix4;class ColliderNode{constructor(){this.parent=null,this.raycastDistance=1/0,this.distance=1/0}updateRaycastDistance(e){this.raycastDistance=this.bounds.distanceToPoint(e)}updateDistanceToBounds(e){this.distance=this.bounds.distanceToPoint(e)}}class ColliderFacesTarget extends ColliderNode{constructor(e,t,i){super(),this.mesh=e,this.faces=t,this.nearestPointOnGeometry=(()=>{const e=new o.Triangle,t=new o.Vector3,i=new o.Vector3,n=new o.Vector3;return s=>{let r=1/0;const a=s.clone(),l=new o.Vector3,c=new o.Vector3(1/0,1/0,1/0);for(const s of this.faces){e.set(t.set(s.ax,s.ay,s.az),i.set(s.bx,s.by,s.bz),n.set(s.cx,s.cy,s.cz)),e.closestPointToPoint(a,l);const o=a.distanceToSquared(l);o<r&&(c.copy(l),r=o)}return c}})(),this.geometry=this.makeGeometryFromFaces(t),this.facesBounds=(0,l.A)(this.geometry),this.facesCenter=this.facesBounds.getCenter(new o.Vector3),this.bounds=this.facesBounds.clone().intersect(i),this.center=this.bounds.getCenter(new o.Vector3)}makeGeometryFromFaces(e){const t=new Float32Array(9*e.length);let i=0;const n={};for(const s of e){let e=n[s.materialIndex];e||(e=n[s.materialIndex]={start:i/3,count:0,materialIndex:s.materialIndex}),e.count+=3,t[i++]=s.ax,t[i++]=s.ay,t[i++]=s.az,t[i++]=s.bx,t[i++]=s.by,t[i++]=s.bz,t[i++]=s.cx,t[i++]=s.cy,t[i++]=s.cz}const s=new o.BufferGeometry;s.setAttribute("position",new o.BufferAttribute(t,3)),s.computeBoundingBox(),s.boundingBox&&(s.boundingSphere=s.boundingBox.getBoundingSphere(new o.Sphere));for(const e in n){const t=n[e];s.addGroup(t.start,t.count,t.materialIndex)}return s}raycast(e,t){const i=this.mesh.geometry,n=this.mesh.matrixWorld,s=this.mesh.matrix;this.mesh.geometry=this.geometry,this.mesh.matrix=c,this.mesh.matrixWorld=c,this.mesh.raycast(e,t),this.mesh.geometry=i,this.mesh.matrix=s,this.mesh.matrixWorld=n}}class ColliderMeshTarget extends ColliderNode{constructor(e){super(),this.mesh=e,this._bounds=new o.Box3,this.mesh.geometry.boundingBox||this.mesh.geometry.computeBoundingBox(),this.center=this.bounds.getCenter(new o.Vector3)}get bounds(){return this._bounds.copy((0,l.A)(this.mesh.geometry)).applyMatrix4(this.mesh.matrixWorld)}raycast(e,t){this.mesh.visible&&this.mesh.raycast(e,t)}}class ColliderFace{constructor(e,t,i,n,s,r,a,l,c,h){this.materialIndex=e,this.ax=t,this.ay=i,this.az=n,this.bx=s,this.by=r,this.bz=a,this.cx=l,this.cy=c,this.cz=h,this.bounds=new o.Box3(new o.Vector3(Math.min(t,s,l),Math.min(i,r,c),Math.min(n,a,h)),new o.Vector3(Math.max(t,s,l),Math.max(i,r,c),Math.max(n,a,h)))}}class ColliderOctreeNode extends ColliderNode{constructor(e,t,i,n){super(),this.level=t,this.leafMinSize=i,this.leafMaxFaces=n,this.childNodes=[],this.children=[],this.listeners={},this.bounds=e.clone(),this.size=e.getSize(new o.Vector3),this.center=e.getCenter(new o.Vector3)}get depth(){return this.level}*addMeshes(e){e.updateMatrixWorld(!0);const t=[];e.traverse((e=>{e instanceof o.Mesh&&t.push(e)}));for(const e of t){const t=new ColliderMeshTarget(e);if(e.geometry instanceof o.BufferGeometry&&this.bounds.containsBox(t.bounds)){const t=this.geometryToFaces(e.geometry,e.matrixWorld);yield,yield*this.addFaces(e,t)}else this.addMesh(t)}}removeMeshes(e){let t=!1;for(let i=0;i<this.children.length;i++){const n=this.children[i];(n instanceof ColliderMeshTarget||n instanceof ColliderFacesTarget)&&n.mesh.id===e.id&&(n.parent=null,this.children.splice(i,1),this.emit("removed",this,n),t=!0)}if(!t)throw new Error("Mesh that is being attempted removed does not exist in this node.")}addMesh(e){let t=!1;if(this.size.length()>this.leafMinSize){0===this.childNodes.length&&this.buildChildNodes();for(const i of this.childNodes)i.bounds.containsBox(e.bounds)&&(t=!0,i.addMesh(e))}t||this.add(e)}add(e){if(e.parent)throw new Error("ColliderNode already has a parent, remove before trying to add in another node");e.parent=this,this.children.push(e),this.emit("added",this,e)}*addFaces(e,t){if(t.length>this.leafMaxFaces&&this.size.length()>this.leafMinSize)0===this.childNodes.length&&this.buildChildNodes(),yield*this.splitFaces(e,t);else if(t.length>0){const i=new ColliderFacesTarget(e,t,this.bounds);yield this.addMesh(i)}yield}*splitFaces(e,t){for(const i of this.childNodes){const n=[];for(const e of t)i.bounds.intersectsBox(e.bounds)&&n.push(e);yield*i.addFaces(e,n)}}buildChildNodes(){const e=this.size.multiplyScalar(.5);for(let t=0;t<2;t++)for(let i=0;i<2;i++)for(let n=0;n<2;n++){const s=this.bounds.min.x+e.x*n,r=s+e.x,a=this.bounds.min.y+e.y*t,l=a+e.y,c=this.bounds.min.z+e.z*i,h=c+e.z,d=new o.Box3(new o.Vector3(s,a,c),new o.Vector3(r,l,h)),u=new ColliderOctreeNode(d,this.level+1,this.leafMinSize,this.leafMaxFaces);this.childNodes.push(u),this.add(u)}}raycast(e,t){if(!0===e.ray.intersectsBox(this.bounds))for(const i of this.children)i.raycast(e,t)}pick(e,t,i){if(!e.ray.intersectsBox(this.bounds))return t;for(const t of this.children)t.updateRaycastDistance(e.ray.origin);this.children.sort(((e,t)=>e.raycastDistance-t.raycastDistance));for(const n of this.children){if(t&&t.distance<n.raycastDistance)break;if(i(n))if(n instanceof ColliderOctreeNode)t=n.pick(e,t,i);else{const i=[];n.raycast(e,i);for(const e of i)(!t||t.distance>e.distance)&&(t=e)}}return t}nearestTo(e,t,i=null){for(const t of this.children)t.updateDistanceToBounds(e);this.children.sort(((e,t)=>e.distance-t.distance));for(const n of this.children){if(0!==n.distance&&i&&i.distance<n.distance)break;if(t(n))if(n instanceof ColliderOctreeNode)i=n.nearestTo(e,t,i);else if(n instanceof ColliderFacesTarget){const t=n.nearestPointOnGeometry(e),s=t.distanceTo(e);if(!i||i.distance>s){i={point:t,object:n.mesh,distance:s}}}}return i}geometryToFaces(e,t){let i=e.getAttribute("position");if(i instanceof o.InterleavedBufferAttribute)throw new Error("InterleavedBufferAttribute not supported");t.equals(c)||(i=i.clone(),i.applyMatrix4(t));const n=i.array;let s;if(e.index){const t=e.index.array;s=new Array(t.length/3);let i=0;const r=e.groups.length>0?e.groups:[{start:0,count:t.length,materialIndex:0}];for(const e of r)for(let r=e.start;r<e.start+e.count;r+=3){const o=3*t[r],a=3*t[r+1],l=3*t[r+2];s[i++]=new ColliderFace(e.materialIndex||0,n[o],n[o+1],n[o+2],n[a],n[a+1],n[a+2],n[l],n[l+1],n[l+2])}}else{s=new Array(n.length/9);let t=0;const i=e.groups.length>0?e.groups:[{start:0,count:n.length/3,materialIndex:0}];for(const e of i)for(let i=3*e.start;i<3*(e.start+e.count);i+=9)s[t++]=new ColliderFace(e.materialIndex||0,n[i],n[i+1],n[i+2],n[i+3],n[i+4],n[i+5],n[i+6],n[i+7],n[i+8])}return s}getAllBounds(e,t=0,i=1/0,n=!1){for(const s of this.children)this.level>=t&&this.level<=i&&(s instanceof ColliderFacesTarget||!n)&&e.push(s.bounds.clone()),s instanceof ColliderOctreeNode&&s.getAllBounds(e,t,i,n)}emit(e,...t){const i=this.listeners[e]||[];for(const e of i)e(...t);this.parent&&this.parent.emit(e,...t)}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}}class OctreeCollider{constructor(e,t,i){this.meshToNodes={},this._depth=0;const n=(0,a.rj)(e);this.root=new ColliderOctreeNode(n,0,t,i),this.root.on("added",((e,t)=>{e.depth>this._depth&&(this._depth=e.depth),(t instanceof ColliderMeshTarget||t instanceof ColliderFacesTarget)&&(this.meshToNodes[t.mesh.id]||(this.meshToNodes[t.mesh.id]=[]),this.meshToNodes[t.mesh.id].push(t))})),this.root.on("removed",((e,t)=>{if(t instanceof ColliderMeshTarget||t instanceof ColliderFacesTarget){const e=this.meshToNodes[t.mesh.id];for(let i=0;i<e.length;i++)e[i]===t&&e.splice(i,1)}}))}get depth(){return this._depth}*addMeshesAsync(e){yield*this.root.addMeshes(e)}addMeshes(e){for(const t of this.root.addMeshes(e));}removeMeshes(e){e.traverse((e=>{const t=this.meshToNodes[e.id]||[];for(const i of t)i.parent&&i.parent.removeMeshes(e)}))}raycast(e){const t=[];return this.root.raycast(e,t),t}getAllBounds(e=0,t=1/0,i=!1){const n=[];return this.root.getAllBounds(n,e,t,i),n}pick(e,t){return this.root.pick(e,null,(e=>!t||!(e instanceof ColliderMeshTarget||e instanceof ColliderFacesTarget)||t(e.mesh)))}nearestMeshTo(e,t){const i=this.root.bounds.clampPoint(e,new o.Vector3);return this.root.nearestTo(i,(e=>!t||!(e instanceof ColliderMeshTarget||e instanceof ColliderFacesTarget)||t(e.mesh)))}getDebugBoundsMesh(e=16777215,t=0,i=1/0,n=!1){const s=this.getAllBounds(t,i,n),r=new o.LineBasicMaterial({color:e});if(s.length>0){const e=[];for(const t of s){const i=new o.Box3Helper(t);e.push(i.geometry)}const t=(0,l.q)(e);return new o.LineSegments(t,r)}return new o.LineSegments(new o.BufferGeometry,r)}}class Raycaster{constructor(e,t){this.camera=e,this.defaultRaycastFilter=t,this.meshes={},this.octreeEnabledMeshes={},this.raycaster=new o.Raycaster,this.prevRay=new o.Ray,this._hitCache=[],this.getOctree=()=>this.octree,this.addTarget=(e,t)=>{const i=e,n=i.collider?i.collider:e;this.meshes[e.id]=n,this.octreeEnabledMeshes[e.id]=t,this.octree&&t&&this.octree.addMeshes(e)},this.removeTarget=e=>{this.octree&&this.octreeEnabledMeshes[e.id]&&this.octree.removeMeshes(e),delete this.meshes[e.id]}}init(){this.raycaster=new o.Raycaster,this.raycaster.params.Line&&(this.raycaster.params.Line.threshold=.1)}dispose(){this._hitCache.length=0,this.meshes={}}cast(e,t,i){if(e&&t&&(this.prevRay.copy(this.raycaster.ray),this.raycaster.set(e,t)),this.prevRay.equals(this.raycaster.ray))return this._hitCache;if(this.raycaster.layers.mask=this.camera.layers.mask,this._hitCache.length=0,this.octree){const e=this.getRaycastFilter(h.OctreeMeshes,i),t=this.octree.pick(this.raycaster,e);t&&this._hitCache.push(t)}const n=this.getRaycastFilter(h.DynamicMeshes,i);for(const e in this.meshes){const t=this.meshes[e];if(n(t)){const e=this.raycaster.intersectObject(t,!0);this._hitCache=this._hitCache.concat(e)}}return this._hitCache.sort(this.sortIntersectionsByDistance),this.prevRay.copy(this.raycaster.ray),this._hitCache}pick(e,t,i){this.raycaster.set(e,t);const n=this.getRaycastFilter(h.OctreeMeshes,i);return this.octree.pick(this.raycaster,n)}nearest(e,t){return this.octree.nearestMeshTo(e,this.getRaycastFilter(h.OctreeMeshes,t))}setupOctree(e){this.octree=new OctreeCollider(e,.5,200);for(const e of Object.keys(this.meshes))if(this.octreeEnabledMeshes[e]){const t=this.meshes[e];this.octree.addMeshes(t)}return this.octree}getRaycastFilter(e,t){const i=t||this.defaultRaycastFilter,n=t=>{const i=this.octreeEnabledMeshes[t.id];switch(e){case h.DynamicMeshes:return!i;case h.OctreeMeshes:return i}};return e=>n(e)&&i(e)}sortIntersectionsByDistance(e,t){return e.distance>t.distance?1:e.distance<t.distance?-1:0}render(){}activate(){}deactivate(){}}var h;!function(e){e[e.OctreeMeshes=0]="OctreeMeshes",e[e.DynamicMeshes=1]="DynamicMeshes"}(h||(h={}));var d=i(44019),u=i(49399);class LegacyThreeGeometry{constructor(){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[],[]],this.boundingBox=null,this.boundingSphere=null}}class Face3{constructor(e,t,i,n,s,r=0){this.a=e,this.b=t,this.c=i,this.materialIndex=r,this.a=e,this.b=t,this.c=i,this.normal=n&&!Array.isArray(n)&&n.isVector3?n:new o.Vector3,this.vertexNormals=Array.isArray(n)?n:[],this.color=s&&!Array.isArray(s)&&s.isColor?s:new o.Color,this.vertexColors=Array.isArray(s)?s:[],this.materialIndex=r}clone(){return new Face3(this.a,this.b,this.c,this.normal,this.color).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}var p=i(88512),m=i(7170);const g=new p.Z("surface-edge-finder"),f=new o.Triangle,v=["a","b","c"];class Face extends Face3{constructor(e,t,i,n){super(e.a,e.b,e.c,e.normal),this.va=t,this.vb=i,this.vc=n,this.area=f.set(this.va.vector,this.vb.vector,this.vc.vector).getArea(),this.midpoint=f.getMidpoint(new o.Vector3),this.vertices=[this.va,this.vb,this.vc],t.faces.push(this),i.faces.push(this),n.faces.push(this)}}class Vertex{constructor(e){this.vector=e,this.faces=[]}}class Surface{constructor(){this.area=0,this.normal=new o.Vector3,this.midpoint=new o.Vector3,this.faces=[],this.normalSum=new o.Vector3,this.midpointSum=new o.Vector3}add(e){e.surface&&e.surface.remove(e),this.faces.push(e),this.area+=e.area,this.midpointSum.add(e.midpoint),this.normalSum.add(e.normal),this.recalcFromSums(),e.surface=this}remove(e){e.surface&&(this.faces.splice(this.faces.indexOf(e),1),this.area-=e.area,this.midpointSum.sub(e.midpoint),this.normalSum.sub(e.normal),this.recalcFromSums()),e.surface=null}recalcFromSums(){this.normal.copy(this.normalSum).normalize(),this.midpoint.copy(this.midpointSum).divideScalar(this.faces.length)}mergeSurfaces(e){for(const t of e.faces)t.surface=this,this.faces.push(t);this.area+=e.area,this.normalSum.add(e.normalSum),this.midpointSum.add(e.midpointSum),this.recalcFromSums(),e.faces=[],e.area=0,e.normal.set(0,0,0),e.normalSum.set(0,0,0),e.midpointSum.set(0,0,0),e.midpoint.set(0,0,0)}getEdges(){const e={},t={};for(const t of this.faces)for(let i=0;i<3;i++){const n=t[v[i]],s=t[v[(i+1)%3]],r=Math.min(n,s)+","+Math.max(n,s);if(void 0===e[r]){const t={edge1:n,edge2:s,isEdge:!0};e[r]=t}else e[r].isEdge=!1}for(const{edge1:i,edge2:n,isEdge:s}of Object.values(e))s&&(t[i]||(t[i]=[]),t[i].push(n),t[n]||(t[n]=[]),t[n].push(i));return t}getCircularPaths(e){const t=this.getEdges(),i=new Set,n=[],s=Object.keys(t).map((e=>parseInt(e,10)));let r;for(;r=s.pop();){const s=[];for(;r;){let n;s.push(e[r]);let o=0;for(const s of t[r]){const t=Math.min(r,s)+","+Math.max(r,s);if(i.has(t))continue;const a=e[r].vector.distanceToSquared(this.midpoint);(void 0===n||a>o)&&(n=s,o=a)}if(!n)break;{const e=Math.min(r,n)+","+Math.max(r,n);i.add(e),r=n}}s.length>2&&n.push(s)}return n}}class SurfaceEdgeFinder{constructor(e,t){this.roomId=e,this.floorId=t,this.surfaces=new Set,this.lines=[],this.points=[]}*run(e,t=[1,5,10],i=.2,n=.01,s=20){const r=function(e){const t=new LegacyThreeGeometry,i=null!==e.index?e.index:void 0,n=e.attributes;if(void 0===n.position)throw Error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion.");const s=n.position,r=n.normal,a=n.color,l=n.uv,c=n.uv2;void 0!==c&&(t.faceVertexUvs[1]=[]);for(let e=0;e<s.count;e++)t.vertices.push((new o.Vector3).fromBufferAttribute(s,e)),void 0!==a&&t.colors.push((new o.Color).fromBufferAttribute(a,e));function h(e,i,n,s=0){const h=void 0===a?[]:[t.colors[e].clone(),t.colors[i].clone(),t.colors[n].clone()],d=void 0===r?[]:[(new o.Vector3).fromBufferAttribute(r,e),(new o.Vector3).fromBufferAttribute(r,i),(new o.Vector3).fromBufferAttribute(r,n)],u=new Face3(e,i,n,d,h,s);t.faces.push(u),void 0!==l&&t.faceVertexUvs[0].push((new o.Vector2).fromBufferAttribute(l,e),(new o.Vector2).fromBufferAttribute(l,i),(new o.Vector2).fromBufferAttribute(l,n)),void 0!==c&&t.faceVertexUvs[1].push((new o.Vector2).fromBufferAttribute(c,e),(new o.Vector2).fromBufferAttribute(c,i),(new o.Vector2).fromBufferAttribute(c,n))}const d=e.groups;if(d.length>0)for(let e=0;e<d.length;e++){const t=d[e],n=t.start;for(let e=n,s=n+t.count;e<s;e+=3)void 0!==i?h(i.getX(e),i.getX(e+1),i.getX(e+2),t.materialIndex):h(e,e+1,e+2,t.materialIndex)}else if(void 0!==i)for(let e=0;e<i.count;e+=3)h(i.getX(e),i.getX(e+1),i.getX(e+2));else for(let e=0;e<s.count;e+=3)h(e,e+1,e+2);return t}(e),a=r.vertices.map((e=>new Vertex(e))),l=[];for(const e of r.faces)l.push(new Face(e,a[e.a],a[e.b],a[e.c])),yield;for(let e=0,t=l.length;e<t;e++){const t=l[e];(new Surface).add(t)}for(const e of t)yield*this.mergeSurfacesByNormal(l,e);for(const e of l)this.surfaces.add(e.surface);let c=0;const h=[];for(const e of this.surfaces){if(e.area<=i)continue;const t=e.getCircularPaths(a);for(const e of t)this.cullPath(e,((e,t)=>{if(e.length()<n||t.length()<n)return c++,!1;const i=e.angleTo(t)*m.MN;return!(i<s||i>180-s)||(c++,!1)})),e.length>2&&h.push(e);yield}g.debug(`Culled ${c} path points`);const d=new Set,p=new Set,f=e=>`${e.x.toFixed(3)},${e.y.toFixed(3)},${e.z.toFixed(3)}`,v=e=>`${f(e.start)}:${f(e.end)}`,y=e=>`${f(e.end)}:${f(e.start)}`;for(const e of h)for(let t=0;t<e.length;t++){const i=e[t].vector,n=e[(t+1)%e.length].vector,s=new u.FM(i,n,this.floorId,this.roomId),r=v(s),o=y(s),a=f(i);p.has(r)||p.has(o)||(p.add(r),p.add(o),this.lines.push(s)),d.has(a)||(d.add(a),this.points.push(new u.UQ(i,this.floorId,this.roomId)))}yield}cullPath(e,t){const i=new o.Vector3,n=new o.Vector3;let s=!0;for(;s;){s=!1;for(let r=0;r<e.length&&e.length>2;r++){const o=e[0===r?e.length-1:r-1].vector,a=e[r].vector,l=e[(r+1)%e.length].vector;i.copy(o).sub(a),n.copy(l).sub(a),t(i,n)||(e.splice(r,1),s=!0,r--)}}}*mergeSurfacesByNormal(e,t,i=5){let n=-1,s=0;for(;0!==n&&s++<i;){g.debug(`Merging surfaces by normal angle threshold: ${t}`);const i=Math.cos(m.Ue*t);n=0;let s=0;for(const t of e){s++%1e3==0&&(yield);for(const e of t.vertices)for(const s of e.faces){const e=s.surface;t.surface!==e&&t.surface.normal.dot(e.normal)>=i&&(t.surface.faces.length>e.faces.length?t.surface.mergeSurfaces(e):e.mergeSurfaces(t.surface),n++)}}n&&g.debug(`Merged ${n} surfaces by normal...`)}}}var y=i(24930),b=i(81890);const S=new p.Z("snapcaster");var E;!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.WORKING=1]="WORKING",e[e.READY=2]="READY"}(E||(E={}));class Snapcaster{constructor(e){this.cameraData=e,this.edgeFinders=[],this.raycaster=new o.Raycaster,this.modelRaycaster=new o.Raycaster,this.status=E.UNINITIALIZED,this.cast=(e,t,i,n)=>{let s;i&&n&&(s=(new o.Plane).setFromNormalAndCoplanarPoint(n,i)),this.raycaster.set(e.origin,e.direction);const r=this.snappingOctree.raycast(this.raycaster,t)||[],a=e=>{let t=(1+e.distance)*(1+e.distanceToRay)**2;return(e.object instanceof u.UQ||e.object instanceof o.Vector3)&&(t/=10),s&&s.distanceToPoint(e.point)<-.2&&(t+=10),t};return r.sort(((e,t)=>a(e)-a(t))),r},this.pick=(e,t,i,n,s)=>{i||(i=this.cast(e,t,n,s));let r=null;for(const t of i){this.modelRaycaster.ray.origin.copy(e.origin),this.modelRaycaster.ray.direction.copy(t.point).sub(e.origin).normalize(),this.modelRaycaster.far=t.distance-.05;if(!this.modelOctree.pick(this.modelRaycaster,(e=>e.visible))){r=t;break}}return r?{isLineOctreeIntersection:!0,distance:r.distance,distanceToRay:r.distanceToRay,point:r.point,object:r.object}:null},this.add=(...e)=>{for(const t of e)this.snappingOctree.add(t)},this.remove=(...e)=>{for(const t of e)this.snappingOctree.remove(t)}}render(){}init(){}dispose(){}deactivate(e){}async activate(e){this.engine=e;const t=await e.getModule(y.default),i=(await e.getModuleBySymbol(s.y.WEBGL_RENDERER)).getScene().scene;let n,r;t.registerButton("Snapping","Visualize Snapping",(()=>{if(n)return i.remove(n),void(n=null);n=new o.Object3D,i.add(n);const e=new o.SphereGeometry(.02,5,5),t=new o.MeshBasicMaterial({color:65280});this.snappingOctree.traverse((i=>{if(i instanceof u.FM){const e=(new o.BufferGeometry).setFromPoints([i.start,i.end]),t=.2+.8*Math.random(),s=.2+.8*Math.random(),r=.2+.8*Math.random(),a=new o.Line(e,new o.LineBasicMaterial({color:16711680*t+65280*s+255*r}));n.add(a)}else if(i instanceof u.UQ){const s=new o.Mesh(e,t);s.position.copy(i),n.add(s)}}))})),t.registerButton("Snapping","Visualize Snap Surfaces",(()=>{if(r)return i.remove(r),void(r=null);const e=new o.BufferGeometry,t=[],n=[];for(const e of this.edgeFinders)for(const i of e.surfaces){const e=i.area>.1,s=Math.random(),r=e?0:.2+.8*s,o=e?.2+.8*s:0,a=0;for(const e of i.faces){const i=e.va.vector,s=e.vb.vector,l=e.vc.vector;t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z),t.push(l.x,l.y,l.z),n.push(r,o,a,r,o,a,r,o,a)}}e.setAttribute("position",new o.Float32BufferAttribute(t,3)),e.setAttribute("color",new o.Float32BufferAttribute(n,3)),r=new o.Mesh(e,new o.MeshBasicMaterial({vertexColors:!0})),i.add(r)}))}get snappingOctree(){return this.status===E.UNINITIALIZED&&this.preloadMeshSnapping(),this._snappingOctree}setupOctree(e,t){this.modelOctree=t,this.modelMesh=e,this.modelRaycaster.layers.mask=e.layers.mask,this._snappingOctree=new u.ZP(this.modelMesh.boundingBox)}async preloadMeshSnapping(){this.status===E.UNINITIALIZED&&(this.status=E.WORKING,this.populateProcess=await this.engine.commandBinder.issueCommand(new b.S("snapping",this.buildSnappingForModel(),6e4)),await this.populateProcess.promise,this.status=E.READY,this.populateProcess=null)}*buildSnappingForModel(){const e=[];for(const t of this.modelMesh.floorMeshes)for(const i of t.roomMeshes)e.push({room:i,distanceToCamera:1/0});const t=new o.Vector3,i=()=>{e.forEach((e=>e.distanceToCamera=e.room.boundingBox.getCenter(t).distanceTo(this.cameraData.pose.position))),e.sort(((e,t)=>t.distanceToCamera-e.distanceToCamera))};for(;e.length;){i();const t=e.pop().room;yield*this.buildSnappingForGeometry(t.geometry,t.roomId,t.floorId),yield}S.info(`Snapping found ${this._snappingOctree.pointCount} points and ${this._snappingOctree.lineCount} lines`)}*buildSnappingForGeometry(e,t,i){e.computeVertexNormals(),yield;const n=new SurfaceEdgeFinder(t,i);yield*n.run(e),S.debug(`Room done, added ${n.points.length} points and ${n.lines.length} lines`);for(const e of n.points)this._snappingOctree.add(e);for(const e of n.lines)this._snappingOctree.add(e);this.edgeFinders.push(n)}}var w=i(27687);class RaycastPointerScreen{constructor(e,t){this.raycaster=e,this.cameraData=t,this.lastHits=[],this.lastRay=new o.Ray(new o.Vector3(1,1,1),new o.Vector3(0,1,0)),this.currentRay=new o.Ray,this.pointer=new o.Vector2(-2,-2),this.origin=new o.Vector3,this.direction=new o.Vector3,this.cast=()=>{const e=this.pointerRay;return this.lastRay.equals(e)||(this.lastHits=this.raycaster.cast(e.origin,e.direction).slice(),this.lastRay.copy(e)),this.lastHits},this.updatePointer=e=>{this.pointer.distanceToSquared(e)>2e-5&&this.pointer.set(e.x,e.y)}}get pointerRay(){const{origin:e,direction:t}=this.updateDirections();return this.currentRay.set(e,t)}get ndcPosition(){return this.pointer}updateDirections(){return(0,w.Kh)(this.cameraData.pose,this.origin.set(this.pointer.x,this.pointer.y,-1),this.origin),(0,w.Kh)(this.cameraData.pose,this.direction.set(this.pointer.x,this.pointer.y,1),this.direction),this.direction.sub(this.origin).normalize(),{origin:this.origin,direction:this.direction}}}class RaycastPointerDataUpdate{constructor(e,t,i){this.raycaster=e,this.data=t,this.cameraData=i,this.cache={normal4:new o.Vector4,normal:new o.Vector3,rotationMatrix:new o.Matrix4,ndc3:new o.Vector3}}beforeRender(){if(this.raycaster.pointer.pointerRay.equals(this.data.pointerRay))return;this.data.pointerRay.copy(this.raycaster.pointer.pointerRay),this.data.pointerOrigin.copy(this.data.pointerRay.origin),this.data.pointerDirection.copy(this.data.pointerRay.direction);const e=this.raycaster.pointer.cast();if(this.data.hits.length=0,this.data.hits.push(...e),this.data.pointerNdcPosition.copy(this.raycaster.pointer.ndcPosition),this.cache.ndc3.set(this.data.pointerNdcPosition.x,this.data.pointerNdcPosition.y,.5),this.data.pointerScreenPosition.copy((0,w.fi)(this.cameraData.width,this.cameraData.height,this.cache.ndc3)),e.length>0){const t=e[0];if(t&&t.face){const e=t.face.normal;this.cache.normal4.set(e.x,e.y,e.z,0),this.cache.rotationMatrix.extractRotation(t.object.matrixWorld),this.cache.normal4.applyMatrix4(this.cache.rotationMatrix),this.cache.normal.set(this.cache.normal4.x,this.cache.normal4.y,this.cache.normal4.z),this.data.hit=new d.E(t.point.clone(),this.cache.normal.clone(),t.object,t)}}else this.data.hit=null;this.data.commit()}init(){}render(){}dispose(){}activate(){}deactivate(){}}var T=i(59088),_=i(76863),M=i(98828);class RaycasterModule extends n.Y{constructor(){super(...arguments),this.name="raycaster",this.raycasterPointerData=new d.P,this.overridePointer=null,this.setOverridePointer=e=>{this.overridePointer=e}}async init(e,t){t.market.register(this,d.P,this.raycasterPointerData);const[i,n]=await Promise.all([t.getModuleBySymbol(s.y.WEBGL_RENDERER),t.market.waitForData(T.M_)]),o=i.getCamera();this.raycaster=new Raycaster(o,_.Nr),t.addComponent(this,this.raycaster),this.defaultPointer=new RaycastPointerScreen(this.raycaster,n),this.snapcaster=new Snapcaster(n),t.addComponent(this,this.snapcaster);const a=new RaycastPointerDataUpdate(this,this.raycasterPointerData,n);t.addComponent(this,a),(0,M.h)("debug","")&&(r.Z.load(r.Z.menus.Raycaster,t),r.Z.load(r.Z.menus.Octree,t))}dispose(){}setupOctree(e){const t=e.boundingBox,i=this.raycaster.setupOctree(t);this.snapcaster.setupOctree(e,i)}getOctree(){return this.raycaster.getOctree()}get pointer(){return null!==this.overridePointer?this.overridePointer:this.defaultPointer}get targets(){return this.raycaster}get picking(){return this.raycaster}get snapping(){return this.snapcaster}}},87202:(e,t,i)=>{"use strict";i.d(t,{oM:()=>RequestRenderTargetCommand,sH:()=>Context2dCaptureCommand,vU:()=>ScreenCaptureCommand,sp:()=>RenderToCubemapCommand,fZ:()=>EquirectangularCommand,ep:()=>ComposeTargetsCommand});var n=i(17386);class RequestRenderTargetCommand extends n.m{constructor(){super(...arguments),this.id="RequestRenderTargetCommand"}}class Context2dCaptureCommand extends n.m{constructor(e,t){super(),this.payload={renderTarget:e,context:t}}}class ScreenCaptureCommand extends n.m{constructor(e,t,i){super(),this.payload={renderTarget:e,sceneObject:t,camera:i}}}class RenderToCubemapCommand extends n.m{constructor(e,t,i){super(),this.payload={renderTarget:e,sceneObject:t,camera:i}}}class EquirectangularCommand extends n.m{constructor(e,t,i=0){super(),this.payload={renderTarget:e,texture:t,heading:i}}}class ComposeTargetsCommand extends n.m{constructor(e,t){super(),this.payload={target1:e,target2:t}}}},32306:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>RenderToTexture});var n=i(47724),s=i(736),r=i(84561),o=i(2212),a=i(31090),l=i(69383),c=i(20855);const h={circle_projection:new o.RawShaderMaterial({uniforms:{textureSampleScale:{value:5},panoTexture:{value:null},borderSize:{value:0},borderColor:{value:new o.Vector4(1,1,1,1)}},depthWrite:!1,depthTest:!0,side:o.DoubleSide,vertexShader:(0,c.m)(l,i(74624)),fragmentShader:(0,c.m)(a,i(57223))}),equirectangular:new o.RawShaderMaterial({uniforms:{cubemap:{value:null},yaw:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:(0,c.m)(l,i(64799)),fragmentShader:(0,c.m)(a,i(72488))}),compose:new o.RawShaderMaterial({uniforms:{mask:{value:null},bg:{value:null}},transparent:!0,vertexShader:(0,c.m)(l,i(47151)),fragmentShader:(0,c.m)(a,i(14499))}),copyOpaque:new o.RawShaderMaterial({uniforms:{texture:{value:null}},vertexShader:(0,c.m)(l,i(95611)),fragmentShader:(0,c.m)(a,i(54779))})};var d=i(53225),u=i(87202);class RenderTarget{constructor(e,t){this._renderer=e,this._renderTarget=t}get target(){return this._renderTarget}get width(){return this._renderTarget.width}get height(){return this._renderTarget.height}get bpp(){return 4}readRenderTargetData(e){const t=this._renderTarget.width,i=this._renderTarget.height;return e=e||new Uint8Array(t*i*4),this._renderer.readRenderTargetPixels(this._renderTarget,0,0,t,i,e),e}setSize(e,t){this._renderTarget.setSize(e,t)}dispose(){this._renderTarget.dispose()}}const p=new(i(88512).Z)("rtt");class RenderToTexture extends n.Y{constructor(){super(...arguments),this.name="render-to-texture",this.circleProjectionPlane=new d.E(new o.PlaneBufferGeometry(1,1),h.circle_projection),this.equirectProjectionPlane=new d.E(new o.PlaneBufferGeometry(1,1),h.equirectangular),this.composePlane=new d.E(new o.PlaneBufferGeometry(1,1),h.compose),this.copyPlane=new d.E(new o.PlaneBufferGeometry(1,1),h.copyOpaque),this.cachedSize=new o.Vector2,this.cachedViewport=new o.Vector4,this.cachedViewport2=new o.Vector4,this.solidWhiteTexture=new o.DataTexture(new Uint8Array([255,255,255,255]),1,1),this.debugRenderOffset=0}async init(e,t){const i=await t.getModuleBySymbol(s.y.WEBGL_RENDERER);this.cwfRenderer=i.cwfRenderer,this.renderer=i.cwfRenderer.renderer,this.camera=new o.Camera,this.orthoCamera=new o.OrthographicCamera(-.5,.5,.5,-.5,0,1),this.camera.layers.mask=r.o.ALL.mask,this.scene=new o.Scene,this.scene.name="rtt",this.scene.autoUpdate=!1,this.bindings.push(t.commandBinder.addBinding(u.oM,(async e=>new RenderTarget(this.renderer,this.createRenderTarget2D(0))))),this.bindings.push(t.commandBinder.addBinding(u.sH,(async e=>{this.renderContext(e.renderTarget.target,e.context)}))),this.bindings.push(t.commandBinder.addBinding(u.vU,(async e=>{this.render(e.renderTarget.target,e.sceneObject,e.camera)}))),this.bindings.push(t.commandBinder.addBinding(u.fZ,(async e=>{this.renderEquirectangular(e.texture,e.renderTarget.target,e.heading)}))),this.bindings.push(t.commandBinder.addBinding(u.sp,(async e=>{this.render(e.renderTarget,e.sceneObject,e.camera)}))),this.bindings.push(t.commandBinder.addBinding(u.ep,(async e=>{this.compose(e.target1.target,e.target2.target,e.target2.target)})))}getRenderSize(){const e=this.renderer.getPixelRatio(),t=this.renderer.getSize(this.cachedSize);return t.width*=e,t.height*=e,t}onUpdate(){this.debugRenderOffset=0}createRenderTarget2D(e,t=e,i,n=!0){const s=new o.WebGLRenderTarget(e,t,i);return s.texture.generateMipmaps=n,s}clearRenderTarget2D(e){this.renderer.setRenderTarget(e),this.renderer.clear(),this.renderer.setRenderTarget(null)}disposeRenderTarget2D(e){e.texture.dispose(),e.depthTexture&&e.depthTexture.dispose(),e.dispose()}getRenderTargetData(e,t){const i=e.width,n=e.height;return t=t||new Uint8Array(i*n*4),this.renderer.readRenderTargetPixels(e,0,0,i,n,t),t}compose(e,t,i=this.solidWhiteTexture){this.composePlane.material.uniforms.bg.value=this.isRenderTarget(t)?t.texture:t,this.composePlane.material.uniforms.mask.value=this.isRenderTarget(i)?i.texture:i,this.scene.add(this.composePlane),this.overrideRenderTarget(e,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.composePlane)}copyTextureOpaque(e,t){this.copyPlane.material.uniforms.texture.value=t&&this.isRenderTarget(t)?t.texture:t,this.scene.add(this.copyPlane),this.overrideRenderTarget(e,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.copyPlane)}copyTexture(e,t){return t.format===o.RGBFormat?this.copyTextureOpaque(e,t):this.compose(e,t)}resizeTexture(e,t){const i=new o.WebGLRenderTarget(t,t);return i.texture.format=e.format,i.texture.addEventListener("dispose",i.dispose.bind(i)),this.copyTexture(i,e),i.texture}renderToScreen(e,t,i){const n=this.isRenderTarget(e)?e.width:e.image.width,s=this.isRenderTarget(e)?e.height:e.image.height,r=t?t.x:this.debugRenderOffset,o=t?t.y:this.cachedSize.height-s-48;this.renderer.getViewport(this.cachedViewport),this.renderer.setViewport(r,o,n,s),this.compose(null,e,i),this.renderer.setViewport(this.cachedViewport),t||(this.debugRenderOffset+=n+4)}isRenderTarget(e){return e.hasOwnProperty("texture")}renderContext(e,t){e.texture.image=t.canvas,e.texture.needsUpdate=!0}render(e,t,i,n){const s=t.parent;if(s&&this.scene.applyMatrix4(s.matrixWorld),this.scene.add(t),e.isWebGLCubeRenderTarget){const t=new o.CubeCamera(.01,1e3,e);i.getWorldPosition(t.position),i.getWorldQuaternion(t.quaternion),this.scene.add(t),this.scene.updateMatrixWorld(),t.layers.mask=n?n.mask:i.layers.mask,t.update(this.renderer,this.scene),this.scene.remove(t)}else{i.getWorldPosition(this.camera.position),i.getWorldQuaternion(this.camera.quaternion),this.camera.projectionMatrix.copy(i.projectionMatrix),this.camera.layers.mask=n?n.mask:i.layers.mask;const t=this.renderer.getSize(this.cachedSize),s=t.width/t.height,r=e.width/e.height,o=this.camera.projectionMatrix;s>r?o.elements[0]=o.elements[5]/r:o.elements[5]=o.elements[0]*r,this.overrideRenderTarget(e,(()=>{this.renderer.clear(),this.renderer.render(this.scene,this.camera)}))}return s&&(s.add(t),this.scene.matrixWorld.identity()),this.scene.remove(t),e}setScissors(e,t){if(e){if(!t)throw Error("Rect to restrict rendering to required when enabling scissors.");this.renderer.setScissorTest(!0),this.renderer.setScissor(t.x,t.y,t.width,t.height)}else{const e=this.renderer.getSize(this.cachedSize);this.renderer.setScissor(0,0,e.width,e.height),this.renderer.setScissorTest(!1)}}renderSphericalProjection(e,t,i,n,s){const r=h.circle_projection;r.uniforms.borderColor.value.copy(s||new o.Vector4(1,1,1,1)),r.uniforms.borderSize.value=n||0,r.uniforms.textureSampleScale.value=i||5,r.uniforms.panoTexture.value=e,this.scene.add(this.circleProjectionPlane),this.circleProjectionPlane.position.z=0,this.overrideRenderTarget(t,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.circleProjectionPlane)}renderEquirectangular(e,t,i=0){const n=this.equirectProjectionPlane.material;n.uniforms.cubemap.value=e,n.uniforms.yaw.value=i,this.scene.add(this.equirectProjectionPlane),this.equirectProjectionPlane.position.z=0,this.overrideRenderTarget(t,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.equirectProjectionPlane),n.uniforms.cubemap.value=null,n.uniforms.yaw.value=0}overrideRenderTarget(e,t){const i=this.renderTargetSwap(e);t(),this.renderTargetRestore(i)}renderTargetSwap(e){const t=this.renderer.xr.enabled,i=this.renderer.getRenderTarget(),n=this.renderer.getViewport(this.cachedViewport2);return this.renderer.xr.enabled=!1,this.renderer.setRenderTarget(e),{xr:t,rtt:i,viewport:n}}renderTargetRestore(e){this.renderer.xr.enabled=e.xr,this.renderer.setRenderTarget(e.rtt),this.renderer.setViewport(e.viewport)}renderAndReadAsync(e,t,i){const n=i.buffer;if(!this.renderer.capabilities.isWebGL2)return p.debug("renderAsync call webgl2, falling back to sync render/read"),this.render(e.target,e.mesh,e.camera),Promise.resolve(this.getRenderTargetData(e.target,n));const s=this.renderTargetSwap(e.target),r=this.renderer.getContext(),o=i.webglBuffer||r.createBuffer();if(!o)throw Error("Unable to create pack buffer");return r.bindBuffer(r.PIXEL_PACK_BUFFER,o),r.bufferData(r.PIXEL_PACK_BUFFER,n.byteLength,r.DYNAMIC_READ),e.clear&&this.renderer.clear(),this.renderer.render(e.mesh,e.camera),r.readPixels(t.x,t.y,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,0),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),this.renderTargetRestore(s),this.cwfRenderer.fence(r).then((()=>(r.bindBuffer(r.PIXEL_PACK_BUFFER,o),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,n),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i.webglBuffer||r.deleteBuffer(o),n)))}}},1466:(e,t,i)=>{"use strict";i.d(t,{vP:()=>r,Xk:()=>o,jJ:()=>a,fY:()=>l});var n=i(10757);let s=null;const r=async(e,t)=>{const n=new Uint8Array(e.width*e.height*4);if(e.readRenderTargetData(n),!s){const e=await Promise.all([i.e(764),i.e(524),i.e(718)]).then(i.bind(i,94656));s=e.createJpegEncodeWorker()}const r=n.buffer,o=await s.exec({data:r,width:e.width,height:e.height,options:{exif:t,quality:85,flipY:!0}},[r]);return new Uint8Array(o.data)},o=e=>new Blob([e],{type:"image/jpeg"}),a=e=>"data:image/jpg;base64,"+(0,n.$B)(e),l=(e,t,i,n)=>'http://ns.adobe.com/xap/1.0/\0<?xpacket begin="" id="W5M0MpCehiHzreSzNTczkc9d"?><x:xmpmeta xmlns:x="adobe:ns:meta/"><rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:GPano="http://ns.google.com/photos/1.0/panorama/"><GPano:CroppedAreaImageHeightPixels>'+t+"</GPano:CroppedAreaImageHeightPixels><GPano:CroppedAreaImageWidthPixels>"+e+"</GPano:CroppedAreaImageWidthPixels><GPano:CroppedAreaLeftPixels>0</GPano:CroppedAreaLeftPixels><GPano:CroppedAreaTopPixels>0</GPano:CroppedAreaTopPixels><GPano:FullPanoHeightPixels>"+t+"</GPano:FullPanoHeightPixels><GPano:FullPanoWidthPixels>"+e+"</GPano:FullPanoWidthPixels><GPano:ProjectionType>equirectangular</GPano:ProjectionType><GPano:UsePanoramaViewer>True</GPano:UsePanoramaViewer><GPano:InitialViewHeadingDegrees>"+i+"</GPano:InitialViewHeadingDegrees><GPano:InitialViewPitchDegrees>"+n+'</GPano:InitialViewPitchDegrees><GPano:CaptureSoftware>Matterport Camera</GPano:CaptureSoftware><GPano:StitchingSoftware>Matterport Cloud</GPano:StitchingSoftware></rdf:Description></rdf:RDF></x:xmpmeta><?xpacket end="w"?>'},62655:(e,t,i)=>{"use strict";i.d(t,{d:()=>Room});class Room{constructor(e){this.tags=[],e&&Object.assign(this,e)}}},86488:(e,t,i)=>{"use strict";i.d(t,{Z:()=>RoomData});var n=i(32770),s=i(48715),r=i(62655);const o=new(i(88512).Z)("room-data");class RoomData extends n.V{constructor(e){if(super(),this.name="rooms",this.selected=new s.f(null),this._rooms={},this.floorToRoomsMap=new Map,this.rooms=()=>{const e=this._rooms,t=Object.keys(this._rooms);return function*(){for(const i of t)yield e[i]}()},this.get=e=>this._rooms[e],e)for(const t of Object.values(e))this.add(t)}mapMeshesToRooms(e){const t=new Set,i=new Map;for(const i of e.values()){const{meshGroup:e,parentMeshGroup:n}=i;let s=this.getByMeshSubgroup(e);const a=(null==s?void 0:s.id)||String(e);t.add(a),s||(o.debug(`Created non-existant Room for mesh subgroup ${e}`),s=new r.d({id:a,meshSubgroup:e,floorId:String(n)}),this.add(s))}for(const e in this._rooms){const n=this._rooms[e];t.has(e)?i.set(n.meshSubgroup,n.id):(o.debug(`Removing non-existant Room with mesh subgroup ${this._rooms[e].meshSubgroup}`),this.remove(e))}return i}add(e){this._rooms[e.id]=e;const t=this.floorToRoomsMap.get(e.floorId);t?t.push(e):this.floorToRoomsMap.set(e.floorId,[e])}remove(e){const t=this.get(e);if(!t)return;const i=this.floorToRoomsMap.get(t.floorId);if(i){const e=i.indexOf(t);e>-1&&i.splice(e,1)}delete this._rooms[e]}get roomCount(){return Object.keys(this._rooms).length}get collection(){return this._rooms}getByMeshSubgroup(e){return Object.values(this._rooms).find((t=>t.meshSubgroup===e))}roomsByFloor(e){return this.floorToRoomsMap.get(e)||[]}}},54177:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>RoomDataModule});var n=i(47724),s=i(67027),r=i(86488),o=i(75892),a=i(35597),l=i(79548),c=i(88655),h=i(94474),d=i(88512),u=i(62655);const p=new d.Z("mds-floor-deserializer");class MdsRoomDeserializer{deserialize(e){if(!e||!this.validate(e))return p.debug("Deserialized invalid room data from MDS",e),null;const t=e.dimensions||{},{height:i,width:n,depth:s,areaFloor:r}=t;return new u.d({id:e.id,meshSubgroup:e.meshId,floorId:e.floor.id,height:i,width:n,depth:s,areaFloor:r,tags:e.tags})}validate(e){const t=["id","meshId"].every((t=>t in e)),i=e.floor&&e.floor.id&&"number"==typeof e.floor.meshId;return t&&!!i}}class MdsRoomStore extends h.u{constructor(){super(...arguments),this.prefetchKey="data.model.rooms"}async read(e){const t=new MdsRoomDeserializer,i={modelId:this.getViewId()};return this.query(c.GetRooms,i,e).then((e=>{var i,n;const s=null===(n=null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.model)||void 0===n?void 0:n.rooms;if(!s||!Array.isArray(s))return null;return s.reduce(((e,i)=>{const n=t.deserialize(i);return n&&(e[n.id]=n),e}),{})}))}}var m=i(38420);class RoomDataModule extends n.Y{constructor(){super(...arguments),this.name="room-data",this.visitedRooms={}}async init(e,t){const[i,n]=await Promise.all([t.market.waitForData(s._),t.market.waitForData(a.O)]);this.configureStorage(e);const c=this.store?await this.store.read():{};this.data=new r.Z(c||{});const h=this.data.mapMeshesToRooms(i.meshGroups.rooms);i.setMeshIds({roomIdMap:h}),t.market.register(this,r.Z,this.data);const d=this.data.roomCount,u=e=>{const i=n.closestMode;this.visitedRooms[e.id]||(this.visitedRooms[e.id]={visitCount:0}),this.visitedRooms[e.id].visitCount++;const s=this.visitedRooms[e.id].visitCount;t.broadcast(new l.D(e.id,e.meshSubgroup,i,s,d,""))},p=await t.market.waitForData(o.Z),m=p.makeSweepChangeSubscription((e=>{if(e){const t=p.getSweep(e);this.data.selected.value=t.roomId,this.data.commit()}})),g=this.data.selected.onChanged((e=>{if(null!==e){const t=this.data.get(e);t&&u(t)}}));this.bindings.push(m,g)}configureStorage(e){const{storageProvider:t,baseUrl:i}=e;this.store||t!==m.Xq.MDS||(this.store=new MdsRoomStore({baseUrl:i,readonly:!0}))}}},79548:(e,t,i)=>{"use strict";i.d(t,{D:()=>RoomVisitedMessage});var n=i(91466);class RoomVisitedMessage extends n.v{constructor(e,t,i,n,s,r){super(),this.roomId=e,this.meshSubgroup=t,this.viewmode=i,this.visitCount=n,this.roomCount=s,this.roomType=r}}},81890:(e,t,i)=>{"use strict";i.d(t,{S:()=>ScheduleProcessCommand});var n=i(17386);class ScheduleProcessCommand extends n.m{constructor(e,t,i,n=1){super(),this.id="SCHEDULE_PROCESS_COMMAND",this.payload={type:e,func:t,maxDelay:i,steps:n}}}},67502:(e,t,i)=>{"use strict";i.d(t,{_:()=>ScheduleTaskCommand});var n=i(17386);class ScheduleTaskCommand extends n.m{constructor(e,t,i){super(),this.id="SCHEDULE_TASK_COMMAND";const n=function*(){return t()}();this.payload={type:e,func:n,maxDelay:i,steps:1}}}},95469:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SchedulerModule});var n,s=i(47724),r=i(58232);class TaskType{constructor(e){this.name=e,this.taskDurations=new r.P(100)}get typicalStepDuration(){return 1}addTaskDuration(e){this.taskDurations.push(e)}}!function(e){e.WAITING="waiting",e.STARTED="started",e.DONE="done"}(n||(n={}));class Scheduler{constructor(){this.tasks=[],this.types={}}getType(e){return this.types[e]||(this.types[e]=new TaskType(e)),this.types[e]}addTask(e){this.tasks.push(e)}update(e){this.tasks=this.tasks.filter((e=>e.status!==n.DONE)),this.tasks.sort(((e,t)=>t.urgency-e.urgency));let t=0;e:for(const i of this.tasks)for(;i.status!==n.DONE;){const n=performance.now(),s=t+i.type.typicalStepDuration>e,r=n>=i.deadline;if(s&&!r)break e;const o=n;i.run();const a=performance.now()-o;i.type.addTaskDuration(a),t+=a}}}var o=i(67502),a=i(81890);class Task{constructor(e,t,i,s){this.type=e,this.func=t,this.deadline=i,this.steps=s,this.status=n.WAITING,this.promise=new Promise(((e,t)=>{this.onSuccess=e,this.onError=t}))}run(){let e;this.status=n.STARTED;try{e=this.func.next()}catch(e){return this.status=n.DONE,void this.onError(e)}this.steps-=1,e.done&&(this.status=n.DONE,this.onSuccess(e.value))}get estimatedDuration(){return this.steps*this.type.typicalStepDuration}get urgency(){const e=this.deadline-performance.now();return e<=0?1e6-e:this.estimatedDuration/e/e}}class SchedulerModule extends s.Y{constructor(){super(...arguments),this.name="scheduler-module",this.scheduler=new Scheduler}async init(e,t){this.engine=t,this.engine.commandBinder.addBinding(o._,(async e=>{const t=new Task(this.scheduler.getType(e.type),e.func,performance.now()+e.maxDelay,e.steps);return this.scheduler.addTask(t),t})),this.engine.commandBinder.addBinding(a.S,(async e=>{const t=new Task(this.scheduler.getType(e.type),e.func,performance.now()+e.maxDelay,e.steps);return this.scheduler.addTask(t),t}))}onUpdate(e){this.scheduler.update(4)}}},24844:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ScreenshotsModule});var n=i(47724),s=i(736),r=i(24930),o=i(40168),a=i(84561),l=i(60771),c=i(1466),h=i(91670),d=i(25923),u=i(88512),p=i(2212),m=i(32306),g=i(87202);const f=new u.Z("screenshots");class ScreenshotsModule extends n.Y{constructor(){super(...arguments),this.name="screenshots-module",this.capturer=new ScreenCapturer}async init(e,t){this.engine=t,[this.settingsModule,this.canvas,this.renderer,this.renderToTexture]=await Promise.all([t.getModule(r.default),t.market.waitForData(o.W),t.getModuleBySymbol(s.y.WEBGL_RENDERER),t.getModule(m.default)]),this.settingsModule.registerButton("Debug","Take screenshot",(async()=>{const e=Date.now();await this.takeAndDownloadScreenshot({height:this.canvas.height,width:this.canvas.width},`image_${e}.jpg`,a.o.ALL)})),this.settingsModule.registerButton("Debug","Take 4k screenshot",(async()=>{const e=Date.now();await this.takeAndDownloadScreenshot({height:2304,width:4096},`image_${e}.jpg`,a.o.ALL)})),this.settingsModule.registerButton("Debug","Take 8k screenshot",(async()=>{const e=Date.now();await this.takeAndDownloadScreenshot({height:4608,width:8192},`image_${e}.jpg`,a.o.ALL)})),this.settingsModule.registerButton("Debug","Take 16k screenshot",(async()=>{const e=Date.now();await this.takeAndDownloadScreenshot({height:9e3,width:16e3},`image_${e}.jpg`,a.o.ALL)})),this.settingsModule.registerButton("Debug","Take FB 3D screenshot",(async()=>{const e=Date.now(),t=this.engine.getRenderLayer("model-mesh"),i=this.engine.getRenderLayer("skybox"),n=t.clone();n.addLayers(i);try{await this.takeAndDownloadScreenshot({height:this.canvas.height,width:this.canvas.width},`image_${e}.jpg`,n),await this.engine.commandBinder.issueCommand(new h.U(h.U.modes.Depth)),await this.engine.commandBinder.issueCommand(new d.g(1)),await this.takeAndDownloadScreenshot({height:Math.floor(this.canvas.height/4),width:Math.floor(this.canvas.width/4)},`image_${e}_depth.jpg`,t)}catch(e){throw f.error("Could not take screenshot"),e}finally{await this.engine.commandBinder.issueCommand(new h.U(null)),await this.engine.commandBinder.issueCommand(new d.g(0))}}))}async takeAndDownloadScreenshot(e,t,i){this.renderTarget||(this.renderTarget=await this.engine.commandBinder.issueCommandWhenBound(new g.oM));const n=await this.capturer.capture(i,e,this.renderer,this.renderToTexture,this.renderTarget);(0,l.Hx)((0,c.Xk)(n),t)}}class ScreenCapturer{constructor(){this.captureCamera=new p.Camera}async capture(e,t,i,n,s){const{camera:r,scene:o}=i.getScene();return r.getWorldPosition(this.captureCamera.position),r.getWorldQuaternion(this.captureCamera.quaternion),this.captureCamera.projectionMatrix.copy(r.projectionMatrix),this.captureCamera.layers.mask=e.mask,s.setSize(t.width,t.height),n.render(s.target,o,this.captureCamera),await(0,c.vP)(s)}}},4141:(e,t,i)=>{"use strict";var n;i.d(t,{B:()=>n}),function(e){e.MATTERTAG="Mattertag",e.LABEL="Label",e.MEASUREMENT="Measurement"}(n||(n={}))},69617:(e,t,i)=>{"use strict";i.d(t,{r:()=>SearchResultsData});var n=i(32770),s=i(75256),r=i(48715);class SearchResultsData extends n.V{constructor(){super(...arguments),this.query=(0,r.Y)(null),this.results=(0,s.C)([])}getQuery(){return this.query.value}setQuery(e){this.query.value=e}getResults(){return this.results.values()}setResults(e){this.results.replace(e)}}},62644:(e,t,i)=>{"use strict";i.d(t,{X:()=>SearchModeToggleCommand,H:()=>SendQueryCommand});var n=i(17386);class SearchModeToggleCommand extends n.m{constructor(e){super(),this.payload={opened:e}}}class SendQueryCommand extends n.m{constructor(e){super(),this.payload={query:e}}}},69808:(e,t,i)=>{"use strict";i.d(t,{B:()=>n});const n="features/space-search"},55105:(e,t,i)=>{"use strict";i.d(t,{K:()=>SensorModule});var n=i(47724),s=i(736),r=i(36371),o=i(12216),a=i(2212);class SensorObserver{constructor(){this.needsUpdate=!0}notify(){this.needsUpdate=!0}}var l=i(61255);class SensorObservable{constructor(e){this.observable=new l.$,this.notifier=new class{constructor(e){this.sensorObservable=e}notify(){this.sensorObservable.observable.notify()}}(this),this.dependencySub=e.sub(this.notifier)}dispose(){this.dependencySub.cancel()}observe(e){return this.observable.observe(e)}}class CameraFrustumVolume{constructor(e){this.cameraData=e,this._forward=new a.Vector3,this.frustum=new a.Frustum,this.frustumTransform=new r.M,this.frustumProjection=new r.M,this.forwardObserver=new SensorObserver,this.frustumObserver=new SensorObserver,this.frustumObservable=new SensorObservable(new CameraDataSubsriber(e)),this.frustumObservable.observe(this.forwardObserver),this.frustumObservable.observe(this.frustumObserver)}dispose(){this.frustumObservable.dispose()}get fovx(){return this.cameraData.fovX()}get fovy(){return this.cameraData.fovY()}get forward(){return this.forwardObserver.needsUpdate&&(this.forwardObserver.needsUpdate=!1,this._forward.copy(o.f.FORWARD),this._forward.applyQuaternion(this.cameraData.pose.rotation)),this._forward}observe(e){return this.frustumObservable.observe(e)}get origin(){return this.cameraData.pose.position}containsPoint(e){return this.updateVolume(),this.frustum.containsPoint(e)}updateVolume(){if(this.frustumObserver.needsUpdate){this.frustumObserver.needsUpdate=!1;const e=this.cameraData.pose;this.frustumTransform.compose(e.position,e.rotation,o.f.UNIT).getInverse(this.frustumTransform),this.frustumProjection.copy(this.cameraData.pose.projection),this.frustum.setFromProjectionMatrix(this.frustumTransform.multiplyMatrices(this.frustumProjection,this.frustumTransform).asThreeMatrix4())}}}class CameraDataSubsriber{constructor(e){this.cameraData=e}sub(e){return this.cameraData.onChanged((()=>e.notify()))}}var c=i(17399),h=i(59088);class SensorUpdater{constructor(){this.sensors=new Set}addSensor(e){this.sensors.add(e)}removeSensor(e){this.sensors.delete(e)}update(){for(const e of this.sensors)e.update()}}class SensorDecorator{constructor(e,t,i){this.frustum=e,this.raycaster=t,this.sensorDisposer=i,this.volumeObserver=new SensorObserver,this.sources=new Set,this.dirtySources=new Set,this.sourceWatchers=new Map,this.readingsCache=new Map,this.readingObservable=new l.$,this.raycastDirection=new a.Vector3,this.volumeSub=e.observe(this.volumeObserver)}get origin(){return this.frustum.origin}dispose(){this.volumeSub.cancel(),this.sensorDisposer.disposeSensor(this)}addSource(...e){for(const t of e)this.sources.add(t),this.dirtySources.add(t),this.sourceWatchers.set(t,new SourceWatcher(this.dirtySources,t))}get readings(){return this.readingsCache}update(){this.volumeObserver.needsUpdate?(this.volumeObserver.needsUpdate=!1,this.recomputeAllReadings(),this.readingObservable.notify()):this.dirtySources.size>0&&(this.recomputeDirtyReadings(),this.readingObservable.notify())}recomputeAllReadings(){for(const e of this.sources)this.recomputeReading(e);this.dirtySources.clear()}recomputeDirtyReadings(){for(const e of this.dirtySources)this.recomputeReading(e);this.dirtySources.clear()}recomputeReading(e){this.raycastDirection.copy(e.origin).sub(this.frustum.origin).normalize();const t=this.frustum.origin.distanceToSquared(e.origin),i=this.readingsCache.get(e)||{direction:new a.Vector3};i.inRange=function(e,t){return t.volume.containsPoint(e.origin)}(this,e),i.inView=i.inRange&&this.frustum.containsPoint(e.origin)&&!function(e,t){return!!t&&e>t.distance**2}(t,this.raycaster.picking.pick(this.frustum.origin,this.raycastDirection)),i.direction.copy(this.raycastDirection),i.distanceSq=t,this.readingsCache.set(e,i)}onReadingsUpdated(e){return this.readingObservable.observe(e)}}class SourceWatcher{constructor(e,t){this.sub=t.volume.observe({notify(){e.add(t)}})}dispose(){this.sub.cancel()}}var d=i(94610),u=i(35003),p=i(24764),m=i(13827);const g=(e,t)=>e.type===m.SourceType.BOX?v(t):e.type===m.SourceType.CYLINDER?function(e){const t=new a.CylinderBufferGeometry(.5,.5,1);t.translate(0,.5,0);const i=new a.Mesh(t,new a.MeshBasicMaterial);i.scale.set(.05,.1,.05);const n=new a.MeshBasicMaterial({transparent:!0,opacity:.1,side:a.DoubleSide,depthWrite:!1}),s=new a.Mesh(t,new a.MeshBasicMaterial({wireframe:!0})),r=new a.Mesh(t,n);return r.add(s),e.add(i),e.add(r),{interactionMesh:i,volumeMesh:r,dispose(){e.remove(i),e.remove(r),i.geometry.dispose(),i.material.dispose(),r.geometry.dispose(),r.material.dispose(),s.geometry.dispose(),s.material.dispose()},setColor(e){r.material.color.set(e),s.material.color.set(e)}}}(t):f(t),f=e=>{const t=new a.SphereBufferGeometry(1,20,20),i=new a.Mesh(t,new a.MeshBasicMaterial);i.scale.set(.5,.5,.5);const n=new a.Mesh(t,new a.MeshBasicMaterial({wireframe:!0})),s=new a.Mesh(t,new a.MeshBasicMaterial({transparent:!0,opacity:.1,side:a.DoubleSide,depthWrite:!1}));return s.add(n),e.add(i),e.add(s),{interactionMesh:i,volumeMesh:s,dispose:()=>{e.remove(i),e.remove(s),i.geometry.dispose(),i.material.dispose(),s.geometry.dispose(),s.material.dispose(),n.geometry.dispose(),n.material.dispose()},setColor:e=>{s.material.color.set(e),n.material.color.set(e)}}},v=e=>{const t=new a.BoxBufferGeometry(1,1,1),i=new a.Mesh(t,new a.MeshBasicMaterial);i.scale.set(.1,.1,.1);const n=new a.MeshBasicMaterial({transparent:!0,opacity:.1,side:a.DoubleSide,depthWrite:!1}),s=new a.Mesh(t,n),r=new a.LineSegments(new a.EdgesGeometry(t),new a.LineBasicMaterial);return s.add(r),e.add(i),e.add(s),{interactionMesh:i,volumeMesh:s,dispose:()=>{e.remove(i),e.remove(s),i.geometry.dispose(),i.material.dispose(),s.geometry.dispose(),s.material.dispose(),r.geometry.dispose(),r.material.dispose()},setColor:e=>{s.material.color.set(e),r.material.color.set(e)}}};const y=e=>{if(e.type===m.SourceType.BOX){const t=e;return Object.assign({},t.volume.size)}if(e.type===m.SourceType.CYLINDER){const t=e;return{x:t.volume.radius,y:t.volume.height,z:t.volume.radius}}{const t=e.volume.radius;return{x:t,y:t,z:t}}},b=(new a.Quaternion).identity();function S(e){if(e.type===m.SourceType.BOX){return e.volume.orientation}return b}class VolumeVisualizer{constructor(e,t,i){this.source=e,this.scene=t,this.inputIni=i,this.subs=[],this.stickyHover=!1,this.sourceDirty=!0,this.meshes=g(e,this.scene.scene),this.meshes.interactionMesh.scale.set(.1,.1,.1),this.meshes.interactionMesh.position.copy(this.source.origin),this.meshes.interactionMesh.material.color.set(16724312),this.meshes.volumeMesh.scale.set(0,0,0),this.meshes.volumeMesh.position.copy(this.source.origin),this.meshes.volumeMesh.visible=!1;const n=S(e);this.meshes.volumeMesh.quaternion.copy(n);this.mixer=new a.AnimationMixer(this.meshes.volumeMesh);const s=y(e),r=new a.VectorKeyframeTrack(".scale",[0,.4],[0,0,0,s.x,s.y,s.z],a.InterpolateSmooth),o=new a.AnimationClip(void 0,.4,[r]);this.onHoverAction=this.mixer.clipAction(o),this.onHoverAction.clampWhenFinished=!0,this.onHoverAction.loop=a.LoopOnce,this.subs.push(this.inputIni.registerMeshHandler(d.z,p.s.isValue(this.meshes.interactionMesh),(()=>{const e=this.onHoverAction.time;this.onHoverAction.reset(),this.meshes.volumeMesh.visible=!0,this.onHoverAction.timeScale=1,this.onHoverAction.time=e,this.onHoverAction.play()}))),this.subs.push(this.inputIni.registerMeshHandler(d.A,p.s.isValue(this.meshes.interactionMesh),(()=>{if(!this.stickyHover){const e=this.onHoverAction.time;this.onHoverAction.reset(),this.onHoverAction.time=e,this.onHoverAction.timeScale=-1,this.onHoverAction.play()}}))),this.subs.push(this.inputIni.registerMeshHandler(u.R,p.s.isValue(this.meshes.interactionMesh),(()=>{this.stickyHover=!this.stickyHover,this.stickyHover?this.meshes.interactionMesh.material.color.set(4473924):this.meshes.interactionMesh.material.color.set(16724312)}))),this.inputIni.registerMesh(this.meshes.interactionMesh,!1),this.subs.push(e.volume.observe(this))}notify(){this.sourceDirty=!0}update(e,t){if(this.sourceDirty){this.sourceDirty=!1,this.meshes.interactionMesh.position.copy(this.source.origin),this.meshes.volumeMesh.position.copy(this.source.origin),this.meshes.volumeMesh.quaternion.copy(S(this.source));const e=y(this.source),t=this.onHoverAction.getClip().tracks[0].values;t[3]=e.x,t[4]=e.y,t[5]=e.z}this.meshes.setColor(t.inRange?65280:16711680),this.mixer.update(e/1e3)}dispose(){this.meshes.dispose(),this.mixer.stopAllAction();for(const e of this.subs)e.cancel()}}class SensorRenderer{constructor(e,t,i){this.sensor=e,this.scene=t,this.inputIni=i,this.subs=[],this.visuals=new Map}init(){this.subs.push(this.sensor.onReadingsUpdated(this))}render(e){for(const[t,i]of this.sensor.readings){let n=this.visuals.get(t);n||(n=new VolumeVisualizer(t,this.scene,this.inputIni),this.visuals.set(t,n)),n.update(e,i)}}dispose(){}activate(){}deactivate(){for(const e of this.subs)e.cancel();for(const e of this.visuals.values())e.dispose();this.visuals.clear()}notify(){}}class SensorModule extends n.Y{constructor(){super(...arguments),this.name="sensor-module",this.sensorUpdater=new SensorUpdater,this.debugSensor=null,this.sensorDisposer=new class{constructor(e){this.sensors=e}disposeSensor(e){this.sensors.removeSensor(e)}}(this)}async init(e,t){[this.cameraData,this.raycaster,this.renderer,this.inputIni]=await Promise.all([await t.market.waitForData(h.M_),await t.getModule(c.default),await t.getModuleBySymbol(s.y.WEBGL_RENDERER),await t.getModuleBySymbol(s.y.INPUT)]),this.cameraVolume=new CameraFrustumVolume(this.cameraData);var i,n,r,o;this.sensorDebuggerFactory=(i=e=>{t.addComponent(this,e)},n=e=>{t.removeComponent(this,e)},r=this.renderer.getScene(),o=this.inputIni,e=>{const t=new SensorRenderer(e,r,o);return i(t),{dispose:()=>{n(t)}}})}dispose(){this.cameraVolume.dispose()}createSensor(e){const t=new SensorDecorator(e,this.raycaster,this.sensorDisposer);return this.sensorUpdater.addSensor(t),t}createCameraBoundSensor(){return this.createSensor(this.cameraVolume)}setDebugSensor(e){this.debugSensor&&(this.debugSensor.dispose(),this.debugSensor=null),e&&(this.debugSensor=this.sensorDebuggerFactory(e))}onUpdate(){this.sensorUpdater.update()}removeSensor(e){this.sensorUpdater.removeSensor(e)}}},13827:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a,SensorModule:()=>n.K,BoxVolume:()=>s.k,CylinderVolume:()=>r.X,SphereVolume:()=>o.b,SourceType:()=>l});var n=i(55105),s=i(3198),r=i(9576),o=i(88269);const a=n.K;var l;!function(e){e.SPHERE="sourcetype.sphere",e.BOX="sourcetype.box",e.CYLINDER="sourcetype.cylinder"}(l||(l={}))},3198:(e,t,i)=>{"use strict";i.d(t,{k:()=>BoxVolume});var n=i(2212),s=i(61255);class BoxVolume extends s.${constructor(){super(),this.box=new n.Box3,this.center=new n.Vector3,this.size=new n.Vector3(1/0,1/0,1/0),this.orientation=new n.Quaternion,this.inverseOrientation=new n.Quaternion,this.pointCache=new n.Vector3,this.transformNeedsUpdate=!1,this.box.setFromCenterAndSize(this.center,this.size)}get origin(){return this.center}updateCenter(e){this.center.copy(e),this.box.setFromCenterAndSize(this.center,this.size),this.transformNeedsUpdate=!0}updateDimensions(e){this.size.copy(e),this.box.setFromCenterAndSize(this.center,this.size)}updateOrientation(e){this.orientation.copy(e),this.transformNeedsUpdate=!0}containsPoint(e){return this.transformNeedsUpdate&&(this.transformNeedsUpdate=!1,this.inverseOrientation.copy(this.orientation).invert()),this.pointCache.copy(e).sub(this.center),this.pointCache.applyQuaternion(this.orientation),this.pointCache.add(this.center),this.box.containsPoint(this.pointCache)}}},9576:(e,t,i)=>{"use strict";i.d(t,{X:()=>CylinderVolume});var n=i(2212),s=i(61255);class CylinderVolume extends s.${constructor(){super(...arguments),this._basePoint=new n.Vector3,this._height=1/0,this._radius=1/0,this.pointCache=new n.Vector3}get origin(){return this._basePoint}get basePoint(){return this._basePoint}get height(){return this._height}get radius(){return this._radius}updateBasePoint(e){this.basePoint.set(e.x,e.y,e.z)}updateHeight(e){this._height=e}updateRadius(e){this._radius=e}containsPoint(e){return this.pointCache.set(e.x,this._basePoint.y,e.z),this._basePoint.distanceToSquared(this.pointCache)<=this.radius**2&&this._basePoint.y<=e.y&&e.y<=this._basePoint.y+this.height}}},88269:(e,t,i)=>{"use strict";i.d(t,{b:()=>SphereVolume});var n=i(2212),s=i(61255);class SphereVolume extends s.${constructor(){super(...arguments),this.origin=new n.Vector3,this.radius=1/0}updateRadius(e){this.radius=e}updateOrigin(e){this.origin.copy(e)}containsPoint(e){return this.origin.distanceToSquared(e)<=this.radius**2}}},25269:(e,t,i)=>{"use strict";i.d(t,{i:()=>SkySphereMesh});var n=i(2212);class SkySphereMesh extends n.Mesh{}},37238:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SkyboxModule});var n=i(47724),s=i(736),r=i(2212),o=i(31090),a=i(69383),l=i(20855);const c={sky:{uniforms:{topColor:{type:"v3",value:new r.Vector3(.094,.102,.11)},bottomColor:{type:"v3",value:new r.Vector3(.2,.216,.235)},radius:{type:"f",value:100}},vertexShader:(0,l.m)(a,i(13833)),fragmentShader:(0,l.m)(o,i(55185))}};class SkyboxMaterial extends r.RawShaderMaterial{constructor(e={}){super(Object.assign({fragmentShader:c.sky.fragmentShader,vertexShader:c.sky.vertexShader,uniforms:r.UniformsUtils.clone(c.sky.uniforms),name:"SkyboxMaterial"},e))}}var h=i(84561),d=i(25269),u=i(48358),p=i(63560);class Skybox{constructor(e,t,i,n,s=h.o.ALL){this.scene=e,this.cameraData=t,this.addToRaycasting=i,this.removeFromRaycasting=n,this.renderLayer=s,this.bindings=[]}init(){const{visualMesh:e,colliderMesh:t}=this.setupSkysphere();this.skyVisual=e,this.material=this.skyVisual.material,this.skyCollider=t}dispose(){this.material.uniforms.pano0Map.value.dispose(),this.material.uniforms.pano1Map.value.dispose(),this.material.dispose(),this.skyVisual.geometry.dispose()}activate(e){this.scene.addChild(this.scene.ids.Root,this.skyVisual),this.skyVisual.updateMatrixWorld(!0),this.skyVisual.visible=!0,this.addToRaycasting(this.skyCollider,!1)}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings=[],this.scene.removeChild(this.scene.ids.Root,this.skyVisual),this.scene.removeChild(this.scene.ids.CameraRig,this.skyCollider),this.removeFromRaycasting(this.skyCollider)}updateBackgroundColors(e,t){const i=new r.Color(e),n=new r.Color(t);this.material.uniforms.topColor.value.set(i.r,i.g,i.b),this.material.uniforms.bottomColor.value.set(n.r,n.g,n.b)}beforeRender(){this.skyVisual.position.copy(this.cameraData.pose.position),this.skyCollider.position.copy(this.cameraData.pose.position)}render(){}setupSkysphere(e){const t=new r.SphereBufferGeometry(1e4,5,5);t.computeBoundingBox();const i=p.oR.far-10,n=new r.SphereBufferGeometry(i,5,5);n.computeBoundingBox(),e||(e=new SkyboxMaterial({side:r.BackSide}));const s=new d.i(n,e);s.layers.mask=this.renderLayer.mask,s.name="Skysphere",s.renderOrder=u.z.boundingSkybox,s.updateMatrixWorld(!0),e.uniforms.radius.value=i,e.depthWrite=!1,e.depthTest=!1;return{visualMesh:s,colliderMesh:new d.i(t,new r.MeshBasicMaterial({opacity:0,depthWrite:!1,side:r.BackSide}))}}}var m=i(33874),g=i(54243),f=i(3248),v=i(59088);class SkyboxModule extends n.Y{constructor(){super(...arguments),this.name="skybox-module"}async init(e,t){const[i,n,r,o]=await Promise.all([t.getModuleBySymbol(s.y.WEBGL_RENDERER),t.market.waitForData(m.e),t.getModuleBySymbol(s.y.INPUT),t.market.waitForData(v.M_)]),a=t.claimRenderLayer("skybox"),l=i.getScene();this.skybox=new Skybox(l,o,r.registerMesh,r.unregisterMesh,a),t.addComponent(this,this.skybox);const c=n.tryGetProperty(f.gx.BackgroundColor,g.z.default);this.skybox.updateBackgroundColors(g.K[c].bgPrimary,g.K[c].bgSecondary),this.bindings.push(n.onPropertyChanged(f.gx.BackgroundColor,(e=>{this.skybox.updateBackgroundColors(g.K[e].bgPrimary,g.K[e].bgSecondary)})))}}},20664:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SnapshotsEditor});var n=i(47724),s=i(736),r=i(75892),o=i(59088),a=i(94329),l=i(35597),c=i(87202),h=i(1466),d=i(52586),u=i(41862),p=i(37381),m=i(84561),g=i(34369),f=i(7170),v=i(65814),y=i(17386),b=i(53931);class CaptureSnapshotCommand extends y.m{constructor(e){super(),this.id="CAPTURE_SNAPSHOT",this.payload={maxSize:e.maxSize||g.SL.ULTRAHIGH,aspect:e.aspect||b.g$,category:e.category||v.i.USER,onProgress:e.onProgress,waitForUpload:void 0===e.waitForUpload||e.waitForUpload}}}class EquirectSnapshotCommand extends y.m{constructor(e){super(),this.id="EQUIRECTANGULAR_SNAPSHOT",this.payload={onProgress:e.onProgress,waitForUpload:void 0===e.waitForUpload||e.waitForUpload}}}var S=i(48715),E=i(79956),w=i(12216),T=i(69626),_=i(91466);class SnapshotErrorMessage extends _.v{constructor(e){super(),this.error=e}}var M=i(31102);class SnapshotCaptureError extends M.y{constructor(e,t="72002"){super(e),this.name="SnapshotCaptureError"}}class SnapshotUploadError extends M.y{constructor(e,t="73002"){super(e),this.name="SnapshotUploadError"}}var x=i(88512),A=i(27326),O=i(35026),P=i(10757),D=i(29422),C=i(25040),I=i(39753),L=i(43205),R=i(36297);const N=new x.Z("snapshot-editor"),k=p.Xd.uploadIntervalDelay;class SnapshotsEditor extends n.Y{constructor(){super(...arguments),this.name="snapshots-editor"}async init(e,t){this.engine=t,[this.renderer,this.sweepTilingModule]=await Promise.all([t.getModuleBySymbol(s.y.WEBGL_RENDERER),t.getModuleBySymbol(s.y.SWEEP_PANO)]),[this.sweepData,this.viewmodeData,this.cameraData,this.floorsViewData]=await Promise.all([t.market.waitForData(r.Z),t.market.waitForData(l.O),t.market.waitForData(o.M_),t.market.waitForData(A.c),t.market.waitForData(E.P)]),[this.snapshotTarget,this.snapshotOverlayTarget]=await Promise.all([t.commandBinder.issueCommandWhenBound(new c.oM),t.commandBinder.issueCommandWhenBound(new c.oM)]),this.bindings.push(t.commandBinder.addBinding(CaptureSnapshotCommand,(async e=>{const i=e.onProgress||(0,S.Y)(0);i.value=10,t.commandBinder.issueCommand(new D.ZK),t.commandBinder.issueCommand(new R.M);const n=await this.queryIdealResolution(e.maxSize,e.aspect);this.snapshotTarget.setSize(n.width,n.height),this.snapshotOverlayTarget.setSize(n.width,n.height),await this.fetchHighestAvailable(!1,e.maxSize,(e=>i.value=Math.max(10,e))),await(0,P.gw)(2*k),await this.takeScreenshot();const s=this.sweepData.getSweep(this.sweepData.currentSweep);this.viewmodeData.currentMode===a.Ey.Panorama&&await this.sweepTilingModule.resetSweep(s.id),t.commandBinder.issueCommand(new D.Lp),t.commandBinder.issueCommand(new R.I);let r=e.category;s&&(s.alignmentType===O.z9.UNALIGNED||s.placementType===O.hU.MANUAL)&&r===v.i.USER&&(r=v.i.UNALIGNED);const o=this.uploadAndAddSnapshot(r).then((e=>e&&e.sid)).catch((e=>{throw N.error(e),this.engine.broadcast(new SnapshotErrorMessage(e)),e}));return e.waitForUpload?o:null})));const i=w.f.FORWARD.clone(),n=w.f.FORWARD.clone();this.bindings.push(t.commandBinder.addBinding(EquirectSnapshotCommand,(async e=>{const s=e.onProgress||(0,S.Y)(0);s.value=10,t.commandBinder.issueCommand(new D.ZK),await(0,P.gw)(50);const r=this.queryIdealEqResolution();this.snapshotTarget.setSize(r.width,r.height);const o=this.sweepData.getSweep(this.sweepData.currentSweep);i.copy(w.f.FORWARD).applyQuaternion(o.rotation).setY(0),n.copy(w.f.FORWARD).applyQuaternion(this.cameraData.pose.rotation).setY(0);const a=(0,T.k2)(i,n)+Math.PI;await this.fetchHighestAvailable(!0,g.SL.ULTRAHIGH,(e=>s.value=Math.max(10,e))),await this.takeEquirectangular(a),await this.sweepTilingModule.resetSweep(o.id),t.commandBinder.issueCommand(new D.Lp);const l=(0,h.fY)(this.snapshotTarget.width,this.snapshotTarget.height,a,0),c=this.uploadAndAddSnapshot(v.i.PANORAMA,l).then((e=>e&&e.sid)).catch((e=>{throw N.error(e),this.engine.broadcast(new SnapshotErrorMessage(e)),e}));return e.waitForUpload?c:null})))}async uploadAndAddSnapshot(e,t){const i=this.createSnapshot(e);i.state=I.R.CAPTURING,i.imageBlob=(0,h.Xk)(await(0,h.vP)(this.snapshotTarget,t)),i.state=I.R.UPLOADING;try{return await this.engine.commandBinder.issueCommand(new L.nM(i))}catch(e){throw i.state=I.R.ERROR,N.error(e),new SnapshotUploadError(e)}}createSnapshot(e){const t=this.viewmodeData.isPano();let i=(0,P.DZ)(new Date);if(t){const e=this.sweepData.getSweep(this.sweepData.currentSweep).name;e&&(i=e)}const n=new C.a;return n.name=i,n.category=e,n.is360=t&&!this.sweepData.currentAlignedSweepObject,n.metadata={cameraMode:this.viewmodeData.currentMode,cameraPosition:this.cameraData.pose.position.clone(),cameraQuaternion:this.cameraData.pose.rotation.clone(),orthoZoom:this.viewmodeData.currentMode===a.Ey.Floorplan?this.cameraData.zoom():-1,ssZoom:this.cameraData.zoom(),scanId:t?this.sweepData.currentSweep:void 0,floorId:this.floorsViewData.currentFloorId,floorVisibility:this.floorsViewData.getFloorsVisibility()},n}async queryIdealResolution(e=g.SL.ULTRAHIGH,t){let i=3840,n=i*b.LP;const s=this.renderer.maxTextureSize;if(i>s&&(N.warn(`The active gl context does not support 4k x 2k equirectangular capture\nCapture is limited to a max size of ${s}`),i=s,n=i*b.LP),this.viewmodeData.currentMode===a.Ey.Panorama){const r=await this.sweepTilingModule.availableResolution(this.sweepData.currentSweepObject,e),o=d.Z.getPanoSize(r)*(this.cameraData.fovY()*f.MN)/90;i=Math.min(Math.round(o*t),s),n=Math.round(i/t)}return Promise.resolve({width:i,height:n})}queryIdealEqResolution(){let e=4096,t=.5*e;if(this.viewmodeData.currentMode!==a.Ey.Panorama)throw new SnapshotCaptureError("Equirectangular capture is only supported in Panorama mode");const i=this.renderer.maxTextureSize;return e>i&&N.warn(`The active gl context does not support 4k x 2k equirectangular capture\nCapture is limited to a max size of ${i}`),e=Math.min(i,e),t=.5*e,{width:e,height:t}}fetchHighestAvailable(e,t=g.SL.ULTRAHIGH,i){if(this.viewmodeData.currentMode===a.Ey.Panorama){const n=this.sweepData.currentSweepObject,s=e?u.v.FullPanorama:u.v.CurrentView;return this.sweepTilingModule.requestResolution(n,t,s,!0).then((e=>{const t=this.sweepTilingModule.waitForQueue(s,e);return i&&t.progress((e=>i(e*SnapshotsEditor.captureProgressFudgeFactor))),t.nativePromise()}))}return i&&i(SnapshotsEditor.captureProgressFudgeFactor),Promise.resolve()}takeScreenshot(){const e=m.o.ALL;e.removeLayers(this.engine.getRenderLayer("grid-underlay")),e.removeLayers(this.engine.getRenderLayer("cursor-mesh")),e.removeLayers(this.engine.getRenderLayer("current-pano-marker"));const t=this.renderer.getScene().scene,i=this.renderer.getScene().camera,n=i.layers.mask;return i.layers.mask=e.mask,this.engine.commandBinder.issueCommand(new c.vU(this.snapshotTarget,t,i)).then((()=>{i.layers.mask=n}))}takeEquirectangular(e){const t=this.sweepData.currentSweep,i=this.sweepTilingModule.getRenderer(),n=i.useTexture(t),s=this.engine.commandBinder.issueCommand(new c.fZ(this.snapshotTarget,n,e));return i.freeTexture(t),s}}SnapshotsEditor.captureProgressFudgeFactor=90},25040:(e,t,i)=>{"use strict";i.d(t,{a:()=>Snapshot});var n=i(23573),s=i(94329),r=i(65814);class Snapshot extends n.T{constructor(){super(),this.category=r.i.USER}clone(){return(new Snapshot).copy(this)}copy(e){return this.sid=e.sid,this.thumbnailUrl=e.thumbnailUrl,this.imageUrl=e.imageUrl,this.name=e.name,this.is360=e.is360,this.category=e.category,this.height=e.height,this.width=e.width,this.created=e.created,this.modified=e.modified,this.visionLabel=e.visionLabel,this.visionName=e.visionName,this.imageBlob=e.imageBlob,this.metadata={cameraMode:e.metadata.cameraMode,cameraPosition:e.metadata.cameraPosition.clone(),cameraQuaternion:e.metadata.cameraQuaternion.clone(),scanId:e.metadata.scanId,orthoZoom:e.metadata.orthoZoom,ssZoom:e.metadata.ssZoom,floorId:e.metadata.floorId,floorVisibility:e.metadata.floorVisibility},this.commit(),this}isInsidePano(){return this.metadata.cameraMode===s.Ey.Panorama&&""!==this.metadata.scanId}refresh(e){this.thumbnailUrl.refreshFrom(e.thumbnailUrl),this.imageUrl.refreshFrom(e.imageUrl)}}},65814:(e,t,i)=>{"use strict";var n;i.d(t,{i:()=>n}),function(e){e.USER="user",e.PANORAMA="panorama",e.UNALIGNED="unaligned",e.AUTO="auto",e.TOUR="tour"}(n||(n={}))},39753:(e,t,i)=>{"use strict";var n;i.d(t,{R:()=>n}),function(e){e.CAPTURING="capturing",e.UPLOADING="uploading",e.ERROR="error",e.DONE="done"}(n||(n={}))},43205:(e,t,i)=>{"use strict";i.d(t,{yz:()=>RenameSnapshotCommand,Ad:()=>DeleteSnapshotCommand,nM:()=>UploadSnapshotCommand});var n=i(17386);class RenameSnapshotCommand extends n.m{constructor(e,t){super(),this.id="RENAME_SNAPSHOT",this.payload={id:e,name:t}}}class DeleteSnapshotCommand extends n.m{constructor(e){super(),this.id="DELETE_SNAPSHOT",this.payload={id:e}}}class UploadSnapshotCommand extends n.m{constructor(e){super(),this.id="UPLOAD_SNAPSHOT",this.payload={snapshot:e}}}},79956:(e,t,i)=>{"use strict";i.d(t,{P:()=>SnapshotsData});var n=i(32770),s=i(10757),r=i(77680);class SnapshotsData extends n.V{constructor(e){super(),this.name="snapshots",this.snapshots={};for(const t in e)this.snapshots[t]=e[t].clone()}get(e){return this.snapshots[e]}get collection(){return this.snapshots}add(e){e.sid=this.validateSid(e.sid),this.snapshots[e.sid]=e,this.updateOnStaleCallbacks(),this.commit()}remove(e){delete this.snapshots[e.sid],this.commit()}validateSid(e){for(;!e||this.snapshots[e];)e=(0,s.O1)(11);return e}set onStale(e){this.hydrate=e,this.updateOnStaleCallbacks()}updateOnStaleCallbacks(){this.hydrate&&(0,r.s)(this.snapshots,(async()=>{const e=await this.hydrate();for(const t in this.snapshots)e&&e[t]&&this.snapshots[t].refresh(e[t])}))}}},46072:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SnapshotsDataModule});var n=i(47724),s=i(38420),r=i(94329),o=i(88512),a=i(75892),l=i(79956),c=i(70778),h=i(94474),d=i(71918),u=i(12935),p=i(76875),m=i(34031),g=i(19674),f=i(87324),v=i(65814);const y={[r.Ey.Dollhouse]:p.w.DOLLHOUSE,[r.Ey.Floorplan]:p.w.FLOORPLAN,[r.Ey.Panorama]:p.w.PANORAMA,[r.Ey.Outdoor]:p.w.PANORAMA,[r.Ey.Transition]:p.w.MESH};class MdsSnapshotUploadSerializer{constructor(){}serialize(e,t){const i=[];for(const[n,s]of e.metadata.floorVisibility.entries())if(1===s){const e=t.floorsData.getFloorAtIndex(n);e&&!e.runtimeOnly&&i.push(e.id)}return{label:e.name,contents:{filename:`${e.name}.jpg`,blob:e.imageBlob},snapshotLocation:{anchorId:e.metadata.scanId,visibleFloorIds:i,position:(0,f.m)(g.ep.toVisionVector(e.metadata.cameraPosition)),rotation:(0,f.J5)(g.ep.toVisionCameraQuaternion(e.metadata.cameraQuaternion)),viewMode:y[e.metadata.cameraMode],zoom:e.metadata.cameraMode===r.Ey.Floorplan?e.metadata.orthoZoom:e.metadata.ssZoom},photoType:e.category===v.i.PANORAMA?m.B.EQUIRECTANGULAR:m.B.PHOTO2D}}}class MdsSnapshotStore extends h.u{constructor(){super(...arguments),this.deserializer=new u.f,this.serializer=new MdsSnapshotUploadSerializer,this.prefetchKey="data.model.assets.photos"}async read(e){const t={modelId:this.getViewId()};return this.query(c.GetSnapshots,t,e).then((e=>{var t,i,n;const s=((null===(n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.assets)||void 0===n?void 0:n.photos)||[]).map((e=>this.deserializer.deserialize(e))),r={};for(const e of s)e&&(r[e.sid]=e);return r}))}async refresh(){return this.refreshPromise||(this.refreshPromise=this.read({fetchPolicy:"no-cache"}).finally((()=>{this.refreshPromise=void 0}))),this.refreshPromise}async create(e,t){const i=h.u.baseViewId,n=e.category===v.i.TOUR,s=n?"UploadHighlightReelSnapshot":"UploadModelSnapshot",r=n?c.UploadHighlightReelSnapshot:c.UploadModelSnapshot,o=this.serializer.serialize(e,t);return this.client.upload(r,s,Object.assign(Object.assign({},o),{modelId:i})).then((e=>{var t;return this.deserializer.deserialize(null===(t=e.data)||void 0===t?void 0:t.snapshot)}))}async update(e){const t=h.u.baseViewId,i=await this.client.mutate(c.PatchPhoto,{modelId:t,photoId:e.sid,label:e.name}),n=(0,d.qw)(i,"data.patchPhoto");return this.deserializer.deserialize(n)}async delete(e){const t=h.u.baseViewId,i=await this.client.mutate(c.DeletePhoto,{modelId:t,photoId:e});return(0,d.qw)(i,"data.deletePhoto")||!1}}var b=i(43205),S=i(91466);class SnapshotCreatedMessage extends S.v{constructor(e){super(),this.snapshot=e}}var E=i(26627),w=i(46963),T=i(49398);const _=new o.Z("MpWebSnapshotSerializer");class MpWebSnapshotSerializer{serialize(e){if(!this.validate(e))return _.info("Cannot serialize invalid snapshot",e),null;const t={camera_mode:(0,r.tU)(e.metadata.cameraMode),camera_position:(0,g.gj)(e.metadata.cameraPosition),camera_quaternion:(0,f.J5)((0,g.EV)(e.metadata.cameraQuaternion)),ortho_zoom:e.metadata.orthoZoom,ss_zoom:e.metadata.ssZoom,scan_id:e.metadata.scanId,is_ortho:e.metadata.cameraMode===r.Ey.Floorplan,floorVisibility:e.metadata.floorVisibility},i=e.category,n=`${e.name}.jpg`;return{src:[e.imageBlob,n],name:e.name,metadata:JSON.stringify(t),category:i}}validate(e){return!!e.imageBlob}}var M,x=i(77680);!function(e){e.AUTO="auto",e.PANORAMA="panorama",e.TOUR="tour",e.UNALIGNED="unaligned",e.USER="user"}(M||(M={}));var A=i(2212),O=i(25040),P=i(39753);const D=new o.Z("MpWebSnapshotDeserializer"),C={[M.AUTO]:v.i.AUTO,[M.PANORAMA]:v.i.PANORAMA,[M.TOUR]:v.i.TOUR,[M.UNALIGNED]:v.i.UNALIGNED,[M.USER]:v.i.USER};class MpWebSnapshotDeserializer{deserialize(e){const t=this.validate(e);if(!t)return D.debug("Deserialized invalid snapshot",e),null;const i=(0,r.Lm)(3===t.metadata.camera_mode?0:t.metadata.camera_mode),n=(0,g.gj)(t.metadata.camera_position?t.metadata.camera_position:new A.Vector3);let s=(0,g.EV)(t.metadata.camera_quaternion||new A.Quaternion);i!==r.Ey.Floorplan&&(s=(0,g.Z)(s));let o=null;const a=t.metadata.floorVisibility;if("object"==typeof a)for(let e=0;e<a.length;e++)a[e]&&(o=e.toString());const l=t.metadata.highest_floor;"number"==typeof l&&l>-1&&(o=l.toString());const c={cameraMode:i,cameraPosition:n,cameraQuaternion:s,scanId:t.metadata.scan_id||"",orthoZoom:t.metadata.ortho_zoom,floorId:o,ssZoom:t.metadata.ss_zoom||1,floorVisibility:t.metadata.floorVisibility},h=C[t.category];return(new O.a).copy({sid:t.sid,state:P.R.DONE,metadata:c,thumbnailUrl:new x.n(t.thumbnail_signed_src,null),imageUrl:new x.n(t.signed_src,null),name:t.name,is360:"unaligned"===t.category,category:h,height:t.height,width:t.width,modified:new Date(Date.parse(t.modified)),created:new Date(Date.parse(t.created)),visionLabel:t.vision_generated_label,visionName:t.vision_generated_name})}validate(e){if(!e)return null;let t;try{t=JSON.parse(e.metadata)}catch(t){return D.info("Failed to parse image metadata: ",e.metadata),null}return 0===Object.keys(t).length||"assetType"in t?null:e.category in C?Object.assign(Object.assign({},e),{metadata:t}):(D.debug(`Invalid snapshot category ${e.category}`),null)}}var I=i(85823),L=i(38330),R=i(80693);class MpWebSnapshotStore extends I.n{constructor(e){super(e),this.serializer=new MpWebSnapshotSerializer,this.deserializer=new MpWebSnapshotDeserializer}async refresh(){throw new w.n("Refresh not implemented for mp_web images")}async read(){const{modelId:e}=this.config,t=`/api/v1/player/models/${e}/`;let i;if(i=R.t.model?R.t.model:await this.request(L.w$.GET,t),!i||!Array.isArray(i.images))return null;const n={};for(const e of i.images){const t=this.deserializer.deserialize(e);t&&(n[t.sid]=t)}return n}async create(e){const{modelId:t,readonly:i}=this.config;if(i)throw new T.pp("Cannot add photo, store is read-only");const n=this.serializer.serialize(e);if(!n)throw new Error("Failed to upload image");const s=new FormData;for(const[e,t]of Object.entries(n))Array.isArray(t)&&t[0]instanceof Blob?s.append(e,...t):s.append(e,t);const r=`/api/v1/player/models/${t}/images/`,o=await this.request(L.w$.POST,r,{body:s});return this.deserializer.deserialize(o)}async update(e){const{modelId:t,readonly:i}=this.config;if(i)throw new T.pp("Cannot update photo, store is read-only");const n={name:e.name},s=`/api/v1/player/models/${t}/images/${e.sid}`,r=await this.request(L.w$.PATCH,s,{body:n});return this.deserializer.deserialize(r)}async delete(e){const{modelId:t,readonly:i}=this.config;if(i)throw new T.pp("Cannot delete photo, store is read-only");const n=`/api/v1/player/models/${t}/images/${e}`;return await this.request(L.w$.DELETE,n),!0}}const N=new o.Z("snapshots");class SnapshotsDataModule extends n.Y{constructor(){super(...arguments),this.name="snapshots-data"}async init(e,t){const{readonly:i}=e;this.engine=t,this.store=this.getStore(e);const n=await this.store.read()||{};this.sweepData=await t.market.waitForData(a.Z);for(const e in n)this.processSnapshot(n[e]);this.snapshotsData=new l.P(n),this.snapshotsData.onStale=()=>this.store.read(),t.market.register(this,l.P,this.snapshotsData),i||this.bindings.push(t.commandBinder.addBinding(b.nM,(({snapshot:e})=>this.uploadSnapshot(e))),t.commandBinder.addBinding(b.yz,(({id:e,name:t})=>this.renameSnapshot(e,t))),t.commandBinder.addBinding(b.Ad,(({id:e})=>this.deleteSnapshot(e))))}async uploadSnapshot(e){const t=await this.engine.market.waitForData(E.i),i=await this.store.create(e,{floorsData:t});return i&&(this.processSnapshot(i),this.snapshotsData.add(i),this.engine.broadcast(new SnapshotCreatedMessage(i))),i}async renameSnapshot(e,t){const i=this.snapshotsData.get(e);if(t!==i.name)return i.name=t,i.commit(),this.snapshotsData.commit(),this.store.update(i)}async deleteSnapshot(e){return this.store.delete(e)}getStore(e){if(this.store)return this.store;const{modelId:t,baseUrl:i,queue:n}=e,r=e.storageProvider||s.Xq.JSONSTORE,o=!("readonly"in e)||!!e.readonly;return N.info(`Loading Snapshots from ${r}`),r===s.Xq.MDS?new MdsSnapshotStore({readonly:o,baseUrl:i}):new MpWebSnapshotStore({modelId:t,readonly:o,queue:n,baseUrl:i})}processSnapshot(e){const t=e.metadata.cameraMode===r.Ey.Panorama,i=!this.sweepData.isSweepAligned(e.metadata.scanId);if(e.is360=t&&i,t){const t=this.sweepData.getSweep(e.metadata.scanId);t&&e.metadata.cameraPosition.copy(t.position)}e.name.match(/^[0-9.]+_[0-9.]+$/)&&(e.name="")}}},12935:(e,t,i)=>{"use strict";i.d(t,{f:()=>MdsSnapshotDeserializer});var n,s,r=i(2212);!function(e){e.SNAPSHOT="snapshot",e.TOUR="tour"}(n||(n={})),function(e){e.USER="user",e.VISION="vision"}(s||(s={}));var o=i(936),a=i(76875),l=i(34031),c=i(94329),h=i(88512),d=i(19674),u=i(71918),p=i(31879),m=i(25040),g=i(65814),f=i(77680);const v=new h.Z("mds-snapshot-deserializer");class MdsSnapshotDeserializer{deserialize(e){if(!e||!this.validate(e))return v.debug("Deserialized invalid Snapshot data from MDS",e),null;const t=new m.a;t.sid=e.id,t.thumbnailUrl=new f.n(e.thumbnailUrl||"",(0,p.p)(e.validUntil,null)),t.imageUrl=new f.n(e.presentationUrl||"",(0,p.p)(e.validUntil,null)),t.name=e.label||"",t.category=this.getCwfSnapshotCategory(e)||g.i.USER,t.width=e.width||0,t.height=e.height||0,t.created=(0,p.p)(e.created),t.modified=(0,p.p)(e.modified),t.visionLabel=e.classification||"";const i=(0,u.qw)(e,"snapshotLocation.anchor.pano.placement");t.is360=!(!i||i===o.b.AUTO);const{snapshotLocation:n}=e;if(n){const e=n.position?d.ep.fromVisionVector(n.position):new r.Vector3,i=n.rotation?d.ep.fromVisionCameraQuaternion(n.rotation):new r.Quaternion,s=this.getCwfViewmode(n.viewMode)||c.Ey.Panorama,o=[];for(const e of n.floorVisibility){for(let t=0;t<e.sequence;t++)o[t]=o[t]||0;o[e.sequence]=1}t.metadata={cameraMode:s,cameraPosition:e,cameraQuaternion:i,scanId:n.anchor&&n.anchor.id||"",orthoZoom:s===c.Ey.Floorplan?n.zoom:-1,ssZoom:n.zoom||1,floorId:n.floorVisibility.length>0?n.floorVisibility[0].id:null,floorVisibility:o}}return t}validate(e){var t;if(!(null===(t=e.snapshotLocation)||void 0===t?void 0:t.position))return!1;const i=["id","snapshotLocation","thumbnailUrl","presentationUrl"].every((t=>t in e)),n=null!==this.getCwfSnapshotCategory(e);return i&&n}getCwfViewmode(e){const t={[a.w.DOLLHOUSE]:c.Ey.Dollhouse,[a.w.PANORAMA]:c.Ey.Panorama,[a.w.FLOORPLAN]:c.Ey.Floorplan,[a.w.MESH]:c.Ey.Panorama};return e in t?t[e]:null}getCwfSnapshotCategory(e){if(e.category===n.TOUR)return g.i.TOUR;if(e.origin===s.VISION)return g.i.AUTO;if(e.type===l.B.EQUIRECTANGULAR)return g.i.PANORAMA;const t=(0,u.qw)(e,"snapshotLocation.anchor.pano.placement");return e.type===l.B.PHOTO2D?t===o.b.MANUAL?g.i.UNALIGNED:g.i.USER:null}}},15585:(e,t,i)=>{"use strict";i.d(t,{U:()=>MaasAttachmentsStore});var n=i(46963),s=i(92540),r=i(81063),o=i(49398);class MaasAttachmentsStore{constructor(e={readonly:!0}){this.viewId=null;const{baseUrl:t,viewId:i}=e;this.config=e,this.client=new s.w({baseUrl:t,server:r.wO}),i&&(this.viewId=i)}async create(...e){throw new n.n}async read(e={}){throw new n.n}async update(...e){throw new n.n}async delete(...e){throw new n.n}async query(e,t,i={}){if(!this.getViewId())throw new o.SN("Cannot read Attachments, no model view configured");return this.client.query(e,t,i)}async mutate(e,t,i){const{readonly:n}=this.config;if(n)throw new o.pp("Cannot write Attachments, model is in read-only mode");if(!this.getViewId())throw new o.SN("Cannot write Attachments, no model view configured");return this.client.mutate(e,t,i)}getViewId(){return this.viewId||MaasAttachmentsStore.currentViewId||MaasAttachmentsStore.baseViewId}static setCurrentViewId(e){MaasAttachmentsStore.currentViewId=e}static setBaseViewId(e){MaasAttachmentsStore.baseViewId=e}}MaasAttachmentsStore.baseViewId=null,MaasAttachmentsStore.currentViewId=null},94474:(e,t,i)=>{"use strict";i.d(t,{u:()=>MdsStore});var n=i(46963),s=i(92540),r=i(93863),o=i(88512),a=i(98828),l=i(49398);const c=new o.Z("MdsStore");class MdsStore{constructor(e={readonly:!0}){this.viewId=null;const{baseUrl:t,viewId:i}=e;this.config=e,this.client=new s.w({baseUrl:t}),i&&(this.viewId=i)}async create(...e){throw new n.n}async read(e={}){throw new n.n}async update(...e){throw new n.n}async delete(...e){throw new n.n}async query(e,t,i={}){if(!this.getViewId())throw new l.SN("No model view specified for query");const n=Object.assign({fetchPolicy:"cache-first",prefetchKey:this.prefetchKey},i),{fetchPolicy:s}=i;let r;if("no-cache"!==s)for(const i of MdsStore.sharedCache)if(r=await i.read(e,t,n),void 0!==r){c.debug(`Using cached response for ${n.prefetchKey}`);break}return r||this.client.query(e,t,n)}async mutate(e,t,i){const{readonly:n}=this.config;if(n)throw new l.pp("Cannot mutate in read-only mode");if(!this.getViewId())throw new l.SN("Cannot mutate, no view was specified");return this.client.mutate(e,t,i).then((e=>{const t="53100"===(0,a.h)("error","");if(!s.w.isOk(e)||t){const i=new r.w0(s.w.getErrorMessage(e));throw t&&(i.isMock=!0),i}return e}))}getViewId(){return this.viewId||MdsStore.currentViewId||MdsStore.baseViewId}static setCurrentViewId(e){MdsStore.currentViewId=e}static setBaseViewId(e){MdsStore.baseViewId=e}static addSharedCache(e){MdsStore.sharedCache.add(e)}static removeSharedCache(e){MdsStore.sharedCache.delete(e)}}MdsStore.baseViewId=null,MdsStore.currentViewId=null,MdsStore.sharedCache=new Set},85823:(e,t,i)=>{"use strict";i.d(t,{n:()=>MpWebStore});var n=i(46963),s=i(88512),r=i(32848),o=i(38330);const a=new s.Z("MpWebStore");class MpWebStore{constructor(e){this.queue=e.queue,this.config=e}getRequestOptions(e){return{responseType:"json",headers:(0,r.m)(e,{})}}getCachedResponse(e,t=o.w$.GET){if(t===o.w$.GET&&e in MpWebStore.cache)return a.info(`Loaded ${e} from cache`),MpWebStore.cache[e]}setCachedResponse(e,t){MpWebStore.cache[e]=t}async request(e,t,i={}){const{baseUrl:n}=this.config,s=Object.assign(Object.assign({},this.getRequestOptions(`${n}${t}`)),i),r=this.getCachedResponse(t,e);if(r)return r;const o=await this.queue.request(e,`${n}${t}`,s);return o&&this.setCachedResponse(t,o),o}async read(){throw new n.n}}MpWebStore.cache={}},80693:(e,t,i)=>{"use strict";i.d(t,{t:()=>PrefetchedData});class PrefetchedData{static get model(){const{model:e}=window.MP_PREFETCHED_MODELDATA||{};return e&&e.sid?e:void 0}static get hasPassword(){const{model:e}=window.MP_PREFETCHED_MODELDATA||{};return e&&e.has_public_access_password}static getQuery(e){var t;return((null===(t=window.MP_PREFETCHED_MODELDATA)||void 0===t?void 0:t.queries)||{})[e]}static get config(){var e;return null===(e=window.MP_PREFETCHED_MODELDATA)||void 0===e?void 0:e.config}}},48602:(e,t,i)=>{"use strict";i.d(t,{Q:()=>StorageData});var n=i(32770),s=i(88512),r=i(38420),o=i(49398),a=i(94474);const l=new s.Z("storage-data");class StorageData extends n.V{constructor(e,t={}){super(),this.lastPublished=null,this.hasUnpublishedChanges=!1,this.publishingEnabled=!1,this.saveEnabled=!1,this.revertEnabled=!1,this.transactionState=r.g7.IDLE,this.views=[],this.unpublished=new Set,this.revertable=new Set,this.currentViewId=e,Object.assign(this,t)}setCurrentView(e){if(e===this.currentViewId)return;const t=this.getView(e);if(!t)throw new o.SN("View not found");l.debug(`Active view set to ${e} (${t.viewType})`),this.currentViewId=e,a.u.setCurrentViewId(e),this.togglePublishingFeatures(),this.commit()}getCurrentView(){return this.getView(this.currentViewId)}getCurrentViewId(){return this.currentViewId}setTransactionState(e){if(e!==this.transactionState){if(![this.transactionState,e].includes(r.g7.IDLE))throw new Error(`Cannot transition from ${this.transactionState} to ${e}`);this.transactionState=e,this.commit()}}setViews(e){this.views=e,this.togglePublishingFeatures(),this.commit()}setUnpublished(...e){for(const t of e)this.unpublished.add(t);this.hasUnpublishedChanges=this.unpublished.size>0,this.commit()}clearUnpublished(...e){if(e.length)for(const t of e)this.unpublished.delete(t);else this.unpublished.clear();this.unpublished.size||(this.hasUnpublishedChanges=!1),this.commit()}getUnpublished(){return[...this.unpublished]}getRevertable(){return[...this.revertable]}setRevertable(...e){for(const t of e)this.revertable.add(t);this.commit()}clearRevertable(...e){if(e.length)for(const t of e)this.revertable.delete(t);else this.revertable.clear();this.commit()}getView(e){return this.views.find((t=>t.id===e))}getViewCount(){return this.views.length}getViewByType(e){return this.views.find((t=>t.viewType===e))}togglePublishingFeatures(){const e=this.getCurrentView();e&&e.viewType===r.XZ.SESSION?(this.publishingEnabled=!0,this.revertEnabled=!0,this.saveEnabled=!0):(this.publishingEnabled=!1,this.revertEnabled=!1,this.saveEnabled=!0),this.commit()}}},26587:(e,t,i)=>{"use strict";i.d(t,{F:()=>StorageModule});var n=i(80121),s=i(47724),r=i(44283),o=i(92540),a=i(43973),l=i(88512),c=i(50988),h=i(48602),d=i(49398),u=i(96781),p=i(38420),m=i(94474),g=i(15585),f=i(83531),v=i(24930),y=i(61119),b=i(71918);const S=new l.Z("PrefetchedQueryCache");class PrefetchedQueryCache{constructor(e){this.config=e,e.initialData&&(this.data=e.initialData)}async read(e,t,i={}){const{prefetchKey:n,prefetchPolicy:s=this.config.prefetchPolicy}=i;if(!n||s===p.hV.NONE)return;s!==p.hV.PRELOAD||this.preloadPromise||(this.preloadPromise=this.preload()),void 0===this.data&&this.preloadPromise&&await this.preloadPromise;const r=this.has(n);return S.debug(`Cache ${r?"hit":"miss"} for ${n}`),r?this.data:void 0}clear(){this.data=void 0}async preload(){const{query:e,variables:t,client:i}=this.config;return i.query(e,t).then((e=>{this.data=e})).catch((e=>{S.info(e),this.data={}}))}has(e){return void 0!==(0,b.qw)(this.data,e)}}var E,w=i(80693),T=i(93863),_=i(53306),M=i(98828);!function(e){e.IMAGE="image",e.FLOORS="floors",e.MEASUREMENT_PATHS="measurementPaths",e.MATTERTAGS="mattertags",e.LABELS="labels",e.HIGHLIGHT_REEL="highlightReel",e.SWEEPS="sweeps",e.PLAYER_OPTIONS="playerOptions"}(E||(E={}));class ModelViewDiff{constructor(e={}){Object.assign(this,e)}}const x=new l.Z("mds-mergediff-deserializer"),A={[p.g.FLOORS]:E.FLOORS,[p.g.MEASUREMENTS]:E.MEASUREMENT_PATHS,[p.g.MATTERTAGS]:E.MATTERTAGS,[p.g.LABELS]:E.LABELS,[p.g.HIGHLIGHTS]:E.HIGHLIGHT_REEL,[p.g.SWEEPS]:E.SWEEPS,[p.g.SETTINGS]:E.PLAYER_OPTIONS,[p.g.START_LOCATION]:E.IMAGE,[p.g.BLURS]:void 0},O={[E.IMAGE]:p.g.START_LOCATION,[E.FLOORS]:p.g.FLOORS,[E.MEASUREMENT_PATHS]:p.g.MEASUREMENTS,[E.MATTERTAGS]:p.g.MATTERTAGS,[E.LABELS]:p.g.LABELS,[E.HIGHLIGHT_REEL]:p.g.HIGHLIGHTS,[E.SWEEPS]:p.g.SWEEPS,[E.PLAYER_OPTIONS]:p.g.SETTINGS};class MergeDiffDeserializer{deserialize(e){if(!(e&&e.src&&e.dest&&e.typesModified))return x.debug("Deserialized invalid merge diff from MDS",e),null;const t=[];for(const i of e.typesModified)i in O&&t.push(O[i]);return new ModelViewDiff({srcId:e.src,targetId:e.dest,dataTypes:t})}}class ModelView{constructor(e={}){this.viewType=null,Object.assign(this,e)}}const P=new l.Z("mds-modelview-deserializer");class ModelViewDeserializer{deserialize(e){return e&&e.id&&e.type?new ModelView({id:e.id,viewType:this.getModelViewType(e.type),rawViewType:e.type}):(P.debug("Deserialized invalid ModelView data from MDS",e),null)}getModelViewType(e){const t={"matterport.workshop.session":p.XZ.SESSION,"matterport.model.default":p.XZ.BASE,"trueplan.session":p.XZ.TRUEPLAN};return e in t?t[e]:null}}class ModelViewManager{constructor(e,t){this.modelId=e,this.client=t}async getViews(){const e=new ModelViewDeserializer,t=await this.client.query(_.GetViews,{modelId:this.modelId}),i=(0,b.qw)(t,"data.model.views"),n=[];if(i)for(const t of i){const i=e.deserialize(t);i&&n.push(i)}return n}async getMergeDiff(e){const t=new MergeDiffDeserializer,i=await this.client.query(_.GetMergeDiff,{viewId:e}),n=(0,b.qw)(i,"data.model.mergeDiff");return t.deserialize(n)}async getUnpublishedDeletions(){const e=await this.client.query(_.GetSessionDiff,{modelId:this.modelId}),t=(0,b.qw)(e,"data.model.base"),i=(0,b.qw)(e,"data.model.view"),n=(e,t,i)=>{const n=t.map((e=>e[i]));return e.filter((e=>!n.includes(e[i])))},s=n(t.model.mattertags,i.model.mattertags,"id"),r=n(t.model.labels,i.model.labels,"id"),o=n(t.model.measurementPaths,i.model.measurementPaths,"id");return{[p.g.LABELS]:r,[p.g.MATTERTAGS]:s,[p.g.MEASUREMENTS]:o}}async revertView(e,t=[]){const i=t.map((e=>A[e])).filter((e=>!!e));if(!i.length)return;const n=await this.client.query(_.RevertView,{viewId:e,mergeTypes:i}),s="53300"===(0,M.h)("error","");if(!o.w.isOk(n)||s){const e=new T.w0(o.w.getErrorMessage(n));throw s&&(e.isMock=!0),e}}async mergeView(e){const t=await this.client.query(_.PublishView,{viewId:e}),i="53200"===(0,M.h)("error","");if(!o.w.isOk(t)||i){const e=new T.w0(o.w.getErrorMessage(t));throw i&&(e.isMock=!0),e}}}const D=new l.Z("storage");class StorageModule extends s.Y{constructor(){super(...arguments),this.name="storage",this.saveHandlers=new Set,this.revertHandlers=new Set,this.publishHandlers=new Set,this.lock=new a.H}async init(e,t){const{baseUrl:i,modelId:s,prefetchPolicy:r}=e;if(this.config=e,this.engine=t,this.client=new o.w({baseUrl:i}),this.data=new h.Q(e.modelId),t.market.register(this,h.Q,this.data),!e.mdsEnabled){this.data.publishingEnabled=!0;const e=n.b3.globalSession;e&&e.lastPublished&&(this.data.lastPublished=e.lastPublished.getTime())}m.u.setBaseViewId(s),g.U.setBaseViewId(s),this.views=new ModelViewManager(s,this.client),this.prefetchCache=new PrefetchedQueryCache({client:this.client,prefetchPolicy:r,initialData:w.t.getQuery("GetModelPrefetch"),query:f.GetModelPrefetch,variables:{modelId:s}}),m.u.addSharedCache(this.prefetchCache),this.bindings.push(t.commandBinder.addBinding(c.R_,(()=>this.publish())),t.commandBinder.addBinding(c.qz,(e=>this.revert(e.dataTypes))),t.commandBinder.addBinding(c.VQ,(e=>this.save(e.dataTypes))),t.commandBinder.addBinding(c.dS,(e=>this.setDefaultViewType(e.viewType))),t.commandBinder.addBinding(c.ff,(()=>this.views.getUnpublishedDeletions()))),this.registerSettings()}dispose(e){super.dispose(e),m.u.removeSharedCache(this.prefetchCache)}onSave(e,t={}){const i={callback:e,dataType:t.dataType,phase:t.phase||p.Q.ON};return(0,r.k1)((()=>this.saveHandlers.add(i)),(()=>this.saveHandlers.delete(i)),!0)}onPublish(e,t={}){const i={callback:e,dataType:t.dataType,phase:t.phase||p.Q.ON};return(0,r.k1)((()=>this.publishHandlers.add(i)),(()=>this.publishHandlers.delete(i)),!0)}onRevert(e,t={}){const i={callback:e,dataType:t.dataType,phase:t.phase||p.Q.ON};return(0,r.k1)((()=>{this.revertHandlers.add(i),this.updateRevertableTypes()}),(()=>{this.revertHandlers.delete(i),this.updateRevertableTypes()}),!0)}async publish(){const{mdsEnabled:e}=this.config,t=await this.lock.lock(),i=e=>{D.error(e),t.unlock(),this.data.setTransactionState(p.g7.IDLE);const i=s[0]?`532${(0,d.DT)(s[0])}`:"53200",n=new d.gO(e,i);throw this.engine.broadcast(new u.aT(n,s)),n},s=this.data.getUnpublished(),{before:r,on:o,after:a}=this.getCallbacksByPhase(this.publishHandlers,s);if(o.push((()=>n.b3.publishAll())),e){const e=this.data.getViewByType(p.XZ.SESSION);e&&o.push((()=>this.views.mergeView(e.id)))}D.debug(`Publishing ${[...s].join(", ")}...`),this.data.setTransactionState(p.g7.PUBLISHING),await Promise.all(r.map((e=>e()))).catch(i),await Promise.all(o.map((e=>e()))).catch(i),this.data.lastPublished=Date.now(),this.data.commit(),this.data.clearUnpublished(),this.engine.broadcast(new u.zK),await Promise.all(a.map((e=>e()))).catch(i),t.unlock(),this.data.setTransactionState(p.g7.IDLE),D.debug("Publishing completed")}async revert(e=[]){const{mdsEnabled:t}=this.config,i=await this.lock.lock(),n=t=>{D.error(t),i.unlock(),this.data.setTransactionState(p.g7.IDLE);const n=e[0]?`531${(0,d.DT)(e[0])}`:"53100",s=new d.P8(t,n);throw this.engine.broadcast(new u.Kx(s,e)),s},{before:s,on:r,after:o}=this.getCallbacksByPhase(this.revertHandlers,e);if(t){const t=this.data.getViewByType(p.XZ.SESSION);if(!t)return void n(new d.SN("Workshop session view not found"));r.push((()=>this.views.revertView(t.id,e)))}D.debug(`Reverting ${[...e].join(", ")}...`),this.data.setTransactionState(p.g7.REVERTING),await Promise.all(s.map((e=>e()))).catch(n),await Promise.all(r.map((e=>e()))).catch(n),this.engine.broadcast(new u.F1(e)),await Promise.all(o.map((e=>e()))).catch(n),i.unlock(),this.data.setTransactionState(p.g7.IDLE),this.data.clearUnpublished(...e),D.debug(`Reverting ${[...e].join(", ")} completed`)}async save(e){const{before:t,on:i,after:n}=this.getCallbacksByPhase(this.saveHandlers,e),s=await this.lock.lock(),r=t=>{D.error(t),s.unlock(),this.data.setTransactionState(p.g7.IDLE);const i=e[0]?`531${(0,d.DT)(e[0])}`:"53100",n=new d.pd(t,i);throw this.engine.broadcast(new u.dz(n,e)),n};D.debug(`Saving ${[...e].join(", ")}...`),this.data.setTransactionState(p.g7.SAVING),await Promise.all(t.map((e=>e()))).catch(r),await Promise.all(i.map((e=>e()))).catch(r),this.engine.broadcast(new u.xj(e)),await Promise.all(n.map((e=>e()))).catch(r),this.data.publishingEnabled&&this.data.setUnpublished(...e),s.unlock(),this.data.setTransactionState(p.g7.IDLE),D.debug(`Saving ${[...e].join(", ")} completed`)}getCallbacksByPhase(e,t){const i=Array.isArray(t)?t:Object.values(p.g),n=[...e.values()].filter((e=>!e.dataType||i.includes(e.dataType))),s={[p.Q.BEFORE]:[],[p.Q.ON]:[],[p.Q.AFTER]:[]};return n.reduce(((e,t)=>(e[t.phase].push((()=>t.callback(i))),e)),s)}async setDefaultViewType(e){0===this.data.getViewCount()&&await this.loadViews();const t=this.data.getViewByType(e),i=this.data.getCurrentView();if(t&&i&&i.viewType===p.XZ.BASE)return D.debug(`Switching to default view type '${e}'`),this.switchToView(t.id)}async loadViews(){const e=await this.views.getViews();this.data.setViews(e)}async switchToView(e){const t=this.data.getView(e);if(!t||e===this.data.getCurrentViewId())return;this.data.setCurrentView(t.id);const i=await this.views.getMergeDiff(t.id);i&&i.dataTypes&&this.data.setUnpublished(...i.dataTypes)}updateRevertableTypes(){const e=new Set;for(const{dataType:t,phase:i}of this.revertHandlers)t&&i===p.Q.ON&&e.add(t);this.data.setRevertable(...e)}async registerSettings(){const{mdsEnabled:e}=this.config;(await this.engine.getModule(v.default)).registerSetting("Storage",y.$,e,!1)}}},50988:(e,t,i)=>{"use strict";i.d(t,{R_:()=>PublishCommand,qz:()=>RevertCommand,VQ:()=>SaveCommand,dS:()=>SetDefaultViewTypeCommand,ff:()=>GetUnpublishedDeletionsCommand});var n=i(17386);class PublishCommand extends n.m{constructor(){super(...arguments),this.id="PUBLISH_COMMAND"}}class RevertCommand extends n.m{constructor(e){super(),this.id="REVERT_COMMAND",this.payload=e}}class SaveCommand extends n.m{constructor(e){super(),this.id="SAVE_COMMAND",this.payload=e}}class SetDefaultViewTypeCommand extends n.m{constructor(e){super(),this.id="SET_DEFAULT_VIEW_TYPE_COMMAND",this.payload=e}}class GetUnpublishedDeletionsCommand extends n.m{constructor(){super(...arguments),this.id="GET_UNPUBLISHED_DELETIONS_COMMAND"}}},38420:(e,t,i)=>{"use strict";var n,s,r,o,a,l;i.d(t,{g7:()=>n,Q:()=>s,g:()=>r,XZ:()=>o,Xq:()=>a,hV:()=>l}),function(e){e.IDLE="idle",e.REVERTING="reverting",e.PUBLISHING="publishing",e.SAVING="saving"}(n||(n={})),function(e){e.ON="on",e.BEFORE="before",e.AFTER="after"}(s||(s={})),function(e){e.BLURS="blurs",e.FLOORS="floors",e.HIGHLIGHTS="highlights",e.LABELS="labels",e.MATTERTAGS="mattertags",e.MEASUREMENTS="measurements",e.NOTES="notes",e.PHOTOS="photos",e.SETTINGS="settings",e.START_LOCATION="startlocation",e.SWEEPS="sweeps"}(r||(r={})),function(e){e.BASE="base",e.TRUEPLAN="trueplan",e.SESSION="session"}(o||(o={})),function(e){e.MDS="mds",e.JSONSTORE="jsonstore"}(a||(a={})),function(e){e.CACHE="cache",e.PRELOAD="preload",e.NONE="none"}(l||(l={}))},49398:(e,t,i)=>{"use strict";i.d(t,{AE:()=>StorageError,pd:()=>SaveError,gO:()=>PublishError,P8:()=>RevertError,pp:()=>ReadOnlyError,SN:()=>InvalidViewError,DT:()=>r});var n=i(31102),s=i(38420);class StorageError extends n.y{constructor(e,t="50001"){super(e),this.name="StorageError",this.code=t}}class SaveError extends n.y{constructor(e,t="53100"){super(e),this.name="SaveError",this.code=t}}class PublishError extends n.y{constructor(e,t="53200"){super(e),this.name="PublishError",this.code=t}}class RevertError extends n.y{constructor(e,t="53300"){super(e),this.name="RevertError",this.code=t}}class ReadOnlyError extends n.y{constructor(e,t="53001"){super(e),this.name="ReadOnly",this.code=t}}class InvalidViewError extends n.y{constructor(e,t="52404"){super(e),this.name="InvalidView",this.code=t}}function r(e){return{[s.g.BLURS]:"01",[s.g.FLOORS]:"02",[s.g.HIGHLIGHTS]:"03",[s.g.LABELS]:"04",[s.g.MATTERTAGS]:"05",[s.g.MEASUREMENTS]:"06",[s.g.NOTES]:"07",[s.g.PHOTOS]:"08",[s.g.SETTINGS]:"09",[s.g.START_LOCATION]:"10",[s.g.SWEEPS]:"11"}[e]||"99"}},37339:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DataIntegrityMessage:()=>o.Qq,DataPublishedMessage:()=>o.zK,DataRevertedMessage:()=>o.F1,DataSavedMessage:()=>o.xj,DataType:()=>s.g,GetUnpublishedDeletionsCommand:()=>n.ff,InvalidViewError:()=>r.SN,MaasAttachmentsStore:()=>d.U,MdsStore:()=>h.u,ModelViewType:()=>s.XZ,PrefetchPolicy:()=>s.hV,PublishCommand:()=>n.R_,PublishError:()=>r.gO,PublishErrorMessage:()=>o.aT,ReadOnlyError:()=>r.pp,RevertCommand:()=>n.qz,RevertError:()=>r.P8,RevertErrorMessage:()=>o.Kx,SETTING_MDS_ENABLED:()=>l.$,SaveCommand:()=>n.VQ,SaveError:()=>r.pd,SaveErrorMessage:()=>o.dz,SetDefaultViewTypeCommand:()=>n.dS,StorageAnalytics:()=>StorageAnalytics,StorageData:()=>c.Q,StorageError:()=>r.AE,StorageProvider:()=>s.Xq,TransactionPhase:()=>s.Q,TransactionState:()=>s.g7,default:()=>u.F,getErrorCodeForDataType:()=>r.DT});var n=i(50988),s=i(38420),r=i(49398),o=i(96781),a=i(61645);class StorageAnalytics{constructor(){this.handlers=[{msgType:o.Qq,func:(e,t)=>{const{dataType:i,message:n,mockError:s}=t,r="DataIntegrityError",o={error_type:r,error_dialog:"none",data_type:i,exception:{message:`${r}: ${n}`},mock_error:s};e.track("error_displayed",o)}},{msgType:o.dz,func:(e,t)=>{const{dataTypes:i,error:n}=t,s=n.name||"SaveError",r={error_code:(0,a.UX)(n).join(", "),error_type:s,error_dialog:"banner",data_type:i?i.join(", "):"",exception:{message:`${s}: ${n.message}`,stack:n.stack},mock_error:(0,a.Ad)(n)};e.track("error_displayed",r)}},{msgType:o.Kx,func:(e,t)=>{const{dataTypes:i,error:n}=t,s=n.name||"RevertError",r={error_code:(0,a.UX)(n).join(", "),error_type:s,error_dialog:"banner",data_type:i?i.join(", "):"",exception:{message:`${n.name||s}: ${n.message}`,stack:n.stack},mock_error:(0,a.Ad)(n)};e.track("error_displayed",r)}},{msgType:o.aT,func:(e,t)=>{const{dataTypes:i,error:n}=t,s=n.name||"PublishError",r={error_code:(0,a.UX)(n).join(", "),error_type:s,error_dialog:"banner",data_type:i?i.join(", "):"",exception:{message:`${s}: ${n.message}`,stack:n.stack},mock_error:(0,a.Ad)(n)};e.track("error_displayed",r)}}]}}var l=i(61119),c=i(48602),h=i(94474),d=i(15585),u=i(26587)},96781:(e,t,i)=>{"use strict";i.d(t,{xj:()=>DataSavedMessage,zK:()=>DataPublishedMessage,F1:()=>DataRevertedMessage,Qq:()=>DataIntegrityMessage,dz:()=>SaveErrorMessage,Kx:()=>RevertErrorMessage,aT:()=>PublishErrorMessage});var n=i(91466);class DataSavedMessage extends n.v{constructor(e){super(),this.dataTypes=e}}class DataPublishedMessage extends n.v{}class DataRevertedMessage extends n.v{constructor(e){super(),this.dataTypes=e}}class DataIntegrityMessage extends n.v{constructor(e,t,i=!1){super(),this.message=e,this.dataType=t,this.mockError=i}}class SaveErrorMessage extends n.v{constructor(e,t=[]){super(),this.error=e,this.dataTypes=t}}class RevertErrorMessage extends n.v{constructor(e,t=[]){super(),this.error=e,this.dataTypes=t}}class PublishErrorMessage extends n.v{constructor(e,t=[]){super(),this.error=e,this.dataTypes=t}}},61119:(e,t,i)=>{"use strict";i.d(t,{$:()=>n});const n="storage/mds_enabled"},38330:(e,t,i)=>{"use strict";i.d(t,{w$:()=>n,gh:()=>ReadOnlyStore,yh:()=>Store,MU:()=>JsonStoreStore});var n,s=i(10757),r=i(32848);!function(e){e.GET="GET",e.POST="POST",e.PATCH="PATCH",e.PUT="PUT",e.DELETE="DELETE",e.OPTIONS="OPTIONS"}(n||(n={}));class ReadOnlyStore extends class Auth{constructor(){this._options={responseType:"json"}}get options(){const e=this._options;return e.headers=(0,r.m)(this.url,this._options.headers||{}),e}}{constructor(e){super(),this.config=e,this.url=e.path}async read(){const{deserialize:e}=this.config;let t=null;return this.config.cachedData&&this.config.cachedData.data?t=this.config.cachedData.data:(t=await this.config.queue.get(this.config.path,this.options),this.config.cachedData&&(this.config.cachedData.data=t)),e(t)}clearCache(){this.config.cachedData&&(this.config.cachedData.data=null)}}class Store extends ReadOnlyStore{constructor(e){super(e),this.config=e}async create(e){this.clearCache();const{serialize:t}=this.config,i=t(e),n=Object.assign(Object.assign({},this.options),{body:i});return this.config.queue.put(this.config.path,n)}async update(e,t){this.clearCache();const{serialize:i}=this.config,s=i(e,t),r=Object.assign(Object.assign({},this.options),{body:s});return this.config.queue.request(this.config.httpMethod||n.POST,this.config.path,r)}async delete(e){if(this.clearCache(),!(e instanceof Array))return this.config.queue.delete(this.config.path,this.options);for(const t of e)await this.config.queue.delete(`${this.config.path}/${t.sid}`,this.options)}get acceptsPartial(){return this.config.httpMethod===n.PATCH}}class JsonStoreStore extends ReadOnlyStore{constructor(e){super(e),this.config=e,this.acceptsPartial=!1,this.config.batchUpdate="batchUpdate"in this.config&&this.config.batchUpdate}async create(e){throw Error("Not implemented")}updateBatch(e,t){const{serialize:i}=this.config,s=[],r=[...new Set([...Object.keys(e),...Object.keys(t)])];for(const i of r){e[i]||t[i]||s.push(this.config.queue.delete(`${this.config.path}/${i}`,this.options))}const o=i(e,t),a=Object.assign(Object.assign({},this.options),{body:o});return s.push(this.config.queue.request(this.config.httpMethod||n.POST,this.config.path,a)),Promise.all(s)}updateInternal(e,t){const{serialize:i}=this.config,r=[],o=Object.assign({},this.options),a=Object.keys(e),l=Object.keys(t),c=(0,s.XN)(a.concat(l));for(const s in c){const a=c[s],l=e[a]||t[a];if(l){const e={};e[a]=l;const s={},c=t[a];c&&(s[a]=c);const h=i(e,s);o.body=h,r.push(this.config.queue.request(this.config.httpMethod||n.POST,this.config.path,o))}else r.push(this.config.queue.delete(`${this.config.path}/${a}`,this.options))}return Promise.all(r)}async update(e,t){this.clearCache(),await(this.config.batchUpdate?this.updateBatch(e,t||{}):this.updateInternal(e,t||{}))}async delete(e){throw Error("Not implemented")}}},29397:(e,t,i)=>{"use strict";i.d(t,{Z:()=>BeginMoveToSweepMessage});var n=i(51764);class BeginMoveToSweepMessage extends n.Z{}},85895:(e,t,i)=>{"use strict";i.d(t,{Z:()=>EndMoveToSweepMessage});var n=i(51764);class EndMoveToSweepMessage extends n.Z{constructor(e,t,i,n){super(e,n),this.alignmentType=t,this.placementType=i}}},51764:(e,t,i)=>{"use strict";i.d(t,{Z:()=>MoveToSweepMessage});var n=i(91466);class MoveToSweepMessage extends n.v{constructor(e,t){super(),this.fromSweep=t,this.toSweep=e,this.timestamp=Date.now()}}},35026:(e,t,i)=>{"use strict";i.d(t,{z9:()=>n,hU:()=>s,ZP:()=>Sweep});var n,s,r=i(2212),o=i(23573),a=i(34369);!function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(n||(n={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(s||(s={}));const l={[a.SL.BASE]:"512",[a.SL.STANDARD]:"1k",[a.SL.HIGH]:"2k",[a.SL.ULTRAHIGH]:"4k"},c={[a.SL.BASE]:"low",[a.SL.STANDARD]:"high",[a.SL.HIGH]:"2k",[a.SL.ULTRAHIGH]:"4k"};class Sweep extends o.T{constructor(e){super(),this.skyboxes={},e&&(e.id&&(this.id=e.id),void 0!==e.index&&(this.index=e.index),this.name=e.name||"",this.position=e.position||new r.Vector3,this.floorPosition=e.floorPosition||new r.Vector3,void 0!==e.floorId&&(this.floorId=e.floorId),this.roomId=e.roomId||null,this.rotation=e.rotation||new r.Quaternion,this.enabled=e.enabled||!1,this.vrenabled=e.vrenabled||!1,this.neighbours=e.neighbours||[],this.alignmentType=e.alignmentType||n.ALIGNED,this.placementType=e.placementType||s.UNPLACED,void 0!==e.uuid&&(this.uuid=e.uuid))}isAligned(){return this.alignmentType===n.ALIGNED}isUnplaced(){return this.placementType===s.UNPLACED}get sid(){return this.id}equals(e){return this.id===e.id&&this.index===e.index&&this.name===e.name&&this.position.equals(e.position)&&this.floorId===e.floorId&&this.roomId===e.roomId&&this.rotation.equals(e.rotation)&&this.enabled===e.enabled&&this.vrenabled===e.vrenabled&&this.alignmentType===e.alignmentType&&this.placementType===e.placementType}copy(e){return this.id=e.id,this.index=e.index,this.name=e.name,this.position=(new r.Vector3).copy(e.position),this.floorPosition=(new r.Vector3).copy(e.floorPosition),this.floorId=e.floorId,this.roomId=e.roomId,this.rotation=(new r.Quaternion).copy(e.rotation),this.enabled=e.enabled,this.vrenabled=e.vrenabled,this.neighbours=e.neighbours.slice(),this.alignmentType=e.alignmentType,this.placementType=e.placementType,this.resolutions=e.resolutions,this.skyboxes=Object.assign({},e.skyboxes),this}refresh(e){this.resolutions=e.resolutions;for(const t in this.skyboxes){const i=t;this.skyboxes[i].refreshFrom(e.skyboxes[i])}}async getTileUrl(e,t,i,n){const s=await this.getSkybox(e);let r;return r=s?s.tileUrlTemplate:`tiles/${this.id}/${l[e]}_face<face>_<x>_<y>.jpg`,r.replace("<face>",`${t}`).replace("<x>",`${i}`).replace("<y>",`${n}`)}async getFaceUrl(e,t){const i=await this.getSkybox(e);let n;return n=i?i.urlTemplate:`pan/${c[e]}/${this.id}_skybox${t}.jpg`,n.replace("<face>",`${t}`)}async getSkybox(e){const t=this.skyboxes[e];return t?t.get():t}}},95586:(e,t,i)=>{"use strict";i.d(t,{NO:()=>ClearCurrentSweepCommand,aK:()=>SetCurrentSweepCommand,iF:()=>SweepSelectCommand,kR:()=>SweepHoverCommand,e9:()=>ToggleNonPanoCurrentPuckCommand,zd:()=>EnableSweepSelectionCommand,ZD:()=>DisableSweepSelectionCommand});var n=i(17386);class ClearCurrentSweepCommand extends n.m{}class SetCurrentSweepCommand extends n.m{constructor(e){super(),this.sweepId=e,this.payload={sweepId:e}}}class SweepSelectCommand extends n.m{constructor(e,t,i=500){super(),this.id="SELECT_SWEEP",this.payload={id:e,selected:t,duration:i}}}class SweepHoverCommand extends n.m{constructor(e,t,i=500){super(),this.id="HOVER_SWEEP",this.payload={id:e,hovered:t,duration:i}}}class ToggleNonPanoCurrentPuckCommand extends n.m{constructor(e){super(),this.id="TOGGLE_NON_PANO_CURRENT_PUCK",this.payload={visible:e}}}class EnableSweepSelectionCommand extends n.m{constructor(){super(...arguments),this.id="ENABLE_SWEEP_SELECTION"}}class DisableSweepSelectionCommand extends n.m{constructor(){super(...arguments),this.id="DISABLE_SWEEP_SELECTION"}}},75892:(e,t,i)=>{"use strict";i.d(t,{Z:()=>SweepData});var n=i(35026),s=i(32770),r=i(75256),o=i(64781),a=i(17131);class SweepData extends s.V{constructor(e){if(super(),this.name="sweeps",this.transitionActive=!1,this.sweepList=new r.d,this.sweepMap={},e){const t=Object.values(e).sort(((e,t)=>e.index-t.index));for(const e of t)this.sweepMap[e.id]=e,this.sweepList.push(e)}this.transition={progress:new a.z(0),active:!1,from:void 0,to:void 0}}refresh(e){for(const t in this.sweepMap)e[t]&&this.sweepMap[t].refresh(e[t])}canTransition(){return!this.transition.active}get currentSweepIndex(){if(this.currentSweep)return this.sweepMap[this.currentSweep].index}get currentSweepObject(){if(this.currentSweep)return this.getSweep(this.currentSweep)}get currentAlignedSweepObject(){if(this.currentSweep&&!this.isSweepUnaligned(this.currentSweep))return this.getSweep(this.currentSweep)}makeSweepChangeSubscription(e){return this.onPropertyChanged("currentSweep",e)}getSweep(e){return this.sweepMap[e]}getSweepByIndex(e){return this.sweepList.find((t=>t.index===e))}getSweepByUuid(e){return this.sweepList.find((t=>t.uuid===e))}containsSweep(e){return e in this.sweepMap}getFirstSweep(){let e=-1;for(;++e<this.sweepList.length;){const t=this.sweepList.get(e);if(t.enabled)return t}}getStartSweep(e){const t=e&&e.pano&&e.pano.uuid?this.getSweep(e.pano.uuid):null;return t&&t.enabled?t:this.getFirstSweep()}getClosestSweep(e,t){let i=Number.MAX_VALUE,s=null;return this.iterate((r=>{if(r.enabled&&(!t||r.alignmentType===n.z9.ALIGNED)){const t=e.distanceTo(r.position);t<i&&(i=t,s=r)}})),s}getFirstAlignedSweep(){let e=-1;for(;++e<this.sweepList.length;){const t=this.sweepList.get(e);if(t.enabled&&t.alignmentType===n.z9.ALIGNED)return t}return null}activateTransition(e,t){this.transition.active=!0,this.transition.from=t,this.transition.to=e,this.transitionActive=!0}deactivateTransition(){this.transition.active=!1,this.transition.from=void 0,this.transition.to=void 0,this.transitionActive=!1}isSweepUnaligned(e){if(!e)return!1;const t=this.getSweep(e);return t&&!t.isAligned()}isSweepAligned(e){const t=this.getSweep(e);return t&&t.isAligned()}isSweepDisabled(e=this.currentSweep){if(!e)return!1;const t=this.getSweep(e);return t&&!t.enabled}*sweeps(){for(const e of this.sweepList)yield e}iterate(e){this.sweepList.forEach(((t,i)=>{e(t,i)}))}filter(e){return this.sweepList.filter(e)}sortByScore(e,t,i){return(i||this.sweepList).filter((t=>e.every((e=>e(t))))).map((e=>({sweep:e,score:t.reduce(((t,i)=>t+i(e)),0)}))).sort(((e,t)=>t.score-e.score))}getSweepList(){return this.sweepList.values()}getSweepNeighbours(e){const t=[];for(const i of e.neighbours)t.push(this.getSweep(i));return t}getCollection(){return(0,o.q)(this.sweepMap)}getConnectedSweeps(e,t){const i=[e],n=new Set;for(t=t||(e=>!0);i.length;){const e=i.pop(),s=this.getSweep(e);n.add(e);for(const e of s.neighbours){t(this.getSweep(e))&&!n.has(e)&&i.push(e)}}return n}equals(e){if(this.sweepMap.length!==e.sweepMap.length||this.currentSweep!==e.currentSweep||this.transition.active!==e.transition.active||this.transition.from!==e.transition.from||this.transition.to!==e.transition.to)return!1;for(const t in this.sweepMap){if(!e.containsSweep(t))return!1;if(!this.sweepMap[t].equals(e.getSweep(t)))return!1}return!0}}},51263:(e,t,i)=>{"use strict";i.d(t,{ff:()=>o,vO:()=>a,T3:()=>l,H7:()=>c,_T:()=>h,WO:()=>d,b1:()=>u,nK:()=>p,pI:()=>m,_k:()=>g,D5:()=>f,SF:()=>v,jN:()=>y});var n=i(35026),s=i(2212);const r=.25,o=e=>t=>t!==e,a=e=>t=>!!e.neighbours&&-1!==e.neighbours.indexOf(t.id),l=e=>t=>e===t||a(e)(t),c=e=>e.placementType===n.hU.MANUAL,h=()=>e=>e.alignmentType===n.z9.ALIGNED,d=()=>e=>e.alignmentType!==n.z9.ALIGNED,u=e=>t=>e.floorId===t.floorId,p=e=>t=>e===t.floorId,m=(()=>{const e=new s.Vector3,t=new s.Vector3;return(i,n,s=r)=>r=>e.copy(r.position).sub(i).normalize().dot(t.copy(n).normalize())>s})(),g=()=>e=>e.enabled,f=(e,t)=>{const i=new s.Vector3;return t=t.clone(),n=>i.copy(n.position).sub(e).normalize().dot(t)>0},v=(e,t)=>i=>e.distanceTo(i.position)<t,y=(e,t)=>i=>e.distanceToSquared(i.position)<t},56656:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepDataModule});var n=i(47724),s=i(736),r=i(75892),o=i(31278),a=i(77719),l=i(63560),c=i(85895),h=i(29397),d=i(64185),u=i(79437),p=i(59088),m=i(88512),g=i(66097),f=i(51764),v=i(95586),y=i(38330),b=i(80121),S=i(99398),E=i(18630),w=i(19674),T=i(35026),_=i(85861),M=i(10757),x=i(87324);const A=new m.Z("sweeps");function O(e=!0){function t(t,i,n,s,r){const o=t[i];if(void 0!==o)n[s]=r?r(o):o;else if(e)throw Error(`Required property missing in data: ${i}`)}return function(e){if(!e||Object.keys(e).length<1)return null;const i={};try{const n=[];for(const i of e){const e=new T.ZP;if(t(i,"index",e,"index"),n[e.index])throw Error("Duplicate sweep index found");n[e.index]=e,t(i,"sweep_uuid",n[e.index],"id",(e=>e.replace(/-/g,"")))}for(const s of e){const e=n[s.index];t(s,"neighbors",e,"neighbours",(e=>e.map((e=>n[e]?n[e].id:void 0)).filter((e=>void 0!==e)))),t(s,"alignment_type",e,"alignmentType",(e=>"string"==typeof e&&T.z9.hasOwnProperty(e.toUpperCase())?e:T.z9.UNALIGNED)),t(s,"placement",e,"placementType",(t=>{if(e.alignmentType===T.z9.ALIGNED)return T.hU.AUTO;return"string"==typeof s.placement&&T.hU.hasOwnProperty(s.placement.toUpperCase())?s.placement:T.hU.UNPLACED})),t(s,"rotation",e,"rotation",(e=>w.ep.fromVisionQuaternion(e))),t(s,"position",e,"position",(e=>w.ep.fromVisionVector(e))),t(s,"floor_position",e,"floorPosition",(e=>w.ep.fromVisionVector(e))),t(s,"sweep_name",e,"name"),t(s,"floor_index",e,"floorId",(e=>"number"==typeof e&&e>-1?String(e):null)),t(s,"room_index",e,"roomId",(e=>"number"==typeof e&&e>-1?String(e):null)),t(s,"tags",e,"enabled",(e=>-1!==e.indexOf("showcase"))),t(s,"tags",e,"vrenabled",(e=>-1!==e.indexOf("vr"))),e.uuid=e.id,i[e.id]=e}}catch(e){A.error("Error reading sweeps list",e)}return 0===Object.keys(i).length?null:i}}const P=(e,t)=>{const i=[];if(!t)throw Error("SweepsV2 must serialize via diffs");function n(e,t,i){return function(n,s,r){if((0,M.nr)(t,n)){let o;null!==t[n]&&"object"==typeof t[n]?(o={},(0,_.TS)(o,e[n]),"rotation"===n&&(o=(0,x.J5)(o))):o=e[n],i[s]=r?r(o):o}}}for(const s in t){const r=e[s],o=t[s],a={},l=n(r,o,a);l("placementType","placement"),o.placementType!==T.hU.UNPLACED&&(l("position","position",(e=>w.ep.toVisionVector(e))),l("rotation","rotation",(e=>(0,x.J5)(w.ep.toVisionQuaternion(e))))),((0,M.nr)(o,"enabled")||(0,M.nr)(o,"vrenabled"))&&(a.tags=[],(void 0!==o.enabled?o.enabled:r.enabled)&&(a.tags.push("showcase"),(void 0!==o.vrenabled?o.vrenabled:r.vrenabled)&&a.tags.push("vr"))),l("name","sweep_name"),l("floorId","floor_index",(e=>{if(!e)return-1;const t=parseInt(e||"",10);if(isNaN(t))throw new Error(`Failed to serialize unsupported floor ID '${e}'`);return t})),Object.keys(a).length>0&&(a.index=r.index,a.sweep_uuid=r.id,i.push(a))}return 0===i.length?null:i};var D=i(53204),C=i(15100),I=i(94474);const L=new m.Z("mds-sweep-serializer");class MdsAnchorLocationUpdateSerializer{serialize(e){const t={};return void 0===e.enabled&&void 0===e.vrenabled||(t.tags=[],e.enabled&&t.tags.push("showcase"),e.vrenabled&&t.tags.push("vr")),this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["tags"],i=t.some((t=>t in e)),n=0===Object.keys(e).filter((e=>!t.includes(e))).length,s=void 0===e.tags||Array.isArray(e.tags),r=s&&i&&n;return r||L.debug("Invalid AnchorPatch:",{tagsIsArrayIfPresent:s,hasSomeChanges:i,hasNoExtraChanges:n,mutableFields:t,data:e}),r}}var R,N=i(936);!function(e){e.VISION="vision",e.UPLOAD="upload"}(R||(R={}));var k=i(34369),B=i(31879),F=i(77680),U=i(44382);const V=new m.Z("mds-sweep-serializer"),H={[N.b.AUTO]:T.hU.AUTO,[N.b.MANUAL]:T.hU.MANUAL,[N.b.UNPLACED]:T.hU.UNPLACED},G={[R.VISION]:T.z9.ALIGNED,[R.UPLOAD]:T.z9.UNALIGNED};class MdsSweepDeserializer{deserialize(e){var t,i;if(!e||!this.validate(e))return V.debug("Deserialized invalid Sweep data from MDS",e),null;const n=e,s=new T.ZP;s.id=n.id,s.index=n.index,s.enabled=n.tags.includes("showcase"),s.vrenabled=n.tags.includes("vr"),s.neighbours=n.neighbors||[],n.position&&(s.floorPosition=w.ep.fromVisionVector(n.position)),s.floorId=(null===(t=n.floor)||void 0===t?void 0:t.id)||null,s.roomId=(null===(i=n.room)||void 0===i?void 0:i.id)||null;const r=n.pano;s.name=r.label||"",s.alignmentType=G[r.source],s.uuid=r.sweepUuid||"",s.alignmentType===T.z9.ALIGNED?s.placementType=T.hU.AUTO:s.placementType=H[r.placement],r.position&&(s.position=w.ep.fromVisionVector(r.position)),s.resolutions=[];const o=r.skyboxes||[];if(r.resolutions)for(const e of r.resolutions){const t=this.getPanoSizeClass(e),i=o.find((t=>t.resolution===e));t&&i?(s.resolutions.push(t),s.skyboxes[t]=this.makeSkybox(i)):V.debug(`Invalid pano size class ${e}`)}return r.rotation&&(s.rotation=w.ep.fromVisionQuaternion(r.rotation)),s.floorId||(s.alignmentType===T.z9.ALIGNED?V.warn(`Aligned sweep ${s.index} has no floor association`):s.placementType===T.hU.MANUAL&&V.debug(`Manually placed sweep ${s.index} has no floor association`)),s.roomId||s.alignmentType===T.z9.ALIGNED&&V.warn(`Aligned sweep ${s.index} has no room association`),s}validate(e){if(!e)return!1;const t=[],i=["id","index","tags"];if(t.push((()=>i.every((t=>t in e)))),t.push((()=>"number"==typeof e.index)),t.push((()=>!!e.position&&(0,U.uU)(e.position))),t.push((()=>"pano"in e&&!!e.pano)),e.pano){const{placement:i,source:n,position:s}=e.pano;t.push((()=>!!i&&i in H)),t.push((()=>!!n&&n in G)),t.push((()=>!!s&&(0,U.uU)(s)))}return t.every((e=>e()))}getPanoSizeClass(e){const t={low:k.SL.BASE,high:k.SL.STANDARD,"2k":k.SL.HIGH,"4k":k.SL.ULTRAHIGH};return e in t?t[e]:void 0}makeSkybox(e){return new F.n({tileUrlTemplate:e.tileUrlTemplate,tileResolution:parseInt(e.tileResolution,10),tileCount:e.tileCount,urlTemplate:e.urlTemplate},(0,B.p)(e.validUntil,null))}}const z=new m.Z("mds-sweep-serializer");class MdsSweepPanoUpdateSerializer{serialize(e){const t={};return e.rotation&&(t.rotation=(0,x.J5)(w.ep.toVisionQuaternion(e.rotation))),e.position&&(t.position=(0,x.m)(w.ep.toVisionVector(e.position))),e.placementType&&e.placementType===T.hU.UNPLACED&&(t.resetPlacement=!0),"roomId"in e&&(e.roomId?t.roomId=e.roomId:t.resetRoom=!0),"floorId"in e&&(e.floorId?t.floorId=e.floorId:t.resetFloor=!0),"name"in e&&(t.label=e.name||""),this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["resetPlacement","resetFloor","resetRoom","rotation","position","floorId","roomId","label"],i=t.some((t=>t in e)),n=0===Object.keys(e).filter((e=>!t.includes(e))).length,s=i&&n;return s||z.debug("Invalid PanoramaLocation:",{hasSomeChanges:i,hasNoExtraChanges:n,mutableFields:t,data:e}),s}}const W=new m.Z("mds-sweep-store");class MdsSweepStore extends I.u{constructor(){super(...arguments),this.deserializer=new MdsSweepDeserializer,this.panoSerializer=new MdsSweepPanoUpdateSerializer,this.anchorSerializer=new MdsAnchorLocationUpdateSerializer,this.prefetchKey="data.model.locations"}async read(e={}){const{readonly:t}=this.config,i={modelId:this.getViewId()},n=t?C.GetShowcaseSweeps:C.GetSweeps;return this.query(n,i,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.locations;if(!n||!Array.isArray(n))return null;const s={};for(const e of n){const t=this.deserializer.deserialize(e);t&&(s[t.id]=t)}return s}))}async refresh(){return this.refreshPromise||(this.refreshPromise=this.read({fetchPolicy:"no-cache"}).finally((()=>{this.refreshPromise=void 0}))),this.refreshPromise}async update(e){if(!e||0===e.length)return;const t=this.getViewId();let i="";const n={};n.modelId=t;let s="";for(const t of e){const r=this.panoSerializer.serialize(t),o=this.anchorSerializer.serialize(t);if(!r&&!o)throw W.error("No changes to update:",t,e),new Error("MdsSweepStore.update failed");i+=""+(r?`, $pano${t.id}: PanoramicImageLocationPatch!`:"")+` ${o?`, $anchor${t.id}: AnchorPatch!`:""} `,n[`pano${t.id}`]=r,n[`anchor${t.id}`]=o,s+=`\n        ${r?`\n          panoLocation${t.id}: patchPanoLocation(modelId: $modelId, , locationId: "${t.id}", patch: $pano${t.id}) {\n            id\n            placement\n          }`:""}\n        ${o?`\n          panoAnchor${t.id}: patchAnchor(modelId: $modelId, , anchorId: "${t.id}", patch: $anchor${t.id}) {\n            id\n            tags\n          }`:""}\n      `}const r=D.Ps`
      mutation sweepUpdate($modelId: ID! ${i}) {
        ${s}
      }
    `;return this.mutate(r,n).then((()=>{}))}}var j=i(57361),K=i(39729),q=i(71194),Z=i(26587),Y=i(50988),$=i(38420),Q=i(31102);class SweepTransitionError extends Q.y{constructor(e="Failed to transition to sweep"){super(e),this.name="SweepTransition"}}class InvalidSweepError extends Q.y{constructor(e="Invalid Sweep"){super(e),this.name="InvalidSweep"}}const X=new m.Z("sweep-module");class SweepDataModule extends n.Y{constructor(){super(...arguments),this.name="sweep-data",this.internalProgress=!1,this.defaultEasing=u.qb,this.moveToSweep=e=>{const t=new d.Q;return e.prevSweepId=e.prevSweepId||this.sweepData.currentSweep,this.activateSweep(e).then((()=>(this.beginSweepTransition(e),this.defaultSweepCameraMove(t,e)))).then((()=>{this.endSweepTransition(e),t.resolve()})).catch((i=>{X.debug(`Failure moving to sweep ${e.sweepId}`,i),t.reject(i)})),t.promise()},this.activateSweep=async e=>{if(!this.sweepData.canTransition()||!this.cameraData.canTransition())throw new SweepTransitionError("Tried to start transition while another transition was active");if(!this.sweepData.containsSweep(e.sweepId))throw new InvalidSweepError(`Invalid sweep ${e.sweepId}`);return this.activateSweepUnsafe(e)},this.activateSweepUnsafe=async e=>{this.sweepPanoModule||(this.sweepPanoModule=await this.engine.getModuleBySymbol(s.y.SWEEP_PANO));return this.sweepPanoModule.getRenderer().activateSweep(e.sweepId)},this.instantSweepTransition=e=>{const t=this.sweepData.currentSweep;this.beginSweepTransition({sweepId:e,transitionTime:0,internalProgress:!0,prevSweepId:t}),this.sweepData.currentSweep=e,this.sweepData.commit(),this.engine.broadcast(new f.Z(e,t)),this.endSweepTransition({sweepId:e,prevSweepId:t})},this.beginSweepTransition=e=>{this.sweepData.activateTransition(e.sweepId,e.prevSweepId||this.sweepData.currentSweep),this.internalProgress=e.internalProgress||!1,this.sweepData.transition.progress.modifyAnimation(0,1,e.transitionTime||0,e.easing||this.defaultEasing),this.sweepData.commit(),this.engine.broadcast(new h.Z(e.sweepId,e.prevSweepId))},this.endSweepTransition=e=>{const t=this.sweepData.getSweep(e.sweepId);this.sweepData.deactivateTransition(),this.sweepData.currentSweep=e.sweepId,this.sweepData.transition.progress.stop(1),this.internalProgress=!1,this.sweepData.commit(),this.engine.broadcast(new c.Z(e.sweepId,t.alignmentType,t.placementType,e.prevSweepId))},this.defaultSweepCameraMove=async(e,t)=>{const i={position:this.sweepData.getSweep(t.sweepId).position,rotation:t.rotation},n=(0,l.AN)(this.cameraData.aspect());let s=o.n.Interpolate;void 0!==t.transitionType&&o.n[t.transitionType]&&(s=t.transitionType);const r=this.cameraModule.moveTo({transitionType:s,pose:i,transitionTime:t.transitionTime,transitionSpeedMultiplier:t.transitionSpeedMultiplier,projection:n,easing:t.easing,rotationDelay:t.rotationDelay});let a=!1;return r.progress((i=>{this.sweepData.transition.progress.updateProgress(i),e.notify(i),i>=.5&&!a&&(a=!0,this.sweepData.currentSweep=t.sweepId,this.sweepData.commit(),this.engine.broadcast(new f.Z(t.sweepId,t.prevSweepId)))})),r.nativePromise()},this.tryInferFloorIds=e=>{for(const t of Object.values(e))if(t.isAligned()&&null===t.floorId){X.warn(`Aligned sweep ${t.index} has no floor association`);const i=t.neighbours.map((i=>({id:i,floorId:e[i].floorId,distance:e[i].floorPosition.distanceToSquared(t.floorPosition)})));i.sort(((e,t)=>e.distance-t.distance));const n=i.find((e=>e.floorId));n&&(X.debug(`Inferred Sweep ${t.index} floor as ${n.floorId} from neighbors`),t.floorId=n.floorId)}}}async init(e,t){const{readonly:i}=e;this.engine=t,this.market=this.engine.market,this.store=this.getStore(e);const n=await this.store.read()||{};[this.filterSweepData,this.tryInferFloorIds].forEach((e=>e(n))),(0,F.s)(n,(async()=>{if(this.store.refresh){const e=await this.store.refresh();this.sweepData.refresh(e||{})}else X.debug("Can't refresh sweep URLs - operation not supported")})),this.sweepData=new r.Z(n),this.market.register(this,r.Z,this.sweepData);const s=await t.getModule(Z.F);!1===i&&(this.monitor=new j.c(this.sweepData.getCollection(),{aggregationType:K.E.NextFrame,shallow:!0},t),this.monitor.onChanged((()=>this.engine.commandBinder.issueCommand(new Y.VQ({dataTypes:[$.g.SWEEPS]})))),this.store instanceof g.N&&this.store.addMonitor(this.monitor)),this.cameraModule=await this.engine.getModule(a.default),this.cameraData=await t.market.waitForData(p.M_),this.bindings.push(t.commandBinder.addBinding(v.NO,(async()=>{this.sweepData.currentSweep=void 0,this.sweepData.commit()})),t.commandBinder.addBinding(v.aK,(async e=>{if(e.sweepId)try{const t=e.sweepId;await this.activateSweepUnsafe({sweepId:t});const i=this.sweepData.currentSweep;this.beginSweepTransition({sweepId:t,transitionTime:0,internalProgress:!0,prevSweepId:i}),this.sweepData.currentSweep=t,this.endSweepTransition({sweepId:t,prevSweepId:i}),this.sweepData.commit()}catch(e){X.error(e)}else this.sweepData.currentSweep=void 0,this.sweepData.commit()})),s.onSave((()=>this.save()),{dataType:$.g.SWEEPS}),s.onRevert((()=>this.revert()),{dataType:$.g.SWEEPS}))}getStore(e){const{modelId:t,baseUrl:i,queue:n}=e,s=e.storageProvider||$.Xq.JSONSTORE,r=!("readonly"in e)||!!e.readonly;if(X.info(`Loading Sweeps from ${s}`),s===$.Xq.MDS)return new MdsSweepStore({readonly:r,baseUrl:i});const o=function(e){const{modelId:t,readonly:i}=e,n=e.baseUrl||"",s=e.queue,r={data:null};let o=`${n}/api/v2/models/${t}/sweeps`;if(i){o=`${o}?tag=showcase`;const e=new y.gh({queue:s,path:o,deserialize:O(!0),cachedData:r});return new b.iY({publishStores:[e]})}const a=new y.yh({queue:s,path:o,cachedData:r,httpMethod:y.w$.PATCH,deserialize:O(!0),serialize:P}),l=`${n}/api/v1/jsonstore/model/workshopSession/${t}`,c=new E.Z({queue:s,path:l,cachedData:{data:null},deserialize:S.S.sessionObjectExtract(E.j.WS3_Sweeps,O(!1)),serialize:P},E.j.WS3_Sweeps);return new b.iY({publishStores:[a],editStore:c,partialData:!0,safeKeys:["name","position","rotation","enabled","vrenabled","placementType"],editStoreKey:b.aw.SWEEPS})}({modelId:t,baseUrl:i,readonly:r,queue:n});return new g.N(o,{readonly:r,dataType:$.g.SWEEPS,engine:this.engine})}filterSweepData(e){for(const t in e){const i=e[t];i.neighbours=i.neighbours.filter((t=>t in e))}}onUpdate(e){this.internalProgress&&this.sweepData.transition.active&&this.sweepData.transition.progress.tick(e)}async save(){if(!this.store)throw Error("No store configured for saving sweep edits!");if(this.store instanceof g.N)return;const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=e.filter((e=>e.action===q.KI.updated)).map((e=>{const t=this.sweepData.getSweep(e.index),i=Object.assign({id:e.index},e.diff);return"position"in i&&(i.position=t.position),"rotation"in i&&(i.rotation=t.rotation),("enabled"in i||"vrenabled"in i)&&(i.enabled=t.enabled,i.vrenabled=t.vrenabled),i}));return this.store.update(t)}async revert(){if(this.store instanceof g.N)return this.store.revert()}}},57051:(e,t,i)=>{"use strict";i.d(t,{Dv:()=>l,TE:()=>c,o7:()=>h,l0:()=>d,Bv:()=>u});var n=i(2212);const s=-1,r=10,o=5,a=-5,l=(e,t=s)=>i=>e.distanceToSquared(i.position)*t,c=(e,t=s)=>i=>e.distanceTo(i.position)*t,h=(e,t,i=r)=>{const s=new n.Vector3;return n=>s.copy(n.position).sub(e).normalize().dot(t)*i},d=(e,t=s)=>i=>e.distanceToSquared(i.floorPosition)*t,u=(e,t=o,i=a)=>n=>e===n.floorId?t:i},91715:(e,t,i)=>{"use strict";var n;i.d(t,{Z:()=>s}),function(e){e[e.Center=0]="Center",e[e.UpperLeft=1]="UpperLeft",e[e.UpperRight=2]="UpperRight",e[e.LowerRight=3]="LowerRight",e[e.LowerLeft=4]="LowerLeft"}(n||(n={}));const s=n},52586:(e,t,i)=>{"use strict";i.d(t,{S:()=>c,Z:()=>PanoQualityManager});var n=i(34369),s=i(37381),r=i(17486),o=i(14844),a=i(64185);const l=new(i(88512).Z)("panoqualitymanager");var c;!function(e){e[e.Untested=0]="Untested",e[e.Testing=1]="Testing",e[e.Success=2]="Success",e[e.Fail=3]="Fail"}(c||(c={}));class PanoQualityManager{constructor(e,t,i,n){this.urls=e,this.maxCubemapSize=t,this.maxNavPanoSize=i,this.maxZoomPanoSize=n,this.overrideWindow=!1,this.devicePixelRatio=window.devicePixelRatio||1,this.navPanoSize=-1,this.zoomPanoSize=-1,this.windowHeight=window.innerHeight*this.devicePixelRatio,this.highQualityThreshold=s.Xd.windowHeightHighQualityThresholdOverride||s.Xd.windowHeightHighQualityThreshold,this.persistentStorage=new r.a,this.downloadTestResults={},this.updateMaximums()}setWindowSize(e,t){this.windowHeight=t*this.devicePixelRatio,this.updateMaximums()}overrideWindowMaximums(e){this.overrideWindow=e,this.updateMaximums()}updateNavPanoSize(e){this.maxNavPanoSize=e,this.updateMaximums()}getTestResults(e,t){const i=this.downloadTestResults[e];if(i){const e=i[t];if(e)return e}return c.Untested}ultraHighQualityModeEnabled(e){const t=n.Qf[this.getZoomPanoSize()],i=this.downloadTestResults[e];return!(!i||!i[t])&&i[t]===c.Success}updateMaximums(){this.windowHeight<this.highQualityThreshold&&!this.overrideWindow?(this.navPanoSize=Math.min(PanoQualityManager.getPanoSize(n.SL.STANDARD),this.maxNavPanoSize),this.zoomPanoSize=Math.min(PanoQualityManager.getPanoSize(n.SL.HIGH),this.maxZoomPanoSize)):(this.navPanoSize=this.maxNavPanoSize,this.zoomPanoSize=this.maxZoomPanoSize),this.zoomPanoSize<this.navPanoSize&&(this.navPanoSize=this.zoomPanoSize),this.zoomPanoSize=Math.min(this.maxCubemapSize,this.zoomPanoSize),this.navPanoSize=Math.min(this.maxCubemapSize,this.navPanoSize)}static getPanoSize(e){if(e in n.eE)return n.eE[e];throw new Error(`Not a panoSizeClass: ${e}`)}static getPanoSizeClass(e){if(e in n.Qf)return n.Qf[e];throw new Error(`Not a valid pano resolution: ${e}`)}getMaxPossiblePanoSize(){return PanoQualityManager.getPanoSize(n.SL.ULTRAHIGH)}getNavPanoSize(){return this.navPanoSize}getZoomPanoSize(){return this.zoomPanoSize}availableResolution(e,t){const i=new a.Q;if(!t)return i.reject(0);if(e.resolutions)return e.resolutions.includes(t)?i.resolve(t):this.availableResolution(e,this.getLowerResolution(t));switch(this.getTestResults(e.id,t)){case c.Success:i.resolve(t);break;case c.Fail:return this.availableResolution(e,this.getLowerResolution(t));case c.Untested:this.testDownload(e,t,o.I_).then((n=>{n?i.resolve(t):this.availableResolution(e,this.getLowerResolution(t)).then((e=>i.resolve(e)))}));break;case c.Testing:l.warn("resolution is already testing, do we need to handle this?")}return i}getLowerResolution(e){switch(e){case n.SL.ULTRAHIGH:return n.SL.HIGH;case n.SL.HIGH:return n.SL.STANDARD;case n.SL.STANDARD:return n.SL.BASE}return null}testDownload(e,t,i){if(!this.urls)throw new Error("Can't call testDownload without signed urls");const n=PanoQualityManager.getPanoSize(t),s=new a.Q,r=e.id;this.downloadTestResults[r]||(this.downloadTestResults[r]={});const o=this.downloadTestResults[r]&&this.downloadTestResults[r][t];if(o)o===c.Success?s.resolve(!0):o===c.Fail&&s.resolve(!1);else{this.downloadTestResults[r][t]=c.Testing;const o=e=>{this.downloadTestResults[r][t]=c.Success,s.resolve(!0)},a=()=>{this.downloadTestResults[r][t]=c.Fail,s.resolve(!1)};this.getTileUrl(e,n,i,0).then((e=>{this.urls.getImage(e).then(o,a)}))}return s}getTileUrl(e,t,i,n){const s=this.persistentStorage.get("getTileUrl:locationInfo",(()=>({face:-1,faceTileIndex:-1,tileX:-1,tileY:-1})));o.Tp(t,n,s);const r=Math.floor(t/i),a=r*r,l=Math.floor(n/a),c=PanoQualityManager.getPanoSizeClass(t);return e.getTileUrl(c,l,s.tileX,s.tileY)}}},14844:(e,t,i)=>{"use strict";i.d(t,{I_:()=>l,Hq:()=>c,P6:()=>h,R5:()=>d,Tp:()=>u,Tu:()=>p,ym:()=>m,oU:()=>g,eO:()=>v});var n=i(48277),s=i(2212),r=i(91715),o=i(44110),a=i(7170);const l=512,c=6,h=(e,t,i,s,o,a,l,c)=>{const h=e/t,d=2*(t/e),u=d/2;let p=2*(s/h)-1+u,m=2*((o=h-1-o)/h)-1+u;switch(a=a||r.Z.Center){case r.Z.UpperLeft:p-=u,m+=u,p+=l*d;break;case r.Z.UpperRight:p+=u,m+=u,m-=l*d;break;case r.Z.LowerRight:p+=u,m-=u,p-=l*d;break;case r.Z.LowerLeft:p-=u,m-=u,m+=l*d;break;case r.Z.Center:}switch(i){case n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X:c.set(-1,m,-p);break;case n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:c.set(1,m,p);break;case n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:c.set(-p,1,-m);break;case n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:c.set(-p,-1,m);break;case n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:c.set(-p,m,1);break;case n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:c.set(p,m,-1)}c.normalize()},d=(e,t)=>{let i=l;e<l&&(i=e);const n=Math.floor(e/i),s=n*n;return Math.floor(t/s)},u=(e,t,i)=>{let n=l;e<l&&(n=e);const s=d(e,t),r=Math.floor(e/n),o=t-s*(r*r);i.tileX=o%r,i.tileY=Math.floor(o/r),i.face=s,i.faceTileIndex=o},p=function(e){if(e<=l)return c;const t=Math.floor(e/l);return t*t*c},m=function(){const e=new s.Matrix4,t=new s.Quaternion;return(i,n)=>{t.copy(i),t.invert(),e.makeRotationFromQuaternion(t),n.applyMatrix4(e),n.normalize()}}(),g=function(){const e=new s.Vector3,t=new s.Vector3(0,0,-1),i=new s.Quaternion,n=function(e,t){e.push({face:t.face,faceTileIndex:t.faceTileIndex,tileX:t.tileX,tileY:t.tileY})},r=function(){const e={face:-1,faceTileIndex:-1,tileX:-1,tileY:-1};return(t,i,s)=>{const r=p(t);let o=0;for(let a=0;a<r;a++)u(t,a,e),i&&!i(e)||(o++,s&&n(s,e));return o}}();return(n,o,a,c,h=!1,d,u)=>{c.length=h?0:c.length;const p=o<l?o:l;if(!d&&!u)return r(o,null,c);const g=!!u;d=d||0,u=u||d,u=Math.max(0,Math.min(u,360)),d=Math.max(0,Math.min(d,360)),e.copy(a);const y=n.rotation||new s.Quaternion;if(m(y,e),g){i.setFromUnitVectors(e,t);return r(o,(function(e){return f(o,p,e.face,e.tileX,e.tileY,i,d||0,u||0)}),c)}return r(o,(function(t){return v(o,p,t.face,t.tileX,t.tileY,e,d||0)}),c)}}(),f=function(){const e=new s.Vector3;return(t,i,n,s,l,c,d,u)=>{const p=Math.tan(.5*u*a.Ue),m=-p,g=Math.tan(.5*d*a.Ue),f=-g,v=(0,o.m)(n);let y=0,b=0,S=0,E=0,w=0;for(let n=r.Z.Center;n<=r.Z.LowerLeft;n++){if(h(t,i,v,s,l,n,0,e),e.applyQuaternion(c),e.z>=-1e-5)continue;const r=-1/e.z,o=e.x*r,a=e.y*r;a>p?y++:a<m&&b++,o>g?S++:o<f&&E++,w++}return b!==w&&y!==w&&S!==w&&E!==w}}(),v=function(){const e=new s.Vector3,t=new s.Vector3(0,1,0),i=new s.Vector3(1,0,0);return(n,s,a,l,c,d,u)=>{const p=(0,o.m)(a);if(i.copy(d).cross(t),h(n,s,p,l,c,r.Z.Center,0,e),y(e,d,u))return!0;const m=u/360,g=Math.floor(1/m);let f=0;for(let t=0;t<g;t++){for(let t=r.Z.UpperLeft;t<=r.Z.LowerLeft;t++)if(h(n,s,p,l,c,t,f,e),y(e,d,u))return!0;f+=m}return!1}}(),y=function(){const e=new s.Vector3,t=new s.Vector3;return(i,n,s,r)=>{if(t.copy(i),r){e.copy(r),e.normalize();const n=e.dot(i);e.x*=n,e.y*=n,e.z*=n,t.sub(e)}const o=s/2*a.Ue,l=Math.cos(o);return t.dot(n)>=l}}()},50401:(e,t,i)=>{"use strict";i.d(t,{o:()=>TileDownloadedMessage});var n=i(91466);class TileDownloadedMessage extends n.v{constructor(){super()}}},37381:(e,t,i)=>{"use strict";i.d(t,{YS:()=>s,Xd:()=>r,k4:()=>TilingSettings});var n=i(98828);const s="settings/tiling/preload_quality",r=Object.freeze({overlayStyle:n.h("tileoverlay",0),uploadIntervalDelay:n.h("tileupdelay",50),highResUploadsPerFrame:n.h("maxnbtpf",2),maxHighResUploadsPerFrame:100,loadIndicatorDelay:300,uploadsPerFrame:n.h("maxbtpf",6),maxUploadsPerFrame:100,windowHeightHighQualityThreshold:800,windowHeightHighQualityThresholdOverride:n.h("threshold2k",void 0),concurrentDownloads:n.h("tileconc",3),maxConcurrentDownloads:12,navigation:{directionFactor:10,distanceFactor:-1}});class TilingSettings{constructor(){this.reset()}reset(){this.downloadFullPano=!1,this.concurrentDownloads=r.concurrentDownloads,this.uploadsPerFrame=r.uploadsPerFrame,this.highResUploadsPerFrame=r.highResUploadsPerFrame}}},41862:(e,t,i)=>{"use strict";var n;i.d(t,{v:()=>n}),function(e){e[e.CurrentView=0]="CurrentView",e[e.FullPanorama=1]="FullPanorama"}(n||(n={}))},48280:(e,t,i)=>{"use strict";i.d(t,{Z:()=>RestrictedSweepsClearedMessge});var n=i(91466);class RestrictedSweepsClearedMessge extends n.v{constructor(){super()}}},909:(e,t,i)=>{"use strict";i.d(t,{Z:()=>RestrictedSweepsSetMessge});var n=i(91466);class RestrictedSweepsSetMessge extends n.v{constructor(e){super(),this.sweepIds=e}}},20021:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepPathModule});var n,s=i(2212),r=i(47724),o=i(75892);class Heap{constructor(e){this.comparator=e,this.nodes=[]}push(e){return this.nodes.push(e),this.siftdown(0,this.nodes.length-1)}pop(){let e,t;return this.nodes.length&&(e=this.nodes.pop(),e)?(this.nodes.length?(t=this.nodes[0],this.nodes[0]=e,this.siftup(0)):t=e,t):null}peek(){return this.nodes[0]}contains(e){return-1!==this.nodes.indexOf(e)}replace(e){if(this.nodes.length){const t=this.nodes[0];return this.nodes[0]=e,this.siftup(0),t}return null}_pushpop(e,t,i){let n;const s=i||this.defaultCompare;return e.length&&s(e[0],t)<0&&(n=[e[0],t],t=n[0],e[0]=n[1],this._siftup(e,0,s)),t}pushpop(e){return this._pushpop(this.nodes,e,this.comparator)}_heapify(e,t){let i,n,s,r,o,a;const l=Math.floor(e.length/2),c=function(){for(a=[],s=0,o=l;0<=o?s<o:s>o;0<=o?s++:s--)a.push(s);return a}.apply(this).reverse(),h=[];for(n=0,r=c.length;n<r;n++)i=c[n],h.push(this._siftup(e,i,t));return h}heapify(){let e,t,i,n,s,r;const o=Math.floor(this.nodes.length/2),a=function(){for(r=[],i=0,s=o;0<=s?i<s:i>s;0<=s?i++:i--)r.push(i);return r}.apply(this).reverse(),l=[];for(t=0,n=a.length;t<n;t++)e=a[t],l.push(this.siftup(e));return l}updateItem(e){const t=this.nodes.indexOf(e);return-1===t?null:(this.siftdown(0,t),this.siftup(t))}clear(){return this.nodes=[]}empty(){return 0===this.nodes.length}size(){return this.nodes.length}clone(){const e=new Heap(this.comparator);return e.nodes=this.nodes.slice(0),e}toArray(){return this.nodes.slice(0)}insert(e){return this.push(e)}top(){return this.peek()}front(){return this.peek()}has(e){return this.contains(e)}copy(){return this.clone()}nlargest(e){let t,i,n;const s=this.nodes.slice(0,e);if(!s.length)return s;this._heapify(s,this.comparator);const r=this.nodes.slice(e);for(i=0,n=r.length;i<n;i++)t=r[i],this._pushpop(s,t,this.comparator);return s.sort(this.comparator).reverse()}defaultCompare(e,t){return e<t?-1:e>t?1:0}_siftdown(e,t,i,n){let s,r;const o=n||this.defaultCompare,a=e[i];for(;i>t&&(r=i-1>>1,s=e[r],o(a,s)<0);)e[i]=s,i=r;return e[i]=a}siftdown(e,t){return this._siftdown(this.nodes,e,t,this.comparator)}_siftup(e,t,i){let n,s;const r=i||this.defaultCompare,o=e.length,a=t,l=e[t];for(n=2*t+1;n<o;)s=n+1,s<o&&!(r(e[n],e[s])<0)&&(n=s),e[t]=e[n],n=2*(t=n)+1;return e[t]=l,this._siftdown(e,a,t,r)}siftup(e){return this._siftup(this.nodes,e,this.comparator)}}function a(e,t){for(const i of t)if(i===e)return!0;return!1}!function(e){e[e.Success=0]="Success",e[e.NoPath=1]="NoPath",e[e.Timeout=2]="Timeout"}(n||(n={}));function l(e){if(void 0!==e.parent){const t=l(e.parent);return t.push(e.data),t}return[e.data]}function c(e){return e.toString()}function h(e,t){if(e.f&&t.f)return e.f-t.f;throw new Error('heapComparator() -> Property "f" is undefined.')}const d=Object.freeze({sweeps:{maxNeighborDistance:50}});var u=i(909),p=i(48280);class SweepPathModule extends r.Y{constructor(){super(...arguments),this.name="sweep-path"}async init(e,t){this.engine=t,this.sweepData=await t.market.waitForData(o.Z),this.validNeighbors={},this.maxNeighborDistance=e.maxNeighborDistance||d.sweeps.maxNeighborDistance,this.buildDistanceMap()}setRestrictedSweeps(e,t=0){if(this.restrictedSweeps=[],e){for(let i=t;i<e.length;i++)this.restrictedSweeps.push(e[i].id);this.engine.broadcast(new u.Z(this.restrictedSweeps))}else this.restrictedSweeps=void 0,this.engine.broadcast(new p.Z)}findShortestPath(e,t,i,s,r,o,d=5e3){const u=this.sweepData.getSweep(e),p=this.sweepData.getSweep(t),m=(e=>{void 0===e.timeout&&(e.timeout=1/0);const t=e.hash||c,i={data:e.start,g:0,h:e.heuristic(e.start)};let s=i;i.f=i.h;const r=[],o=new Heap(h),d={};o.push(i),d[t(i.data)]=i;const u=Date.now();for(;o.size();){if(Date.now()-u>e.timeout)return{status:n.Timeout,cost:s.g,path:l(s)};const i=o.pop();if(delete d[t(i.data)],i&&e.isEnd(i.data))return{status:n.Success,cost:i.g,path:l(i)};a(p=t(i.data),m=r)||m.push(p);const c=e.neighbor(i.data);for(const n of c){if(a(t(n),r))continue;const l=i.g+e.distance(i.data,n);let c=d[t(n)],h=!1;if(void 0===c)c={data:n,g:0,h:0,f:0},d[t(n)]=c;else{if(c.g<l)continue;h=!0}c.parent=i||void 0,c.g=l,c.h=e.heuristic(n),c.f=l+c.h,c.h<s.h&&(s=c),h?o.heapify():o.push(c)}}var p,m;return{status:n.NoPath,cost:s.g,path:l(s)}})({start:u,isEnd:e=>e===p,neighbor:e=>this.getValidNeighbors(e.id,o),distance:(e,t)=>this.getDistance(e.id,t.id),heuristic:(e,t)=>1,hash:e=>e.id,timeout:d});return m.status===n.Success&&m.path.length<r?(this.addSweepsNearPath(m.path,i),this.filterCloseSweepsFromPath(m.path,s)):null}addSweepsNearPath(e,t){const i=new s.Vector3,n=new s.Vector3,r=new s.Vector3,o=new s.Vector3,a=new s.Vector3,l=new s.Vector3,c=[],h=new s.Vector3,d=(e,t,i)=>(r.copy(t).sub(e),r.dot(i)),u=(e,t)=>d(h,e.position,i)-d(h,t.position,i);let p=0;for(;p<e.length-1;){const s=e[p].id,d=e[p+1].id,m=this.sweepData.getSweep(s),g=this.sweepData.getSweep(d);h.copy(m.position),c.length=0,i.copy(g.position).sub(h).normalize();const f=this.findConnectedSweeps(m,this.maxNeighborDistance),v=this.findConnectedSweeps(g,this.maxNeighborDistance),y=f.concat(v);for(const e of y){const s=r.copy(e.position).sub(h).dot(i);if(s>0){a.copy(i),a.multiplyScalar(s),o.copy(r),o.sub(a);if(o.length()<t){n.copy(i).negate(),l.copy(e.position).sub(g.position);l.dot(n)>0&&c.push(e)}}}if(c.length>0){c.sort(u);for(let t=e.length+c.length-1;t>=p+c.length;t--)e[t]=e[t-c.length];for(let t=0;t<c.length;t++)e[t+p+1]=c[t]}p+=c.length+1}}findConnectedSweeps(e,t,i=2){const n=[];return this._findConnectedSweeps(e,e,t,n,{},i,0),n}_findConnectedSweeps(e,t,i,n,s,r,o){const a=this.getValidNeighbors(e.id);for(const e of a)if(!s[e.id]){e.position.distanceTo(t.position)<i&&(n.push(e),s[e.id]=!0,o<r&&this._findConnectedSweeps(e,t,i,n,s,r,o+1))}}getValidNeighbors(e,t){let i=this.validNeighbors[e];if(!i){i=[],this.validNeighbors[e]=i;const n=this.sweepData.getSweep(e),s=n.neighbours;for(const r of s){const s=this.sweepData.getSweep(r),o=this.getDistance(e,r);if(!s.enabled)continue;if(o>this.maxNeighborDistance)continue;let a=!0;if(t){const e=s.position.clone().sub(n.position).normalize();a=0===t(n.position,e,o).length}a&&i.push(s)}}return i}filterCloseSweepsFromPath(e,t){const i=[];let n=null,s=!1;for(const r of e)s=n&&r.position.distanceTo(n.position)<t||!1,n&&s||(i.push(r),n=r);return i.length<2?e:(s&&e.length>1&&(i[i.length-1]=e[e.length-1]),i)}getCurveForPath(e){let t=0;const i=[0];for(let n=1;n<e.length;n++)t+=e[n-1].distanceTo(e[n]),i.push(t);const n=[0];for(let s=1;s<e.length;s++)n.push(i[s]/t);const r=new s.CatmullRomCurve3(e,!1);return{curve:new s.CatmullRomCurve3(r.getSpacedPoints(2*t).concat(e[e.length-1])),totalLength:t,sourceDistances:i,normalSourceDistances:n}}buildDistanceMap(){const e={},t=new s.Vector3(0,0,0);this.sweepData.iterate((i=>{const n={},s=i.neighbours;for(const e of s){const s=this.sweepData.getSweep(e);t.copy(i.position).sub(s.position);let r,o=Math.max(0,Math.abs(t.y)-.2),a=Math.sqrt(t.x*t.x+t.z*t.z);o>0?(o=Math.pow(4*o,2),a=Math.pow(a,2),r=Math.sqrt(o*o+a*a)):r=t.length(),n[s.id]=r}e[i.id]=n})),this.distanceMap=e}getDistance(e,t){return this.distanceMap[e][t]}}},46450:(e,t,i)=>{"use strict";i.d(t,{m1:()=>PinCollider,Vp:()=>PinMesh});var n=i(2212),s=i(76570),r=i.n(s),o=i(69254),a=i.n(o);class PinMaterial extends n.RawShaderMaterial{constructor(e,t){const i=n.UniformsUtils.clone(PinMaterial.uniforms);i.tMask.value=e,i.tPinHole.value=t,super({vertexShader:r(),fragmentShader:a(),uniforms:i,name:"PinMaterial",transparent:!0})}}PinMaterial.uniforms={tMask:{type:"t",value:null},tPinHole:{type:"t",value:null},pinColor:{type:"c",value:new n.Color},opacity:{type:"f",value:1}};var l=i(66223),c=i(27408),h=i(48358),d=i(87068),u=i(53225),p=i(48072);class PinCollider extends n.Mesh{}let m;const g=()=>m||(m=(0,l.p)(p),m);class PinMesh extends u.E{constructor(e,t,i,n){const s=new PinMaterial(g(),t);super(PinMesh.geometry,s),this.layers.mask=n.mask,this.name="PinMesh",this.cameraData=i,this._collider=new PinCollider(PinMesh.colliderGeometry,PinMesh.colliderMaterial),this._collider.material.visible=!1,this.add(this._collider),this.opacityProgress=0,this.shouldHide=!0,this.uniforms=s.uniforms,this.unhover(),this.selected=0,this.visible=!1,this.position.copy(e),this.renderOrder=h.z.pins360}updatePosition(e){this.position.copy(e)}get collider(){return this._collider}render(e){this.quaternion.copy(this.cameraData.pose.rotation),null===this.uniforms.tPinHole.value?this.opacityProgress=0:!this.shouldHide&&this.opacityProgress<1?this.opacityProgress+=e/PinMesh.FADE_DURATION:this.shouldHide&&this.opacityProgress>0&&(this.opacityProgress-=e/PinMesh.FADE_DURATION),this.opacityProgress=(0,c.uZ)(this.opacityProgress,0,1),this.uniforms.opacity.value=this.opacityProgress,this.visible=0!==this.opacityProgress}activate(){this.shouldHide=!1}deactivate(){this.shouldHide=!0}dispose(){this.collider.geometry.dispose(),this.collider.material.dispose()}setPinHover(e,t=!0,i=!0){const n=Math.min(Math.max(e,0),1);this.selected!==n&&(i&&this.uniforms.pinColor.value.copy(d.I.WHITE).lerp(d.I.MP_BRAND,n),t&&n>0&&n<=1&&(this.material.depthTest=!1),0===n&&(this.material.depthTest=!0),this.selected=n)}unhover(){this.uniforms.pinColor.value.copy(d.I.WHITE)}}PinMesh.FADE_DURATION=500,PinMesh.geometry=new n.PlaneBufferGeometry(1.5,1.5),PinMesh.colliderGeometry=new n.SphereBufferGeometry(1.5*.65),PinMesh.colliderMaterial=new n.MeshBasicMaterial({transparent:!0,opacity:.5,depthWrite:!1,color:16724312})},51561:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepPinMesh});var n=i(47724),s=i(2212),r=i(46450),o=i(91466);class PinSelectMessage extends o.v{constructor(e,t){super(),this.sweepId=e,this.selected=t}}class PinPlacementMessage extends o.v{constructor(e,t,i){super(),this.sweepId=e,this.pinIndex=t,this.placed=i}}class SweepPlacedMessage extends o.v{constructor(e,t){super(),this.sweepId=e,this.position=t}}var a=i(35026),l=i(34369),c=i(51263),h=i(94610),d=i(88512),u=i(95586),p=i(24764);const m=new d.Z("pin-mesh");class PinMeshRenderer{constructor(e,t,i,n,r,o){this.sweepViewData=e,this.scene=t,this.sweepTextureLoader=i,this.input=n,this.layer=o,this.container=new s.Object3D,this.bindings=[],this.visibilityFilter=()=>!0,this.updatePlacementType=(e,t)=>{this.dataToMeshMap[e.id]||e.placementType!==a.hU.MANUAL?this.dataToMeshMap[e.id]&&e.placementType!==a.hU.MANUAL&&(this.removePinMesh(e),this.engine.broadcast(new PinPlacementMessage(e.id,t,!1))):(this.createPinMesh(e,this.cameraData),this.engine.broadcast(new PinPlacementMessage(e.id,t,!0)))},this.onSweepPlacedMessage=e=>{this.highlightPin(e.sweepId,!0)},this.hoverSweep=(e,t)=>{this.issueCommand(new u.kR(e,t,0));const i=this.sweepViewData.selectedSweep===e;this.highlightPin(e,t||i)},this.meshes=[],this.meshToDataMap={},this.dataToMeshMap={},this.cameraData=r,e.iterate((t=>{t.alignmentType!==a.z9.ALIGNED&&(t.placementType===a.hU.MANUAL&&this.createPinMesh(t,r),this.bindings.push(t.onChanged((()=>{const i=e.getIndexByAlignment(!1,t.id);this.updatePlacementType(t,i),c.H7(t)&&this.updatePinMeshPosition(t.id,t.position)}))))}))}updatePinMeshPosition(e,t){this.mapSweepToMesh(e).updatePosition(t)}mapSweepToMesh(e){return this.dataToMeshMap[e]}mapColliderToSweep(e){const t=e.hasOwnProperty("collider")?e:e.parent;if(t){const e=this.meshToDataMap[t.id];if(e)return e.sweep}return null}filter(e){this.visibilityFilter=e;for(const e of this.meshes)this.filterMesh(e)}init(){}dispose(){for(const e in this.meshToDataMap){const t=this.meshToDataMap[e];this.removePinMesh(t.sweep)}}render(e){for(const t of this.meshes)t.render(e)}activate(e){this.engine=e,this.issueCommand=e.commandBinder.issueCommand.bind(e.commandBinder),this.bindings.push(this.input.registerMeshHandler(h.z,p.s.isType(r.m1),((e,t)=>this.onHoverEvent(t,!0)))),this.bindings.push(this.input.registerMeshHandler(h.A,p.s.isType(r.m1),((e,t)=>this.onHoverEvent(t,!1)))),this.bindings.push(e.subscribe(SweepPlacedMessage,this.onSweepPlacedMessage)),this.scene.add(this.container)}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings.length=0,this.scene.remove(this.container)}getMeshes(){return this.meshToDataMap}highlightPin(e,t){this.dataToMeshMap[e]&&this.dataToMeshMap[e].setPinHover(t?1:0,!1)}lockSelection(e,t){return t&&(this.engine.broadcast(new PinSelectMessage(e.id,!0)),this.hoverSweep(e.id,!0)),!0}createPinMesh(e,t){const i=new r.Vp(e.position,null,t,this.layer);this.meshes.push(i),this.dataToMeshMap[e.id]=i,this.meshToDataMap[i.id]={id:i.id,sweep:e},this.container.add(i),this.filterMesh(i),this.sweepTextureLoader.loadFace(e,l.SL.BASE,1,{flipY:!0}).then((e=>{i.material.uniforms.tPinHole.value=e})).catch((t=>{m.error(`${e.id} failed to load texture: ${t}`)}))}removePinMesh(e){const t=this.dataToMeshMap[e.id],i=this.meshes.findIndex((e=>e.id===t.id));this.meshes.splice(i,1),this.container.remove(t),this.deactivateMesh(t),delete this.meshToDataMap[t.id],delete this.dataToMeshMap[e.id],t.dispose()}filterMesh(e){const t=this.meshToDataMap[e.id];if(t){const i=t.sweep;this.visibilityFilter(i)?this.activateMesh(e):this.deactivateMesh(e)}}onHoverEvent(e,t){const i=this.mapColliderToSweep(e);i&&this.hoverSweep(i.id,t)}activateMesh(e){this.input.registerMesh(e.collider,!1),e.activate()}deactivateMesh(e){this.input.unregisterMesh(e.collider);const t=this.meshToDataMap[e.id];t&&(this.hoverSweep(t.sweep.id,!1),e.deactivate())}}PinMeshRenderer.MENU_CLEAR_DEBOUNCE=100;var g=i(76463),f=i(17386);class PinUnselectCommand extends f.m{constructor(e){super(),this.id="PIN_UNSELECT",this.payload={id:e}}}class SweepStartedRotatingMessage extends o.v{constructor(e){super(),this.sweepId=e}}class SweepFinishedRotatingMessage extends o.v{constructor(e){super(),this.sweepId=e}}var v=i(44218),y=i(59088),b=i(35597),S=i(33874),E=i(94329),w=i(27326),T=i(65379),_=i(1226),M=i(90454),x=i(28963),A=i(736);class SweepPinMesh extends n.Y{constructor(){super(...arguments),this.name="sweep-pin-mesh",this.onChange=()=>{const e=this.sweepViewData,t=e.selectedSweep,i=e.toolState===_._.ROTATING||e.toolState===_._.ROTATED;this.pinRenderer.filter((e=>{if(!this.settingsData.tryGetProperty(x.s,!0))return!1;if(i&&t===e.id)return!1;if(this.viewmodeData.transition.active&&this.viewmodeData.transition.to===E.Ey.Panorama)return!1;const n=!this.nextFloor||this.nextFloor===e.floorId||!e.floorId,s=this.viewmodeData.closestMode===E.Ey.Dollhouse||this.viewmodeData.closestMode===E.Ey.Floorplan;return n&&s}))},this.onSelectedPinChange=()=>{const e=this.sweepViewData.selectedSweep;e&&(this.engine.commandBinder.issueCommand(new u.iF(e,!0,0)),this.pinRenderer.highlightPin(e,!0))}}async init(e,t){[this.model,this.webglRenderer,this.input,this.sweepViewData,this.cameraData,this.settingsData,this.viewmodeData,this.floorsViewData]=await Promise.all([t.getModule(v.default),t.getModuleBySymbol(A.y.WEBGL_RENDERER),t.getModuleBySymbol(A.y.INPUT),t.market.waitForData(T.D),t.market.waitForData(y.M_),t.market.waitForData(S.e),t.market.waitForData(b.O),t.market.waitForData(w.c)]);const i=t.claimRenderLayer(this.name),n=this.webglRenderer.getScene().scene;this.engine=t;const s=new g.Z(this.model.getSignedUrls());this.pinRenderer=new PinMeshRenderer(this.sweepViewData,n,s,this.input,this.cameraData,i),t.addComponent(this,this.pinRenderer),this.bindings.push(this.settingsData.onPropertyChanged(x.s,this.onChange),this.viewmodeData.onChanged(this.onChange),this.sweepViewData.onSelectedSweepChanged(this.onSelectedPinChange),t.subscribe(M.S,(e=>{this.nextFloor=e.to,this.onChange()})),t.subscribe(SweepStartedRotatingMessage,this.onChange),t.subscribe(SweepFinishedRotatingMessage,this.onChange),t.commandBinder.addBinding(PinUnselectCommand,(async e=>{this.pinRenderer.highlightPin(e.id,!1)}))),this.nextFloor=this.floorsViewData.currentFloorId,this.onChange()}mapColliderToSweep(e){return this.pinRenderer.mapColliderToSweep(e)}selectPinMesh(e,t){return this.pinRenderer.lockSelection(e,t)}highlightPinMesh(e,t){this.pinRenderer.highlightPin(e,t)}mapSweepToMesh(e){return this.pinRenderer.mapSweepToMesh(e)}updatePosition(e,t){this.pinRenderer.updatePinMeshPosition(e,t)}}},28963:(e,t,i)=>{"use strict";i.d(t,{s:()=>n});const n="features/360_views"},16400:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepPinNavigation});var n=i(47724),s=i(51561),r=i(46450),o=i(4901),a=i(14092),l=i(94329),c=i(31278),h=i(93263),d=i(35597),u=i(2212),p=i(35003),m=i(94610),g=i(24764),f=i(736);class SweepPinNavigation extends n.Y{constructor(){super(...arguments),this.name="sweep-pin-navigation"}async init(e,t){const[i,n,v,y]=await Promise.all([t.getModule(s.default),t.getModule(h.default),t.market.waitForData(d.O),t.getModuleBySymbol(f.y.INPUT)]),b=new u.Quaternion;this.bindings.push(y.registerMeshHandler(p.R,g.s.isType(r.m1),((e,t,s)=>{const r=i.mapColliderToSweep(t);return!(!r||v.transition.active)&&(b.set(0,0,0,1).multiply(r.rotation),o=r.id,a=b,v.currentMode&&v.currentMode!==l.Ey.Panorama&&n.switchToMode(l.Ey.Panorama,c.n.FadeToBlack,{sweepID:o,rotation:a}),!0);var o,a})),y.registerMeshHandler(m.z,g.s.isType(r.m1),((e,n)=>{i.mapColliderToSweep(n)&&t.commandBinder.issueCommand(new o.u(a.C.FINGER))})),y.registerMeshHandler(m.A,g.s.isType(r.m1),((e,n)=>{i.mapColliderToSweep(n)&&t.commandBinder.issueCommand(new o.u(null))})))}}},74712:(e,t,i)=>{"use strict";i.d(t,{p:()=>PortalPuckMesh,Y:()=>g});var n=i(2212),s=i(22118),r=i.n(s),o=i(28100),a=i.n(o);class PortalMaterial extends n.RawShaderMaterial{constructor(e,t){const i=n.UniformsUtils.clone(PortalMaterial.uniforms);i.tNoHover.value=e,i.tHover.value=t,i.tPortal.value=null,super({vertexShader:r(),fragmentShader:a(),uniforms:i,name:"PortalMaterial",transparent:!0})}}PortalMaterial.uniforms={tNoHover:{type:"t",value:null},tHover:{type:"t",value:null},tPortal:{type:"t",vlaue:null},progress:{type:"f",value:1},opacity:{type:"f",value:1}};var l=i(66223),c=i(68444),h=i(85089),d=i(45545),u=i(64293);let p;const m={get:()=>p||(p={toExteriorTexture:(0,l.p)(c),toExteriorHoverTexture:(0,l.p)(h),toInteriorTexture:(0,l.p)(d),toInteriorHoverTexture:(0,l.p)(u)},p)};var g,f=i(27408),v=i(48358),y=i(89352);!function(e){e[e.HIDE=0]="HIDE",e[e.SHOW=1]="SHOW",e[e.ONTOP=2]="ONTOP"}(g||(g={}));class PortalPuckMesh extends n.Mesh{constructor(e,t){const i=new PortalMaterial(m.get().toInteriorTexture,m.get().toInteriorHoverTexture);super(PortalPuckMesh.geometry,i),this.layers.mask=t.mask,this.uniforms=i.uniforms,this.renderOrder=v.z.portals,this.setState(g.HIDE),this.update(e)}update(e){if(this.portalData=e,this.position.copy(e.position),null!==e.lookDirection){const t=e.lookDirection.clone().add(e.position);this.lookAt(t)}this.hoverProgress=0,this.hovered=!1,e.toExterior?(this.uniforms.tNoHover.value=m.get().toExteriorTexture,this.uniforms.tHover.value=m.get().toExteriorHoverTexture):(this.uniforms.tNoHover.value=m.get().toInteriorTexture,this.uniforms.tHover.value=m.get().toInteriorHoverTexture)}resetMesh(e=0,t=!1,i=!1){this.uniforms.opacity.value=e,this.visible=0!==e,this.material.depthTest=t,this.material.depthWrite=i}setHover(e){this.hovered=e}setState(e){switch(e){case g.HIDE:this.resetMesh(0,!0,!0);break;case g.SHOW:this.resetMesh(1,!0,!0);break;case g.ONTOP:this.resetMesh(1)}}render(e,t){var i;if(this.hovered&&this.hoverProgress<1?this.hoverProgress+=e/300:!this.hovered&&this.hoverProgress>0&&(this.hoverProgress-=e/300),this.hoverProgress=(0,f.uZ)(this.hoverProgress,0,1),this.uniforms.progress.value=this.hoverProgress,null===(i=this.portalData)||void 0===i?void 0:i.billboard){const e=t.pose.position,i=this.position.copy(this.portalData.position),n=e.distanceTo(i);n<y.nm?i.lerpVectors(e,i,y.nm/n):n>y.iz&&i.lerpVectors(e,i,y.iz/n),this.lookAt(t.pose.position)}}updatePortalTexture(e){this.uniforms.tPortal.value=e}}PortalPuckMesh.geometry=new n.PlaneGeometry(y.vX,y.vX)},42881:(e,t,i)=>{"use strict";i.d(t,{K$:()=>PortalClickMessage,Sk:()=>PortalPuckRenderer});var n=i(91466),s=i(74712),r=i(2212),o=i(9293),a=i(94610),l=i(35003),c=i(24764);class PortalClickMessage extends n.v{constructor(e){super(),this.toSweep=e.toSweep,this.toExterior=e.toExterior,this.fromInterior=e.fromInterior,this.meshPosition=e.position}}class PortalPuckRenderer{constructor(e,t,i,n,a){this.container=new r.Object3D,this.bindings=[],this.visibilityFilter=e=>s.Y.HIDE,this.scene=e,this.input=t,this.layer=n,this.cameraData=a,this.viewportLoader=i,this.meshes=[],this.activeMeshes={},this.meshToDataMap={},this.dataToMeshMap={},this.activeTexturePromises={},this.meshPool=new o.L}addPortal(e){let t;const i=this.meshPool.get();i?(t=i.object,t.update(e)):t=this.meshPool.add(new s.p(e,this.layer)).object,this.meshes.push(t),this.container.add(t),this.meshToDataMap[t.id]=e,this.dataToMeshMap[e.index]=t,this.activateMesh(t,this.visibilityFilter(e))}removePortal(e){const t=this.dataToMeshMap[e.index];if(t){this.meshPool.free(t);const i=this.meshes.findIndex((e=>e.id===t.id));this.meshes.splice(i,1),this.container.remove(t),this.deactivateMesh(t),delete this.meshToDataMap[t.id],delete this.dataToMeshMap[e.index]}}init(){}activate(e){this.broadcast=e.broadcast.bind(e),this.bindings.push(this.input.registerMeshHandler(a.z,c.s.isType(s.p),((e,t)=>{this.onPuckSelect(t)}))),this.bindings.push(this.input.registerMeshHandler(a.A,c.s.isType(s.p),((e,t)=>{this.onPuckDeselect(t)}))),this.bindings.push(this.input.registerMeshHandler(l.R,c.s.isType(s.p),((e,t)=>{this.onPuckClick(t)}))),this.scene.add(this.container)}dispose(){for(const e of Object.keys(this.meshToDataMap)){const t=this.meshToDataMap[e],i=this.dataToMeshMap[t.index];this.removePortal(t),i.material.dispose(),i.geometry.dispose()}}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings.length=0,this.scene.remove(this.container)}render(e){for(const t of this.meshes)t.render(e,this.cameraData)}filter(e){this.visibilityFilter=e;for(const t of this.meshes){const i=e(this.meshToDataMap[t.id]);i===s.Y.HIDE?this.deactivateMesh(t):this.activateMesh(t,i)}}mapSweepToMesh(e){for(const t in this.meshToDataMap){const i=this.meshToDataMap[t];if(i.toSweep.id===e&&i.toExterior&&i.fromInterior)return this.dataToMeshMap[i.index]}return null}activateMesh(e,t=0){this.activeMeshes[e.id]||(this.input.registerMesh(e,!1),this.activeMeshes[e.id]=!0),e.setState(t)}deactivateMesh(e){this.input.unregisterMesh(e),this.activeMeshes[e.id]=!1,this.onPuckDeselect(e),e.setState(s.Y.HIDE)}onPuckClick(e){this.broadcast(new PortalClickMessage(this.meshToDataMap[e.id]))}onPuckSelect(e){const t=this.meshToDataMap[e.id].toSweep,i=this.viewportLoader.getPortalTexture(t,t.rotation,e.position);this.activeTexturePromises[e.id]=i,i.then((t=>{this.activeTexturePromises.hasOwnProperty(e.id)&&i===this.activeTexturePromises[e.id]&&(e.updatePortalTexture(t),e.setHover(!0))}))}onPuckDeselect(e){e.setHover(!1),this.viewportLoader.releasePortalTexture(this.meshToDataMap[e.id].toSweep.id),delete this.activeTexturePromises[e.id]}}},55034:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>PortalPuckMeshModule});var n=i(47724),s=i(736),r=i(34369),o=i(2212),a=i(95432),l=i.n(a),c=i(64506),h=i.n(c);class PortalViewportMaterial extends o.RawShaderMaterial{constructor(){const e=o.UniformsUtils.clone(PortalViewportMaterial.uniforms);super({vertexShader:l(),fragmentShader:h(),uniforms:e,name:"PortalViewportMaterial",side:o.BackSide})}updateTexture(e){this.uniforms.tMap.value=e}}PortalViewportMaterial.uniforms={tMap:{type:"t",value:null}};class PortalViewportLoader{constructor(e,t,i,n){this.tempLookDirection=new o.Vector3,this.worldCamera=n,this.camera=new o.Camera,this.renderSize=i,this.sweepTextureLoader=e,this.textureRenderer=t,this.renderTargets={},this.renderCube=new o.Mesh(new o.BoxGeometry(4,4,4),new PortalViewportMaterial)}async getPortalTexture(e,t,i){const n=this.renderTargets[e.id]||this.textureRenderer.createRenderTarget2D(this.renderSize,this.renderSize),s=await this.sweepTextureLoader.load(e,r.SL.BASE);return this.renderCube.material.updateTexture(s),this.renderCube.quaternion.copy(t),this.camera.projectionMatrix.copy(this.worldCamera.projectionMatrix),this.worldCamera.getWorldPosition(this.tempLookDirection),this.camera.lookAt(this.tempLookDirection.sub(i).negate()),this.textureRenderer.render(n,this.renderCube,this.camera),n.texture}releasePortalTexture(e){const t=this.renderTargets[e];t&&this.textureRenderer.disposeRenderTarget2D(t)}}var d=i(42881),u=i(89352),p=i(44218),m=i(17399),g=i(76863),f=i(32306),v=i(66225),y=i(75892),b=i(59088),S=i(35026),E=i(76463),w=i(51263),T=i(57051);const _=new(i(88512).Z)("sweep-portal-mesh");class PortalPuckMeshModule extends n.Y{constructor(){super(...arguments),this.name="sweep-portal-mesh",this.portalCount=0}async init(e,t){const[i,n,r,o,a,l,c]=await Promise.all([t.getModule(p.default),t.getModule(m.default),t.getModuleBySymbol(s.y.INPUT),t.getModule(f.default),t.getModuleBySymbol(s.y.WEBGL_RENDERER),t.market.waitForData(y.Z),t.market.waitForData(b.M_),t.getModule(v.default)]),h=t.claimRenderLayer(this.name);this.portalData={};const u=a.getScene().camera,g=new E.Z(i.getSignedUrls());this.raycaster=n;const T=new PortalViewportLoader(g,o,256,u),_=a.getScene().scene;this.portalRenderer=new d.Sk(_,r,T,h,c);const M=S.hU.MANUAL,x=l.filter((e=>w.H7(e)));l.iterate((e=>{this.portalData[e.id]||(this.portalData[e.id]=[]),w.H7(e)&&this.addPortals(e,this.portalRenderer,l,x);let t=e.placementType;this.bindings.push(e.onPropertyChanged("placementType",(i=>{t!==M&&i===M&&this.addPortals(e,this.portalRenderer,l,x),t===M&&i!==M&&this.removePortals(e.id,this.portalRenderer),t=i}))),this.bindings.push(e.onChanged((()=>{w.H7(e)&&(this.removePortals(e.id,this.portalRenderer),this.addPortals(e,this.portalRenderer,l,x))})))})),t.addComponent(this,this.portalRenderer)}filter(e){this.portalRenderer.filter(e)}getPortalToExterior(e){return this.portalRenderer.mapSweepToMesh(e)}removePortals(e,t){for(const i of this.portalData[e])t.removePortal(i);this.portalData[e]=[]}addPortals(e,t,i,n){const s=this.nearestAlignedSweep(e,i);if(s){const i=this.entryLinks(e,s),r=this.neighborLinks(e,n);this.portalData[e.id]=i.concat(r);for(const i of this.portalData[e.id])t.addPortal(i)}else _.debug(`Couldn't find the nearest sweep for a 360 on floor ${e.floorId}; not adding portals`)}nearestAlignedSweep(e,t){const i=[w.ff(e),w._k(),w._T(),w.b1(e)],n=[T.TE(e.position)],s=t.sortByScore(i,n)[0];return s?s.sweep:null}modelIntersection(e,t,i=1/0){const n=(new o.Vector3).copy(e.position).sub(t.position).setY(0).normalize(),s=this.raycaster.picking.pick(t.position,n,g.T0);return{intersect:s&&s.distance<=i?s:null,rayDirection:n}}entryLinks(e,t){const i=[],n=e.position.distanceTo(t.position),s=this.modelIntersection(e,t,n+u.vX);let r,a,l=!1;return s.intersect&&s.intersect.face?(r=s.intersect.face.normal.clone().setY(0).normalize(),a=s.intersect.point.clone().addScaledVector(r,u.AF)):(r=null,l=!0,a=e.position.clone()),a.y=t.position.y,i.push({index:this.portalCount++,toSweep:e,fromSweep:t,position:a,lookDirection:r,billboard:l,toExterior:!0,fromInterior:!0}),i.push({index:this.portalCount++,toSweep:t,fromSweep:e,position:(new o.Vector3).lerpVectors(e.position,t.position,2/n).setY(e.position.y),lookDirection:r?r.clone().negate():null,billboard:l,toExterior:!1,fromInterior:!1}),i}neighborLinks(e,t){const i=[];for(const n of t)if(e!==n&&n.floorId===e.floorId&&e.position.distanceTo(n.position)<u.M0){const t=e.position.distanceTo(n.position);if(this.modelIntersection(e,n,t).intersect||this.modelIntersection(n,e,t).intersect)continue;const s=e.position.clone().sub(n.position).setY(0).normalize(),r=n.position.clone(),o=u.iz;t>o&&r.addScaledVector(s,t-o),i.push({index:this.portalCount++,toSweep:n,fromSweep:e,position:r,lookDirection:s,billboard:!1,toExterior:!0,fromInterior:!1})}return i}}},89352:(e,t,i)=>{"use strict";i.d(t,{M0:()=>s,AF:()=>r,vX:()=>o,nm:()=>a,iz:()=>l});var n=i(98828);const s=(0,n.h)("geond",15),r=(0,n.h)("geowo",.1),o=.3,a=.75,l=4},86097:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepPortalNavigation});var n=i(98828),s=i(48711);const r=(0,n.h)("geodist",(0,s._F)((0,n.h)("geodistft",20)));var o=i(47724),a=i(55034),l=i(35026),c=i(94329),h=i(31278),d=i(59088),u=i(75892),p=i(93263),m=i(35597),g=i(42881),f=i(74712),v=i(29422),y=i(33874),b=i(28963);class SweepPortalNavigation extends o.Y{constructor(){super(...arguments),this.name="sweep-portal-navigation",this.onChange=()=>{this.portalRenderer.filter((e=>{if(!this.settingsData.tryGetProperty(b.s,!0))return f.Y.HIDE;if(this.viewmodeData.closestMode!==c.Ey.Panorama)return f.Y.HIDE;const t=this.sweepData.getSweep(this.sweepData.currentSweep||"");if(t)if(t.alignmentType===l.z9.ALIGNED){if(e.fromInterior&&e.toExterior&&e.position.distanceTo(t.position)<r)return f.Y.SHOW}else if(t.placementType===l.hU.MANUAL&&e.fromSweep.id===t.id)return f.Y.ONTOP;return f.Y.HIDE}))}}async init(e,t){[this.portalRenderer,this.cameraData,this.viewmodeModule,this.viewmodeData,this.sweepData,this.settingsData]=await Promise.all([t.getModule(a.default),t.market.waitForData(d.M_),t.getModule(p.default),t.market.waitForData(m.O),t.market.waitForData(u.Z),t.market.waitForData(y.e)]);const i=(e,i)=>{this.viewmodeData.currentMode&&this.cameraData.canTransition()&&(this.viewmodeData.currentMode!==c.Ey.Panorama?this.viewmodeModule.switchToMode(c.Ey.Panorama,h.n.FadeToBlack,{sweepID:e,rotation:i}):t.commandBinder.issueCommand(new v.ju({sweep:e,rotation:i,transition:h.n.FadeToBlack})))};this.settingsData.onPropertyChanged(b.s,this.onChange),this.bindings.push(t.subscribe(g.K$,(e=>{i(e.toSweep.id)})),this.viewmodeData.onChanged(this.onChange),this.sweepData.onChanged(this.onChange)),this.onChange()}}},86383:(e,t,i)=>{"use strict";i.d(t,{Z:()=>PuckClickedMessage});var n=i(91466);class PuckClickedMessage extends n.v{constructor(e,t,i){super(),this.sweepId=e,this.sweepIndex=t,this.totalSweeps=i}}},84394:(e,t,i)=>{"use strict";i.d(t,{Z:()=>PuckHoverMessage});var n=i(91466);class PuckHoverMessage extends n.v{constructor(e,t){super(),this.sweepId=e,this.hovered=t}}},16101:(e,t,i)=>{"use strict";i.d(t,{YY:()=>PuckCollider,C$:()=>PuckRenderer});var n=i(2212),s=i(95586),r=i(94610),o=i(35003),a=i(86383),l=i(84561),c=i(48358),h=i(35026),d=i(66999),u=i(84394);class PuckMesh extends n.Mesh{}class PuckCollider extends n.Mesh{}class PuckRenderer{constructor(e,t,i,s,r,o,a,c=new n.Color(16724312),h=new n.Color(16724312),d=.8,u=.8,p=300,m=.4,g=l.o.ALL){this.scene=e,this.input=t,this.settingsData=i,this.sweepViewData=s,this.puckImagery=r,this.onFloor=o,this.checkRenderModes=a,this.idleColor=c,this.selectionColor=h,this.idleOpacity=d,this.editingOpacity=u,this.selectionDuration=p,this.puckSize=m,this.layer=g,this.sweepToMesh={},this.colliderToSweep={},this.editingEnabled=!1,this.dummyMat=new n.MeshBasicMaterial,this.puckOffset=new n.Vector3(0,.05,0),this.bindings=[],this.wasDrawing=!1,this.renderPuckHighlight=(e,t)=>{if(!this.sweepViewData.isSweepAligned(e))return;const i=this.sweepToMesh[e].material.color;t?i.copy(this.selectionColor):i.copy(this.idleColor)},this.updateLookAt=e=>{this.sweepViewData.iterate((t=>{const i=this.sweepToMesh[t.id];i&&i.visible&&i.lookAt(e)}))}}init(){if(this.puckGeometry=new n.PlaneBufferGeometry(this.puckSize,this.puckSize),this.onFloor){const e=new n.Matrix4;e.makeRotationFromEuler(new n.Euler(-Math.PI/2,0,0,"XYZ")),this.puckGeometry.applyMatrix4(e)}this.sphereColliderGeometry=new n.SphereBufferGeometry(.5*this.puckSize,10,10),this.matParamsEnabled={color:this.idleColor.getHex(),opacity:this.idleOpacity,transparent:!0,depthWrite:!1,map:this.puckImagery.enabled},this.sweepViewData.iterate(this.createPuck.bind(this))}get displayDisabled(){return void 0!==this.puckImagery.disabled}onSweepStateAnimationChanged(e,t,i){const n=i.value,s=e.enabled?this.puckImagery.enabled:this.puckImagery.disabled,r=e.enabled?this.puckImagery.enabledHover:this.puckImagery.disabledHover,o=n>0&&this.editingEnabled,a=e.id===this.sweepViewData.selectedSweep,l=this.editingEnabled&&a?this.selectionColor:this.idleColor,c=this.editingEnabled?this.editingOpacity:this.idleOpacity;t.setValues({map:o?r:s}),t.color.copy(l),t.opacity=c*(1-n)+1*n}createMaterial(e){const t=new n.MeshBasicMaterial(this.matParamsEnabled);return this.puckImagery.disabled&&!e.enabled&&t.setValues({map:this.puckImagery.disabled}),this.bindings.push(e.onPropertyChanged("enabled",(()=>{t.setValues({map:e.enabled?this.puckImagery.enabled:this.puckImagery.disabled})}))),t}createMesh(e,t){const i=new PuckMesh(this.puckGeometry,t);this.onFloor?i.position.copy(e.floorPosition).add(this.puckOffset):(i.position.copy(e.position),i.rotation.setFromQuaternion(e.rotation)),i.name=e.id,i.updateMatrixWorld(!1),i.renderOrder=c.z.panoMarker;const n=this.sweepViewData.getState(e.id);return i.visible=n.visible,this.bindings.push(n.onPropertyChanged("visible",(e=>{i.visible=e}))),this.bindings.push(n.onPropertyChanged("animation",(i=>this.onSweepStateAnimationChanged(e,t,i)))),i.layers.mask=this.layer.mask,i}createCollider(e,t){let i;return i=this.onFloor?new PuckCollider(this.puckGeometry,this.dummyMat):new PuckCollider(this.sphereColliderGeometry,this.dummyMat),i.userData.sid=e.id,i.position.copy(t.position),i.rotation.copy(t.rotation),i.name=e.id,i.updateMatrixWorld(!1),i}createPuck(e){if(e.alignmentType!==h.z9.ALIGNED)return;const t=this.createMaterial(e),i=this.createMesh(e,t),n=this.createCollider(e,i);i.collider=n,this.sweepToMesh[e.id]=i,this.colliderToSweep[n.id]=e.id}toggleEditingEnabled(e){this.editingEnabled=e;for(const t in this.sweepToMesh){this.sweepToMesh[t].material.opacity=e?this.editingOpacity:this.idleOpacity}}getSweepId(e){return this.colliderToSweep[e]}updatePuckImagery(e){let t;this.displayDisabled||void 0===e.disabled?this.displayDisabled&&void 0===e.disabled&&(t=!1):t=!0,this.puckImagery=e,this.sweepViewData.iterate((e=>{if(e.alignmentType!==h.z9.ALIGNED)return;const i=this.sweepToMesh[e.id],n=this.sweepViewData.getState(e.id);i.visible=n.visible;let s=this.puckImagery.enabled;if(!e.enabled&&this.puckImagery.disabled&&(s=this.puckImagery.disabled),this.sweepToMesh[e.id].material.setValues({map:s}),void 0!==t){if(e.enabled)return;t?this.addSweepToScene(e.id):this.removeSweepFromScene(e.id)}}))}updateCheckRenderModes(e){this.checkRenderModes=e}removeSweepFromScene(e){const t=this.sweepToMesh[e];this.scene.remove(t),this.input.unregisterMesh(t.collider)}addSweepToScene(e){if(!this.sweepViewData.getSweep(e).enabled&&!this.displayDisabled)return;const t=this.sweepToMesh[e];this.scene.add(t),this.input.registerMesh(t.collider,!0)}render(){const e=this.checkRenderModes(),t=this.settingsData.tryGetProperty(d.U,!0);if(e&&t){if(!this.wasDrawing){for(const e in this.sweepToMesh)this.addSweepToScene(e);this.wasDrawing=!0}}else if(this.wasDrawing){for(const e in this.sweepToMesh)this.removeSweepFromScene(e);this.wasDrawing=!1}}dispose(){for(const e in this.sweepToMesh){const t=this.sweepToMesh[e];t.material.dispose(),t.geometry.dispose()}}activate(e){this.wasDrawing=!1;const t=new PuckComparator(this.sweepViewData);this.bindings.push(this.input.registerMeshHandler(r.z,t,((t,i)=>{e.commandBinder.issueCommand(new s.kR(this.getSweepId(i.id),!0,this.selectionDuration)),e.broadcast(new u.Z(this.getSweepId(i.id),!0))}))),this.bindings.push(this.input.registerMeshHandler(r.A,t,((t,i)=>{e.commandBinder.issueCommand(new s.kR(this.getSweepId(i.id),!1,this.selectionDuration)),e.broadcast(new u.Z(this.getSweepId(i.id),!1))}))),this.bindings.push(this.input.registerMeshHandler(o.R,t,((t,i)=>{const n=this.sweepViewData.getSweep(this.colliderToSweep[i.id]).index,s=this.sweepViewData.getAlignedSweeps(!0).length;e.broadcast(new a.Z(this.colliderToSweep[i.id],n,s))})))}deactivate(e){for(const e in this.sweepToMesh)this.removeSweepFromScene(e);for(const e of this.bindings)e.cancel();this.bindings.length=0}}class PuckComparator{constructor(e){this.sweepViewData=e}compare(e){if(e instanceof PuckCollider){return this.sweepViewData.getSweepVisibility(this.sweepViewData.getSweep(e.userData.sid))}return!1}}},17206:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepPucks});var n=i(47724),s=i(2212),r=i(24764),o=i(25269),a=i(36123),l=i(16101),c=i(86383),h=i(17386);class TogglePuckEditingCommand extends h.m{constructor(e){super(),this.id="TOGGLE_PUCK_EDITING",this.payload={enabled:e}}}var d=i(88814),u=i(76870),p=i(49340),m=i(35003),g=i(33874),f=i(59088),v=i(65379),y=i(35597),b=i(94329),S=i(66223),E=i(29480);const w=(0,S.p)(E);var T=i(29422),_=i(19047),M=i(10613),x=i(736);const A={enabled:w,enabledHover:w};class SweepPucks extends n.Y{constructor(){super(...arguments),this.name="sweep-pucks",this.IDLE_OPACITY=.3,this.EDITING_OPACITY=.9,this.IDLE_COLOR=new s.Color("white"),this.SELECTION_COLOR=new s.Color(16724312),this.defaultCheckRenderModes=()=>!0,this.unselectingSweep=null,this.editingEnabled=!1,this.selectionBindings=[],this.unselectionBindings=[],this.selectionHandled=!0,this.unselectionHandled=!0,this.handlePuckClickedMessage=e=>{if(!e)throw new Error("SweepPucks -> on PuckClickedMessage: Tried to move to invalid sweep id.");this.canSelectPuck()||this.sweepViewData.data.canTransition()&&this.cameraData.canTransition()&&this.engine.commandBinder.issueCommand(new T.ju({transition:M.y[this.interactionmodeData.mode],sweep:e}))},this.handleSweepSelectionChange=()=>{this.updateHighlightOnSelectedPuck(!1),this.selectedSweep=this.sweepViewData.selectedSweep,this.updateHighlightOnSelectedPuck(!0),this.updateHandlers()},this.updateViewmode=()=>{this.viewmode=this.viewmodeData.currentMode,this.updateHighlightOnSelectedPuck(this.editingEnabled),this.updateHandlers()},this.updateHandlers=()=>{this.selectionHandled=this.toggleHandlers(this.canSelectPuck(),this.selectionBindings,this.selectionHandled),this.unselectionHandled=this.toggleHandlers(this.canUnselectPuck(),this.unselectionBindings,this.unselectionHandled)},this.unselectPuck=()=>{this.unselectingSweep=null,this.sweepViewData.setSelectedSweep(null)},this.onUnselectPuck=e=>{const t=this.sweepViewData.selectedSweep;return t&&(e.down?this.unselectingSweep=t:this.unselectingSweep&&this.unselectPuck()),!0},this.onPointerOnPuck=(e,t)=>{if(e.button!==u.MP.PRIMARY)return;const i=this.renderer.getSweepId(t.id);i&&(e.down?i===this.selectedSweep?this.unselectingSweep=i:(this.unselectingSweep=null,this.sweepViewData.setSelectedSweep(i)):(i===this.unselectingSweep&&this.unselectPuck(),this.unselectingSweep=null))}}async init(e,t){this.engine=t,void 0!==e.checkRenderModes&&(this.defaultCheckRenderModes=e.checkRenderModes);const i=(await t.getModuleBySymbol(x.y.WEBGL_RENDERER)).getScene(),n=await t.getModuleBySymbol(x.y.INPUT),[s,h,d,u,b]=await Promise.all([t.market.waitForData(g.e),t.market.waitForData(f.M_),t.market.waitForData(v.D),t.market.waitForData(y.O),t.market.waitForData(_.Z)]);this.viewmodeData=u,this.viewmode=u.currentMode,this.sweepViewData=d,this.cameraData=h,this.interactionmodeData=b;this.renderer=new l.C$(i.scene,n,s,d,A,!0,this.defaultCheckRenderModes,this.IDLE_COLOR,this.SELECTION_COLOR,this.IDLE_OPACITY,this.EDITING_OPACITY,void 0,void 0,t.claimRenderLayer(this.name)),t.addComponent(this,this.renderer),this.bindings.push(t.commandBinder.addBinding(TogglePuckEditingCommand,(async e=>this.togglePuckEditing(e.enabled))),t.subscribe(c.Z,(e=>this.handlePuckClickedMessage(e.sweepId)))),this.selectionBindings.push(n.registerMeshHandler(p.er,r.s.isType(l.YY),this.onPointerOnPuck),n.registerHandler(p.mE,(()=>{this.unselectingSweep=null}))),this.selectionHandled=this.toggleHandlers(!1,this.selectionBindings,this.selectionHandled),this.selectionSub=this.sweepViewData.onSelectedSweepChanged(this.handleSweepSelectionChange),this.selectionSub.cancel(),this.unselectionBindings.push(n.registerPriorityHandler(m.R,a.S,(()=>!0)),n.registerPriorityHandler(p.er,a.S,this.onUnselectPuck),n.registerPriorityHandler(p.er,o.i,this.onUnselectPuck)),this.unselectionHandled=this.toggleHandlers(!1,this.unselectionBindings,this.unselectionHandled)}dispose(e){for(const e of this.bindings)e.cancel();this.bindings=[],this.togglePuckEditing(!1),super.dispose(e)}updatePuckImagery(e={}){const t=Object.assign(Object.assign({},A),e);t.disabled&&!t.disabledHover&&(t.disabledHover=t.disabled),this.renderer.updatePuckImagery(t)}updateCheckRenderModes(e){this.renderer.updateCheckRenderModes(e||this.defaultCheckRenderModes)}updateHighlightOnSelectedPuck(e){const t=this.selectedSweep;if(t){if(!this.sweepViewData.isSweepAligned(t))return;const i=this.viewmode===b.Ey.Dollhouse||this.viewmode===b.Ey.Floorplan;this.renderer.renderPuckHighlight(t,this.editingEnabled&&i&&e)}}togglePuckEditing(e){this.editingEnabled=e,this.selectedSweep=this.sweepViewData.selectedSweep,this.updateViewmode(),this.renderer.toggleEditingEnabled(e),e?(this.engine.subscribe(d.Z,this.updateViewmode),this.selectionSub.renew()):(this.engine.unsubscribe(d.Z,this.updateViewmode),this.selectionSub.cancel())}canUnselectPuck(){const e=this.viewmode===b.Ey.Dollhouse||this.viewmode===b.Ey.Floorplan;return this.editingEnabled&&!!this.selectedSweep&&e}canSelectPuck(){const e=this.viewmode===b.Ey.Dollhouse||this.viewmode===b.Ey.Floorplan;return this.editingEnabled&&e}toggleHandlers(e,t,i){if(e!==i)for(const i of t)e?i.renew():i.cancel();return e}}},66999:(e,t,i)=>{"use strict";i.d(t,{U:()=>n});const n="features/sweep_pucks"},65379:(e,t,i)=>{"use strict";i.d(t,{D:()=>SweepViewData});var n=i(32770),s=i(48715),r=i(35026),o=i(51263),a=i(64781),l=i(23573),c=i(17131);class SweepState extends l.T{constructor(){super(...arguments),this.selected=!1,this.visible=!0,this.animation=new c.z(0)}}var h=i(1226);class SweepViewData extends n.V{constructor(e){super(),this.data=e,this.name="sweeps-view",this.states=new a.v,this.toolStateObservable=(0,s.Y)(h._.CLOSED),this.defaultSweepVisibilityRule=e=>e.enabled,this.sweepVisibilityRule=this.defaultSweepVisibilityRule,this.selectCurrentSweep=()=>{this.setSelectedSweep(this.data.currentSweep||null)},this.derivedData={},this.selectedSweepObservable=new s.f(null);const t=[h._.MOVING,h._.PLACING,h._.PRESSING,h._.ROTATING];e.makeSweepChangeSubscription((()=>{t.includes(this.toolState)||this.selectCurrentSweep()})),e.iterate((e=>{const t=new SweepState;this.states.set(e.id,t),t.commit()})),this.updateViewData()}updateViewData(){this.data.iterate(((e,t)=>{this.derivedData[e.id]=this.makeViewDataForSweep(e,t)})),this.commit()}updateSweepVisibilityRule(e){this.sweepVisibilityRule=e||this.defaultSweepVisibilityRule}getSweepVisibility(e){return this.sweepVisibilityRule(e)}get selectedSweep(){return this.selectedSweepObservable.value}setSelectedSweep(e){if(e===this.selectedSweep)return;const t=this.selectedSweep;if(this.selectedSweepObservable.value=e,null!==e){const t=this.getState(e);t.selected=!0,t.commit()}if(null!==t){const e=this.getState(t);e.selected=!1,e.commit()}}onSelectedSweepChanged(e){return this.selectedSweepObservable.onChanged(e)}setToolState(e){e===h._.PLACING&&this.selectedSweep&&this.setSelectedSweep(null),this.toolStateObservable.value=e}get toolState(){return this.toolStateObservable.value}onToolStateChanged(e){return this.toolStateObservable.onChanged(e)}getSweep(e){return this.data.getSweep(e)}makeViewDataForSweep(e,t){const i=this.derivedData[e.id];return i?(i.floorId=e.floorId,i.position=e.position,i.alignmentType=e.alignmentType,i.placed=e.placementType===r.hU.MANUAL,i.enabled=e.enabled,i.name=e.name,i):{id:e.id,floorId:e.floorId,position:e.position,index:e.index,alignmentType:e.alignmentType,dataIndex:t,placed:e.placementType===r.hU.MANUAL,enabled:e.enabled,name:e.name}}getViewData(e){const t=this.data.getSweep(e),i=this.derivedData[e];return t&&!i&&(this.derivedData[e]=this.makeViewDataForSweep(t,t.index)),this.derivedData[e]}isSweepAligned(e){return this.data.isSweepAligned(e)}iterate(e){this.data.iterate(e)}getState(e){return this.states.get(e)}isVisible(e){return this.states.get(e).visible}setVisible(e,t){const i=this.getState(e);i.visible!==t&&(i.visible=t,i.commit())}updateAnimations(e){for(const t of this.states)t.animation.tick(e)}modifySelectAnimation(e,t,i){const n=this.getState(e).animation,s=1===n.endValue;t!==s&&(s?n.modifyAnimation(n.value,0,i):n.modifyAnimation(0,1,i))}getIndexByAlignment(e,t){return this.getAlignedSweeps(e).findIndex((e=>e.id===t))}getAlignedSweeps(e){const t=Object.values(this.derivedData);return e?t.filter((0,o._T)()):t.filter((0,o.WO)())}}},1226:(e,t,i)=>{"use strict";var n;i.d(t,{_:()=>n}),function(e){e.CLOSED="closed",e.IDLE="idle",e.PRESSING="pressing",e.PLACING="placing",e.MOVING="moving",e.ROTATING="rotating",e.ROTATED="rotated"}(n||(n={}))},23889:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepViewDataModule});var n=i(47724),s=i(75892),r=i(65379),o=i(95586),a=i(35597),l=i(76896),c=i(27326),h=i(8150),d=i(91302);class SweepViewDataModule extends n.Y{constructor(){super(...arguments),this.name="sweep-viewdata",this.selectionEnabled=!0,this.nonPanoCurrentPuckVisible=!1,this.sweepMap={},this.sweepIdList=[],this.enableSweepSelection=async e=>{this.selectionEnabled=!0},this.disableSweepSelection=async e=>{this.selectionEnabled=!1},this.toggleCurrentPuck=async e=>{this.nonPanoCurrentPuckVisible=e.visible,this.updateVisibility(this.viewData.data.currentSweep)},this.onSweepSelectCommand=async e=>{this.selectionEnabled&&this.viewData.modifySelectAnimation(e.id,e.selected,e.duration)},this.onSweepHoverCommand=async e=>{this.viewData.modifySelectAnimation(e.id,e.hovered,e.duration)},this.updateVisibility=async e=>{if(this.viewmodeData.isPano()){if(e){const t=this.viewData.getSweep(e).neighbours;this.viewData.iterate((e=>{const i=this.viewData.getSweepVisibility(e)&&-1!==t.indexOf(e.id);this.viewData.setVisible(e.id,i)})),this.viewData.setVisible(e,!1)}}else this.viewData.iterate((e=>{this.viewData.setVisible(e.id,this.floorsViewData.isCurrentOrAllFloors(e.floorId))})),e&&this.viewData.setVisible(e,this.nonPanoCurrentPuckVisible)}}async init(e,t){this.data=await t.market.waitForData(s.Z),this.viewData=t.market.tryGetData(r.D)||new r.D(this.data),t.market.register(this,r.D,this.viewData),this.bindings.push(t.commandBinder.addBinding(o.iF,this.onSweepSelectCommand),t.commandBinder.addBinding(o.kR,this.onSweepHoverCommand),t.commandBinder.addBinding(o.zd,this.enableSweepSelection),t.commandBinder.addBinding(o.ZD,this.disableSweepSelection),t.commandBinder.addBinding(o.e9,this.toggleCurrentPuck),this.data.onChanged((()=>this.viewData.updateViewData())),t.msgBus.subscribe(d.sY,(()=>this.viewData.updateViewData()))),this.viewmodeData=await t.market.waitForData(a.O),this.floorsViewData=await t.market.waitForData(c.c),this.bindings.push(this.data.onPropertyChanged("currentSweep",this.updateVisibility),t.subscribe(l.P,(()=>this.updateVisibility(this.viewData.data.currentSweep))),t.subscribe(h.bS,(()=>this.updateVisibility(this.viewData.data.currentSweep))),this.viewmodeData.makeModeChangeSubscription((()=>this.updateVisibility(this.viewData.data.currentSweep)))),this.updateVisibility(this.viewData.data.currentSweep)}onUpdate(e){this.viewData.updateAnimations(e)}}},51627:(e,t,i)=>{"use strict";i.d(t,{n:()=>TagsViewData});var n=i(32770),s=i(48715),r=i(75256),o=i(21909);class TagsViewData extends n.V{constructor(e,t,i,n){super(),this.data=e,this.attachmentsData=t,this.backgroundTexture=i,this.maskTexture=n,this.name="tags-view-data",this.tagCreation=!1,this.tagSelectedOnly=!1,this.allTagViews=(0,r.C)([]),this.enabledTagViews=(0,r.C)([]),this.openTagViewObservable=(0,s.Y)(null),this.tagToolStateObservable=(0,s.Y)(o.p.CLOSED),this.listIndexObservable=(0,s.Y)(-1),this.updateViewData()}getData(){return this.data}getEnabledTagViews(){return this.enabledTagViews}getAllTagViews(){return this.allTagViews}getTagCount(){return this.data.collection.length}getTagView(e){const t=this.allTagViews.findIndex((t=>t.id===e));return-1!==t?this.allTagViews.get(t):null}getCurrentTagViewByIndex(e){return-1!==e?this.enabledTagViews.get(e):null}updateViewData(){const e=[];this.data.iterate((t=>{const i=this.createTagView(t);e.push(i)})),this.allTagViews.replace(e),this.updateEnabledTagViews()}getFilteredTags(){const e=[];return this.allTagViews.forEach((t=>{t.enabled&&e.push(t)})),e}updateEnabledTagViews(){const e=this.getFilteredTags().sort(((e,t)=>t.created.getTime()-e.created.getTime()));this.enabledTagViews.replace(e)}createTagView(e){return{id:e.sid,created:e.created,modified:e.modified,label:e.label,description:e.description,enabled:e.enabled,color:`#${e.color.getHexString()}`,anchorPosition:e.anchorPosition,floorId:e.floorId,roomId:e.roomId,stemNormal:e.stemVector,stemLength:e.stemHeight,stemEnabled:e.stemVisible,widgetFrame:e.widgetFrame,attachments:this.attachmentsData.getTagAttachments(e.sid),backgroundTexture:this.backgroundTexture,maskTexture:this.maskTexture}}get creatingTag(){return this.tagCreation}setCreatingTag(e){this.tagCreation=e}get selectedPreview(){return this.tagSelectedOnly}setTagsToolState(e){this.tagToolStateObservable.value=e}get tagsToolState(){return this.tagToolStateObservable.value}onTagsToolStateChanged(e){return this.tagToolStateObservable.onChanged(e)}setListIndex(e){this.listIndexObservable.value=e}get listIndex(){return this.listIndexObservable.value}onListIndexChanged(e){return this.listIndexObservable.onChanged(e)}setOpenTagView(e,t=!1){e===this.openTagViewObservable.value&&this.tagSelectedOnly!==t?(this.tagSelectedOnly=t,this.openTagViewObservable.setDirty()):(this.tagSelectedOnly=t,this.openTagViewObservable.value=e)}get openTagView(){return this.openTagViewObservable.value}onOpenTagViewChanged(e){return this.openTagViewObservable.onChanged(e)}updateOpenTagView(e){const t=this.openTagView;if(t){const i=Object.assign(Object.assign({},t),e);this.setOpenTagView(i)}}}},65049:(e,t,i)=>{"use strict";i.d(t,{bF:()=>TagsToggleCommand,lt:()=>OpenTagCommand,YC:()=>SelectTagCommand,X8:()=>PreviewTagCommand,xb:()=>CloseTagCommand,P3:()=>ToggleTagVisibilityCommand,mt:()=>ToggleTagToolEditorCommand,wZ:()=>SaveTagAppearanceCommand});var n=i(17386),s=i(31278);class TagsToggleCommand extends n.m{constructor(e){super(),this.payload={opened:e}}}class OpenTagCommand extends n.m{constructor(e,t,i,n=-1){super(),this.payload={id:e,listIndex:n,transition:t,attachmentId:i}}}class SelectTagCommand extends n.m{constructor(e,t=s.n.Instant){super(),this.payload={id:e,transition:t}}}class PreviewTagCommand extends n.m{constructor(e){super(),this.payload={id:e}}}class CloseTagCommand extends n.m{constructor(){super()}}class ToggleTagVisibilityCommand extends n.m{constructor(e,t){super(),this.payload={id:e,visible:t}}}class ToggleTagToolEditorCommand extends n.m{constructor(e){super(),this.payload={opened:e}}}class SaveTagAppearanceCommand extends n.m{constructor(e,t){super(),this.payload={id:e,properties:t}}}},21909:(e,t,i)=>{"use strict";var n;i.d(t,{p:()=>n}),function(e){e.CLOSED="closed",e.IDLE="idle",e.CREATING="creating",e.OPENING="opening",e.VIEWING="viewing",e.ANNOTATING="annotating",e.EDITING="editing"}(n||(n={}))},36210:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CloseTagCommand:()=>T.xb,OpenTagCommand:()=>T.lt,PreviewTagCommand:()=>T.X8,SaveTagAppearanceCommand:()=>T.wZ,SelectTagCommand:()=>T.YC,TagDeletedMessage:()=>TagDeletedMessage,TagsToggleCommand:()=>T.bF,TagsToolState:()=>E.p,TagsViewData:()=>w.n,ToggleTagToolEditorCommand:()=>T.mt,ToggleTagVisibilityCommand:()=>T.P3,default:()=>I});var n=i(47724),s=i(66223),r=i(80517),o=i(89411),a=i(31278),l=i(15881),c=i(34986),h=i(29422),d=i(41591),u=i(42835),p=i(38321),m=i(48470),g=i(92532),f=i(79553),v=i(66157),y=i(89046),b=i(44060),S=i(40698),E=i(21909),w=i(51627),T=i(65049),_=i(22151),M=i(96168),x=i(85004),A=i(62679),O=i(75892),P=i(33874),D=i(35597);class TagsModule extends n.Y{constructor(){super(...arguments),this.name="tags-module",this.activated=!1,this.registered=!1,this.activeBindings=[],this.updatePerSettings=()=>{const e=this.settingsData.tryGetProperty(b.r,!1),t=!this.in360View();this.pinRenderer.setPinTypeVisible(u.Er.MATTERTAG,t&&e)},this.togglePinAssetEditor=async e=>{e.opened?this.viewData.setTagsToolState(E.p.EDITING):this.viewData.tagsToolState===E.p.EDITING&&this.viewData.setTagsToolState(E.p.VIEWING)},this.onCloseTag=async()=>{this.closeTag()},this.tagsWereChanged=()=>{this.viewData.updateViewData()},this.onOpenTagViewChanged=()=>{const e=this.viewData.openTagView;e&&this.updateTag(e)},this.onDeselectTag=e=>{e.pinType===u.Er.MATTERTAG&&this.closeTag()},this.onPreviewTag=async e=>{const t=this.viewData.getTagView(e.id);t&&this.engine.commandBinder.issueCommand(new p._l(t,u.Er.MATTERTAG))},this.onSelectTag=async e=>{const{viewData:t,engine:i,log:n,pinRenderer:s}=this,{id:r,transition:o}=e,a=t.getTagView(r);if(a){await i.commandBinder.issueCommand(new g.tT(f.w1.TAGS,!0,!1)),s.hideSelectedMesh(),await i.commandBinder.issueCommand(new h.OR({pinPosition:a,transition:o})),s.showSelectedMesh(u.Er.MATTERTAG,a.id),i.broadcast(new m.Q4(a,u.Er.MATTERTAG));const e=t.getEnabledTagViews().values().findIndex((e=>e.id===a.id));t.setListIndex(e),t.setOpenTagView(a,!0)}else n.debug("Cannot select a non-existent tag")},this.onOpenTag=async e=>this.openTag(e.id,e.transition,e.attachmentId,e.listIndex),this.saveTagAppearance=async e=>{const t=this.tagsData,i=this.viewData;if(t.getTag(e.id)){const t=e.properties;if(Object.keys(t)){i.updateOpenTagView(t);const e=i.openTagView;e&&this.engine.broadcast(new m.KR(e,u.Er.MATTERTAG))}}else this.log.debug("Cannot update a non-existent tag")},this.tagsToolToggled=async e=>{e.opened?this.activateTool():this.deactivateTool()}}async init(e,t){const[i,n,a,l,c,h]=await Promise.all([t.getModule(d.default),t.market.waitForData(_.b),t.market.waitForData(S.n),t.market.waitForData(O.Z),t.market.waitForData(P.e),t.market.waitForData(D.O)]);this.pinRenderer=i.pinRenderer,this.attachmentsData=n,this.tagsData=a,this.sweepData=l,this.settingsData=c,this.viewmodeData=h,this.engine=t,this.maskTexture=(0,s.p)(o),this.backgroundTexture=(0,s.p)(r),this.viewData=new w.n(this.tagsData,this.attachmentsData,this.backgroundTexture,this.maskTexture),this.bindings.push(c.onPropertyChanged(b.r,this.updatePerSettings),t.commandBinder.addBinding(T.bF,this.tagsToolToggled),t.commandBinder.addBinding(T.lt,this.onOpenTag),t.commandBinder.addBinding(T.xb,this.onCloseTag),t.commandBinder.addBinding(T.YC,this.onSelectTag),t.commandBinder.addBinding(T.X8,this.onPreviewTag),t.subscribe(m.Fe,this.onDeselectTag),this.tagsData.onChanged(this.tagsWereChanged)),this.createEmbedAttachments(),t.market.register(this,w.n,this.viewData),this.updatePerSettings(),this.displayTags()}dispose(e){this.deactivateTool(),this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],this.activeBindings=[],this.pinRenderer.removePinsByType(u.Er.MATTERTAG),this.maskTexture.dispose(),this.backgroundTexture.dispose(),super.dispose(e)}activateTool(){this.activated||(this.viewData.setTagsToolState(E.p.CLOSED),this.registered?this.activeBindings.forEach((e=>{e.renew()})):this.registerHandlers(),this.activated=!0)}deactivateTool(){if(!this.activated)return;const{openTagView:e}=this.viewData;e&&this.closeTag(!0),this.viewData.setTagsToolState(E.p.CLOSED),this.activeBindings.forEach((e=>{e.cancel()})),this.activated=!1}onUpdate(){}registerHandlers(){const e=this.engine.commandBinder;this.activeBindings.push(this.viewData.onOpenTagViewChanged(this.onOpenTagViewChanged),e.addBinding(T.wZ,this.saveTagAppearance),e.addBinding(T.mt,this.togglePinAssetEditor)),this.registered=!0}in360View(){const e=this.sweepData.currentSweep?this.sweepData.currentSweep:"";return this.viewmodeData.isPano()&&this.sweepData.isSweepUnaligned(e)}async createEmbedAttachments(){const e=[];this.tagsData.iterate((t=>{e.push(this.createEmbedAttachment(t))})),Promise.all(e).then((()=>this.viewData.updateViewData()))}async createEmbedAttachment(e){if(e.mediaSrc&&e.mediaType!==c.z.none&&e.mediaType!==c.z.error){const t=e.mediaType;this.engine.commandBinder.issueCommand(new M.AS(e.sid,x.G.EXTERNAL,t,e.mediaSrc))}}closeTag(e=!1){const t=this.viewData,i=t.openTagView;i&&(this.engine.commandBinder.issueCommand(new M.xW(!1)),this.engine.broadcast(new m.A(i.id,u.Er.MATTERTAG)),this.engine.broadcast(new v.Ur)),t.setTagsToolState(E.p.IDLE),t.setOpenTagView(null),e||this.engine.commandBinder.issueCommand(new g.tT(f.w1.TAGS,!1))}displayTags(){this.viewData.getEnabledTagViews().forEach((e=>{this.updateTag(e)}))}updateTag(e){this.pinRenderer.updatePin(e.id,u.Er.MATTERTAG,e,this.backgroundTexture,this.maskTexture)}async openTag(e,t,i,n=-1){const{viewData:s,engine:r,log:o,pinRenderer:c}=this;await r.commandBinder.issueCommand(new g.tT(f.w1.TAGS,!0,!0));const d=s.getTagView(e);if(d){const o=s.openTagView,p=d.id===(null==o?void 0:o.id)&&s.selectedPreview;if(!o||o.id!==e||p){if(r.broadcast(new m.sD(d,u.Er.MATTERTAG,!1)),s.setOpenTagView(d,!1),!p){const e=null!==t?t:a.n.Instant;null!==e&&(c.hideSelectedMesh(),await r.commandBinder.issueCommand(new h.OR({pinPosition:d,transition:e})),c.showSelectedMesh(u.Er.MATTERTAG,d.id))}r.broadcast(new v.ZL(l.h.MATTERTAG,d.id))}let g=n;-1===g&&(g=s.getEnabledTagViews().values().findIndex((t=>t.id===e))),s.setListIndex(g);const f=d.attachments,b=i?f.find((e=>e.id===i)):void 0;if(i&&b&&(0,A.lV)(b)){const e=f.filter((e=>(0,A.lV)(e)));await r.commandBinder.issueCommand(new M.xW(!0,e,i))}else r.commandBinder.issueCommand(new y.rE)}else o.debug("Cannot open a non-existent tag")}}var C=i(91466);class TagDeletedMessage extends C.v{constructor(e){super(),this.id=e}}const I=TagsModule},39504:(e,t,i)=>{"use strict";i.d(t,{R:()=>n});const n="features/tag-annotations";Object.freeze({colors:["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#03687d","#03a9f4","#00bcd4","#417505","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"]})},23953:(e,t,i)=>{"use strict";i.d(t,{U:()=>Tool});var n=i(23573);class Tool extends n.T{constructor(e){super(),e&&Object.assign(this,e)}}},24151:(e,t,i)=>{"use strict";i.d(t,{t:()=>ToolsData});var n=i(32770),s=i(48715),r=i(64781),o=i(67799),a=i(79553);class ToolsData extends n.V{constructor(){super(),this.name="tools-data",this.tools=(0,r.q)(),this.toolsLoadedObservable=(0,s.Y)(!1),this.openAssetObservable=(0,s.Y)(null),this.activeToolOpen=!1,this.activeToolNameObservable=(0,s.Y)(null),this.openModalObservable=(0,s.Y)(null),this.toolAccessObservable=(0,s.Y)(a.X$.SCENE),this.panelLayoutObservable=(0,s.Y)((0,o.OR)()?a.wS.NORMAL:a.wS.NARROW),this.panelCollapsedObservable=(0,s.Y)(!1)}addTools(e){e.forEach((e=>{this.addTool(e)})),this.toolsLoadedObservable.value=!0}iterate(e){for(const t of this.tools)e(t)}get toolsMap(){return this.tools}getTool(e){return this.tools.get(e)}addTool(e){this.tools.set(e.id,e)}removeTool(e){this.tools.delete(e)}removeAllTools(){this.tools.clear(),this.toolsLoadedObservable.value=!1}get openAsset(){return this.openAssetObservable.value}setOpenAsset(e){this.openAssetObservable.value=e}onOpenAssetChanged(e){return this.openAssetObservable.onChanged(e)}getActiveTool(){return this.activeToolName?this.getTool(this.activeToolName):null}get activeToolName(){return this.activeToolNameObservable.value}get toolOpen(){return this.activeToolOpen}setActiveTool(e,t=!1){e===this.activeToolNameObservable.value&&this.activeToolOpen!==t?(this.activeToolOpen=t,this.activeToolNameObservable.setDirty()):(this.activeToolOpen=t,this.activeToolNameObservable.value=e)}onToolChanged(e){return this.activeToolNameObservable.onChanged(e)}get openModal(){return this.openModalObservable.value}setOpenModal(e){this.openModalObservable.value=e}onOpenModalChanged(e){return this.openModalObservable.onChanged(e)}onToolsLoadedChanged(e){return this.toolsLoadedObservable.onChanged(e)}get toolsLoaded(){return this.toolsLoadedObservable.value}get toolAccess(){return this.toolAccessObservable.value}setToolAccess(e){this.toolAccessObservable.value=e}onToolAssetAccessChanged(e){return this.toolAccessObservable.onChanged(e)}isPanelOpen(){return this.toolPanelLayout===a.wS.SIDE_PANEL||this.toolPanelLayout===a.wS.BOTTOM_PANEL}isPanelCollapsedToBottom(){return this.toolPanelLayout===a.wS.BOTTOM_PANEL&&this.panelCollapsed}setToolPanelLayout(e){this.panelLayoutObservable.value=e}get toolPanelLayout(){return this.panelLayoutObservable.value}onToolPanelLayoutChanged(e){return this.panelLayoutObservable.onChanged(e)}onPanelCollapsedChanged(e){return this.panelCollapsedObservable.onChanged(e)}setPanelCollapsed(e){this.panelCollapsedObservable.value=e}get panelCollapsed(){return this.panelCollapsedObservable.value}}},92532:(e,t,i)=>{"use strict";i.d(t,{EI:()=>OpenDrawerCommand,$M:()=>CloseDrawerCommand,zK:()=>PanelToggleCollapseCommand,$K:()=>OpenHighlightReelCommand,Cc:()=>OpenHlrSettingsCommand,tT:()=>ToggleToolCommand,Ye:()=>CloseAndRemoveToolsCommand,MV:()=>RegisterToolsCommand});var n=i(17386);class OpenDrawerCommand extends n.m{}OpenDrawerCommand.id="OPEN_DRAWER";class CloseDrawerCommand extends n.m{}CloseDrawerCommand.id="CLOSE_DRAWER";class PanelToggleCollapseCommand extends n.m{constructor(e){super(),this.payload={collapse:e}}}PanelToggleCollapseCommand.id="TOOL_PANEL_TOGGLE_COLLAPSE";class OpenHighlightReelCommand extends n.m{}OpenHighlightReelCommand.id="OPEN_HIGHLIGHT_REEL";class OpenHlrSettingsCommand extends n.m{constructor(){super(...arguments),this.id="OPEN_HLR_SETTINGS"}}class ToggleToolCommand extends n.m{constructor(e,t,i){super(),this.payload={tool:e,active:t,open:void 0===i?t:i}}}ToggleToolCommand.id="TOGGLE_TOOL";class CloseAndRemoveToolsCommand extends n.m{}CloseAndRemoveToolsCommand.id="CLOSE_REMOVE_TOOLS";class RegisterToolsCommand extends n.m{constructor(e){super(),this.payload={tools:e}}}RegisterToolsCommand.id="REGISTER_TOOLS"},79553:(e,t,i)=>{"use strict";var n,s,r;i.d(t,{w1:()=>n,wS:()=>s,X$:()=>r}),function(e){e.START_LOCATION="START_LOCATION",e.SCANS_3D="SCANS_3D",e.VIEW_360="VIEW_360",e.PHOTOS="PHOTOS",e.LABELS="LABELS",e.MEASUREMENTS="MEASUREMENTS",e.MATTERTAGS="MATTERTAGS",e.HLR="HLR",e.SETTINGS_PANEL="SETTINGS_PANEL",e.NOTES="NOTES",e.TAGS="TAGS",e.BLUR="BLUR",e.SEARCH="SEARCH"}(n||(n={})),function(e){e.NORMAL="normal",e.NARROW="narrow",e.SIDE_PANEL="side-panel",e.BOTTOM_PANEL="bottom-panel"}(s||(s={})),function(e){e.SCENE="scene",e.TOOL="tool",e.LIST="list"}(r||(r={}))},7562:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CloseAndRemoveToolsCommand:()=>h.Ye,CloseDrawerCommand:()=>h.$M,FullSizeEditorMessage:()=>d.Zi,OpenDrawerCommand:()=>h.EI,OpenHighlightReelCommand:()=>h.$K,OpenHlrSettingsCommand:()=>h.Cc,PanelCollapseMessage:()=>d.U7,PanelToggleCollapseCommand:()=>h.zK,PanelTransitionEndMessage:()=>d.rh,RegisterToolsCommand:()=>h.MV,ToggleToolCommand:()=>h.tT,ToggleViewingControlsMessage:()=>d.ps,Tool:()=>y.U,ToolAccess:()=>l.X$,ToolAssetClosedMessage:()=>d.Ur,ToolAssetOpenedMessage:()=>d.ZL,ToolPanelLayout:()=>l.wS,ToolToggledMessage:()=>d.Oj,Tools:()=>l.w1,ToolsData:()=>c.t,default:()=>b});var n=i(47724),s=i(736),r=i(23847),o=i(88512),a=i(21479),l=i(79553),c=i(24151);var h=i(92532),d=i(66157),u=i(89046),p=i(84842),m=i(67799),g=i(36016),f=i(8430),v=i(33874);class ToolsModule extends n.Y{constructor(){super(...arguments),this.name="tools-module",this.log=new o.Z(this.name),this.activeToolDurationMap={},this.resizeTimeout=0,this.bottomPanelHeight=0,this.sidePanelWidth=0,this.closeAndRemoveTools=async()=>{await this.closeActiveTool(null),this.toolsData.removeAllTools()},this.onAssetOpened=e=>{const{openAsset:t,toolPanelLayout:i}=this.toolsData;this.toolsData.setOpenAsset(e.assetType),i===l.wS.BOTTOM_PANEL&&!!e.assetType!=!!t&&this.adjustCanvasForPanel()},this.onAssetClosed=()=>{const{openAsset:e,toolPanelLayout:t}=this.toolsData;this.toolsData.setOpenAsset(null),t===l.wS.BOTTOM_PANEL&&e&&this.adjustCanvasForPanel()},this.onToggleModal=async e=>{this.toggleModal(e.modal,e.open)},this.closeModal=()=>{this.toolsData.openModal&&this.toggleModal(this.toolsData.openModal,!1)},this.onToggleTool=async e=>{const{tool:t,active:i,open:n}=e,s=this.toolsData,{activeToolName:r,openModal:o,toolPanelLayout:a,toolOpen:c}=s;if(!i&&t!==r)return;n||a!==l.wS.SIDE_PANEL||this.closePanel();const h=s.getActiveTool(),u=s.getTool(t),p=n&&u&&u.panel;if(i&&t===r)return void(c&&!n?s.setActiveTool(t,!1):p&&!s.isPanelOpen()&&this.openPanel());o&&this.toggleModal(o,!1);let m=null;h&&(m=h.analytic,await this.closeActiveTool(n?u:null));let g=m;if(i)if(u){u.panel&&n&&this.openPanel(),g=u.analytic;const{manager:e}=u;await e.activate(n),s.setActiveTool(t,n)}else this.log.error(`Tool not loaded: ${t}`);this.trackToolTime(m,g),this.engine.broadcast(new d.Oj(n,t))},this.updateLayoutSize=()=>{const e=this.toolsData.toolPanelLayout;let t=e;const i=(0,m.OR)();switch(e){case l.wS.NORMAL:i||(t=l.wS.NARROW);break;case l.wS.SIDE_PANEL:i||(t=l.wS.BOTTOM_PANEL);break;case l.wS.NARROW:i&&(t=l.wS.NORMAL);break;case l.wS.BOTTOM_PANEL:i&&(t=l.wS.SIDE_PANEL)}this.toolsData.setToolPanelLayout(t)},this.handlePanelCollapse=async e=>{const{collapse:t}=e;this.toolsData.setPanelCollapsed(t),t||this.toolsData.toolPanelLayout!==l.wS.BOTTOM_PANEL||this.closeModal(),this.adjustCanvasForPanel(),this.engine.broadcast(new d.U7(t))},this.adjustCanvasForPanel=()=>{const{toolPanelLayout:e,panelCollapsed:t,openAsset:i,openModal:n}=this.toolsData,{sidePanelWidth:s,bottomPanelHeight:r}=this,o=e!==l.wS.SIDE_PANEL||t?0:-m.LH,a=o!==s,c=e===l.wS.BOTTOM_PANEL&&i&&!n?-Math.floor(50*window.innerHeight/100):0,h=c!==r;window.clearTimeout(this.resizeTimeout);const d=a?o:void 0,u=h?c:void 0,p=0===d||0===u?0:500;this.resizeCanvas((0,g.hf)(d,u,p)),this.bottomPanelHeight=c,this.sidePanelWidth=o},this.resizeCanvas=async e=>{this.engine.commandBinder.issueCommand(new f.M(e))}}async init(e,t){this.engine=t,await t.getModuleBySymbol(s.y.SHOWCASE_ANALYTICS),this.analytics=await t.getModule(r.default),[this.settingsData,this.appData]=await Promise.all([t.market.waitForData(v.e),t.market.waitForData(a.pu)]),this.toolsData=new c.t,window.addEventListener("resize",this.updateLayoutSize),this.updateLayoutSize(),this.adjustCanvasForPanel(),this.bindings.push(t.commandBinder.addBinding(h.tT,this.onToggleTool),t.commandBinder.addBinding(u.Bz,this.onToggleModal),t.commandBinder.addBinding(u.rE,(async()=>this.closeModal())),t.commandBinder.addBinding(h.zK,this.handlePanelCollapse),t.subscribe(d.ZL,this.onAssetOpened),t.subscribe(d.Ur,this.onAssetClosed),this.toolsData.onToolPanelLayoutChanged(this.adjustCanvasForPanel),t.commandBinder.addBinding(h.Ye,this.closeAndRemoveTools),t.commandBinder.addBinding(h.MV,(async({tools:e})=>this.registerTools(...e)))),t.market.register(this,c.t,this.toolsData)}dispose(e){window.removeEventListener("resize",this.updateLayoutSize),e.market.unregister(this,c.t),this.closeActiveTool(null)}registerTools(...e){e.forEach((e=>{e.featureFlag&&this.bindings.push(this.settingsData.onPropertyChanged(e.featureFlag,(()=>this.updateEnabledTools())))})),this.toolsData.addTools(e)}async closeActiveTool(e){const t=this.toolsData,i=t.getActiveTool();if(i){const{manager:n}=i;await n.deactivate(),this.closeModal(),!t.toolOpen||!i.panel||e&&e.panel||this.closePanel(),e||t.setActiveTool(null)}}closePanel(){this.toolsData.setToolPanelLayout((0,m.OR)()?l.wS.NORMAL:l.wS.NARROW)}openPanel(){this.toolsData.setToolPanelLayout((0,m.OR)()?l.wS.SIDE_PANEL:l.wS.BOTTOM_PANEL)}toggleModal(e,t){const{openModal:i,toolPanelLayout:n}=this.toolsData;if(t&&i===e||!t&&e!==i)return;const s=e.toLowerCase(),r=this.appData.application===a.Mx.WORKSHOP?"workshop_gui":"showcase_gui";this.analytics.track(r,{gui_action:`open_${s}`,opened:t}),e&&this.analytics.track("modal_shown",{modal:e}),this.toolsData.setOpenModal(t?e:null),n===l.wS.BOTTOM_PANEL&&t!==!!i&&this.adjustCanvasForPanel(),this.engine.broadcast(new p.nV(e,t))}trackToolTime(e,t){if(t&&e!==t&&(this.activeToolDurationMap[t]=Date.now()),e){this.activeToolDurationMap[e]=Date.now()-this.activeToolDurationMap[e];const t={tool:`${e}_session_time`,duration:this.activeToolDurationMap[e]};this.analytics.track("tool_session_time",t)}}updateEnabledTools(){const e=this.toolsData.toolsMap;e.atomic((()=>{for(const t of e)if(t.featureFlag){const e=this.settingsData.tryGetProperty(t.featureFlag,!1);t.enabled!==e&&(t.enabled=e,t.commit())}}))}}var y=i(23953);const b=ToolsModule},66157:(e,t,i)=>{"use strict";i.d(t,{Oj:()=>ToolToggledMessage,ZL:()=>ToolAssetOpenedMessage,Ur:()=>ToolAssetClosedMessage,U7:()=>PanelCollapseMessage,Zi:()=>FullSizeEditorMessage,rh:()=>PanelTransitionEndMessage,ps:()=>ToggleViewingControlsMessage});var n=i(91466);class ToolToggledMessage extends n.v{constructor(e,t){super(),this.open=e,this.tool=t}}class ToolAssetOpenedMessage extends n.v{constructor(e,t){super(),this.assetType=e,this.assetId=t}}class ToolAssetClosedMessage extends n.v{}class PanelCollapseMessage extends n.v{constructor(e){super(),this.collapsed=e}}class FullSizeEditorMessage extends n.v{constructor(e){super(),this.fullSized=e}}class PanelTransitionEndMessage extends n.v{constructor(e,t){super(),this.active=e,this.collapsed=t}}class ToggleViewingControlsMessage extends n.v{constructor(e){super(),this.show=e}}},96216:(e,t,i)=>{"use strict";i.d(t,{TH:()=>TourStartCommand,vy:()=>TourStopCommand,rU:()=>TourStepCommand,HW:()=>TourRelativeCommand});var n=i(17386);class TourStartCommand extends n.m{constructor(e,t,i){super(),this.id="TOUR_START",this.payload={index:e,loop:t,steps:i}}}class TourStopCommand extends n.m{constructor(){super(...arguments),this.id="TOUR_STOP"}}class TourStepCommand extends n.m{constructor(e,t=!1){super(),this.id="TOUR_STEP",this.payload={index:e,instant:t}}}class TourRelativeCommand extends n.m{constructor(e,t=!1){super(),this.id="TOUR_RELATIVE",this.payload={forward:e,instant:t}}}},80191:(e,t,i)=>{"use strict";i.d(t,{z:()=>TourTransitionError,Y:()=>TourStartError});var n=i(31102);class TourTransitionError extends n.y{constructor(e="Invalid tour transition"){super(e),this.name="TourTransition"}}class TourStartError extends n.y{constructor(e="Cannot start tour"){super(e),this.name="TourStart"}}},52599:(e,t,i)=>{"use strict";var n,s,r;i.d(t,{BZ:()=>n,kw:()=>s,Aq:()=>r}),function(e){e[e.Pan=0]="Pan",e[e.PanDollhouse=1]="PanDollhouse",e[e.Zoom=2]="Zoom",e[e.Delay=3]="Delay",e[e.None=4]="None"}(n||(n={})),function(e){e[e.Left=1]="Left",e[e.Auto=0]="Auto",e[e.Right=-1]="Right"}(s||(s={})),function(e){e[e.Move=0]="Move",e[e.Burns=1]="Burns",e[e.Zoom=2]="Zoom",e[e.Path=3]="Path",e[e.FloorChange=4]="FloorChange",e[e.Delay=5]="Delay",e[e.Nop=6]="Nop"}(r||(r={}))},91302:(e,t,i)=>{"use strict";i.d(t,{oR:()=>TourStartedMessage,Vx:()=>TourSteppedMessage,NR:()=>TourStoppedMessage,Mt:()=>TourEndedMessage,sY:()=>TourStopAddedMessage,dW:()=>TourStartTransitionMessage});var n=i(91466);class TourStartedMessage extends n.v{}class TourSteppedMessage extends n.v{constructor(e){super(),this.index=e}}class TourStoppedMessage extends n.v{}class TourEndedMessage extends n.v{}class TourStopAddedMessage extends n.v{}class TourStartTransitionMessage extends n.v{}},77037:(e,t,i)=>{"use strict";i.d(t,{WQ:()=>r,EU:()=>o,OJ:()=>a,BY:()=>l,Im:()=>c,LO:()=>h,N5:()=>d,Qo:()=>u,Pv:()=>p,Mk:()=>m,mL:()=>g,eu:()=>f,NY:()=>v,gS:()=>y,O2:()=>b,rM:()=>S,z8:()=>E,f7:()=>w,Cp:()=>T,_D:()=>_,HJ:()=>M,BA:()=>x,pn:()=>A,z$:()=>O,b_:()=>P,mS:()=>D,su:()=>C,_c:()=>I,Xd:()=>L});var n=i(98828),s=i(93263);const r="TourSpeed &wts",o="ToursMetersPerSecond",a=.4,l=10,c=1.25,h=.8,d=6,u=3,p=1e3*h,m=1e3*c,g=600,f=400,v=1200,y=1200,b=35,S=15,E=120,w=1200,T=75,_=400,M=s.DEFAULT_TRANSITION_TIME-g,x=35,A=x/3500*1e3,O=2,P=52,D=0,C=.2*A,I=3500,L=Object.freeze({panAtSnapshot:n.h("kb",1),snapshotPanZoomDuration:n.h("st",3500),snapshotPanAngle:n.h("sspa",x),walkingTourIncludeExtraPanosDistance:.4,walkingStageMinimumDistance:.8,maxWalkingSweepsBetweenSnapshots:40,autoStartDelay:n.h("ts",-1)})},20601:(e,t,i)=>{"use strict";i.d(t,{HG:()=>o,JG:()=>a,mf:()=>l,DA:()=>c});var n=i(19674),s=i(7170),r=i(77037);const o=e=>{let t=r.Im;if(!isNaN(e)){const i=Math.min(Math.max(r.OJ,e),r.BY);t=(0,n.et)(i,r.OJ,r.BY,r.LO,r.Qo)}return t},a=e=>(0,n.et)(e,r.LO,r.N5,r.OJ,r.BY),l=e=>Math.min(Math.max(r.LO,e),r.N5),c=e=>(0,s.Id)(e)/1e3},69941:(e,t,i)=>{"use strict";i.d(t,{Vs:()=>n,k3:()=>TourData});var n,s,r=i(32770),o=i(52599);!function(e){e[e.Inactive=0]="Inactive",e[e.Active=1]="Active",e[e.StopScheduled=2]="StopScheduled"}(n||(n={})),function(e){e[e.Beginning=0]="Beginning",e[e.Current=1]="Current",e[e.End=2]="End"}(s||(s={}));class TourData extends r.V{constructor(e={},t,i,s,r){super(),this.snapshots=e,this.activeReel=t,this.allowedModes=i,this.modelSweeps=s,this.looping=r,this.name="tour",this.enabledTourStops=[],this.tourPlaying=!1,this.tourEnded=!1,this.updateEnabledStops=e=>{if(this.enabledTourStops=[],this.activeReel&&this.activeReel.reel)for(const t of this.activeReel.reel)if(t&&t.sid in this.snapshots){const i=this.snapshots[t.sid],n=i.metadata.cameraMode,s=i.metadata.scanId,r=-1!==e.indexOf(n),o=this.modelSweeps.findIndex((e=>e.id===s)),a=void 0!==s&&-1!==o&&this.modelSweeps[o].enabled,l=!s;r&&(l||a)&&this.enabledTourStops.push(t.sid)}},this.updateEnabledStops(i),this.tourState=n.Inactive,this.tourCurrentSnapshot=-1,this.transition={active:!1,type:o.Aq.Move,promise:Promise.resolve(),stop:()=>Promise.resolve(),toIndex:-1},this.looping=r,this.commit()}addSnapshotToTour(e,t=s.Current){this.snapshots[e.sid]=e;this.allowedModes.includes(e.metadata.cameraMode)&&this.enabledTourStops.push(e.sid);const i=this.tourCurrentSnapshotSid;switch(this.tourCurrentSnapshotSid=e.sid,t){case s.Beginning:this.tourCurrentSnapshot=0,this.activeReel.reel.insert(0,{sid:e.sid});break;case s.End:this.tourCurrentSnapshot=this.enabledTourStops.length-1,this.activeReel.reel.push({sid:e.sid});break;case s.Current:if(void 0===i)this.tourCurrentSnapshot=this.enabledTourStops.length-1,this.activeReel.reel.push({sid:e.sid});else{let t=this.activeReel.reel.findIndex((e=>!!e&&e.sid===i))+1;(t<=0||t>this.activeReel.reel.length)&&(t=this.activeReel.reel.length-1),this.tourCurrentSnapshot=this.tourCurrentSnapshot+1,this.activeReel.reel.insert(t,{sid:e.sid})}break;default:throw new Error(`Tours.addSnapshotToTour not implemented: ${t}`)}this.commit()}clearHighlightOverrides(e,t,i){if(!t&&!i)return;const n={};t&&(n.transitionType=void 0),i&&(n.panDirection=void 0,n.panAngle=void 0),this.applyHighlightOverrides(e,n)}clearAllHighlightOverrides(){this.getReel().reel.forEach((e=>{e&&this.clearHighlightOverrides(e.sid,!0,!0)}))}resetAllTransitionTypeOverrides(){if(this.activeReel&&this.activeReel.reel){let e=!1;this.activeReel.reel.forEach(((t,i)=>{t&&t.overrides&&t.overrides.transitionType&&(delete t.overrides.transitionType,this.activeReel.reel.update(i,t),e=!0)})),e&&this.activeReel.setDirty()}}resetAllPanSettingOverrides(){if(this.activeReel&&this.activeReel.reel){let e=!1;this.activeReel.reel.forEach(((t,i)=>{t&&t.overrides&&(void 0===t.overrides.panAngle&&void 0===t.overrides.panDirection||(delete t.overrides.panAngle,delete t.overrides.panDirection,e=!0,this.activeReel.reel.update(i,t)))})),e&&this.activeReel.setDirty()}}applyHighlightOverrides(e,t){const i=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e));this.setHighlightOverrides(i,t)}setHighlightOverrides(e,t){const i=this.activeReel.reel.get(e);if(!i)throw Error(`Highlight not found for ${e}`);const n={sid:i.sid};i.overrides?(n.overrides=Object.assign({},i.overrides),t.hasOwnProperty("panDirection")&&(n.overrides.panDirection=t.panDirection),t.hasOwnProperty("transitionType")&&(n.overrides.transitionType=t.transitionType),t.hasOwnProperty("panAngle")&&(n.overrides.panAngle=t.panAngle)):n.overrides={transitionType:t.transitionType,panDirection:t.panDirection,panAngle:t.panAngle},this.activeReel.reel.update(e,n)}moveTourStop(e,t){const i=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e)),n=this.activeReel.reel.findIndex((e=>!!e&&e.sid===t));this.activeReel.reel.move(i,n)}clear(){this.resetEmptyReel(),this.enabledTourStops.length=0,this.activeReel.reel.length=0,this.commit()}removeTourStop(e){const t=this.enabledTourStops.indexOf(e),i=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e)),n=this.getTourIndexBySid(e);if(-1!==t&&this.enabledTourStops.splice(t,1),this.enabledTourStops.length>0){const e=n<=this.tourCurrentSnapshot?this.tourCurrentSnapshot-1:this.tourCurrentSnapshot;this.setTourCurrentSnapshotByIndex(Math.max(e,0))}else this.resetEmptyReel();this.activeReel.reel.remove(i)}getReel(){return this.activeReel}isLooping(){return this.looping}isTourActive(){return this.tourState!==n.Inactive}getCurrentTourState(){return{currentStep:this.getTourCurrentSnapshotIndex(),tourPlaying:this.tourPlaying,totalSteps:this.getSnapshotCount(),tourEnded:this.tourEnded,activeStep:this.transition&&-1!==this.transition.toIndex?this.transition.toIndex:this.getTourCurrentSnapshotIndex(),highlights:this.getReelHighlights(),transition:this.transition}}isTourTransitionActive(){return this.transition.active}getTourTransitionType(){return this.transition.type}useTransition(e){this.transition=e}setTourTransitionToIndex(e){this.transition.toIndex=e}async stopTourTransition(){await this.transition.stop()}iterateSnapshots(e){let t=0;this.activeReel.reel.forEach((i=>{if(i&&this.isEnabled(i.sid)){const n=this.snapshots[i.sid];e(n,t++)}}))}isSnapshotInTour(e){return-1!==this.activeReel.reel.findIndex((t=>!!t&&t.sid===e))}getEnabledSnapshots(){const e=[];return this.iterateSnapshots(((t,i)=>{e.push(t)})),e}updateSnapshots(e){this.snapshots=e}async getPhotosForTour(){const e=[];for(const t in this.snapshots){const i=this.snapshots[t];"tour"!==i.category&&"panorama"!==i.category&&e.push({name:i.name,sid:i.sid,thumbnailUrl:await i.thumbnailUrl.get(),inReel:-1!==this.activeReel.reel.findIndex((e=>!!e&&e.sid===t)),created:i.created})}return e.sort(((e,t)=>t.created.getTime()-e.created.getTime())),e}getSnapshot(e){return this.snapshots[e]}getHighlightDescription(e){const t=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e)),i=this.activeReel.reel.get(t);return{snapshot:this.getSnapshot(e),reelEntry:i}}getReelHighlights(){const e=[];return this.activeReel.reel.forEach((t=>{if(t&&this.isEnabled(t.sid)){const i=this.snapshots[t.sid];e.push({sid:i.sid,snapshot:i,panDirection:t.overrides&&t.overrides.panDirection,panAngle:t.overrides&&t.overrides.panAngle,transitionType:t.overrides&&t.overrides.transitionType})}})),e}getSnapshotCount(){return this.enabledTourStops.length}getTourState(){return this.tourState}setTourState(e){this.tourState=e}getTourCurrentSnapshotIndex(){return this.tourCurrentSnapshot}getTourCurrentSnapshotSid(){return this.tourCurrentSnapshotSid}getTourSnapshotSid(e){let t=0;for(const i of this.activeReel.reel)if(i&&this.isEnabled(i.sid)){if(t===e)return i.sid;t++}throw new Error("getTourSnapshotSid() -> Invalid snapshot index.")}getTourSnapshotsWithSweepId(e){const t=[];for(const i of this.activeReel.reel)i&&i.sid in this.snapshots&&this.snapshots[i.sid].metadata.scanId===e&&t.push(i.sid);return t}setTourCurrentSnapshotByIndex(e){if(e<0||e>this.getSnapshotCount())throw new Error("setTourCurrentSnapshotByIndex() -> Invalid tour index.");let t=-1;for(const i of this.activeReel.reel)if(i&&this.isEnabled(i.sid)&&(t++,t===e)){this.tourCurrentSnapshot=e,this.tourCurrentSnapshotSid=i.sid;break}-1===t&&this.resetEmptyReel(),this.setTourTransitionToIndex(-1),this.commit()}getTourIndexBySid(e){let t=-1;for(const i of this.activeReel.reel)if(i&&this.isEnabled(i.sid)&&(t++,i.sid===e))return t;return-1}isEnabled(e){return-1!==this.enabledTourStops.indexOf(e)}resetEmptyReel(){this.tourCurrentSnapshot=-1,this.tourCurrentSnapshotSid=void 0,this.setTourTransitionToIndex(-1),this.commit()}}},76236:(e,t,i)=>{"use strict";i.d(t,{F:()=>DeletedObject});var n=i(23573),s=i(10757);class DeletedObject extends n.T{constructor(e){super(),this.id=(0,s.O1)(11),e&&Object.assign(this,e)}}},93673:(e,t,i)=>{"use strict";i.d(t,{B:()=>RegisterDeletedObjectTypeCommand,p:()=>RestoreDeletedObjectCommand});var n=i(17386);class RegisterDeletedObjectTypeCommand extends n.m{constructor(e){super(),this.id="REGISTER_DELETED_OBJECT_TYPE_COMMAND",this.payload=e}}class RestoreDeletedObjectCommand extends n.m{constructor(e){super(),this.id="RESTORE_DELETED_OBJECT_COMMAND",this.payload={id:e}}}},81347:(e,t,i)=>{"use strict";i.d(t,{m:()=>UserData});var n=i(32770),s=i(64781),r=i(88172),o=i(61481),a=i(80161),l=i(49747);class UserData extends n.V{constructor(e,t,i,n=[]){super(),this.orgAdmin=i,this.policies=n,this.name="users-data",this.users=(0,s.q)();const l=e.modelAccess||a.x.PUBLIC;this.currentUser=new r.a(Object.assign(Object.assign({},e),{modelAccess:l,userStatus:t?o.J.KNOWN:o.J.UNKNOWN})),this.addUser(this.currentUser)}loadSearchResults(e,t,i){this.atomic((()=>{e.forEach((e=>{this.loadUser(Object.assign(Object.assign({},e),{userStatus:o.J.KNOWN}))})),t.forEach((e=>{this.users.get(e)||this.loadUser({email:e,id:"",userStatus:i})}))}))}loadKnownUsers(e){this.atomic((()=>{e.forEach((e=>{this.loadKnownUser(e)}))}))}loadKnownUser(e){return this.loadUser(Object.assign(Object.assign({},e),{userStatus:o.J.KNOWN}))}loadContributor(e){const t=this.users.get(e.email);return t||this.loadUser(Object.assign(Object.assign({},e),{userStatus:o.J.CONTRIBUTOR}))}loadFailedUser(e){return this.loadUser(Object.assign(Object.assign({},e),{userStatus:o.J.FAILED}))}loadUser(e){let t=this.users.get(e.email);return e.email===this.currentUser.email||t&&t.userStatus===o.J.KNOWN&&t.modelAccess!==a.x.PUBLIC||(t=new r.a(e),t?this.users.set(e.email,t):this.addUser(t)),t}getUserInfoByEmail(e){return this.users.has(e)?this.users.get(e):null}getUserInfoById(e){return""===e?null:this.users.values.find((t=>t.id===e))||null}getUserDisplay(e){return this.users.has(e)?this.users.get(e):(0,l.Q)(e)}iterate(e){for(const t of this.users)e(t)}getUsersWhoMayNeedAccess(){const e={};return this.users.values.forEach((t=>{t.userStatus===o.J.KNOWN&&t.modelAccess!==a.x.PUBLIC||(e[t.email]=t)})),e}getKnownUsers(){return this.users.values.filter((e=>e.userStatus===o.J.KNOWN))}addUser(e){this.users.has(e.email)||this.users.set(e.email,e)}getCurrentUser(){return this.currentUser}isLoggedIn(){return!!this.currentUser.id}isPolicyFlagEnabled(e){return this.policies.includes(e)}isOrgAdmin(){return this.orgAdmin}isInviter(){return this.orgAdmin}isEditor(){return this.currentUser.modelAccess===a.x.FULL}isCommenter(){const{modelAccess:e}=this.currentUser;return e===a.x.FULL}getCurrentUserId(){return this.currentUser.id}onUsersChanged(e){return this.users.onChanged(e)}}},88172:(e,t,i)=>{"use strict";i.d(t,{a:()=>UserInfo});var n=i(61481),s=i(80161),r=i(49747);class UserInfo{constructor(e){this.email="",this.id="",this.firstName="",this.lastName="",this.modelAccess=s.x.PUBLIC,this.userStatus=n.J.UNKNOWN,this.name="",this.initials="",this.color="",e&&Object.assign(this,e);const t=this.id?this.getFullName(this.firstName,this.lastName):"";this.name=t||this.email||"",this.initials=this.getInitials(this.name),this.color=(0,r._)(this.id)}getFullName(e,t){return e&&t?`${e} ${t}`:e||t}getInitials(e){const t=e?e.split(" ").map((e=>e[0])).join(""):"?";return t.length<3?t:`${t[0]}${t[t.length-1]}`}}},7683:(e,t,i)=>{"use strict";i.d(t,{V1:()=>UserMentionSearchCommand,Vu:()=>ResolveUserMentionsCommand,JB:()=>InviteUsersCommand});var n=i(17386);class UserMentionSearchCommand extends n.m{constructor(e){super(),this.payload={search:e}}}class ResolveUserMentionsCommand extends n.m{constructor(e){super(),this.payload={userMentions:e}}}class InviteUsersCommand extends n.m{constructor(e,t,i,n){super(),this.payload={emails:e,message:t,modelAccess:i,noteId:n}}}},61481:(e,t,i)=>{"use strict";var n;i.d(t,{J:()=>n}),function(e){e.UNKNOWN="unknown",e.FAILED="failed",e.MENTIONED="mentioned",e.CONTRIBUTOR="contributor",e.KNOWN="known"}(n||(n={}))},54791:(e,t,i)=>{"use strict";i.r(t),i.d(t,{InviteUsersCommand:()=>m.JB,OrgUser:()=>OrgUser,ResolveUserMentionsCommand:()=>m.Vu,UserData:()=>p.m,UserInfo:()=>v.a,UserMentionSearchCommand:()=>m.V1,UserStatus:()=>u.J,default:()=>y,defaultUserColor:()=>f._,getUnknownUserInfo:()=>f.Q});var n=i(47724),s=i(88512),r=i(94474),o=i(71918),a=i(80161);class OrgUser{constructor(e){this.id="",this.email="",this.firstName="",this.lastName="",this.modelAccess=a.x.PUBLIC,Object.assign(this,e)}}const l=new s.Z("mds-user-deserializer");class MdsUserDeserializer{constructor(){this.validate=e=>{if(!e)return!1;const t=["id","email"].filter((t=>!(t in e))),i=0===t.length;return i||l.debug("OrgUserMetadata invalid:",{missingFields:t}),i}}deserialize(e){return e&&this.validate(e)?new OrgUser(e):(l.debug("Deserialized invalid OrgUserMetadata from MDS",e),null)}}var c=i(11820);const h=new s.Z("users-store");class MdsUserStore extends r.u{constructor(e){super(e),this.deserializer=new MdsUserDeserializer}async fetchAccessForUser(e){const t=this.getViewId();return this.query(c.GetCurrentUserModelAccess,{modelId:t,userId:e}).then((t=>{const i=(0,o.qw)(t,"data.model.policies"),n=(null==i?void 0:i.map((e=>e.name)))||[],s=(0,o.qw)(t,"data.model.users.results");let r;return s&&Array.isArray(s)&&1===s.length?r=s[0].modelAccess:(h.debug(`fetchModelAccess failed for ${e}`),r=a.x.PUBLIC),{policies:n,modelAccess:r}}))}async search(e,t,i){const n=this.getViewId();return this.query(c.GetUsers,{modelId:n,search:e,ids:i,emails:t}).then((e=>{const t=(0,o.qw)(e,"data.model.users.results");if(!t||!Array.isArray(t))return[];const i=[];for(const e of t){const t=this.deserializer.deserialize(e);t&&i.push(t)}return i}))}}var d=i(38420),u=i(61481),p=i(81347),m=i(7683);const g=new s.Z("users-module");class Users extends n.Y{constructor(){super(...arguments),this.name="users-module",this.store=null,this.onUserMentionSearch=async e=>{if(!this.store)return void g.error("No MDS user store");const t=await this.store.search(e.search);this.userData.loadKnownUsers(t)},this.resolveUserMentions=async e=>{if(0===e.userMentions.length)return void g.debug("No user mentions to resolve");const t=[];if(e.userMentions.forEach((e=>{this.userData.getUserInfoByEmail(e.email)&&e.userStatus!==u.J.MENTIONED||t.push(e)})),t.length>0){const e=t.map((e=>e.email));return this.searchUsers(new Set(e),u.J.MENTIONED)}},this.inviteUsers=async e=>{const{emails:t,modelAccess:i,message:n,noteId:s}=e;if(0===t.length)return;const{baseUrl:r,modelId:o,queue:a}=this.config,l=`${r}/api/v2/shares/`,c={object_type:"model",object_id:o,role:i,inviter_message:n,note:s},h=new Set;return await Promise.all(e.emails.map((e=>a.post(l,{responseType:"json",body:Object.assign(Object.assign({},c),{email:e})}).then((e=>{const t=e.user;this.userData.loadKnownUser({id:t.sid,email:t.email,firstName:t.first_name,lastName:t.last_name,modelAccess:e.role})})).catch((()=>{g.debug(`User Invite failed: ${e}`),h.add(e)}))))),h.size>0?this.searchUsers(h,u.J.FAILED):void 0}}async init(e,t){this.config=e,e.storageProvider===d.Xq.MDS&&(this.store=new MdsUserStore({readonly:!0,baseUrl:e.baseUrl,viewId:e.modelId}));const i=e.api.user;let n=a.x.PUBLIC,s=[],r=!1;if(i.loggedIn&&i.id&&this.store){const t=await this.store.fetchAccessForUser(i.id);n=t.modelAccess,s=t.policies,e.organizationId&&(r=i.isOrganizationAdmin(e.organizationId))}this.userData=new p.m({id:i.id,firstName:i.firstName,lastName:i.lastName,email:i.email,modelAccess:n},i.loggedIn,r,s),this.bindings.push(t.commandBinder.addBinding(m.V1,this.onUserMentionSearch),t.commandBinder.addBinding(m.Vu,this.resolveUserMentions),t.commandBinder.addBinding(m.JB,this.inviteUsers)),t.market.register(this,p.m,this.userData)}async searchUsers(e,t){if(!this.store)return;const i=Array.from(e),n=await this.store.search(void 0,i);this.userData.loadSearchResults(n,i,t)}isPolicyFlagEnabled(e){return this.userData.isPolicyFlagEnabled(e)}}var f=i(49747),v=i(88172);const y=Users},49747:(e,t,i)=>{"use strict";i.d(t,{_:()=>a,Q:()=>l});var n=i(84933),s=i(61481),r=i(80161);const o=["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#5c7fff","#03a9f4","#417505","#00bcd4","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"];function a(e){const t=o.length;return o[(0,n.W)(e||"",t)]}function l(e){return{email:e,id:"",firstName:"",lastName:"",name:"Unknown",initials:"?",color:a(e),userStatus:s.J.UNKNOWN,modelAccess:r.x.PUBLIC}}},3805:(e,t,i)=>{"use strict";i.d(t,{BD:()=>n,g:()=>a,KP:()=>l,ty:()=>c,_i:()=>ChangeViewmodeCommand});var n,s=i(17386),r=i(94329),o=i(31278);!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(n||(n={}));const a=n.INSIDE,l=(n.INSIDE,r.Ey.Panorama,n.DOLLHOUSE,r.Ey.Dollhouse,n.FLOORPLAN,r.Ey.Floorplan,n.TRANSITIONING,r.Ey.Transition,n.OUTSIDE,r.Ey.Outdoor,{[r.Ey.Panorama]:n.INSIDE,[r.Ey.Dollhouse]:n.DOLLHOUSE,[r.Ey.Floorplan]:n.FLOORPLAN,[r.Ey.Transition]:n.TRANSITIONING,[r.Ey.Outdoor]:n.OUTSIDE}),c=e=>{const t=l[e];return void 0!==t?t:n.OUTSIDE};class ChangeViewmodeCommand extends s.m{constructor(e,t=o.n.Interpolate,i={}){super(),this.payload={mode:e,transitionType:t,pose:i}}}ChangeViewmodeCommand.id="CHANGE_VIEWMODE"},11426:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ViewmodeChange});var n=i(3248),s=i(47724),r=i(3805),o=i(93263),a=i(33874),l=i(94329),c=i(31278),h=i(67027),d=i(12216),u=i(2212),p=i(69626),m=i(75892),g=i(51263),f=i(57051),v=i(59088),y=i(29422),b=i(21479),S=i(8150),E=i(35597),w=i(18469),T=i(27326),_=i(736);class ViewmodeChange extends s.Y{constructor(){super(...arguments),this.name="viewmode-change",this.dhDisabled=()=>!1,this.fpDisabled=()=>!1}async init(e,t){this.engine=t,this.viewmodesModule=await t.getModule(o.default),this.bindings.push(t.subscribe(S.bS,(e=>this.setEnabledModes(e.application))),t.commandBinder.addBinding(r._i,this.onChangeViewmodeCommand.bind(this))),Promise.all([t.market.waitForData(b.pu),t.market.waitForData(a.e)]).then((([e,t])=>{this.settings=t,this.setEnabledModes(e.application)}))}async setEnabledModes(e){if(e===b.Mx.SHOWCASE){if(this.dhDisabled=()=>this.settings.checkUrlParam("dh",0,1)||!this.settings.tryGetProperty(n.gx.Dollhouse,!1),this.fpDisabled=()=>this.settings.checkUrlParam("fp",0,1)||!this.settings.tryGetProperty(n.gx.FloorPlan,!1),!this.previousApp)return;const e=(await this.engine.market.waitForData(E.O)).currentMode;if(e===l.Ey.Dollhouse&&this.dhDisabled()||e===l.Ey.Floorplan&&this.fpDisabled()){const e=(await this.engine.market.waitForData(w.O)).pose;if(e&&e.mode===l.Ey.Panorama)this.goToInsideMode(c.n.Interpolate,{position:e.camera.position});else{const e=(await this.engine.market.waitForData(v.M_)).pose,t=(await this.engine.market.waitForData(m.Z)).getClosestSweep(e.position,!0),i=t?{position:t.position}:void 0;this.goToInsideMode(c.n.Interpolate,i)}}}else e===b.Mx.WORKSHOP&&(this.dhDisabled=()=>!1,this.fpDisabled=()=>!1);this.previousApp=e}async onChangeViewmodeCommand(e){switch(e.mode){case r.BD.INSIDE:return this.goToInsideMode(e.transitionType,e.pose);case r.BD.DOLLHOUSE:return this.goToDollhouse(e.transitionType,e.pose);case r.BD.FLOORPLAN:return this.goToFloorplan(e.transitionType,e.pose)}return Promise.reject(`viewmode-change => Could not move to ${e.mode}`)}async goToInsideMode(e=c.n.Interpolate,t={}){const i=this.engine.market.tryGetData(m.Z);if(!i)return Promise.reject("Cannot go to inside mode");let n=t.sweepID||i.currentSweep;if(n||(n=await this.getLookAtSweep(i)),i.isSweepUnaligned(n)){const e=i.getFirstAlignedSweep();n=e?e.id:this.getFirstSweepId(i)}return this.viewmodesModule.currentMode===l.Ey.Panorama&&i.isSweepUnaligned(i.currentSweep)?this.engine.commandBinder.issueCommand(new y.ju({sweep:n,rotation:t.rotation,transition:c.n.FadeToBlack})):this.viewmodesModule.switchToMode(l.Ey.Panorama,e,{sweepID:n,rotation:t.rotation},o.DEFAULT_TRANSITION_TIME)}async getLookAtSweep(e){const t=this.engine.market.tryGetData(v.M_);if(!t)return this.getFirstSweepId(e);const i=this.engine.market.tryGetData(T.c),n=(null==i?void 0:i.getFloorMin())||this.getModelMinHeight(),s=new u.Plane(d.f.DOWN,n),r=(0,p.Fe)(t.pose.position,t.pose.rotation,s);if(!r)return this.getFirstSweepId(e);const o=[g._T(),g._k(),e=>!i||i.isCurrentOrAllFloors(e.floorId)],a=[f.l0(r)],l=e.sortByScore(o,a).shift();if(l)return l.sweep.id;const c=e.getClosestSweep(r,!0);return c?c.id:this.getFirstSweepId(e)}getFirstSweepId(e){const t=e.getFirstSweep();if(void 0===t)throw new Error("First enabled sweep not found");return t.id}getModelMinHeight(){return this.meshData||(this.meshData=this.engine.market.tryGetData(h._)),this.meshData?this.meshData.bounds.min.y:0}async goToDollhouse(e=c.n.Interpolate,t={}){return this.dhDisabled()?Promise.reject("Cannot go to dollhouse mode"):this.viewmodesModule.switchToMode(l.Ey.Dollhouse,e,t)}async goToFloorplan(e=c.n.Interpolate,t={}){if(this.fpDisabled())return Promise.reject("Cannot go to floorplan mode");const i=await this.engine.getModuleBySymbol(_.y.CANVAS);return i&&await i.getTransitionPromise(),this.viewmodesModule.switchToMode(l.Ey.Floorplan,e,t)}}},36297:(e,t,i)=>{"use strict";i.d(t,{M:()=>LockViewmodeCommand,I:()=>UnlockViewmodeCommand});var n=i(17386);class LockViewmodeCommand extends n.m{constructor(){super()}}LockViewmodeCommand.id="LOCK_VIEWMODE";class UnlockViewmodeCommand extends n.m{constructor(){super()}}UnlockViewmodeCommand.id="UNLOCK_VIEWMODE"},68576:(e,t,i)=>{"use strict";i.d(t,{Z:()=>BeginSwitchViewmodeMessage});var n=i(35015);class BeginSwitchViewmodeMessage extends n.a{}},88814:(e,t,i)=>{"use strict";i.d(t,{Z:()=>EndSwitchViewmodeMessage});var n=i(35015);class EndSwitchViewmodeMessage extends n.a{}},35015:(e,t,i)=>{"use strict";i.d(t,{a:()=>SwitchViewmodeMessage});var n=i(91466);class SwitchViewmodeMessage extends n.v{constructor(e,t){super(),this.fromMode=t,this.toMode=e,this.timestamp=Date.now()}}},94329:(e,t,i)=>{"use strict";i.d(t,{Ey:()=>n,tU:()=>a,Lm:()=>o,Ae:()=>r});var n,s=i(31102);class ViewmodeConvertException extends s.y{constructor(e,t){super(e),this.mode=t}}!function(e){e[e.Panorama=1]="Panorama",e[e.Dollhouse=2]="Dollhouse",e[e.Floorplan=3]="Floorplan",e[e.Outdoor=4]="Outdoor",e[e.Transition=-1]="Transition"}(n||(n={}));const r=e=>{switch(e){case n.Panorama:return"Panorama";case n.Floorplan:return"Floorplan";case n.Dollhouse:return"Dollhouse";case n.Transition:return"Transition"}return"Unknown"},o=e=>{switch(e){case"0":case 0:return n.Panorama;case"1":case 1:return n.Floorplan;case"2":case 2:return n.Dollhouse;case"3":case 3:return n.Transition}throw new ViewmodeConvertException("No known conversion for Workshop int to viewmode for int: "+e,e)};function a(e){switch(e){case n.Panorama:return 0;case n.Floorplan:return 1;case n.Dollhouse:return 2;case n.Transition:return 3}throw new ViewmodeConvertException("No known conversion for Viewmode to Workshop int",e)}},35597:(e,t,i)=>{"use strict";i.d(t,{O:()=>ViewmodeData});var n=i(32770),s=i(94329),r=i(48715);class ViewmodeData extends n.V{constructor(){super(),this.name="viewmode",this.viewmodeChangeEnabled=!0,this.currentModeObservable=(0,r.Y)(null),this.transition={active:!1,progress:0,from:null,to:null,startTime:0,transitionTime:0},this.isFloorplan=this.isFloorplan.bind(this),this.isPano=this.isPano.bind(this),this.isDollhouse=this.isDollhouse.bind(this)}get currentMode(){return this.currentModeObservable.value}set currentMode(e){e!==this.currentModeObservable.value&&(this.currentModeObservable.value=e)}get closestMode(){return this.currentMode===s.Ey.Transition?this.transition.progress<.5?this.transition.from:this.transition.to:this.currentMode}makeModeChangeSubscription(e){return this.currentModeObservable.onChanged(e)}activateTransition(e,t,i){this.transition.active=!0,this.transition.progress=0,this.transition.startTime=Date.now(),this.transition.transitionTime=i,this.transition.to=t,this.transition.from=e}deactivateTransition(){this.transition.active=!1}isPano(){return this.currentMode===s.Ey.Panorama}isFloorplan(){return this.currentMode===s.Ey.Floorplan}isDollhouse(){return this.currentMode===s.Ey.Dollhouse}canStartTransition(){const e=this.transition.active,t=this.currentMode===s.Ey.Transition;return!e&&!t}transitionActive(){return!this.canStartTransition()}isAlreadyInMode(e){const t=this.transition.from===this.transition.to,i=this.currentMode===e;return this.transition.active&&t||i}canSwitchViewMode(e){return this.canStartTransition()&&!this.isAlreadyInMode(e)}}},93263:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DEFAULT_TRANSITION_TIME:()=>P,default:()=>ViewmodeModule});var n=i(736),s=i(94329),r=i(31278),o=i(2212),a=i(12216),l=i(63560),c=i(47724),h=i(35597),d=i(77719),u=i(59088),p=i(56656),m=i(75892),g=i(88814),f=i(68576),v=i(35015),y=i(31102);class ViewmodeActiveTransitionError extends y.y{constructor(e="Tried to start view-mode transition while another transition was active"){super(e),this.name="ViewmodeActiveTransition"}}class ViewmodeChangeLockedError extends y.y{constructor(e="Cannot change viewmode when locked"){super(e),this.name="ViewmodeChangeLockedError"}}var b=i(69626);var S=i(40168),E=i(36371),w=i(79437);const T={rotationDuration:1,rotationDelay:0,matrixDelay:0,matrixDuration:.5},_={[s.Ey.Dollhouse]:{matrixDelay:.5,matrixDuration:1},[s.Ey.Panorama]:{rotationDuration:.5}};var M=i(88512),x=i(67027),A=i(36297);const O=new M.Z("viewmodes-data"),P=1e3,D=Math.PI/2+Number.EPSILON,C=Math.PI-Number.EPSILON,I={[s.Ey.Panorama]:P,[s.Ey.Dollhouse]:P,[s.Ey.Floorplan]:P};class ViewmodeModule extends c.Y{constructor(){super(...arguments),this.viewmodeData=new h.O,this.name="viewmode",this.minDollhouseDistance=15,this.maxDollhouseDistance=50,this.getFlyinStartPose=(e,t)=>{const i=t||this.cameraData.pose.position,n=e.position.y-i.y,s=(0,b.Ll)(e.position,i,this.meshData.center),r=a.f.FORWARD.clone().applyQuaternion(s);return{position:(0,b.D7)(e.position,i,Math.sign(r.y)*Math.PI/4,!0).setY(1.5*n)}},this.getFlyinEndPose=e=>{const t=e.position||this.sweepData.getSweep(e.sweepID).position,i=e.rotation||new o.Quaternion,n=Math.PI/180*l.oR.fov;return(0,b.YN)(t,i,-Math.PI/6,this.meshData.bounds,n,this.canvas.aspectRatio)}}async init(e,t){this.engine=t,this.market=t.market,null!==e.startingMode&&(this.viewmodeData.currentMode=e.startingMode),this.market.register(this,h.O,this.viewmodeData),t.market.waitForData(x._).then((e=>{this.meshData=e,this.setDollhouseBounds()})),this.bindings.push(t.commandBinder.addBinding(A.M,this.lockViewmode.bind(this)),t.commandBinder.addBinding(A.I,this.unlockViewmode.bind(this)));const[i,n,s,r,o]=await Promise.all([t.getModule(d.default),t.getModule(p.default),t.market.waitForData(m.Z),t.market.waitForData(S.W),t.market.waitForData(u.M_)]);this.cameraModule=i,this.sweepModule=n,this.sweepData=s,this.canvas=r,this.cameraData=o}lockViewmode(){this.viewmodeData.viewmodeChangeEnabled=!1,this.viewmodeData.commit()}unlockViewmode(){this.viewmodeData.viewmodeChangeEnabled=!0,this.viewmodeData.commit()}get currentMode(){return this.viewmodeData.currentMode}async switchToMode(e,t=r.n.FadeToBlack,i,o){if(O.info(`switchToMode mode:${e} type:${t}`),this.meshData||e!==s.Ey.Floorplan&&e!==s.Ey.Dollhouse||await this.engine.getModuleBySymbol(n.y.MODEL_MESH),t===r.n.Instant&&(o=0),o=void 0!==o?o:I[e],!this.viewmodeData.canStartTransition()||!this.cameraData.canTransition())throw new ViewmodeActiveTransitionError;if(!this.viewmodeData.viewmodeChangeEnabled)throw new ViewmodeChangeLockedError;const a=this.isAlreadyInMode(this.viewmodeData,e),l=i&&!ViewmodeModule.willPoseChange(this.cameraData,i);if(a&&l)return Promise.resolve();this.sweepData.currentSweep&&this.sweepData.isSweepUnaligned(this.sweepData.currentSweep)&&e!==s.Ey.Panorama&&(t=r.n.FadeToBlack);const c=null!==this.viewmodeData.currentMode?this.viewmodeData.currentMode:void 0;this.viewmodeData.activateTransition(this.viewmodeData.currentMode,e,o),this.viewmodeData.currentMode=s.Ey.Transition,this.viewmodeData.commit(),this.engine.broadcast(new f.Z(e,c));const h=this.moveCameraToViewmode(e,c,t,o,i);let d=!1;return h.progress((t=>{this.viewmodeData.transition.progress=t,this.viewmodeData.commit(),t>=.5&&!d&&(d=!0,this.engine.broadcast(new v.a(e,c)))})),h.then((()=>{this.viewmodeData.transition.progress=1,this.viewmodeData.currentMode=e,this.viewmodeData.deactivateTransition(),this.viewmodeData.commit(),this.engine.broadcast(new g.Z(e,c))})),h.nativePromise()}isAlreadyInMode(e,t){const i=e.transition.from===e.transition.to,n=e.currentMode===t;return e.transition.active&&i||n}static willPoseChange(e,t){return void 0!==t.position&&!e.pose.position.equals(t.position)||void 0!==t.rotation&&!e.pose.rotation.equals(t.rotation)||void 0!==t.zoom&&e.zoom()!==t.zoom}moveCameraToViewmode(e,t,i,n,r){switch(e){case s.Ey.Panorama:return this.moveCameraToPanorama(i,n,r);case s.Ey.Dollhouse:return this.moveCameraToDollhouse(t,i,n,r);case s.Ey.Floorplan:return this.moveCameraToFloorplan(t,i,n,r);default:throw Error(`moveCameraToViewmode(): Invalid view-mode to go to: ${e}`)}}moveCameraToPanorama(e,t,i){if(this.sweepData.canTransition()||this.cameraData.canTransition()){let n;if(i&&i.sweepID)n=i.sweepID;else{const e=this.sweepData.getFirstSweep();n=this.sweepData.currentSweep,!n&&e&&(n=e.id)}if(!n)throw new Error("moveCameraToPanorama(): Invalid target sweep!");this.sweepData.isSweepUnaligned(n)&&(e=r.n.FadeToBlack);let l=i&&i.rotation?i.rotation:void 0;if(!l){const e=(this.viewmodeData.transition.from===s.Ey.Floorplan?a.f.UP:a.f.FORWARD).clone().applyQuaternion(this.cameraData.pose.rotation).setY(0).normalize();l=(new o.Quaternion).setFromUnitVectors(a.f.FORWARD,e)}return this.sweepModule.moveToSweep({transitionType:e,sweepId:n,rotation:l,transitionTime:t,rotationDelay:.5})}throw new Error("Could not move to panorama mode because another transition was active")}moveCameraToDollhouse(e,t,i,n){const r=this.meshData.bounds,c={};let h;if(n&&(n.position||n.rotation)){if(n.position&&n.rotation){c.position=n.position,c.rotation=n.rotation;const e=new o.Plane(a.f.UP.clone(),this.meshData.center.y);let t=(0,b.Fe)(c.position,c.rotation,e);t||(t=new o.Vector3,t.copy(this.meshData.center)),r.containsPoint(t)&&(h=c.position.distanceTo(t))}else if(n.position)c.position=n.position,c.rotation=(0,b.n0)(n.position,this.meshData.center);else{c.rotation=n.rotation;const e=r.min.distanceTo(r.max);c.position=(0,b.fd)(c.rotation,this.meshData.center,e)}h||(h=this.meshData.center.clone().distanceTo(c.position))}else{let e,t;const i=this.sweepData.isSweepUnaligned(this.sweepData.currentSweep),n=i||this.viewmodeData.transition.from===s.Ey.Floorplan?this.meshData.center:this.cameraData.pose.position;if(i)t=new o.Vector3(0,0,0),e=new o.Vector3(15,10,15);else if(this.viewmodeData.transition.from!==s.Ey.Floorplan){const i=1.5,s=(0,b.YN)(this.cameraData.pose.position,this.cameraData.pose.rotation,-Math.PI/6,this.meshData.bounds,this.cameraData.fovY()*i,this.cameraData.pose.aspect()),r=((e,t)=>{const i=e.clone().add(new o.Vector3(0,6,0)),n=a.f.FORWARD.clone().applyQuaternion(t);return n.y>=.01&&(n.y=.01),{position:i.clone().add(n.clone().multiplyScalar(-10)),direction:n}})(n,this.cameraData.pose.rotation);[e,t]=[s.position,r.direction]}else{const i=((e,t)=>{const i=e.clone(),n=a.f.DOWN.clone().applyQuaternion(t).multiplyScalar(6),s=i.clone().add(n).setY(6),r=a.f.UP.clone().applyQuaternion(t);return r.setY(-.5).normalize(),{position:s,direction:r}})(n,this.cameraData.pose.rotation);[e,t]=[i.position,i.direction]}const r=n.clone().add(t).setY(this.meshData.center.y);c.position=(0,b.r0)(e,r,this.minDollhouseDistance,this.maxDollhouseDistance),c.position=(0,b.m$)(c.position,r,D,C),c.rotation=(0,b.n0)(c.position,r),h=r.distanceTo(c.position)}return this.cameraModule.moveTo({transitionType:t,pose:c,transitionTime:i,projection:(0,l.AN)(this.cameraData.aspect()),focalDistance:h,rotationDuration:.5})}setDollhouseBounds(){const e=this.meshData.bounds,t=e.min.distanceTo(e.max);this.minDollhouseDistance=Math.min(t/2,this.minDollhouseDistance),this.maxDollhouseDistance=Math.max(t,this.maxDollhouseDistance)}moveCameraToFloorplan(e,t,i,n){const s={},r=this.meshData.center,c=this.meshData.size,h=Math.max(c.x,c.z),d=Math.min(c.x,c.z),u=this.canvas.aspectRatio,p=Math.max(h,d/u),m=Math.max(d,h/u),g=u<1?p:m,f=this.canvas.height/(1.2*g),v=n&&n.zoom?this.canvas.height/(2*n.zoom):f,y=(0,l.aH)(this.canvas.width,this.canvas.height,v),b=(0,l.aH)(this.canvas.width,this.canvas.height,f);if(this.cameraModule.setBaseProjection(b),n&&n.position)s.position=n.position;else{const e=a.f.UP.clone().multiplyScalar(h);s.position=r.clone().add(e)}if(n&&n.rotation)s.rotation=n.rotation;else{const e=(new E.M).setPosition(s.position);e.lookAt(s.position,r,a.f.FORWARD),s.rotation=(new o.Quaternion).setFromRotationMatrix(e.asThreeMatrix4());if(u<1!==c.x/c.z<1){const e=(new o.Quaternion).setFromUnitVectors(a.f.UP,a.f.LEFT);s.rotation.multiply(e)}}const S=s.position.y-this.meshData.center.y;let M=Object.assign(Object.assign({},T),{easing:w.hl,transitionType:t,pose:s,transitionTime:i,projection:y,focalDistance:S});return e&&e in _&&(M=Object.assign(Object.assign({},_[e]),M)),this.cameraModule.moveTo(M)}}},17838:(e,t,i)=>{"use strict";function n(e){try{const t=e.getExtension("WEBGL_debug_renderer_info");if(t)return{vendor:e.getParameter(t.UNMASKED_VENDOR_WEBGL),renderer:e.getParameter(t.UNMASKED_RENDERER_WEBGL)}}catch(e){}return{vendor:"Unknown",renderer:"Unknown"}}function s(e){return/Apple A(9|1\d)/.test(e.renderer)||/Adreno \(TM\) (512|530|540|[6-9]\d\d)/.test(e.renderer)||/Mali-G(7[1-9]|[8-9]\d)/.test(e.renderer)}i.d(t,{t:()=>n,W:()=>s})},67627:(e,t,i)=>{"use strict";i.d(t,{a:()=>n,Z:()=>WebGLScene});var n,s=i(2212),r=i(63560),o=i(84561);class CameraRig extends s.Object3D{constructor(e){super(),this.anchor=this,this.update=e=>{this.anchor.position.copy(e.position),this.camera.quaternion.copy(e.rotation),this.camera.projectionMatrix.copy(e.projection.asThreeMatrix4()),this.camera.projectionMatrixInverse.copy(e.projection.asThreeMatrix4()),this.camera.projectionMatrixInverse.invert(),this.updateMatrixWorld(!0)},this.camera=new s.PerspectiveCamera(r.oR.fov,e,r.oR.near,r.oR.far),this.add(this.camera),this.camera.layers.mask=o.o.ALL.mask,this.name="CameraRig"}dispose(){this.remove(this.camera)}}!function(e){e[e.Root=0]="Root",e[e.CameraRig=1]="CameraRig"}(n||(n={}));class WebGLScene{constructor(e,t,i,r){this.scene=e,this.threeRenderer=t,this.cameraData=i,this.useEffectComposer=r,this.ids=n,this.rendering=!1,this.composer=null,this.cameraRigStale=!0,this.canvasSizeChanged=!0,this.updateComposer=(()=>{const e=new s.Vector2;return()=>{this.canvasSizeChanged&&this.composer&&(this.composer.setPixelRatio(this.composer.renderer.getPixelRatio()),this.composer.renderer.getSize(e),this.composer.setSize(e.x,e.y),this.canvasSizeChanged=!1)}})()}add(...e){for(const t of e)this.addChild(n.Root,t)}remove(...e){for(const t of e)this.removeChild(n.Root,t)}addChild(e,t){switch(e){case n.Root:this.scene.add(t);break;case n.CameraRig:this.cameraRig.add(t);break;default:return!1}return!0}removeChild(e,t){switch(e){case n.Root:this.scene.remove(t);break;case n.CameraRig:this.cameraRig.remove(t);break;default:return!1}return!0}get camera(){return this.updateCameraRig(),this.cameraRig.camera}get effectComposer(){return this.composer}init(){this.cameraRig=new CameraRig(this.cameraData.aspect()),this.useEffectComposer&&Promise.all([i.e(525).then(i.bind(i,32903)),i.e(525).then(i.bind(i,86426))]).then((([e,t])=>{this.composer=new e.EffectComposer(this.threeRenderer),this.composer.addPass(new t.RenderPass(this.scene,this.cameraRig.camera)),this.cameraRigStale=!0})),this.cameraRigStale=!0}dispose(){this.cameraRig.dispose()}startRender(e){this.rendering=e}activate(e){this.scene.add(this.cameraRig),this.cameraDataCallback=()=>this.cameraRigStale=!0,this.cameraData.pose.onChanged(this.cameraDataCallback)}deactivate(e){this.scene.remove(this.cameraRig),this.cameraData.pose.removeOnChanged(this.cameraDataCallback)}beforeRender(){this.updateCameraRig(),this.updateComposer()}updateCameraRig(){this.cameraRigStale&&(this.cameraRig.update(this.cameraData.pose),this.cameraRigStale=!1)}render(e){this.rendering&&(this.composer?this.composer.render(e):(this.threeRenderer.clear(),this.threeRenderer.render(this.scene,this.cameraRig.camera)))}setCameraDirty(){this.cameraRigStale=!0,this.cameraRig.camera.updateProjectionMatrix()}onCanvasSizeChanged(){this.canvasSizeChanged=!0}}},15982:(e,t,i)=>{"use strict";i.d(t,{b:()=>GetScreenPositionCommand});var n=i(17386);class GetScreenPositionCommand extends n.m{constructor(e){super(),this.payload=Object.assign({},e)}}},35300:(e,t,i)=>{"use strict";i.d(t,{vx:()=>WebGLSupportException,Rg:()=>ContextLostException,Gw:()=>RendererCreationException});var n=i(31102);class WebGLSupportException extends n.y{constructor(e){super(e)}}class ContextLostException extends n.y{constructor(e){super(e)}}class RendererCreationException extends n.y{constructor(e){super(e)}}},42090:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MAX_RESOLUTION:()=>D,default:()=>WebGLRendererModule});var n=i(47724),s=i(40168),r=i(67627),o=i(2212),a=i(31090),l=i(69383),c=i(20855);const h={basicTextured:{uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:(0,c.m)(l,i(79826)),fragmentShader:(0,c.m)(a,i(64715))},screenSpaceColored:{uniforms:{color:{type:"v3",value:new o.Vector3(0,0,0)},opacity:{type:"f",value:1}},vertexShader:(0,c.m)(l,i(55546)),fragmentShader:(0,c.m)(a,i(96228))}};var d=i(35300),u=i(17838),p=i(48277);const m=(e,t)=>{switch(e){case p.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X:t.set(0,-Math.PI/2,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:t.set(0,Math.PI/2,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:t.set(Math.PI/2,Math.PI,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:t.set(-Math.PI/2,Math.PI,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:t.set(0,-Math.PI,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:t.set(0,0,0)}},g=(e,t)=>{const i=t.extensions,n=t.getContext();let s;switch(e){case o.RepeatWrapping:return n.REPEAT;case o.ClampToEdgeWrapping:return n.CLAMP_TO_EDGE;case o.MirroredRepeatWrapping:return n.MIRRORED_REPEAT;case o.NearestFilter:return n.NEAREST;case o.NearestMipMapNearestFilter:return n.NEAREST_MIPMAP_NEAREST;case o.NearestMipMapLinearFilter:return n.NEAREST_MIPMAP_LINEAR;case o.LinearFilter:return n.LINEAR;case o.LinearMipMapNearestFilter:return n.LINEAR_MIPMAP_NEAREST;case o.LinearMipMapLinearFilter:return n.LINEAR_MIPMAP_LINEAR;case o.UnsignedByteType:return n.UNSIGNED_BYTE;case o.UnsignedShort4444Type:return n.UNSIGNED_SHORT_4_4_4_4;case o.UnsignedShort5551Type:return n.UNSIGNED_SHORT_5_5_5_1;case o.UnsignedShort565Type:return n.UNSIGNED_SHORT_5_6_5;case o.ByteType:return n.BYTE;case o.ShortType:return n.SHORT;case o.UnsignedShortType:return n.UNSIGNED_SHORT;case o.IntType:return n.INT;case o.UnsignedIntType:return n.UNSIGNED_INT;case o.FloatType:return n.FLOAT}switch(e){case o.AlphaFormat:return n.ALPHA;case o.RGBFormat:return n.RGB;case o.RGBAFormat:return n.RGBA;case o.LuminanceFormat:return n.LUMINANCE;case o.LuminanceAlphaFormat:return n.LUMINANCE_ALPHA;case o.AddEquation:return n.FUNC_ADD;case o.SubtractEquation:return n.FUNC_SUBTRACT;case o.ReverseSubtractEquation:return n.FUNC_REVERSE_SUBTRACT;case o.ZeroFactor:return n.ZERO;case o.OneFactor:return n.ONE;case o.SrcColorFactor:return n.SRC_COLOR;case o.OneMinusSrcColorFactor:return n.ONE_MINUS_SRC_COLOR;case o.SrcAlphaFactor:return n.SRC_ALPHA;case o.OneMinusSrcAlphaFactor:return n.ONE_MINUS_SRC_ALPHA;case o.DstAlphaFactor:return n.DST_ALPHA;case o.OneMinusDstAlphaFactor:return n.ONE_MINUS_DST_ALPHA;case o.DstColorFactor:return n.DST_COLOR;case o.OneMinusDstColorFactor:return n.ONE_MINUS_DST_COLOR;case o.SrcAlphaSaturateFactor:return n.SRC_ALPHA_SATURATE}if(e===o.HalfFloatType){if(t.capabilities.isWebGL2)return n.HALF_FLOAT;if(s=i.get("OES_texture_half_float"),null!==s)return s.HALF_FLOAT_OES}if(s=i.get("WEBGL_compressed_texture_s3tc"),null!==s){if(e===o.RGB_S3TC_DXT1_Format)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===o.RGBA_S3TC_DXT1_Format)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===o.RGBA_S3TC_DXT3_Format)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===o.RGBA_S3TC_DXT5_Format)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(s=i.get("WEBGL_compressed_texture_pvrtc"),null!==s){if(e===o.RGB_PVRTC_4BPPV1_Format)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===o.RGB_PVRTC_2BPPV1_Format)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===o.RGBA_PVRTC_4BPPV1_Format)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===o.RGBA_PVRTC_2BPPV1_Format)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(s=i.get("WEBGL_compressed_texture_etc1"),null!==s&&e===o.RGB_ETC1_Format)return s.COMPRESSED_RGB_ETC1_WEBGL;if(s=i.get("EXT_blend_minmax"),null!==s){if(e===o.MinEquation)return s.MIN_EXT;if(e===o.MaxEquation)return s.MAX_EXT}if(e===o.UnsignedInt248Type){if(t.capabilities.isWebGL2)return n.UNSIGNED_INT_24_8;if(s=i.get("WEBGL_depth_texture"),null!==s)return s.UNSIGNED_INT_24_8_WEBGL}return 0},f={copyCubeMap:{uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:(0,c.m)(l,i(28737)),fragmentShader:(0,c.m)(a,i(93366))}};var v=i(56247);const y={0:[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],1:[0,0,0,0,0,0,0,3e-6,229e-6,.005977,.060598,.24173,.382925,.24173,.060598,.005977,229e-6,3e-6,0,0,0,0,0,0,0],2:[0,0,1e-6,1e-5,78e-6,489e-6,.002403,.009245,.027835,.065591,.120978,.174666,.197413,.174666,.120978,.065591,.027835,.009245,.002403,489e-6,78e-6,1e-5,1e-6,0,0],3:[48e-6,169e-6,538e-6,.001532,.003907,.008921,.018247,.033432,.054867,.080658,.106212,.125283,.132372,.125283,.106212,.080658,.054867,.033432,.018247,.008921,.003907,.001532,538e-6,169e-6,48e-6],4:[.001133,.002316,.00445,.008033,.013627,.021724,.032542,.04581,.0606,.075333,.088001,.096603,.099654,.096603,.088001,.075333,.0606,.04581,.032542,.021724,.013627,.008033,.00445,.002316,.001133],5:[.004571,.00723,.010989,.016048,.022521,.03037,.039354,.049003,.058632,.067411,.074476,.079066,.080657,.079066,.074476,.067411,.058632,.049003,.039354,.03037,.022521,.016048,.010989,.00723,.004571],6:[.009379,.012899,.017256,.022453,.028417,.034983,.041888,.048784,.055264,.060893,.065262,.068032,.068981,.068032,.065262,.060893,.055264,.048784,.041888,.034983,.028417,.022453,.017256,.012899,.009379],7:[.014185,.01793,.022207,.02695,.032045,.037335,.042622,.047676,.052254,.056116,.059048,.06088,.061504,.06088,.059048,.056116,.052254,.047676,.042622,.037335,.032045,.02695,.022207,.01793,.014185]};class CWFWebGLRenderer{constructor(e){this.threeRenderer=e,this.cachedSize=new o.Vector2,this.renderToCubeMap=(()=>{let e,t,i,n,s,r=!1;const a=.5;return(l,c,d,u,p,m,g,f,v,y,b,S,E,w,T,_)=>{r||(t=new o.OrthographicCamera(-.5,a,a,-.5,-200,200),t.position.z=150,e=new o.Scene,e.name="rttCube",e.add(t),i=new o.RawShaderMaterial({uniforms:{tDiffuse:{value:null},alpha:{value:1}},vertexShader:h.basicTextured.vertexShader,fragmentShader:h.basicTextured.fragmentShader,depthWrite:!1,depthTest:!1,side:o.DoubleSide}),n=new o.PlaneBufferGeometry(1,1),s=new o.Mesh(n,i),s.position.z=0,e.add(s),r=!0);const M=n.getAttribute("uv");M.setUsage(o.DynamicDrawUsage),M.needsUpdate=!0;const x=M.array,A=p/d,O=m/u,P=g/d,D=f/u;x[0]=A,x[1]=O+D,x[2]=A+P,x[3]=O+D,x[4]=A,x[5]=O,x[6]=A+P,x[7]=O;const C=n.getAttribute("position");C.setUsage(o.DynamicDrawUsage),C.needsUpdate=!0;const I=C.array,L=v/c.width-a,R=y/c.height-a,N=b/c.width,k=S/c.height;I[0]=L,I[1]=R+k,I[3]=L+N,I[4]=R+k,I[6]=L,I[7]=R,I[9]=L+N,I[10]=R,i.uniforms.tDiffuse.value=l,i.blending=w||o.NoBlending,i.transparent=!!T,null==_&&(_=1),i.uniforms.alpha.value=_,i.needsUpdate=!0,c.viewport.set(0,0,c.width,c.height);const B=this.threeRenderer.getRenderTarget(),F=this.threeRenderer.autoClear,U=this.threeRenderer.xr.enabled;this.threeRenderer.xr.enabled=!1,this.threeRenderer.autoClear=!1,this.threeRenderer.setRenderTarget(c,E),this.threeRenderer.render(e,t),this.threeRenderer.setRenderTarget(B),this.threeRenderer.autoClear=F,this.threeRenderer.xr.enabled=U}})(),this.copyCubemap=(()=>{let e,t,i,n,s,r=!1;const a=new o.Euler,l=this;return(c,h,d,u,p)=>{if(!r){const a=2,l=a/2;t=new o.OrthographicCamera(-l,l,l,-l,0,200),t.position.set(0,0,0),e=new o.Scene,e.name="copyCube",e.add(t),i=new o.RawShaderMaterial({uniforms:{tDiffuse:{value:null},alpha:{value:1}},vertexShader:f.copyCubeMap.vertexShader,fragmentShader:f.copyCubeMap.fragmentShader,depthWrite:!1,depthTest:!1,side:o.DoubleSide}),n=new o.BoxGeometry(a,a,a),s=new o.Mesh(n,i),e.add(s),r=!0}const g=l.threeRenderer.getRenderTarget(),v=l.threeRenderer.autoClear,y=l.threeRenderer.xr.enabled;l.threeRenderer.xr.enabled=!1,l.threeRenderer.autoClear=!1;for(let n=0;n<6;n++)m(n,a),s.rotation.copy(a),s.matrixWorldNeedsUpdate=!0,s.updateMatrixWorld(!0),i.uniforms.tDiffuse.value=c,i.blending=d||o.NoBlending,i.transparent=!!u,null==p&&(p=1),i.uniforms.alpha.value=p,i.needsUpdate=!0,h.viewport.set(0,0,h.width,h.height),l.threeRenderer.setRenderTarget(h,n),l.threeRenderer.render(e,t);l.threeRenderer.setRenderTarget(g),l.threeRenderer.autoClear=v,l.threeRenderer.xr.enabled=y}})(),this.blurCubemap=(()=>{const e=e=>{const t=new o.WebGLCubeRenderTarget(e);return t.texture.image={},t.texture.image.width=e,t.texture.image.height=e,{renderTarget:t,cubeCamera:new o.CubeCamera(.1,1e3,t)}};class BlurCubeMesh extends o.Mesh{}const t={512:e(512)},i=new o.Scene,n=new BlurCubeMesh(new o.BoxGeometry(1,1,1));i.add(n);const s={};return(r,a,l=3,c=.005)=>{const h=a.renderTarget;t[h.width]||(t[h.width]=e(h.width)),n.material=function(e){if(!s[e]){const t=new o.RawShaderMaterial({uniforms:o.UniformsUtils.clone(v.Z.blurCube.uniforms),vertexShader:v.Z.blurCube.vertexShader,fragmentShader:v.Z.blurCube.fragmentShader,side:o.BackSide});t.defines={};const i=y[`${e}`];for(const[e,n]of i.entries())t.defines[`KERNEL_${e+1}`]=0===n||1===n?n.toFixed(1):n;s[e]=t}return s[e]}(l);const d=t[h.width];n.material.uniforms.map.value=r,n.material.uniforms.dir.value.set(c,0),d.cubeCamera.update(this.renderer,i),n.material.uniforms.map.value=d.renderTarget.texture,n.material.uniforms.dir.value.set(0,c),a.update(this.renderer,i)}})();try{const e=this.threeRenderer.getContext();this._maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._gpuInfo=(0,u.t)(e)}catch(e){throw new d.Gw("Unable to create a WebGL rendering context")}}get renderer(){return this.threeRenderer}get maxCubemapSize(){return this._maxCubemapSize}get maxTextureSize(){return this._maxTextureSize}get gpuInfo(){return this._gpuInfo}getSize(){return this.threeRenderer.getSize(this.cachedSize)}getPixelRatio(){return this.threeRenderer.getPixelRatio()}dispose(){this.threeRenderer.dispose()}initSizedTexture2D(e,t){const i=this.threeRenderer.getContext(),n=this.threeRenderer.state;(t=t||new o.Texture).addEventListener("dispose",(()=>i.deleteTexture(a.__webglTexture)));const s=g(t.format,this.threeRenderer),r=g(t.type,this.threeRenderer),a=this.threeRenderer.properties.get(t),l=i.createTexture();n.bindTexture(i.TEXTURE_2D,l),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t.flipY),i.texImage2D(i.TEXTURE_2D,0,s,e,e,0,s,r,null);const c=g(t.wrapS,this.threeRenderer),h=g(t.wrapT,this.threeRenderer);return i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,c),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,h),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,g(t.magFilter,this.threeRenderer)),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,g(t.minFilter,this.threeRenderer)),t.generateMipmaps&&i.generateMipmap(i.TEXTURE_2D),n.bindTexture(i.TEXTURE_2D,null),a.__webglTexture=l,t}initSizedCubeMap(e,t){const i=this.threeRenderer.getContext(),n=this.threeRenderer.state,s=new o.CubeTexture([null,null,null,null,null,null]);s.flipY=!1,s.generateMipmaps=t;const r=g(s.format,this.threeRenderer),a=g(s.type,this.threeRenderer),l=this.threeRenderer.properties.get(s),c=i.createTexture();n.bindTexture(i.TEXTURE_CUBE_MAP,c),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,s.flipY);for(let t=0;t<6;t++)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,r,e,e,0,r,a,null);return t?(s.magFilter=o.LinearFilter,s.minFilter=o.LinearMipMapLinearFilter,i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.generateMipmap(i.TEXTURE_CUBE_MAP)):(s.magFilter=o.LinearFilter,s.minFilter=o.LinearFilter,i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR)),n.bindTexture(i.TEXTURE_CUBE_MAP,null),l.__image__webglTextureCube=c,s}initRenderTargetCube(e){const t=new o.WebGLCubeRenderTarget(e,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});return t.texture.image={},t.texture.image.width=e,t.texture.image.height=e,t}deallocateCubeTexture(e){const t=this.threeRenderer.getContext(),i=this.threeRenderer.properties.get(e);t.deleteTexture(i.__image__webglTextureCube)}uploadTexture2D(e,t,i,n){const s=this.threeRenderer.getContext(),r=this.threeRenderer.state,o=s.getParameter(s.TEXTURE_BINDING_2D),a=this.threeRenderer.properties.get(t);r.bindTexture(s.TEXTURE_2D,a.__webglTexture),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,t.unpackAlignment),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,g(t.wrapS,this.threeRenderer)),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,g(t.wrapT,this.threeRenderer)),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,g(t.magFilter,this.threeRenderer)),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,g(t.minFilter,this.threeRenderer));const l=g(t.format,this.threeRenderer),c=g(t.type,this.threeRenderer);s.texSubImage2D(s.TEXTURE_2D,0,i,n,l,c,e),t.generateMipmaps&&s.generateMipmap(s.TEXTURE_2D),r.bindTexture(s.TEXTURE_2D,o)}generateMipmaps(e){const t=this.threeRenderer.getContext(),i=this.threeRenderer.state,n=t.getParameter(t.TEXTURE_BINDING_2D),s=this.threeRenderer.properties.get(e);i.bindTexture(t.TEXTURE_2D,s.__webglTexture),e.generateMipmaps&&t.generateMipmap(t.TEXTURE_2D),i.bindTexture(t.TEXTURE_2D,n)}fence(e){return new Promise((function(t,i){const n=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);if(null===n)return i();e.flush();const s=()=>{switch(e.getSyncParameter(n,e.SYNC_STATUS)){case e.TIMEOUT_EXPIRED:return void setTimeout(s,0);case e.WAIT_FAILED:return void i();case e.SIGNALED:return e.deleteSync(n),void t();default:return void setTimeout(s,0)}};setTimeout(s,0)}))}}var b=i(59088),S=i(67790),E=i(84303),w=i(64323),T=i(88512),_=i(48358);class ScreenOverlayMesh extends o.Mesh{constructor(e){super(new o.PlaneBufferGeometry(2,2,1,1),new o.RawShaderMaterial({uniforms:o.UniformsUtils.clone(h.screenSpaceColored.uniforms),vertexShader:h.screenSpaceColored.vertexShader,fragmentShader:h.screenSpaceColored.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1})),this._opacity=1,this.material.uniforms.color.value=new o.Color(e),this.renderOrder=_.z.colorOverlay,this.name="ScreenOverlayMesh"}set opacity(e){this.visible=e>0,this._opacity=e,this.material.uniforms.opacity.value=e}get opacity(){return this._opacity}dispose(){this.material.dispose(),this.geometry.dispose()}}class ScreenOverlayComponent{constructor(e,t){this.scene=e,this.cameraData=t}init(){this.blackoutOverlayMesh=new ScreenOverlayMesh(0)}dispose(){this.blackoutOverlayMesh.dispose()}render(e){this.blackoutOverlayMesh.opacity=this.cameraData.transition.blackoutProgress.value}activate(e){this.scene.addChild(this.scene.ids.CameraRig,this.blackoutOverlayMesh)}deactivate(e){this.scene.removeChild(this.scene.ids.CameraRig,this.blackoutOverlayMesh)}}var M=i(27687),x=i(33874);class TextureTracker{constructor(){this.stacks=new Map,this.texInfo=new Map}hookCalls(e){let t=1;const i=e.createTexture.bind(e);e.createTexture=()=>{const e=i();e.mpTexId=t++;const n=(new Error).stack;if(n){const t=this.stacks.get(n)||new Set;t.add(e.mpTexId),this.stacks.set(n,t)}return e};const n=e.deleteTexture.bind(e);e.deleteTexture=e=>{if(null!==e){const t=e.mpTexId;this.stacks.forEach((e=>e.delete(t))),this.texInfo.delete(t)}n(e)};const s=e.bindTexture.bind(e);let r;e.bindTexture=(...e)=>{const t=e[1];r=null!==t?t.mpTexId:null,s(...e)};const o=e.texImage2D.bind(e);e.texImage2D=(...e)=>{if(o(...e),r){const t=4;if(e.length>=7)this.texInfo.set(r,{width:e[3],height:e[4],size:e[8]?e[8].length:e[3]*e[4]*t});else{const i=e[5];i instanceof ImageData&&this.texInfo.set(r,{width:i.width,height:i.height,size:i.data.length}),(i instanceof HTMLImageElement||i instanceof HTMLVideoElement||i instanceof HTMLCanvasElement||i instanceof ImageBitmap)&&this.texInfo.set(r,{width:i.width,height:i.height,size:i.width*i.height*t})}}}}dumpTextureInfo(){console.log(this.texInfo);const e=Array.from(this.texInfo.values()).reduce(((e,t)=>e+t.size),0)/1024;console.log(`Currently active textures: ${this.texInfo.size}, total allocated: ${e}k`);let t=0;this.stacks.forEach(((e,i)=>{const n=Array.from(e.values()),s=n.map((e=>this.texInfo.get(e))).reduce(((e,t)=>t?e+t.size:e),0)/1024;console.groupCollapsed(`Call site ${t}: ${n.length}, allocated: ${s}k`),console.log(i),n.forEach((e=>{const t=this.texInfo.get(e);t&&console.log(`width: ${t.width}, height: ${t.height}, size: ${t.size/1024}k`)})),console.groupEnd(),t++}))}}var A=i(24930),O=i(15982);const P=new T.Z("webgl-renderer"),D=3686400;class WebGLRendererModule extends n.Y{constructor(){super(...arguments),this.name="webgl-renderer",this.contextLostError=null,this.setContextLostError=e=>{this.contextLostError=e},this.getPixelRatioFor=(e,t)=>{const i=window.devicePixelRatio||1;return e*t*i<=D?i:1}}async init(e,t){if(!("WebGLRenderingContext"in window))throw new d.vx("WebGL not supported");let i;this.canvas=e.canvas,this.engine=t;try{const t={canvas:this.canvas,antialias:e.antialias,alpha:!0,powerPreference:"high-performance"};i=e.useWebGL2?new o.WebGLRenderer(t):new o.WebGL1Renderer(t),i.autoClear=!1,i.xr.enabled=!0}catch(e){throw new d.Gw("Unable to create a WebGL rendering context")}this._cwfRenderer=new CWFWebGLRenderer(i),[this.cameraData,this.settingsData]=await Promise.all([t.market.waitForData(b.M_),t.market.waitForData(x.e)]);const n=new o.Scene;n.name="main",this.scene=new r.Z(n,i,this.cameraData,e.useEffectComposer),t.addComponent(this,this.scene),t.addComponent(this,new ScreenOverlayComponent(this.scene,this.cameraData));const a=await t.market.waitForData(s.W);if(this.setSize(a.width,a.height),this.bindings.push(t.subscribe(S.a,(e=>this.setSize(e.width,e.height))),t.commandBinder.addBinding(O.b,(async e=>(0,M.q9)(this.cameraData,e.worldPosition).screenPosition))),e.trackTextureUsage)if(e.useWebGL2)P.error("Texture tracking for WebGL2 is not supported at the moment.");else{this.textureTracker=new TextureTracker,this.textureTracker.hookCalls(i.getContext());(await t.getModule(A.default)).registerButton("Texture Usage","Dump to console",(()=>{this.textureTracker.dumpTextureInfo()}))}this.canvas.addEventListener("webglcontextlost",this.setContextLostError)}dispose(e){super.dispose(e),this.canvas.removeEventListener("webglcontextlost",this.setContextLostError)}onUpdate(e){if(this.contextLostError)throw new d.Rg(`WebGL context lost: ${this.contextLostError.statusMessage||"no status given"}`)}get gpuInfo(){return this._cwfRenderer.gpuInfo}get maxCubemapSize(){return this._cwfRenderer.maxCubemapSize}get maxTextureSize(){return this._cwfRenderer.maxTextureSize}getScene(){return this.scene}getCamera(){return this.scene.camera}get cwfRenderer(){return this._cwfRenderer}get textureManager(){return this._cwfRenderer}get threeRenderer(){return this.cwfRenderer.renderer}async renderOnce(){return this.scene.startRender(!0),this.engine.after(E.A.Render).then((()=>this.scene.startRender(!1)))}startRender(e=!0){this.scene.startRender(e),this.engine.broadcast(new w.V(this.cwfRenderer.getPixelRatio()))}setSize(e,t){const i=this.getPixelRatioFor(e,t);i!==this.cwfRenderer.getPixelRatio()&&(P.debug(`Setting pixel ratio to ${i}`),this.engine.broadcast(new w.V(i))),this.threeRenderer.xr.isPresenting&&P.error("setting size while in xr is a no no, it resets the viewport",e,t),this.threeRenderer.setPixelRatio(i),this.threeRenderer.setSize(e,t,!1),this.scene.setCameraDirty()}supportsInstancing(){const{threeRenderer:e,settingsData:t}=this;return!t.checkUrlParam("noInstancing",1,0)&&(e.capabilities.isWebGL2||e.extensions.has("ANGLE_instanced_arrays"))}getCapabilities(){const{capabilities:e,extensions:t}=this.threeRenderer,i=e.isWebGL2;let n=!1;try{n=!!document.createElement("canvas").getContext("webgl2")}catch(e){}return{gl_v2:n,gl_max_textures:e.maxTextures,gl_max_texture_size:e.maxTextureSize,gl_max_cubemap_size:e.maxCubemapSize,gl_instancing:this.supportsInstancing(),gl_oes_texture_float:i||t.has("OES_texture_float"),gl_oes_texture_half_float:i||t.has("OES_texture_half_float"),gl_depth_texture:i||t.has("WEBGL_depth_texture"),gl_draw_buffers:i||t.has("WEBGL_draw_buffers"),gl_oes_fbo_render_mip_map:i||t.has("OES_fbo_render_mipmap"),gl_shader_texture_lod:i||t.has("EXT_shader_texture_lod"),gl_oes_vertex_array_obj:i||t.has("OES_vertex_array_object"),gl_ovr_multi_view:i&&t.has("OVR_multiview2"),gl_color_buffer_float:i&&t.has("EXT_color_buffer_float"),gl_astc_supported:t.has("WEBGL_compressed_texture_astc"),gl_etc1_supported:t.has("WEBGL_compressed_texture_etc1"),gl_etc2_supported:t.has("WEBGL_compressed_texture_etc"),gl_dxt_supported:t.has("WEBGL_compressed_texture_s3tc"),gl_bptc_supported:t.has("EXT_texture_compression_bptc"),gl_pvrtc_supported:t.has("WEBGL_compressed_texture_pvrtc")||t.has("WEBKIT_WEBGL_compressed_texture_pvrtc")}}}},64323:(e,t,i)=>{"use strict";i.d(t,{V:()=>PixelRatioChangedMessage});var n=i(91466);class PixelRatioChangedMessage extends n.v{constructor(e){super(),this.pixelRatio=e}}},1630:(e,t,i)=>{"use strict";i.d(t,{j:()=>XRSessionRequestCommand});var n=i(17386);class XRSessionRequestCommand extends n.m{constructor(e){super(),this.id="XR_PRESENT",this.payload=Object.assign({},e)}}},7855:(e,t,i)=>{"use strict";i.d(t,{hX:()=>l,pl:()=>c,bk:()=>n});var n,s=i(60771),r=i(42472),o=i(40285),a=i(25138);!function(e){e.webvr="webvr",e.webxr="webxr",e.unsupported="unsupported"}(n||(n={}));const l=e=>{const t=e.tryGetProperty("is_vr",!1),i=e.tryGetProperty(a.sX,!1),n=e.tryGetProperty("vr",1);return t&&!(!n||2===n&&!(0,s.Dt)())&&!i},c=async()=>{const e=await r.Z.isSessionSupported("immersive-vr");if(r.Z.likelySupportsControllers()&&e)return n.webxr;if(await o.H())return n.webvr;return n.unsupported}},42472:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(88512),s=i(60771);const r=new n.Z("vr-platform-select"),o=()=>{const e="xr"in navigator&&"isSessionSupported"in navigator.xr&&"requestSession"in navigator.xr;return window.isSecureContext&&e},a={isSessionSupported:async(e="immersive-vr")=>{let t=!1;if(o())try{t=await navigator.xr.isSessionSupported(e)}catch(e){r.info("WebXR disabled",e)}return r.debug(`WebXR session type: ${e} supported: ${t}`),t},likelySupportsControllers:()=>window.isSecureContext&&((0,s.Ot)()||!(0,s.tq)()),apiExists:o}},24285:(e,t,i)=>{"use strict";i.d(t,{Z:()=>ZoomMessage});var n=i(91466);class ZoomMessage extends n.v{constructor(e){super(),this.zoomLevel=e}}},21499:(e,t,i)=>{"use strict";i.d(t,{bj:()=>ZoomInCommand,KB:()=>ZoomOutCommand,ob:()=>ZoomResetCommand,_N:()=>ZoomGetMaxCommand,ts:()=>ZoomSetCommand});var n=i(17386);class ZoomInCommand extends n.m{constructor(e){super(),this.payload={step:e}}}ZoomInCommand.id="ZOOM_IN";class ZoomOutCommand extends n.m{constructor(e){super(),this.payload={step:e}}}ZoomOutCommand.id="ZOOM_OUT";class ZoomResetCommand extends n.m{}ZoomResetCommand.id="ZOOM_RESET";class ZoomGetMaxCommand extends n.m{}ZoomGetMaxCommand.id="ZOOM_MAX_VALUE";class ZoomSetCommand extends n.m{constructor(e){super(),this.payload={value:e}}}ZoomSetCommand.id="ZOOM_SET"},31657:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ZoomControls});var n=i(47724),s=i(736),r=i(81040),o=i(38022),a=i(88727),l=i(81507),c=i(88216),h=i(77719),d=i(59088),u=i(63560),p=i(35597),m=i(94329),g=i(75892),f=i(27408),v=i(7170),y=i(36371);const b=.1,S=.7,E=2,w=3,T=1.1;var _=i(21499),M=i(88512),x=i(24285),A=i(34369);const O=new M.Z("Showcase Zoom Controls");class ZoomControls extends n.Y{constructor(){super(...arguments),this.name="zoom-controls",this.uhQuality={},this.config={enabled:!0,tiles:!0}}async init(e,t){if(this.config.enabled=!!e.enabled,this.config.tiles=!!e.tiles,this.config.tiles)try{this.sweepTilingModule=await t.getModuleBySymbol(s.y.SWEEP_PANO)}catch(e){O.debug(`Tiling not enabled for zoom controls - ${e}`)}this.config.enabled&&await this.registerControls(t),this.engine=t,this.cameraModule=await t.getModule(h.default),this.cameraData=await t.market.waitForData(d.M_),this.viewmodeData=await t.market.waitForData(p.O),this.sweepData=await t.market.waitForData(g.Z),this.bindings.push(t.commandBinder.addBinding(_.bj,(async e=>this.zoomBy(e.step))),t.commandBinder.addBinding(_.KB,(async e=>this.zoomBy(-e.step))),t.commandBinder.addBinding(_.ob,(async()=>this.zoomTo(1))),t.commandBinder.addBinding(_.ts,(async e=>this.zoomTo(e.value))),t.commandBinder.addBinding(_._N,this.getMaxZoomAvailable.bind(this)))}async registerControls(e){e.getModuleBySymbol(s.y.INPUT).then((e=>{this.bindings.push(e.registerHandler(r.a,(e=>this.zoomByInput(this.scrollToZoomDelta(e))))),this.bindings.push(e.registerHandler(o.G,(e=>this.zoomByInput(this.pinchToZoomDelta(e))))),this.bindings.push(e.registerHandler(a.e,(e=>this.keyHandler(e))))}))}zoomTo(e){const t=this.cameraData.zoom();if(!this.validateViewmode())return t;const i=this.sweepData.currentSweepObject;if(this.config.tiles&&this.checkTilingZoomLevels(e,i),(e=(0,f.uZ)(e,S,w))!==t){const t=(0,v.ZY)(this.cameraData.baseFovY/e),i=u.oR.near,n=u.oR.far;this.cameraModule.updateCameraProjection((new y.M).makePerspectiveFov(t,this.cameraData.aspect(),i,n))}return this.engine.broadcast(new x.Z(e)),e}checkTilingZoomLevels(e,t){e>=T&&this.zoomedSweep!==t?(this.zoomedSweep=t,this.sweepTilingModule.enableZooming(!0,t).then((e=>{e?this.uhQuality[t.id]=!0:(this.uhQuality[t.id]=!1,this.zoomedSweep=void 0)}))):e<T&&this.zoomedSweep&&this.zoomedSweep===t&&(this.sweepTilingModule.enableZooming(!1,this.zoomedSweep),this.zoomedSweep=void 0)}getMaxZoom(e){return this.uhQuality[e]?w:E}zoomBy(e){const t=this.cameraData.zoom();return this.validateViewmode()?this.zoomTo(t+e):t}validateViewmode(){return this.viewmodeData.currentMode===m.Ey.Panorama&&this.cameraData.canTransition()}scrollToZoomDelta(e){return-Math.sign(e.delta.y)*b}pinchToZoomDelta(e){return e.pinchDelta*(E-S)}zoomByInput(e){const t=this.cameraData.zoom();if(!this.validateViewmode())return t;const i=this.sweepData.currentSweep,n=(0,f.uZ)(t+e,S,this.getMaxZoom(i));return this.zoomTo(n)}keyHandler(e){if(e.state===c.M.DOWN)switch(e.key){case l.R.PLUSEQUALS:this.zoomByInput(b);break;case l.R.DASHUNDERSCORE:this.zoomByInput(-b);break;case l.R.OPENBRACKET:this.zoomTo(1)}}async getMaxZoomAvailable(){if(!this.sweepData.currentSweepObject)return E;const e=this.sweepData.currentSweepObject;return await this.sweepTilingModule.availableResolution(e,A.SL.ULTRAHIGH)>=A.SL.ULTRAHIGH?w:E}}},20855:(e,t,i)=>{"use strict";function n(...e){return e.join("\n")}i.d(t,{m:()=>n})},78959:(e,t,i)=>{"use strict";i.d(t,{$:()=>Label3D,N:()=>O});var n=i(2212),s=i(7170),r=i(27408);window.THREE=Object.assign(Object.assign({},window.THREE),{BufferGeometry:n.BufferGeometry,Sphere:n.Sphere,Box3:n.Box3,Texture:n.Texture,Color:n.Color,BufferAttribute:n.BufferAttribute});var o=i(11385);var a,l=i(12216),c=i(27687),h=i(98828),d=i(88512);!function(e){e[e.NONE=0]="NONE",e[e.NUMERIC=1]="NUMERIC",e[e.ASCII=2]="ASCII"}(a||(a={}));const u={pages:[],chars:[],info:{face:"Loading",size:0,bold:0,italic:0,charset:[],unicode:1,stretchH:100,smooth:1,aa:1,padding:[0,0,0,0],spacing:[0,0],os2version:1},common:{lineHeight:0,base:0,scaleW:1,scaleH:1,pages:0,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0},kernings:[]};var p=i(66223),m=i(94085),g=i(23573);class BitmapFontAtlas extends g.T{constructor(e){super(),this.packer=e,this.fontData=u,this.textures=[]}update(e,t){this.fontData=t,this.textures.forEach((e=>e.dispose())),this.textures.length=0,this.textures.push(...e),this.commit()}addCharsIfNeeded(e){this.packer.addChars(e)}}const f=new d.Z("FontManager");class BitmapFontPackerStatic{constructor(){this.name="roboto-700-42-static",this._atlas=new BitmapFontAtlas(this),this.mWidth=0}async loadFont(){const[e,t]=await Promise.all([(0,p.p)(m),i.e(386).then(i.t.bind(i,60386,19))]),n=t.default;return this.estimateWidth(n),this._atlas.update([e],n),Promise.resolve({fontPath:this.name,font:this.name,packer:this})}addChars(e){f.debug(this.name,"does not support dynamic char adding")}measureText(e){if(this.mWidth)return e.length*this.mWidth}atlas(){return this._atlas}estimateWidth(e){const t=e.chars.find((e=>e.id==="m".charCodeAt(0)));t&&(this.mWidth=t.width)}}const v=(()=>{let e=null;return function(){return e||(e=Promise.all([i.e(764),i.e(422),i.e(143)]).then(i.bind(i,44422)).then((e=>e.load))),e}})();class Rectangle{constructor(e=0,t=0,i=0,n=0,s=!1,r){this.oversized=!1,this._rot=!1,this._allowRotation=void 0,this._dirty=0,this._width=e,this._height=t,this._x=i,this._y=n,this._data={},this._rot=s,this._allowRotation=r}static Collide(e,t){return e.collide(t)}static Contain(e,t){return e.contain(t)}area(){return this.width*this.height}collide(e){return e.x<this.x+this.width&&e.x+e.width>this.x&&e.y<this.y+this.height&&e.y+e.height>this.y}contain(e){return e.x>=this.x&&e.y>=this.y&&e.x+e.width<=this.x+this.width&&e.y+e.height<=this.y+this.height}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._dirty++)}get height(){return this._height}set height(e){e!==this._height&&(this._height=e,this._dirty++)}get x(){return this._x}set x(e){e!==this._x&&(this._x=e,this._dirty++)}get y(){return this._y}set y(e){e!==this._y&&(this._y=e,this._dirty++)}get rot(){return this._rot}set rot(e){if(!1!==this._allowRotation&&this._rot!==e){const t=this.width;this.width=this.height,this.height=t,this._rot=e,this._dirty++}}get allowRotation(){return this._allowRotation}set allowRotation(e){this._allowRotation!==e&&(this._allowRotation=e,this._dirty++)}get data(){return this._data}set data(e){null!==e&&e!==this._data&&(this._data=e,"object"==typeof e&&e.hasOwnProperty("allowRotation")&&(this._allowRotation=e.allowRotation),this._dirty++)}get dirty(){return this._dirty>0}setDirty(e=!0){this._dirty=e?this._dirty+1:0}}class Bin{constructor(){this._dirty=0}get dirty(){return this._dirty>0||this.rects.some((e=>e.dirty))}setDirty(e=!0){if(this._dirty=e?this._dirty+1:0,!e)for(let e of this.rects)e.setDirty&&e.setDirty(!1)}}class MaxRectsBin extends Bin{constructor(e=y,t=y,i=0,n={}){super(),this.maxWidth=e,this.maxHeight=t,this.padding=i,this.freeRects=[],this.rects=[],this.verticalExpand=!1,this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,exclusiveTag:!0,border:0,logic:b.MAX_EDGE},this.options=Object.assign(Object.assign({},this.options),n),this.width=this.options.smart?0:e,this.height=this.options.smart?0:t,this.border=this.options.border?this.options.border:0,this.freeRects.push(new Rectangle(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)),this.stage=new Rectangle(this.width,this.height)}add(...e){let t,i;if(1===e.length){if("object"!=typeof e[0])throw new Error("MacrectsBin.add(): Wrong parameters");i=e[0];let t=i.data&&i.data.tag?i.data.tag:i.tag?i.tag:void 0;if(this.options.tag&&this.options.exclusiveTag&&this.tag!==t)return}else{if(t=e.length>2?e[2]:null,this.options.tag&&this.options.exclusiveTag){if(t&&this.tag!==t.tag)return;if(!t&&this.tag)return}i=new Rectangle(e[0],e[1]),i.data=t,i.setDirty(!1)}const n=this.place(i);return n&&this.rects.push(n),n}repack(){let e=[];this.reset(),this.rects.sort(((e,t)=>{const i=Math.max(t.width,t.height)-Math.max(e.width,e.height);return 0===i&&e.hash&&t.hash?e.hash>t.hash?-1:1:i}));for(let t of this.rects)this.place(t)||e.push(t);for(let t of e)this.rects.splice(this.rects.indexOf(t),1);return e.length>0?e:void 0}reset(e=!1,t=!1){e&&(this.data&&delete this.data,this.tag&&delete this.tag,this.rects=[],t&&(this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,border:0})),this.width=this.options.smart?0:this.maxWidth,this.height=this.options.smart?0:this.maxHeight,this.border=this.options.border?this.options.border:0,this.freeRects=[new Rectangle(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)],this.stage=new Rectangle(this.width,this.height),this._dirty=0}clone(){let e=new MaxRectsBin(this.maxWidth,this.maxHeight,this.padding,this.options);for(let t of this.rects)e.add(t);return e}place(e){let t,i,n=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0;if(!this.options.tag||!this.options.exclusiveTag||this.tag===n){if(i=e.hasOwnProperty("_allowRotation")&&void 0!==e.allowRotation?e.allowRotation:this.options.allowRotation,t=this.findNode(e.width+this.padding,e.height+this.padding,i),t){this.updateBinSize(t);let i=this.freeRects.length,n=0;for(;n<i;)this.splitNode(this.freeRects[n],t)&&(this.freeRects.splice(n,1),i--,n--),n++;return this.pruneFreeList(),this.verticalExpand=this.width>this.height,e.x=t.x,e.y=t.y,void 0===e.rot&&(e.rot=!1),e.rot=t.rot?!e.rot:e.rot,this._dirty++,e}if(this.verticalExpand){if(this.updateBinSize(new Rectangle(e.width+this.padding,e.height+this.padding,this.border,this.height+this.padding-this.border))||this.updateBinSize(new Rectangle(e.width+this.padding,e.height+this.padding,this.width+this.padding-this.border,this.border)))return this.place(e)}else if(this.updateBinSize(new Rectangle(e.width+this.padding,e.height+this.padding,this.width+this.padding-this.border,this.border))||this.updateBinSize(new Rectangle(e.width+this.padding,e.height+this.padding,this.border,this.height+this.padding-this.border)))return this.place(e)}}findNode(e,t,i){let n,s,r,o=Number.MAX_VALUE;for(let a in this.freeRects)s=this.freeRects[a],s.width>=e&&s.height>=t&&(n=this.options.logic===b.MAX_AREA?s.width*s.height-e*t:Math.min(s.width-e,s.height-t),n<o&&(r=new Rectangle(e,t,s.x,s.y),o=n)),i&&s.width>=t&&s.height>=e&&(n=this.options.logic===b.MAX_AREA?s.width*s.height-t*e:Math.min(s.height-e,s.width-t),n<o&&(r=new Rectangle(t,e,s.x,s.y,!0),o=n));return r}splitNode(e,t){if(!e.collide(t))return!1;if(t.x<e.x+e.width&&t.x+t.width>e.x){if(t.y>e.y&&t.y<e.y+e.height){let i=new Rectangle(e.width,t.y-e.y,e.x,e.y);this.freeRects.push(i)}if(t.y+t.height<e.y+e.height){let i=new Rectangle(e.width,e.y+e.height-(t.y+t.height),e.x,t.y+t.height);this.freeRects.push(i)}}if(t.y<e.y+e.height&&t.y+t.height>e.y){if(t.x>e.x&&t.x<e.x+e.width){let i=new Rectangle(t.x-e.x,e.height,e.x,e.y);this.freeRects.push(i)}if(t.x+t.width<e.x+e.width){let i=new Rectangle(e.x+e.width-(t.x+t.width),e.height,t.x+t.width,e.y);this.freeRects.push(i)}}return!0}pruneFreeList(){let e=0,t=0,i=this.freeRects.length;for(;e<i;){t=e+1;let n=this.freeRects[e];for(;t<i;){let s=this.freeRects[t];if(s.contain(n)){this.freeRects.splice(e,1),e--,i--;break}n.contain(s)&&(this.freeRects.splice(t,1),t--,i--),t++}e++}}updateBinSize(e){if(!this.options.smart)return!1;if(this.stage.contain(e))return!1;let t=Math.max(this.width,e.x+e.width-this.padding+this.border),i=Math.max(this.height,e.y+e.height-this.padding+this.border);if(this.options.allowRotation){const n=Math.max(this.width,e.x+e.height-this.padding+this.border),s=Math.max(this.height,e.y+e.width-this.padding+this.border);n*s<t*i&&(t=n,i=s)}return this.options.pot&&(t=Math.pow(2,Math.ceil(Math.log(t)*Math.LOG2E)),i=Math.pow(2,Math.ceil(Math.log(i)*Math.LOG2E))),this.options.square&&(t=i=Math.max(t,i)),!(t>this.maxWidth+this.padding||i>this.maxHeight+this.padding)&&(this.expandFreeRects(t+this.padding,i+this.padding),this.width=this.stage.width=t,this.height=this.stage.height=i,!0)}expandFreeRects(e,t){this.freeRects.forEach(((i,n)=>{i.x+i.width>=Math.min(this.width+this.padding-this.border,e)&&(i.width=e-i.x-this.border),i.y+i.height>=Math.min(this.height+this.padding-this.border,t)&&(i.height=t-i.y-this.border)}),this),this.freeRects.push(new Rectangle(e-this.width-this.padding,t-2*this.border,this.width+this.padding-this.border,this.border)),this.freeRects.push(new Rectangle(e-2*this.border,t-this.height-this.padding,this.border,this.height+this.padding-this.border)),this.freeRects=this.freeRects.filter((e=>!(e.width<=0||e.height<=0||e.x<this.border||e.y<this.border))),this.pruneFreeList()}}class OversizedElementBin extends Bin{constructor(...e){if(super(),this.rects=[],1===e.length){if("object"!=typeof e[0])throw new Error("OversizedElementBin: Wrong parameters");const t=e[0];this.rects=[t],this.width=t.width,this.height=t.height,this.data=t.data,t.oversized=!0}else{this.width=e[0],this.height=e[1],this.data=e.length>2?e[2]:null;const t=new Rectangle(this.width,this.height);t.oversized=!0,t.data=this.data,this.rects.push(t)}this.freeRects=[],this.maxWidth=this.width,this.maxHeight=this.height,this.options={smart:!1,pot:!1,square:!1}}add(){}reset(e=!1){}repack(){}clone(){return new OversizedElementBin(this.rects[0])}}const y=4096;var b;!function(e){e[e.MAX_AREA=0]="MAX_AREA",e[e.MAX_EDGE=1]="MAX_EDGE"}(b||(b={}));class MaxRectsPacker{constructor(e=y,t=y,i=0,n={}){this.width=e,this.height=t,this.padding=i,this.options={smart:!0,pot:!0,square:!1,allowRotation:!1,tag:!1,exclusiveTag:!0,border:0,logic:b.MAX_EDGE},this._currentBinIndex=0,this.bins=[],this.options=Object.assign(Object.assign({},this.options),n)}add(...e){if(1===e.length){if("object"!=typeof e[0])throw new Error("MacrectsPacker.add(): Wrong parameters");const t=e[0];if(t.width>this.width||t.height>this.height)this.bins.push(new OversizedElementBin(t));else{if(!this.bins.slice(this._currentBinIndex).find((e=>void 0!==e.add(t)))){let e=new MaxRectsBin(this.width,this.height,this.padding,this.options),i=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;this.options.tag&&i&&(e.tag=i),e.add(t),this.bins.push(e)}}return t}{const t=new Rectangle(e[0],e[1]);if(e.length>2&&(t.data=e[2]),t.width>this.width||t.height>this.height)this.bins.push(new OversizedElementBin(t));else{if(!this.bins.slice(this._currentBinIndex).find((e=>void 0!==e.add(t)))){let e=new MaxRectsBin(this.width,this.height,this.padding,this.options);this.options.tag&&t.data.tag&&(e.tag=t.data.tag),e.add(t),this.bins.push(e)}}return t}}addArray(e){if(!this.options.tag||this.options.exclusiveTag)this.sort(e,this.options.logic).forEach((e=>this.add(e)));else{if(0===e.length)return;let t;e.sort(((e,t)=>{const i=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0,n=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;return void 0===n?-1:void 0===i?1:n>i?-1:1}));let i=0;if(!this.bins.slice(this._currentBinIndex).find((n=>{let s=n.clone();for(let r=i;r<e.length;r++){const o=e[r],a=o.data&&o.data.tag?o.data.tag:o.tag?o.tag:void 0;if(0===r&&(t=a),a!==t)return t=a,this.sort(e.slice(i,r),this.options.logic).forEach((e=>n.add(e))),i=r,this.addArray(e.slice(r)),!0;if(void 0===a)return this.sort(e.slice(r),this.options.logic).forEach((e=>this.add(e))),i=e.length,!0;if(void 0===s.add(o))return!1}return this.sort(e.slice(i),this.options.logic).forEach((e=>n.add(e))),!0}))){const t=e[i],n=new MaxRectsBin(this.width,this.height,this.padding,this.options),s=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;this.options.tag&&this.options.exclusiveTag&&s&&(n.tag=s),this.bins.push(n),this.addArray(e.slice(i))}}}reset(){this.bins=[],this._currentBinIndex=0}repack(e=!0){if(e){let e=[];for(let t of this.bins)if(t.dirty){let i=t.repack();i&&e.push(...i)}return void this.addArray(e)}if(!this.dirty)return;const t=this.rects;this.reset(),this.addArray(t)}next(){return this._currentBinIndex=this.bins.length,this._currentBinIndex}load(e){e.forEach(((e,t)=>{if(e.maxWidth>this.width||e.maxHeight>this.height)this.bins.push(new OversizedElementBin(e.width,e.height,{}));else{let i=new MaxRectsBin(this.width,this.height,this.padding,e.options);i.freeRects.splice(0),e.freeRects.forEach(((e,t)=>{i.freeRects.push(new Rectangle(e.width,e.height,e.x,e.y))})),i.width=e.width,i.height=e.height,e.tag&&(i.tag=e.tag),this.bins[t]=i}}),this)}save(){let e=[];return this.bins.forEach((t=>{let i={width:t.width,height:t.height,maxWidth:t.maxWidth,maxHeight:t.maxHeight,freeRects:[],rects:[],options:t.options};t.tag&&(i=Object.assign(Object.assign({},i),{tag:t.tag})),t.freeRects.forEach((e=>{i.freeRects.push({x:e.x,y:e.y,width:e.width,height:e.height})})),e.push(i)})),e}sort(e,t=b.MAX_EDGE){return e.slice().sort(((e,i)=>{const n=t===b.MAX_EDGE?Math.max(i.width,i.height)-Math.max(e.width,e.height):i.width*i.height-e.width*e.height;return 0===n&&e.hash&&i.hash?e.hash>i.hash?-1:1:n}))}get currentBinIndex(){return this._currentBinIndex}get dirty(){return this.bins.some((e=>e.dirty))}get rects(){let e=[];for(let t of this.bins)e.push(...t.rects);return e}}const S=function(){const e=document.createElement("a");return document.body.appendChild(e),e.style.display="none",(t,i)=>{const n=t.toDataURL();e.href=n,e.download=i,e.click()}}(),E=(e,t)=>{const i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),i.setAttribute("download",t),i.click()};var w=i(62330);const T=new d.Z("font-packer"),_={outlineOffset:Number((0,h.h)("outlineOffset",.2)),save:"1"===(0,h.h)("exportfont","0"),saveDefaultFont:"1"===(0,h.h)("exportdefault","0"),verboseChars:!0,verboseFont:!0,perf:{log:!1,marks:{rebuild:"rebuild",kern:"kerning",metrics:"metrics",pack:"pack",texture:"texture",bmfont:"load-bmfont"}}};class BitmapFontPacker{constructor(e,t){this.needsRebuild=!1,this._atlas=new BitmapFontAtlas(this),this._loading=!1,this._loaded=!1,this._addedChars=[],this.charSet=new Set,this.kerningsMap={},this.measureMap={},this.metricsMap={},this.scale=1,this.throttledRebuild=(0,w.P)((()=>{setTimeout((()=>this.rebuild()),0)}),1500),this.options=e,t&&(this.font=t);try{this.canvas=document.createElement("canvas"),this.canvas.width=this.options.width,this.canvas.height=this.options.height;const e=this.canvas&&this.canvas.getContext("2d");if(!e)throw Error("Unable to create canvas context for font-packer");this.ctx=e,this.ctx.fillStyle="white",this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}catch(e){T.error("Failed to create canvas rendering context",e)}if(this.packer=new MaxRectsPacker(this.options.width,this.options.height,2*this.options.texturePadding),this.options.defaultCharset){(function(e=!1){const t=new Set(Array.from("m0123456789_-+'\"` \t")),i=[];e&&i.push([32,127]);for(const e of i)for(let i=e[0];i<e[1];i++)t.add(String.fromCharCode(i));return t})(this.options.defaultCharset===a.ASCII||_.saveDefaultFont).forEach((e=>this.charSet.add(e)))}}get loaded(){return!this._loading&&this._loaded}async loadFont(){let e;_.perf.log&&performance.mark(_.perf.marks.bmfont);const t=`${this.options.fontFamily} for BitmapFontPacker`;if(!this.font){this._loading=!0,e=new FontFace(t,`url("${this.options.fontPath}") format("woff")`,{style:`${this.options.fontStyle}`,weight:`${this.options.fontWeight}`}),e.load();const i=e.loaded;document.fonts.add(e);const n=(await v())(this.options.fontPath),[s]=await Promise.all([n,i]);this.font=s}_.perf.log&&performance.measure(_.perf.marks.bmfont,_.perf.marks.bmfont),this.scale=this.options.fontSize/this.font.unitsPerEm;const i=`${this.options.fontWeight} ${this.options.fontSize}px "${t}"`;return this.ctx.font=i,_.verboseFont&&T.debug({contextFontFace:i,bmfont:this.font,charset:this.charSet}),this._loading=!1,this.fontFilename=`${this.options.fontFamily.toLowerCase()}-${this.options.fontWeight}-${this.options.fontSize}`+(this.options.outline?"-outline-"+this.options.outlineWidth:""),this.needsRebuild=!0,this.throttledRebuild(),{fontPath:this.options.fontPath,font:this.font,packer:this}}addChars(e){const t=this.charSet.size;return Array.from(e).forEach((e=>{this.charSet.has(e)||this._addedChars.push(e),this.charSet.add(e)})),t!==this.charSet.size&&(this.needsRebuild=!0,this.throttledRebuild()),this.needsRebuild}atlas(){return this._atlas}rebuild(){if(!this.font)return;if(this.loaded&&this._addedChars.length<1)return void(this.needsRebuild=!1);_.verboseChars&&(T.debug(`Added ${this._addedChars.length} glyphs: \n${this._addedChars}`),this._addedChars.length=0),performance.mark(_.perf.marks.rebuild),_.perf.log&&performance.mark(_.perf.marks.metrics);const e=this.getAllGlyphMetrics();_.perf.log&&performance.measure(_.perf.marks.metrics,_.perf.marks.metrics),_.perf.log&&performance.mark(_.perf.marks.pack);const t=this.pack(e);_.perf.log&&performance.measure(_.perf.marks.pack,_.perf.marks.pack),_.perf.log&&performance.mark(_.perf.marks.texture);const{chars:i,textures:n}=this.assembleTexture(t);_.perf.log&&performance.measure(_.perf.marks.texture,_.perf.marks.texture),_.perf.log&&performance.mark(_.perf.marks.kern);const s=this.getKerningPairs();_.perf.log&&performance.measure(_.perf.marks.kern,_.perf.marks.kern);const r=this.assembleFont(i,s,n);performance.measure(_.perf.marks.rebuild,_.perf.marks.rebuild),this._loaded=!0,this._atlas.update(n,r);const o=`Rebuilt atlas for ${this.charSet.size} chars with ${r.kernings.length} kerning pairs`;_.perf.log?(T.debug(o,performance.getEntriesByName(_.perf.marks.rebuild,"measure")[0],performance.getEntriesByType("measure").map((e=>({name:e.name,duration:e.duration}))),this.options),Object.values(_.perf.marks).forEach((e=>{performance.clearMarks(e),performance.clearMeasures(e)}))):(T.debug(o,performance.getEntriesByName(_.perf.marks.rebuild,"measure")[0]),performance.clearMarks(_.perf.marks.rebuild),performance.clearMeasures(_.perf.marks.rebuild))}pack(e){return this.packer.bins.length=0,this.packer.addArray(e),this.packer.bins.reverse()}assembleTexture(e){const t=[],i=e.map(((e,i)=>(this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.options.transparent&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),e.rects.forEach((e=>{const n=e.data.charData,s=e.x-n.xoffset,r=e.y+n.height+n.ymin-this.options.texturePadding;this.options.outline&&this.options.outlineWidth>0?function(e,t,i,n,s){const r=e.strokeStyle,o=e.fillStyle,a=e.lineJoin,l=e.miterLimit;e.lineJoin="miter",e.miterLimit=2,e.beginPath(),e.strokeStyle="black",e.lineWidth=s,e.strokeText(t,i,n),e.beginPath(),e.fillStyle="white",e.fillText(t,i,n),e.strokeStyle=r,e.fillStyle=o,e.lineJoin=a,e.miterLimit=l}(this.ctx,e.data.charData.char,s,r,this.options.outlineWidth):this.ctx.fillText(e.data.charData.char,s,r),n.x=e.x,n.y=e.y,n.page=i,t.push(e.data.charData)})),_.save&&S(this.ctx.canvas,`${this.fontFilename}_${i}.png`),this.makeCanvasTexture(i,!1))));return{chars:t,textures:i}}getKerningPairs(){const e=[],t=[...this.charSet.values()].map((e=>this.font.charToGlyphIndex(e))).filter((e=>e>0));for(const i of t)for(const n of t){const t=`${i},${n}`;let s=this.kerningsMap[t];if(!s){s={first:i,second:n,amount:this.font.getKerningValue(i,n)*this.scale},this.kerningsMap[t]=s}s&&0!==s.amount&&e.push(s)}return e}assembleFont(e,t,i){const n=this.font.tables.os2,s=this.font.tables.name.fullName,r=s[Object.getOwnPropertyNames(s)[0]],o={pages:i.map(((e,t)=>`${this.fontFilename}_${t}.png`)),chars:e,info:{face:r,size:this.options.fontSize,bold:0,italic:0,charset:[...this.charSet.values()],unicode:1,stretchH:100,smooth:1,aa:1,padding:[0,0,0,0],spacing:[this.options.texturePadding,this.options.texturePadding],os2version:n.version},common:{lineHeight:(n.sTypoAscender-n.sTypoDescender+n.sTypoLineGap)*this.scale,base:this.font.ascender*this.scale,scaleW:this.options.width,scaleH:this.options.height,pages:this.packer.bins.length,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0},kernings:t};return _.verboseFont&&T.debug({bmFontOutput:o,kerningPairCount:t.length}),_.save&&(E(JSON.stringify(o),`${this.fontFilename}.json`),E(JSON.stringify(this.options,void 0,2),`${this.fontFilename}-pack-options.json`)),o}getMetrics(e){const t=2*this.options.texturePadding,i=this.scale;let n,s,r,o,a,l;const c=this.font.charToGlyph(e),h=0!==c.index;if(h){let t=this.measureMap[e];t||(t=c.getMetrics(),this.measureMap[e]=t),n=(t.xMax-t.xMin)*i,s=(t.yMax-t.yMin)*i,r=t.xMin*i,o=t.yMin*i,a=t.yMax*i,l=c.advanceWidth*i}else{const t=this.measureChar(e);n=t.width,s=t.height,r=t.xMin,o=t.yMin,a=t.yMax,l=n}return{char:e,width:n+t,height:s+t,xmin:r,ymin:o,ymax:a,xadvance:l+(this.options.outline?this.options.outlineWidth*_.outlineOffset:0),supported:h}}measureText(e){if(!this.loaded)return;let t=0;for(const i of Array.from(e)){const{width:e}=this.measureChar(i);t+=e}return t}measureChar(e){let t=this.metricsMap[e];t||(t=this.ctx.measureText(e),this.metricsMap[e]=t);const i=t.actualBoundingBoxLeft+t.actualBoundingBoxRight;return{width:t.width||i,height:t.actualBoundingBoxAscent+t.actualBoundingBoxDescent,xMin:t.actualBoundingBoxLeft,xMax:t.actualBoundingBoxRight,yMin:-t.actualBoundingBoxDescent,yMax:t.actualBoundingBoxAscent}}getAllGlyphMetrics(){const e=[],t=this.font.ascender*this.scale,i=this.options.texturePadding;for(const n of this.charSet.values()){const s=this.getMetrics(n),r={data:{charData:{char:n,id:n.charCodeAt(0),width:s.width,height:s.height,xoffset:s.xmin-i,yoffset:t-s.ymax-i,xadvance:s.xadvance,chnl:15,ymin:s.ymin}},width:s.width,height:s.height};e.push(r)}return e}makeCanvasTexture(e,t){if(t){const e=new Uint8Array(this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data),t=new n.DataTexture(e,this.canvas.width,this.canvas.height,n.RGBAFormat);return t.flipY=!0,t}const i=new n.Texture(this.ctx.canvas);return i.name=`${this.ctx.font}_${e}`,i.format=n.RGBAFormat,i.needsUpdate=!0,i}}const M=new d.Z("FontManager"),x={fontPath:"fonts/roboto-700.woff",fontWeight:700,fontFamily:"Roboto",fontStyle:"normal",fontSize:60,width:2048,height:2048,transparent:!0,defaultCharset:a.ASCII,outline:!1,outlineWidth:4,texturePadding:6},A="1"===(0,h.h)("staticfont","0");class FontManager{constructor(){this.defaultFontOptions=x,this.packerMap=new Map,this.optionsMap=new Map,this.parsedFontMap=new Map}static get instance(){return FontManager._instance||(FontManager._instance=new FontManager),FontManager._instance}getFontId(e=this.defaultFontOptions){const t=Object.assign(Object.assign({},this.defaultFontOptions),e),i=JSON.stringify(t);return this.optionsMap.set(i,t),i}getFont(e){let t=this.packerMap.get(e);if(!t&&A&&(t=new BitmapFontPackerStatic,t.loadFont(),this.packerMap.set(e,t)),!t){const i=this.optionsMap.get(e)||JSON.parse(e),n=this.parsedFontMap.get(i.fontPath);t=new BitmapFontPacker(i,n),this.packerMap.set(e,t),t.loadFont().then((t=>{M.debug("font loaded",e,t.fontPath),this.parsedFontMap.set(t.fontPath,t.font)}))}return t.atlas()}measureText(e,t){const i=this.packerMap.get(e);if(i)return i.measureText(t)}}var O,P=i(69626),D=i(37342);class Label3DMesh extends n.Mesh{}!function(e){e.WORLD="world",e.NDC="ndc"}(O||(O={}));class Label3D extends n.Object3D{constructor(e,t=FontManager.instance,r=O.WORLD){super(),this.config=e,this.fontManager=t,this.scaleType=r,this.update=()=>{const e=this.resolvedConfig;this.textGeometry.update(e),this.textGeometry.computeBoundingBox();const t=this.textGeometry.layout.lineHeight-this.textGeometry.layout.baseline;this.labelTextMesh.position.x=-.5*this.textGeometry.layout.width+t,this.labelTextMesh.position.y=-.5*this.textGeometry.layout.height+t,this.labelTextMesh.position.z=.25,this.unscaledWidth=this.textGeometry.layout.width+this.config.backgroundBorderWidth,this.unscaledHeight=this.textGeometry.layout.height+this.config.backgroundBorderHeight,(this.labelBackgroundMesh||this.config.backgroundAsCollider)&&this.labelBackgroundMesh.scale.set(this.unscaledWidth,this.unscaledHeight,.01),this.aspect=this.unscaledWidth/Math.max(this.unscaledHeight,.001),this.fontHeightToMeters=1/e.font.info.size,this.updateScale(),this._onGeomUpdate&&this._onGeomUpdate()};const a=void 0!==this.config.opacity?this.config.opacity:1;if(this.config.background||this.config.backgroundAsCollider){this.config.backgroundOpacity=void 0!==this.config.backgroundOpacity?this.config.backgroundOpacity:1,this.config.backgroundOpacity=this.config.background?this.config.backgroundOpacity:0;const t=new n.BoxGeometry(1,1,.01),i=new n.MeshBasicMaterial({color:e.backgroundColor,transparent:!0,depthTest:this.config.backgroundOpacity>0&&!e.disableDepth,depthWrite:this.config.backgroundOpacity>0&&!e.disableDepth,opacity:this.config.backgroundOpacity,stencilRef:1,stencilFail:n.KeepStencilOp,stencilZFail:n.KeepStencilOp,stencilZPass:n.ReplaceStencilOp,stencilFunc:n.AlwaysStencilFunc,stencilWrite:!0});this.labelBackgroundMesh=new this.config.backgroundColliderType(t,i),this.labelBackgroundMesh.position.z=-.25,this.labelBackgroundMesh.name="Label Background",this.collider=this.labelBackgroundMesh,this.add(this.labelBackgroundMesh)}const c={outline:this.config.outline,outlineWidth:this.config.outlineWidth},h={uniforms:{map:{type:"t",value:(d=Object.assign(Object.assign({},c),{color:e.color,opacity:a})).map},color:{type:"c",value:new n.Color(d.color)},opacity:{type:"f",value:d.opacity}},vertexShader:i(60948),fragmentShader:i(45576)};var d;const u=new n.RawShaderMaterial({uniforms:h.uniforms,fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,side:n.DoubleSide,transparent:!0,depthTest:!1,depthWrite:!1,opacity:a});u.name="Label Text",this.fontId=this.fontManager.getFontId(c);const p=this.fontManager.getFont(this.fontId);u.uniforms.map.value=p.textures[0],p.onChanged((()=>{u.uniforms.map.value=p.textures[0],this.update()}));const m=this.resolvedConfig,g=m.font;this.textGeometry=o(m),this.labelTextMesh=new Label3DMesh(this.textGeometry,u),this.labelTextMesh.name="Label Text",this.labelTextMesh.renderOrder=10;const f=(new n.Quaternion).setFromAxisAngle(l.f.FORWARD,(0,s.Id)(180)),v=(new n.Quaternion).setFromAxisAngle(l.f.UP,(0,s.Id)(180));this.labelTextMesh.quaternion.multiply(f).multiply(v),this.add(this.labelTextMesh),this.name="Label Container",this.fontHeightToMeters=1/g.info.size,this.scaleFactor=e.scale||this.fontHeightToMeters,this.update()}get resolvedConfig(){let e;if(void 0!==this.config.wordWrapWidth){const t=this.fontManager.measureText(this.fontId,this.config.text);void 0!==t&&t>this.config.wordWrapWidth&&(e=this.config.wordWrapWidth)}const t=this.fontManager.getFont(this.fontId);return Object.assign(Object.assign({},this.config),{font:t.fontData,texture:t.textures[0],width:e})}onGeomUpdate(e){this._onGeomUpdate=e}updateScale(){const e=this.config.scale*this.fontHeightToMeters;this.scale.set(e,e,e)}get text(){return this.config.text}set text(e){e!==this.name&&(this.config.text=e,this.name=e,this.fontManager.getFont(this.fontId).addCharsIfNeeded(e),this.update())}get mesh(){return this.labelTextMesh}get scaleFactor(){return this.config.scale}set scaleFactor(e){this.scaleFactor!==e&&(this.config.scale=e,this.updateScale())}get opacity(){return void 0!==this.config.opacity?this.config.opacity:1}set opacity(e){if(e!==this.config.opacity){this.config.opacity=e;const t=e>0&&!this.config.disableDepth;if(this.config.background){const i=this.labelBackgroundMesh.material;i.opacity=Math.min(this.config.backgroundOpacity||1,e),i.depthWrite=e>D.iV.DEPTH_WRITE_THRESHOD,i.depthTest=t}const i=this.labelTextMesh.material;i.uniforms.opacity.value=e,i.depthTest=t,this.visible=e>0}}setColorHex(e){const t=this.labelTextMesh.material.uniforms.color;t.value.getHex()!==e&&t.value.setHex(e)}setRenderLayer(e){this.labelTextMesh.layers.mask=e.mask,this.labelBackgroundMesh&&(this.labelBackgroundMesh.layers.mask=e.mask)}setRenderOrder(e){this.renderOrder=e,this.labelTextMesh.renderOrder=e,this.labelBackgroundMesh&&(this.labelBackgroundMesh.renderOrder=e)}setPosition(e,t=(e=>e)){this.position.copy(t(e))}setOrientation(e,t=0){this.quaternion.copy(e),0!==t&&this.rotateZ(-t*s.Ue)}scaleBillboard(e,t,i,n,s,o,a=C.SCALE_DEFAULT){if(0!==i.elements[15])this.scaleFactor=.2*a*n*(C.ORTHO_IDEAL_HEIGHT/s);else{const l=(0,c.D_)(this.position,e,t,i.asThreeMatrix4()),h=Math.abs(l.x);if(h<1){const t=(0,P.mY)(i,e,this.position,s,a),l=((0,r.uZ)(o,1,2.5)+n)*C.SCALE_ASPECT,c=1+C.SCALE_NDC-h*C.SCALE_NDC-l,d=Math.max(Math.min(1/t*c,3),.001);this.scaleType===O.NDC?this.scaleFactor=d:this.scaleFactor=Math.min(d*C.NDC_MULT,a*C.SCALE_WORLD)}else this.scaleFactor=.001}this.updateScale()}}const C={SCALE_DEFAULT:.1,SCALE_WORLD:Number((0,h.h)("scale_world",4)),SCALE_NDC:.5,SCALE_ASPECT:.035,DEPTH_WRITE_THRESHOD:.15,ORTHO_IDEAL_HEIGHT:1500,NDC_MULT:1.15}},42530:(e,t,i)=>{"use strict";i.d(t,{u:()=>Label3DFactory});var n=i(78959),s=i(2212);class Label3DFactory{constructor(e){this.currentTextConfig=Label3DFactory.defaultTextConfig,e?this.updateTextStyle(e):this.updateTextStyle(Label3DFactory.defaultTextConfig)}updateTextStyle(e){this.currentTextConfig=Object.assign(Object.assign({},this.currentTextConfig),e)}createLabel(e={text:""}){return new n.$(Object.assign(Object.assign({},this.currentTextConfig),e))}static makeConfig(e){return Object.assign(Object.assign({},this.defaultTextConfig),e)}}Label3DFactory.defaultTextConfig={text:"",align:"center",wordWrapWidth:void 0,color:"black",backgroundColor:"white",backgroundBorderWidth:50,backgroundBorderHeight:30,background:!0,backgroundAsCollider:!0,backgroundColliderType:s.Mesh,scale:1,outline:!1,outlineWidth:4}},58232:(e,t,i)=>{"use strict";i.d(t,{P:()=>CircularBuffer});class CircularBuffer{constructor(e){this.size=e,this.index=0,this.buffer=[]}push(e){this.index>=this.size&&(this.index=0),this.buffer[this.index]=e,this.index++}peek(){return this.buffer[this.index<=this.buffer.length?this.index-1:0]||null}getList(){return this.buffer}*[Symbol.iterator](){yield*this.buffer}clear(){this.buffer=[],this.index=0}}},24764:(e,t,i)=>{"use strict";i.d(t,{s:()=>Comparator});class Comparator{constructor(e){this.matcher=e}static isValue(e){return new Comparator(new ValueMatcher(e))}static isType(e){return new Comparator(new TypeMatcher(e))}static isInstanceOf(e){return new Comparator(new InstanceMatcher(e))}static is(e){return new Comparator(new PredicateMatcher(e))}static isAny(){return new Comparator(new AnyMatcher)}compare(e){return this.matcher.matches(e)}}class ValueMatcher{constructor(e){this.value=e}matches(e){return this.value===e}}class TypeMatcher{constructor(e){this.type=e}matches(e){return Object.getPrototypeOf(e).constructor===this.type}}class InstanceMatcher{constructor(e){this.type=e}matches(e){if("object"==typeof e)return e instanceof this.type;const t=this.type;switch(typeof e){case"number":return t===Number;case"string":return t===String;case"boolean":return t===Boolean;case"function":return t===Function}return!1}}class PredicateMatcher{constructor(e){this.predicate=e}matches(e){return this.predicate(e)}}class AnyMatcher{constructor(){}matches(){return!0}}},13188:(e,t,i)=>{"use strict";i.d(t,{l1:()=>o,r2:()=>c});var n=i(2212),s=i(7170),r=i(12216);var o;!function(e){e[e.Axes=1]="Axes",e[e.PlanarAxes=2]="PlanarAxes",e[e.EdgesAndPlanarAxes=3]="EdgesAndPlanarAxes",e[e.Edges=4]="Edges",e[e.Free=5]="Free",e[e.Locked=6]="Locked"}(o||(o={}));const a={[r.e.UP]:{dir:Object.freeze(r.f.UP.clone())},[r.e.DOWN]:{dir:Object.freeze(r.f.DOWN.clone())},[r.e.BACK]:{dir:Object.freeze(r.f.BACK.clone())},[r.e.LEFT]:{dir:Object.freeze(r.f.LEFT.clone())},[r.e.RIGHT]:{dir:Object.freeze(r.f.RIGHT.clone())},[r.e.FORWARD]:{dir:Object.freeze(r.f.FORWARD.clone())}},l={[r.e.HORIZONTAL_PLANE]:{dir:Object.freeze(r.f.HORIZONTAL_PLANE.clone())}},c=(()=>{let e=0;const t=new n.Vector3,i=new n.Vector3,c=new n.Vector3,h=new n.Vector3,d=999,u=Object.freeze(r.f.ZERO.clone()),p=Object.keys(a).map((e=>Object.assign(Object.assign({},a[e]),{name:e,angleTo:d}))),m=Object.keys(l).map((e=>Object.assign(Object.assign({},l[e]),{name:e,angleTo:d}))),g=e=>(e+3)%2;let f=p[0];return(n,a,l=o.Axes)=>{if(l===o.Free)return{position:a.clone(),constrainedAxis:u,axisName:r.e.NONE};if(p.forEach((e=>e.angleTo=d)),m.forEach((e=>e.angleTo=d)),c.copy(a).sub(n),e=c.length(),e<.05)return{position:a.clone(),constrainedAxis:u,axisName:r.e.NONE};h.copy(c).normalize();const v=.05*Math.min(e,1);if(l!==o.Locked){for(const e of p){const t=(0,s.ZY)(h.angleTo(e.dir));t<f.angleTo&&(f=e),e.angleTo=t}if(f.angleTo>20){const e=Math.abs(c.y);e*e<v&&(f=m[0])}}t.set(n.x*g(f.dir.x),n.y*g(f.dir.y),n.z*g(f.dir.z)),i.set(a.x*Math.abs(f.dir.x),a.y*Math.abs(f.dir.y),a.z*Math.abs(f.dir.z)).add(t);return l===o.Locked||i.distanceToSquared(a)<v?{position:i.clone(),constrainedAxis:f.dir,axisName:f.name}:{position:a.clone(),constrainedAxis:u,axisName:r.e.NONE}}})()},77680:(e,t,i)=>{"use strict";i.d(t,{s:()=>l,n:()=>ExpiringResource});var n=i(10757),s=i(88512),r=i(71918),o=i(64185);const a=new s.Z("expiring-resource");function l(e,t){(0,r.yW)(e,(e=>{e instanceof ExpiringResource&&(e.onStale=t)}))}class ExpiringResource{constructor(e,t){this.value=e,this.validUntil=t}refreshFrom(e){this.value=e.value,this.validUntil=e.validUntil,this.refreshPromise&&(this.refreshPromise.resolve(),this.refreshPromise=void 0)}waitForRefresh(e=1e4){this.refreshPromise||(this.refreshPromise=new o.Q);const t=(0,n.gw)(e).then((()=>{throw new Error("Waiting for resource url refresh timed out")}));return Promise.race([this.refreshPromise.nativePromise(),t])}async get(){if(this.validUntil&&this.onStale){const e=Date.now();e+6e4+1e4>this.validUntil.getTime()&&this.onStale(),e+6e4+1e3>this.validUntil.getTime()&&(a.warn("Stale resource, waiting for refresh"),await this.waitForRefresh(),a.info("Refreshed resource"))}return this.value}}},49399:(e,t,i)=>{"use strict";i.d(t,{ZP:()=>LineOctree,FM:()=>SnapLine3,UQ:()=>SnapVector3});var n=i(2212);class LineOctreeNode{constructor(e,t){this.raycast=(()=>{const e=new n.Vector3,t=new n.Box3;return(i,n,s)=>{const r=t.copy(this.bounds).expandByScalar(n);if(i.ray.intersectsBox(r))for(const t of this.children)if(t instanceof LineOctreeNode)t.raycast(i,n,s);else if(t instanceof SnapLine3){const r=e,o=i.ray.distanceSqToSegment(t.start,t.end,void 0,e),a=Math.sqrt(o);a<n&&s.push({distance:i.ray.origin.distanceTo(r),object:t,distanceToRay:a,point:r.clone(),isLineOctreeIntersection:!0})}else if(t instanceof SnapVector3){const e=i.ray.distanceToPoint(t);e<n&&s.push({distance:i.ray.origin.distanceTo(t),object:t,distanceToRay:e,point:t.clone(),isLineOctreeIntersection:!0})}}})(),this.level=t,this.bounds=e.clone(),this.childNodes=[],this.children=[]}add(e){let t=!1;const i=e instanceof n.Line3?[e.start,e.end]:[e];if(this.level<4){0===this.childNodes.length&&this.buildChildNodes();for(const n of this.childNodes)i.every((e=>n.bounds.containsPoint(e)))&&(t=!0,n.add(e))}t||this.children.push(e)}remove(e){const t=e instanceof n.Line3?[e.start,e.end]:[e];for(let i=0;i<this.children.length;i++){const n=this.children[i];if(n instanceof LineOctreeNode){if(t.every((e=>n.bounds.containsPoint(e)))&&n.remove(e))return!0}else if(n===e)return this.children.splice(i,1),!0}return!1}buildChildNodes(){const e=this.bounds.max.clone().sub(this.bounds.min).clone().multiplyScalar(.5);for(let t=0;t<2;t++)for(let i=0;i<2;i++)for(let s=0;s<2;s++){const r=this.bounds.min.x+e.x*s,o=r+e.x,a=this.bounds.min.y+e.y*t,l=a+e.y,c=this.bounds.min.z+e.z*i,h=c+e.z,d=new n.Box3(new n.Vector3(r,a,c),new n.Vector3(o,l,h)),u=new LineOctreeNode(d,this.level+1);this.childNodes.push(u),this.children.push(u)}}spherecast(e,t){if(e.intersectsBox(this.bounds))for(const i of this.children)if(i instanceof LineOctreeNode)i.spherecast(e,t);else if(i instanceof SnapLine3){const s=i.closestPointToPoint(e.center,!0,new n.Vector3);s.distanceTo(e.center)<e.radius&&t.push(new SnapVector3(s,i.floorId,i.roomId))}else i instanceof n.Vector3&&i.distanceTo(e.center)<e.radius&&t.push(i)}traverse(e){for(const t of this.children)t instanceof LineOctreeNode?t.traverse(e):e(t)}}class LineOctree{constructor(e){this.pointCount=0,this.lineCount=0,this.root=new LineOctreeNode(e,0)}add(e){e instanceof n.Line3?this.lineCount++:e instanceof n.Vector3&&this.pointCount++,this.root.add(e)}remove(e){e instanceof SnapLine3?this.lineCount--:e instanceof SnapVector3&&this.pointCount--,this.root.remove(e)}traverse(e){this.root.traverse(e)}raycast(e,t){const i=[];return this.root.raycast(e,t,i),i}}class SnapLine3 extends n.Line3{constructor(e,t,i,n){super(e,t),this.start=e,this.end=t,this.floorId=i,this.roomId=n,this.isSnapLine3=!0}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this.roomId=e.roomId,this.floorId=e.floorId,this}clone(){return new SnapLine3(this.start,this.end,this.floorId,this.roomId)}}class SnapVector3 extends n.Vector3{constructor(e,t,i){super(),this.point=e,this.floorId=t,this.roomId=i,this.isSnapVector3=!0,super.copy(e)}copy(e){return this.point.copy(e.point),this.roomId=e.roomId,this.floorId=e.floorId,this}clone(){return new SnapVector3(this.point,this.floorId,this.roomId)}}},43973:(e,t,i)=>{"use strict";i.d(t,{H:()=>Lock});class Lock{constructor(){this.activePromise=Promise.resolve(new Key)}async lock(){const e=new Promise((async e=>{(await this.activePromise).onUnlock((()=>e(new Key)))})),t=this.activePromise;return this.activePromise=e,t}}class Key{onUnlock(e){this.unlockCB=e}unlock(){this.unlockCB()}}},69626:(e,t,i)=>{"use strict";i.d(t,{Pp:()=>l,s1:()=>c,r0:()=>h,m$:()=>d,D7:()=>u,Ll:()=>p,n0:()=>m,fd:()=>g,Fe:()=>f,YN:()=>v,k2:()=>y,mY:()=>b,_U:()=>S,S3:()=>E,J2:()=>w});var n=i(2212),s=i(36371),r=i(12216),o=i(66363),a=i(68524);const l=e=>!!e&&1===e.elements[15],c=e=>!!e&&(e.elements[15]>0&&e.elements[15]<1),h=((()=>{const e=new n.Object3D,t=new n.Vector3})(),(()=>{const e=new n.Vector3;return(t,i,n,s)=>(e.copy(t).sub(i),e.clampLength(n,s),i.clone().add(e))})()),d=(()=>{const e=new n.Vector3;return(t,i,n,s)=>{e.copy(i).sub(t);const r=Math.atan2(Math.sqrt(Math.pow(e.x,2)+Math.pow(e.z,2)),e.y),o=Math.min(Math.max(n,r),s);return Math.abs(r-o)>Number.EPSILON?u(t,i,r-o,!1):t}})(),u=(()=>{const e=new n.Vector3,t=new n.Vector3;return(i,n,s,o)=>(e.copy(n).sub(i),o?t.copy(r.f.UP):t.copy(e).applyAxisAngle(r.f.UP,-1*Math.PI/2).setY(0).normalize(),e.applyAxisAngle(t,s),n.clone().sub(e))})(),p=(()=>{const e=new n.Vector3,t=new n.Vector3;return(i,s,r)=>(e.copy(i).sub(s).normalize(),t.copy(i).sub(r).normalize(),(new n.Quaternion).setFromUnitVectors(e,t))})(),m=(()=>{const e=new s.M;return(t,i)=>(e.setPosition(t),e.lookAt(t,i,r.f.UP),(new n.Quaternion).setFromRotationMatrix(e.asThreeMatrix4()))})(),g=(()=>{const e=new n.Vector3;return(t,i,n)=>(e.copy(r.f.FORWARD).applyQuaternion(t).normalize(),e.clone().multiplyScalar(-1*n).add(i))})(),f=(()=>{const e=new n.Ray,t=new n.Vector3,i=new n.Vector3;return(n,s,o)=>(i.set(0,0,0),t.copy(r.f.FORWARD).applyQuaternion(s),e.set(n,t),e.intersectPlane(o,i))})(),v=(()=>{const e=new n.Vector3,t=new n.Vector3,i=new n.Vector3,s=new n.Vector3,o=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3],a=new n.Vector3,l=new n.Vector3,c=new n.Vector3,h=new n.Vector3,d=new n.Plane,u=new n.Vector3,p=new n.Ray,g=new n.Vector3,f=new n.Vector3;return(n,v,y,b,S,E)=>{e.copy(r.f.FORWARD).applyQuaternion(v).setY(0),t.copy(e).setY(y).normalize(),s.copy(t).applyAxisAngle(r.f.UP,-Math.PI/2).setY(0).normalize(),i.copy(s).cross(t).normalize();let w=0;const T=b.max,_=b.min,M=[T,_];for(let e=0;e<2;e++){const t=M[e].x;for(let e=0;e<2;e++){const i=M[e].y;for(let e=0;e<2;e++){const n=M[e].z;o[w].set(t,i,n),w++}}}a.copy(_),c.copy(n).setY(_.y);let x=l.copy(a).sub(c).dot(t);o.forEach((e=>{if(e.y===T.y)return;const i=l.copy(e).sub(c).dot(t);i<x&&(a.copy(e),x=i)}));const A=Math.sign(a.dot(s));h.copy(a).setX(a.x===T.x?_.x:T.x),Math.sign(h.dot(s))!==A?d.set(u.set(0,0,-1*Math.sign(a.z)),Math.abs(a.z)):(h.copy(a).setZ(a.z===T.z?_.z:T.z),d.set(u.set(-1*Math.sign(a.x),0,0),Math.abs(a.x))),p.set(n,g.copy(t).multiplyScalar(-1)),p.intersectPlane(d,f);const O=Math.min(Math.abs(f&&f.dot(t)),x);let P=0,D=0;o.forEach((function(e){l.copy(e).sub(n);const t=Math.abs(l.dot(s)),r=Math.abs(l.dot(i));t>P&&(P=t),r>D&&(D=r)}));const C=P/Math.tan(S*E/2),I=D/Math.tan(S/2),L=Math.max(C,I)+Math.abs(O),R=n.clone().add(t.clone().multiplyScalar(1.1*-L));return{position:R,rotation:m(R,n)}}})(),y=((()=>{const e=new n.Matrix4})(),(()=>{const e=new n.Matrix4,t=new n.Vector4})(),(()=>{const e=new n.Vector3;return(t,i,n=r.f.UP)=>{const s=t.angleTo(i);return Math.sign(e.crossVectors(t,i).dot(n))*s}})()),b=((()=>{const e=new s.M,t=new n.Vector3})(),(e,t,i,n,s=1.5)=>{const r=1/e.elements[5];if(l(e))return s*n/(2*r);const o=t.distanceTo(i),a=Math.atan(r);return n*(s/(2*Math.tan(a)*o))}),S=function(){const e=new n.Vector3,t=new n.Matrix4;return(i,n,s)=>{const r=e.set(0,0,-i).applyMatrix4(n).z;return t.copy(n),t.invert(),e.set(2/s,0,r).applyMatrix4(t),e.x}}(),E=e=>1/e.elements[5],w=(()=>{const e=new n.Vector3;return(t,i,n)=>{const s=n.angleTo(r.f.UP),o=Math.abs(s-Math.PI);return s<.2||o<.2?(t.quaternion.setFromUnitVectors(r.f.FORWARD,n),!0):(t.lookAt(e.copy(i).add(n)),!1)}})();(()=>{const e=new n.Vector3,t=new n.Vector3(1e4,1e4,1e4),i=[new n.Line3,new n.Line3,new n.Line3,new n.Line3],s=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3]})()},44382:(e,t,i)=>{"use strict";i.d(t,{mB:()=>n,uU:()=>s});const n=e=>!e||!Object.values(e).filter((e=>0!==e)).length,s=e=>(e=>"object"==typeof e&&"x"in e&&"y"in e)(e)&&"z"in e},7170:(e,t,i)=>{"use strict";i.d(t,{Ue:()=>n,MN:()=>s,Id:()=>r,ZY:()=>o});const n=Math.PI/180,s=180/Math.PI;function r(e){return e*n}function o(e){return e*s}},27408:(e,t,i)=>{"use strict";i.d(t,{uZ:()=>n});const n=function(e,t,i){return Math.max(t,Math.min(e,i))}},66363:(e,t,i)=>{"use strict";i.d(t,{r6:()=>n,wo:()=>s});const n=(e,t,i=1e-5)=>Math.abs(e-t)<=i,s=(e,t,i=1e-5)=>((e,t,i=1e-5)=>n(e.x,t.x,i)&&n(e.y,t.y,i))(e,t,i)&&n(e.z,t.z,i)},8482:(e,t,i)=>{"use strict";function n(e,t,i){return(1-i)*e+i*t}i.d(t,{t:()=>n})},19674:(e,t,i)=>{"use strict";i.d(t,{ep:()=>h,gj:()=>d,EV:()=>u,tf:()=>p,r_:()=>m,zW:()=>g,cb:()=>f,rj:()=>v,jB:()=>y,et:()=>b,dS:()=>S,Z:()=>w,Rq:()=>T,Xe:()=>_,Xv:()=>M});var n=i(2212),s=i(36371),r=i(12216),o=i(27408),a=i(7170);const l=new n.Frustum,c=new s.M;new n.Sphere;var h;!function(e){e.fromVisionVector=function(e){return new n.Vector3(e.x,e.z,-e.y)},e.toVisionVector=function(e){return new n.Vector3(e.x,-e.z,e.y)},e.fromVisionQuaternion=function(e){return new n.Quaternion(e.x,e.z,-e.y,e.w).multiply((new n.Quaternion).setFromAxisAngle(new n.Vector3(0,1,0),(0,a.Id)(90)))},e.fromVisionCameraQuaternion=function(e){return new n.Quaternion(-e.x,-e.z,e.y,-e.w).multiply((new n.Quaternion).setFromAxisAngle(new n.Vector3(1,0,0),(0,a.Id)(90)))},e.toVisionQuaternion=function(e){const t=new n.Quaternion(e.x,e.y,e.z,e.w).multiply((new n.Quaternion).setFromAxisAngle(new n.Vector3(0,1,0),(0,a.Id)(-90)));return t.set(t.x,-t.z,t.y,t.w),t},e.toVisionCameraQuaternion=function(e){return new n.Quaternion(e.x,-e.z,e.y,e.w).multiply(new n.Quaternion(-.70710678118,0,0,.70710678118))}}(h||(h={}));const d=function(e){return new n.Vector3(-e.x,e.y,e.z)},u=function(e){return new n.Quaternion(e.z,e.w,e.x,e.y)},p=function(e){return Math.cos((0,a.Id)(e/2))};function m(e,t,i){return Math.abs(t-e)<=i?t:e+Math.sign(t-e)*i}const g=function(e,t){const i=new n.Vector3(0,0,-1);return i.clone().applyQuaternion(e).angleTo(i.clone().applyQuaternion(t))},f=(e,t,i,n)=>(c.identity().makeRotationFromQuaternion(t).setPosition(e),c.getInverse(c),c.premultiply(i),l.setFromProjectionMatrix(c.asThreeMatrix4()),l.intersectsBox(n)),v=e=>{const t=e.getSize(new n.Vector3),i=Math.max(t.x,t.y,t.z);return(new n.Box3).setFromCenterAndSize(e.getCenter(new n.Vector3),new n.Vector3(i,i,i))},y=(e,t)=>{if(t.length<8)throw new Error("getPointsFromBox3: Result array to small!");t[0].copy(e.min),t[1].copy(e.min),t[1].x=e.max.x,t[2].copy(e.min),t[2].y=e.max.y,t[3].copy(e.min),t[3].z=e.max.z,t[4].copy(e.max),t[5].copy(e.max),t[5].x=e.min.x,t[6].copy(e.max),t[6].y=e.min.y,t[7].copy(e.max),t[7].z=e.min.z},b=(e,t,i,n,s)=>(s-n)*((e-t)/(i-t))+n,S=(e,t,i,n,s)=>{const r=b(e,t,i,n,s);return(0,o.uZ)(r,n,s)};function E(e){return 0===e.x&&0===e.y&&0===e.z}const w=(()=>{const e=new n.Vector3,t=new n.Matrix4;return i=>E(i)?i.clone():(e.copy(r.f.FORWARD).applyQuaternion(i),t.lookAt(r.f.ZERO,e,r.f.UP),(new n.Quaternion).setFromRotationMatrix(t))})(),T=(()=>{const e=new n.Vector3,t=new n.Matrix4;return(i,n)=>E(i)?n.copy(i):(e.copy(r.f.FORWARD).applyQuaternion(i).setY(0).normalize(),t.lookAt(r.f.ZERO,e,r.f.UP),n.setFromRotationMatrix(t))})(),_=(()=>{const e=new n.Vector3,t=new n.Ray;return(i,s,r,o)=>(o=o||new n.Vector3,t.origin.copy(i),t.lookAt(s),o.copy(t.at(r,e)))})(),M=(()=>{const e=new n.Vector3,t=new n.Ray;return(i,s,r,o)=>(o=o||new n.Vector3,t.set(i,s),o.copy(t.at(r,e)))})()},49487:(e,t,i)=>{"use strict";function n(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)}i.d(t,{C:()=>n})},9293:(e,t,i)=>{"use strict";i.d(t,{L:()=>ObjectPool});class ObjectPool{constructor(e){this.comparer=e||this.defaultComparer,this.poolArray=[]}add(e){const t=this.createObjectDescriptor(e);return t.object=e,t.inUse=!0,this.addObjectDescriptorToPool(t),t}get(e){for(const t of this.poolArray)if(!t.inUse&&this.comparer(t,e))return t.inUse=!0,t;return null}free(e){for(const t of this.poolArray)if(t.object===e)return t.inUse=!1,!0;return!1}all(){return this.poolArray}remove(e){const t=this.poolArray.findIndex((t=>t.object===e));return-1!==t&&(this.poolArray.splice(t,1),!0)}defaultComparer(e,t){return!0}createObjectDescriptor(e){return{object:e,inUse:!1}}addObjectDescriptorToPool(e){this.poolArray.push(e)}}},64185:(e,t,i)=>{"use strict";i.d(t,{Q:()=>OpenDeferred});class OpenDeferred{constructor(){this.base=new Promise(((e,t)=>{this.resolver=e,this.rejecter=t})),this._promise=new OpenPromise(this.base,this),this.progressCallbacks=[]}then(e,t){return this.base.then(e,t)}catch(e){return this.base.catch(e)}resolve(e){return this.resolver(e),this}reject(e){return this.rejecter(e),this}notify(e){for(const t of this.progressCallbacks)t(e)}progress(e){return this.progressCallbacks.push(e),this}promise(){return this._promise}nativePromise(){return this.base}static resolve(){const e=new OpenDeferred;return e.resolve(),e.promise()}static reject(e){const t=new OpenDeferred;return t.reject(e),t.promise()}static all(e){const t=[];for(const i of e)i.nativePromise?t.push(i.nativePromise()):t.push(i);const i=new OpenDeferred;return Promise.all(t).then((e=>i.resolve(e)),(e=>i.reject(e))),i.promise()}}class OpenPromise{constructor(e,t){this.basePromise=e,this.baseDeferred=t}then(e,t){return this.baseDeferred.then(e,t),this}catch(e){return this.baseDeferred.catch(e),this}progress(e){return this.baseDeferred.progress(e),this}nativePromise(){return this.basePromise}}},38493:(e,t,i)=>{"use strict";i.d(t,{Z:()=>OrderedMap});const n=e=>""+e;class OrderedMap{constructor(e=n){this.mappingFunction=e,this.list=[],this.map={}}add(e){const t=this.mappingFunction(e);return!this.map[t]&&(this.list.push(e),this.map[t]=e,!0)}set(e){const t=this.mappingFunction(e);return this.map[t]?(this.map[t]=e,!0):(this.add(e),!0)}count(){return this.list.length}*[Symbol.iterator](){for(const e of this.list)yield e}getByIndex(e){return this.list[e]}get(e){return this.map[e]}copyToList(e){return e.push.apply(e,this.list),e}clear(){this.list=[],this.map={}}mapElements(e){return this.list.map(e)}}},17486:(e,t,i)=>{"use strict";i.d(t,{a:()=>PersistentStorage});class VariableContainer{constructor(e){this._value=e}value(){return this._value}set(e){this._value=e}}class PersistentStorage{constructor(){this.storage={}}get(e,t){let i=this.storage[e];return i||(i=t(),this.storage[e]=i),i}getNumber(e){return this.get(e,(()=>new VariableContainer(0)))}getString(e){return this.get(e,(()=>new VariableContainer("")))}getArray(e){return this.get(e,(()=>[]))}getNumberMap(e){return this.get(e,(()=>({})))}getStringMap(e){return this.get(e,(()=>({})))}}},87324:(e,t,i)=>{"use strict";i.d(t,{m:()=>s,J5:()=>r,Ex:()=>o});var n=i(10757);function s(e){return{x:e.x,y:e.y,z:e.z}}function r(e){return{x:e.x||e._x,y:e.y||e._y,z:e.z||e._z,w:e.w||e._w}}function o(e){return`#${(0,n.Q_)(255*e.r,2,"0",16)}${(0,n.Q_)(255*e.g,2,"0",16)}${(0,n.Q_)(255*e.b,2,"0",16)}`}},53225:(e,t,i)=>{"use strict";i.d(t,{E:()=>TypedMesh});var n=i(2212);class TypedMesh extends n.Mesh{constructor(e,t){super(e,t)}}},17131:(e,t,i)=>{"use strict";i.d(t,{z:()=>AnimatedNumber});var n=i(79437),s=i(23573);const r=new(i(88512).Z)("animation");class AnimatedNumber extends s.T{constructor(e,t,i,s=n.vG,r=0){super(),this._easing=n.vG,void 0===t&&(t=e),void 0===i&&(this._active=!1,i=0,this._elapsed=0,this._duration=0),this.modifyAnimation(e,t,i,s,0,r)}get active(){return this._active}get duration(){return this._duration}get endValue(){return this._endValue}get easing(){return this._easing}get elapsed(){return this._elapsed}tick(e){if(!this._active)return this.endValue;if(this._delay>0)return this._delay-=e,this.startValue;const t=(this._elapsed+e)/Math.max(this._duration,1e-5);return this.updateProgress(t),this.value}updateProgress(e){if(isNaN(e))return void r.error(`Invalid progress value: ${e}`);const t=Math.max(0,Math.min(e,1)),i=this.active,n=this.value;if(t>=1)return this.activate(!1),this.value=this.endValue,this._elapsed=this.duration,this.commit(),void(this._onComplete&&this._onComplete());this.activate(!0),this.value=this._easing(t,this.startValue,this._endValue-this.startValue,1),this._elapsed=t*this.duration,n===this.value&&i===this.active||this.commit()}updateAbsolute(e){const t=e/Math.max(this._duration,1e-5);this.updateProgress(t)}modifyAnimation(e,t,i,s=n.vG,r=0,o=0){return this._easing=s,this._endValue=t,this._duration=i,this.activate(this._duration>=0&&e!==t),this._elapsed=r,this._delay=o,this.startValue=e,this.value=e,this.commit(),this}onComplete(e){return this._onComplete=e,this}activate(e){this._active=e}copy(e){this._endValue=e.endValue,this._duration=e.duration,this._active=e.active,this._easing=e.easing,this._elapsed=e.elapsed,this.startValue=e.startValue,this.value=e.value,this.commit()}clone(){const e=new AnimatedNumber(0);return e.copy(this),e}stop(e){this._active=!1,this._elapsed=this._duration,this.value=e,this._endValue=e,this.commit()}equals(e){return this._active===e._active&&this.duration===e.duration&&this.easing===e.easing&&this.elapsed===e.elapsed&&this.endValue===e.endValue&&this.startValue===e.startValue&&this.value===e.value}}},14063:(e,t,i)=>{"use strict";i.d(t,{b:()=>n});const n=(e,t)=>{if(0!==e.length)for(let i=0;i<e.length;i++){e[i]===t&&e.splice(i,1)}}},53931:(e,t,i)=>{"use strict";i.d(t,{g$:()=>n,LP:()=>s,lZ:()=>r});const n=16/9,s=1/n,r=function(e,t){return Math.min(Math.max(t/e,s),1)*e}},14624:(e,t,i)=>{"use strict";i.d(t,{V:()=>n});const n=function(e,t){if(t.setLength(0),0===e.length)return t;let i=0;for(const n of e)t.add(n),i++;return t.divideScalar(i),t}},60771:(e,t,i)=>{"use strict";i.d(t,{dy:()=>s,tq:()=>r,_1:()=>o,s:()=>a,V5:()=>l,Kr:()=>c,w1:()=>h,Dt:()=>d,Ot:()=>u,Jm:()=>p,J1:()=>m,yL:()=>g,AO:()=>f,UD:()=>v,Vf:()=>y,Hx:()=>b,mI:()=>S,rm:()=>E,O6:()=>w,Zx:()=>T,Qg:()=>_,PI:()=>M,ht:()=>x,OV:()=>A});const n=new(i(88512).Z)("util-browser"),s=()=>{const e=window.innerWidth/window.innerHeight;return isFinite(e)?e:1},r=function(){const e=navigator.userAgent||navigator.vendor,t=new RegExp("(android|bbd+|meego).+mobile|android|avantgo|bada/|blackberry|blazer|compal|elaine|fennec|\n    hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|\n    palm( os)?|phone|p(ixi|re)/|plucker|pocket|psp|series(4|6)0|symbian|treo|up.(browser|link)|vodafone|\n    wap|windows ce|xda|xiino","i"),i=new RegExp("1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|\n    amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|\n    br(e|v)w|bumb|bw-(n|u)|c55/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|\n    devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|\n    g560|gene|gf-5|g-mo|go(.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|\n    a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|\n    jemu|jigs|kddi|keji|kgt( |/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|/(k|l|u)|50|54|-[a-w])|libw|lynx|\n    m1-w|m3ga|m50/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|\n    zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|\n    nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|\n    po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55/|\n    sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|\n    sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|\n    tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|\n    vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|\n    zeto|zte-","i");return(t.test(e)||i.test(e.substr(0,4))||o())&&!u()},o=()=>{const e=window.navigator.userAgent;return/iPad/.test(e)||l()&&navigator.maxTouchPoints>1},a=()=>{const e=window.navigator.userAgent;return/iPod|iPhone/.test(e)||l()&&navigator.maxTouchPoints>1},l=()=>{const e=window.navigator.platform;return/MAC/.test(e.toUpperCase())},c=()=>{const e=window.navigator.platform;return/WIN/.test(e.toUpperCase())},h=()=>{const e=window.navigator.userAgent;return/Trident\//.test(e)},d=()=>-1!==window.navigator.userAgent.indexOf("Android"),u=()=>-1!==window.navigator.userAgent.indexOf("OculusBrowser"),p=()=>"ontouchstart"in window,m=()=>"share"in navigator&&(r()||o()),g=()=>window.parent!==window,f=e=>{const t=/[#&?]([^=]+)=([^#&?]+)/g;e=e||window.location.href;const i={};let n;for(;null!==(n=t.exec(e));)i[n[1]]=decodeURIComponent(n[2]);return i},v=()=>window.location.search.substr(1).split("&"),y=(e,t=!1)=>{const i=Object.keys(e).map((t=>t+"="+e[t])).join("&"),n=`${window.location.origin}${window.location.pathname}?${i}`;t?window.history.pushState({},"",n):window.location.replace(n)},b=function(){const e=window.URL||window.webkitURL,t=document.createElement("a");return document.body.appendChild(t),t.style.display="none",(i,n)=>{const s=e.createObjectURL(i);t.href=s,t.download=n,t.click(),e.revokeObjectURL(s)}}(),S=()=>s()>1,E=function(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)},w=function(){return!r()&&!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled)},T=function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},_=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()};function M(e){try{return document.featurePolicy.allowsFeature(e)}catch(t){return n.warn(t),n.warn(`Feature Policy check failed, defaulting ${e} to false.`),!1}}const x=()=>(e=>{const t={language:"en",region:void 0,script:void 0,ext:void 0},i=new RegExp([/^([a-z]{2,3})/,/(?:[_-]([ut]{1}[_-][a-z\-\_]+))?/,/(?:[_-]([a-z]{4}))?/,/(?:[_-]([a-z]{2}))?$/].map((e=>e.source)).join(""),"i").exec(e);if(i){const[,e,n,s,r]=i;Object.assign(t,{language:e,ext:n,script:s,region:r})}return t})(navigator.language).language||"";function A(){return"createImageBitmap"in window&&!a()&&!o()}},55356:(e,t,i)=>{"use strict";i.d(t,{G1:()=>a,rn:()=>l,D5:()=>c,Ex:()=>h});var n=i(2212),s=i(10757);const r=()=>Math.random(),o={},a=(e,t=r())=>(o[t]||(o[t]=new n.Vector4(r(),r(),r(),e)),o[t]),l=()=>new n.Color(r(),r(),r()),c=e=>"object"==typeof e&&"r"in e&&"g"in e&&"b"in e;function h(e){return`#${(0,s.Q_)(255*e.r,2,"0",16)}${(0,s.Q_)(255*e.g,2,"0",16)}${(0,s.Q_)(255*e.b,2,"0",16)}`}},31879:(e,t,i)=>{"use strict";i.d(t,{U:()=>s,p:()=>r});const n=new Object,s=e=>{if(e){const t=e.valueOf();if(!isNaN(t))return e.toISOString()}return(new Date).toISOString()},r=(e,t=n)=>{if(e){const t=new Date(e);if(!isNaN(t.valueOf()))return t}return t===n?new Date:t}},98292:(e,t,i)=>{"use strict";i.d(t,{D:()=>n});const n=(e,t=250)=>{let i;return(...n)=>{window.clearTimeout(i),i=window.setTimeout((()=>e.apply(null,n)),t)}}},48711:(e,t,i)=>{"use strict";i.d(t,{_F:()=>s,zy:()=>r,XJ:()=>o});const n=.3048,s=e=>e*n,r=e=>e/n,o=e=>{const t=e/n;let i=Math.floor(t),s=12*t%12;return 12===Math.round(s)?(i+=1,s=0):s=Math.round(s),{feet:i,inches:s}}},79437:(e,t,i)=>{"use strict";i.d(t,{vG:()=>r,FG:()=>o,hl:()=>a,to:()=>l,Q9:()=>c,w2:()=>h,qb:()=>d,Fs:()=>u,e3:()=>p,tf:()=>m});var n=i(69436),s=i.n(n);const r=function(e,t,i,n){return i*e/n+t},o=function(e,t,i,n){return i*(e/=n)*e+t},a=function(e,t,i,n){return-i*(e/=n)*(e-2)+t},l=function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},c=function(e,t,i,n){return i*(e/=n)*e*e+t},h=function(e,t,i,n){return e/=n,i*(--e*e*e+1)+t},d=function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e+t:i/2*((e-=2)*e*e+2)+t},u=function(e,t,i,n){return-i/2*(Math.cos(Math.PI*e/n)-1)+t},p=(e,t,i,n,s)=>{let r=t;if(s>0){const t=(1-Math.max(s,0))*Math.abs(n);r=i<=t?0:e(i-t,0,1,t)}return r};function m(e,t,i,n){const r=new(s())(e,t,i,n);return(e,t,i,n)=>{const s=e/n;return t+i*r.solve(s)}}},74002:(e,t,i)=>{"use strict";i.d(t,{bX:()=>n,z6:()=>s});const n=e=>void 0!==e.pointerId,s=e=>void 0!==e.changedTouches},74384:(e,t,i)=>{"use strict";i.d(t,{q:()=>r,A:()=>l});var n=i(2212),s=i(12216);function r(e){if(0===e.length)throw Error("Can't merge empty list of geometries");if(1===e.length)return e[0];let t=0,i=0,s=0,r=0;const a=new n.Box3;for(const n of e)n.index&&(t+=n.index.count,i+=n.getAttribute("position").count,n.getAttribute("uv")&&(s+=n.getAttribute("uv").count),n.boundingBox&&(a.union(n.boundingBox),r++));const c=new n.BufferGeometry;r!==e.length||a.isEmpty()?c.computeBoundingBox():c.boundingBox=a,a.copy(l(c)),c.boundingSphere=a.getBoundingSphere(new n.Sphere);const h=o(new Float32Array(3*i),"position",e);c.setAttribute("position",new n.BufferAttribute(h,3));const d=function(e,t){let i=0,n=0;for(const s of t){const t=s.index;for(let s=0;s<t.array.length;s++)e[i+s]=t.array[s]+n;i+=t.array.length,n+=s.getAttribute("position").count}return e}(new Uint32Array(t),e);if(c.setIndex(new n.BufferAttribute(d,1)),s){const t=o(new Float32Array(2*s),"uv",e);c.setAttribute("uv",new n.BufferAttribute(t,2))}return c}function o(e,t,i){let n=0;for(const s of i){const i=s.getAttribute(t);e.set(i.array,n),n+=i.array.length}return e}const a=new n.Box3(s.f.ZERO,s.f.UNIT);function l(e){return e.boundingBox||e.computeBoundingBox(),e.boundingBox||a}},10757:(e,t,i)=>{"use strict";i.d(t,{gw:()=>s,Ig:()=>r,XN:()=>o,Yv:()=>a,TH:()=>l,Jq:()=>c,Pe:()=>h,DZ:()=>d,Q_:()=>u,O1:()=>p,$B:()=>m,ow:()=>g,nr:()=>f,aS:()=>v,lY:()=>y});var n=i(1030);const s=function(e){return new Promise(((t,i)=>{setTimeout(t,e)}))},r=e=>{let t,i=-1;return{promise:new Promise(((n,s)=>{t=n,i=window.setTimeout(n,e)})).then((()=>{i=-1})),cancel:()=>{-1!==i&&(window.clearTimeout(i),t())}}},o=function(e){const t={};for(const i of e)t[i]=i;return t},a=function(e){return!e.replace(/\n/g,"").trim().length},l=function(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0},c=function(e,t){const i=Math.min(e.length,t.length);for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0},h=function(e,t,i=!0){if(0===e.length)return null;i&&e.sort((function(e,t){return e-t}));const n=t/100;return e[Math.floor(e.length*n)]},d=function(e){return[u(e.getMonth()+1),".",u(e.getDate()),".",e.getFullYear(),"_",u(e.getHours()),".",u(e.getMinutes()),".",u(e.getSeconds())].join("")},u=function(e,t=2,i="0",n=10){const s=e.toString(n),r=t-s.length+1;return r>0?new Array(r).join(i)+s:s},p=function(e){let t="";const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<e;n++)t+=i.charAt(Math.floor(Math.random()*i.length));return t},m=e=>{const t=[];for(let i=0;i<e.length;i+=8192)t.push(String.fromCharCode.apply(null,e.subarray(i,i+8192)));return btoa(t.join(""))},g=(e=[])=>{const t={};for(const i of e)t[i]=!0;return t};function f(e,t){return e.hasOwnProperty(t)}const v=(e,t,i="...")=>e.length<t?e:`${e.substr(0,t)}${i}`,y=(e,t,i)=>{if(!(Math.abs(e)<4294967295)||!(t<32)||!(i<32))throw new n.Z("argument out of range");const s=1&(e>>>t^e>>>i);return(e^=s<<t|s<<i)>>>0};(()=>{const e={}})()},36169:(e,t,i)=>{"use strict";i.d(t,{h:()=>s});const n=new(i(88512).Z)("passive-support"),s=(()=>{let e=!1;try{const t=Object.defineProperty({},"passive",{get:()=>{e=!0}});return window.addEventListener("testPassive",(()=>{}),t),window.removeEventListener("testPassive",(()=>{}),t),e}catch(e){return n.warn(`Passive Option for addEventListener is not supported, Safari zoom may not perform as expected: ${e}`),!1}})()},98612:(e,t,i)=>{"use strict";i.d(t,{fp:()=>s,m8:()=>r});const n=new(i(88512).Z)("util-browser"),s=function(e,t){if(!("localStorage"in window))return t;let i;try{i=window.localStorage.getItem(e)}catch(e){return n.debug(e),t}return null===i?t:"boolean"==typeof t?"true"===i:"number"==typeof t?parseFloat(i):i},r=function(e,t){try{window.localStorage.setItem(e,t)}catch(e){n.error(e)}}},88512:(e,t,i)=>{"use strict";i.d(t,{Z:()=>Logger});const n=window.navigationStart||Date.now();var s;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG"}(s||(s={}));class Logger{constructor(e){this.timers={},this.handlers={[s.DEBUG]:console.debug,[s.INFO]:console.info,[s.WARN]:console.warn,[s.ERROR]:console.error};const t=e.split(new RegExp("/|\\\\"));this.prefix="["+t[t.length-1].replace(".js","")+"]"}message(e){if(Logger.level>=e&&console){return(this.handlers[e]?this.handlers[e]:console.log).bind(console,this.getPrefix())}return()=>{}}get debug(){return this.message(s.DEBUG)}get debugWarn(){return this.message(Logger.level>=s.DEBUG?s.WARN:s.DEBUG)}get info(){return this.message(s.INFO)}get warn(){return this.message(s.WARN)}get error(){return this.message(s.ERROR)}time(e){Logger.level>=s.DEBUG&&(this.timers[e]=Date.now())}timeEnd(e){if(Logger.level>=s.DEBUG){const t=this.timers[e];if(!t)return;const i=(Date.now()-t)/1e3;this.debug(e,i+"s")}}getPrefix(){const e=(Date.now()-n)/1e3+"s";return`${this.prefix} ${e}`}}Logger.level=s.INFO},71918:(e,t,i)=>{"use strict";function n(e={},t){return t.split(".").reduce(((e,t)=>e&&e[t]),e)}function s(e){const t={};for(const i in e)t[e[i]]=i;return t}function r(e,t){if(null!==e&&"object"==typeof e)for(const i in e)t(e[i],i,e),r(e[i],t)}i.d(t,{qw:()=>n,Sc:()=>s,yW:()=>r})},84933:(e,t,i)=>{"use strict";function n(e=11){let t="";const i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<e;n++)t+=i.charAt(Math.floor(Math.random()*i.length));return t}function s(e,t){return function(e,t){return(e%t+t)%t}(function(e){let t,i=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n),i=(i<<5)-i+t,i|=0;return i}(e),t)}i.d(t,{f:()=>n,W:()=>s})},18654:(e,t,i)=>{"use strict";i.d(t,{m5:()=>r,an:()=>o});const n="referrer";let s="";function r(e){let t;try{t=new URL(e)}catch(t){return e}return t.searchParams.set(n,o()),t.href}function o(){return(function(){if(!window.document.referrer)return!1;let e;try{e=new URL(window.document.referrer)}catch(e){return!1}return e.origin===window.location.origin}()?function(){const e=new URL(window.location.href);if(!e.searchParams.has(n))return s;const t=e.searchParams.get(n)||"";try{new URL(t),s=t}catch(e){}return e.searchParams.delete(n),window.history.replaceState(null,"",e.href),s}():"")||window.document.referrer}},85917:(e,t,i)=>{"use strict";i.d(t,{g_:()=>s,i5:()=>r,iv:()=>c,T8:()=>u,kp:()=>g});var n=i(44283);var s,r;!function(e){e[e.RESIZE=1]="RESIZE",e[e.ORIENTATION_CHANGED=2]="ORIENTATION_CHANGED"}(s||(s={})),function(e){e[e.PORTRAIT=1]="PORTRAIT",e[e.LANDSCAPE=2]="LANDSCAPE"}(r||(r={}));let o=[],a=[];const l=window.visualViewport,c=()=>({w:l?l.width:window.innerWidth,h:l?l.height:window.innerHeight}),h=c(),d=new n.ne((()=>h),(e=>o.push(e)),(e=>{o=o.filter((t=>t!==e))})),u=()=>({orientation:window.innerWidth>window.innerHeight?r.LANDSCAPE:r.PORTRAIT});let p=u();const m=new n.ne((()=>p),(e=>a.push(e)),(e=>{a=a.filter((t=>t!==e))}));function g(e,t){switch(e){case s.RESIZE:return d.createSubscription(t);case s.ORIENTATION_CHANGED:return m.createSubscription(t)}}const f=(()=>{let e,t;return()=>{const i=c(),n=()=>{window.clearInterval(e),window.clearTimeout(t)};n();const s=()=>{h.w===i.w&&h.h===i.h||(h.w=i.w,h.h=i.h,(()=>{if(o.length>0&&o.forEach((e=>e(h))),a.length>0){const e=u();e!==p&&(p=e,a.forEach((t=>t(e))))}})())};e=window.setInterval(s,100),t=window.setTimeout(n,1e3),s()}})();l?l.addEventListener("resize",f):window.addEventListener("resize",f)},66223:(e,t,i)=>{"use strict";i.d(t,{p:()=>r});var n=i(2212);const s=new(i(88512).Z)("texture"),r=(e,t,i)=>{const r=new n.TextureLoader;return r.crossOrigin="anonymous",r.load(e,t,void 0,(t=>{s.error(`Failed to load ${e}`),i&&i(t)}))}},62330:(e,t,i)=>{"use strict";i.d(t,{P:()=>n});const n=(e,t)=>{let i,n=Date.now()-t;return(...s)=>{const r=Date.now()-n,o=()=>{e.apply(null,s),n=Date.now()};if(i&&clearTimeout(i),r>=t)o();else{const e=t-r;i=window.setTimeout(o,e)}}}},65006:(e,t,i)=>{"use strict";i.d(t,{sU:()=>r,uz:()=>o,bf:()=>a,KK:()=>c});var n=i(8575),s=i(98828);const r=function(e="",t){let i,s,r;if(e.match(/^https?/)){const t=(0,n.Qc)(e);i=t.protocol+"//"+t.host,s=e,r=e.match(/[^/]*$/)[0]}else{if(t.match(/^https?/)){const e=(0,n.Qc)(t);i=e.protocol+"//"+e.host}else i=window.location.protocol+"//"+t;s=i+"/api/player/models/"+e,r=e}return{sid:r,urlBase:i,urlModel:s,urlFiles:s+(s.match(/\/$/)?"files":"/files"),urlThumb:s+(s.match(/\/$/)?"thumb":"/thumb")}},o=function(){return(0,s.h)("model")||(0,s.h)("m")},a=function(e,t={}){for(const i in t){const n=t[i];e+=(-1===e.indexOf("?")?"?":"&")+`${i}=${n}`}return e},l=[/^[a-z0-9\-]+\.matterport\.com$/,/^[a-z0-9\-]+\.matterportvr\.cn$/,/^localhost$/],c=e=>{let t;try{t=new URL(e)}catch(e){return null}const i=t.hostname;for(const e of l)if(i.match(e))return t.origin;return null}},82702:(e,t,i)=>{"use strict";i.d(t,{D:()=>s});const n=[];for(let e=0;e<256;e++)n[e]=(e<16?"0":"")+e.toString(16);function s(){let e;const t=window.crypto||window.msCrypto;return e=t?t.getRandomValues(new Uint8Array(16)):new Uint8Array(16).map((()=>255*Math.random())),e[6]=15&e[6]|64,e[8]=63&e[8]|128,n[e[0]]+n[e[1]]+n[e[2]]+n[e[3]]+"-"+n[e[4]]+n[e[5]]+"-"+n[e[6]]+n[e[7]]+"-"+n[e[8]]+n[e[9]]+"-"+n[e[10]]+n[e[11]]+n[e[12]]+n[e[13]]+n[e[14]]+n[e[15]]}},98828:(e,t,i)=>{"use strict";i.d(t,{h:()=>n});new(i(88512).Z)("util-browser");const n=function(e,t){const i=new RegExp("[#&?]"+e+"=([^#&?]*)").exec(window.location.href);if(!i)return t;const n=i[1];return"boolean"==typeof t?"true"===n||"1"===n:"number"==typeof t?parseFloat(n):decodeURIComponent(n)}},40285:(e,t,i)=>{"use strict";i.d(t,{H:()=>o});var n=i(88512),s=i(60771);const r=new n.Z("vr-platform-select"),o=async()=>{try{if(await a(),!("getVRDisplays"in navigator))return null;const e=await navigator.getVRDisplays();if(e.length>0&&e[0].capabilities.canPresent)return e[0]}catch(e){r.warn("Getting VR display failed"),r.warn(e)}return null},a=(()=>{const e=(0,s.Dt)()&&!("getVRDisplays"in navigator)&&!(0,s.Ot)();let t=!1;return async()=>{if(e&&!t){const n=new((await Promise.all([i.e(356),i.e(376)]).then(i.t.bind(i,4260,23))).default);r.info(`Falling back to WebVR support, native:: ${n.hasNative}`,{webvrPolyfillNeeded:e,polyfill:n}),t=!0}}})()},736:(e,t,i)=>{"use strict";i.d(t,{y:()=>_,m:()=>ModuleLoader});var n=i(64185);const s=new(i(88512).Z)("module-loader");var r;!function(e){e[e.Registered=0]="Registered",e[e.Loading=1]="Loading",e[e.Initialized=2]="Initialized",e[e.Unloaded=3]="Unloaded"}(r||(r={}));class ModuleLoader{constructor(){this.symbolMap=new Map}registerModule(e,t){if(this.symbolMap.has(e))throw Error(`Type ${String(e)} already registered`);this.symbolMap.set(e,{es6ModulePromise:t,ctorPromise:new n.Q,initPromise:new n.Q,state:r.Registered})}moduleRegistered(e){return this.symbolMap.has(e)}moduleLoaded(e){const t=this.symbolMap.get(e);return!!t&&![r.Registered,r.Unloaded].includes(t.state)}getModule(e){const t=this.symbolMap.get(e);if(!t)throw Error(`Trying to get ${String(e)} before it was registered!`);if(t.state===r.Unloaded)throw Error(`${String(e)} module unloaded`);return t.initPromise.nativePromise()}loadModule(e,t,i={}){const n=this.symbolMap.get(t);if(!n)throw Error();if(n.state===r.Initialized)return n;if(n.state!==r.Registered&&n.state!==r.Unloaded)throw Error(`${String(t)} already loading`);n.state=r.Loading;const o=String(t);return n.es6ModulePromise(o).then((o=>{if(!o.default)throw new Error(`${String(t)} has no default export during module loading`);const a=new o.default;n.ctorPromise.resolve(a).then((()=>{const t=Date.now();let o=!1;setTimeout((()=>{o||s.debug(`${a.name} init took over 2 seconds`)}),2e3),a.init(i,e).then((()=>{s.debug(`${a.name} init took ${(Date.now()-t)/1e3} secs.`),o=!0,n.state=r.Initialized,n.module=a,n.initPromise.resolve(a)})).catch((e=>{n.initPromise.reject(e)}))}))})).catch((e=>{s.error(`Failed to load es6Module for ${String(t)}: ${e}`),n.initPromise.reject(e)})),n}whenQueueEmpties(){const e=[];for(const[,t]of this.symbolMap)t.state===r.Loading&&e.push(t.initPromise);return n.Q.all(e).nativePromise()}unloadModule(e){const t=this.symbolMap.get(e);if(!t)throw Error("Attempting to unload unregistered module");if(t.state===r.Unloaded||t.state===r.Registered)throw Error("Attempting to unload not-loaded module");t.state=r.Unloaded,t.ctorPromise=new n.Q,t.initPromise=new n.Q,t.module=void 0}}const o=Symbol("canvas"),a=Symbol("input"),l=Symbol("model-mesh"),c=Symbol("mesh-query"),h=Symbol("measurement-mode"),d=Symbol("model-rating"),u=Symbol("scan-info"),p=Symbol("scene"),m=Symbol("sdk"),g=Symbol("search"),f=Symbol("pano"),v=Symbol("tours-controls"),y=Symbol("tours-data"),b=Symbol("trash"),S=Symbol("video"),E=Symbol("webgl-renderer"),w=Symbol("webvr"),T=Symbol("webxr"),_={CANVAS:o,DWELL_ANALYTICS:Symbol("dwell-analytics"),INPUT:a,MEASUREMENT_MODE:h,MODEL_MESH:l,MESH_QUERY:c,MODEL_RATING:d,SCAN_INFO:u,SCENE:p,SDK:m,SEARCH:g,SHOWCASE_ANALYTICS:Symbol("show-analytics"),SWEEP_PANO:f,TOUR_CONTROLS:v,TOUR_DATA:y,TRASH:b,VIDEO_RECORDER:S,WEBGL_RENDERER:E,WEBVR:w,WEBXR:T}},18201:(e,t,i)=>{"use strict";i.d(t,{X:()=>DictArray});class DictArray{constructor(){this.values={}}add(e,t){this.getValuesAtKey(e).push(t)}remove(e,t){const i=this.values[e];if(i){const e=i.indexOf(t);e>-1&&i.splice(e,1)}}getValuesAtKey(e){const t=this.values[e]||[];return this.values[e]=t,t}valuesPerKey(e){return this.getValuesAtKey(e).length}get keys(){return Object.keys(this.values)}}},24467:(e,t,i)=>{"use strict";var n;i(84751);!function(e){e[e.POSTMESSAGE=1]="POSTMESSAGE"}(n||(n={}))},84751:(e,t,i)=>{"use strict";var n;!function(e){e.LOADED="inject.loaded",e.SETUP="inject.setup",e.RESOLVE="inject.resolve"}(n||(n={}))},23549:(e,t,i)=>{"use strict";var n;i.d(t,{dE:()=>n}),function(e){e.CAMERA="sensor.sensortype.camera"}(n||(n={}))},40388:(e,t,i)=>{"use strict";i.d(t,{PO:()=>n});var n;!function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(n||(n={}))},48073:(e,t,i)=>{"use strict";i.d(t,{WT:()=>DirectMessageBridge,UX:()=>DirectMessageFactory,Ej:()=>DirectMessageNode,Pf:()=>Messenger});class BridgeObserver{constructor(e){this.messageReceiver=e}notify(e){this.messageReceiver.onMessageReceived(e)}}var n=i(18201);class ErrorMessageBridge{listen(){}stopListening(){}send(){throw Error("The sdk has been disconnected and can't make any new calls")}}class Messenger{constructor(e,t,i){this.sourceId=e,this.targetId=t,this.messageBridge=i,this.observers=new n.X}init(){const e=new class MessengerFacade{constructor(e){this.messenger=e}onMessageReceived(e){this.messenger.onMessageReceived(e)}}(this),t=new BridgeObserver(e);this.messageBridge.listen(t)}dispose(){this.messageBridge.stopListening(),this.messageBridge=new ErrorMessageBridge}addObserver(e){this.observers.add(e.messageType,e)}removeObserver(e){this.observers.remove(e.messageType,e)}send(e){const t=this.sourceId,i=this.targetId;this.messageBridge.send(Object.assign(Object.assign({},e),{fromId:t,toId:i,timestamp:Date.now()}))}onMessageReceived(e){if(!this.filterMessageId(e))return;const t=e.type,i=this.observers.getValuesAtKey(t);if(i)for(const t of i)t.notify(e.payload,e.timestamp)}filterMessageId(e){const t=e.toId,i=e.fromId;return t instanceof Array?t.indexOf(this.sourceId)>-1:t===this.sourceId&&i===this.targetId}}class DirectMessageBridge{constructor(e,t){this.source=e,this.target=t,this.messageObserver=null}listen(e){this.messageObserver||(this.messageObserver=e,this.source.addObserver(e))}stopListening(){this.messageObserver&&this.source.removeObserver(this.messageObserver)}send(e){const t=this.target;t&&t.post(Object.assign({},e))}}class DirectMessageNode{constructor(){this.observers=[]}addObserver(e){this.observers.push(e)}removeObserver(e){const t=this.observers.indexOf(e);t>-1&&this.observers.splice(t,1)}post(e){for(const t of this.observers)t.notify(e)}}const s=new Set;s.add(0);class DirectMessageFactory{constructor(e,t,i){this.hostId=e,this.host=t,this.onCreationObserver=i}createMessenger(){const e=function(){let e;do{e=Math.floor(1e6*Math.random())}while(s.has(e));return s.add(e),e}(),t=new DirectMessageNode,i=new DirectMessageBridge(t,this.host),n=new Messenger(e,this.hostId,i);return this.onCreationObserver.notify(e,t,n),n}}},64737:(e,t,i)=>{"use strict";i.d(t,{M:()=>DynamicLibLoader});class DynamicLibLoader{constructor(){this.libraryCache=new Map}load(e,t){const i=this.libraryCache.get(e)||new ScriptFetcher(e,t);return this.libraryCache.set(e,i),i.library}}class ScriptFetcher{constructor(e,t){this._libraryPromise=new Promise(((e,t)=>{this.libraryResolver=e,this.libraryRejecter=t})),this.fetch(e,t)}async fetch(e,t){let i;try{const t=new Request(e),n=new URL(t.url);if(!n.host.endsWith(window.location.host)&&!n.host.endsWith("matterport.com")&&!n.host.endsWith("matterportvr.cn"))return void this.libraryRejecter(`Request made for ${n.href} does not have the same origin as the request origin ${window.location.origin}`);i=await fetch(new Request(e,{}))}catch(e){return void this.libraryRejecter(e)}if(!i.ok)return void this.libraryRejecter("Script not found.");const n={},s=await i.text();if(new Function(s).call(n),t&&t in window){const e=window[t]||{};Object.assign(n,e),delete window[t]}this.libraryResolver(n)}get library(){return this._libraryPromise}}},75352:(e,t,i)=>{"use strict";var n;i.d(t,{a_:()=>OEmbedConsumer,t1:()=>OEmbedLinkError,HF:()=>OEmbedProviderError,ht:()=>n}),function(e){e.PHOTO="photo",e.VIDEO="video",e.LINK="link",e.RICH="rich"}(n||(n={}));class OEmbedConsumerError extends Error{constructor(e,t,i){super(e),this.status=t,this.type=i,console.warn(e),Error.captureStackTrace&&Error.captureStackTrace(this,OEmbedConsumerError)}}class OEmbedProviderError extends OEmbedConsumerError{constructor(e="unknown provider"){super(`Content from OEmbed provider ${e} is not currently not supported`,200,"OEmbedProvider")}}class OEmbedLinkError extends OEmbedConsumerError{constructor(e="unknown provider"){super(`Content from ${e} is type "link", which Link content is not currently supported`,200,"OEmbedLink")}}function s(e){const t=Math.max(window.screen.height,window.screen.width);return{queryParams:new URLSearchParams({maxWidth:`${t}`,maxHeight:`${t}`,url:e}),headers:{responseType:"json"}}}const r=/^https:\/\/www.instagram.com/;const o=/^https:\/\/www.facebook.com/,a=/^https:\/\/www.facebook.com\/(.*\/)?(posts\/|activity\/|photo\.php|photos\/|permalink\.php|media\/set|questions\/|notes\/)/,l=/^https:\/\/www.facebook.com\/(video\.php|.*\/videos\/)/;async function c(e,t,i,n){const{queryParams:r,headers:o}=s(e);i&&n&&r.append("access_token",`${i}|${n}`);const c=function(e){return a.test(e)?"https://graph.facebook.com/v10.0/oembed_post":l.test(e)?"https://graph.facebook.com/v10.0/oembed_video":"https://graph.facebook.com/v10.0/oembed_page"}(e),h=new URL(`${c}?${r.toString()}`);try{return await t.get(h.toString(),o)}catch(e){const t=e;throw new OEmbedConsumerError(t.error.message,t.status_code,t.error.type)}}const h={behance:!1,dailymotion:!0,facebook:!1,flickr:!0,giphy:!0,instagram:!1,linkedin:!1,matterport:!0,mixcloud:!1,pinterest:!1,reddit:!1,soundcloud:!0,sketchfab:!0,spotify:!0,tenor:!0,tiktok:!1,twitter:!1,tumblr:!0,vimeo:!0,youtube:!0};class OEmbedConsumer{constructor(e){this.cache={},Object.assign(this,e)}async getOEmbedData(e){if(this.cache[e])return this.validate(this.cache[e]);const t=await this.requestOEmbedData(e);return this.cache[e]=t,this.validate(t)}async requestOEmbedData(e){let t;return t=function(e){return r.test(e)}(e)?await async function(e,t,i,n){const{queryParams:r,headers:o}=s(e);i&&n&&r.append("access_token",`${i}|${n}`);const a=new URL(`https://graph.facebook.com/v10.0/instagram_oembed?${r.toString()}`);try{return await t.get(a.toString(),o)}catch(e){const t=e;throw new OEmbedConsumerError(t.error.message,t.status_code,t.error.type)}}(e,this.queue,this.instagramAppId,this.instagramClientToken):function(e){return o.test(e)}(e)?await c(e,this.queue,this.instagramAppId,this.instagramClientToken):await async function(e,t,i){const{queryParams:n,headers:r}=s(e);i&&n.append("key",i);const o=new URL(`https://api.embed.ly/1/oembed?${n.toString()}`);try{return await t.get(o.toString(),r)}catch(e){const t=e;throw new OEmbedConsumerError(t.error_message,t.status_code,t.type)}}(e,this.queue,this.embedlyKey),t}clearCache(){this.cache={}}validate(e){if(!(e=>{const{provider_name:t,type:i}=e,s=void 0===t?void 0:h[t.toLowerCase()];return void 0===s&&i===n.PHOTO||!!s})(e))throw new OEmbedProviderError(e.provider_name);if(e.type===n.LINK)throw new OEmbedLinkError(e.provider_name);return e}}},70655:(e,t,i)=>{"use strict";i.d(t,{ZT:()=>s,pi:()=>r,_T:()=>o,mG:()=>a,Jh:()=>l,pr:()=>c});var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function s(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var r=function(){return(r=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function o(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i}function a(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))}function l(e,t){var i,n,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(s=2&r[0]?n.return:r[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,r[1])).done)return s;switch(n=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],n=0}finally{i=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}function c(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),s=0;for(t=0;t<i;t++)for(var r=arguments[t],o=0,a=r.length;o<a;o++,s++)n[s]=r[o];return n}},42238:function(e,t,i){var n;!function(s,r){"use strict";var o="function",a="undefined",l="object",c="model",h="name",d="type",u="vendor",p="version",m="architecture",g="console",f="mobile",v="tablet",y="smarttv",b="wearable",S={extend:function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2==0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:r},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},E={rgx:function(e,t){for(var i,n,s,a,c,h,d=0;d<t.length&&!c;){var u=t[d],p=t[d+1];for(i=n=0;i<u.length&&!c;)if(c=u[i++].exec(e))for(s=0;s<p.length;s++)h=c[++n],typeof(a=p[s])===l&&a.length>0?2==a.length?typeof a[1]==o?this[a[0]]=a[1].call(this,h):this[a[0]]=a[1]:3==a.length?typeof a[1]!==o||a[1].exec&&a[1].test?this[a[0]]=h?h.replace(a[1],a[2]):r:this[a[0]]=h?a[1].call(this,h,a[2]):r:4==a.length&&(this[a[0]]=h?a[3].call(this,h.replace(a[1],a[2])):r):this[a]=h||r;d+=2}},str:function(e,t){for(var i in t)if(typeof t[i]===l&&t[i].length>0){for(var n=0;n<t[i].length;n++)if(S.has(t[i][n],e))return"?"===i?r:i}else if(S.has(t[i],e))return"?"===i?r:i;return e}},w={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},T={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]{3,6}).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[h,p],[/(opios)[\/\s]+([\w\.]+)/i],[[h,"Opera Mini"],p],[/\s(opr)\/([\w\.]+)/i],[[h,"Opera"],p],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(bidubrowser|baidubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i],[h,p],[/(konqueror)\/([\w\.]+)/i],[[h,"Konqueror"],p],[/(trident).+rv[:\s]([\w\.]{1,9}).+like\sgecko/i],[[h,"IE"],p],[/(edge|edgios|edga|edg)\/((\d+)?[\w\.]+)/i],[[h,"Edge"],p],[/(yabrowser)\/([\w\.]+)/i],[[h,"Yandex"],p],[/(Avast)\/([\w\.]+)/i],[[h,"Avast Secure Browser"],p],[/(AVG)\/([\w\.]+)/i],[[h,"AVG Secure Browser"],p],[/(puffin)\/([\w\.]+)/i],[[h,"Puffin"],p],[/(focus)\/([\w\.]+)/i],[[h,"Firefox Focus"],p],[/(opt)\/([\w\.]+)/i],[[h,"Opera Touch"],p],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[h,"UCBrowser"],p],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],p],[/(windowswechat qbcore)\/([\w\.]+)/i],[[h,"WeChat(Win) Desktop"],p],[/(micromessenger)\/([\w\.]+)/i],[[h,"WeChat"],p],[/(brave)\/([\w\.]+)/i],[[h,"Brave"],p],[/(whale)\/([\w\.]+)/i],[[h,"Whale"],p],[/(qqbrowserlite)\/([\w\.]+)/i],[h,p],[/(QQ)\/([\d\.]+)/i],[h,p],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[h,p],[/(baiduboxapp)[\/\s]?([\w\.]+)/i],[h,p],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[h,p],[/(MetaSr)[\/\s]?([\w\.]+)/i],[h],[/(LBBROWSER)/i],[h],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[p,[h,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[p,[h,"Facebook"]],[/FBAN\/FBIOS|FB_IAB\/FB4A/i],[[h,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[h,p],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[p,[h,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[h,/(.+)/,"$1 WebView"],p],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[h,/(.+(?:g|us))(.+)/,"$1 $2"],p],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[p,[h,"Android Browser"]],[/(sailfishbrowser)\/([\w\.]+)/i],[[h,"Sailfish Browser"],p],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[h,p],[/(dolfin)\/([\w\.]+)/i],[[h,"Dolphin"],p],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[h,"360 Browser"]],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[h,"Chrome"],p],[/(coast)\/([\w\.]+)/i],[[h,"Opera Coast"],p],[/fxios\/([\w\.-]+)/i],[p,[h,"Firefox"]],[/version\/([\w\.]+)\s.*mobile\/\w+\s(safari)/i],[p,[h,"Mobile Safari"]],[/version\/([\w\.]+)\s.*(mobile\s?safari|safari)/i],[p,h],[/webkit.+?(gsa)\/([\w\.]+)\s.*(mobile\s?safari|safari)(\/[\w\.]+)/i],[[h,"GSA"],p],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[h,[p,E.str,w.browser.oldsafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[h,p],[/(navigator|netscape)\/([\w\.-]+)/i],[[h,"Netscape"],p],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(firefox)\/([\w\.]+)\s[\w\s\-]+\/[\w\.]+$/i,/(mozilla)\/([\w\.]+)\s.+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[h,p]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,S.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[m,/ower/,"",S.lowerize]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[m,S.lowerize]]],device:[[/\((ipad|playbook);[\w\s\),;-]+(rim|apple)/i],[c,u,[d,v]],[/applecoremedia\/[\w\.]+ \((ipad)/],[c,[u,"Apple"],[d,v]],[/(apple\s{0,1}tv)/i],[[c,"Apple TV"],[u,"Apple"],[d,y]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[u,c,[d,v]],[/(kf[A-z]+)(\sbuild\/|\)).+silk\//i],[c,[u,"Amazon"],[d,v]],[/(sd|kf)[0349hijorstuw]+(\sbuild\/|\)).+silk\//i],[[c,E.str,w.device.amazon.model],[u,"Amazon"],[d,f]],[/android.+aft([bms])\sbuild/i],[c,[u,"Amazon"],[d,y]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[c,u,[d,f]],[/\((ip[honed|\s\w*]+);/i],[c,[u,"Apple"],[d,f]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[u,c,[d,f]],[/\(bb10;\s(\w+)/i],[c,[u,"BlackBerry"],[d,f]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone|p00c)/i],[c,[u,"Asus"],[d,v]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[u,"Sony"],[c,"Xperia Tablet"],[d,v]],[/android.+\s([c-g]\d{4}|so[-l]\w+)(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[u,"Sony"],[d,f]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[u,c,[d,g]],[/android.+;\s(shield)\sbuild/i],[c,[u,"Nvidia"],[d,g]],[/(playstation\s[34portablevi]+)/i],[c,[u,"Sony"],[d,g]],[/(sprint\s(\w+))/i],[[u,E.str,w.device.sprint.vendor],[c,E.str,w.device.sprint.model],[d,f]],[/(htc)[;_\s-]{1,2}([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[u,[c,/_/g," "],[d,f]],[/(nexus\s9)/i],[c,[u,"HTC"],[d,v]],[/d\/huawei([\w\s-]+)[;\)]/i,/android.+\s(nexus\s6p|vog-[at]?l\d\d|ane-[at]?l[x\d]\d|eml-a?l\d\da?|lya-[at]?l\d[\dc]|clt-a?l\d\di?)/i],[c,[u,"Huawei"],[d,f]],[/android.+(bah2?-a?[lw]\d{2})/i],[c,[u,"Huawei"],[d,v]],[/(microsoft);\s(lumia[\s\w]+)/i],[u,c,[d,f]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[c,[u,"Microsoft"],[d,g]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[u,"Microsoft"],[d,f]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[c,[u,"Motorola"],[d,f]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[c,[u,"Motorola"],[d,v]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[u,S.trim],[c,S.trim],[d,y]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[u,"Samsung"],[d,y]],[/\(dtv[\);].+(aquos)/i],[c,[u,"Sharp"],[d,y]],[/android.+((sch-i[89]0\d|shw-m380s|SM-P605|SM-P610|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[u,"Samsung"],c,[d,v]],[/smart-tv.+(samsung)/i],[u,[d,y],c],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[u,"Samsung"],c,[d,f]],[/sie-(\w*)/i],[c,[u,"Siemens"],[d,f]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[u,"Nokia"],c,[d,f]],[/android[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[c,[u,"Acer"],[d,v]],[/android.+([vl]k\-?\d{3})\s+build/i],[c,[u,"LG"],[d,v]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[u,"LG"],c,[d,v]],[/linux;\snetcast.+smarttv/i,/lg\snetcast\.tv-201\d/i],[[u,"LG"],c,[d,y]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[c,[u,"LG"],[d,f]],[/(lenovo)\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+))/i],[u,c,[d,v]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[c,[u,"Lenovo"],[d,v]],[/(lenovo)[_\s-]?([\w-]+)/i],[u,c,[d,f]],[/linux;.+((jolla));/i],[u,c,[d,f]],[/((pebble))app\/[\d\.]+\s/i],[u,c,[d,b]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[u,c,[d,f]],[/crkey/i],[[c,"Chromecast"],[u,"Google"],[d,y]],[/android.+;\s(glass)\s\d/i],[c,[u,"Google"],[d,b]],[/android.+;\s(pixel c)[\s)]/i],[c,[u,"Google"],[d,v]],[/android.+;\s(pixel( [2-9]a?)?( xl)?)[\s)]/i],[c,[u,"Google"],[d,f]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]?note?[\s_]?(?:\d\w)?)\sbuild/i,/android.+(redmi[\s\-_]?(?:note|k)?(?:[\s_]?[\w\s]+))(?:\sbuild|\))/i,/android.+(mi[\s\-_]?(?:a\d|one|one[\s_]plus|note lte)?[\s_]?(?:\d?\w?)[\s_]?(?:plus)?)\sbuild/i],[[c,/_/g," "],[u,"Xiaomi"],[d,f]],[/android.+(mi[\s\-_]?(?:pad)(?:[\s_]?[\w\s]+))(?:\sbuild|\))/i],[[c,/_/g," "],[u,"Xiaomi"],[d,v]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[c,[u,"Meizu"],[d,f]],[/(mz)-([\w-]{2,})/i],[[u,"Meizu"],c,[d,f]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})[\s)]/i],[c,[u,"OnePlus"],[d,f]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[c,[u,"RCA"],[d,v]],[/android.+[;\/\s](Venue[\d\s]{2,7})\s+build/i],[c,[u,"Dell"],[d,v]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[c,[u,"Verizon"],[d,v]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[u,"Barnes & Noble"],c,[d,v]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[c,[u,"NuVision"],[d,v]],[/android.+;\s(k88)\sbuild/i],[c,[u,"ZTE"],[d,v]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[c,[u,"Swiss"],[d,f]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[c,[u,"Swiss"],[d,v]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[c,[u,"Zeki"],[d,v]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[u,"Dragon Touch"],c,[d,v]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[c,[u,"Insignia"],[d,v]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[c,[u,"NextBook"],[d,v]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[u,"Voice"],c,[d,f]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[u,"LvTel"],c,[d,f]],[/android.+;\s(PH-1)\s/i],[c,[u,"Essential"],[d,f]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[c,[u,"Envizen"],[d,v]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[u,c,[d,v]],[/android.+[;\/]\s*(Trio[\s\w\-\.]+)\s+build/i],[c,[u,"MachSpeed"],[d,v]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[u,c,[d,v]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[c,[u,"Rotor"],[d,v]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[u,c,[d,v]],[/android .+?; ([^;]+?)(?: build|\) applewebkit).+? mobile safari/i],[c,[d,f]],[/android .+?;\s([^;]+?)(?: build|\) applewebkit).+?(?! mobile) safari/i],[c,[d,v]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[d,S.lowerize],u,c],[/[\s\/\(](smart-?tv)[;\)]/i],[[d,y]],[/(android[\w\.\s\-]{0,9});.+build/i],[c,[u,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[p,[h,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[h,p],[/rv\:([\w\.]{1,9}).+(gecko)/i],[p,h]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[h,p],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[h,[p,E.str,w.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[h,"Windows"],[p,E.str,w.os.windows.version]],[/\((bb)(10);/i],[[h,"BlackBerry"],p],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i],[h,p],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[h,"Symbian"],p],[/\((series40);/i],[h],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[h,"Firefox OS"],p],[/crkey\/([\d\.]+)/i],[p,[h,"Chromecast"]],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[h,p],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[h,"Chromium OS"],p],[/(sunos)\s?([\w\.\d]*)/i],[[h,"Solaris"],p],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[h,p],[/(haiku)\s(\w+)/i],[h,p],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[p,/_/g,"."],[h,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[h,"Mac OS"],[p,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[h,p]]},_=function(e,t){if("object"==typeof e&&(t=e,e=r),!(this instanceof _))return new _(e,t).getResult();var i=e||(s&&s.navigator&&s.navigator.userAgent?s.navigator.userAgent:""),n=t?S.extend(T,t):T;return this.getBrowser=function(){var e={name:r,version:r};return E.rgx.call(e,i,n.browser),e.major=S.major(e.version),e},this.getCPU=function(){var e={architecture:r};return E.rgx.call(e,i,n.cpu),e},this.getDevice=function(){var e={vendor:r,model:r,type:r};return E.rgx.call(e,i,n.device),e},this.getEngine=function(){var e={name:r,version:r};return E.rgx.call(e,i,n.engine),e},this.getOS=function(){var e={name:r,version:r};return E.rgx.call(e,i,n.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},this};_.VERSION="0.7.23",_.BROWSER={NAME:h,MAJOR:"major",VERSION:p},_.CPU={ARCHITECTURE:m},_.DEVICE={MODEL:c,VENDOR:u,TYPE:d,CONSOLE:g,MOBILE:f,SMARTTV:y,TABLET:v,WEARABLE:b,EMBEDDED:"embedded"},_.ENGINE={NAME:h,VERSION:p},_.OS={NAME:h,VERSION:p},typeof t!==a?(e.exports&&(t=e.exports=_),t.UAParser=_):(n=function(){return _}.call(t,i,t,e))===r||(e.exports=n);var M=s&&(s.jQuery||s.Zepto);if(M&&!M.ua){var x=new _;M.ua=x.getResult(),M.ua.get=function(){return x.getUA()},M.ua.set=function(e){x.setUA(e);var t=x.getResult();for(var i in t)M.ua[i]=t[i]}}}("object"==typeof window?window:this)},69436:e=>{function t(e,t,i,n){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=i,this.p2y=n}e.exports=t,t.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},t.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},t.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},t.prototype.solveCurveX=function(e,t){var i,n,s,r,o;for(void 0===t&&(t=1e-6),s=e,o=0;o<8;o++){if(r=this.sampleCurveX(s)-e,Math.abs(r)<t)return s;var a=this.sampleCurveDerivativeX(s);if(Math.abs(a)<1e-6)break;s-=r/a}if((s=e)<(i=0))return i;if(s>(n=1))return n;for(;i<n;){if(r=this.sampleCurveX(s),Math.abs(r-e)<t)return s;e>r?i=s:n=s,s=.5*(n-i)+i}return s},t.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},52511:function(e,t,i){var n;e=i.nmd(e),function(s){t&&t.nodeType,e&&e.nodeType;var r="object"==typeof i.g&&i.g;r.global!==r&&r.window!==r&&r.self;var o,a=2147483647,l=36,c=/^xn--/,h=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,u={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,m=String.fromCharCode;function g(e){throw RangeError(u[e])}function f(e,t){for(var i=e.length,n=[];i--;)n[i]=t(e[i]);return n}function v(e,t){var i=e.split("@"),n="";return i.length>1&&(n=i[0]+"@",e=i[1]),n+f((e=e.replace(d,".")).split("."),t).join(".")}function y(e){for(var t,i,n=[],s=0,r=e.length;s<r;)(t=e.charCodeAt(s++))>=55296&&t<=56319&&s<r?56320==(64512&(i=e.charCodeAt(s++)))?n.push(((1023&t)<<10)+(1023&i)+65536):(n.push(t),s--):n.push(t);return n}function b(e){return f(e,(function(e){var t="";return e>65535&&(t+=m((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=m(e)})).join("")}function S(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function E(e,t,i){var n=0;for(e=i?p(e/700):e>>1,e+=p(e/t);e>455;n+=l)e=p(e/35);return p(n+36*e/(e+38))}function w(e){var t,i,n,s,r,o,c,h,d,u,m,f=[],v=e.length,y=0,S=128,w=72;for((i=e.lastIndexOf("-"))<0&&(i=0),n=0;n<i;++n)e.charCodeAt(n)>=128&&g("not-basic"),f.push(e.charCodeAt(n));for(s=i>0?i+1:0;s<v;){for(r=y,o=1,c=l;s>=v&&g("invalid-input"),((h=(m=e.charCodeAt(s++))-48<10?m-22:m-65<26?m-65:m-97<26?m-97:l)>=l||h>p((a-y)/o))&&g("overflow"),y+=h*o,!(h<(d=c<=w?1:c>=w+26?26:c-w));c+=l)o>p(a/(u=l-d))&&g("overflow"),o*=u;w=E(y-r,t=f.length+1,0==r),p(y/t)>a-S&&g("overflow"),S+=p(y/t),y%=t,f.splice(y++,0,S)}return b(f)}function T(e){var t,i,n,s,r,o,c,h,d,u,f,v,b,w,T,_=[];for(v=(e=y(e)).length,t=128,i=0,r=72,o=0;o<v;++o)(f=e[o])<128&&_.push(m(f));for(n=s=_.length,s&&_.push("-");n<v;){for(c=a,o=0;o<v;++o)(f=e[o])>=t&&f<c&&(c=f);for(c-t>p((a-i)/(b=n+1))&&g("overflow"),i+=(c-t)*b,t=c,o=0;o<v;++o)if((f=e[o])<t&&++i>a&&g("overflow"),f==t){for(h=i,d=l;!(h<(u=d<=r?1:d>=r+26?26:d-r));d+=l)T=h-u,w=l-u,_.push(m(S(u+T%w,0))),h=p(T/w);_.push(m(S(h,0))),r=E(i,b,n==s),i=0,++n}++i,++t}return _.join("")}o={version:"1.3.2",ucs2:{decode:y,encode:b},decode:w,encode:T,toASCII:function(e){return v(e,(function(e){return h.test(e)?"xn--"+T(e):e}))},toUnicode:function(e){return v(e,(function(e){return c.test(e)?w(e.slice(4).toLowerCase()):e}))}},void 0===(n=function(){return o}.call(t,i,t,e))||(e.exports=n)}()},8575:(e,t,i)=>{"use strict";var n=i(52511),s=i(62502);function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.Qc=b;var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(c),d=["%","/","?",";","#"].concat(h),u=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},f={javascript:!0,"javascript:":!0},v={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=i(17673);function b(e,t,i){if(e&&s.isObject(e)&&e instanceof r)return e;var n=new r;return n.parse(e,t,i),n}r.prototype.parse=function(e,t,i){if(!s.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),a=-1!==r&&r<e.indexOf("#")?"?":"#",c=e.split(a);c[0]=c[0].replace(/\\/g,"/");var b=e=c.join(a);if(b=b.trim(),!i&&1===e.split("#").length){var S=l.exec(b);if(S)return this.path=b,this.href=b,this.pathname=S[1],S[2]?(this.search=S[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var E=o.exec(b);if(E){var w=(E=E[0]).toLowerCase();this.protocol=w,b=b.substr(E.length)}if(i||E||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var T="//"===b.substr(0,2);!T||E&&f[E]||(b=b.substr(2),this.slashes=!0)}if(!f[E]&&(T||E&&!v[E])){for(var _,M,x=-1,A=0;A<u.length;A++){-1!==(O=b.indexOf(u[A]))&&(-1===x||O<x)&&(x=O)}-1!==(M=-1===x?b.lastIndexOf("@"):b.lastIndexOf("@",x))&&(_=b.slice(0,M),b=b.slice(M+1),this.auth=decodeURIComponent(_)),x=-1;for(A=0;A<d.length;A++){var O;-1!==(O=b.indexOf(d[A]))&&(-1===x||O<x)&&(x=O)}-1===x&&(x=b.length),this.host=b.slice(0,x),b=b.slice(x),this.parseHost(),this.hostname=this.hostname||"";var P="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!P)for(var D=this.hostname.split(/\./),C=(A=0,D.length);A<C;A++){var I=D[A];if(I&&!I.match(p)){for(var L="",R=0,N=I.length;R<N;R++)I.charCodeAt(R)>127?L+="x":L+=I[R];if(!L.match(p)){var k=D.slice(0,A),B=D.slice(A+1),F=I.match(m);F&&(k.push(F[1]),B.unshift(F[2])),B.length&&(b="/"+B.join(".")+b),this.hostname=k.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),P||(this.hostname=n.toASCII(this.hostname));var U=this.port?":"+this.port:"",V=this.hostname||"";this.host=V+U,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!g[w])for(A=0,C=h.length;A<C;A++){var H=h[A];if(-1!==b.indexOf(H)){var G=encodeURIComponent(H);G===H&&(G=escape(H)),b=b.split(H).join(G)}}var z=b.indexOf("#");-1!==z&&(this.hash=b.substr(z),b=b.slice(0,z));var W=b.indexOf("?");if(-1!==W?(this.search=b.substr(W),this.query=b.substr(W+1),t&&(this.query=y.parse(this.query)),b=b.slice(0,W)):t&&(this.search="",this.query={}),b&&(this.pathname=b),v[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){U=this.pathname||"";var j=this.search||"";this.path=U+j}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",i=this.pathname||"",n=this.hash||"",r=!1,o="";this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&s.isObject(this.query)&&Object.keys(this.query).length&&(o=y.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||v[t])&&!1!==r?(r="//"+(r||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):r||(r=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+r+(i=i.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+n},r.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(s.isString(e)){var t=new r;t.parse(e,!1,!0),e=t}for(var i=new r,n=Object.keys(this),o=0;o<n.length;o++){var a=n[o];i[a]=this[a]}if(i.hash=e.hash,""===e.href)return i.href=i.format(),i;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),c=0;c<l.length;c++){var h=l[c];"protocol"!==h&&(i[h]=e[h])}return v[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(e.protocol&&e.protocol!==i.protocol){if(!v[e.protocol]){for(var d=Object.keys(e),u=0;u<d.length;u++){var p=d[u];i[p]=e[p]}return i.href=i.format(),i}if(i.protocol=e.protocol,e.host||f[e.protocol])i.pathname=e.pathname;else{for(var m=(e.pathname||"").split("/");m.length&&!(e.host=m.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==m[0]&&m.unshift(""),m.length<2&&m.unshift(""),i.pathname=m.join("/")}if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var g=i.pathname||"",y=i.search||"";i.path=g+y}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var b=i.pathname&&"/"===i.pathname.charAt(0),S=e.host||e.pathname&&"/"===e.pathname.charAt(0),E=S||b||i.host&&e.pathname,w=E,T=i.pathname&&i.pathname.split("/")||[],_=(m=e.pathname&&e.pathname.split("/")||[],i.protocol&&!v[i.protocol]);if(_&&(i.hostname="",i.port=null,i.host&&(""===T[0]?T[0]=i.host:T.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===m[0]?m[0]=e.host:m.unshift(e.host)),e.host=null),E=E&&(""===m[0]||""===T[0])),S)i.host=e.host||""===e.host?e.host:i.host,i.hostname=e.hostname||""===e.hostname?e.hostname:i.hostname,i.search=e.search,i.query=e.query,T=m;else if(m.length)T||(T=[]),T.pop(),T=T.concat(m),i.search=e.search,i.query=e.query;else if(!s.isNullOrUndefined(e.search)){if(_)i.hostname=i.host=T.shift(),(P=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=P.shift(),i.host=i.hostname=P.shift());return i.search=e.search,i.query=e.query,s.isNull(i.pathname)&&s.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!T.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var M=T.slice(-1)[0],x=(i.host||e.host||T.length>1)&&("."===M||".."===M)||""===M,A=0,O=T.length;O>=0;O--)"."===(M=T[O])?T.splice(O,1):".."===M?(T.splice(O,1),A++):A&&(T.splice(O,1),A--);if(!E&&!w)for(;A--;A)T.unshift("..");!E||""===T[0]||T[0]&&"/"===T[0].charAt(0)||T.unshift(""),x&&"/"!==T.join("/").substr(-1)&&T.push("");var P,D=""===T[0]||T[0]&&"/"===T[0].charAt(0);_&&(i.hostname=i.host=D?"":T.length?T.shift():"",(P=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=P.shift(),i.host=i.hostname=P.shift()));return(E=E||i.host&&T.length)&&!D&&T.unshift(""),T.length?i.pathname=T.join("/"):(i.pathname=null,i.path=null),s.isNull(i.pathname)&&s.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i},r.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},62502:e=>{"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},42473:e=>{"use strict";var t=function(){};e.exports=t},2209:e=>{e.exports="uniform float opacity;uniform vec3 color;uniform sampler2D bg;varying vec2 vUv;void main(){vec4 bgColor=texture2D(bg,vUv);gl_FragColor=vec4(bgColor.rgb,bgColor.a*opacity);}"},64116:e=>{e.exports="uniform vec3 diffuse;uniform float opacity;uniform sampler2D mask;\n#ifdef USE_DASH\nuniform float dashSize;uniform float gapSize;\n#endif\nvarying float vLineDistance;\n#include <common>\nvarying vec2 vUv;void main(){\n#ifdef USE_DASH\nif(vUv.y<-1.||vUv.y>1.)discard;if(mod(vLineDistance,dashSize+gapSize)>dashSize)discard;\n#endif\n#ifdef USE_MASK\nvec2 modUv=vec2(vUv);modUv*=2.;vec4 texelColor=texture2D(mask,modUv);gl_FragColor=vec4(texelColor.rgb,min(texelColor.a,opacity));\n#else\ngl_FragColor=vec4(diffuse,opacity);\n#endif\n}"},63862:e=>{e.exports="#include <common>\nuniform float linewidth;uniform vec2 resolution;attribute vec3 instanceStart;attribute vec3 instanceEnd;attribute vec3 instanceColorStart;attribute vec3 instanceColorEnd;varying vec2 vUv;\n#ifdef USE_DASH\nuniform float dashScale;attribute float instanceDistanceStart;attribute float instanceDistanceEnd;varying float vLineDistance;\n#endif\nvoid trimSegment(const in vec4 start,inout vec4 end){float a=projectionMatrix[2][2];float b=projectionMatrix[3][2];float nearEstimate=-0.5*b/a;float alpha=(nearEstimate-start.z)/(end.z-start.z);end.xyz=mix(start.xyz,end.xyz,alpha);}void main(){\n#ifdef USE_COLOR\nvColor.xyz=(position.y<0.5)?instanceColorStart:instanceColorEnd;\n#endif\n#ifdef USE_DASH\nvLineDistance=(position.y<0.5)?dashScale*instanceDistanceStart:dashScale*instanceDistanceEnd;\n#endif\nfloat aspect=resolution.x/resolution.y;vUv=uv;vec4 start=modelViewMatrix*vec4(instanceStart,1.);vec4 end=modelViewMatrix*vec4(instanceEnd,1.);bool perspective=(projectionMatrix[2][3]==-1.);if(perspective){if(start.z<0.&&end.z>=0.){trimSegment(start,end);}else if(end.z<0.&&start.z>=0.){trimSegment(end,start);}}vec4 clipStart=projectionMatrix*start;vec4 clipEnd=projectionMatrix*end;vec2 ndcStart=clipStart.xy/clipStart.w;vec2 ndcEnd=clipEnd.xy/clipEnd.w;vec2 dir=ndcEnd-ndcStart;dir.x*=aspect;dir=normalize(dir);vec2 offset=vec2(dir.y,-dir.x);dir.x/=aspect;offset.x/=aspect;if(position.x<0.)offset*=-1.;offset*=linewidth;offset/=resolution.y;vec4 clip=(position.y<0.5)?clipStart:clipEnd;\n#ifdef USE_MASK\noffset*=(clipEnd.w+clipStart.w)*0.5;\n#else\noffset*=clip.w;\n#endif\nclip.xy+=offset;gl_Position=clip;\n#include <worldpos_vertex>\n}"},84294:e=>{e.exports="uniform samplerCube map;uniform vec2 dir;varying vec3 vWorldPosition;vec3 sphereToUnit(float x,float y){return vec3(sin(x)*cos(y),cos(x),sin(x)*sin(y));}vec2 unitToSphere(vec3 unit){return vec2(atan(sqrt(pow(unit.x,2.)+pow(unit.z,2.)),unit.y),atan(unit.z,unit.x));}void main(){vec2 coord=unitToSphere(vWorldPosition);vec4 sum=textureCube(map,sphereToUnit(coord.x-12.*dir.x,coord.y-12.*dir.y))*KERNEL_1;sum+=textureCube(map,sphereToUnit(coord.x-11.*dir.x,coord.y-11.*dir.y))*KERNEL_2;sum+=textureCube(map,sphereToUnit(coord.x-10.*dir.x,coord.y-10.*dir.y))*KERNEL_3;sum+=textureCube(map,sphereToUnit(coord.x-9.*dir.x,coord.y-9.*dir.y))*KERNEL_4;sum+=textureCube(map,sphereToUnit(coord.x-8.*dir.x,coord.y-8.*dir.y))*KERNEL_5;sum+=textureCube(map,sphereToUnit(coord.x-7.*dir.x,coord.y-7.*dir.y))*KERNEL_6;sum+=textureCube(map,sphereToUnit(coord.x-6.*dir.x,coord.y-6.*dir.y))*KERNEL_7;sum+=textureCube(map,sphereToUnit(coord.x-5.*dir.x,coord.y-5.*dir.y))*KERNEL_8;sum+=textureCube(map,sphereToUnit(coord.x-4.*dir.x,coord.y-4.*dir.y))*KERNEL_9;sum+=textureCube(map,sphereToUnit(coord.x-3.*dir.x,coord.y-3.*dir.y))*KERNEL_10;sum+=textureCube(map,sphereToUnit(coord.x-2.*dir.x,coord.y-2.*dir.y))*KERNEL_11;sum+=textureCube(map,sphereToUnit(coord.x-1.*dir.x,coord.y-1.*dir.y))*KERNEL_12;sum+=textureCube(map,sphereToUnit(coord.x,coord.y))*KERNEL_13;sum+=textureCube(map,sphereToUnit(coord.x+1.*dir.x,coord.y+1.*dir.y))*KERNEL_14;sum+=textureCube(map,sphereToUnit(coord.x+2.*dir.x,coord.y+2.*dir.y))*KERNEL_15;sum+=textureCube(map,sphereToUnit(coord.x+3.*dir.x,coord.y+3.*dir.y))*KERNEL_16;sum+=textureCube(map,sphereToUnit(coord.x+4.*dir.x,coord.y+4.*dir.y))*KERNEL_17;sum+=textureCube(map,sphereToUnit(coord.x+5.*dir.x,coord.y+5.*dir.y))*KERNEL_18;sum+=textureCube(map,sphereToUnit(coord.x+6.*dir.x,coord.y+6.*dir.y))*KERNEL_19;sum+=textureCube(map,sphereToUnit(coord.x+7.*dir.x,coord.y+7.*dir.y))*KERNEL_20;sum+=textureCube(map,sphereToUnit(coord.x+8.*dir.x,coord.y+8.*dir.y))*KERNEL_21;sum+=textureCube(map,sphereToUnit(coord.x+9.*dir.x,coord.y+9.*dir.y))*KERNEL_22;sum+=textureCube(map,sphereToUnit(coord.x+10.*dir.x,coord.y+10.*dir.y))*KERNEL_23;sum+=textureCube(map,sphereToUnit(coord.x+11.*dir.x,coord.y+11.*dir.y))*KERNEL_24;sum+=textureCube(map,sphereToUnit(coord.x+12.*dir.x,coord.y+12.*dir.y))*KERNEL_25;gl_FragColor=sum;}"},25247:e=>{e.exports="varying vec3 vWorldPosition;void main(){vWorldPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},59253:e=>{e.exports="uniform samplerCube map;uniform float opacity;varying vec3 vWorldPosition;void main(){vec4 color=textureCube(map,vec3(-vWorldPosition.x,vWorldPosition.yz));gl_FragColor=vec4(color.rgb,opacity);}"},54124:e=>{e.exports="varying vec3 vWorldPosition;void main(){vWorldPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},24074:e=>{e.exports="uniform vec3 color;uniform float opacity;uniform float maxDistance;varying vec3 vWorldPosition;void main(){float distanceToCamera=distance(cameraPosition,vWorldPosition);float distanceBucketed=1.-clamp(distanceToCamera/maxDistance,0.,1.);if(opacity<1.){discard;}gl_FragColor=vec4(distanceBucketed,distanceBucketed,distanceBucketed,1.);}"},27409:e=>{e.exports="varying vec3 vWorldPosition;void main(){vWorldPosition=(modelMatrix*vec4(position,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},96432:e=>{e.exports="uniform sampler2D map;uniform float opacity;uniform vec4 colorOverlay;varying vec2 vUv;vec4 white=vec4(0.8,0.8,0.8,1.);vec4 black=vec4(0.,0.,0.,1.);void main(){vec4 colorFromTexture=texture2D(map,vUv);float whiteness=1.-smoothstep(0.1,0.2,opacity);colorFromTexture=mix(colorFromTexture,vec4(colorOverlay.rgb,1.),colorOverlay.a);colorFromTexture=mix(colorFromTexture,white,whiteness);gl_FragColor=vec4(colorFromTexture.rgb,opacity);}"},10982:e=>{e.exports="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},40933:e=>{e.exports="#ifdef PANO_TEXTURE\nuniform vec3 pano0Position;uniform samplerCube pano0Map;varying vec3 pano0SweepDirection;uniform float panoOpacity;\n#endif\n#ifdef PANO_TEXTURE_TRANSITION\nuniform float progress;uniform vec3 pano1Position;uniform samplerCube pano1Map;varying vec3 pano1SweepDirection;\n#endif\n#ifdef PANO_OVERLAY\nuniform samplerCube overlay0Map;varying vec3 overlay0WorldPos;\n#endif\n#ifdef PANO_OVERLAY_TRANSITION\nuniform samplerCube overlay1Map;varying vec3 overlay1WorldPos;\n#endif\n#ifdef MESH_PREVIEW_SPHERE\nuniform vec3 meshPreviewCenter;uniform float meshPreviewSize;\n#endif\n#ifdef MESH_TEXTURE\nvarying vec2 vUv;uniform sampler2D map;uniform float meshOpacity;uniform float opacity;uniform float transparentDiscardDist;varying vec3 worldPos;\n#endif\n#ifdef COLOR_OVERLAY\nuniform vec4 colorOverlay;\n#endif\n#ifdef WIREFRAME\nvarying vec3 vBarycentric;uniform float time;uniform float thickness;uniform float secondThickness;uniform float dashRepeats;uniform float dashLength;uniform bool dashOverlap;uniform bool dashEnabled;uniform bool dashAnimate;uniform bool fillEnabled;uniform bool insideAltColor;uniform bool dualStroke;uniform bool squeeze;uniform float squeezeMin;uniform float squeezeMax;uniform float wireframeOpacity;uniform vec3 stroke;uniform vec3 fill;float aastep(float threshold,float dist){float afwidth=fwidth(dist)*0.5;return smoothstep(threshold-afwidth,threshold+afwidth,dist);}float computeScreenSpaceWireframe(vec3 barycentric,float lineWidth){vec3 dist=fwidth(barycentric);vec3 smoothed=smoothstep(dist*((lineWidth*0.5)-0.5),dist*((lineWidth*0.5)+0.5),barycentric);return 1.-min(min(smoothed.x,smoothed.y),smoothed.z);}vec4 getStyledWireframe(vec3 barycentric){float PI=3.14159265359;float d=min(min(barycentric.x,barycentric.y),barycentric.z);float positionAlong=max(barycentric.x,barycentric.y);if(barycentric.y<barycentric.x&&barycentric.y<barycentric.z){positionAlong=1.-positionAlong;}float computedThickness=thickness;if(squeeze){computedThickness*=mix(squeezeMin,squeezeMax,(1.-sin(positionAlong*PI)));}if(dashEnabled){float offset=1./dashRepeats*dashLength/2.;if(!dashOverlap){offset+=1./dashRepeats/2.;}if(dashAnimate){offset+=time*0.22;}float pattern=fract((positionAlong+offset)*dashRepeats);computedThickness*=1.-aastep(dashLength,pattern);}float edge=computeScreenSpaceWireframe(barycentric,computedThickness);vec4 outColor=vec4(0.,0.,0.,0.);if(!fillEnabled){outColor=vec4(stroke,edge);if(insideAltColor&&!gl_FrontFacing){outColor.rgb=fill;}}else{outColor.a=1.;if(dualStroke){float inner=1.-aastep(secondThickness,d);vec3 wireColor=mix(fill,stroke,abs(inner-edge));outColor.rgb=wireColor;}else{outColor.rgb=mix(fill,stroke,edge);}}outColor.a*=wireframeOpacity;return outColor;}\n#endif\n#ifdef FLAT_SHADING\nvarying vec3 vNormal;\n#endif\nvoid main(){\n#ifdef PANO_TEXTURE_TRANSITION\nvec4 colorFromPano0=textureCube(pano0Map,pano0SweepDirection.xyz);vec4 colorFromPano1=textureCube(pano1Map,pano1SweepDirection.xyz);\n#ifdef PANO_OVERLAY_TRANSITION\nvec4 colorFromOverlay0=textureCube(overlay0Map,overlay0WorldPos.xyz);vec4 colorFromOverlay1=textureCube(overlay1Map,overlay1WorldPos.xyz);colorFromPano0.rgb=mix(colorFromPano0.rgb,colorFromOverlay0.rgb,colorFromOverlay0.a);colorFromPano1.rgb=mix(colorFromPano1.rgb,colorFromOverlay1.rgb,colorFromOverlay1.a);\n#endif\nvec4 color=mix(colorFromPano0,colorFromPano1,progress);color.a=panoOpacity;\n#elif defined(PANO_TEXTURE)\nvec4 color=textureCube(pano0Map,pano0SweepDirection.xyz);\n#ifdef PANO_OVERLAY\nvec4 colorFromOverlay0=textureCube(overlay0Map,overlay0WorldPos.xyz);color.rgb=mix(color.rgb,colorFromOverlay0.rgb,colorFromOverlay0.a);\n#endif\ncolor.a=panoOpacity;\n#else\nvec4 color=vec4(0.,0.,0.,0.);\n#endif\n#ifdef MESH_TEXTURE\nvec4 colorFromTexture=texture2D(map,vUv);float depth=distance(cameraPosition,worldPos.xyz);if(opacity<1.&&depth<transparentDiscardDist){discard;}\n#endif\n#ifdef MESH_PREVIEW_SPHERE\nfloat previewDistance=distance(worldPos.xyz,meshPreviewCenter.xyz);float inSphere=step(previewDistance,meshPreviewSize);colorFromTexture+=colorFromTexture*(0.2*inSphere);color=mix(color,colorFromTexture,max(meshOpacity,inSphere));\n#elif defined(MESH_TEXTURE)\ncolor=mix(color,colorFromTexture,meshOpacity);\n#endif\n#ifdef FLAT_SHADING\nfloat ao=0.9-abs(vNormal.y)*0.1-abs(vNormal.x)*0.05+abs(vNormal.z)*0.05;color.rgb=vec3(ao,ao*1.025,ao*1.05);\n#endif\n#ifdef COLOR_OVERLAY\ncolor=mix(color,vec4(colorOverlay.rgb,1.),colorOverlay.a);\n#endif\n#ifdef WIREFRAME\nvec4 colorFromWireframe=getStyledWireframe(vBarycentric);color=mix(color,vec4(colorFromWireframe.rgb,1.),colorFromWireframe.a);\n#endif\n#ifdef MESH_TEXTURE\ncolor.a=opacity;\n#endif\ngl_FragColor=color;}"},57971:e=>{e.exports="#ifdef PANO_TEXTURE\nuniform vec3 pano0Position;uniform mat4 pano0Matrix1;uniform mat4 pano0Matrix2;varying vec3 pano0SweepDirection;\n#endif\n#ifdef PANO_TEXTURE_TRANSITION\nuniform vec3 pano1Position;uniform mat4 pano1Matrix1;uniform mat4 pano1Matrix2;varying vec3 pano1SweepDirection;\n#endif\n#ifdef PANO_OVERLAY\nvarying vec3 overlay0WorldPos;uniform mat4 overlay0Matrix;\n#endif\n#ifdef PANO_OVERLAY_TRANSITION\nvarying vec3 overlay1WorldPos;uniform mat4 overlay1Matrix;\n#endif\n#ifdef MESH_PREVIEW_SPHERE\n#endif\n#ifdef MESH_TEXTURE\nvarying vec2 vUv;varying vec3 worldPos;\n#endif\n#ifdef WIREFRAME\nattribute vec3 barycentric;varying vec3 vBarycentric;\n#endif\n#ifdef FLAT_SHADING\nvarying vec3 vNormal;\n#endif\nvoid main(){vec4 worldPosition=modelMatrix*vec4(position,1.);\n#ifdef MESH_TEXTURE\nvUv=uv;worldPos=worldPosition.xyz;\n#endif\n#ifdef WIREFRAME\nvBarycentric=barycentric;\n#endif\n#ifdef FLAT_SHADING\nvNormal=normal;\n#endif\n#ifdef PANO_TEXTURE\nvec3 positionLocalToPanoCenter0=worldPosition.xyz-pano0Position;pano0SweepDirection=(pano0Matrix2*pano0Matrix1*vec4(positionLocalToPanoCenter0,1.)).xyz;\n#ifdef PANO_OVERLAY\noverlay0WorldPos=(overlay0Matrix*vec4(positionLocalToPanoCenter0,1.)).xyz;\n#endif\n#endif\n#ifdef PANO_TEXTURE_TRANSITION\nvec3 positionLocalToPanoCenter1=worldPosition.xyz-pano1Position;pano1SweepDirection=(pano1Matrix2*pano1Matrix1*vec4(positionLocalToPanoCenter1,1.)).xyz;\n#ifdef PANO_OVERLAY_TRANSITION\noverlay1WorldPos=(overlay1Matrix*vec4(positionLocalToPanoCenter1,1.)).xyz;\n#endif\n#endif\nvec4 projectedPosition=projectionMatrix*modelViewMatrix*vec4(position,1.);gl_Position=projectedPosition;}"},36888:e=>{e.exports="#ifdef INSTANCED\nvarying float alpha;varying vec3 color;\n#else\nuniform float alpha;uniform vec3 color;\n#endif\nuniform sampler2D bg;uniform sampler2D mask;varying vec2 vUv;void main(){vec4 bgColor=texture2D(bg,vUv);if(bgColor.a*alpha<0.1){discard;}vec4 maskColor=texture2D(mask,vUv);vec3 mappedColor=mix(color,maskColor.rgb,maskColor.a);gl_FragColor=vec4(mappedColor,bgColor.a*alpha);}"},34086:e=>{e.exports="varying vec2 vUv;\n#ifdef INSTANCED\nattribute mat4 instanceMatrix;attribute float instanceAlpha;attribute vec3 instanceColor;varying float alpha;varying vec3 color;\n#endif\nvoid main(){vUv=uv;\n#ifdef INSTANCED\nalpha=instanceAlpha;color=instanceColor;gl_Position=projectionMatrix*modelViewMatrix*instanceMatrix*vec4(position,1.);\n#else\ngl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n#endif\n}"},81713:e=>{e.exports="varying vec2 vUv;void main(){float dist=length(vUv);float alpha=(1.-smoothstep(0.95,1.,dist))*0.3;gl_FragColor=vec4(1.,1.,1.,alpha);}"},18144:e=>{e.exports="varying vec2 vUv;void main(){vUv=(uv*2.)-1.;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);gl_Position.z*=1.00001;}"},7532:e=>{e.exports="#ifdef INSTANCED\nvarying float alpha;\n#else\nuniform float alpha;\n#endif\nvoid main(){gl_FragColor=vec4(1.,1.,1.,alpha);}"},18934:e=>{e.exports="uniform vec2 resolution;\n#ifdef INSTANCED\nattribute mat4 instanceMatrix;attribute vec3 stemVector;attribute vec4 pinHeadMatrixCol0;attribute vec4 pinHeadMatrixCol1;attribute vec4 pinHeadMatrixCol2;attribute vec4 pinHeadMatrixCol3;attribute float instanceAlpha;varying float alpha;\n#else\nuniform mat4 pinHeadMatrix;\n#endif\n#define PI 3.1415926538\nvoid main(){\n#ifdef INSTANCED\nvec3 pos=position*stemVector;mat4 modelViewProjMatrix=projectionMatrix*modelViewMatrix*instanceMatrix;mat4 pinHeadMatrix=mat4(pinHeadMatrixCol0,pinHeadMatrixCol1,pinHeadMatrixCol2,pinHeadMatrixCol3);alpha=instanceAlpha;\n#else\nvec3 pos=position;mat4 modelViewProjMatrix=projectionMatrix*modelViewMatrix;\n#endif\nvec3 fromOrigin=(vec3(0.,0.,0.)-pos);if(length(fromOrigin)<1e-6){gl_Position=modelViewProjMatrix*vec4(pos,1.);}else{mat4 noteViewProj=projectionMatrix*viewMatrix*pinHeadMatrix;vec4 noteNDC=noteViewProj*vec4(0.,0.,0.,1.);noteNDC.xyz/=abs(noteNDC.w);vec4 discEdgeNDC=noteViewProj*vec4(0.5,0.,0.,1.);discEdgeNDC.xyz/=abs(discEdgeNDC.w);float noteSizeNDC=length(discEdgeNDC.xy-noteNDC.xy);vec4 anchorNDC=modelViewProjMatrix*vec4(0.,0.,0.,1.);anchorNDC.xyz/=abs(anchorNDC.w);vec4 vectorNDC=modelViewProjMatrix*vec4(pos,1.);vectorNDC.xyz/=abs(vectorNDC.w);vectorNDC-=anchorNDC;float lineLengthNDC=length(vectorNDC.xy);float vertDot=abs(dot(normalize(vectorNDC.xy),vec2(0,1)));float angle=acos(vertDot)/(PI/2.);float aspect=mix(resolution.x/resolution.y,1.,angle);vec2 vector2d=normalize(vectorNDC.xy)*max(lineLengthNDC-noteSizeNDC*aspect,0.);vectorNDC.xy=vector2d.xy;vectorNDC+=anchorNDC;gl_Position=vec4(vectorNDC.xyz,1.);}}"},57223:e=>{e.exports="uniform float borderSize;uniform float textureSampleScale;uniform samplerCube panoTexture;uniform vec4 borderColor;varying vec2 vUv;const vec4 transparent=vec4(0.,0.,0.,0.);const float PI=3.14159265359;const float HALF_PI=PI/2.;void main(){float fadeDist=0.1;float r=1.;vec2 uv=(vUv*2.)-vec2(1.,1.);float d=length(uv);float p=d*PI-HALF_PI;float y=sin(p);float h=cos(p)*textureSampleScale;vec3 sampleVec=vec3(uv.x*h,y,uv.y*h);vec4 panoColor=textureCube(panoTexture,sampleVec);panoColor.a=clamp(((1.-d)/d)/fadeDist,0.,1.);vec4 outColor=mix(panoColor,transparent,step(1.,d));float isBorder=max(sign(borderSize),0.)*step(1.-borderSize,d)*step(d,1.);gl_FragColor=mix(outColor,borderColor,isBorder);}"},74624:e=>{e.exports="varying vec2 vUv;void main(){vUv=uv;vec4 projectedPosition=projectionMatrix*viewMatrix*modelMatrix*vec4(position,1.);gl_Position=projectedPosition;}"},14499:e=>{e.exports="uniform sampler2D bg;uniform sampler2D mask;varying vec2 vUv;void main(){vec4 existingColor=texture2D(bg,vUv);vec4 maskColor=texture2D(mask,vUv);gl_FragColor=vec4(existingColor.rgb*maskColor.rgb,maskColor.a);}"},47151:e=>{e.exports="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*vec4(position,1.);}"},54779:e=>{e.exports="uniform sampler2D texture;varying vec2 vUv;void main(){vec4 color=texture2D(texture,vUv);gl_FragColor=vec4(color.rgb,1.);}"},95611:e=>{e.exports="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*vec4(position,1.);}"},72488:e=>{e.exports="#define M_PI 3.14159265359\nuniform samplerCube cubemap;uniform float yaw;varying vec2 vUv;void main(){vec2 uv=vUv;float theta=uv.x*2.*M_PI+yaw;float phi=uv.y*M_PI;vec3 longitude=vec3(sin(theta),1.,-cos(theta));vec3 latitude=vec3(sin(phi),-cos(phi),sin(phi));vec3 dir=longitude*latitude;normalize(dir);gl_FragColor=vec4(textureCube(cubemap,dir).rgb,1.);}"},64799:e=>{e.exports="varying vec2 vUv;void main(){vUv=vec2(1.-uv.x,uv.y);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},55185:e=>{e.exports="uniform vec3 topColor;uniform vec3 bottomColor;uniform float radius;varying vec4 worldPosition;\n#define SRGB_TO_LINEAR(c) pow((c), vec3(2.2))\n#define LINEAR_TO_SRGB(c) pow((c), vec3(1.0 / 2.2))\n#define USE_DITHER\nfloat gradientNoise(in vec2 uv){const vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(uv,magic.xy)));}void main(){float normalizedHeight=(worldPosition.y+radius)/(radius*2.);float ratio=smoothstep(0.,0.5,normalizedHeight);vec3 colorFromGradient=mix(SRGB_TO_LINEAR(bottomColor),SRGB_TO_LINEAR(topColor),ratio);vec3 color=LINEAR_TO_SRGB(colorFromGradient);\n#if defined (USE_DITHER)\ncolor+=(1./255.)*gradientNoise(gl_FragCoord.xy)-(0.5/255.);\n#endif\ngl_FragColor=vec4(color,1.);}"},13833:e=>{e.exports="varying vec4 worldPosition;void main(){worldPosition=modelMatrix*vec4(position,1.);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},69254:e=>{e.exports="precision highp float;precision highp int;varying vec2 vUv;uniform sampler2D tMask;uniform sampler2D tPinHole;uniform vec3 pinColor;uniform float opacity;void main(){vec4 maskColor=texture2D(tMask,vUv);vec4 pinHoleColor=vec4(texture2D(tPinHole,vec2(vUv.x,vUv.y-0.11)).xyz,1.);float redness=maskColor.r-maskColor.b;vec4 mixedPinColor=mix(vec4(pinColor,1.),pinHoleColor,redness);mixedPinColor.a=min(mixedPinColor.a,maskColor.a)*opacity;gl_FragColor=mixedPinColor;}"},76570:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 position;attribute vec2 uv;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},64506:e=>{e.exports="precision highp float;precision highp int;uniform samplerCube tMap;varying vec3 vUvw;void main(){vec4 color=textureCube(tMap,vec3(-vUvw.x,vUvw.yz));gl_FragColor=vec4(color.rgb,1.);}"},95432:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 position;varying vec3 vUvw;void main(){vUvw=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},28100:e=>{e.exports="precision highp float;precision highp int;varying vec2 vUv;uniform float progress;uniform float opacity;uniform sampler2D tNoHover;uniform sampler2D tHover;uniform sampler2D tPortal;void main(){vec4 noHoverColor=texture2D(tNoHover,vUv);vec4 hoverColor=texture2D(tHover,vUv);vec4 portalColor=texture2D(tPortal,vUv);float xToCtr=2.*vUv.x-1.;float yToCtr=2.*vUv.y-1.;float withinRadius=step(xToCtr*xToCtr+yToCtr*yToCtr,0.9);vec4 mixedPortalColor=mix(hoverColor,portalColor,withinRadius);mixedPortalColor=mix(mixedPortalColor,hoverColor,hoverColor.a);mixedPortalColor=mix(noHoverColor,mixedPortalColor,progress);mixedPortalColor.a=min(mixedPortalColor.a,opacity);gl_FragColor=mixedPortalColor;}"},22118:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 position;attribute vec2 uv;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},93366:e=>{e.exports="varying vec3 vWorldPos;uniform float alpha;uniform samplerCube tDiffuse;void main(){vec4 texColor=textureCube(tDiffuse,vWorldPos);gl_FragColor=vec4(texColor.rgb,texColor.a*alpha);}"},28737:e=>{e.exports="varying vec3 vWorldPos;void main(){vWorldPos=vec3(-position.x,-position.y,position.z);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},64715:e=>{e.exports="varying vec2 vUv;uniform sampler2D tDiffuse;\n#ifdef INSTANCED\nvarying float alpha;\n#else\nuniform float alpha;\n#endif\nvoid main(){vec4 texColor=texture2D(tDiffuse,vUv);gl_FragColor=vec4(texColor.rgb,texColor.a*alpha);}"},79826:e=>{e.exports="#ifdef INSTANCED\nattribute mat4 instanceMatrix;attribute float instanceAlpha;varying float alpha;\n#endif\nvarying vec2 vUv;void main(){vUv=uv;\n#ifdef INSTANCED\nmat4 mvp=projectionMatrix*modelViewMatrix*instanceMatrix;alpha=instanceAlpha;\n#else\nmat4 mvp=projectionMatrix*modelViewMatrix;\n#endif\ngl_Position=mvp*vec4(position,1.);}"},31090:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;"},69383:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;"},96228:e=>{e.exports="uniform vec3 color;uniform float opacity;void main(){gl_FragColor=vec4(color,opacity);}"},55546:e=>{e.exports="void main(){gl_Position=vec4(position,1.);}"},45576:e=>{e.exports="precision highp float;precision highp int;uniform sampler2D map;uniform vec3 color;uniform float opacity;varying vec2 vUv;void main(){vec4 sample=texture2D(map,vUv).rgba;gl_FragColor=vec4(sample.rgb*color.rgb,clamp(sample.a*opacity,0.,1.));}"},60948:e=>{e.exports="precision highp float;precision highp int;attribute vec2 uv;attribute vec4 position;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*position;}"},12739:e=>{var t=/\n/,i="\n",n=/\s/;function s(e,t,i,n){var s=e.indexOf(t,i);return-1===s||s>n?n:s}function r(e){return n.test(e)}function o(e,t,i,n){return{start:t,end:t+Math.min(n,i-t)}}e.exports=function(t,i){return e.exports.lines(t,i).map((function(e){return t.substring(e.start,e.end)})).join("\n")},e.exports.lines=function(e,n){if(0===(n=n||{}).width&&"nowrap"!==n.mode)return[];e=e||"";var a="number"==typeof n.width?n.width:Number.MAX_VALUE,l=Math.max(0,n.start||0),c="number"==typeof n.end?n.end:e.length,h=n.mode,d=n.measure||o;return"pre"===h?function(e,i,n,s,r){for(var o=[],a=n,l=n;l<s&&l<i.length;l++){var c=i.charAt(l),h=t.test(c);if(h||l===s-1){var d=e(i,a,h?l:l+1,r);o.push(d),a=l+1}}return o}(d,e,l,c,a):function(e,t,n,o,a,l){var c=[],h=a;"nowrap"===l&&(h=Number.MAX_VALUE);for(;n<o&&n<t.length;){for(var d=s(t,i,n,o);n<d&&r(t.charAt(n));)n++;var u=e(t,n,d,h),p=n+(u.end-u.start),m=p+i.length;if(p<d){for(;p>n&&!r(t.charAt(p));)p--;if(p===n)m>n+i.length&&m--,p=m;else for(m=p;p>n&&r(t.charAt(p-i.length));)p--}if(p>=n){var g=e(t,n,p,h);c.push(g)}n=m}return c}(d,e,l,c,a,h)}},47529:e=>{e.exports=function(){for(var e={},i=0;i<arguments.length;i++){var n=arguments[i];for(var s in n)t.call(n,s)&&(e[s]=n[s])}return e};var t=Object.prototype.hasOwnProperty},49329:(e,t,i)=>{e.exports=i(60516).Observable},60516:(e,t)=>{"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}t.Observable=void 0;var r=function(){return"function"==typeof Symbol},o=function(e){return r()&&Boolean(Symbol[e])},a=function(e){return o(e)?Symbol[e]:"@@"+e};r()&&!o("observable")&&(Symbol.observable=Symbol("observable"));var l=a("iterator"),c=a("observable"),h=a("species");function d(e,t){var i=e[t];if(null!=i){if("function"!=typeof i)throw new TypeError(i+" is not a function");return i}}function u(e){var t=e.constructor;return void 0!==t&&null===(t=t[h])&&(t=void 0),void 0!==t?t:w}function p(e){return e instanceof w}function m(e){m.log?m.log(e):setTimeout((function(){throw e}))}function g(e){Promise.resolve().then((function(){try{e()}catch(e){m(e)}}))}function f(e){var t=e._cleanup;if(void 0!==t&&(e._cleanup=void 0,t))try{if("function"==typeof t)t();else{var i=d(t,"unsubscribe");i&&i.call(t)}}catch(e){m(e)}}function v(e){e._observer=void 0,e._queue=void 0,e._state="closed"}function y(e,t,i){e._state="running";var n=e._observer;try{var s=d(n,t);switch(t){case"next":s&&s.call(n,i);break;case"error":if(v(e),!s)throw i;s.call(n,i);break;case"complete":v(e),s&&s.call(n)}}catch(e){m(e)}"closed"===e._state?f(e):"running"===e._state&&(e._state="ready")}function b(e,t,i){if("closed"!==e._state){if("buffering"!==e._state)return"ready"!==e._state?(e._state="buffering",e._queue=[{type:t,value:i}],void g((function(){return function(e){var t=e._queue;if(t){e._queue=void 0,e._state="ready";for(var i=0;i<t.length&&(y(e,t[i].type,t[i].value),"closed"!==e._state);++i);}}(e)}))):void y(e,t,i);e._queue.push({type:t,value:i})}}var S=function(){function e(t,n){i(this,e),this._cleanup=void 0,this._observer=t,this._queue=void 0,this._state="initializing";var s=new E(this);try{this._cleanup=n.call(void 0,s)}catch(e){s.error(e)}"initializing"===this._state&&(this._state="ready")}return s(e,[{key:"unsubscribe",value:function(){"closed"!==this._state&&(v(this),f(this))}},{key:"closed",get:function(){return"closed"===this._state}}]),e}(),E=function(){function e(t){i(this,e),this._subscription=t}return s(e,[{key:"next",value:function(e){b(this._subscription,"next",e)}},{key:"error",value:function(e){b(this._subscription,"error",e)}},{key:"complete",value:function(){b(this._subscription,"complete")}},{key:"closed",get:function(){return"closed"===this._subscription._state}}]),e}(),w=function(){function e(t){if(i(this,e),!(this instanceof e))throw new TypeError("Observable cannot be called as a function");if("function"!=typeof t)throw new TypeError("Observable initializer must be a function");this._subscriber=t}return s(e,[{key:"subscribe",value:function(e){return"object"==typeof e&&null!==e||(e={next:e,error:arguments[1],complete:arguments[2]}),new S(e,this._subscriber)}},{key:"forEach",value:function(e){var t=this;return new Promise((function(i,n){if("function"==typeof e)var s=t.subscribe({next:function(t){try{e(t,r)}catch(e){n(e),s.unsubscribe()}},error:n,complete:i});else n(new TypeError(e+" is not a function"));function r(){s.unsubscribe(),i()}}))}},{key:"map",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(u(this))((function(i){return t.subscribe({next:function(t){try{t=e(t)}catch(e){return i.error(e)}i.next(t)},error:function(e){i.error(e)},complete:function(){i.complete()}})}))}},{key:"filter",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(u(this))((function(i){return t.subscribe({next:function(t){try{if(!e(t))return}catch(e){return i.error(e)}i.next(t)},error:function(e){i.error(e)},complete:function(){i.complete()}})}))}},{key:"reduce",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var i=u(this),n=arguments.length>1,s=!1,r=arguments[1],o=r;return new i((function(i){return t.subscribe({next:function(t){var r=!s;if(s=!0,!r||n)try{o=e(o,t)}catch(e){return i.error(e)}else o=t},error:function(e){i.error(e)},complete:function(){if(!s&&!n)return i.error(new TypeError("Cannot reduce an empty sequence"));i.next(o),i.complete()}})}))}},{key:"concat",value:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var s=u(this);return new s((function(t){var n,r=0;return function e(o){n=o.subscribe({next:function(e){t.next(e)},error:function(e){t.error(e)},complete:function(){r===i.length?(n=void 0,t.complete()):e(s.from(i[r++]))}})}(e),function(){n&&(n.unsubscribe(),n=void 0)}}))}},{key:"flatMap",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var i=u(this);return new i((function(n){var s=[],r=t.subscribe({next:function(t){if(e)try{t=e(t)}catch(e){return n.error(e)}var r=i.from(t).subscribe({next:function(e){n.next(e)},error:function(e){n.error(e)},complete:function(){var e=s.indexOf(r);e>=0&&s.splice(e,1),o()}});s.push(r)},error:function(e){n.error(e)},complete:function(){o()}});function o(){r.closed&&0===s.length&&n.complete()}return function(){s.forEach((function(e){return e.unsubscribe()})),r.unsubscribe()}}))}},{key:c,value:function(){return this}}],[{key:"from",value:function(t){var i="function"==typeof this?this:e;if(null==t)throw new TypeError(t+" is not an object");var n=d(t,c);if(n){var s=n.call(t);if(Object(s)!==s)throw new TypeError(s+" is not an object");return p(s)&&s.constructor===i?s:new i((function(e){return s.subscribe(e)}))}if(o("iterator")&&(n=d(t,l)))return new i((function(e){g((function(){if(!e.closed){var i=!0,s=!1,r=void 0;try{for(var o,a=n.call(t)[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var l=o.value;if(e.next(l),e.closed)return}}catch(e){s=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw r}}e.complete()}}))}));if(Array.isArray(t))return new i((function(e){g((function(){if(!e.closed){for(var i=0;i<t.length;++i)if(e.next(t[i]),e.closed)return;e.complete()}}))}));throw new TypeError(t+" is not observable")}},{key:"of",value:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var s="function"==typeof this?this:e;return new s((function(e){g((function(){if(!e.closed){for(var t=0;t<i.length;++t)if(e.next(i[t]),e.closed)return;e.complete()}}))}))}},{key:h,get:function(){return this}}]),e}();t.Observable=w,r()&&Object.defineProperty(w,Symbol("extensions"),{value:{symbol:c,hostReportError:m},configurable:!0})},98443:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FileAttachments"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fileAttachmentsByModelId"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"results"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FileAttachmentDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteExternalAttachment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"attachmentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"parentType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ParentType"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteExternalAttachment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"attachmentId"},value:{kind:"Variable",name:{kind:"Name",value:"attachmentId"}}},{kind:"Argument",name:{kind:"Name",value:"parentType"},value:{kind:"Variable",name:{kind:"Name",value:"parentType"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchExternalAttachment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"attachmentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ExternalAttachmentDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchExternalAttachment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"attachmentId"},value:{kind:"Variable",name:{kind:"Name",value:"attachmentId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ExternalAttachmentDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteFileAttachment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteFileAttachment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadFileAttachmentToModel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"organizationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filename"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"uploadFileAttachmentToModel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"organizationId"},value:{kind:"Variable",name:{kind:"Name",value:"organizationId"}}},{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"filename"},value:{kind:"Variable",name:{kind:"Name",value:"filename"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FileAttachmentDetails"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"FileAttachmentDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FileAttachment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"bytes"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mimeType"},arguments:[],directives:[]},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ImageFileAttachment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"imageWidth"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"imageHeight"},arguments:[],directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"ExternalAttachmentDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ExternalAttachment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"thumbnailUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mediaType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"category"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parentDetails"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parent"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:1503}};t.loc.source={body:"\n# read all attachments for the specified model\nquery FileAttachments($modelId: ID!) {\n  fileAttachmentsByModelId(modelId: $modelId) {\n    results { ...FileAttachmentDetails }\n  }\n}\n\n# Deletes a single external attachment\nmutation DeleteExternalAttachment($modelId: ID!, $attachmentId: ID!, $parentType: ParentType!) {\n  deleteExternalAttachment(modelId: $modelId, , attachmentId: $attachmentId, parentType: $parentType)\n}\n\n# Update a single external attachment\nmutation PatchExternalAttachment($modelId: ID!, $attachmentId: ID!, $data: ExternalAttachmentDetails!) {\n  patchExternalAttachment(modelId: $modelId, , attachmentId: $attachmentId, patch: $data) {\n    ...ExternalAttachmentDetails\n  }\n}\n\nmutation DeleteFileAttachment($id: ID!) {\n  deleteFileAttachment(id: $id)\n}\n\nmutation UploadFileAttachmentToModel($organizationId: ID!, $modelId: ID!, $contents: FileUpload!, $filename: String!) {\n  uploadFileAttachmentToModel(organizationId: $organizationId, modelId: $modelId,\n                              contents: $contents, filename: $filename) {\n    ...FileAttachmentDetails\n  }\n}\n\nfragment FileAttachmentDetails on FileAttachment {\n  id\n  created\n  filename\n  url\n  validUntil\n  bytes\n  mimeType\n  ...on ImageFileAttachment {\n      imageWidth\n      imageHeight\n  }\n}\n\n# common External Attachment properties\nfragment ExternalAttachmentDetails on ExternalAttachment {\n  id\n  created\n  modified\n  thumbnailUrl\n  url\n  mediaType\n  width\n  height\n  category\n  parentDetails { type, parent { id } }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.FileAttachments=r(t,"FileAttachments"),e.exports.DeleteExternalAttachment=r(t,"DeleteExternalAttachment"),e.exports.PatchExternalAttachment=r(t,"PatchExternalAttachment"),e.exports.DeleteFileAttachment=r(t,"DeleteFileAttachment"),e.exports.UploadFileAttachmentToModel=r(t,"UploadFileAttachmentToModel"),e.exports.FileAttachmentDetails=r(t,"FileAttachmentDetails"),e.exports.ExternalAttachmentDetails=r(t,"ExternalAttachmentDetails")},70129:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddCommentAttachments"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"commentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"externalAttachments"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ExternalAttachmentDetails"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"fileAttachments"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addCommentAttachments"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"commentId"},value:{kind:"Variable",name:{kind:"Name",value:"commentId"}}},{kind:"Argument",name:{kind:"Name",value:"externalAttachments"},value:{kind:"Variable",name:{kind:"Name",value:"externalAttachments"}}},{kind:"Argument",name:{kind:"Name",value:"fileAttachments"},value:{kind:"Variable",name:{kind:"Name",value:"fileAttachments"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CommentAttachments"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"commentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"commentId"},value:{kind:"Variable",name:{kind:"Name",value:"commentId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"commentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CommentPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"commentId"},value:{kind:"Variable",name:{kind:"Name",value:"commentId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CommentDetails"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"CommentDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Comment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"edited"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"text"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdBy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"firstName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"externalAttachments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ExternalAttachmentDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"fileAttachments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FileAttachmentDetails"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"CommentAttachments"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Comment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"externalAttachments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ExternalAttachmentDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"fileAttachments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FileAttachmentDetails"},directives:[]}]}}]}}],loc:{start:0,end:1213}};n.loc.source={body:'#import "./attachments.gql"\n\n# Add comment attachments\nmutation AddCommentAttachments($modelId: ID!, $commentId: ID!, $externalAttachments: [ExternalAttachmentDetails!], $fileAttachments: [ID!]) {\n  addCommentAttachments(modelId: $modelId, , commentId: $commentId,\n                        externalAttachments: $externalAttachments,\n                        fileAttachments: $fileAttachments) {\n    ...CommentAttachments\n  }\n}\n\n# Deletes a single comment\nmutation DeleteComment ($modelId: ID!, $commentId: ID!) {\n  deleteComment(modelId: $modelId, , commentId: $commentId)\n}\n\n# Update a single comment\nmutation PatchComment($modelId: ID!, $commentId: ID!, $data: CommentPatch!) {\n  patchComment(modelId: $modelId, , commentId: $commentId, patch: $data) {\n    ...CommentDetails\n  }\n}\n\n# common Comment properties\nfragment CommentDetails on Comment {\n  id\n  created\n  modified\n  edited\n  text\n  createdBy { id, firstName, lastName, email }\n  externalAttachments { ...ExternalAttachmentDetails }\n  fileAttachments { ...FileAttachmentDetails }\n}\n\n# Attachments on a Comment\nfragment CommentAttachments on Comment {\n  externalAttachments { ...ExternalAttachmentDetails }\n  fileAttachments { ...FileAttachmentDetails }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function r(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){r(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){r(e,t)})),e.definitions&&e.definitions.forEach((function(e){r(e,t)}))}n.definitions=n.definitions.concat(i(98443).definitions.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)})));var o={};function a(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function l(e,t){var i={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=o[t]||new Set,s=new Set,r=new Set;for(n.forEach((function(e){r.add(e)}));r.size>0;){var l=r;r=new Set,l.forEach((function(e){s.has(e)||(s.add(e),(o[e]||new Set).forEach((function(e){r.add(e)})))}))}return s.forEach((function(t){var n=a(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;r(e,t),o[e.name.value]=t}})),e.exports=n,e.exports.AddCommentAttachments=l(n,"AddCommentAttachments"),e.exports.DeleteComment=l(n,"DeleteComment"),e.exports.PatchComment=l(n,"PatchComment"),e.exports.CommentDetails=l(n,"CommentDetails"),e.exports.CommentAttachments=l(n,"CommentAttachments")},81047:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetFloors"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FloorDetails"},directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"FloorDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelFloor"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"classification"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sequence"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dimensions"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"areaFloor"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchFloor"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"floorId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FloorPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchFloor"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"floorId"},value:{kind:"Variable",name:{kind:"Name",value:"floorId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:380}};t.loc.source={body:"query GetFloors($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    floors { ...FloorDetails }\n  }\n}\n\nfragment FloorDetails on ModelFloor {\n  id\n  meshId\n  classification\n  label\n  sequence\n  dimensions {\n    areaFloor\n  }\n}\n\nmutation PatchFloor($modelId: ID!, $floorId: ID!, $data: FloorPatch!) {\n  patchFloor(modelId: $modelId, , floorId: $floorId, patch: $data) {\n    id\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetFloors=r(t,"GetFloors"),e.exports.FloorDetails=r(t,"FloorDetails"),e.exports.PatchFloor=r(t,"PatchFloor")},95162:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetLabels"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"labels"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddLabel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"labelId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LabelDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addLabel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"labelId"},value:{kind:"Variable",name:{kind:"Name",value:"labelId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchLabel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"labelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LabelPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchLabel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"labelId"},value:{kind:"Variable",name:{kind:"Name",value:"labelId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteLabel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"labelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteLabel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"labelId"},value:{kind:"Variable",name:{kind:"Name",value:"labelId"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"LabelDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Label"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}],loc:{start:0,end:929}};t.loc.source={body:"# Read all labels for the given model\nquery GetLabels($modelId: ID!, $includeDisabled: Boolean!) {\n  model(id: $modelId) {\n    id,\n    labels (includeDisabled: $includeDisabled) {\n      ...LabelDetails\n    }\n  }\n}\n\n# Create a new label\nmutation AddLabel ($modelId: ID!, $labelId: ID, $data: LabelDetails!) {\n  addLabel(modelId: $modelId, labelId: $labelId, label: $data) {\n    ...LabelDetails\n  }\n}\n\n# Update a single label\nmutation PatchLabel ($modelId: ID!, $labelId: ID!, $data: LabelPatch!) {\n  patchLabel(modelId: $modelId, , labelId: $labelId, patch: $data) {\n    ...LabelDetails\n  }\n}\n\n# Deletes a single label\nmutation DeleteLabel ($modelId: ID!, ,$labelId: ID!) {\n  deleteLabel(modelId: $modelId, ,labelId: $labelId)\n}\n\n# Default Label properties used by Showcase and Workshop\nfragment LabelDetails on Label {\n  id\n  position { x y z }\n  floor { id meshId }\n  room { id meshId }\n  label\n  enabled\n  created\n  modified\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetLabels=r(t,"GetLabels"),e.exports.AddLabel=r(t,"AddLabel"),e.exports.PatchLabel=r(t,"PatchLabel"),e.exports.DeleteLabel=r(t,"DeleteLabel"),e.exports.LabelDetails=r(t,"LabelDetails")},6850:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetMattertags"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mattertags"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MattertagDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddMattertag"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MattertagDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addMattertag"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"mattertagId"},value:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}}},{kind:"Argument",name:{kind:"Name",value:"mattertag"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteMattertag"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteMattertag"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"mattertagId"},value:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"MattertagDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Mattertag"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"color"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"anchorPosition"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"stemEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"stemNormal"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"stemLength"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"media"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mediaType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}],loc:{start:0,end:930}};t.loc.source={body:"# read all mattertags for the specified model\nquery GetMattertags($modelId: ID!, $includeDisabled: Boolean!) {\n  model(id: $modelId) {\n    id,\n    mattertags(includeDisabled: $includeDisabled) {\n      ...MattertagDetails\n    }\n  }\n}\n\n# add a new mattertag\nmutation AddMattertag($modelId:ID!, $mattertagId: ID, $data: MattertagDetails!) {\n  addMattertag(modelId: $modelId, mattertagId: $mattertagId, mattertag: $data) {\n    id\n    created\n    modified\n  }\n}\n\n# delete an existing tag by id\nmutation DeleteMattertag($modelId: ID!, $mattertagId: ID!) {\n  deleteMattertag(modelId: $modelId, mattertagId: $mattertagId)\n}\n\n# common Mattertag properties used by Showcase and Workshop\nfragment MattertagDetails on Mattertag {\n  id\n  label\n  description\n  color\n  enabled\n  floor { id, meshId }\n  room { id, meshId }\n  anchorPosition { x y z }\n  stemEnabled\n  stemNormal { x, y, z }\n  stemLength\n  media\n  mediaType\n  created\n  modified\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetMattertags=r(t,"GetMattertags"),e.exports.AddMattertag=r(t,"AddMattertag"),e.exports.DeleteMattertag=r(t,"DeleteMattertag"),e.exports.MattertagDetails=r(t,"MattertagDetails")},37946:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetMeasurements"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"measurementPaths"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MeasurementDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddMeasurement"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MeasurementPathDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addMeasurementPath"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"path"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchMeasurement"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pathId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MeasurementPathPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchMeasurementPath"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"pathId"},value:{kind:"Variable",name:{kind:"Name",value:"pathId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteMeasurement"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pathId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteMeasurementPath"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"pathId"},value:{kind:"Variable",name:{kind:"Name",value:"pathId"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"MeasurementDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MeasurementPath"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lineType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"points"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}],loc:{start:0,end:835}};t.loc.source={body:"\nquery GetMeasurements($modelId: ID!, $includeDisabled: Boolean!) {\n  model(id: $modelId) {\n    id,\n    measurementPaths(includeDisabled: $includeDisabled) {\n      ...MeasurementDetails\n    }\n  }\n}\n\nmutation AddMeasurement($modelId: ID!, $data: MeasurementPathDetails!) {\n  addMeasurementPath(modelId: $modelId, , path: $data) {\n    id\n  }\n}\n\nmutation PatchMeasurement($modelId: ID!, $pathId: ID!, $data: MeasurementPathPatch!) {\n  patchMeasurementPath(modelId: $modelId, , pathId: $pathId, patch: $data) {\n    id\n  }\n}\n\nmutation DeleteMeasurement($modelId: ID!, $pathId: ID!) {\n  deleteMeasurementPath(modelId: $modelId, , pathId: $pathId)\n}\n\nfragment MeasurementDetails on MeasurementPath {\n  id\n  lineType\n  label\n  enabled\n  points {\n    position { x y z }\n    floor { id meshId }\n    room { id meshId }\n  }\n  created\n  modified\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetMeasurements=r(t,"GetMeasurements"),e.exports.AddMeasurement=r(t,"AddMeasurement"),e.exports.PatchMeasurement=r(t,"PatchMeasurement"),e.exports.DeleteMeasurement=r(t,"DeleteMeasurement"),e.exports.MeasurementDetails=r(t,"MeasurementDetails")},91985:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelOptions"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"publication"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PublicationOptions"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelOptions"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelDetails"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"organization"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"visibility"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelImage"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"publication"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PublicationDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelOptions"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"meshes"},arguments:[{kind:"Argument",name:{kind:"Name",value:"formats"},value:{kind:"StringValue",value:"dam",block:!1}},{kind:"Argument",name:{kind:"Name",value:"resolutions"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"50k",block:!1},{kind:"StringValue",value:"500k",block:!1}]}},{kind:"Argument",name:{kind:"Name",value:"compressions"},value:{kind:"EnumValue",value:"none"}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MeshDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"textures"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"TextureDetails"},directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchModel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"patch"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ModelPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchModel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"patch"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"MeshDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Mesh"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"TextureDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Texture"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"quality"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"urlTemplate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"PublicationDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelPublicationDetails"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"address"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"published"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastPublished"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"presentedBy"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"summary"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"externalUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contact"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"phoneNumber"},arguments:[],directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"ModelOptions"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelOptions"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tourButtonsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dollhouseEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dollhouseLabelsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floorplanEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floorSelectEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"labelsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"highlightReelEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourFastTransitionsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"backgroundColor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"socialSharingEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourPanAngle"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourPanSpeed"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourPanDirection"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourTransitionSpeed"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourTransitionTime"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourZoomDuration"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourDollhousePanSpeed"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"unitType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"measurements"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"vrEnabled"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"PublicationOptions"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelPublicationOptions"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contactEmail"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contactName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contactPhone"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelSummary"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"presentedBy"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"address"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"externalUrl"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"ModelImage"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Photo"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"thumbnailUrl"},name:{kind:"Name",value:"resizeUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resolution"},value:{kind:"EnumValue",value:"thumbnail"}}],directives:[]},{kind:"Field",alias:{kind:"Name",value:"presentationUrl"},name:{kind:"Name",value:"resizeUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resolution"},value:{kind:"EnumValue",value:"presentation"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]}]}}],loc:{start:0,end:1888}};t.loc.source={body:'query GetModelOptions($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    publication {\n      options { ...PublicationOptions }\n    }\n    options { ...ModelOptions }\n  }\n}\n\nquery GetModelDetails($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    name\n    organization\n    visibility\n    image { ...ModelImage }\n    publication { ...PublicationDetails }\n    options { ...ModelOptions }\n    assets {\n      meshes(formats: "dam", resolutions: ["50k", "500k"], compressions: none) { ...MeshDetails }\n      textures { ...TextureDetails }\n    }\n  }\n}\n\nmutation PatchModel($modelId: ID!, $patch: ModelPatch!) {\n  patchModel(id: $modelId, , patch: $patch) {\n    id\n  }\n}\n\nfragment MeshDetails on Mesh {\n  id\n  status\n  filename\n  format\n  resolution\n  url\n  validUntil\n}\n\nfragment TextureDetails on Texture {\n  id\n  status\n  format\n  resolution\n  quality\n  urlTemplate\n  validUntil\n}\n\nfragment PublicationDetails on ModelPublicationDetails {\n  address\n  published\n  lastPublished\n  presentedBy\n  summary\n  externalUrl\n  contact {\n    name\n    email\n    phoneNumber\n  }\n}\n\nfragment ModelOptions on ModelOptions {\n  tourButtonsEnabled\n  dollhouseEnabled\n  dollhouseLabelsEnabled\n  floorplanEnabled\n  floorSelectEnabled\n  labelsEnabled\n  highlightReelEnabled\n  tourFastTransitionsEnabled\n  backgroundColor\n  socialSharingEnabled\n  tourPanAngle\n  tourPanSpeed\n  tourPanDirection\n  tourTransitionSpeed\n  tourTransitionTime\n  tourZoomDuration\n  tourDollhousePanSpeed\n  unitType\n  measurements\n  vrEnabled\n  # disable until platform 21.9.2 release\n  # urlBrandingEnabled\n}\n\nfragment PublicationOptions on ModelPublicationOptions {\n  contactEmail\n  contactName\n  contactPhone\n  modelName\n  modelSummary\n  presentedBy\n  address\n  externalUrl\n}\n\nfragment ModelImage on Photo {\n  id\n  thumbnailUrl: resizeUrl(resolution: thumbnail)\n  presentationUrl: resizeUrl(resolution: presentation)\n  width\n  height\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetModelOptions=r(t,"GetModelOptions"),e.exports.GetModelDetails=r(t,"GetModelDetails"),e.exports.PatchModel=r(t,"PatchModel"),e.exports.MeshDetails=r(t,"MeshDetails"),e.exports.TextureDetails=r(t,"TextureDetails"),e.exports.PublicationDetails=r(t,"PublicationDetails"),e.exports.ModelOptions=r(t,"ModelOptions"),e.exports.PublicationOptions=r(t,"PublicationOptions"),e.exports.ModelImage=r(t,"ModelImage")},11764:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetNotes"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ids"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"notes"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"Variable",name:{kind:"Name",value:"ids"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NoteDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"note"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddNoteComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CommentDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addNoteComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}},{kind:"Argument",name:{kind:"Name",value:"comment"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CommentDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NotePatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ReopenNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"reopenNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ResolveNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resolveNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"NoteDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Note"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdBy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"firstName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"color"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"anchorPosition"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"stemEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"stemNormal"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"stemLength"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastCommentAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"comments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"results"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CommentDetails"},directives:[]}]}}]}}]}}],loc:{start:0,end:1499}};n.loc.source={body:'#import "./attachments.gql"\n#import "./comments.gql"\n\n# read all notes for the specified model\nquery GetNotes($modelId: ID!, $ids: [ID!]) {\n  model(id: $modelId) {\n    id\n    notes(ids: $ids) {\n      ...NoteDetails\n    }\n  }\n}\n\n# Create a new note\nmutation AddNote($modelId: ID!, $data: NoteDetails!) {\n  addNote(modelId: $modelId, , note: $data) {\n    ...NoteDetails\n  }\n}\n\n# Add a comment to the note\nmutation AddNoteComment($modelId: ID!, $noteId: ID!, $data: CommentDetails!) {\n  addNoteComment(modelId: $modelId, , noteId: $noteId, comment: $data) {\n    ...CommentDetails\n  }\n}\n\n# Deletes a single note\nmutation DeleteNote ($modelId: ID!, $noteId: ID!) {\n  deleteNote(modelId: $modelId, , noteId: $noteId)\n}\n\n# Update a single note\nmutation PatchNote($modelId: ID!, $noteId: ID!, $data: NotePatch!) {\n  patchNote(modelId: $modelId, , noteId: $noteId, patch: $data) {\n    ...NoteDetails\n  }\n}\n\n# Reopen a note\nmutation ReopenNote ($modelId: ID!, $noteId: ID!) {\n  reopenNote(modelId: $modelId, , noteId: $noteId)\n}\n\n# Resolve a note\nmutation ResolveNote($modelId: ID!, $noteId: ID!) {\n  resolveNote(modelId: $modelId, , noteId: $noteId)\n}\n\n# common Note properties\nfragment NoteDetails on Note {\n  id\n  createdBy { id, firstName, lastName, email }\n  color\n  enabled\n  floor { id, meshId }\n  room { id, meshId }\n  anchorPosition { x, y, z }\n  stemEnabled\n  stemNormal { x, y, z }\n  stemLength\n  resolution\n  created\n  modified\n  lastCommentAt\n  comments {\n    results { ...CommentDetails }\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function r(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)}))}function o(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){o(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){o(e,t)})),e.definitions&&e.definitions.forEach((function(e){o(e,t)}))}n.definitions=n.definitions.concat(r(i(98443).definitions)),n.definitions=n.definitions.concat(r(i(70129).definitions));var a={};function l(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function c(e,t){var i={kind:e.kind,definitions:[l(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=a[t]||new Set,s=new Set,r=new Set;for(n.forEach((function(e){r.add(e)}));r.size>0;){var o=r;r=new Set,o.forEach((function(e){s.has(e)||(s.add(e),(a[e]||new Set).forEach((function(e){r.add(e)})))}))}return s.forEach((function(t){var n=l(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;o(e,t),a[e.name.value]=t}})),e.exports=n,e.exports.GetNotes=c(n,"GetNotes"),e.exports.AddNote=c(n,"AddNote"),e.exports.AddNoteComment=c(n,"AddNoteComment"),e.exports.DeleteNote=c(n,"DeleteNote"),e.exports.PatchNote=c(n,"PatchNote"),e.exports.ReopenNote=c(n,"ReopenNote"),e.exports.ResolveNote=c(n,"ResolveNote"),e.exports.NoteDetails=c(n,"NoteDetails")},70778:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSnapshots"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"photos"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchPhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchPhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"photoId"},value:{kind:"Variable",name:{kind:"Name",value:"photoId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeletePhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deletePhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"photoId"},value:{kind:"Variable",name:{kind:"Name",value:"photoId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadHighlightReelSnapshot"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SnapshotLocationInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"snapshot"},name:{kind:"Name",value:"uploadHighlightReelSnapshot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"snapshotLocation"},value:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadModelSnapshot"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SnapshotLocationInput"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PhotoType"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"snapshot"},name:{kind:"Name",value:"uploadModelSnapshot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"snapshotLocation"},value:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}}},{kind:"Argument",name:{kind:"Name",value:"photoType"},value:{kind:"Variable",name:{kind:"Name",value:"photoType"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"PhotoDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Photo"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"classification"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"category"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolutions"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"origin"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"thumbnailUrl"},name:{kind:"Name",value:"resizeUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resolution"},value:{kind:"EnumValue",value:"thumbnail"}}],directives:[]},{kind:"Field",alias:{kind:"Name",value:"presentationUrl"},name:{kind:"Name",value:"resizeUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resolution"},value:{kind:"EnumValue",value:"presentation"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"snapshotLocation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"viewMode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"rotation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"w"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"zoom"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floorVisibility"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sequence"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"anchor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"pano"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"placement"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:1551}};t.loc.source={body:"query GetSnapshots($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    assets {\n      photos { ...PhotoDetails }\n    }\n  }\n}\n\nmutation PatchPhoto($modelId: ID!, $photoId: ID!, $label: String!) {\n  patchPhoto(modelId: $modelId, photoId: $photoId, label: $label) {\n    ...PhotoDetails\n  }\n}\n\nmutation DeletePhoto($modelId: ID!, $photoId: ID!) {\n  deletePhoto(modelId: $modelId, photoId: $photoId)\n}\n\nmutation UploadHighlightReelSnapshot($modelId: ID!, $contents: FileUpload!, $label: String!, $snapshotLocation: SnapshotLocationInput!) {\n  snapshot: uploadHighlightReelSnapshot(id: $modelId, contents: $contents, label: $label, snapshotLocation: $snapshotLocation) {\n    ...PhotoDetails\n  }\n}\n\nmutation UploadModelSnapshot($modelId: ID!, $contents: FileUpload!, $label: String!, $snapshotLocation: SnapshotLocationInput!, $photoType: PhotoType!) {\n  snapshot: uploadModelSnapshot(id: $modelId, contents: $contents, label: $label, snapshotLocation: $snapshotLocation, photoType: $photoType) {\n    ...PhotoDetails\n  }\n}\n\nfragment PhotoDetails on Photo {\n  id\n  label\n  classification\n  category\n  height\n  width\n  created\n  modified\n  status\n  filename\n  format\n  url\n  resolutions\n  type\n  origin\n  validUntil\n  thumbnailUrl: resizeUrl(resolution: thumbnail)\n  presentationUrl: resizeUrl(resolution: presentation)\n  snapshotLocation {\n    viewMode\n    position { x y z }\n    rotation { x y z w }\n    zoom\n    floorVisibility {\n      id\n      meshId\n      sequence\n    }\n    anchor {\n      id\n      pano {\n        id\n        placement\n      }\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetSnapshots=r(t,"GetSnapshots"),e.exports.PatchPhoto=r(t,"PatchPhoto"),e.exports.DeletePhoto=r(t,"DeletePhoto"),e.exports.UploadHighlightReelSnapshot=r(t,"UploadHighlightReelSnapshot"),e.exports.UploadModelSnapshot=r(t,"UploadModelSnapshot"),e.exports.PhotoDetails=r(t,"PhotoDetails")},83531:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelPrefetch"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"meshes"},arguments:[{kind:"Argument",name:{kind:"Name",value:"formats"},value:{kind:"StringValue",value:"dam",block:!1}},{kind:"Argument",name:{kind:"Name",value:"resolutions"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"50k",block:!1},{kind:"StringValue",value:"500k",block:!1}]}},{kind:"Argument",name:{kind:"Name",value:"compressions"},value:{kind:"EnumValue",value:"none"}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MeshDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"textures"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"TextureDetails"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"floors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FloorDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelImage"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"tags"},value:{kind:"StringValue",value:"showcase",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AnchorLocationDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelOptions"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"organization"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"publication"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PublicationDetails"},directives:[]},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PublicationOptions"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"rooms"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"RoomDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"visibility"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:797}};n.loc.source={body:'#import "./floors.gql"\n#import "./model.gql"\n#import "./rooms.gql"\n#import "./photos.gql"\n#import "./sweeps.gql"\n\n# Preloaded model data to be embedded into Showcase HTML page,\n# only load data that is required for Showcase to start (ie. NO Mattertags)\nquery GetModelPrefetch($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    assets {\n      meshes(formats: "dam", resolutions: ["50k", "500k"], compressions: none) { ...MeshDetails }\n      textures { ...TextureDetails }\n    }\n    floors { ...FloorDetails }\n    image { ...ModelImage }\n    locations(tags:"showcase") { ...AnchorLocationDetails }\n    name\n    options { ...ModelOptions }\n    organization\n    publication {\n      ...PublicationDetails\n      options { ...PublicationOptions }\n    }\n    rooms { ...RoomDetails }\n    visibility\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function r(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)}))}function o(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){o(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){o(e,t)})),e.definitions&&e.definitions.forEach((function(e){o(e,t)}))}n.definitions=n.definitions.concat(r(i(81047).definitions)),n.definitions=n.definitions.concat(r(i(91985).definitions)),n.definitions=n.definitions.concat(r(i(88655).definitions)),n.definitions=n.definitions.concat(r(i(70778).definitions)),n.definitions=n.definitions.concat(r(i(15100).definitions));var a={};function l(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}n.definitions.forEach((function(e){if(e.name){var t=new Set;o(e,t),a[e.name.value]=t}})),e.exports=n,e.exports.GetModelPrefetch=function(e,t){var i={kind:e.kind,definitions:[l(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=a[t]||new Set,s=new Set,r=new Set;for(n.forEach((function(e){r.add(e)}));r.size>0;){var o=r;r=new Set,o.forEach((function(e){s.has(e)||(s.add(e),(a[e]||new Set).forEach((function(e){r.add(e)})))}))}return s.forEach((function(t){var n=l(e,t);n&&i.definitions.push(n)})),i}(n,"GetModelPrefetch")},88655:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetRooms"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"rooms"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"RoomDetails"},directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"RoomDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelRoom"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"dimensions"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"depth"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"areaFloor"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"tags"},arguments:[],directives:[]}]}}],loc:{start:0,end:266}};t.loc.source={body:"\nquery GetRooms ($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    rooms {\n      ...RoomDetails\n    }\n  }\n}\n\nfragment RoomDetails on ModelRoom {\n  id\n  meshId\n  floor {\n    id\n    meshId\n  }\n  dimensions {\n    height\n    width\n    depth\n    areaFloor\n  }\n  tags\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetRooms=r(t,"GetRooms"),e.exports.RoomDetails=r(t,"RoomDetails")},15100:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSweeps"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AnchorLocationDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetShowcaseSweeps"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"tags"},value:{kind:"StringValue",value:"showcase",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AnchorLocationDetails"},directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"SkyboxDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SkyboxPanorama"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"urlTemplate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tileResolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tileCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tileUrlTemplate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"SkyboxUrlDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PanoramicImageLocation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolutions"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"skyboxes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"SkyboxDetails"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"AnchorLocationDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AnchorLocation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"index"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"neighbors"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tags"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"pano"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sweepUuid"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"placement"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"source"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"rotation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"w"},arguments:[],directives:[]}]}},{kind:"FragmentSpread",name:{kind:"Name",value:"SkyboxUrlDetails"},directives:[]}]}}]}}],loc:{start:0,end:954}};t.loc.source={body:'\nquery GetSweeps($modelId: ID!) {\n  model(id: $modelId) {\n    id,\n    locations {\n      ...AnchorLocationDetails\n    }\n  }\n}\n\nquery GetShowcaseSweeps($modelId: ID!) {\n  model(id: $modelId) {\n    id,\n    locations(tags: "showcase") {\n      ...AnchorLocationDetails\n    }\n  }\n}\n\nfragment SkyboxDetails on SkyboxPanorama {\n  # TODO(PL-5928) all SkyboxDetail results have the same non-unique id,\n  # using it as a map key will yield unexpected results\n  # id\n  resolution\n  status\n  urlTemplate\n  tileResolution\n  tileCount\n  tileUrlTemplate\n  validUntil\n}\n\nfragment SkyboxUrlDetails on PanoramicImageLocation {\n  id\n  resolutions\n  skyboxes { ...SkyboxDetails }\n}\n\nfragment AnchorLocationDetails on AnchorLocation {\n  id\n  index\n  floor { id, meshId }\n  room { id, meshId }\n  neighbors\n  tags\n  position { x y z }\n  pano {\n    id\n    sweepUuid\n    label\n    placement\n    source\n    position { x y z }\n    rotation { x y z w }\n    ...SkyboxUrlDetails\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetSweeps=r(t,"GetSweeps"),e.exports.GetShowcaseSweeps=r(t,"GetShowcaseSweeps"),e.exports.SkyboxDetails=r(t,"SkyboxDetails"),e.exports.SkyboxUrlDetails=r(t,"SkyboxUrlDetails"),e.exports.AnchorLocationDetails=r(t,"AnchorLocationDetails")},11820:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetCurrentUserModelAccess"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"users"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"ListValue",values:[{kind:"Variable",name:{kind:"Name",value:"userId"}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"results"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelAccess"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"policies"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetUsers"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"search"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ids"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"emails"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"users"},arguments:[{kind:"Argument",name:{kind:"Name",value:"search"},value:{kind:"Variable",name:{kind:"Name",value:"search"}}},{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"Variable",name:{kind:"Name",value:"ids"}}},{kind:"Argument",name:{kind:"Name",value:"emails"},value:{kind:"Variable",name:{kind:"Name",value:"emails"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"results"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"firstName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelAccess"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:554}};t.loc.source={body:"# get access for the current user\nquery GetCurrentUserModelAccess($modelId: ID!, $userId: ID!) {\n  model(id: $modelId) {\n    users(ids: [$userId]) {\n      results {\n        modelAccess\n      }\n    }\n    policies { name }\n  }\n}\n\n# get users with access to the specified model\nquery GetUsers($modelId: ID!, $search: String, $ids: [ID!], $emails: [String!]) {\n  model(id: $modelId) {\n    users(search: $search, ids: $ids, emails: $emails) {\n      results {\n        id\n        email\n        firstName\n        lastName\n        modelAccess\n      }\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetCurrentUserModelAccess=r(t,"GetCurrentUserModelAccess"),e.exports.GetUsers=r(t,"GetUsers")},53306:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetMergeDiff"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mergeDiff"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"src"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dest"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"typesModified"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetViews"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"views"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PublishView"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mergeMutator"},arguments:[{kind:"Argument",name:{kind:"Name",value:"src"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"merge"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"RevertView"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mergeTypes"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MergeableType"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mergeMutator"},arguments:[{kind:"Argument",name:{kind:"Name",value:"src"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"revert"},arguments:[{kind:"Argument",name:{kind:"Name",value:"types"},value:{kind:"Variable",name:{kind:"Name",value:"mergeTypes"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSessionDiff"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"base"},name:{kind:"Name",value:"view"},arguments:[{kind:"Argument",name:{kind:"Name",value:"type"},value:{kind:"StringValue",value:"matterport.model.default",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"model"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"labels"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"mattertags"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MattertagDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"measurementPaths"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MeasurementDetails"},directives:[]}]}}]}}]}},{kind:"Field",alias:{kind:"Name",value:"view"},name:{kind:"Name",value:"view"},arguments:[{kind:"Argument",name:{kind:"Name",value:"type"},value:{kind:"StringValue",value:"matterport.workshop.session",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"model"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"labels"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"mattertags"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"measurementPaths"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}]}}]}}]}}]}}],loc:{start:0,end:1499}};n.loc.source={body:'#import "./labels.gql"\n#import "./mattertags.gql"\n#import "./measurements.gql"\n\n# Gets the data types that have changed between a view and the base model\nquery GetMergeDiff($viewId: ID!) {\n  model(id: $viewId) {\n    id\n    mergeDiff {\n      src\n      dest\n      typesModified\n    }\n  }\n}\n\n# Get available views for a model\nquery GetViews($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    views {\n      id\n      type\n    }\n  }\n}\n\n# Merges the given view into the base model view\nmutation PublishView($viewId: ID!) {\n  mergeMutator(src: $viewId) {\n    merge {\n      id\n    }\n  }\n}\n\n# Resets the provided view to be the same as the base model view\nmutation RevertView($viewId: ID!, $mergeTypes: [MergeableType!]) {\n  mergeMutator(src: $viewId) {\n    revert(types: $mergeTypes ) {\n      id\n    }\n  }\n}\n\n# Gets the data that has changed between the Workshop session and base model\nquery GetSessionDiff($modelId: ID!) {\n  model(id: $modelId) {\n    base: view(type: "matterport.model.default") {\n      id\n      model {\n        labels(includeDisabled: true) { ...LabelDetails }\n        mattertags(includeDisabled: true) { ...MattertagDetails }\n        measurementPaths(includeDisabled: true) { ...MeasurementDetails }\n      }\n    }\n    view: view(type: "matterport.workshop.session") {\n      id\n      model {\n        labels(includeDisabled: true) { id modified }\n        mattertags(includeDisabled: true) { id modified }\n        measurementPaths(includeDisabled: true) { id modified }\n      }\n    }\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function r(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)}))}function o(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){o(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){o(e,t)})),e.definitions&&e.definitions.forEach((function(e){o(e,t)}))}n.definitions=n.definitions.concat(r(i(95162).definitions)),n.definitions=n.definitions.concat(r(i(6850).definitions)),n.definitions=n.definitions.concat(r(i(37946).definitions));var a={};function l(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function c(e,t){var i={kind:e.kind,definitions:[l(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=a[t]||new Set,s=new Set,r=new Set;for(n.forEach((function(e){r.add(e)}));r.size>0;){var o=r;r=new Set,o.forEach((function(e){s.has(e)||(s.add(e),(a[e]||new Set).forEach((function(e){r.add(e)})))}))}return s.forEach((function(t){var n=l(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;o(e,t),a[e.name.value]=t}})),e.exports=n,e.exports.GetMergeDiff=c(n,"GetMergeDiff"),e.exports.GetViews=c(n,"GetViews"),e.exports.PublishView=c(n,"PublishView"),e.exports.RevertView=c(n,"RevertView"),e.exports.GetSessionDiff=c(n,"GetSessionDiff")}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var i=r[e]={id:e,loaded:!1,exports:{}};return s[e].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}o.m=s,o.amdO={},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(i,n){if(1&n&&(i=this(i)),8&n)return i;if("object"==typeof i&&i){if(4&n&&i.__esModule)return i;if(16&n&&"function"==typeof i.then)return i}var s=Object.create(null);o.r(s);var r={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&i;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>r[e]=()=>i[e]));return r.default=()=>i,o.d(s,r),s},o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,i)=>(o.f[i](e,t),t)),[])),o.u=e=>"js/"+e+".js",o.miniCssF=e=>"css/"+({66:"control-kit",136:"late",143:"font",316:"menus",321:"core",376:"vr",458:"showcase",464:"search",525:"sdk-bundle",718:"encoders",833:"split",838:"externalSdkLoader",932:"lib-lottie"}[e]||e)+".css",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i={},n="mp_webgl:",o.l=(e,t,s,r)=>{if(i[e])i[e].push(t);else{var a,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var d=c[h];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==n+s){a=d;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",n+s),a.src=e),i[e]=[t];var u=(t,n)=>{a.onerror=a.onload=null,clearTimeout(p);var s=i[e];if(delete i[e],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((e=>e(n))),t)return t(n)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),l&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.p="",(()=>{var e={458:0};o.f.j=(t,i)=>{var n=o.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var s=new Promise(((i,s)=>n=e[t]=[i,s]));i.push(n[2]=s);var r=o.p+o.u(t),a=new Error;o.l(r,(i=>{if(o.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var s=i&&("load"===i.type?"missing":i.type),r=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+r+")",a.name="ChunkLoadError",a.type=s,a.request=r,n[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{var n,s,[r,a,l]=i,c=0;for(n in a)o.o(a,n)&&(o.m[n]=a[n]);if(l)l(o);for(t&&t(i);c<r.length;c++)s=r[c],o.o(e,s)&&e[s]&&e[s][0](),e[r[c]]=0},i=self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e=o(90933);class EngineContext{constructor(e){this.fetchedModules=[],this.engine=e,this.messageBus=e.msgBus,this.market=new MarketContext(e.market),this.commandBinder=e.commandBinder,this.getModuleSync=e.getModuleSync.bind(e),this.addComponent=e.addComponent.bind(e),this.getComponentByType=e.getComponentByType.bind(e),this.getComponents=e.getComponents.bind(e),this.removeComponent=e.removeComponent.bind(e),this.subscribe=e.subscribe.bind(e),this.unsubscribe=e.unsubscribe.bind(e),this.broadcast=e.broadcast.bind(e),this.claimRenderLayer=e.claimRenderLayer.bind(e),this.getRenderLayer=e.getRenderLayer.bind(e),this.disposeRenderLayer=e.disposeRenderLayer.bind(e),this.startGenerator=e.startGenerator.bind(e),this.stopGenerator=e.stopGenerator.bind(e),this.after=e.after.bind(e),this.deactivate=e.deactivate.bind(e),this.toggleRendering=e.toggleRendering.bind(e),this.getXrFrame=e.getXrFrame.bind(e)}getModule(e){const t=Date.now();return this.engine.getModule(e).then((e=>{const i=Date.now();return this.fetchedModules.push({moduleName:e.name,isModule:!0,startAwait:t,finishAwait:i}),e}))}getModuleBySymbol(e){const t=Date.now();return this.engine.getModuleBySymbol(e).then((e=>{const i=Date.now();return this.fetchedModules.push({moduleName:e.name,isModule:!0,startAwait:t,finishAwait:i}),e}))}getLoadedDependencies(){return[...this.fetchedModules,...this.market.getLoadedDependencies()]}get msgBus(){return this.messageBus}}class MarketContext{constructor(e){this.fetchedData=[],this.market=e,this.register=e.register.bind(e),this.unregister=e.unregister.bind(e),this.tryGetData=e.tryGetData.bind(e),this.getModuleNameFromData=e.getModuleNameFromData.bind(e)}waitForData(t){const i=Date.now();return this.market.waitForData(t).then((t=>{const n=Date.now();return this.fetchedData.push({moduleName:this.getModuleNameFromData((0,e.oL)(t)),isModule:!1,startAwait:i,finishAwait:n}),t}))}getLoadedDependencies(){return this.fetchedData}}var t=o(64185),i=o(88512);const n=new i.Z("module-loader");var s;!function(e){e[e.Registered=0]="Registered",e[e.Loading=1]="Loading",e[e.Initialized=2]="Initialized",e[e.Unloaded=3]="Unloaded"}(s||(s={}));class ModuleLoader{constructor(){this.registeredModules={},this.typeLookup=new e.cj}registerModule(e,i){const n=this.typeLookup.addType(e),r={es6ModulePromise:i,ctorPromise:new t.Q,initPromise:new t.Q,state:s.Registered};this.registeredModules[n]=r}getTypeID(e){const t=this.typeLookup.getKeyByType(e);if(!t)throw Error("Trying to access unregistered Module");return t}getTypeFromTypeID(e){return this.typeLookup.getTypeByKey(e)}moduleRegistered(e){return!!this.typeLookup.getKeyByType(e)}moduleLoaded(e){if(!this.moduleRegistered(e))return!1;const t=this.typeLookup.getKeyByType(e),i=this.registeredModules[t].state;return![s.Registered,s.Unloaded].includes(i)}getModule(t){const i=this.typeLookup.getKeyByType(t);if(!i)throw Error(`Trying to get ${(0,e.HS)(t)} before it was registered!`);if(this.registeredModules[i].state===s.Unloaded)throw Error(`${(0,e.HS)(t)} module unloaded`);return this.registeredModules[i].initPromise.nativePromise()}getModuleSync(t){const i=this.typeLookup.getKeyByType(t);if(!i)throw new Error(`Trying to get ${(0,e.HS)(t)} before it was registered!`);const n=this.registeredModules[i];if(n.state!==s.Initialized||void 0===n.module)throw Error(`${(0,e.HS)(t)} module not loaded!`);return n.module}loadModule(t,i,r={}){const o=this.typeLookup.getKeyByType(i);if(!o)throw Error(`Attempting to load an unregistered module ${(0,e.HS)(i)}`);const a=this.registeredModules[o];if(a.state===s.Initialized)return a;if(a.state!==s.Registered&&a.state!==s.Unloaded)throw Error(`${(0,e.HS)(i)} already loading`);a.state=s.Loading;const l=(0,e.HS)(i);return a.es6ModulePromise(l).then((o=>{if(!o.default)throw new Error(`${(0,e.HS)(i)} has no default export during module loading`);const l=new o.default;a.ctorPromise.resolve(l).then((()=>{const e=Date.now();let i=!1;setTimeout((()=>{i||n.debug(`${l.name} init took over 2 seconds`)}),2e3),l.init(r,t).then((()=>{n.debug(`${l.name} init took ${(Date.now()-e)/1e3} secs.`),i=!0,a.state=s.Initialized,a.module=l,a.initPromise.resolve(l)})).catch((e=>{a.initPromise.reject(e)}))}))})).catch((t=>{n.error(`Failed to load es6Module for ${(0,e.HS)(i)}: ${t}`),a.initPromise.reject(t)})),a}whenQueueEmpties(){const e=[];for(const t in this.registeredModules){const i=this.registeredModules[t];i.state===s.Loading&&e.push(i.initPromise)}return t.Q.all(e).nativePromise()}unloadModule(e){const i=this.typeLookup.getKeyByType(e);if(!i)throw Error("Attempting to unload unregistered module");const n=this.registeredModules[i];if(n.state===s.Unloaded||n.state===s.Registered)throw Error("Attempting to unload not-loaded module");n.state=s.Unloaded,n.ctorPromise=new t.Q,n.initPromise=new t.Q,n.module=void 0}}const r="Data not present.",a=new i.Z("market");class Market{constructor(){this.typeLookup=new e.cj,this.store={},this.moduleRegistry={},this.firstUpdatePromises={}}register(e,t,i){const n=this.typeLookup.getKeyByType(t,!0);if(this.moduleRegistry[n])throw Error("Data can only be registered to one Module");this.moduleRegistry[n]=e,this.store[n]=i,i.commit(),this.firstUpdatePromises[n]&&(this.firstUpdatePromises[n].resolve(this.store[n]),delete this.firstUpdatePromises[n])}unregister(e,t){const i=this.typeLookup.getKeyByType(t,!0);if(!this.moduleRegistry[i])throw Error("No Data was registered to the Module");delete this.moduleRegistry[i],delete this.store[i]}getData(e){const t=this.typeLookup.getKeyByType(e);if(t in this.store)return this.store[t];throw Error(r)}waitForData(e){const n=this.typeLookup.getKeyByType(e,!0);return n in this.store?Promise.resolve(this.store[n]):(this.firstUpdatePromises[n]||(this.firstUpdatePromises[n]=new t.Q,setTimeout((()=>{i.Z.level>=3&&!(n in this.store)&&a.debug(`still waiting for ${e.name}-data after 5 seconds`)}),5e3)),this.firstUpdatePromises[n].nativePromise())}tryGetData(e){try{return this.getData(e)}catch(e){if(e.message!==r)throw a.error("tryGetData",e.message),e}return null}debugData(){const e={};for(const t in this.moduleRegistry){const i=this.moduleRegistry[t];i&&(e[i.name]||(e[i.name]=[]),e[i.name].push(this.store[t]))}return Object.freeze(e)}getModuleNameFromData(e){const t=this.typeLookup.getKeyByType(e);if(t){const e=this.moduleRegistry[t];if(e)return e.name}throw Error(r)}}var l=o(63432);const c=new i.Z("command-binder");class CommandBinder{constructor(){this.typeLookup=new e.cj,this.bindings={},this.queuedCommands={},this.hookedCommands={},this.resetHooks=()=>{this.hookedCommands={}},this.issueCommand=this.issueCommand.bind(this),this.issueCommandWhenBound=this.issueCommandWhenBound.bind(this)}addBinding(e,t){const i=this.typeLookup.getKeyByType(e,!0);if(this.bindings[i])throw Error(`Command ${i} already bound to a callback`);this.bindings[i]=t,this.callQueuedCommands(i);return{renew:()=>{this.bindings[i]!==t&&this.addBinding(e,t)},cancel:()=>this.removeBinding(e,t),active:this.bindings[i]===t}}removeBinding(e,t){const i=this.typeLookup.getKeyByType(e);if(!i)return void c.debug("Trying to unbind unbound command");this.bindings[i]===t?delete this.bindings[i]:c.debug("Trying to unbind unbound callback")}issueCommand(e,t=!0){const i=this.typeLookup.getKeyByInstance(e),n=this.bindings[i];return n?this.issueCommandHelper(e,i,n,t):Promise.reject("Command not bound: "+e.id)}issueCommandHelper(e,t,i,n=!0){return this.hookedCommands[t]&&!this.hookedCommands[t].resolving?this.issueHookCommand(e,t):i(e.payload)}issueCommandWhenBound(e){const i=new t.Q;return this.issueCommand(e).then((e=>i.resolve(e))).catch((t=>{const n=this.typeLookup.getKeyByInstance(e,!0);this.queuedCommands[n]||(this.queuedCommands[n]=[]),this.queuedCommands[n].push({command:e,deferred:i})})),i.nativePromise()}callQueuedCommands(e){const t=[];this.queuedCommands[e]&&(this.queuedCommands[e].forEach((e=>{t.push(this.issueCommand(e.command).then((t=>e.deferred.resolve(t))))})),Promise.all(t).then((()=>{delete this.queuedCommands[e]})))}hookCommand(e,t,i){const n=this.typeLookup.getKeyByType(e,!0);if(this.hookedCommands[n]){if(t&&null!==this.hookedCommands[n].preCommandCallback)throw Error(`Command ${e.name} has already been pre hooked`);if(!t&&null!==this.hookedCommands[n].postCommandCallback)throw Error(`Command ${e.name} has already been post hooked`)}else this.hookedCommands[n]={preCommandCallback:null,postCommandCallback:null,resolving:!1};t?this.hookedCommands[n].preCommandCallback=i:this.hookedCommands[n].postCommandCallback=i}async issueHookCommand(e,t){const i=this.hookedCommands[t],n=this.bindings[t],s=e.payload,r=i.preCommandCallback,o=i.postCommandCallback;try{r&&await r(s),i.resolving=!0;const a=await this.issueCommandHelper(e,t,n,!0);return i.resolving=!1,o&&await o(s),a}catch(e){throw Error(`Could not completely issueHookCommand - ${e}`)}}}var h=o(84303),d=o(76701),u=o(84561),p=o(21479);class Profiler{constructor(){this.phaseTimes=[],this.modules={},this.addAppPhase(p.nh.UNINITIALIZED),window.profilingData={phaseTimes:this.phaseTimes,modules:this.modules}}addAppPhase(e){this.phaseTimes[e]=Date.now()}addModuleLoadTime(e,t,i,n){const s=n.map((e=>e.moduleName)).join(","),r=n.reduce(((e,t)=>e+t.finishAwait-t.startAwait),0)/(i-t)*100;this.modules[e]=[e,e,null,t,i,null,r,s]}}var m=o(8150),g=o(736);const f=new i.Z("engine");let v=h.A.End;class Engine{constructor(e=!1){this.moduleLookup={},this.componentLookup={},this.deactivatedHack=!1,this.currentApplication=null,this.moduleProfiler=new Profiler,this.commandBinder=new CommandBinder,this.market=new Market,this.messageBus=new l.Y,this.engineGenerators=new d.ZP,this.layers=new u.o,this.moduleLoader=new ModuleLoader,this.symbolLoader=new g.m,this.afterPhasePromises=[],this.afterPhaseListenerCount=[],this.resetPromises(),this.subscribe(m.LZ,(e=>this.moduleProfiler.addAppPhase(e.phase)))}async loadApplication(e,t,i){if(e===this.currentApplication)throw Error("Application already loaded");const n=(this.currentApplication?this.currentApplication.getManifest():[]).map((e=>e.type)),s=e.getManifest(),r=s.map((e=>e.type)),o=this.currentApplication;this.currentApplication=null;const a=n.filter((e=>-1===r.indexOf(e))),l=a.filter((e=>"symbol"!=typeof e)),c=a.filter((e=>"symbol"==typeof e)),h=[...l.map((e=>this.unloadModule(e))),...c.map((e=>this.unloadModuleBySymbol(e)))];o&&h.push(o.unload(this));const d=s.filter((e=>-1===n.indexOf(e.type)));for(const e of d)"symbol"==typeof e.type?this.symbolLoader.moduleRegistered(e.type)||this.registerModule(e):this.moduleLoader.moduleRegistered(e.type)||this.registerModule(e);if(h.length)try{await Promise.all(h)}catch(e){f.error(e),t&&t(e)}try{this.currentApplication=e,await e.load(this,{coldStart:null===o,autoPlay:i})}catch(e){f.error(e),t&&t(e)}}registerModule(e){if(this.currentApplication)throw Error("Cannot register modules while application is running");"symbol"==typeof e.type?this.symbolLoader.registerModule(e.type,e.promise):this.moduleLoader.registerModule(e.type,e.promise)}loadModule(e){const t=e;this.moduleLoadInjectionHook&&(t.config=this.moduleLoadInjectionHook(t.type,t.config||{}));const i=new EngineContext(this),n=Date.now(),s=this.moduleLoader.loadModule(i,t.type,t.config);return s.ctorPromise.then((e=>this.moduleLookup[this.moduleLoader.getTypeID(t.type)]={module:e,initialized:!1})),s.initPromise.then((e=>{this.moduleProfiler.addModuleLoadTime(e.name,n,Date.now(),i.getLoadedDependencies()),this.moduleLookup[this.moduleLoader.getTypeID(t.type)].initialized=!0})),s.initPromise.nativePromise()}loadModuleBySymbol(e){const t=e,i=String(t.type);this.moduleLoadInjectionHook&&(t.config=this.moduleLoadInjectionHook(i,t.config||{}));const n=new EngineContext(this),s=Date.now(),r=this.symbolLoader.loadModule(n,t.type,t.config);return r.ctorPromise.then((e=>this.moduleLookup[i]={symbol:t.type,module:e,initialized:!1})),r.initPromise.then((e=>{this.moduleProfiler.addModuleLoadTime(e.name,s,Date.now(),n.getLoadedDependencies()),this.moduleLookup[i].initialized=!0})),r.initPromise.nativePromise()}setLoadInjection(e){if(void 0!==this.moduleLoadInjectionHook)throw Error("Hook already registered");this.moduleLoadInjectionHook=e}async unloadModule(t){if(!this.moduleLoader.moduleLoaded(t))return void f.debug(`${(0,e.HS)(t)} module already unloaded`);f.debug(`Unloading ${(0,e.HS)(t)} module`);const i=await this.getModule(t),n=this.getModuleIndex(i);this.componentLookup[n]&&(await Promise.all(this.componentLookup[n].map((async e=>{await this.removeComponent(i,e.component),e.component.dispose()}))),this.componentLookup[n]=[]),this.moduleLoader.unloadModule(t),i.dispose(this)}async unloadModuleBySymbol(e){if(!this.symbolLoader.moduleLoaded(e))return void f.debug(`${String(e)} module already unloaded`);f.debug(`Unloading ${String(e)} module`);const t=await this.getModuleBySymbol(e),i=this.getModuleIndex(t);this.componentLookup[i]&&(await Promise.all(this.componentLookup[i].map((async e=>{await this.removeComponent(t,e.component),e.component.dispose()}))),this.componentLookup[i]=[]),this.symbolLoader.unloadModule(e),t.dispose(this)}async waitForLoadingModules(){await Promise.all([this.moduleLoader.whenQueueEmpties(),this.symbolLoader.whenQueueEmpties()])}async getModule(e){return this.moduleLoader.getModule(e)}getModuleBySymbol(e){return this.symbolLoader.getModule(e)}getModuleSync(e){return this.moduleLoader.getModuleSync(e)}getComponentByType(e){for(const t in this.moduleLookup){const i=this.moduleLookup[t].module,n=this.getModuleIndex(i),s=this.componentLookup[n]||[];for(const t of s)if(t.component instanceof e)return t.component}return null}async addComponent(e,t){const i=this.getModuleIndex(e);let n=this.componentLookup[i];n||(this.componentLookup[i]=n=[]);let s=-1;for(let e=0;e<n.length;e++)if(n[e].component===t){s=e;break}if(-1===s&&(s=n.push({component:t,active:!1})-1,t.init()),n[s].active)throw Error("Tried to add already active component: "+typeof t);await t.activate(this),n[s].active=!0}async removeComponent(e,t){const i=this.getModuleIndex(e),n=this.componentLookup[i];if(n){let e=null;for(const i of n)if(i.component===t){e=i;break}e&&e.active&&(await t.deactivate(this),e.active=!1)}}tick(){if(this.deactivatedHack)return;if(v!==h.A.End)throw Error("Engine.tick called outside of waiting. Did the engine get called recursively?!");v=h.A.Begin,this.resolveAfterPhase(h.A.Begin);const e=performance.now(),t=this.lastTick?e-this.lastTick:16;this.lastTick=e,v=h.A.Logic;try{for(const e in this.moduleLookup){const i=this.moduleLookup[e];i&&i.initialized&&i.module.onUpdate(t)}}catch(e){throw f.error(e),e}this.resolveAfterPhase(h.A.Logic),this.engineGenerators.processGenerators(d.p3.Phase,h.A.Logic);try{this.renderComponents(t)}catch(e){throw f.error(e),e}try{v=h.A.Render,this.resolveAfterPhase(h.A.Render),this.engineGenerators.processGenerators(d.p3.Phase,h.A.Render),v=h.A.End,this.resolveAfterPhase(h.A.End),this.engineGenerators.processGenerators(d.p3.None),this.engineGenerators.processGenerators(d.p3.Promise),this.engineGenerators.processGenerators(d.p3.Duration)}catch(e){throw f.error(e),e}}subscribe(e,t,i=l.Q.PERMANENT){return this.messageBus.subscribe(e,t,i)}unsubscribe(e,t){this.messageBus.unsubscribe(e,t)}broadcast(e){this.messageBus.broadcast(e)}claimRenderLayer(e){return this.layers.claimLayer(e)}getRenderLayer(e){return this.layers.getLayer(e)}disposeRenderLayer(e){this.layers.disposeLayer(e)}startGenerator(e){this.engineGenerators.startGenerator(e)}stopGenerator(e){this.engineGenerators.stopGenerator(e)}after(e){return this.afterPhaseListenerCount[e]++,this.afterPhasePromises[e].nativePromise()}getModuleIndex(e){for(const t in this.moduleLookup)if(this.moduleLookup[t]&&this.moduleLookup[t].module===e)return t;return""}*getComponents(){for(const e in this.moduleLookup){const t=this.componentLookup[e];if(t)for(const e of t)yield e}}toggleRendering(e,t){const i=this.getModuleIndex(e),n=this.componentLookup[i];if(n)for(const e of n)e.active=t}renderComponents(e){for(const t in this.moduleLookup){const i=this.componentLookup[t];if(i)for(const t of i)t.active&&t.component.beforeRender&&t.component.beforeRender(e)}for(const t in this.moduleLookup){if(!t)continue;const i=this.componentLookup[t];if(i)for(const t of i)t.active&&t.component.render(e)}}resetPromises(){this.resetAfterPhasePromises()}resetAfterPhasePromises(){this.resetAfterPhasePromise(h.A.Logic),this.resetAfterPhasePromise(h.A.Render),this.resetAfterPhasePromise(h.A.Begin),this.resetAfterPhasePromise(h.A.End)}resetAfterPhasePromise(e){this.afterPhasePromises[e]=new t.Q,this.afterPhaseListenerCount[e]=0}resolveAfterPhase(e){this.afterPhaseListenerCount[e]>0&&(this.afterPhasePromises[e].resolve(),this.resetAfterPhasePromise(e))}deactivate(){for(const e in this.moduleLookup){const t=this.moduleLookup[e];if(t&&t.initialized)if(t.symbol)this.unloadModuleBySymbol(t.symbol);else{const e=this.getModuleType(t.module);e&&this.unloadModule(e)}}this.deactivatedHack=!0}setXrFrame(e){this.xrFrame=e}getXrFrame(){return this.xrFrame}getModuleType(e){for(const t in this.moduleLookup){const i=this.moduleLookup[t];if(i&&i.module===e)return this.moduleLoader.getTypeFromTypeID(t)}return null}get msgBus(){return this.messageBus}}var y=o(36822),b=o(41596),S=o(60771),E=o(44218),w=o(8445),T=o(54791),_=o(18469),M=o(56365),x=o(46072),A=o(20664),O=o(4305),P=o(29539),D=o(66542),C=o(28883),I=o(77719),L=o(56656),R=o(23889),N=o(20021),k=o(2640),B=o(81220),F=o(15030),U=o(55402),V=o(31778),H=o(55305),G=o(24930),z=o(69941),W=o(37238),j=o(93263),K=o(17399),q=o(66225),Z=o(84285),Y=o(54177),$=o(94625),Q=o(63781),X=o(68113),J=o(17206),ee=o(62881),te=o(55130),ie=o(25706),ne=o(86122),se=o(87738),re=o(92895),oe=o(32470),ae=o(50294),le=o(26589),ce=o(13988),he=o(24033),de=o(13827),ue=o(31657);const pe=o(5029).default;var me=o(39300),ge=o(41452),fe=o(65006),ve=o(67394),ye=o(94329),be=o(27088),Se=o(70384),Ee=o(94015),we=o(19917),Te=o(86097),_e=o(55034),Me=o(16400),xe=o(51561),Ae=o(32086),Oe=o(32306),Pe=o(11426),De=o(63739),Ce=o(35597),Ie=o(7562),Le=o(70273),Re=o(28926),Ne=o(36210),ke=o(41591),Be=o(76541),Fe=o(14880),Ue=o(79355),Ve=o(35300);const He=new i.Z("AB");class AB{constructor(e){this.values={};for(const t in e){const i=e[t];if(i&&i.ab)try{this.values[t]=Ge(i.ab)}catch(e){He.warn(`Skipping key ${t}, could not pick: ${e}`)}}}get(e){return this.values[e]}serialize(){return Object.keys(this.values).map((e=>`${e}:${this.values[e]}`))}}function Ge(e){if(0===e.length)throw Error("A/B cannot choose from an empty choice array");let t=0;for(const i of e){if(void 0===i.value||void 0===i.weight||i.weight<0)throw Error(`Malformed AB choice: ${i}`);t+=i.weight}const i=Math.random()*t;let n=0;for(const t of e)if(n+=t.weight,i<=n)return t.value}var ze=o(2388),We=o(44060),je=o(23502),Ke=o(39504),qe=o(87182),Ze=o(30060),Ye=o(28963),$e=o(66999),Qe=o(77037),Xe=o(73844),Je=o(69808),et=o(20601),tt=o(80301),it=o(40324),nt=o(17838),st=o(34369);const rt=new i.Z("showcase-settings/quality");var ot=o(24844),at=o(37381),lt=o(96216),ct=o(29422),ht=o(10757),dt=o(23847),ut=o(68655),pt=o(89683),mt=o(95469);class EngineTick{constructor(e,t,i){this.engine=e,this.onErrorCallback=i,this.ticking=!1,this.start=()=>{this.ticking=!0},this.stop=()=>{this.ticking=!1},this.tick=(e,t)=>{if(this.ticking)try{this.engine.setXrFrame(t),this.engine.tick()}catch(e){this.stop(),this.onErrorCallback(e)}},t.setAnimationLoop(this.tick)}}var gt=o(26587),ft=o(38420),vt=o(50988),yt=o(44283);class ControllerProxy{constructor(e,t){this.proxy=e,this.target=t}beginExternalTransition(){this.proxy.activeSession(this)&&this.target.beginExternalTransition()}endExternalTransition(){this.proxy.activeSession(this)&&this.target.endExternalTransition()}updateCameraPosition(e){this.proxy.activeSession(this)&&this.target.updateCameraPosition(e)}updateCameraRotation(e){this.proxy.activeSession(this)&&this.target.updateCameraRotation(e)}updateCameraFocus(e){this.proxy.activeSession(this)&&this.target.updateCameraFocus(e)}moveTo(e){return this.proxy.activeSession(this)?this.target.moveTo(e):t.Q.resolve()}}class CameraPoseProxy{constructor(e,t){this.controller=e,this.data=t,this.proxies=[]}get pose(){return this.data}activeSession(e){if(0===this.proxies.length)return!1;return this.proxies[this.proxies.length-1].controller===e}newSession(e){let t=null;if(-1!==this.proxies.findIndex((t=>t.requester===e)))throw new Error("Cannot create two sessions with the same requester");return(0,yt.k1)((()=>{if(!t){if(this.proxies.length>0){const e=this.proxies[this.proxies.length-1];e.requester.onAccessRevoked(e.controller)}t=new ControllerProxy(this,this.controller),this.proxies.push({controller:t,requester:e}),e.onAccessGranted(t)}}),(()=>{if(t){const e=this.proxies.findIndex((e=>e.controller===t));if(-1!==e){const t=this.proxies[e],i=e===this.proxies.length-1;if(i&&t.requester.onAccessRevoked(t.controller),this.proxies.splice(e,1),this.proxies.length>0&&i){const e=this.proxies[this.proxies.length-1];e.requester.onAccessGranted(e.controller)}}}}))}}var bt=o(59088);var St=o(81063),Et=o(80693),wt=o(35934),Tt=o(73710),_t=o(51058),Mt=o(87220);const xt=new i.Z("showcase"),At=window.MP_PREFETCHED_MODELDATA;class Showcase{constructor(e,i={},n=!1){this.inWorkshop=e,this.settingOverrides=i,this.editModePreferred=n,this.externalCanvas=!1,this.urlValues=S.AO(),this.storeQueue=new C.RequestQueue,this.apiQueue=new C.RequestQueue,this.analyticsQueue=new C.RequestQueue({concurrency:1}),this.errorPromise=new t.Q,this.quickstart="1"===this.urlValues.qs||void 0!==this.urlValues.note,this.autoplay=!1,this.forceLogin=!1,this.openingNote=!1,this.needsFramebustToPlayXR=!0,this.uiLoading=Promise.resolve(),this.stopTourHook=async e=>{const t=e.market.tryGetData(z.k3);t&&t.tourPlaying&&(await e.commandBinder.issueCommand(new lt.vy),await(0,ht.gw)(10))};const{container:s}=this.settingOverrides;(0,wt.C)(this.urlValues.applicationKey||null),this.apiHost=((e,t)=>{const i=e.apiHost||t.apiHost;if(i){const e=(0,fe.KK)(i);if(e)return e}return window.location.origin})(this.urlValues,this.settingOverrides),i.canvas&&(this.externalCanvas=!0,this.canvas=i.canvas),this.apiHost!==window.location.origin&&(this.settingOverrides.apiHost=this.apiHost),this.container=s||document.body,this.modelUrls=(0,fe.sU)(this.urlValues.m||this.urlValues.model,this.apiHost),this.modelUrl=`${this.modelUrls.urlBase}/api/v1/player/models/${this.modelUrls.sid}`,this.modelId=this.modelUrls.sid}getManifest(){const e=[{type:y.default,promise:()=>Promise.resolve().then(o.bind(o,36822))},{type:G.default,promise:()=>Promise.resolve().then(o.bind(o,24930))},{type:dt.default,promise:()=>Promise.resolve().then(o.bind(o,23847))},{type:g.y.SDK,promise:()=>Promise.resolve().then(o.bind(o,60003))},{type:B.default,promise:()=>Promise.resolve().then(o.bind(o,81220))},{type:k.default,promise:()=>Promise.resolve().then(o.bind(o,2640))},{type:be.default,promise:()=>Promise.resolve().then(o.bind(o,27088))},{type:D.default,promise:()=>Promise.resolve().then(o.bind(o,66542))},{type:E.default,promise:()=>Promise.resolve().then(o.bind(o,44218))},{type:K.default,promise:()=>Promise.resolve().then(o.bind(o,17399))},{type:M.default,promise:()=>Promise.resolve().then(o.bind(o,56365))},{type:x.default,promise:()=>Promise.resolve().then(o.bind(o,46072))},{type:ge.default,promise:()=>Promise.resolve().then(o.bind(o,41452))},{type:L.default,promise:()=>Promise.resolve().then(o.bind(o,56656))},{type:g.y.SHOWCASE_ANALYTICS,promise:()=>Promise.resolve().then(o.bind(o,45386))},{type:g.y.WEBGL_RENDERER,promise:()=>Promise.resolve().then(o.bind(o,42090))},{type:b.default,promise:()=>Promise.resolve().then(o.bind(o,41596))},this.externalCanvas?{type:g.y.CANVAS,promise:()=>Promise.resolve().then(o.bind(o,37554))}:{type:g.y.CANVAS,promise:()=>Promise.resolve().then(o.bind(o,86718))},{type:g.y.INPUT,promise:()=>Promise.resolve().then(o.bind(o,48221))},{type:Ee.default,promise:()=>Promise.resolve().then(o.bind(o,94015))},{type:I.default,promise:()=>Promise.resolve().then(o.bind(o,77719))},{type:mt.default,promise:()=>Promise.resolve().then(o.bind(o,95469))},{type:gt.F,promise:()=>Promise.resolve().then(o.bind(o,37339))},{type:de.default,promise:()=>Promise.resolve().then(o.bind(o,13827))},{type:T.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,54791))},{type:R.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,23889))},{type:W.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,37238))},{type:g.y.MODEL_MESH,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,75872))},{type:j.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,93263))},{type:Pe.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,11426))},{type:q.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,66225))},{type:Oe.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,32306))},{type:he.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,24033))},{type:Ie.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,7562))},{type:pe,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,5029))},{type:ce.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,13988))},{type:ee.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,62881))},{type:Ue.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,79355))},{type:Z.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,84285))},{type:Y.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,54177))},{type:$.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,94625))},{type:te.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,55130))},{type:ie.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,25706))},{type:ue.default,promise:()=>Promise.resolve().then(o.bind(o,31657))},{type:Ae.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,32086))},{type:U.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,55402))},{type:V.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,31778))},{type:P.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,29539))},{type:Fe.default,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,14880))},{type:g.y.MESH_QUERY,promise:()=>Promise.all([o.e(614),o.e(321)]).then(o.bind(o,26203))},{type:J.default,promise:()=>o.e(136).then(o.bind(o,17206))},{type:Q.default,promise:()=>o.e(136).then(o.bind(o,63781))},{type:X.default,promise:()=>o.e(136).then(o.bind(o,68113))},{type:ve.default,promise:()=>o.e(136).then(o.bind(o,67394))},{type:oe.default,promise:()=>o.e(136).then(o.bind(o,32470))},{type:ae.default,promise:()=>o.e(136).then(o.bind(o,50294))},{type:ne.default,promise:()=>o.e(136).then(o.bind(o,86122))},{type:me.default,promise:()=>o.e(136).then(o.bind(o,39300))},{type:ke.default,promise:()=>o.e(136).then(o.bind(o,41591))},{type:se.default,promise:()=>o.e(136).then(o.bind(o,87738))},{type:re.default,promise:()=>o.e(136).then(o.bind(o,92895))},{type:N.default,promise:()=>o.e(136).then(o.bind(o,20021))},{type:Se.default,promise:()=>o.e(136).then(o.bind(o,70384))},{type:we.default,promise:()=>o.e(136).then(o.bind(o,19917))},{type:A.default,promise:()=>o.e(136).then(o.bind(o,20664))},{type:De.default,promise:()=>o.e(136).then(o.bind(o,63739))},{type:le.default,promise:()=>o.e(136).then(o.bind(o,26589))},{type:ot.default,promise:()=>o.e(136).then(o.bind(o,24844))},{type:Be.default,promise:()=>o.e(136).then(o.bind(o,76541))},{type:O.default,promise:()=>o.e(136).then(o.bind(o,4305))},{type:Re.default,promise:()=>o.e(136).then(o.bind(o,28926))},{type:Le.default,promise:()=>o.e(136).then(o.bind(o,70273))},{type:Ne.default,promise:()=>o.e(136).then(o.bind(o,36210))},{type:Te.default,promise:()=>o.e(136).then(o.bind(o,86097))},{type:_e.default,promise:()=>o.e(136).then(o.bind(o,55034))},{type:Me.default,promise:()=>o.e(136).then(o.bind(o,16400))},{type:xe.default,promise:()=>o.e(136).then(o.bind(o,51561))},{type:g.y.MODEL_RATING,promise:()=>o.e(136).then(o.bind(o,76265))},{type:g.y.SEARCH,promise:()=>o.e(464).then(o.bind(o,22569))},{type:g.y.DWELL_ANALYTICS,promise:()=>Promise.all([o.e(79),o.e(833)]).then(o.bind(o,18574))},{type:g.y.SCAN_INFO,promise:()=>Promise.all([o.e(79),o.e(833)]).then(o.bind(o,96811))},{type:g.y.MEASUREMENT_MODE,promise:()=>Promise.all([o.e(79),o.e(833)]).then(o.bind(o,19100))},{type:g.y.TOUR_CONTROLS,promise:()=>Promise.all([o.e(79),o.e(833)]).then(o.bind(o,27166))},{type:g.y.TOUR_DATA,promise:()=>Promise.all([o.e(79),o.e(833)]).then(o.bind(o,81627))},{type:g.y.VIDEO_RECORDER,promise:()=>Promise.all([o.e(79),o.e(833)]).then(o.bind(o,15903))},{type:g.y.WEBVR,promise:()=>Promise.all([o.e(79),o.e(833)]).then(o.bind(o,58129))},{type:g.y.WEBXR,promise:()=>Promise.all([o.e(79),o.e(833)]).then(o.bind(o,75708))},{type:g.y.TRASH,promise:()=>Promise.all([o.e(79),o.e(833)]).then(o.bind(o,86102))},{type:g.y.SCENE,promise:()=>Promise.all([o.e(764),o.e(356),o.e(750),o.e(524),o.e(250)]).then(o.bind(o,18046))}];return"0"!==this.urlValues.tiles?e.push({type:g.y.SWEEP_PANO,promise:()=>Promise.all([o.e(79),o.e(833)]).then(o.bind(o,52061))}):e.push({type:g.y.SWEEP_PANO,promise:()=>Promise.all([o.e(79),o.e(833)]).then(o.bind(o,30268))}),e}getAppPhases(e){return{[p.nh.UNINITIALIZED]:[],[p.nh.WAITING]:[(async()=>{await e.getModule(be.default)})()],[p.nh.LOADING]:[(async()=>(await e.getModule(be.default)).waitForPlaying)()],[p.nh.STARTING]:[(async()=>(await e.getModule(U.default)).waitForFirstRender)()],[p.nh.PLAYING]:[(async()=>(await e.getModule(U.default)).waitForFlyin)()],[p.nh.ERROR]:[this.errorPromise.nativePromise()]}}getStorageProvider(){var e,t;return 0===(null===(e=Et.t.config)||void 0===e?void 0:e.maas)||"0"===(null===(t=this.urlValues)||void 0===t?void 0:t.mds)?ft.Xq.JSONSTORE:ft.Xq.MDS}setError(e){this.errorPromise.reject(e),this.engineTick&&this.engineTick.stop()}async load(e,t){if(this.engine=e,this.engine.loadModule({type:y.default,config:{tasks:this.getAppPhases(e)}}),this.engine.loadModule({type:G.default,config:{useGUI:!0}}),this.engine.loadModule({type:dt.default}),e.getModule(y.default).then((i=>{i.updateActiveApp(p.Mx.SHOWCASE),t.coldStart||e.broadcast(new m.pB(p.Mx.SHOWCASE))})),e.market.waitForData(p.pu).then((t=>{t.onChanged((async()=>{const i=this.urlValues.oops;if(t.phase===p.nh.ERROR||i){const n=t.error,s=await e.getModule(Ee.default);throw n instanceof Ve.vx||"unsupported"===i?s.showError(Ee.ErrorType.UNSUPPORTED):n instanceof Ve.Gw||"webgl"===i?s.showError(Ee.ErrorType.WEBGL):s.showError(Ee.ErrorType.GENERIC),n}}))})),!t.coldStart)return void(this.uiLoading=this.loadUI(!0));let n;xt.info("Showcase app version: 3.1.51.7-84-g0dcbe0591"),this.externalCanvas||(this.canvas=document.createElement("canvas"),this.canvas.className="webgl-canvas",n=document.querySelector("#canvas-container"));const s=document.querySelector("#app-container"),r=document.querySelector("main")||document.body,o=parseInt(this.urlValues.log,10);this.urlValues.hasOwnProperty("log")&&!isNaN(o)&&(i.Z.level=o),this.quickstart&&xt.info("Quickstart engaged. Hold on to your knickers. "+performance.now());const a=this.engine.loadModule({type:D.default,config:{prefetchedData:At,baseUrl:this.modelUrls.urlBase,preloadConfig:"showcase",apiQueue:this.apiQueue,storeQueue:this.storeQueue}});this.engine.loadModule({type:ge.default,config:{queue:this.apiQueue}}),this.engine.loadModule({type:Ee.default});const l=(await a).getApi(),c=this.urlValues.applicationKey||this.settingOverrides.applicationKey,h=this.loadSdkModule(l,c),d=!!c&&await h;if(d)try{await l.modelIsAccessible(this.modelId)}catch(e){xt.error(e);throw(await this.engine.getModule(Ee.default)).showError(Ee.ErrorType.GENERIC),e}this.engine.loadModuleBySymbol({type:g.y.WEBGL_RENDERER,config:{canvas:this.canvas,useWebGL2:"1"===this.urlValues.gl2,antialias:"1"===this.urlValues.aa,useEffectComposer:!(!this.settingOverrides||!this.settingOverrides.hasOwnProperty("useEffectComposer"))&&!!this.settingOverrides.useEffectComposer,trackTextureUsage:"1"===this.urlValues.trackTextureUsage}}),this.engine.loadModule({type:I.default}),this.engine.loadModule({type:b.default,config:{container:s}}),this.engine.loadModuleBySymbol({type:g.y.CANVAS,config:{canvas:this.canvas,container:n}}),this.engine.loadModule({type:mt.default}),this.engine.loadModule({type:de.default});const[u,f,v,E]=await Promise.all([e.getModule(D.default),e.getModuleBySymbol(g.y.WEBGL_RENDERER),e.getModule(G.default),e.getModule(I.default)]);this.engineTick=new EngineTick(this.engine,f.threeRenderer,(e=>{this.engine.getModule(Ee.default).then((t=>{this.setError(e),t.showError(Ee.ErrorType.GENERIC)}))}));const M=u.getApi();this.apiConfig=await M.getConfigs("showcase");const x=new AB(this.apiConfig),O=!this.urlValues.applicationKey&&("roomnav_ab"in this.urlValues?"1"===this.urlValues.roomnav_ab:x.get("roomnav_ab_1"));xt.debug("Roomnav AB "+(O?"enabled":"disabled"));const C=M.user.getFlags("showcase/"),L=(0,et.HG)(parseFloat(this.urlValues.wts)),{labels:k,mt:B,roomnav:F,play:K,note:ee,searchMode:ce,search:fe,allowRating:Le}=this.urlValues,Re=M.user.loggedIn;var Ne;const He=!(!(Ne=this.modelId)||11!==Ne.length)&&this.getStorageProvider()===ft.Xq.MDS;this.openingNote=He&&!!ee,this.forceLogin=this.openingNote&&!Re&&!S.yL();const Ge=!1,qe=C.has(Ze.b),ht=(0,_t.z)(navigator.language),ut=C.has(Je.B)?"0"!==ce:"1"===ce,pt=C.has(Mt.i)?"0"!==Le:"1"===Le,gt=this.inWorkshop&&Re&&pt;let vt=this.editModePreferred;this.editModePreferred&&this.forceLogin&&(xt.warn("Cannot start in edit mode. Need to login to view note."),vt=!1);const yt=!("1"!==K&&!t.autoPlay&&!this.openingNote);this.needsFramebustToPlayXR=S.Ot()&&!S.PI("xr-spatial-tracking"),this.autoplay=!this.forceLogin&&(!S.yL()||yt&&!this.needsFramebustToPlayXR);const Et={Features:{[$e.U]:!0,[ze.AN]:!0,[Ye.s]:!0,[je.Nj]:"0"!==k,[We.r]:"0"!==B,[Xe.ws]:"0"!==this.urlValues.f,[Xe.Q5]:void 0===F&&C.has(Xe.Q5)||void 0!==F&&"0"!==F,[Qe.EU]:L,[Ze.b]:qe,[Mt.i]:gt,[Je.B]:ut,[Ke.R]:Ge,[St.AR]:C.has(St.AR),[Xe.u_]:!O,[Tt.o]:!O,[Xe.gu]:!O},"User Preferences":{[H.F.UnitType]:ht,[H.F.MeasurementSnapping]:!0,[H.F.MeasurementContinuousLines]:!0,[H.F.MeasurementUserNudgeSeen]:!1,[H.F.NotesModeNudgeSeen]:!1,[H.F.NotesIntroModalSeen]:!1}};for(const e in Et)for(const t in Et[e]){if(void 0===Et[e][t])continue;const i="User Preferences"===e?G.SettingPersistence.LOCAL_STORAGE:G.SettingPersistence.NONE;v.registerSetting(e,t,Et[e][t],!0,i)}const wt={[at.YS]:null,sid:this.modelId,quickstart:this.quickstart,lang:this.urlValues.lang,perf:this.urlValues.perf,perfInterval:this.urlValues.perfInterval};for(const e in wt)v.updateSetting(e,wt[e]);if(this.settingOverrides)for(const e in this.settingOverrides)v.updateSetting(e,this.settingOverrides[e]);this.loadInitialAppModules(x,f.gpuInfo,Et),v.hasProperty(We.l)||v.updateSetting(We.l,this.apiConfig.embedly_key),d||await this.loginToModel(this.modelId,M).catch((e=>{this.setError(e)})),this.openingNote&&await this.loginToNote(),await this.initWorkshopStorage(),this.loadInitialDataModules(this.modelId,t);const Ot=((e,t)=>new CameraPoseProxy(e,t))(E,(await e.market.waitForData(bt.M_)).pose);e.commandBinder.hookCommand(ct.ju,!0,(()=>this.stopTourHook(e))),e.commandBinder.hookCommand(lt.rU,!0,(()=>this.stopTourHook(e)));try{await e.waitForLoadingModules()}catch(t){this.setError(t),e.tick()}const[Pt,Dt]=await Promise.all([e.market.waitForData(w.T),e.market.waitForData(_.O)]),{details:Ct,organizationId:It}=Pt.model;document.title=Ct.name;const Lt=Dt.pose;!this.quickstart||Lt&&Lt.mode===ye.Ey.Panorama||(xt.warn("Disabling quickstart. No panorama start position."),this.quickstart=!1,v.updateSetting("quickstart",!1));const{maxMeshQuality:Rt,navPanoSize:Nt,zoomPanoSize:kt,textureLODThreshold:Bt}=((e,t)=>{let i,n,s,r;(0,S.tq)()||(0,S.w1)()?(0,S.tq)()&&(0,nt.W)(t)?(i=it.S7.ULTRA,n=st.eE[st.SL.STANDARD],s=st.eE[st.SL.HIGH],r=10):(i=it.S7.MEDIUM,n=st.eE[st.SL.STANDARD],s=st.eE[st.SL.HIGH],r=6):(i=it.S7.ULTRA,n=st.eE[st.SL.HIGH],s=st.eE[st.SL.ULTRAHIGH],r=20);try{i=e.maxmeshq?(0,it.Pm)(parseInt(e.maxmeshq,10)):i}catch(t){rt.warn(`Not a valid texture size: ${e.maxmeshq}`)}return n=e.maxtileq?parseInt(e.maxtileq,10):n,s=e.maxztileq?parseInt(e.maxztileq,10):s,r=e.lodtexth?parseInt(e.lodtexth,10):r,{maxMeshQuality:i,navPanoSize:n,zoomPanoSize:s,textureLODThreshold:r}})(this.urlValues,f.gpuInfo);xt.info({maxMeshQuality:Rt,navPanoSize:Nt,zoomPanoSize:kt,textureLODThreshold:Bt,gpuInfo:f.gpuInfo}),e.loadModuleBySymbol({type:g.y.SCENE,config:{cameraPoseProxy:Ot}}).then((e=>e.startLoading())),await this.engine.loadModuleBySymbol({type:g.y.SWEEP_PANO,config:{navPanoSize:Nt,zoomPanoSize:kt}}),await this.engine.loadModule({type:W.default}),this.quickstart&&(this.loadPanoControls(vt),this.engineTick.start()),await(await e.getModule(be.default)).waitForPlaying,this.engine.loadModule({type:Ue.default,config:{container:this.container}}),this.engine.loadModuleBySymbol({type:g.y.MODEL_MESH,config:{renderMeshGeometry:!0,maxQuality:Rt,textureLOD:"2"===this.urlValues.texlod?tt.l.RAYCAST:"0"===this.urlValues.texlod?tt.l.NONE:x.get("raycast_lod")?tt.l.RAYCAST:tt.l.NONE,textureLODThreshold:void 0!==this.urlValues.texlodthreshold?parseInt(this.urlValues.texlodthreshold,10):Bt,colorizeRooms:"1"===this.urlValues.colorizeRooms,colorizeChunks:"1"===this.urlValues.colorizeChunks,wireframe:"1"===this.urlValues.wireframe}}),this.engine.loadModule({type:Pe.default}),this.engine.loadModule({type:j.default,config:{startingMode:this.quickstart?ye.Ey.Panorama:null}}),this.engine.loadModule({type:Y.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider()}}),this.engine.loadModule({type:R.default}),this.engine.loadModule({type:q.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:Z.default,config:{allowFloorChanges:Et.Features[Xe.ws],focusBasedNav:Et.Features[Xe.Q5]}}),this.engine.loadModule({type:Oe.default}),this.engine.loadModule({type:T.default,config:{baseUrl:this.modelUrls.urlBase,api:M,modelId:this.modelId,organizationId:It||void 0,storageProvider:this.getStorageProvider(),queue:this.apiQueue}}).then((e=>{this.loadUserPolicyModules(e,Re,v,C,He,Ge,It||void 0)})),this.engine.loadModule({type:he.default,config:{workshopApp:this.inWorkshop,container:s,mainDiv:r,queue:this.apiQueue}}),this.engine.loadModule({type:Ie.default}),this.engine.loadModule({type:pe}),this.engine.loadModule({type:$.default}),this.engine.loadModule({type:te.default,config:{cameraPoseProxy:Ot}}),this.engine.loadModule({type:ie.default}),this.engine.loadModule({type:ue.default,config:{enabled:"1"!==this.urlValues.nozoom,tiles:"0"!==this.urlValues.tiles}}),this.engine.loadModule({type:U.default}),this.engine.loadModule({type:P.default,config:{enableWheel:"1"===this.urlValues.nozoom,focusBasedNav:Et.Features[Xe.Q5]}}),this.engine.loadModule({type:Fe.default}),this.engine.loadModuleBySymbol({type:g.y.MESH_QUERY}),this.engine.loadModule({type:V.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:Ae.default}),this.quickstart||this.engineTick.start(),this.quickstart||this.loadPanoControls(vt),await this.engine.waitForLoadingModules(),"0"!==this.urlValues.portal&&(this.engine.loadModule({type:_e.default}),this.engine.loadModule({type:Te.default})),"0"!==this.urlValues.pin&&(this.engine.loadModule({type:xe.default}),this.engine.loadModule({type:Me.default})),this.engine.loadModule({type:J.default,config:{checkRenderModes:()=>{const t=e.market.tryGetData(z.k3);if(t&&t.isTourActive())return!1;const i=e.market.tryGetData(Ce.O);return!!i&&i.isPano()}}}),this.engine.loadModule({type:oe.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:me.default}),this.engine.loadModule({type:ke.default,config:{newTagsEnabled:Ge}}),this.engine.loadModule({type:Be.default,config:{debug:"1"===this.urlValues.fcdbg}}),this.getStorageProvider()===ft.Xq.JSONSTORE&&this.engine.loadModule({type:ae.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:le.default}),this.engine.loadModule({type:ne.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,parserOptions:{model:this.modelId,supportLinks:!this.urlValues.mls||"0"===this.urlValues.mls,keepLinkLabels:!0},queue:this.storeQueue}}),this.engine.loadModule({type:se.default}),this.engine.loadModule({type:re.default}),this.engine.loadModule({type:N.default}),this.engine.loadModuleBySymbol({type:g.y.TOUR_DATA,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,looping:"1"===this.urlValues.lp,queue:this.storeQueue}}),this.engine.loadModuleBySymbol({type:g.y.TOUR_CONTROLS}),this.engine.loadModule({type:Se.default}),this.engine.loadModule({type:Q.default}),this.engine.loadModule({type:X.default}),this.engine.loadModule({type:ve.default}),this.engine.loadModuleBySymbol({type:g.y.WEBVR}),this.engine.loadModuleBySymbol({type:g.y.SCAN_INFO,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider()}}),this.engine.loadModule({type:we.default}),this.engine.loadModule({type:De.default}),this.engine.loadModule({type:ot.default}),this.engine.loadModuleBySymbol({type:g.y.VIDEO_RECORDER}),this.engine.loadModuleBySymbol({type:g.y.MEASUREMENT_MODE,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}}),this.engine.loadModule({type:A.default}),this.engine.loadModuleBySymbol({type:g.y.DWELL_ANALYTICS}),ut&&this.engine.loadModuleBySymbol({type:g.y.SEARCH,config:{urlSearch:fe,workshop:this.inWorkshop}}),this.inWorkshop&&e.loadModuleBySymbol({type:g.y.TRASH,config:{modelId:this.modelId,queue:this.storeQueue,baseUrl:this.modelUrls.urlBase}}),this.engine.loadModuleBySymbol({type:g.y.WEBXR,config:{enableEventPositions:!1,framebufferScaling:Math.min(this.urlValues.xrframebuffer?parseFloat(this.urlValues.xrframebuffer):0,1),tracking:0,navPanoSize:Nt}}),gt&&this.engine.loadModuleBySymbol({type:g.y.MODEL_RATING,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,queue:this.storeQueue}})}loadUserPolicyModules(e,t,i,n,s,r,o){let a=!1;s&&t&&(a=e.isPolicyFlagEnabled(qe.uE),a&&(i.updateSetting(qe.IA,a),i.updateSetting(qe.Mp,a),i.updateSetting(qe.pE,a&&n.has(qe.pE)))),o&&(a||r)&&(this.engine.loadModule({type:O.default,config:{apiConfig:this.apiConfig,baseUrl:this.modelUrls.urlBase,modelId:this.modelId,organizationId:o,modelUrl:this.modelUrl,queue:this.apiQueue}}),a&&this.engine.loadModule({type:Le.default,config:{workshop:this.inWorkshop,baseUrl:this.modelUrls.urlBase,modelId:this.modelId,startingNote:this.urlValues.note,readonly:!1}}),r&&this.engine.loadModule({type:Ne.default}),this.engine.loadModule({type:Re.default}))}async unload(e){try{await e.commandBinder.issueCommand(new lt.vy)}catch(e){xt.debug("showcase unload called before tour controls registered, ignoring stopTour",e)}await this.uiLoading,await this.showcaseGui.unloadUi().catch((e=>{xt.error(e)})),e.commandBinder.resetHooks()}async loginToModel(e,t){xt.info(`Loading model ${e}`);const i=this.forceLogin;await t.modelExists(e,{ignorePrefetch:i}).catch((async e=>{if(i&&(e instanceof ut.GT||e instanceof ut.V2))await this.showLoginScreen();else{if(!(e instanceof ut.GT))throw e;await this.login()}}))}async loginToNote(){const e=this.modelId;this.forceLogin&&await this.showLoginScreen(e)}async initWorkshopStorage(){this.inWorkshop&&this.getStorageProvider()===ft.Xq.MDS&&(await this.engine.getModule(gt.F),await this.engine.commandBinder.issueCommand(new vt.dS({viewType:ft.XZ.SESSION})))}loadInitialAppModules(e,t,i){this.engine.loadModule({type:K.default}),this.engine.loadModuleBySymbol({type:g.y.INPUT,config:{disableWheel:"0"===this.urlValues.wh,pointerPreventDefault:!this.settingOverrides||!this.settingOverrides.hasOwnProperty("pointerPreventDefault")||!!this.settingOverrides.pointerPreventDefault}}),this.engine.loadModuleBySymbol({type:g.y.SHOWCASE_ANALYTICS,config:{appName:this.settingOverrides&&this.settingOverrides.appName||"showcase",provider:this.urlValues.analytics,additionalValues:{ab_tests:e.serialize(),gpu:t},apiQueue:this.apiQueue,analyticsQueue:this.analyticsQueue}});let n=i.Features[St.AR]?ft.hV.CACHE:ft.hV.NONE;const s=this.urlValues.prefetch;s&&Object.values(ft.hV).includes(s)&&(n=s),this.engine.loadModule({type:gt.F,config:{modelId:this.modelId,mdsEnabled:this.getStorageProvider()===ft.Xq.MDS,prefetchPolicy:n,baseUrl:this.apiHost}})}loadInitialDataModules(e,t){const i=this.settingOverrides.disableMobileRedirect||!(S.tq()||this.needsFramebustToPlayXR),n=!!this.openingNote||void 0,s=!!this.openingNote||void 0,r=!!this.openingNote||void 0;this.engine.loadModule({type:be.default,config:{noUi:this.forceLogin,inWorkshop:this.inWorkshop,modelId:this.modelId,baseUrl:this.modelUrls.urlBase,quickstart:this.quickstart,autoplay:this.autoplay,allowPlayInIframe:i,startNewTab:"1"===this.urlValues.nt,hideTitle:s,hideBranding:r,hidePoweredBy:n}}),this.engine.loadModule({type:x.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:M.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:E.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:L.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,queue:this.storeQueue}})}loadPanoControls(e){this.uiLoading=this.loadUI(!(e||this.forceLogin)),this.engine.loadModule({type:ce.default}),this.engine.loadModule({type:ee.default})}async loadSdkModule(e,t){const i=this.engine;async function n(){return"./sdk/sdk-client.js"}async function s(t){const n=await Promise.all([o.e(431),o.e(838)]).then(o.bind(o,97653));await n.loadInterface(t,i,e)}return new Promise((async e=>{await i.loadModuleBySymbol({type:g.y.SDK,config:{applicationKey:t||null,validationUrl:this.apiHost+"/api/v1/user/",getClientScriptUrl:n,setupExternalSdk:s,onClientConnect(t){t&&pt.w.setToken(t),e(!!t)},queue:this.apiQueue}})}))}loadUI(e){return Promise.all([this.engine.getModule(he.default),this.engine.getModule(pe)]).then((([t,i])=>{this.guiModule=t,this.showcaseGui=i,e&&t.loadUi(i.loadUi)}))}async showLoginScreen(e){var t,i;this.engine.loadModule({type:k.default,config:{loginUrl:(null===(t=this.apiConfig)||void 0===t?void 0:t.authn_login_url)||"",registerUrl:(null===(i=this.apiConfig)||void 0===i?void 0:i.account_register_url)||"",modelId:e,baseUrl:this.modelUrls.urlBase,container:this.container}});return(await this.engine.getModule(k.default)).loadUi()}login(){return new Promise((async e=>{this.engine.loadModule({type:B.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,container:this.container}});const t=await this.engine.getModule(B.default);this.engine.subscribe(F.L,(()=>{t.hidePasswordScreen(),e()})),t.showPasswordScreen()}))}}o(48073);var Ot,Pt,Dt,Ct,It=o(64737);!function(e){const t=new It.M;e.connect=async function(e,i){let n;try{n=await e.connect()}finally{e.cancelConnecting()}return function(e,t,i){return new e(t).build(i)}(await async function(e){if(!e)throw new Error("Unabled to load the sdk");try{const i=await t.load(e,"sdk-client");if(i&&i.SdkBuilder&&"function"==typeof i.SdkBuilder)return i.SdkBuilder}catch(e){}throw Error(`Could not load the sdk from ${e}`)}(n.scriptUrl),i.getFactory(n),n.serializedInterface)}}(Ot||(Ot={})),function(e){e.CONNECT="postmessage.connect"}(Pt||(Pt={})),function(e){e.HANDSHAKE="postmessage.handshake",e.ACCEPT="postmessage.accept",e.REJECT="postmessage.reject"}(Dt||(Dt={}));!function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.HANDSHAKE=2]="HANDSHAKE",e[e.CONNECTED=3]="CONNECTED",e[e.REJECTED=4]="REJECTED"}(Ct||(Ct={}));window.addEventListener("app-start",(e=>{!function(e){const t=new Engine,i=new Showcase(!1,e);t.loadApplication(i,i.setError.bind(i)),S.Jm()||document.body.classList.add("no-touch");!function(e){class BundleSdkBootstrap{async connect(t,i={}){const n=await e.getModuleBySymbol(g.y.SDK);return Ot.connect(new BundleConnector(n,i),new BundleMessengerFactoryFetcher)}}window.MP_SDK=new BundleSdkBootstrap}(t)}(e.detail.config||{})}),!0);class BundleConnector{constructor(e,t){this.sdk=e,this.options=t}connect(){return this.sdk.connect(`${window.location.protocol}//${window.location.host}`,this.options)}cancelConnecting(){}}class BundleMessengerFactoryFetcher{getFactory(e){return e.messengerFactory}}})()})();